<html lang="en"><head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Blitzball FFX Remastered</title>
    <style>:root {
    --ffx-blue-deep: #020408;
    --ffx-blue-dark: #0a1525;
    --ffx-blue-mid: #152a45;
    --ffx-blue-light: #2a4d75;
    --ffx-cyan: #60c0d0;
    --ffx-cyan-glow: #00ffff;
    --ffx-gold: #c8b060;
    --ffx-gold-light: #f0e090;
    --ffx-gold-dark: #8a7030;
    --ffx-glass-bg: rgba(10, 20, 40, 0.75);
    --ffx-glass-border: rgba(100, 200, 255, 0.3);
    
    --font-title: 'Garamond', 'Times New Roman', serif;
    --font-data: 'Impact', 'Arial Narrow', sans-serif;
    --font-ui: 'Courier New', monospace;
}

html, body {
    margin: 0;
    padding: 0;
    background-color: #000;
    overflow: hidden;
    /* Force full viewport fill */
    width: 100vw;
    height: 100%;
    /* Fixes mobile scroll bounce and layout issues */
    position: fixed; 
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    font-family: var(--font-data);
    color: white;
    user-select: none;
    -webkit-user-select: none;
    /* Ensure no safe-area gaps on notched phones */
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
}

/* --- MAIN GAME CONTAINER --- */
#game-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    max-width: none;
    background: #000510;
    box-shadow: none;
    overflow: hidden;
    transition: filter 0.05s;
    z-index: 1;
}

/* --- IMPACT FX (Chromatic Aberration / Shock) --- */
#game-container.impact-fx {
    animation: impactShake 0.1s ease-in-out;
    filter: contrast(1.2) brightness(1.1);
}

#game-container.impact-heavy {
    animation: impactShake 0.2s ease-in-out;
    filter: contrast(1.5) brightness(1.3) sepia(0.4) hue-rotate(-10deg);
}

#game-container.impact-shatter {
    animation: impactShake 0.4s ease-in-out;
    filter: contrast(2.0) invert(0.1) saturate(2.0);
}

@keyframes impactShake {
    0% { transform: translate(0, 0); }
    25% { transform: translate(-5px, 5px); }
    50% { transform: translate(5px, -5px); }
    75% { transform: translate(-5px, -5px); }
    100% { transform: translate(0, 0); }
}

/* Aspect Ratio constraints removed for full screen */

/* --- CANVAS & RENDER --- */
canvas {
    display: block;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    /* PSX/Retro Feel */
    image-rendering: pixelated; 
    z-index: 0;
}

/* --- GLOBAL OVERLAYS (Scanlines & Vignette) --- */
#game-container::after {
    content: "";
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    background: 
        linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%),
        radial-gradient(circle at center, transparent 60%, rgba(0,0,0,0.4) 100%);
    background-size: 100% 4px, 100% 100%;
    pointer-events: none;
    z-index: 900;
    opacity: 0.05;
}

/* --- VIDEO OVERLAY --- */
/* --- GIF OVERLAY --- */
#screen-overlay-gif {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    object-fit: cover;
mix-blend-mode: soft-light;
    opacity: 0.72;
    pointer-events: none;
    z-index: 950;
    image-rendering: pixelated; /* Nearest Neighbor */
}

#ui-layer {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    pointer-events: none;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    z-index: 1000;
}

/* --- CINEMATIC BARS --- */
#cinematic-bars .bar {
    position: absolute;
    left: 0; width: 100%; height: 0;
    background: black;
    transition: height 0.5s ease;
    z-index: 800;
}
#cinematic-bars .bar.top { top: 0; }
#cinematic-bars .bar.bottom { bottom: 0; }

/* --- TECH FLASH OVERLAY (Techcopy) --- */
#tech-flash-overlay {
    position: absolute;
    top: 20%; left: 0; width: 100%; height: 120px;
    display: none; /* Toggled by JS */
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background: linear-gradient(90deg, rgba(0,0,0,0) 0%, rgba(0, 20, 60, 0.9) 20%, rgba(0, 20, 60, 0.9) 80%, rgba(0,0,0,0) 100%);
    z-index: 2200;
    backdrop-filter: blur(2px);
    border-top: 1px solid rgba(100, 255, 255, 0.3);
    border-bottom: 1px solid rgba(100, 255, 255, 0.3);
    animation: flashEnter 0.15s ease-out;
}

@keyframes flashEnter {
    from { transform: scaleY(0); opacity: 0; }
    to { transform: scaleY(1); opacity: 1; }
}

.tech-content-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    transform: skewX(-10deg);
}

.tech-text {
    font-family: var(--font-data);
    font-size: clamp(28px, 10vw, 42px); /* Dynamic */
    color: #ffffff;
    text-shadow: 0 0 10px #00ffff, 0 0 20px #0000ff;
    letter-spacing: 3px;
    margin-bottom: 2px;
    font-style: italic;
    animation: blinkText 0.08s infinite alternate;
    text-align: center;
}

.tech-sub-text {
    font-family: var(--font-ui);
    font-size: 14px;
    color: #00ffff;
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-bottom: 8px;
    text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
}

.tech-timer-track {
    width: 250px;
    height: 8px;
    background: rgba(0, 0, 0, 0.6);
    border: 1px solid #444;
    border-radius: 4px;
    overflow: hidden;
    box-shadow: 0 0 10px rgba(0,0,0,0.5);
}

.tech-timer-fill {
    height: 100%;
    background: linear-gradient(90deg, #ffffff, #00ffff);
    width: 100%;
    transform-origin: left;
    box-shadow: 0 0 10px #00ffff;
}

@keyframes blinkText {
    from { opacity: 0.8; text-shadow: 0 0 5px #00ffff; transform: scale(1); }
    to { opacity: 1.0; text-shadow: 0 0 20px #ffffff, 0 0 10px #00ffff; transform: scale(1.02); }
}

/* --- HUD TOP (The Crystal Interface) --- */
#hud-top {
    position: absolute;
    top: 0;
    left: 0;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    width: 100%;
    padding: 15px;
    box-sizing: border-box;
    background: linear-gradient(to bottom, rgba(0, 5, 15, 0.9) 0%, rgba(0,0,0,0) 100%);
    pointer-events: none;
}

/* Team Wings */
.team-wing {
    position: relative;
    display: flex;
    align-items: center;
    width: 130px;
    height: 50px;
    background: linear-gradient(160deg, var(--ffx-blue-mid) 0%, var(--ffx-blue-deep) 100%);
    border: 1px solid var(--ffx-blue-light);
    border-top: 2px solid var(--ffx-cyan);
    border-radius: 4px;
    transform: skewX(-15deg);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
    padding: 0 10px;
}

.team-wing.away {
    transform: skewX(15deg);
    flex-direction: row-reverse;
    border-top-color: #ff6666; /* Red tint for enemy */
    background: linear-gradient(-160deg, #2a1010 0%, #100505 100%);
}

.team-data {
    display: flex;
    flex-direction: column;
    justify-content: center;
    transform: skewX(15deg); /* Counter skew */
}
.team-wing.away .team-data { transform: skewX(-15deg); text-align: right; }

.team-name {
    font-family: var(--font-title);
    font-size: 14px;
    color: var(--ffx-gold-light);
    text-transform: uppercase;
    letter-spacing: 1px;
    text-shadow: 0 2px 2px rgba(0,0,0,0.8);
}
.team-sub {
    font-family: var(--font-data);
    font-size: 10px;
    color: var(--ffx-cyan);
    opacity: 0.8;
}
.team-wing.away .team-sub { color: #ffaaaa; }

.score-box {
    font-family: var(--font-data);
    font-size: 38px;
    color: white;
    text-shadow: 0 0 10px var(--ffx-cyan-glow);
    transform: skewX(15deg);
    margin: 0 10px;
}
.team-wing.away .score-box { transform: skewX(-15deg); text-shadow: 0 0 10px #ff4444; }

/* Timer Complex */
.timer-complex {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: -5px;
}

.timer-crystal-ring {
    position: absolute;
    top: -25px;
    width: 120px;
    height: 60px;
    border-radius: 50%;
    border-top: 3px solid var(--ffx-gold);
    border-bottom: 1px solid transparent;
    box-shadow: 0 -5px 15px rgba(200, 180, 100, 0.3);
    z-index: -1;
    background: radial-gradient(ellipse at top, rgba(20, 40, 80, 0.8), transparent 70%);
}

#half-indicator {
    font-family: var(--font-data);
    font-size: 10px;
    color: var(--ffx-gold);
    letter-spacing: 2px;
    margin-bottom: -2px;
    text-shadow: 0 0 5px var(--ffx-gold-dark);
}

#timer-display {
    font-family: var(--font-data);
    font-size: 42px;
    background: linear-gradient(to bottom, #fff 0%, #ffd700 50%, #b8860b 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    filter: drop-shadow(2px 2px 0px rgba(0,0,0,0.8));
    letter-spacing: 1px;
}

/* --- PLAYER STATUS PANEL (Bottom Left) --- */
#player-status-panel {
    position: absolute;
    bottom: 160px; /* Above joystick */
    left: 20px;
    width: 160px;
    padding: 10px;
    background: linear-gradient(90deg, rgba(0, 10, 30, 0.8) 0%, rgba(0,0,0,0) 100%);
    border-left: 3px solid var(--ffx-cyan);
    border-radius: 0 10px 10px 0;
    backdrop-filter: blur(4px);
    transform: skewX(-10deg);
    pointer-events: none;
    display: none; /* Hidden by default, shown by JS */
}

.char-name {
    font-family: var(--font-title);
    font-size: 18px;
    color: white;
    text-transform: uppercase;
    margin-bottom: 5px;
    transform: skewX(10deg);
    text-shadow: 0 0 5px var(--ffx-blue-light);
}

.hp-gauge-container {
    display: flex;
    align-items: center;
    margin-bottom: 4px;
    transform: skewX(10deg);
}
.hp-label { font-size: 10px; color: var(--ffx-cyan); width: 20px; }
.hp-bar-track {
    flex-grow: 1;
    height: 6px;
    background: rgba(0,0,0,0.5);
    border: 1px solid #444;
    margin: 0 5px;
}
.hp-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, #00ff00, #ccffcc);
    box-shadow: 0 0 5px #00ff00;
}
.hp-value { font-size: 10px; color: #fff; width: 45px; text-align: right; }

.tech-gauge-container {
    display: flex;
    align-items: center;
    transform: skewX(10deg);
}
.tech-label { font-size: 10px; color: var(--ffx-gold); width: 20px; }
.tech-bar-track {
    flex-grow: 1;
    height: 4px;
    background: rgba(0,0,0,0.5);
    border: 1px solid #444;
    margin: 0 5px;
}
.tech-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, #ffaa00, #ffffaa);
}

/* --- MINIMAP (Sphere Radar) --- */
#minimap-container {
    position: absolute;
    top: 80px;
    right: 20px;
    width: 110px;
    height: 110px;
    display: flex;
    justify-content: center;
    align-items: center;
}

.radar-rim {
    position: absolute;
    width: 100%; height: 100%;
    border-radius: 50%;
    border: 2px solid var(--ffx-blue-light);
    box-shadow: 0 0 15px var(--ffx-blue-mid), inset 0 0 20px rgba(0,0,0,0.8);
    background: radial-gradient(circle, rgba(0, 20, 60, 0.4) 0%, rgba(0, 5, 10, 0.8) 100%);
    z-index: 5;
}

#minimap {
    position: relative;
    width: 100px;
    height: 100px;
    border-radius: 50%;
    z-index: 6;
    overflow: hidden;
}

.radar-label {
    position: absolute;
    bottom: -15px;
    width: 100%;
    text-align: center;
    font-size: 9px;
    color: var(--ffx-cyan);
    text-transform: uppercase;
    letter-spacing: 1px;
    text-shadow: 0 0 5px var(--ffx-cyan);
}

/* Map Dots */
.map-dot {
    position: absolute;
    width: 6px; height: 6px;
    border-radius: 50%;
    transform: translate(-50%, -50%); /* Center anchor */
    box-shadow: 0 0 4px currentColor;
}
.map-dot.home { background: var(--ffx-cyan); color: var(--ffx-cyan); }
.map-dot.away { background: #ff4444; color: #ff4444; }
.map-dot.ball { 
    background: #ff00cc; /* Hot Pink for visibility */
    color: #ff00cc; 
    width: 12px; height: 12px;
    border: 2px solid #ffffff;
    z-index: 20;
    animation: blinkBall 0.3s infinite alternate;
    box-shadow: 0 0 6px #ff00cc;
}
.map-dot.nap { background: #333; color: #000; border: 1px solid #555; }
.map-dot.active-player { 
    background: #00ff00 !important; 
    color: #00ff00 !important; 
    box-shadow: 0 0 8px #00ff00;
    z-index: 15;
transform: translate(-50%, -50%) scale(1.2);
}

.map-dot.ball-carrier {
    box-shadow: 0 0 15px #fff, 0 0 30px #ffaa00;
    border: 2px solid #ffffff;
    background-color: #ffaa00 !important;
    z-index: 100;
    width: 10px; height: 10px; /* Slightly larger */
    animation: carrierPulse 0.8s infinite alternate;
}
@keyframes carrierPulse {
    from { transform: translate(-50%, -50%) scale(1.2); box-shadow: 0 0 10px #fff; opacity: 0.8; }
    to { transform: translate(-50%, -50%) scale(1.8); box-shadow: 0 0 25px #ffcc00; opacity: 1.0; }
}
@keyframes blinkBall { from { opacity: 1; transform: translate(-50%, -50%) scale(1); } to { opacity: 0.5; transform: translate(-50%, -50%) scale(1.3); } }

/* --- ANNOUNCEMENTS (Goal, Blitzoff) --- */
#announcement {
    position: absolute;
    top: 40%; 
    left: 5%; 
    width: 90%;
    text-align: center;
    font-family: var(--font-data);
    font-size: clamp(40px, 12vw, 72px); /* Dynamic sizing */
    font-weight: 900;
    font-style: italic;
    text-transform: uppercase;
    letter-spacing: 2px; /* Reduced spacing to fit */
    line-height: 1.0;
    white-space: normal; /* Allow wrapping */
    
    /* Metallic Gold Gradient */
    background: linear-gradient(to bottom, #fff 0%, #ffd700 40%, #b8860b 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    filter: drop-shadow(0 0 10px rgba(255, 100, 0, 0.5)) drop-shadow(3px 3px 0 #000);
    
    display: none;
    z-index: 2000;
    animation: announceSlide 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    pointer-events: none; /* Click through */
}

@keyframes announceSlide {
    from { transform: scale(0) rotate(-5deg); opacity: 0; }
    to { transform: scale(1) rotate(0deg); opacity: 1; }
}

/* --- CONTROLS (SPHERE GRID ARTIFACTS) --- */

/* Joystick: The Navigation Sphere */
/* --- JOYSTICK (FLOATING) --- */
#joystick-hit-zone {
    position: absolute;
    bottom: 0; left: 0;
    width: 50%; height: 50%;
    z-index: 1000;
    /* transparent but interactive */
    background: rgba(0,0,0,0); 
    touch-action: none;
    pointer-events: auto;
}

#joystick-visual-container {
    position: absolute;
    top: 0; left: 0;
    width: 0; height: 0;
    overflow: visible;
    pointer-events: none;
    display: none; /* Hidden until touched */
    z-index: 1100;
}

#joystick-base {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 120px; height: 120px;
    border-radius: 50%;
    
    /* Glassy Base */
    background: radial-gradient(circle, rgba(0, 40, 80, 0.4) 0%, rgba(0, 10, 20, 0.1) 60%, transparent 100%);
    border: 1px solid rgba(100, 220, 255, 0.3);
    box-shadow: 0 0 20px rgba(0, 100, 255, 0.2), inset 0 0 30px rgba(0, 50, 100, 0.3);
    
    animation: basePulse 2s infinite alternate;
}

@keyframes basePulse {
    from { box-shadow: 0 0 10px rgba(0, 100, 255, 0.2); border-color: rgba(100, 220, 255, 0.2); }
    to { box-shadow: 0 0 25px rgba(0, 100, 255, 0.5); border-color: rgba(100, 255, 255, 0.6); }
}

#joystick-knob {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%); /* Centered initially, moved by JS */
    width: 50px; height: 50px;
    border-radius: 50%;
    
    /* Sphere Look: Cyan/Blue */
    background: radial-gradient(circle at 30% 30%, #e0ffff 0%, #00aaff 40%, #004488 80%, #001122 100%);
    border: 2px solid #88ccff;
    box-shadow: 0 0 15px #00ffff, inset 0 0 10px rgba(255,255,255,0.8);
    
    transition: transform 0.05s linear;
}

/* Inner light of knob */
#joystick-knob::after {
    content: "";
    position: absolute;
    top: 20%; left: 20%; width: 20%; height: 20%;
    background: radial-gradient(circle, #ffffff 0%, transparent 70%);
    filter: blur(2px);
    opacity: 0.8;
}

/* --- TOUCH RIPPLE FX --- */
.touch-ripple {
    position: absolute;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(200, 255, 255, 0.8) 0%, rgba(0, 255, 255, 0.4) 40%, transparent 70%);
    transform: translate(-50%, -50%) scale(0);
    animation: rippleAnim 0.6s ease-out forwards;
    pointer-events: none;
    z-index: 9000;
    mix-blend-mode: screen;
}

@keyframes rippleAnim {
    0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(3.0); opacity: 0; }
}

#camera-zone {
    position: absolute;
    top: 0; right: 0; width: 50%; height: 100%;
    pointer-events: auto;
    touch-action: none;
    z-index: 50;
}

/* --- ACTION BUTTON (THE LIMIT SPHERE) --- */
#action-container {
    position: absolute;
    bottom: 40px; right: 40px;
    display: flex;
    flex-direction: column;
    align-items: center;
    pointer-events: auto;
    z-index: 100;
}

.command-menu-bg {
    position: absolute;
    width: 180px; height: 80px;
    bottom: 15px;
    background: linear-gradient(90deg, transparent 0%, rgba(0, 10, 30, 0.8) 50%, transparent 100%);
    border-bottom: 1px solid rgba(0, 200, 255, 0.3);
    z-index: -1;
}

.command-ring {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 130px; height: 130px;
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-top: 2px solid rgba(0, 255, 255, 0.6);
    border-bottom: 2px solid rgba(0, 255, 255, 0.6);
    border-radius: 50%;
    animation: spinReverse 15s linear infinite;
    pointer-events: none;
    box-shadow: 0 0 15px rgba(0, 100, 255, 0.2);
}
@keyframes spinReverse { from { transform: translate(-50%, -50%) rotate(360deg); } to { transform: translate(-50%, -50%) rotate(0deg); } }

#action-label {
    font-family: var(--font-data);
    font-size: 12px;
    color: var(--ffx-cyan);
    background: rgba(0, 5, 10, 0.8);
    padding: 4px 12px;
    border: 1px solid var(--ffx-blue-light);
    border-radius: 10px;
    margin-bottom: 15px;
    text-transform: uppercase;
    letter-spacing: 2px;
    box-shadow: 0 0 10px rgba(0,0,0,0.8);
    text-shadow: 0 0 5px var(--ffx-cyan);
    transition: all 0.3s;
}

#action-button {
    position: absolute;
    top: 0; left: 0;
    width: 100px; height: 100px;
    border-radius: 50%;
    cursor: pointer;
    transition: transform 0.1s, filter 0.3s;
    
    /* Default: Swim Mode (Blue Sphere) */
    background: radial-gradient(circle at 35% 35%, #ffffff 0%, #0088ff 40%, #002266 80%, #000 100%);
    border: 3px solid #44aaff;
    box-shadow: 
        0 0 20px rgba(0, 100, 255, 0.8),
        inset 0 0 20px rgba(255, 255, 255, 0.4);
        
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: visible; /* Allow ring to pulse out */
    z-index: 10;
}

#pass-button {
    display: none !important; /* Hidden as per user request */
    position: absolute;
    bottom: -20px; left: -30px;
    width: 60px; height: 60px;
    border-radius: 50%;
    cursor: pointer;
    z-index: 9;
}

#pass-button:active { transform: scale(0.92); }
#pass-button.visible { display: flex; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

@keyframes popIn {
    from { transform: scale(0); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

#pass-button .btn-text {
    font-family: var(--font-data);
    font-size: 14px;
    font-weight: bold;
    color: white;
    text-shadow: 0 1px 2px rgba(0,0,0,0.8);
    pointer-events: none;
}

#pass-button .btn-glare {
    position: absolute;
    top: -50%; left: -50%; width: 200%; height: 200%;
    background: linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.3) 50%, transparent 60%);
    pointer-events: none;
    border-radius: 50%;
}

/* Expanded Hit Area (Invisible) */
#action-button::before {
    content: '';
    position: absolute;
    top: -40px; left: -40px; right: -40px; bottom: -40px;
    border-radius: 50%;
    z-index: 10;
    /* Debug: background: rgba(255, 0, 0, 0.2); */
}

#action-button:active { transform: scale(0.92); }

/* Text inside button */
#action-button .btn-text {
    font-family: var(--font-title);
    font-size: 22px;
    font-weight: bold;
    color: white;
    text-shadow: 0 2px 4px rgba(0,0,0,0.8), 0 0 10px rgba(255,255,255,0.5);
    z-index: 5;
    pointer-events: none;
    letter-spacing: 1px;
}

/* Glare Effect */
#action-button .btn-glare {
    position: absolute;
    top: -50%; left: -50%; width: 200%; height: 200%;
    background: linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.4) 50%, transparent 60%);
    animation: glarePass 5s infinite;
    pointer-events: none;
    z-index: 6;
    border-radius: 50%;
}

/* Limit Ring (The Glow Pulse) */
.limit-ring {
    position: absolute;
    top: -5px; left: -5px; right: -5px; bottom: -5px;
    border-radius: 50%;
    border: 2px solid transparent;
    box-shadow: 0 0 0 transparent;
    transition: all 0.5s;
    z-index: 1;
    pointer-events: none;
}

/* --- SHOOT MODE (OFFENSE) --- */
#action-button.shoot-mode {
    /* Gold/Fire Sphere */
    background: radial-gradient(circle at 35% 35%, #ffffaa 0%, #ffaa00 40%, #882200 80%, #220000 100%);
    border-color: #ffcc00;
    box-shadow: 
        0 0 30px rgba(255, 100, 0, 0.8),
        inset 0 0 20px rgba(255, 255, 0, 0.5);
}

/* Limit Break Glow (High Energy) */
#action-button.limit-ready .limit-ring {
    border-color: #ffdd44;
    animation: limitPulse 0.8s ease-in-out infinite alternate;
}

/* Label Change */
.shoot-label {
    color: #ffdd44 !important;
    border-color: #ffaa00 !important;
    text-shadow: 0 0 10px #ff4400 !important;
}

@keyframes limitPulse {
    0% { 
        transform: scale(1.0); 
        box-shadow: 0 0 10px #ffaa00, inset 0 0 5px #ffaa00; 
        opacity: 0.5;
    }
    100% { 
        transform: scale(1.15); 
        box-shadow: 0 0 30px #ff4400, inset 0 0 15px #ff0000; 
        opacity: 1.0;
    }
}

/* --- AUTO TOGGLE (Glass Button) --- */
#auto-toggle {
    position: absolute;
    top: 200px; right: 20px;
    width: 110px;
    padding: 10px 0;
    text-align: center;
    font-size: 12px;
    font-weight: bold;
    color: var(--ffx-cyan);
    background: linear-gradient(135deg, rgba(0, 20, 40, 0.8) 0%, rgba(0, 5, 10, 0.9) 100%);
    border: 1px solid var(--ffx-blue-light);
    border-top: 1px solid var(--ffx-cyan);
    border-radius: 4px;
    cursor: pointer;
    text-transform: uppercase;
    letter-spacing: 1px;
    backdrop-filter: blur(4px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    pointer-events: auto;
    transition: all 0.2s;
    z-index: 100;
}

#auto-toggle:hover {
    background: rgba(0, 40, 80, 0.9);
    box-shadow: 0 0 15px var(--ffx-cyan);
    color: white;
}

#auto-toggle.active {
    background: linear-gradient(135deg, rgba(100, 20, 0, 0.8) 0%, rgba(40, 0, 0, 0.9) 100%);
    border-color: #ff4400;
    color: #ffaa00;
    animation: pulseRed 2s infinite;
}
@keyframes pulseRed { 0% { box-shadow: 0 0 5px #ff0000; } 50% { box-shadow: 0 0 20px #ff4400; } 100% { box-shadow: 0 0 5px #ff0000; } }

/* --- FLOATING TEXT --- */
/* --- FLOATING TEXT MANAGER --- */
.floating-text-wrapper {
    position: absolute;
    top: 0; left: 0;
    pointer-events: none;
    z-index: 2000;
    will-change: transform;
}

.floating-text-inner {
    display: block;
    font-family: var(--font-data);
    font-weight: 900;
    text-transform: uppercase;
    white-space: nowrap;
    text-align: center;
    /* Reduced default size and shadow for clarity */
    font-size: 24px; 
    text-shadow: 1px 1px 0 #000;
    opacity: 0.9;
}

/* DAMAGE (Numeric) */
.floating-text-inner.damage {
    font-size: 42px;
    font-style: italic;
    /* Gold/Orange Gradient */
    background: linear-gradient(to bottom, #ffffff 0%, #ffcc00 40%, #ff4400 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    filter: drop-shadow(0 4px 4px rgba(0,0,0,0.8));
    animation: popDamage 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

/* HEAL */
.floating-text-inner.heal {
    font-size: 36px;
    color: #44ff44;
    text-shadow: 0 0 10px #00ff00;
    animation: floatUp 1s ease-out forwards;
}

/* STATUS: VENOM */
/* STATUS: VENOM (Bio-Green, Sharp) */
.floating-text-inner.venom {
    font-family: var(--font-data); /* Consistent FFX font */
    font-size: 42px;
    font-style: italic;
    color: #aaff00;
    text-shadow: 0 0 10px #448800, 2px 2px 0 #002200;
    background: linear-gradient(to bottom, #ccff66 0%, #66cc00 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    filter: drop-shadow(0 0 5px rgba(100, 255, 0, 0.5));
    animation: dripStatus 2s infinite;
}

/* STATUS: SLEEP (Hazy Blue, Dreamy) */
.floating-text-inner.sleep {
    font-family: var(--font-title);
    font-size: 42px;
    color: #ffffff;
    text-shadow: 0 0 15px #0044ff, 0 0 30px #0000ff;
    opacity: 0.9;
    animation: driftStatus 3s ease-in-out infinite;
}

/* STATUS: WITHER (Desaturated, Stone-like) */
.floating-text-inner.wither {
    font-family: var(--font-data);
    font-size: 38px;
    color: #cccccc;
    text-shadow: 2px 2px 0 #444444;
    background: linear-gradient(to bottom, #eeeeee 0%, #888888 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: witherStatus 1.5s forwards;
}

/* TECH CALLOUTS (Sphere Shot, Jecht Shot) */
/* TECH CALLOUTS (Sphere Shot, Jecht Shot) */
.floating-text-inner.tech {
    font-family: var(--font-title);
    font-size: 32px; /* Was 48px */
    color: #00ffff;
    background: rgba(0, 10, 30, 0.7);
    padding: 2px 10px;
    border: 1px solid #00ffff;
    border-radius: 4px;
    box-shadow: 0 0 10px #0088ff;
    text-shadow: 0 0 5px #fff;
    animation: shakeTech 0.6s ease-in-out, flashTech 0.3s;
    transform-origin: center;
}

/* SAVE / BLOCK */
.floating-text-inner.save, .floating-text-inner.block {
    font-size: 48px;
    font-weight: 900;
    color: #ffffff;
    -webkit-text-stroke: 1px #004488;
    text-shadow: 0 0 20px #0088ff;
    animation: popDamage 0.5s ease-out forwards;
}

/* --- ANIMATIONS --- */

@keyframes popDamage {
    0% { transform: scale(0.5); opacity: 0; }
    20% { transform: scale(1.5); opacity: 1; }
    40% { transform: scale(1.0); opacity: 1; }
    100% { transform: scale(1.0); opacity: 0; }
}

@keyframes floatUp {
    0% { transform: translateY(0); opacity: 1; }
    100% { transform: translateY(-50px); opacity: 0; }
}

@keyframes dripStatus {
    0% { transform: scaleY(1); filter: blur(0px); }
    50% { transform: scaleY(1.1) translateY(5px); filter: blur(1px); }
    100% { transform: scaleY(1); filter: blur(0px); }
}

@keyframes driftStatus {
    0% { transform: translateX(0) rotate(0deg); opacity: 0; }
    20% { opacity: 1; }
    50% { transform: translateX(15px) translateY(-20px) rotate(10deg); }
    100% { transform: translateX(-15px) translateY(-50px) rotate(-10deg); opacity: 0; }
}

@keyframes witherStatus {
    0% { transform: scale(1); filter: grayscale(0%); opacity: 1; }
    100% { transform: scale(0.6); filter: grayscale(100%); opacity: 0; }
}

@keyframes shakeTech {
    0% { transform: scale(0.8); }
    10%, 30%, 50%, 70%, 90% { transform: scale(1.1) translate(-2px, 2px); }
    20%, 40%, 60%, 80% { transform: scale(1.1) translate(2px, -2px); }
    100% { transform: scale(1.0); }
}

@keyframes flashTech {
    0% { background-color: #fff; color: #000; border-color: #fff; }
    100% { background-color: rgba(0, 10, 30, 0.85); color: #00ffff; border-color: #00ffff; }
}
/* Loading Overlay */
#loading {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    font-size: 24px;
    color: var(--ffx-cyan);
    text-transform: uppercase;
    letter-spacing: 5px;
    animation: blink 1s infinite;
}
@keyframes blink { 50% { opacity: 0.5; } }

#controls-hint {
    position: absolute;
    top: 130px; width: 100%;
    text-align: center;
    font-size: 10px;
    color: rgba(255,255,255,0.4);
    text-transform: uppercase;
    pointer-events: none;
}

/* --- COMIC BOOK FX --- */
/* --- COMIC BOOK FX (Scaled Down) --- */
.floating-text-inner.comic-impact {
    font-family: 'Impact', sans-serif;
    font-size: 42px; /* Was 60px */
    color: #ffff00; 
    -webkit-text-stroke: 1px #000;
    text-shadow: 3px 3px 0 #ff0000;
    font-style: italic;
    transform-origin: center;
    white-space: nowrap;
    animation: comicPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    z-index: 2500;
}

.floating-text-inner.comic-action {
    font-family: 'Arial Black', sans-serif;
    font-size: 28px; /* Was 40px */
    color: #00ffff; 
    -webkit-text-stroke: 1px #000;
    text-shadow: 2px 2px 0 #0044aa;
    font-style: italic;
    white-space: nowrap;
    animation: comicSlide 0.4s ease-out forwards;
    z-index: 2500;
}

@keyframes comicPop {
    0% { transform: scale(0) rotate(-20deg); opacity: 0; }
    40% { transform: scale(1.2) rotate(5deg); opacity: 1; }
    60% { transform: scale(1.0) rotate(-5deg); opacity: 1; }
    100% { transform: scale(1.1) rotate(0deg); opacity: 0; }
}

@keyframes comicSlide {
    0% { transform: translate(-20px, 20px) scale(0.5); opacity: 0; }
    100% { transform: translate(20px, -20px) scale(1.2); opacity: 0; }
}
/* --- MAIN MENU (FFX Style) --- */
#main-menu {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 3000;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s ease-in-out;
    background: radial-gradient(circle at center, rgba(0, 20, 60, 0.8) 0%, rgba(0, 5, 10, 0.95) 100%);
    backdrop-filter: blur(5px);
}

#main-menu.active {
    opacity: 1;
    pointer-events: auto;
}

.menu-bg-overlay {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    background: 
        linear-gradient(rgba(0,0,0,0) 50%, rgba(0,0,0,0.2) 50%), 
        linear-gradient(90deg, rgba(255,0,0,0.06), rgba(0,255,0,0.02), rgba(0,0,255,0.06));
    background-size: 100% 2px, 3px 100%;
    pointer-events: none;
    z-index: -1;
}

.ffx-logo-container {
    margin-bottom: 60px;
    text-align: center;
    transform: skewX(-10deg);
}

.ffx-logo-main {
    font-family: var(--font-title);
    font-size: 64px;
    color: #ffffff;
    text-shadow: 
        0 0 10px #00ffff,
        0 0 20px #0088ff,
        0 0 40px #0000ff;
    letter-spacing: 5px;
    background: linear-gradient(to bottom, #ffffff 0%, #aaccff 50%, #0088ff 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    filter: drop-shadow(0 5px 5px rgba(0,0,0,0.8));
}

.ffx-logo-sub {
    font-family: var(--font-data);
    font-size: 18px;
    color: var(--ffx-gold);
    letter-spacing: 12px;
    margin-top: -5px;
    text-shadow: 0 0 5px #ffaa00;
}

.menu-options {
    display: flex;
    flex-direction: column;
    gap: 15px;
    width: 300px;
}

.menu-item {
    position: relative;
    padding: 15px 30px;
    background: linear-gradient(90deg, rgba(0, 40, 80, 0.6) 0%, rgba(0, 10, 20, 0.0) 100%);
    border-left: 4px solid rgba(100, 200, 255, 0.3);
    border-bottom: 1px solid rgba(100, 200, 255, 0.1);
    cursor: pointer;
    transition: all 0.2s;
    transform: skewX(-10deg);
    display: flex;
    align-items: center;
}

.menu-item:hover {
    background: linear-gradient(90deg, rgba(0, 80, 160, 0.8) 0%, rgba(0, 20, 40, 0.0) 100%);
    border-left-color: #00ffff;
    padding-left: 40px;
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.2);
}

.menu-item .label {
    font-family: var(--font-title);
    font-size: 24px;
    color: #cccccc;
    letter-spacing: 2px;
    text-transform: uppercase;
    transform: skewX(10deg); /* Counter skew */
    transition: color 0.2s;
}

.menu-item:hover .label {
    color: #ffffff;
    text-shadow: 0 0 10px #00ffff;
}

.menu-item .cursor {
    font-size: 18px;
    color: var(--ffx-gold);
    margin-right: 15px;
    opacity: 0;
    transform: translateX(-10px) skewX(10deg);
    transition: all 0.2s;
}

.menu-item:hover .cursor {
    opacity: 1;
    transform: translateX(0) skewX(10deg);
}

.menu-footer {
    position: absolute;
    bottom: 20px;
    font-family: var(--font-ui);
    font-size: 10px;
    color: rgba(255,255,255,0.3);
    letter-spacing: 2px;
}
/* --- PRACTICE OVERLAY (FFX Style) --- */
#practice-overlay {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 5, 10, 0.6); /* Dim background */
    display: none; /* Toggled by JS */
    justify-content: center;
    align-items: center;
    z-index: 2500;
    pointer-events: none; /* Let clicks pass through to game usually, but panel needs events */
}

#practice-overlay.active {
    display: flex;
}

.practice-panel {
    position: absolute;
    top: 60px; right: 20px; /* Top Right positioning like a debug menu */
    width: 280px;
    background: linear-gradient(160deg, rgba(0, 20, 50, 0.95) 0%, rgba(0, 10, 20, 0.98) 100%);
    border: 1px solid #4488ff;
    border-radius: 0 0 15px 0;
    box-shadow: 0 0 20px rgba(0, 100, 255, 0.2), inset 0 0 50px rgba(0, 20, 60, 0.5);
    padding: 15px;
    pointer-events: auto;
    transform: skewX(-2deg);
    backdrop-filter: blur(5px);
}

.panel-header {
    margin-bottom: 15px;
    text-align: center;
}

.panel-title-group {
    display: flex;
    flex-direction: column;
}

.panel-title {
    font-family: var(--font-title);
    font-size: clamp(18px, 6vw, 24px); /* Dynamic */
    color: #ffffff;
    text-shadow: 0 0 10px #00ffff;
    letter-spacing: 2px;
}

.panel-subtitle {
    font-family: var(--font-ui);
    font-size: 8px;
    color: #4488ff;
    letter-spacing: 4px;
    margin-top: -2px;
}

.panel-deco-line {
    width: 100%;
    height: 2px;
    background: linear-gradient(90deg, transparent, #00ffff, transparent);
    margin-top: 5px;
    box-shadow: 0 0 5px #00ffff;
}

.panel-content {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.section-label {
    font-family: var(--font-ui);
    font-size: 10px;
    color: var(--ffx-gold);
    border-bottom: 1px solid rgba(200, 176, 96, 0.3);
    margin-bottom: 5px;
    padding-bottom: 2px;
    letter-spacing: 1px;
}

/* Drill Buttons */
.drill-list {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.drill-btn {
    display: flex;
    align-items: center;
    padding: 8px 12px;
    background: linear-gradient(90deg, rgba(255, 255, 255, 0.05), transparent);
    border-left: 2px solid transparent;
    cursor: pointer;
    font-family: var(--font-data);
    font-size: 14px;
    color: #aaa;
    transition: all 0.2s;
}

.drill-btn:hover {
    background: linear-gradient(90deg, rgba(0, 255, 255, 0.1), transparent);
    color: #fff;
    padding-left: 15px;
}

.drill-btn.active {
    background: linear-gradient(90deg, rgba(0, 100, 255, 0.4), transparent);
    border-left: 3px solid #00ffff;
    color: #fff;
    text-shadow: 0 0 5px #00ffff;
}

.drill-btn .icon {
    width: 20px;
    text-align: center;
    margin-right: 10px;
    color: var(--ffx-cyan);
}

/* Options */
.option-list {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.option-toggle {
    display: flex;
    align-items: center;
    padding: 5px 10px;
    cursor: pointer;
    font-size: 12px;
    color: #ccc;
    transition: color 0.2s;
}

.option-toggle:hover { color: #fff; }

.option-toggle .checkbox {
    margin-right: 10px;
    color: #444;
    font-family: monospace;
    font-size: 14px;
}

.option-toggle.active .checkbox {
    color: #00ff00;
    text-shadow: 0 0 5px #00ff00;
}

.option-toggle.active {
    color: #fff;
}

/* Action Buttons */
.action-btn {
    text-align: center;
    background: rgba(0, 0, 0, 0.5);
    border: 1px solid #444;
    padding: 6px;
    font-size: 11px;
    color: #aaa;
    cursor: pointer;
    transition: all 0.2s;
    margin-bottom: 5px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.action-btn:hover {
    border-color: #fff;
    color: #fff;
    background: rgba(255, 255, 255, 0.1);
}

#p-exit:hover {
    border-color: #ff4444;
    color: #ff4444;
    background: rgba(50, 0, 0, 0.3);
}

/* Footer */
.panel-footer {
    margin-top: 15px;
    padding-top: 10px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    text-align: center;
}

#drill-instruction {
    font-size: 10px;
    color: var(--ffx-cyan);
    margin-bottom: 5px;
    font-style: italic;
}

#drill-score {
    font-family: var(--font-data);
    font-size: 24px;
    color: var(--ffx-gold);
text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
}

/* --- PRACTICE MINIMIZE/RESTORE --- */
/* --- PRACTICE MINIMIZE/RESTORE --- */
.panel-minimize-btn {
    position: absolute;
    top: 10px; right: 10px;
    width: 20px; height: 20px;
    border: 1px solid var(--ffx-cyan);
    color: var(--ffx-cyan);
    text-align: center;
    line-height: 18px;
    cursor: pointer;
    font-size: 14px;
    background: rgba(0,0,0,0.5);
    transition: all 0.2s;
}
.panel-minimize-btn:hover { 
    background: var(--ffx-cyan); 
    color: #000; 
    box-shadow: 0 0 5px var(--ffx-cyan);
}

#practice-restore-btn {
    position: absolute;
    top: 60px; right: 20px;
    padding: 8px 15px;
    background: linear-gradient(90deg, rgba(0, 20, 50, 0.9) 0%, rgba(0, 10, 20, 0.9) 100%);
    border: 1px solid var(--ffx-cyan);
    border-left: 3px solid var(--ffx-cyan);
    color: var(--ffx-cyan);
    font-family: var(--font-data);
    font-size: 12px;
    letter-spacing: 1px;
    cursor: pointer;
    z-index: 2400;
    display: none; /* Hidden by default */
    pointer-events: auto;
    transform: skewX(-10deg);
    box-shadow: 0 0 10px rgba(0, 100, 255, 0.2);
    text-transform: uppercase;
}
#practice-restore-btn:hover {
    background: rgba(0, 40, 80, 0.9);
    color: #fff;
    text-shadow: 0 0 5px #00ffff;
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
}

/* === NEW UI ELEMENTS (v2.0 Upgrade) === */

/* --- AIM JOYSTICK (Right Side) --- */
#aim-joystick-zone {
    position: absolute;
    bottom: 150px;
    right: 0;
    width: 40%;
    height: 35%;
    z-index: 1000;
    background: rgba(0,0,0,0);
    touch-action: none;
    pointer-events: auto;
}

#aim-joystick-visual {
    position: absolute;
    top: 0; left: 0;
    width: 0; height: 0;
    overflow: visible;
    pointer-events: none;
    display: none;
    z-index: 1100;
}

#aim-joystick-base {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 90px; height: 90px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255, 100, 0, 0.3) 0%, rgba(80, 20, 0, 0.1) 60%, transparent 100%);
    border: 1px solid rgba(255, 150, 50, 0.4);
    box-shadow: 0 0 15px rgba(255, 100, 0, 0.2), inset 0 0 20px rgba(255, 50, 0, 0.2);
}

#aim-joystick-knob {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 40px; height: 40px;
    border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, #ffcc88 0%, #ff6600 40%, #882200 80%, #220000 100%);
    border: 2px solid #ffaa44;
    box-shadow: 0 0 10px #ff4400, inset 0 0 8px rgba(255,255,255,0.6);
    transition: transform 0.05s linear;
}

#aim-joystick-knob::after {
    content: "AIM";
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    font-size: 8px;
    color: white;
    font-family: var(--font-data);
    text-shadow: 0 0 3px #000;
}

/* --- TACKLE BUTTON --- */
#tackle-button {
    position: absolute;
    bottom: 160px;
    right: 40px;
    width: 70px;
    height: 70px;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    justify-content: center;
    align-items: center;
    pointer-events: auto;
    z-index: 100;
    background: radial-gradient(circle at 35% 35%, #ff8888 0%, #cc0000 40%, #660000 80%, #220000 100%);
    border: 3px solid #ff4444;
    box-shadow: 0 0 15px rgba(255, 50, 50, 0.6), inset 0 0 15px rgba(255, 200, 200, 0.3);
    transition: transform 0.1s, filter 0.2s;
}

#tackle-button:active {
    transform: scale(0.9);
    filter: brightness(1.2);
}

#tackle-button.active {
    background: radial-gradient(circle at 35% 35%, #ffffff 0%, #ff4444 40%, #aa0000 80%, #440000 100%);
    box-shadow: 0 0 25px rgba(255, 100, 100, 0.9);
}

#tackle-button .btn-text {
    font-family: var(--font-data);
    font-size: 12px;
    font-weight: bold;
    color: white;
    text-shadow: 0 1px 2px rgba(0,0,0,0.8);
    pointer-events: none;
    text-transform: uppercase;
    letter-spacing: 1px;
}

#tackle-button .btn-glare {
    position: absolute;
    top: -50%; left: -50%;
    width: 200%; height: 200%;
    background: linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.3) 50%, transparent 60%);
    pointer-events: none;
    border-radius: 50%;
    animation: glarePass 4s infinite;
}

/* --- CHARGE POWER METER --- */
#tackle-button.urgent {
    animation: urgentPulse 0.5s infinite alternate;
    background: radial-gradient(circle at 35% 35%, #ff5555 0%, #ff0000 40%, #880000 100%);
    border-color: #ffaaaa;
    box-shadow: 0 0 20px #ff0000;
}

@keyframes urgentPulse {
    from { transform: scale(1.0); }
    to { transform: scale(1.15); }
}

/* --- CHARGE POWER METER --- */
#charge-meter-container {
    position: absolute;
    bottom: 250px;
    left: 50%;
    transform: translateX(-50%);
    width: 200px;
    display: none;
    flex-direction: column;
    align-items: center;
    pointer-events: none;
    z-index: 2000;
    background: rgba(0, 10, 30, 0.8);
    padding: 10px 15px;
    border: 1px solid var(--ffx-cyan);
    border-radius: 5px;
    box-shadow: 0 0 15px rgba(0, 100, 255, 0.3);
}

.charge-label {
    font-family: var(--font-data);
    font-size: 12px;
    color: var(--ffx-cyan);
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-bottom: 5px;
}

.charge-meter-track {
    width: 100%;
    height: 12px;
    background: rgba(0, 0, 0, 0.6);
    border: 1px solid #444;
    border-radius: 6px;
    overflow: hidden;
}

#charge-meter-fill {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #0af, #0f0);
    box-shadow: 0 0 10px #0f0;
    transition: width 0.05s linear, background 0.1s;
    border-radius: 5px;
}

.charge-hint {
    font-family: var(--font-ui);
    font-size: 10px;
    color: var(--ffx-gold);
    margin-top: 5px;
    opacity: 0.8;
    animation: blink 0.5s infinite;
}

/* --- GOAL DISTANCE INDICATOR --- */
#goal-distance-container {
    position: absolute;
    top: 75px;
    left: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    pointer-events: none;
    z-index: 100;
    background: linear-gradient(90deg, rgba(0, 10, 30, 0.7) 0%, transparent 100%);
    padding: 5px 15px 5px 10px;
    border-left: 2px solid var(--ffx-gold);
}

.distance-label {
    font-family: var(--font-ui);
    font-size: 8px;
    color: var(--ffx-gold);
    letter-spacing: 2px;
    text-transform: uppercase;
}

#goal-distance {
    font-family: var(--font-data);
    font-size: 24px;
    color: white;
    text-shadow: 0 0 5px var(--ffx-gold);
}

/* --- SETTINGS BUTTON --- */
#settings-button {
    position: absolute;
    top: 240px;
    right: 20px;
    width: 110px;
    padding: 8px 0;
    text-align: center;
    font-size: 10px;
    font-weight: bold;
    color: #888;
    background: linear-gradient(135deg, rgba(20, 20, 20, 0.8) 0%, rgba(10, 10, 10, 0.9) 100%);
    border: 1px solid #444;
    border-radius: 4px;
    cursor: pointer;
    text-transform: uppercase;
    letter-spacing: 1px;
    pointer-events: auto;
    transition: all 0.2s;
    z-index: 100;
}

#settings-button:hover {
    background: rgba(40, 40, 40, 0.9);
    border-color: #888;
    color: #fff;
}

/* --- SETTINGS PANEL --- */
#settings-panel {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 280px;
    background: linear-gradient(160deg, rgba(0, 20, 50, 0.98) 0%, rgba(0, 10, 20, 0.99) 100%);
    border: 2px solid var(--ffx-cyan);
    border-radius: 10px;
    box-shadow: 0 0 30px rgba(0, 100, 255, 0.4);
    z-index: 3500;
    pointer-events: auto;
    backdrop-filter: blur(10px);
}

.settings-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    border-bottom: 1px solid rgba(100, 200, 255, 0.3);
    background: rgba(0, 30, 60, 0.5);
}

.settings-header span {
    font-family: var(--font-title);
    font-size: 20px;
    color: white;
    text-shadow: 0 0 5px var(--ffx-cyan);
    letter-spacing: 3px;
}

#settings-close {
    width: 30px;
    height: 30px;
    border: 1px solid #ff4444;
    background: rgba(50, 0, 0, 0.5);
    color: #ff4444;
    font-size: 14px;
    cursor: pointer;
    border-radius: 5px;
    transition: all 0.2s;
}

#settings-close:hover {
    background: #ff4444;
    color: white;
}

.settings-content {
    padding: 20px;
}

.setting-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding: 10px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 5px;
}

.setting-row label {
    font-family: var(--font-data);
    font-size: 14px;
    color: #ccc;
}

.setting-row input[type="range"] {
    width: 100px;
    accent-color: var(--ffx-cyan);
}

.setting-row input[type="checkbox"] {
    width: 20px;
    height: 20px;
    accent-color: var(--ffx-cyan);
    cursor: pointer;
}

/* --- GLARE ANIMATION --- */
@keyframes glarePass {
    0% { transform: translateX(-100%) rotate(45deg); }
    30% { transform: translateX(100%) rotate(45deg); }
    100% { transform: translateX(100%) rotate(45deg); }
}

/* --- STATUS TYPE FLOATING TEXT --- */
.floating-text-inner.status {
    font-family: var(--font-data);
    font-size: 28px;
    font-style: italic;
    color: #ff00ff;
    text-shadow: 0 0 10px #ff00ff, 2px 2px 0 #000;
    animation: statusPop 1.2s ease-out forwards;
}

@keyframes statusPop {
    0% { transform: scale(0.5) translateY(0); opacity: 0; }
    20% { transform: scale(1.3) translateY(-10px); opacity: 1; }
    100% { transform: scale(1.0) translateY(-40px); opacity: 0; }
}

/* --- GOAL TYPE FLOATING TEXT --- */
.floating-text-inner.goal {
    font-family: var(--font-data);
    font-size: 48px;
    font-weight: 900;
    background: linear-gradient(to bottom, #fff 0%, #ffd700 50%, #ff8800 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    filter: drop-shadow(0 4px 4px rgba(0,0,0,0.9));
    animation: goalPop 1s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

@keyframes goalPop {
    0% { transform: scale(0) rotate(-10deg); opacity: 0; }
    50% { transform: scale(1.5) rotate(5deg); opacity: 1; }
    100% { transform: scale(1.2) rotate(0deg); opacity: 0; }
}

/* --- DEFAULT TYPE FLOATING TEXT --- */
.floating-text-inner.default {
    font-family: var(--font-data);
    font-size: 24px;
    color: white;
    text-shadow: 0 2px 4px rgba(0,0,0,0.8);
animation: floatUp 0.8s ease-out forwards;
}

/* --- VERSUS CLASH TEXT --- */
/* --- VERSUS CLASH TEXT REMOVED --- */</style>

    <!-- Three.js Core -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- GLTFLoader -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/utils/SkeletonUtils.js"></script>
    <!-- Lil-GUI -->
    <script src="https://cdn.jsdelivr.net/npm/lil-gui@0.19.1/dist/lil-gui.umd.min.js"></script>
<script type="importmap">{"imports":{"style.css":"data:text/css;base64,OnJvb3QgewogICAgLS1mZngtYmx1ZS1kZWVwOiAjMDIwNDA4OwogICAgLS1mZngtYmx1ZS1kYXJrOiAjMGExNTI1OwogICAgLS1mZngtYmx1ZS1taWQ6ICMxNTJhNDU7CiAgICAtLWZmeC1ibHVlLWxpZ2h0OiAjMmE0ZDc1OwogICAgLS1mZngtY3lhbjogIzYwYzBkMDsKICAgIC0tZmZ4LWN5YW4tZ2xvdzogIzAwZmZmZjsKICAgIC0tZmZ4LWdvbGQ6ICNjOGIwNjA7CiAgICAtLWZmeC1nb2xkLWxpZ2h0OiAjZjBlMDkwOwogICAgLS1mZngtZ29sZC1kYXJrOiAjOGE3MDMwOwogICAgLS1mZngtZ2xhc3MtYmc6IHJnYmEoMTAsIDIwLCA0MCwgMC43NSk7CiAgICAtLWZmeC1nbGFzcy1ib3JkZXI6IHJnYmEoMTAwLCAyMDAsIDI1NSwgMC4zKTsKICAgIAogICAgLS1mb250LXRpdGxlOiAnR2FyYW1vbmQnLCAnVGltZXMgTmV3IFJvbWFuJywgc2VyaWY7CiAgICAtLWZvbnQtZGF0YTogJ0ltcGFjdCcsICdBcmlhbCBOYXJyb3cnLCBzYW5zLXNlcmlmOwogICAgLS1mb250LXVpOiAnQ291cmllciBOZXcnLCBtb25vc3BhY2U7Cn0KCmh0bWwsIGJvZHkgewogICAgbWFyZ2luOiAwOwogICAgcGFkZGluZzogMDsKICAgIGJhY2tncm91bmQtY29sb3I6ICMwMDA7CiAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgLyogRm9yY2UgZnVsbCB2aWV3cG9ydCBmaWxsICovCiAgICB3aWR0aDogMTAwdnc7CiAgICBoZWlnaHQ6IDEwMCU7CiAgICAvKiBGaXhlcyBtb2JpbGUgc2Nyb2xsIGJvdW5jZSBhbmQgbGF5b3V0IGlzc3VlcyAqLwogICAgcG9zaXRpb246IGZpeGVkOyAKICAgIHRvcDogMDsKICAgIGxlZnQ6IDA7CiAgICByaWdodDogMDsKICAgIGJvdHRvbTogMDsKICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LWRhdGEpOwogICAgY29sb3I6IHdoaXRlOwogICAgdXNlci1zZWxlY3Q6IG5vbmU7CiAgICAtd2Via2l0LXVzZXItc2VsZWN0OiBub25lOwogICAgLyogRW5zdXJlIG5vIHNhZmUtYXJlYSBnYXBzIG9uIG5vdGNoZWQgcGhvbmVzICovCiAgICBwYWRkaW5nLXRvcDogZW52KHNhZmUtYXJlYS1pbnNldC10b3ApOwogICAgcGFkZGluZy1ib3R0b206IGVudihzYWZlLWFyZWEtaW5zZXQtYm90dG9tKTsKICAgIHBhZGRpbmctbGVmdDogZW52KHNhZmUtYXJlYS1pbnNldC1sZWZ0KTsKICAgIHBhZGRpbmctcmlnaHQ6IGVudihzYWZlLWFyZWEtaW5zZXQtcmlnaHQpOwp9CgovKiAtLS0gTUFJTiBHQU1FIENPTlRBSU5FUiAtLS0gKi8KI2dhbWUtY29udGFpbmVyIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMDsKICAgIGxlZnQ6IDA7CiAgICB3aWR0aDogMTAwJTsKICAgIGhlaWdodDogMTAwJTsKICAgIG1heC13aWR0aDogbm9uZTsKICAgIGJhY2tncm91bmQ6ICMwMDA1MTA7CiAgICBib3gtc2hhZG93OiBub25lOwogICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgIHRyYW5zaXRpb246IGZpbHRlciAwLjA1czsKICAgIHotaW5kZXg6IDE7Cn0KCi8qIC0tLSBJTVBBQ1QgRlggKENocm9tYXRpYyBBYmVycmF0aW9uIC8gU2hvY2spIC0tLSAqLwojZ2FtZS1jb250YWluZXIuaW1wYWN0LWZ4IHsKICAgIGFuaW1hdGlvbjogaW1wYWN0U2hha2UgMC4xcyBlYXNlLWluLW91dDsKICAgIGZpbHRlcjogY29udHJhc3QoMS4yKSBicmlnaHRuZXNzKDEuMSk7Cn0KCiNnYW1lLWNvbnRhaW5lci5pbXBhY3QtaGVhdnkgewogICAgYW5pbWF0aW9uOiBpbXBhY3RTaGFrZSAwLjJzIGVhc2UtaW4tb3V0OwogICAgZmlsdGVyOiBjb250cmFzdCgxLjUpIGJyaWdodG5lc3MoMS4zKSBzZXBpYSgwLjQpIGh1ZS1yb3RhdGUoLTEwZGVnKTsKfQoKI2dhbWUtY29udGFpbmVyLmltcGFjdC1zaGF0dGVyIHsKICAgIGFuaW1hdGlvbjogaW1wYWN0U2hha2UgMC40cyBlYXNlLWluLW91dDsKICAgIGZpbHRlcjogY29udHJhc3QoMi4wKSBpbnZlcnQoMC4xKSBzYXR1cmF0ZSgyLjApOwp9CgpAa2V5ZnJhbWVzIGltcGFjdFNoYWtlIHsKICAgIDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoMCwgMCk7IH0KICAgIDI1JSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC01cHgsIDVweCk7IH0KICAgIDUwJSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKDVweCwgLTVweCk7IH0KICAgIDc1JSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC01cHgsIC01cHgpOyB9CiAgICAxMDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoMCwgMCk7IH0KfQoKLyogQXNwZWN0IFJhdGlvIGNvbnN0cmFpbnRzIHJlbW92ZWQgZm9yIGZ1bGwgc2NyZWVuICovCgovKiAtLS0gQ0FOVkFTICYgUkVOREVSIC0tLSAqLwpjYW52YXMgewogICAgZGlzcGxheTogYmxvY2s7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IDA7CiAgICBsZWZ0OiAwOwogICAgd2lkdGg6IDEwMCU7CiAgICBoZWlnaHQ6IDEwMCU7CiAgICAvKiBQU1gvUmV0cm8gRmVlbCAqLwogICAgaW1hZ2UtcmVuZGVyaW5nOiBwaXhlbGF0ZWQ7IAogICAgei1pbmRleDogMDsKfQoKLyogLS0tIEdMT0JBTCBPVkVSTEFZUyAoU2NhbmxpbmVzICYgVmlnbmV0dGUpIC0tLSAqLwojZ2FtZS1jb250YWluZXI6OmFmdGVyIHsKICAgIGNvbnRlbnQ6ICIiOwogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiAwOyBsZWZ0OiAwOyB3aWR0aDogMTAwJTsgaGVpZ2h0OiAxMDAlOwogICAgYmFja2dyb3VuZDogCiAgICAgICAgbGluZWFyLWdyYWRpZW50KHJnYmEoMTgsIDE2LCAxNiwgMCkgNTAlLCByZ2JhKDAsIDAsIDAsIDAuMSkgNTAlKSwKICAgICAgICByYWRpYWwtZ3JhZGllbnQoY2lyY2xlIGF0IGNlbnRlciwgdHJhbnNwYXJlbnQgNjAlLCByZ2JhKDAsMCwwLDAuNCkgMTAwJSk7CiAgICBiYWNrZ3JvdW5kLXNpemU6IDEwMCUgNHB4LCAxMDAlIDEwMCU7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgIHotaW5kZXg6IDkwMDsKICAgIG9wYWNpdHk6IDAuMDU7Cn0KCi8qIC0tLSBWSURFTyBPVkVSTEFZIC0tLSAqLwovKiAtLS0gR0lGIE9WRVJMQVkgLS0tICovCiNzY3JlZW4tb3ZlcmxheS1naWYgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiAwOyBsZWZ0OiAwOwogICAgd2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTsKICAgIG9iamVjdC1maXQ6IGNvdmVyOwptaXgtYmxlbmQtbW9kZTogc29mdC1saWdodDsKICAgIG9wYWNpdHk6IDAuNzI7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgIHotaW5kZXg6IDk1MDsKICAgIGltYWdlLXJlbmRlcmluZzogcGl4ZWxhdGVkOyAvKiBOZWFyZXN0IE5laWdoYm9yICovCn0KCiN1aS1sYXllciB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IDA7IGxlZnQ6IDA7IHdpZHRoOiAxMDAlOyBoZWlnaHQ6IDEwMCU7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOwogICAgei1pbmRleDogMTAwMDsKfQoKLyogLS0tIENJTkVNQVRJQyBCQVJTIC0tLSAqLwojY2luZW1hdGljLWJhcnMgLmJhciB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICBsZWZ0OiAwOyB3aWR0aDogMTAwJTsgaGVpZ2h0OiAwOwogICAgYmFja2dyb3VuZDogYmxhY2s7CiAgICB0cmFuc2l0aW9uOiBoZWlnaHQgMC41cyBlYXNlOwogICAgei1pbmRleDogODAwOwp9CiNjaW5lbWF0aWMtYmFycyAuYmFyLnRvcCB7IHRvcDogMDsgfQojY2luZW1hdGljLWJhcnMgLmJhci5ib3R0b20geyBib3R0b206IDA7IH0KCi8qIC0tLSBURUNIIEZMQVNIIE9WRVJMQVkgKFRlY2hjb3B5KSAtLS0gKi8KI3RlY2gtZmxhc2gtb3ZlcmxheSB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IDIwJTsgbGVmdDogMDsgd2lkdGg6IDEwMCU7IGhlaWdodDogMTIwcHg7CiAgICBkaXNwbGF5OiBub25lOyAvKiBUb2dnbGVkIGJ5IEpTICovCiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCByZ2JhKDAsMCwwLDApIDAlLCByZ2JhKDAsIDIwLCA2MCwgMC45KSAyMCUsIHJnYmEoMCwgMjAsIDYwLCAwLjkpIDgwJSwgcmdiYSgwLDAsMCwwKSAxMDAlKTsKICAgIHotaW5kZXg6IDIyMDA7CiAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoMnB4KTsKICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCByZ2JhKDEwMCwgMjU1LCAyNTUsIDAuMyk7CiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgcmdiYSgxMDAsIDI1NSwgMjU1LCAwLjMpOwogICAgYW5pbWF0aW9uOiBmbGFzaEVudGVyIDAuMTVzIGVhc2Utb3V0Owp9CgpAa2V5ZnJhbWVzIGZsYXNoRW50ZXIgewogICAgZnJvbSB7IHRyYW5zZm9ybTogc2NhbGVZKDApOyBvcGFjaXR5OiAwOyB9CiAgICB0byB7IHRyYW5zZm9ybTogc2NhbGVZKDEpOyBvcGFjaXR5OiAxOyB9Cn0KCi50ZWNoLWNvbnRlbnQtd3JhcHBlciB7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICB0cmFuc2Zvcm06IHNrZXdYKC0xMGRlZyk7Cn0KCi50ZWNoLXRleHQgewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtZGF0YSk7CiAgICBmb250LXNpemU6IGNsYW1wKDI4cHgsIDEwdncsIDQycHgpOyAvKiBEeW5hbWljICovCiAgICBjb2xvcjogI2ZmZmZmZjsKICAgIHRleHQtc2hhZG93OiAwIDAgMTBweCAjMDBmZmZmLCAwIDAgMjBweCAjMDAwMGZmOwogICAgbGV0dGVyLXNwYWNpbmc6IDNweDsKICAgIG1hcmdpbi1ib3R0b206IDJweDsKICAgIGZvbnQtc3R5bGU6IGl0YWxpYzsKICAgIGFuaW1hdGlvbjogYmxpbmtUZXh0IDAuMDhzIGluZmluaXRlIGFsdGVybmF0ZTsKICAgIHRleHQtYWxpZ246IGNlbnRlcjsKfQoKLnRlY2gtc3ViLXRleHQgewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtdWkpOwogICAgZm9udC1zaXplOiAxNHB4OwogICAgY29sb3I6ICMwMGZmZmY7CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgbGV0dGVyLXNwYWNpbmc6IDJweDsKICAgIG1hcmdpbi1ib3R0b206IDhweDsKICAgIHRleHQtc2hhZG93OiAwIDAgNXB4IHJnYmEoMCwgMjU1LCAyNTUsIDAuNSk7Cn0KCi50ZWNoLXRpbWVyLXRyYWNrIHsKICAgIHdpZHRoOiAyNTBweDsKICAgIGhlaWdodDogOHB4OwogICAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjYpOwogICAgYm9yZGVyOiAxcHggc29saWQgIzQ0NDsKICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICBib3gtc2hhZG93OiAwIDAgMTBweCByZ2JhKDAsMCwwLDAuNSk7Cn0KCi50ZWNoLXRpbWVyLWZpbGwgewogICAgaGVpZ2h0OiAxMDAlOwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjZmZmZmZmLCAjMDBmZmZmKTsKICAgIHdpZHRoOiAxMDAlOwogICAgdHJhbnNmb3JtLW9yaWdpbjogbGVmdDsKICAgIGJveC1zaGFkb3c6IDAgMCAxMHB4ICMwMGZmZmY7Cn0KCkBrZXlmcmFtZXMgYmxpbmtUZXh0IHsKICAgIGZyb20geyBvcGFjaXR5OiAwLjg7IHRleHQtc2hhZG93OiAwIDAgNXB4ICMwMGZmZmY7IHRyYW5zZm9ybTogc2NhbGUoMSk7IH0KICAgIHRvIHsgb3BhY2l0eTogMS4wOyB0ZXh0LXNoYWRvdzogMCAwIDIwcHggI2ZmZmZmZiwgMCAwIDEwcHggIzAwZmZmZjsgdHJhbnNmb3JtOiBzY2FsZSgxLjAyKTsgfQp9CgovKiAtLS0gSFVEIFRPUCAoVGhlIENyeXN0YWwgSW50ZXJmYWNlKSAtLS0gKi8KI2h1ZC10b3AgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiAwOwogICAgbGVmdDogMDsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgICBhbGlnbi1pdGVtczogZmxleC1zdGFydDsKICAgIHdpZHRoOiAxMDAlOwogICAgcGFkZGluZzogMTVweDsKICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQodG8gYm90dG9tLCByZ2JhKDAsIDUsIDE1LCAwLjkpIDAlLCByZ2JhKDAsMCwwLDApIDEwMCUpOwogICAgcG9pbnRlci1ldmVudHM6IG5vbmU7Cn0KCi8qIFRlYW0gV2luZ3MgKi8KLnRlYW0td2luZyB7CiAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgIHdpZHRoOiAxMzBweDsKICAgIGhlaWdodDogNTBweDsKICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxNjBkZWcsIHZhcigtLWZmeC1ibHVlLW1pZCkgMCUsIHZhcigtLWZmeC1ibHVlLWRlZXApIDEwMCUpOwogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tZmZ4LWJsdWUtbGlnaHQpOwogICAgYm9yZGVyLXRvcDogMnB4IHNvbGlkIHZhcigtLWZmeC1jeWFuKTsKICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgIHRyYW5zZm9ybTogc2tld1goLTE1ZGVnKTsKICAgIGJveC1zaGFkb3c6IDAgNXB4IDE1cHggcmdiYSgwLCAwLCAwLCAwLjUpOwogICAgcGFkZGluZzogMCAxMHB4Owp9CgoudGVhbS13aW5nLmF3YXkgewogICAgdHJhbnNmb3JtOiBza2V3WCgxNWRlZyk7CiAgICBmbGV4LWRpcmVjdGlvbjogcm93LXJldmVyc2U7CiAgICBib3JkZXItdG9wLWNvbG9yOiAjZmY2NjY2OyAvKiBSZWQgdGludCBmb3IgZW5lbXkgKi8KICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgtMTYwZGVnLCAjMmExMDEwIDAlLCAjMTAwNTA1IDEwMCUpOwp9CgoudGVhbS1kYXRhIHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICB0cmFuc2Zvcm06IHNrZXdYKDE1ZGVnKTsgLyogQ291bnRlciBza2V3ICovCn0KLnRlYW0td2luZy5hd2F5IC50ZWFtLWRhdGEgeyB0cmFuc2Zvcm06IHNrZXdYKC0xNWRlZyk7IHRleHQtYWxpZ246IHJpZ2h0OyB9CgoudGVhbS1uYW1lIHsKICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LXRpdGxlKTsKICAgIGZvbnQtc2l6ZTogMTRweDsKICAgIGNvbG9yOiB2YXIoLS1mZngtZ29sZC1saWdodCk7CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgbGV0dGVyLXNwYWNpbmc6IDFweDsKICAgIHRleHQtc2hhZG93OiAwIDJweCAycHggcmdiYSgwLDAsMCwwLjgpOwp9Ci50ZWFtLXN1YiB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC1kYXRhKTsKICAgIGZvbnQtc2l6ZTogMTBweDsKICAgIGNvbG9yOiB2YXIoLS1mZngtY3lhbik7CiAgICBvcGFjaXR5OiAwLjg7Cn0KLnRlYW0td2luZy5hd2F5IC50ZWFtLXN1YiB7IGNvbG9yOiAjZmZhYWFhOyB9Cgouc2NvcmUtYm94IHsKICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LWRhdGEpOwogICAgZm9udC1zaXplOiAzOHB4OwogICAgY29sb3I6IHdoaXRlOwogICAgdGV4dC1zaGFkb3c6IDAgMCAxMHB4IHZhcigtLWZmeC1jeWFuLWdsb3cpOwogICAgdHJhbnNmb3JtOiBza2V3WCgxNWRlZyk7CiAgICBtYXJnaW46IDAgMTBweDsKfQoudGVhbS13aW5nLmF3YXkgLnNjb3JlLWJveCB7IHRyYW5zZm9ybTogc2tld1goLTE1ZGVnKTsgdGV4dC1zaGFkb3c6IDAgMCAxMHB4ICNmZjQ0NDQ7IH0KCi8qIFRpbWVyIENvbXBsZXggKi8KLnRpbWVyLWNvbXBsZXggewogICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgZGlzcGxheTogZmxleDsKICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgbWFyZ2luLXRvcDogLTVweDsKfQoKLnRpbWVyLWNyeXN0YWwtcmluZyB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IC0yNXB4OwogICAgd2lkdGg6IDEyMHB4OwogICAgaGVpZ2h0OiA2MHB4OwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgYm9yZGVyLXRvcDogM3B4IHNvbGlkIHZhcigtLWZmeC1nb2xkKTsKICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCB0cmFuc3BhcmVudDsKICAgIGJveC1zaGFkb3c6IDAgLTVweCAxNXB4IHJnYmEoMjAwLCAxODAsIDEwMCwgMC4zKTsKICAgIHotaW5kZXg6IC0xOwogICAgYmFja2dyb3VuZDogcmFkaWFsLWdyYWRpZW50KGVsbGlwc2UgYXQgdG9wLCByZ2JhKDIwLCA0MCwgODAsIDAuOCksIHRyYW5zcGFyZW50IDcwJSk7Cn0KCiNoYWxmLWluZGljYXRvciB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC1kYXRhKTsKICAgIGZvbnQtc2l6ZTogMTBweDsKICAgIGNvbG9yOiB2YXIoLS1mZngtZ29sZCk7CiAgICBsZXR0ZXItc3BhY2luZzogMnB4OwogICAgbWFyZ2luLWJvdHRvbTogLTJweDsKICAgIHRleHQtc2hhZG93OiAwIDAgNXB4IHZhcigtLWZmeC1nb2xkLWRhcmspOwp9CgojdGltZXItZGlzcGxheSB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC1kYXRhKTsKICAgIGZvbnQtc2l6ZTogNDJweDsKICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCh0byBib3R0b20sICNmZmYgMCUsICNmZmQ3MDAgNTAlLCAjYjg4NjBiIDEwMCUpOwogICAgLXdlYmtpdC1iYWNrZ3JvdW5kLWNsaXA6IHRleHQ7CiAgICAtd2Via2l0LXRleHQtZmlsbC1jb2xvcjogdHJhbnNwYXJlbnQ7CiAgICBmaWx0ZXI6IGRyb3Atc2hhZG93KDJweCAycHggMHB4IHJnYmEoMCwwLDAsMC44KSk7CiAgICBsZXR0ZXItc3BhY2luZzogMXB4Owp9CgovKiAtLS0gUExBWUVSIFNUQVRVUyBQQU5FTCAoQm90dG9tIExlZnQpIC0tLSAqLwojcGxheWVyLXN0YXR1cy1wYW5lbCB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICBib3R0b206IDE2MHB4OyAvKiBBYm92ZSBqb3lzdGljayAqLwogICAgbGVmdDogMjBweDsKICAgIHdpZHRoOiAxNjBweDsKICAgIHBhZGRpbmc6IDEwcHg7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsIHJnYmEoMCwgMTAsIDMwLCAwLjgpIDAlLCByZ2JhKDAsMCwwLDApIDEwMCUpOwogICAgYm9yZGVyLWxlZnQ6IDNweCBzb2xpZCB2YXIoLS1mZngtY3lhbik7CiAgICBib3JkZXItcmFkaXVzOiAwIDEwcHggMTBweCAwOwogICAgYmFja2Ryb3AtZmlsdGVyOiBibHVyKDRweCk7CiAgICB0cmFuc2Zvcm06IHNrZXdYKC0xMGRlZyk7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgIGRpc3BsYXk6IG5vbmU7IC8qIEhpZGRlbiBieSBkZWZhdWx0LCBzaG93biBieSBKUyAqLwp9CgouY2hhci1uYW1lIHsKICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LXRpdGxlKTsKICAgIGZvbnQtc2l6ZTogMThweDsKICAgIGNvbG9yOiB3aGl0ZTsKICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICBtYXJnaW4tYm90dG9tOiA1cHg7CiAgICB0cmFuc2Zvcm06IHNrZXdYKDEwZGVnKTsKICAgIHRleHQtc2hhZG93OiAwIDAgNXB4IHZhcigtLWZmeC1ibHVlLWxpZ2h0KTsKfQoKLmhwLWdhdWdlLWNvbnRhaW5lciB7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgIG1hcmdpbi1ib3R0b206IDRweDsKICAgIHRyYW5zZm9ybTogc2tld1goMTBkZWcpOwp9Ci5ocC1sYWJlbCB7IGZvbnQtc2l6ZTogMTBweDsgY29sb3I6IHZhcigtLWZmeC1jeWFuKTsgd2lkdGg6IDIwcHg7IH0KLmhwLWJhci10cmFjayB7CiAgICBmbGV4LWdyb3c6IDE7CiAgICBoZWlnaHQ6IDZweDsKICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC41KTsKICAgIGJvcmRlcjogMXB4IHNvbGlkICM0NDQ7CiAgICBtYXJnaW46IDAgNXB4Owp9Ci5ocC1iYXItZmlsbCB7CiAgICBoZWlnaHQ6IDEwMCU7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsICMwMGZmMDAsICNjY2ZmY2MpOwogICAgYm94LXNoYWRvdzogMCAwIDVweCAjMDBmZjAwOwp9Ci5ocC12YWx1ZSB7IGZvbnQtc2l6ZTogMTBweDsgY29sb3I6ICNmZmY7IHdpZHRoOiA0NXB4OyB0ZXh0LWFsaWduOiByaWdodDsgfQoKLnRlY2gtZ2F1Z2UtY29udGFpbmVyIHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgdHJhbnNmb3JtOiBza2V3WCgxMGRlZyk7Cn0KLnRlY2gtbGFiZWwgeyBmb250LXNpemU6IDEwcHg7IGNvbG9yOiB2YXIoLS1mZngtZ29sZCk7IHdpZHRoOiAyMHB4OyB9Ci50ZWNoLWJhci10cmFjayB7CiAgICBmbGV4LWdyb3c6IDE7CiAgICBoZWlnaHQ6IDRweDsKICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC41KTsKICAgIGJvcmRlcjogMXB4IHNvbGlkICM0NDQ7CiAgICBtYXJnaW46IDAgNXB4Owp9Ci50ZWNoLWJhci1maWxsIHsKICAgIGhlaWdodDogMTAwJTsKICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCg5MGRlZywgI2ZmYWEwMCwgI2ZmZmZhYSk7Cn0KCi8qIC0tLSBNSU5JTUFQIChTcGhlcmUgUmFkYXIpIC0tLSAqLwojbWluaW1hcC1jb250YWluZXIgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiA4MHB4OwogICAgcmlnaHQ6IDIwcHg7CiAgICB3aWR0aDogMTEwcHg7CiAgICBoZWlnaHQ6IDExMHB4OwogICAgZGlzcGxheTogZmxleDsKICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKfQoKLnJhZGFyLXJpbSB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB3aWR0aDogMTAwJTsgaGVpZ2h0OiAxMDAlOwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgYm9yZGVyOiAycHggc29saWQgdmFyKC0tZmZ4LWJsdWUtbGlnaHQpOwogICAgYm94LXNoYWRvdzogMCAwIDE1cHggdmFyKC0tZmZ4LWJsdWUtbWlkKSwgaW5zZXQgMCAwIDIwcHggcmdiYSgwLDAsMCwwLjgpOwogICAgYmFja2dyb3VuZDogcmFkaWFsLWdyYWRpZW50KGNpcmNsZSwgcmdiYSgwLCAyMCwgNjAsIDAuNCkgMCUsIHJnYmEoMCwgNSwgMTAsIDAuOCkgMTAwJSk7CiAgICB6LWluZGV4OiA1Owp9CgojbWluaW1hcCB7CiAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICB3aWR0aDogMTAwcHg7CiAgICBoZWlnaHQ6IDEwMHB4OwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgei1pbmRleDogNjsKICAgIG92ZXJmbG93OiBoaWRkZW47Cn0KCi5yYWRhci1sYWJlbCB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICBib3R0b206IC0xNXB4OwogICAgd2lkdGg6IDEwMCU7CiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICBmb250LXNpemU6IDlweDsKICAgIGNvbG9yOiB2YXIoLS1mZngtY3lhbik7CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgbGV0dGVyLXNwYWNpbmc6IDFweDsKICAgIHRleHQtc2hhZG93OiAwIDAgNXB4IHZhcigtLWZmeC1jeWFuKTsKfQoKLyogTWFwIERvdHMgKi8KLm1hcC1kb3QgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgd2lkdGg6IDZweDsgaGVpZ2h0OiA2cHg7CiAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKTsgLyogQ2VudGVyIGFuY2hvciAqLwogICAgYm94LXNoYWRvdzogMCAwIDRweCBjdXJyZW50Q29sb3I7Cn0KLm1hcC1kb3QuaG9tZSB7IGJhY2tncm91bmQ6IHZhcigtLWZmeC1jeWFuKTsgY29sb3I6IHZhcigtLWZmeC1jeWFuKTsgfQoubWFwLWRvdC5hd2F5IHsgYmFja2dyb3VuZDogI2ZmNDQ0NDsgY29sb3I6ICNmZjQ0NDQ7IH0KLm1hcC1kb3QuYmFsbCB7IAogICAgYmFja2dyb3VuZDogI2ZmMDBjYzsgLyogSG90IFBpbmsgZm9yIHZpc2liaWxpdHkgKi8KICAgIGNvbG9yOiAjZmYwMGNjOyAKICAgIHdpZHRoOiAxMnB4OyBoZWlnaHQ6IDEycHg7CiAgICBib3JkZXI6IDJweCBzb2xpZCAjZmZmZmZmOwogICAgei1pbmRleDogMjA7CiAgICBhbmltYXRpb246IGJsaW5rQmFsbCAwLjNzIGluZmluaXRlIGFsdGVybmF0ZTsKICAgIGJveC1zaGFkb3c6IDAgMCA2cHggI2ZmMDBjYzsKfQoubWFwLWRvdC5uYXAgeyBiYWNrZ3JvdW5kOiAjMzMzOyBjb2xvcjogIzAwMDsgYm9yZGVyOiAxcHggc29saWQgIzU1NTsgfQoubWFwLWRvdC5hY3RpdmUtcGxheWVyIHsgCiAgICBiYWNrZ3JvdW5kOiAjMDBmZjAwICFpbXBvcnRhbnQ7IAogICAgY29sb3I6ICMwMGZmMDAgIWltcG9ydGFudDsgCiAgICBib3gtc2hhZG93OiAwIDAgOHB4ICMwMGZmMDA7CiAgICB6LWluZGV4OiAxNTsKdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSkgc2NhbGUoMS4yKTsKfQoKLm1hcC1kb3QuYmFsbC1jYXJyaWVyIHsKICAgIGJveC1zaGFkb3c6IDAgMCAxNXB4ICNmZmYsIDAgMCAzMHB4ICNmZmFhMDA7CiAgICBib3JkZXI6IDJweCBzb2xpZCAjZmZmZmZmOwogICAgYmFja2dyb3VuZC1jb2xvcjogI2ZmYWEwMCAhaW1wb3J0YW50OwogICAgei1pbmRleDogMTAwOwogICAgd2lkdGg6IDEwcHg7IGhlaWdodDogMTBweDsgLyogU2xpZ2h0bHkgbGFyZ2VyICovCiAgICBhbmltYXRpb246IGNhcnJpZXJQdWxzZSAwLjhzIGluZmluaXRlIGFsdGVybmF0ZTsKfQpAa2V5ZnJhbWVzIGNhcnJpZXJQdWxzZSB7CiAgICBmcm9tIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSkgc2NhbGUoMS4yKTsgYm94LXNoYWRvdzogMCAwIDEwcHggI2ZmZjsgb3BhY2l0eTogMC44OyB9CiAgICB0byB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpIHNjYWxlKDEuOCk7IGJveC1zaGFkb3c6IDAgMCAyNXB4ICNmZmNjMDA7IG9wYWNpdHk6IDEuMDsgfQp9CkBrZXlmcmFtZXMgYmxpbmtCYWxsIHsgZnJvbSB7IG9wYWNpdHk6IDE7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpIHNjYWxlKDEpOyB9IHRvIHsgb3BhY2l0eTogMC41OyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKSBzY2FsZSgxLjMpOyB9IH0KCi8qIC0tLSBBTk5PVU5DRU1FTlRTIChHb2FsLCBCbGl0em9mZikgLS0tICovCiNhbm5vdW5jZW1lbnQgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiA0MCU7IAogICAgbGVmdDogNSU7IAogICAgd2lkdGg6IDkwJTsKICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LWRhdGEpOwogICAgZm9udC1zaXplOiBjbGFtcCg0MHB4LCAxMnZ3LCA3MnB4KTsgLyogRHluYW1pYyBzaXppbmcgKi8KICAgIGZvbnQtd2VpZ2h0OiA5MDA7CiAgICBmb250LXN0eWxlOiBpdGFsaWM7CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgbGV0dGVyLXNwYWNpbmc6IDJweDsgLyogUmVkdWNlZCBzcGFjaW5nIHRvIGZpdCAqLwogICAgbGluZS1oZWlnaHQ6IDEuMDsKICAgIHdoaXRlLXNwYWNlOiBub3JtYWw7IC8qIEFsbG93IHdyYXBwaW5nICovCiAgICAKICAgIC8qIE1ldGFsbGljIEdvbGQgR3JhZGllbnQgKi8KICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCh0byBib3R0b20sICNmZmYgMCUsICNmZmQ3MDAgNDAlLCAjYjg4NjBiIDEwMCUpOwogICAgLXdlYmtpdC1iYWNrZ3JvdW5kLWNsaXA6IHRleHQ7CiAgICAtd2Via2l0LXRleHQtZmlsbC1jb2xvcjogdHJhbnNwYXJlbnQ7CiAgICBmaWx0ZXI6IGRyb3Atc2hhZG93KDAgMCAxMHB4IHJnYmEoMjU1LCAxMDAsIDAsIDAuNSkpIGRyb3Atc2hhZG93KDNweCAzcHggMCAjMDAwKTsKICAgIAogICAgZGlzcGxheTogbm9uZTsKICAgIHotaW5kZXg6IDIwMDA7CiAgICBhbmltYXRpb246IGFubm91bmNlU2xpZGUgMC41cyBjdWJpYy1iZXppZXIoMC4xNzUsIDAuODg1LCAwLjMyLCAxLjI3NSk7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsgLyogQ2xpY2sgdGhyb3VnaCAqLwp9CgpAa2V5ZnJhbWVzIGFubm91bmNlU2xpZGUgewogICAgZnJvbSB7IHRyYW5zZm9ybTogc2NhbGUoMCkgcm90YXRlKC01ZGVnKTsgb3BhY2l0eTogMDsgfQogICAgdG8geyB0cmFuc2Zvcm06IHNjYWxlKDEpIHJvdGF0ZSgwZGVnKTsgb3BhY2l0eTogMTsgfQp9CgovKiAtLS0gQ09OVFJPTFMgKFNQSEVSRSBHUklEIEFSVElGQUNUUykgLS0tICovCgovKiBKb3lzdGljazogVGhlIE5hdmlnYXRpb24gU3BoZXJlICovCi8qIC0tLSBKT1lTVElDSyAoRkxPQVRJTkcpIC0tLSAqLwojam95c3RpY2staGl0LXpvbmUgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgYm90dG9tOiAwOyBsZWZ0OiAwOwogICAgd2lkdGg6IDUwJTsgaGVpZ2h0OiA1MCU7CiAgICB6LWluZGV4OiAxMDAwOwogICAgLyogdHJhbnNwYXJlbnQgYnV0IGludGVyYWN0aXZlICovCiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDApOyAKICAgIHRvdWNoLWFjdGlvbjogbm9uZTsKICAgIHBvaW50ZXItZXZlbnRzOiBhdXRvOwp9Cgojam95c3RpY2stdmlzdWFsLWNvbnRhaW5lciB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IDA7IGxlZnQ6IDA7CiAgICB3aWR0aDogMDsgaGVpZ2h0OiAwOwogICAgb3ZlcmZsb3c6IHZpc2libGU7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgIGRpc3BsYXk6IG5vbmU7IC8qIEhpZGRlbiB1bnRpbCB0b3VjaGVkICovCiAgICB6LWluZGV4OiAxMTAwOwp9Cgojam95c3RpY2stYmFzZSB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IDUwJTsgbGVmdDogNTAlOwogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSk7CiAgICB3aWR0aDogMTIwcHg7IGhlaWdodDogMTIwcHg7CiAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICAKICAgIC8qIEdsYXNzeSBCYXNlICovCiAgICBiYWNrZ3JvdW5kOiByYWRpYWwtZ3JhZGllbnQoY2lyY2xlLCByZ2JhKDAsIDQwLCA4MCwgMC40KSAwJSwgcmdiYSgwLCAxMCwgMjAsIDAuMSkgNjAlLCB0cmFuc3BhcmVudCAxMDAlKTsKICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMTAwLCAyMjAsIDI1NSwgMC4zKTsKICAgIGJveC1zaGFkb3c6IDAgMCAyMHB4IHJnYmEoMCwgMTAwLCAyNTUsIDAuMiksIGluc2V0IDAgMCAzMHB4IHJnYmEoMCwgNTAsIDEwMCwgMC4zKTsKICAgIAogICAgYW5pbWF0aW9uOiBiYXNlUHVsc2UgMnMgaW5maW5pdGUgYWx0ZXJuYXRlOwp9CgpAa2V5ZnJhbWVzIGJhc2VQdWxzZSB7CiAgICBmcm9tIHsgYm94LXNoYWRvdzogMCAwIDEwcHggcmdiYSgwLCAxMDAsIDI1NSwgMC4yKTsgYm9yZGVyLWNvbG9yOiByZ2JhKDEwMCwgMjIwLCAyNTUsIDAuMik7IH0KICAgIHRvIHsgYm94LXNoYWRvdzogMCAwIDI1cHggcmdiYSgwLCAxMDAsIDI1NSwgMC41KTsgYm9yZGVyLWNvbG9yOiByZ2JhKDEwMCwgMjU1LCAyNTUsIDAuNik7IH0KfQoKI2pveXN0aWNrLWtub2IgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiA1MCU7IGxlZnQ6IDUwJTsKICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpOyAvKiBDZW50ZXJlZCBpbml0aWFsbHksIG1vdmVkIGJ5IEpTICovCiAgICB3aWR0aDogNTBweDsgaGVpZ2h0OiA1MHB4OwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgCiAgICAvKiBTcGhlcmUgTG9vazogQ3lhbi9CbHVlICovCiAgICBiYWNrZ3JvdW5kOiByYWRpYWwtZ3JhZGllbnQoY2lyY2xlIGF0IDMwJSAzMCUsICNlMGZmZmYgMCUsICMwMGFhZmYgNDAlLCAjMDA0NDg4IDgwJSwgIzAwMTEyMiAxMDAlKTsKICAgIGJvcmRlcjogMnB4IHNvbGlkICM4OGNjZmY7CiAgICBib3gtc2hhZG93OiAwIDAgMTVweCAjMDBmZmZmLCBpbnNldCAwIDAgMTBweCByZ2JhKDI1NSwyNTUsMjU1LDAuOCk7CiAgICAKICAgIHRyYW5zaXRpb246IHRyYW5zZm9ybSAwLjA1cyBsaW5lYXI7Cn0KCi8qIElubmVyIGxpZ2h0IG9mIGtub2IgKi8KI2pveXN0aWNrLWtub2I6OmFmdGVyIHsKICAgIGNvbnRlbnQ6ICIiOwogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiAyMCU7IGxlZnQ6IDIwJTsgd2lkdGg6IDIwJTsgaGVpZ2h0OiAyMCU7CiAgICBiYWNrZ3JvdW5kOiByYWRpYWwtZ3JhZGllbnQoY2lyY2xlLCAjZmZmZmZmIDAlLCB0cmFuc3BhcmVudCA3MCUpOwogICAgZmlsdGVyOiBibHVyKDJweCk7CiAgICBvcGFjaXR5OiAwLjg7Cn0KCi8qIC0tLSBUT1VDSCBSSVBQTEUgRlggLS0tICovCi50b3VjaC1yaXBwbGUgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgYmFja2dyb3VuZDogcmFkaWFsLWdyYWRpZW50KGNpcmNsZSwgcmdiYSgyMDAsIDI1NSwgMjU1LCAwLjgpIDAlLCByZ2JhKDAsIDI1NSwgMjU1LCAwLjQpIDQwJSwgdHJhbnNwYXJlbnQgNzAlKTsKICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpIHNjYWxlKDApOwogICAgYW5pbWF0aW9uOiByaXBwbGVBbmltIDAuNnMgZWFzZS1vdXQgZm9yd2FyZHM7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgIHotaW5kZXg6IDkwMDA7CiAgICBtaXgtYmxlbmQtbW9kZTogc2NyZWVuOwp9CgpAa2V5ZnJhbWVzIHJpcHBsZUFuaW0gewogICAgMCUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKSBzY2FsZSgwKTsgb3BhY2l0eTogMTsgfQogICAgMTAwJSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpIHNjYWxlKDMuMCk7IG9wYWNpdHk6IDA7IH0KfQoKI2NhbWVyYS16b25lIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMDsgcmlnaHQ6IDA7IHdpZHRoOiA1MCU7IGhlaWdodDogMTAwJTsKICAgIHBvaW50ZXItZXZlbnRzOiBhdXRvOwogICAgdG91Y2gtYWN0aW9uOiBub25lOwogICAgei1pbmRleDogNTA7Cn0KCi8qIC0tLSBBQ1RJT04gQlVUVE9OIChUSEUgTElNSVQgU1BIRVJFKSAtLS0gKi8KI2FjdGlvbi1jb250YWluZXIgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgYm90dG9tOiA0MHB4OyByaWdodDogNDBweDsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgIHBvaW50ZXItZXZlbnRzOiBhdXRvOwogICAgei1pbmRleDogMTAwOwp9CgouY29tbWFuZC1tZW51LWJnIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHdpZHRoOiAxODBweDsgaGVpZ2h0OiA4MHB4OwogICAgYm90dG9tOiAxNXB4OwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCB0cmFuc3BhcmVudCAwJSwgcmdiYSgwLCAxMCwgMzAsIDAuOCkgNTAlLCB0cmFuc3BhcmVudCAxMDAlKTsKICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCByZ2JhKDAsIDIwMCwgMjU1LCAwLjMpOwogICAgei1pbmRleDogLTE7Cn0KCi5jb21tYW5kLXJpbmcgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiA1MCU7IGxlZnQ6IDUwJTsKICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpOwogICAgd2lkdGg6IDEzMHB4OyBoZWlnaHQ6IDEzMHB4OwogICAgYm9yZGVyOiAycHggc29saWQgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjEpOwogICAgYm9yZGVyLXRvcDogMnB4IHNvbGlkIHJnYmEoMCwgMjU1LCAyNTUsIDAuNik7CiAgICBib3JkZXItYm90dG9tOiAycHggc29saWQgcmdiYSgwLCAyNTUsIDI1NSwgMC42KTsKICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgIGFuaW1hdGlvbjogc3BpblJldmVyc2UgMTVzIGxpbmVhciBpbmZpbml0ZTsKICAgIHBvaW50ZXItZXZlbnRzOiBub25lOwogICAgYm94LXNoYWRvdzogMCAwIDE1cHggcmdiYSgwLCAxMDAsIDI1NSwgMC4yKTsKfQpAa2V5ZnJhbWVzIHNwaW5SZXZlcnNlIHsgZnJvbSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpIHJvdGF0ZSgzNjBkZWcpOyB9IHRvIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSkgcm90YXRlKDBkZWcpOyB9IH0KCiNhY3Rpb24tbGFiZWwgewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtZGF0YSk7CiAgICBmb250LXNpemU6IDEycHg7CiAgICBjb2xvcjogdmFyKC0tZmZ4LWN5YW4pOwogICAgYmFja2dyb3VuZDogcmdiYSgwLCA1LCAxMCwgMC44KTsKICAgIHBhZGRpbmc6IDRweCAxMnB4OwogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tZmZ4LWJsdWUtbGlnaHQpOwogICAgYm9yZGVyLXJhZGl1czogMTBweDsKICAgIG1hcmdpbi1ib3R0b206IDE1cHg7CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgbGV0dGVyLXNwYWNpbmc6IDJweDsKICAgIGJveC1zaGFkb3c6IDAgMCAxMHB4IHJnYmEoMCwwLDAsMC44KTsKICAgIHRleHQtc2hhZG93OiAwIDAgNXB4IHZhcigtLWZmeC1jeWFuKTsKICAgIHRyYW5zaXRpb246IGFsbCAwLjNzOwp9CgojYWN0aW9uLWJ1dHRvbiB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IDA7IGxlZnQ6IDA7CiAgICB3aWR0aDogMTAwcHg7IGhlaWdodDogMTAwcHg7CiAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gMC4xcywgZmlsdGVyIDAuM3M7CiAgICAKICAgIC8qIERlZmF1bHQ6IFN3aW0gTW9kZSAoQmx1ZSBTcGhlcmUpICovCiAgICBiYWNrZ3JvdW5kOiByYWRpYWwtZ3JhZGllbnQoY2lyY2xlIGF0IDM1JSAzNSUsICNmZmZmZmYgMCUsICMwMDg4ZmYgNDAlLCAjMDAyMjY2IDgwJSwgIzAwMCAxMDAlKTsKICAgIGJvcmRlcjogM3B4IHNvbGlkICM0NGFhZmY7CiAgICBib3gtc2hhZG93OiAKICAgICAgICAwIDAgMjBweCByZ2JhKDAsIDEwMCwgMjU1LCAwLjgpLAogICAgICAgIGluc2V0IDAgMCAyMHB4IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC40KTsKICAgICAgICAKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICBvdmVyZmxvdzogdmlzaWJsZTsgLyogQWxsb3cgcmluZyB0byBwdWxzZSBvdXQgKi8KICAgIHotaW5kZXg6IDEwOwp9CgojcGFzcy1idXR0b24gewogICAgZGlzcGxheTogbm9uZSAhaW1wb3J0YW50OyAvKiBIaWRkZW4gYXMgcGVyIHVzZXIgcmVxdWVzdCAqLwogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgYm90dG9tOiAtMjBweDsgbGVmdDogLTMwcHg7CiAgICB3aWR0aDogNjBweDsgaGVpZ2h0OiA2MHB4OwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgY3Vyc29yOiBwb2ludGVyOwogICAgei1pbmRleDogOTsKfQoKI3Bhc3MtYnV0dG9uOmFjdGl2ZSB7IHRyYW5zZm9ybTogc2NhbGUoMC45Mik7IH0KI3Bhc3MtYnV0dG9uLnZpc2libGUgeyBkaXNwbGF5OiBmbGV4OyBhbmltYXRpb246IHBvcEluIDAuM3MgY3ViaWMtYmV6aWVyKDAuMTc1LCAwLjg4NSwgMC4zMiwgMS4yNzUpOyB9CgpAa2V5ZnJhbWVzIHBvcEluIHsKICAgIGZyb20geyB0cmFuc2Zvcm06IHNjYWxlKDApOyBvcGFjaXR5OiAwOyB9CiAgICB0byB7IHRyYW5zZm9ybTogc2NhbGUoMSk7IG9wYWNpdHk6IDE7IH0KfQoKI3Bhc3MtYnV0dG9uIC5idG4tdGV4dCB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC1kYXRhKTsKICAgIGZvbnQtc2l6ZTogMTRweDsKICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgY29sb3I6IHdoaXRlOwogICAgdGV4dC1zaGFkb3c6IDAgMXB4IDJweCByZ2JhKDAsMCwwLDAuOCk7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKfQoKI3Bhc3MtYnV0dG9uIC5idG4tZ2xhcmUgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiAtNTAlOyBsZWZ0OiAtNTAlOyB3aWR0aDogMjAwJTsgaGVpZ2h0OiAyMDAlOwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDQ1ZGVnLCB0cmFuc3BhcmVudCA0MCUsIHJnYmEoMjU1LDI1NSwyNTUsMC4zKSA1MCUsIHRyYW5zcGFyZW50IDYwJSk7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKfQoKLyogRXhwYW5kZWQgSGl0IEFyZWEgKEludmlzaWJsZSkgKi8KI2FjdGlvbi1idXR0b246OmJlZm9yZSB7CiAgICBjb250ZW50OiAnJzsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogLTQwcHg7IGxlZnQ6IC00MHB4OyByaWdodDogLTQwcHg7IGJvdHRvbTogLTQwcHg7CiAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICB6LWluZGV4OiAxMDsKICAgIC8qIERlYnVnOiBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwgMCwgMCwgMC4yKTsgKi8KfQoKI2FjdGlvbi1idXR0b246YWN0aXZlIHsgdHJhbnNmb3JtOiBzY2FsZSgwLjkyKTsgfQoKLyogVGV4dCBpbnNpZGUgYnV0dG9uICovCiNhY3Rpb24tYnV0dG9uIC5idG4tdGV4dCB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC10aXRsZSk7CiAgICBmb250LXNpemU6IDIycHg7CiAgICBmb250LXdlaWdodDogYm9sZDsKICAgIGNvbG9yOiB3aGl0ZTsKICAgIHRleHQtc2hhZG93OiAwIDJweCA0cHggcmdiYSgwLDAsMCwwLjgpLCAwIDAgMTBweCByZ2JhKDI1NSwyNTUsMjU1LDAuNSk7CiAgICB6LWluZGV4OiA1OwogICAgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgICBsZXR0ZXItc3BhY2luZzogMXB4Owp9CgovKiBHbGFyZSBFZmZlY3QgKi8KI2FjdGlvbi1idXR0b24gLmJ0bi1nbGFyZSB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IC01MCU7IGxlZnQ6IC01MCU7IHdpZHRoOiAyMDAlOyBoZWlnaHQ6IDIwMCU7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoNDVkZWcsIHRyYW5zcGFyZW50IDQwJSwgcmdiYSgyNTUsMjU1LDI1NSwwLjQpIDUwJSwgdHJhbnNwYXJlbnQgNjAlKTsKICAgIGFuaW1hdGlvbjogZ2xhcmVQYXNzIDVzIGluZmluaXRlOwogICAgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgICB6LWluZGV4OiA2OwogICAgYm9yZGVyLXJhZGl1czogNTAlOwp9CgovKiBMaW1pdCBSaW5nIChUaGUgR2xvdyBQdWxzZSkgKi8KLmxpbWl0LXJpbmcgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiAtNXB4OyBsZWZ0OiAtNXB4OyByaWdodDogLTVweDsgYm90dG9tOiAtNXB4OwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgYm9yZGVyOiAycHggc29saWQgdHJhbnNwYXJlbnQ7CiAgICBib3gtc2hhZG93OiAwIDAgMCB0cmFuc3BhcmVudDsKICAgIHRyYW5zaXRpb246IGFsbCAwLjVzOwogICAgei1pbmRleDogMTsKICAgIHBvaW50ZXItZXZlbnRzOiBub25lOwp9CgovKiAtLS0gU0hPT1QgTU9ERSAoT0ZGRU5TRSkgLS0tICovCiNhY3Rpb24tYnV0dG9uLnNob290LW1vZGUgewogICAgLyogR29sZC9GaXJlIFNwaGVyZSAqLwogICAgYmFja2dyb3VuZDogcmFkaWFsLWdyYWRpZW50KGNpcmNsZSBhdCAzNSUgMzUlLCAjZmZmZmFhIDAlLCAjZmZhYTAwIDQwJSwgIzg4MjIwMCA4MCUsICMyMjAwMDAgMTAwJSk7CiAgICBib3JkZXItY29sb3I6ICNmZmNjMDA7CiAgICBib3gtc2hhZG93OiAKICAgICAgICAwIDAgMzBweCByZ2JhKDI1NSwgMTAwLCAwLCAwLjgpLAogICAgICAgIGluc2V0IDAgMCAyMHB4IHJnYmEoMjU1LCAyNTUsIDAsIDAuNSk7Cn0KCi8qIExpbWl0IEJyZWFrIEdsb3cgKEhpZ2ggRW5lcmd5KSAqLwojYWN0aW9uLWJ1dHRvbi5saW1pdC1yZWFkeSAubGltaXQtcmluZyB7CiAgICBib3JkZXItY29sb3I6ICNmZmRkNDQ7CiAgICBhbmltYXRpb246IGxpbWl0UHVsc2UgMC44cyBlYXNlLWluLW91dCBpbmZpbml0ZSBhbHRlcm5hdGU7Cn0KCi8qIExhYmVsIENoYW5nZSAqLwouc2hvb3QtbGFiZWwgewogICAgY29sb3I6ICNmZmRkNDQgIWltcG9ydGFudDsKICAgIGJvcmRlci1jb2xvcjogI2ZmYWEwMCAhaW1wb3J0YW50OwogICAgdGV4dC1zaGFkb3c6IDAgMCAxMHB4ICNmZjQ0MDAgIWltcG9ydGFudDsKfQoKQGtleWZyYW1lcyBsaW1pdFB1bHNlIHsKICAgIDAlIHsgCiAgICAgICAgdHJhbnNmb3JtOiBzY2FsZSgxLjApOyAKICAgICAgICBib3gtc2hhZG93OiAwIDAgMTBweCAjZmZhYTAwLCBpbnNldCAwIDAgNXB4ICNmZmFhMDA7IAogICAgICAgIG9wYWNpdHk6IDAuNTsKICAgIH0KICAgIDEwMCUgeyAKICAgICAgICB0cmFuc2Zvcm06IHNjYWxlKDEuMTUpOyAKICAgICAgICBib3gtc2hhZG93OiAwIDAgMzBweCAjZmY0NDAwLCBpbnNldCAwIDAgMTVweCAjZmYwMDAwOyAKICAgICAgICBvcGFjaXR5OiAxLjA7CiAgICB9Cn0KCi8qIC0tLSBBVVRPIFRPR0dMRSAoR2xhc3MgQnV0dG9uKSAtLS0gKi8KI2F1dG8tdG9nZ2xlIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMjAwcHg7IHJpZ2h0OiAyMHB4OwogICAgd2lkdGg6IDExMHB4OwogICAgcGFkZGluZzogMTBweCAwOwogICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgZm9udC1zaXplOiAxMnB4OwogICAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgICBjb2xvcjogdmFyKC0tZmZ4LWN5YW4pOwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgcmdiYSgwLCAyMCwgNDAsIDAuOCkgMCUsIHJnYmEoMCwgNSwgMTAsIDAuOSkgMTAwJSk7CiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1mZngtYmx1ZS1saWdodCk7CiAgICBib3JkZXItdG9wOiAxcHggc29saWQgdmFyKC0tZmZ4LWN5YW4pOwogICAgYm9yZGVyLXJhZGl1czogNHB4OwogICAgY3Vyc29yOiBwb2ludGVyOwogICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsKICAgIGxldHRlci1zcGFjaW5nOiAxcHg7CiAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoNHB4KTsKICAgIGJveC1zaGFkb3c6IDAgNXB4IDE1cHggcmdiYSgwLDAsMCwwLjMpOwogICAgcG9pbnRlci1ldmVudHM6IGF1dG87CiAgICB0cmFuc2l0aW9uOiBhbGwgMC4yczsKICAgIHotaW5kZXg6IDEwMDsKfQoKI2F1dG8tdG9nZ2xlOmhvdmVyIHsKICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgNDAsIDgwLCAwLjkpOwogICAgYm94LXNoYWRvdzogMCAwIDE1cHggdmFyKC0tZmZ4LWN5YW4pOwogICAgY29sb3I6IHdoaXRlOwp9CgojYXV0by10b2dnbGUuYWN0aXZlIHsKICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsIHJnYmEoMTAwLCAyMCwgMCwgMC44KSAwJSwgcmdiYSg0MCwgMCwgMCwgMC45KSAxMDAlKTsKICAgIGJvcmRlci1jb2xvcjogI2ZmNDQwMDsKICAgIGNvbG9yOiAjZmZhYTAwOwogICAgYW5pbWF0aW9uOiBwdWxzZVJlZCAycyBpbmZpbml0ZTsKfQpAa2V5ZnJhbWVzIHB1bHNlUmVkIHsgMCUgeyBib3gtc2hhZG93OiAwIDAgNXB4ICNmZjAwMDA7IH0gNTAlIHsgYm94LXNoYWRvdzogMCAwIDIwcHggI2ZmNDQwMDsgfSAxMDAlIHsgYm94LXNoYWRvdzogMCAwIDVweCAjZmYwMDAwOyB9IH0KCi8qIC0tLSBGTE9BVElORyBURVhUIC0tLSAqLwovKiAtLS0gRkxPQVRJTkcgVEVYVCBNQU5BR0VSIC0tLSAqLwouZmxvYXRpbmctdGV4dC13cmFwcGVyIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMDsgbGVmdDogMDsKICAgIHBvaW50ZXItZXZlbnRzOiBub25lOwogICAgei1pbmRleDogMjAwMDsKICAgIHdpbGwtY2hhbmdlOiB0cmFuc2Zvcm07Cn0KCi5mbG9hdGluZy10ZXh0LWlubmVyIHsKICAgIGRpc3BsYXk6IGJsb2NrOwogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtZGF0YSk7CiAgICBmb250LXdlaWdodDogOTAwOwogICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsKICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7CiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAvKiBSZWR1Y2VkIGRlZmF1bHQgc2l6ZSBhbmQgc2hhZG93IGZvciBjbGFyaXR5ICovCiAgICBmb250LXNpemU6IDI0cHg7IAogICAgdGV4dC1zaGFkb3c6IDFweCAxcHggMCAjMDAwOwogICAgb3BhY2l0eTogMC45Owp9CgovKiBEQU1BR0UgKE51bWVyaWMpICovCi5mbG9hdGluZy10ZXh0LWlubmVyLmRhbWFnZSB7CiAgICBmb250LXNpemU6IDQycHg7CiAgICBmb250LXN0eWxlOiBpdGFsaWM7CiAgICAvKiBHb2xkL09yYW5nZSBHcmFkaWVudCAqLwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KHRvIGJvdHRvbSwgI2ZmZmZmZiAwJSwgI2ZmY2MwMCA0MCUsICNmZjQ0MDAgMTAwJSk7CiAgICAtd2Via2l0LWJhY2tncm91bmQtY2xpcDogdGV4dDsKICAgIC13ZWJraXQtdGV4dC1maWxsLWNvbG9yOiB0cmFuc3BhcmVudDsKICAgIGZpbHRlcjogZHJvcC1zaGFkb3coMCA0cHggNHB4IHJnYmEoMCwwLDAsMC44KSk7CiAgICBhbmltYXRpb246IHBvcERhbWFnZSAwLjhzIGN1YmljLWJlemllcigwLjE3NSwgMC44ODUsIDAuMzIsIDEuMjc1KSBmb3J3YXJkczsKfQoKLyogSEVBTCAqLwouZmxvYXRpbmctdGV4dC1pbm5lci5oZWFsIHsKICAgIGZvbnQtc2l6ZTogMzZweDsKICAgIGNvbG9yOiAjNDRmZjQ0OwogICAgdGV4dC1zaGFkb3c6IDAgMCAxMHB4ICMwMGZmMDA7CiAgICBhbmltYXRpb246IGZsb2F0VXAgMXMgZWFzZS1vdXQgZm9yd2FyZHM7Cn0KCi8qIFNUQVRVUzogVkVOT00gKi8KLyogU1RBVFVTOiBWRU5PTSAoQmlvLUdyZWVuLCBTaGFycCkgKi8KLmZsb2F0aW5nLXRleHQtaW5uZXIudmVub20gewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtZGF0YSk7IC8qIENvbnNpc3RlbnQgRkZYIGZvbnQgKi8KICAgIGZvbnQtc2l6ZTogNDJweDsKICAgIGZvbnQtc3R5bGU6IGl0YWxpYzsKICAgIGNvbG9yOiAjYWFmZjAwOwogICAgdGV4dC1zaGFkb3c6IDAgMCAxMHB4ICM0NDg4MDAsIDJweCAycHggMCAjMDAyMjAwOwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KHRvIGJvdHRvbSwgI2NjZmY2NiAwJSwgIzY2Y2MwMCAxMDAlKTsKICAgIC13ZWJraXQtYmFja2dyb3VuZC1jbGlwOiB0ZXh0OwogICAgLXdlYmtpdC10ZXh0LWZpbGwtY29sb3I6IHRyYW5zcGFyZW50OwogICAgZmlsdGVyOiBkcm9wLXNoYWRvdygwIDAgNXB4IHJnYmEoMTAwLCAyNTUsIDAsIDAuNSkpOwogICAgYW5pbWF0aW9uOiBkcmlwU3RhdHVzIDJzIGluZmluaXRlOwp9CgovKiBTVEFUVVM6IFNMRUVQIChIYXp5IEJsdWUsIERyZWFteSkgKi8KLmZsb2F0aW5nLXRleHQtaW5uZXIuc2xlZXAgewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtdGl0bGUpOwogICAgZm9udC1zaXplOiA0MnB4OwogICAgY29sb3I6ICNmZmZmZmY7CiAgICB0ZXh0LXNoYWRvdzogMCAwIDE1cHggIzAwNDRmZiwgMCAwIDMwcHggIzAwMDBmZjsKICAgIG9wYWNpdHk6IDAuOTsKICAgIGFuaW1hdGlvbjogZHJpZnRTdGF0dXMgM3MgZWFzZS1pbi1vdXQgaW5maW5pdGU7Cn0KCi8qIFNUQVRVUzogV0lUSEVSIChEZXNhdHVyYXRlZCwgU3RvbmUtbGlrZSkgKi8KLmZsb2F0aW5nLXRleHQtaW5uZXIud2l0aGVyIHsKICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LWRhdGEpOwogICAgZm9udC1zaXplOiAzOHB4OwogICAgY29sb3I6ICNjY2NjY2M7CiAgICB0ZXh0LXNoYWRvdzogMnB4IDJweCAwICM0NDQ0NDQ7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQodG8gYm90dG9tLCAjZWVlZWVlIDAlLCAjODg4ODg4IDEwMCUpOwogICAgLXdlYmtpdC1iYWNrZ3JvdW5kLWNsaXA6IHRleHQ7CiAgICAtd2Via2l0LXRleHQtZmlsbC1jb2xvcjogdHJhbnNwYXJlbnQ7CiAgICBhbmltYXRpb246IHdpdGhlclN0YXR1cyAxLjVzIGZvcndhcmRzOwp9CgovKiBURUNIIENBTExPVVRTIChTcGhlcmUgU2hvdCwgSmVjaHQgU2hvdCkgKi8KLyogVEVDSCBDQUxMT1VUUyAoU3BoZXJlIFNob3QsIEplY2h0IFNob3QpICovCi5mbG9hdGluZy10ZXh0LWlubmVyLnRlY2ggewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtdGl0bGUpOwogICAgZm9udC1zaXplOiAzMnB4OyAvKiBXYXMgNDhweCAqLwogICAgY29sb3I6ICMwMGZmZmY7CiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDEwLCAzMCwgMC43KTsKICAgIHBhZGRpbmc6IDJweCAxMHB4OwogICAgYm9yZGVyOiAxcHggc29saWQgIzAwZmZmZjsKICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgIGJveC1zaGFkb3c6IDAgMCAxMHB4ICMwMDg4ZmY7CiAgICB0ZXh0LXNoYWRvdzogMCAwIDVweCAjZmZmOwogICAgYW5pbWF0aW9uOiBzaGFrZVRlY2ggMC42cyBlYXNlLWluLW91dCwgZmxhc2hUZWNoIDAuM3M7CiAgICB0cmFuc2Zvcm0tb3JpZ2luOiBjZW50ZXI7Cn0KCi8qIFNBVkUgLyBCTE9DSyAqLwouZmxvYXRpbmctdGV4dC1pbm5lci5zYXZlLCAuZmxvYXRpbmctdGV4dC1pbm5lci5ibG9jayB7CiAgICBmb250LXNpemU6IDQ4cHg7CiAgICBmb250LXdlaWdodDogOTAwOwogICAgY29sb3I6ICNmZmZmZmY7CiAgICAtd2Via2l0LXRleHQtc3Ryb2tlOiAxcHggIzAwNDQ4ODsKICAgIHRleHQtc2hhZG93OiAwIDAgMjBweCAjMDA4OGZmOwogICAgYW5pbWF0aW9uOiBwb3BEYW1hZ2UgMC41cyBlYXNlLW91dCBmb3J3YXJkczsKfQoKLyogLS0tIEFOSU1BVElPTlMgLS0tICovCgpAa2V5ZnJhbWVzIHBvcERhbWFnZSB7CiAgICAwJSB7IHRyYW5zZm9ybTogc2NhbGUoMC41KTsgb3BhY2l0eTogMDsgfQogICAgMjAlIHsgdHJhbnNmb3JtOiBzY2FsZSgxLjUpOyBvcGFjaXR5OiAxOyB9CiAgICA0MCUgeyB0cmFuc2Zvcm06IHNjYWxlKDEuMCk7IG9wYWNpdHk6IDE7IH0KICAgIDEwMCUgeyB0cmFuc2Zvcm06IHNjYWxlKDEuMCk7IG9wYWNpdHk6IDA7IH0KfQoKQGtleWZyYW1lcyBmbG9hdFVwIHsKICAgIDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDApOyBvcGFjaXR5OiAxOyB9CiAgICAxMDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC01MHB4KTsgb3BhY2l0eTogMDsgfQp9CgpAa2V5ZnJhbWVzIGRyaXBTdGF0dXMgewogICAgMCUgeyB0cmFuc2Zvcm06IHNjYWxlWSgxKTsgZmlsdGVyOiBibHVyKDBweCk7IH0KICAgIDUwJSB7IHRyYW5zZm9ybTogc2NhbGVZKDEuMSkgdHJhbnNsYXRlWSg1cHgpOyBmaWx0ZXI6IGJsdXIoMXB4KTsgfQogICAgMTAwJSB7IHRyYW5zZm9ybTogc2NhbGVZKDEpOyBmaWx0ZXI6IGJsdXIoMHB4KTsgfQp9CgpAa2V5ZnJhbWVzIGRyaWZ0U3RhdHVzIHsKICAgIDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKDApIHJvdGF0ZSgwZGVnKTsgb3BhY2l0eTogMDsgfQogICAgMjAlIHsgb3BhY2l0eTogMTsgfQogICAgNTAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKDE1cHgpIHRyYW5zbGF0ZVkoLTIwcHgpIHJvdGF0ZSgxMGRlZyk7IH0KICAgIDEwMCUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTE1cHgpIHRyYW5zbGF0ZVkoLTUwcHgpIHJvdGF0ZSgtMTBkZWcpOyBvcGFjaXR5OiAwOyB9Cn0KCkBrZXlmcmFtZXMgd2l0aGVyU3RhdHVzIHsKICAgIDAlIHsgdHJhbnNmb3JtOiBzY2FsZSgxKTsgZmlsdGVyOiBncmF5c2NhbGUoMCUpOyBvcGFjaXR5OiAxOyB9CiAgICAxMDAlIHsgdHJhbnNmb3JtOiBzY2FsZSgwLjYpOyBmaWx0ZXI6IGdyYXlzY2FsZSgxMDAlKTsgb3BhY2l0eTogMDsgfQp9CgpAa2V5ZnJhbWVzIHNoYWtlVGVjaCB7CiAgICAwJSB7IHRyYW5zZm9ybTogc2NhbGUoMC44KTsgfQogICAgMTAlLCAzMCUsIDUwJSwgNzAlLCA5MCUgeyB0cmFuc2Zvcm06IHNjYWxlKDEuMSkgdHJhbnNsYXRlKC0ycHgsIDJweCk7IH0KICAgIDIwJSwgNDAlLCA2MCUsIDgwJSB7IHRyYW5zZm9ybTogc2NhbGUoMS4xKSB0cmFuc2xhdGUoMnB4LCAtMnB4KTsgfQogICAgMTAwJSB7IHRyYW5zZm9ybTogc2NhbGUoMS4wKTsgfQp9CgpAa2V5ZnJhbWVzIGZsYXNoVGVjaCB7CiAgICAwJSB7IGJhY2tncm91bmQtY29sb3I6ICNmZmY7IGNvbG9yOiAjMDAwOyBib3JkZXItY29sb3I6ICNmZmY7IH0KICAgIDEwMCUgeyBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDAsIDEwLCAzMCwgMC44NSk7IGNvbG9yOiAjMDBmZmZmOyBib3JkZXItY29sb3I6ICMwMGZmZmY7IH0KfQovKiBMb2FkaW5nIE92ZXJsYXkgKi8KI2xvYWRpbmcgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiA1MCU7IGxlZnQ6IDUwJTsKICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpOwogICAgZm9udC1zaXplOiAyNHB4OwogICAgY29sb3I6IHZhcigtLWZmeC1jeWFuKTsKICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICBsZXR0ZXItc3BhY2luZzogNXB4OwogICAgYW5pbWF0aW9uOiBibGluayAxcyBpbmZpbml0ZTsKfQpAa2V5ZnJhbWVzIGJsaW5rIHsgNTAlIHsgb3BhY2l0eTogMC41OyB9IH0KCiNjb250cm9scy1oaW50IHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMTMwcHg7IHdpZHRoOiAxMDAlOwogICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgZm9udC1zaXplOiAxMHB4OwogICAgY29sb3I6IHJnYmEoMjU1LDI1NSwyNTUsMC40KTsKICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKfQoKLyogLS0tIENPTUlDIEJPT0sgRlggLS0tICovCi8qIC0tLSBDT01JQyBCT09LIEZYIChTY2FsZWQgRG93bikgLS0tICovCi5mbG9hdGluZy10ZXh0LWlubmVyLmNvbWljLWltcGFjdCB7CiAgICBmb250LWZhbWlseTogJ0ltcGFjdCcsIHNhbnMtc2VyaWY7CiAgICBmb250LXNpemU6IDQycHg7IC8qIFdhcyA2MHB4ICovCiAgICBjb2xvcjogI2ZmZmYwMDsgCiAgICAtd2Via2l0LXRleHQtc3Ryb2tlOiAxcHggIzAwMDsKICAgIHRleHQtc2hhZG93OiAzcHggM3B4IDAgI2ZmMDAwMDsKICAgIGZvbnQtc3R5bGU6IGl0YWxpYzsKICAgIHRyYW5zZm9ybS1vcmlnaW46IGNlbnRlcjsKICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7CiAgICBhbmltYXRpb246IGNvbWljUG9wIDAuNHMgY3ViaWMtYmV6aWVyKDAuMTc1LCAwLjg4NSwgMC4zMiwgMS4yNzUpIGZvcndhcmRzOwogICAgei1pbmRleDogMjUwMDsKfQoKLmZsb2F0aW5nLXRleHQtaW5uZXIuY29taWMtYWN0aW9uIHsKICAgIGZvbnQtZmFtaWx5OiAnQXJpYWwgQmxhY2snLCBzYW5zLXNlcmlmOwogICAgZm9udC1zaXplOiAyOHB4OyAvKiBXYXMgNDBweCAqLwogICAgY29sb3I6ICMwMGZmZmY7IAogICAgLXdlYmtpdC10ZXh0LXN0cm9rZTogMXB4ICMwMDA7CiAgICB0ZXh0LXNoYWRvdzogMnB4IDJweCAwICMwMDQ0YWE7CiAgICBmb250LXN0eWxlOiBpdGFsaWM7CiAgICB3aGl0ZS1zcGFjZTogbm93cmFwOwogICAgYW5pbWF0aW9uOiBjb21pY1NsaWRlIDAuNHMgZWFzZS1vdXQgZm9yd2FyZHM7CiAgICB6LWluZGV4OiAyNTAwOwp9CgpAa2V5ZnJhbWVzIGNvbWljUG9wIHsKICAgIDAlIHsgdHJhbnNmb3JtOiBzY2FsZSgwKSByb3RhdGUoLTIwZGVnKTsgb3BhY2l0eTogMDsgfQogICAgNDAlIHsgdHJhbnNmb3JtOiBzY2FsZSgxLjIpIHJvdGF0ZSg1ZGVnKTsgb3BhY2l0eTogMTsgfQogICAgNjAlIHsgdHJhbnNmb3JtOiBzY2FsZSgxLjApIHJvdGF0ZSgtNWRlZyk7IG9wYWNpdHk6IDE7IH0KICAgIDEwMCUgeyB0cmFuc2Zvcm06IHNjYWxlKDEuMSkgcm90YXRlKDBkZWcpOyBvcGFjaXR5OiAwOyB9Cn0KCkBrZXlmcmFtZXMgY29taWNTbGlkZSB7CiAgICAwJSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC0yMHB4LCAyMHB4KSBzY2FsZSgwLjUpOyBvcGFjaXR5OiAwOyB9CiAgICAxMDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoMjBweCwgLTIwcHgpIHNjYWxlKDEuMik7IG9wYWNpdHk6IDA7IH0KfQovKiAtLS0gTUFJTiBNRU5VIChGRlggU3R5bGUpIC0tLSAqLwojbWFpbi1tZW51IHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMDsgbGVmdDogMDsgd2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgei1pbmRleDogMzAwMDsKICAgIG9wYWNpdHk6IDA7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgIHRyYW5zaXRpb246IG9wYWNpdHkgMC41cyBlYXNlLWluLW91dDsKICAgIGJhY2tncm91bmQ6IHJhZGlhbC1ncmFkaWVudChjaXJjbGUgYXQgY2VudGVyLCByZ2JhKDAsIDIwLCA2MCwgMC44KSAwJSwgcmdiYSgwLCA1LCAxMCwgMC45NSkgMTAwJSk7CiAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoNXB4KTsKfQoKI21haW4tbWVudS5hY3RpdmUgewogICAgb3BhY2l0eTogMTsKICAgIHBvaW50ZXItZXZlbnRzOiBhdXRvOwp9CgoubWVudS1iZy1vdmVybGF5IHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMDsgbGVmdDogMDsgd2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTsKICAgIGJhY2tncm91bmQ6IAogICAgICAgIGxpbmVhci1ncmFkaWVudChyZ2JhKDAsMCwwLDApIDUwJSwgcmdiYSgwLDAsMCwwLjIpIDUwJSksIAogICAgICAgIGxpbmVhci1ncmFkaWVudCg5MGRlZywgcmdiYSgyNTUsMCwwLDAuMDYpLCByZ2JhKDAsMjU1LDAsMC4wMiksIHJnYmEoMCwwLDI1NSwwLjA2KSk7CiAgICBiYWNrZ3JvdW5kLXNpemU6IDEwMCUgMnB4LCAzcHggMTAwJTsKICAgIHBvaW50ZXItZXZlbnRzOiBub25lOwogICAgei1pbmRleDogLTE7Cn0KCi5mZngtbG9nby1jb250YWluZXIgewogICAgbWFyZ2luLWJvdHRvbTogNjBweDsKICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgIHRyYW5zZm9ybTogc2tld1goLTEwZGVnKTsKfQoKLmZmeC1sb2dvLW1haW4gewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtdGl0bGUpOwogICAgZm9udC1zaXplOiA2NHB4OwogICAgY29sb3I6ICNmZmZmZmY7CiAgICB0ZXh0LXNoYWRvdzogCiAgICAgICAgMCAwIDEwcHggIzAwZmZmZiwKICAgICAgICAwIDAgMjBweCAjMDA4OGZmLAogICAgICAgIDAgMCA0MHB4ICMwMDAwZmY7CiAgICBsZXR0ZXItc3BhY2luZzogNXB4OwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KHRvIGJvdHRvbSwgI2ZmZmZmZiAwJSwgI2FhY2NmZiA1MCUsICMwMDg4ZmYgMTAwJSk7CiAgICAtd2Via2l0LWJhY2tncm91bmQtY2xpcDogdGV4dDsKICAgIC13ZWJraXQtdGV4dC1maWxsLWNvbG9yOiB0cmFuc3BhcmVudDsKICAgIGZpbHRlcjogZHJvcC1zaGFkb3coMCA1cHggNXB4IHJnYmEoMCwwLDAsMC44KSk7Cn0KCi5mZngtbG9nby1zdWIgewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtZGF0YSk7CiAgICBmb250LXNpemU6IDE4cHg7CiAgICBjb2xvcjogdmFyKC0tZmZ4LWdvbGQpOwogICAgbGV0dGVyLXNwYWNpbmc6IDEycHg7CiAgICBtYXJnaW4tdG9wOiAtNXB4OwogICAgdGV4dC1zaGFkb3c6IDAgMCA1cHggI2ZmYWEwMDsKfQoKLm1lbnUtb3B0aW9ucyB7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgIGdhcDogMTVweDsKICAgIHdpZHRoOiAzMDBweDsKfQoKLm1lbnUtaXRlbSB7CiAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICBwYWRkaW5nOiAxNXB4IDMwcHg7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsIHJnYmEoMCwgNDAsIDgwLCAwLjYpIDAlLCByZ2JhKDAsIDEwLCAyMCwgMC4wKSAxMDAlKTsKICAgIGJvcmRlci1sZWZ0OiA0cHggc29saWQgcmdiYSgxMDAsIDIwMCwgMjU1LCAwLjMpOwogICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHJnYmEoMTAwLCAyMDAsIDI1NSwgMC4xKTsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIHRyYW5zaXRpb246IGFsbCAwLjJzOwogICAgdHJhbnNmb3JtOiBza2V3WCgtMTBkZWcpOwogICAgZGlzcGxheTogZmxleDsKICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7Cn0KCi5tZW51LWl0ZW06aG92ZXIgewogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCByZ2JhKDAsIDgwLCAxNjAsIDAuOCkgMCUsIHJnYmEoMCwgMjAsIDQwLCAwLjApIDEwMCUpOwogICAgYm9yZGVyLWxlZnQtY29sb3I6ICMwMGZmZmY7CiAgICBwYWRkaW5nLWxlZnQ6IDQwcHg7CiAgICBib3gtc2hhZG93OiAwIDAgMTVweCByZ2JhKDAsIDI1NSwgMjU1LCAwLjIpOwp9CgoubWVudS1pdGVtIC5sYWJlbCB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC10aXRsZSk7CiAgICBmb250LXNpemU6IDI0cHg7CiAgICBjb2xvcjogI2NjY2NjYzsKICAgIGxldHRlci1zcGFjaW5nOiAycHg7CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgdHJhbnNmb3JtOiBza2V3WCgxMGRlZyk7IC8qIENvdW50ZXIgc2tldyAqLwogICAgdHJhbnNpdGlvbjogY29sb3IgMC4yczsKfQoKLm1lbnUtaXRlbTpob3ZlciAubGFiZWwgewogICAgY29sb3I6ICNmZmZmZmY7CiAgICB0ZXh0LXNoYWRvdzogMCAwIDEwcHggIzAwZmZmZjsKfQoKLm1lbnUtaXRlbSAuY3Vyc29yIHsKICAgIGZvbnQtc2l6ZTogMThweDsKICAgIGNvbG9yOiB2YXIoLS1mZngtZ29sZCk7CiAgICBtYXJnaW4tcmlnaHQ6IDE1cHg7CiAgICBvcGFjaXR5OiAwOwogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKC0xMHB4KSBza2V3WCgxMGRlZyk7CiAgICB0cmFuc2l0aW9uOiBhbGwgMC4yczsKfQoKLm1lbnUtaXRlbTpob3ZlciAuY3Vyc29yIHsKICAgIG9wYWNpdHk6IDE7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoMCkgc2tld1goMTBkZWcpOwp9CgoubWVudS1mb290ZXIgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgYm90dG9tOiAyMHB4OwogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtdWkpOwogICAgZm9udC1zaXplOiAxMHB4OwogICAgY29sb3I6IHJnYmEoMjU1LDI1NSwyNTUsMC4zKTsKICAgIGxldHRlci1zcGFjaW5nOiAycHg7Cn0KLyogLS0tIFBSQUNUSUNFIE9WRVJMQVkgKEZGWCBTdHlsZSkgLS0tICovCiNwcmFjdGljZS1vdmVybGF5IHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMDsgbGVmdDogMDsgd2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTsKICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgNSwgMTAsIDAuNik7IC8qIERpbSBiYWNrZ3JvdW5kICovCiAgICBkaXNwbGF5OiBub25lOyAvKiBUb2dnbGVkIGJ5IEpTICovCiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICB6LWluZGV4OiAyNTAwOwogICAgcG9pbnRlci1ldmVudHM6IG5vbmU7IC8qIExldCBjbGlja3MgcGFzcyB0aHJvdWdoIHRvIGdhbWUgdXN1YWxseSwgYnV0IHBhbmVsIG5lZWRzIGV2ZW50cyAqLwp9CgojcHJhY3RpY2Utb3ZlcmxheS5hY3RpdmUgewogICAgZGlzcGxheTogZmxleDsKfQoKLnByYWN0aWNlLXBhbmVsIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogNjBweDsgcmlnaHQ6IDIwcHg7IC8qIFRvcCBSaWdodCBwb3NpdGlvbmluZyBsaWtlIGEgZGVidWcgbWVudSAqLwogICAgd2lkdGg6IDI4MHB4OwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDE2MGRlZywgcmdiYSgwLCAyMCwgNTAsIDAuOTUpIDAlLCByZ2JhKDAsIDEwLCAyMCwgMC45OCkgMTAwJSk7CiAgICBib3JkZXI6IDFweCBzb2xpZCAjNDQ4OGZmOwogICAgYm9yZGVyLXJhZGl1czogMCAwIDE1cHggMDsKICAgIGJveC1zaGFkb3c6IDAgMCAyMHB4IHJnYmEoMCwgMTAwLCAyNTUsIDAuMiksIGluc2V0IDAgMCA1MHB4IHJnYmEoMCwgMjAsIDYwLCAwLjUpOwogICAgcGFkZGluZzogMTVweDsKICAgIHBvaW50ZXItZXZlbnRzOiBhdXRvOwogICAgdHJhbnNmb3JtOiBza2V3WCgtMmRlZyk7CiAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoNXB4KTsKfQoKLnBhbmVsLWhlYWRlciB7CiAgICBtYXJnaW4tYm90dG9tOiAxNXB4OwogICAgdGV4dC1hbGlnbjogY2VudGVyOwp9CgoucGFuZWwtdGl0bGUtZ3JvdXAgewogICAgZGlzcGxheTogZmxleDsKICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47Cn0KCi5wYW5lbC10aXRsZSB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC10aXRsZSk7CiAgICBmb250LXNpemU6IGNsYW1wKDE4cHgsIDZ2dywgMjRweCk7IC8qIER5bmFtaWMgKi8KICAgIGNvbG9yOiAjZmZmZmZmOwogICAgdGV4dC1zaGFkb3c6IDAgMCAxMHB4ICMwMGZmZmY7CiAgICBsZXR0ZXItc3BhY2luZzogMnB4Owp9CgoucGFuZWwtc3VidGl0bGUgewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtdWkpOwogICAgZm9udC1zaXplOiA4cHg7CiAgICBjb2xvcjogIzQ0ODhmZjsKICAgIGxldHRlci1zcGFjaW5nOiA0cHg7CiAgICBtYXJnaW4tdG9wOiAtMnB4Owp9CgoucGFuZWwtZGVjby1saW5lIHsKICAgIHdpZHRoOiAxMDAlOwogICAgaGVpZ2h0OiAycHg7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsIHRyYW5zcGFyZW50LCAjMDBmZmZmLCB0cmFuc3BhcmVudCk7CiAgICBtYXJnaW4tdG9wOiA1cHg7CiAgICBib3gtc2hhZG93OiAwIDAgNXB4ICMwMGZmZmY7Cn0KCi5wYW5lbC1jb250ZW50IHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgZ2FwOiAxNXB4Owp9Cgouc2VjdGlvbi1sYWJlbCB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC11aSk7CiAgICBmb250LXNpemU6IDEwcHg7CiAgICBjb2xvcjogdmFyKC0tZmZ4LWdvbGQpOwogICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHJnYmEoMjAwLCAxNzYsIDk2LCAwLjMpOwogICAgbWFyZ2luLWJvdHRvbTogNXB4OwogICAgcGFkZGluZy1ib3R0b206IDJweDsKICAgIGxldHRlci1zcGFjaW5nOiAxcHg7Cn0KCi8qIERyaWxsIEJ1dHRvbnMgKi8KLmRyaWxsLWxpc3QgewogICAgZGlzcGxheTogZmxleDsKICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICBnYXA6IDVweDsKfQoKLmRyaWxsLWJ0biB7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgIHBhZGRpbmc6IDhweCAxMnB4OwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMDUpLCB0cmFuc3BhcmVudCk7CiAgICBib3JkZXItbGVmdDogMnB4IHNvbGlkIHRyYW5zcGFyZW50OwogICAgY3Vyc29yOiBwb2ludGVyOwogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtZGF0YSk7CiAgICBmb250LXNpemU6IDE0cHg7CiAgICBjb2xvcjogI2FhYTsKICAgIHRyYW5zaXRpb246IGFsbCAwLjJzOwp9CgouZHJpbGwtYnRuOmhvdmVyIHsKICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCg5MGRlZywgcmdiYSgwLCAyNTUsIDI1NSwgMC4xKSwgdHJhbnNwYXJlbnQpOwogICAgY29sb3I6ICNmZmY7CiAgICBwYWRkaW5nLWxlZnQ6IDE1cHg7Cn0KCi5kcmlsbC1idG4uYWN0aXZlIHsKICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCg5MGRlZywgcmdiYSgwLCAxMDAsIDI1NSwgMC40KSwgdHJhbnNwYXJlbnQpOwogICAgYm9yZGVyLWxlZnQ6IDNweCBzb2xpZCAjMDBmZmZmOwogICAgY29sb3I6ICNmZmY7CiAgICB0ZXh0LXNoYWRvdzogMCAwIDVweCAjMDBmZmZmOwp9CgouZHJpbGwtYnRuIC5pY29uIHsKICAgIHdpZHRoOiAyMHB4OwogICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgbWFyZ2luLXJpZ2h0OiAxMHB4OwogICAgY29sb3I6IHZhcigtLWZmeC1jeWFuKTsKfQoKLyogT3B0aW9ucyAqLwoub3B0aW9uLWxpc3QgewogICAgZGlzcGxheTogZmxleDsKICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICBnYXA6IDVweDsKfQoKLm9wdGlvbi10b2dnbGUgewogICAgZGlzcGxheTogZmxleDsKICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICBwYWRkaW5nOiA1cHggMTBweDsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIGZvbnQtc2l6ZTogMTJweDsKICAgIGNvbG9yOiAjY2NjOwogICAgdHJhbnNpdGlvbjogY29sb3IgMC4yczsKfQoKLm9wdGlvbi10b2dnbGU6aG92ZXIgeyBjb2xvcjogI2ZmZjsgfQoKLm9wdGlvbi10b2dnbGUgLmNoZWNrYm94IHsKICAgIG1hcmdpbi1yaWdodDogMTBweDsKICAgIGNvbG9yOiAjNDQ0OwogICAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTsKICAgIGZvbnQtc2l6ZTogMTRweDsKfQoKLm9wdGlvbi10b2dnbGUuYWN0aXZlIC5jaGVja2JveCB7CiAgICBjb2xvcjogIzAwZmYwMDsKICAgIHRleHQtc2hhZG93OiAwIDAgNXB4ICMwMGZmMDA7Cn0KCi5vcHRpb24tdG9nZ2xlLmFjdGl2ZSB7CiAgICBjb2xvcjogI2ZmZjsKfQoKLyogQWN0aW9uIEJ1dHRvbnMgKi8KLmFjdGlvbi1idG4gewogICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjUpOwogICAgYm9yZGVyOiAxcHggc29saWQgIzQ0NDsKICAgIHBhZGRpbmc6IDZweDsKICAgIGZvbnQtc2l6ZTogMTFweDsKICAgIGNvbG9yOiAjYWFhOwogICAgY3Vyc29yOiBwb2ludGVyOwogICAgdHJhbnNpdGlvbjogYWxsIDAuMnM7CiAgICBtYXJnaW4tYm90dG9tOiA1cHg7CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgbGV0dGVyLXNwYWNpbmc6IDFweDsKfQoKLmFjdGlvbi1idG46aG92ZXIgewogICAgYm9yZGVyLWNvbG9yOiAjZmZmOwogICAgY29sb3I6ICNmZmY7CiAgICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMSk7Cn0KCiNwLWV4aXQ6aG92ZXIgewogICAgYm9yZGVyLWNvbG9yOiAjZmY0NDQ0OwogICAgY29sb3I6ICNmZjQ0NDQ7CiAgICBiYWNrZ3JvdW5kOiByZ2JhKDUwLCAwLCAwLCAwLjMpOwp9CgovKiBGb290ZXIgKi8KLnBhbmVsLWZvb3RlciB7CiAgICBtYXJnaW4tdG9wOiAxNXB4OwogICAgcGFkZGluZy10b3A6IDEwcHg7CiAgICBib3JkZXItdG9wOiAxcHggc29saWQgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjEpOwogICAgdGV4dC1hbGlnbjogY2VudGVyOwp9CgojZHJpbGwtaW5zdHJ1Y3Rpb24gewogICAgZm9udC1zaXplOiAxMHB4OwogICAgY29sb3I6IHZhcigtLWZmeC1jeWFuKTsKICAgIG1hcmdpbi1ib3R0b206IDVweDsKICAgIGZvbnQtc3R5bGU6IGl0YWxpYzsKfQoKI2RyaWxsLXNjb3JlIHsKICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LWRhdGEpOwogICAgZm9udC1zaXplOiAyNHB4OwogICAgY29sb3I6IHZhcigtLWZmeC1nb2xkKTsKdGV4dC1zaGFkb3c6IDAgMCAxMHB4IHJnYmEoMjU1LCAyMTUsIDAsIDAuNSk7Cn0KCi8qIC0tLSBQUkFDVElDRSBNSU5JTUlaRS9SRVNUT1JFIC0tLSAqLwovKiAtLS0gUFJBQ1RJQ0UgTUlOSU1JWkUvUkVTVE9SRSAtLS0gKi8KLnBhbmVsLW1pbmltaXplLWJ0biB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IDEwcHg7IHJpZ2h0OiAxMHB4OwogICAgd2lkdGg6IDIwcHg7IGhlaWdodDogMjBweDsKICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWZmeC1jeWFuKTsKICAgIGNvbG9yOiB2YXIoLS1mZngtY3lhbik7CiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICBsaW5lLWhlaWdodDogMThweDsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIGZvbnQtc2l6ZTogMTRweDsKICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC41KTsKICAgIHRyYW5zaXRpb246IGFsbCAwLjJzOwp9Ci5wYW5lbC1taW5pbWl6ZS1idG46aG92ZXIgeyAKICAgIGJhY2tncm91bmQ6IHZhcigtLWZmeC1jeWFuKTsgCiAgICBjb2xvcjogIzAwMDsgCiAgICBib3gtc2hhZG93OiAwIDAgNXB4IHZhcigtLWZmeC1jeWFuKTsKfQoKI3ByYWN0aWNlLXJlc3RvcmUtYnRuIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogNjBweDsgcmlnaHQ6IDIwcHg7CiAgICBwYWRkaW5nOiA4cHggMTVweDsKICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCg5MGRlZywgcmdiYSgwLCAyMCwgNTAsIDAuOSkgMCUsIHJnYmEoMCwgMTAsIDIwLCAwLjkpIDEwMCUpOwogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tZmZ4LWN5YW4pOwogICAgYm9yZGVyLWxlZnQ6IDNweCBzb2xpZCB2YXIoLS1mZngtY3lhbik7CiAgICBjb2xvcjogdmFyKC0tZmZ4LWN5YW4pOwogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtZGF0YSk7CiAgICBmb250LXNpemU6IDEycHg7CiAgICBsZXR0ZXItc3BhY2luZzogMXB4OwogICAgY3Vyc29yOiBwb2ludGVyOwogICAgei1pbmRleDogMjQwMDsKICAgIGRpc3BsYXk6IG5vbmU7IC8qIEhpZGRlbiBieSBkZWZhdWx0ICovCiAgICBwb2ludGVyLWV2ZW50czogYXV0bzsKICAgIHRyYW5zZm9ybTogc2tld1goLTEwZGVnKTsKICAgIGJveC1zaGFkb3c6IDAgMCAxMHB4IHJnYmEoMCwgMTAwLCAyNTUsIDAuMik7CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwp9CiNwcmFjdGljZS1yZXN0b3JlLWJ0bjpob3ZlciB7CiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDQwLCA4MCwgMC45KTsKICAgIGNvbG9yOiAjZmZmOwogICAgdGV4dC1zaGFkb3c6IDAgMCA1cHggIzAwZmZmZjsKICAgIGJveC1zaGFkb3c6IDAgMCAxNXB4IHJnYmEoMCwgMjU1LCAyNTUsIDAuMyk7Cn0KCi8qID09PSBORVcgVUkgRUxFTUVOVFMgKHYyLjAgVXBncmFkZSkgPT09ICovCgovKiAtLS0gQUlNIEpPWVNUSUNLIChSaWdodCBTaWRlKSAtLS0gKi8KI2FpbS1qb3lzdGljay16b25lIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIGJvdHRvbTogMTUwcHg7CiAgICByaWdodDogMDsKICAgIHdpZHRoOiA0MCU7CiAgICBoZWlnaHQ6IDM1JTsKICAgIHotaW5kZXg6IDEwMDA7CiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDApOwogICAgdG91Y2gtYWN0aW9uOiBub25lOwogICAgcG9pbnRlci1ldmVudHM6IGF1dG87Cn0KCiNhaW0tam95c3RpY2stdmlzdWFsIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMDsgbGVmdDogMDsKICAgIHdpZHRoOiAwOyBoZWlnaHQ6IDA7CiAgICBvdmVyZmxvdzogdmlzaWJsZTsKICAgIHBvaW50ZXItZXZlbnRzOiBub25lOwogICAgZGlzcGxheTogbm9uZTsKICAgIHotaW5kZXg6IDExMDA7Cn0KCiNhaW0tam95c3RpY2stYmFzZSB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IDUwJTsgbGVmdDogNTAlOwogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSk7CiAgICB3aWR0aDogOTBweDsgaGVpZ2h0OiA5MHB4OwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgYmFja2dyb3VuZDogcmFkaWFsLWdyYWRpZW50KGNpcmNsZSwgcmdiYSgyNTUsIDEwMCwgMCwgMC4zKSAwJSwgcmdiYSg4MCwgMjAsIDAsIDAuMSkgNjAlLCB0cmFuc3BhcmVudCAxMDAlKTsKICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMjU1LCAxNTAsIDUwLCAwLjQpOwogICAgYm94LXNoYWRvdzogMCAwIDE1cHggcmdiYSgyNTUsIDEwMCwgMCwgMC4yKSwgaW5zZXQgMCAwIDIwcHggcmdiYSgyNTUsIDUwLCAwLCAwLjIpOwp9CgojYWltLWpveXN0aWNrLWtub2IgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiA1MCU7IGxlZnQ6IDUwJTsKICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpOwogICAgd2lkdGg6IDQwcHg7IGhlaWdodDogNDBweDsKICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgIGJhY2tncm91bmQ6IHJhZGlhbC1ncmFkaWVudChjaXJjbGUgYXQgMzAlIDMwJSwgI2ZmY2M4OCAwJSwgI2ZmNjYwMCA0MCUsICM4ODIyMDAgODAlLCAjMjIwMDAwIDEwMCUpOwogICAgYm9yZGVyOiAycHggc29saWQgI2ZmYWE0NDsKICAgIGJveC1zaGFkb3c6IDAgMCAxMHB4ICNmZjQ0MDAsIGluc2V0IDAgMCA4cHggcmdiYSgyNTUsMjU1LDI1NSwwLjYpOwogICAgdHJhbnNpdGlvbjogdHJhbnNmb3JtIDAuMDVzIGxpbmVhcjsKfQoKI2FpbS1qb3lzdGljay1rbm9iOjphZnRlciB7CiAgICBjb250ZW50OiAiQUlNIjsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogNTAlOyBsZWZ0OiA1MCU7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKTsKICAgIGZvbnQtc2l6ZTogOHB4OwogICAgY29sb3I6IHdoaXRlOwogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtZGF0YSk7CiAgICB0ZXh0LXNoYWRvdzogMCAwIDNweCAjMDAwOwp9CgovKiAtLS0gVEFDS0xFIEJVVFRPTiAtLS0gKi8KI3RhY2tsZS1idXR0b24gewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgYm90dG9tOiAxNjBweDsKICAgIHJpZ2h0OiA0MHB4OwogICAgd2lkdGg6IDcwcHg7CiAgICBoZWlnaHQ6IDcwcHg7CiAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICBkaXNwbGF5OiBub25lOwogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgcG9pbnRlci1ldmVudHM6IGF1dG87CiAgICB6LWluZGV4OiAxMDA7CiAgICBiYWNrZ3JvdW5kOiByYWRpYWwtZ3JhZGllbnQoY2lyY2xlIGF0IDM1JSAzNSUsICNmZjg4ODggMCUsICNjYzAwMDAgNDAlLCAjNjYwMDAwIDgwJSwgIzIyMDAwMCAxMDAlKTsKICAgIGJvcmRlcjogM3B4IHNvbGlkICNmZjQ0NDQ7CiAgICBib3gtc2hhZG93OiAwIDAgMTVweCByZ2JhKDI1NSwgNTAsIDUwLCAwLjYpLCBpbnNldCAwIDAgMTVweCByZ2JhKDI1NSwgMjAwLCAyMDAsIDAuMyk7CiAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gMC4xcywgZmlsdGVyIDAuMnM7Cn0KCiN0YWNrbGUtYnV0dG9uOmFjdGl2ZSB7CiAgICB0cmFuc2Zvcm06IHNjYWxlKDAuOSk7CiAgICBmaWx0ZXI6IGJyaWdodG5lc3MoMS4yKTsKfQoKI3RhY2tsZS1idXR0b24uYWN0aXZlIHsKICAgIGJhY2tncm91bmQ6IHJhZGlhbC1ncmFkaWVudChjaXJjbGUgYXQgMzUlIDM1JSwgI2ZmZmZmZiAwJSwgI2ZmNDQ0NCA0MCUsICNhYTAwMDAgODAlLCAjNDQwMDAwIDEwMCUpOwogICAgYm94LXNoYWRvdzogMCAwIDI1cHggcmdiYSgyNTUsIDEwMCwgMTAwLCAwLjkpOwp9CgojdGFja2xlLWJ1dHRvbiAuYnRuLXRleHQgewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtZGF0YSk7CiAgICBmb250LXNpemU6IDEycHg7CiAgICBmb250LXdlaWdodDogYm9sZDsKICAgIGNvbG9yOiB3aGl0ZTsKICAgIHRleHQtc2hhZG93OiAwIDFweCAycHggcmdiYSgwLDAsMCwwLjgpOwogICAgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgbGV0dGVyLXNwYWNpbmc6IDFweDsKfQoKI3RhY2tsZS1idXR0b24gLmJ0bi1nbGFyZSB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IC01MCU7IGxlZnQ6IC01MCU7CiAgICB3aWR0aDogMjAwJTsgaGVpZ2h0OiAyMDAlOwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDQ1ZGVnLCB0cmFuc3BhcmVudCA0MCUsIHJnYmEoMjU1LDI1NSwyNTUsMC4zKSA1MCUsIHRyYW5zcGFyZW50IDYwJSk7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgIGFuaW1hdGlvbjogZ2xhcmVQYXNzIDRzIGluZmluaXRlOwp9CgovKiAtLS0gQ0hBUkdFIFBPV0VSIE1FVEVSIC0tLSAqLwojdGFja2xlLWJ1dHRvbi51cmdlbnQgewogICAgYW5pbWF0aW9uOiB1cmdlbnRQdWxzZSAwLjVzIGluZmluaXRlIGFsdGVybmF0ZTsKICAgIGJhY2tncm91bmQ6IHJhZGlhbC1ncmFkaWVudChjaXJjbGUgYXQgMzUlIDM1JSwgI2ZmNTU1NSAwJSwgI2ZmMDAwMCA0MCUsICM4ODAwMDAgMTAwJSk7CiAgICBib3JkZXItY29sb3I6ICNmZmFhYWE7CiAgICBib3gtc2hhZG93OiAwIDAgMjBweCAjZmYwMDAwOwp9CgpAa2V5ZnJhbWVzIHVyZ2VudFB1bHNlIHsKICAgIGZyb20geyB0cmFuc2Zvcm06IHNjYWxlKDEuMCk7IH0KICAgIHRvIHsgdHJhbnNmb3JtOiBzY2FsZSgxLjE1KTsgfQp9CgovKiAtLS0gQ0hBUkdFIFBPV0VSIE1FVEVSIC0tLSAqLwojY2hhcmdlLW1ldGVyLWNvbnRhaW5lciB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICBib3R0b206IDI1MHB4OwogICAgbGVmdDogNTAlOwogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKC01MCUpOwogICAgd2lkdGg6IDIwMHB4OwogICAgZGlzcGxheTogbm9uZTsKICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgICB6LWluZGV4OiAyMDAwOwogICAgYmFja2dyb3VuZDogcmdiYSgwLCAxMCwgMzAsIDAuOCk7CiAgICBwYWRkaW5nOiAxMHB4IDE1cHg7CiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1mZngtY3lhbik7CiAgICBib3JkZXItcmFkaXVzOiA1cHg7CiAgICBib3gtc2hhZG93OiAwIDAgMTVweCByZ2JhKDAsIDEwMCwgMjU1LCAwLjMpOwp9CgouY2hhcmdlLWxhYmVsIHsKICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LWRhdGEpOwogICAgZm9udC1zaXplOiAxMnB4OwogICAgY29sb3I6IHZhcigtLWZmeC1jeWFuKTsKICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICBsZXR0ZXItc3BhY2luZzogMnB4OwogICAgbWFyZ2luLWJvdHRvbTogNXB4Owp9CgouY2hhcmdlLW1ldGVyLXRyYWNrIHsKICAgIHdpZHRoOiAxMDAlOwogICAgaGVpZ2h0OiAxMnB4OwogICAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjYpOwogICAgYm9yZGVyOiAxcHggc29saWQgIzQ0NDsKICAgIGJvcmRlci1yYWRpdXM6IDZweDsKICAgIG92ZXJmbG93OiBoaWRkZW47Cn0KCiNjaGFyZ2UtbWV0ZXItZmlsbCB7CiAgICBoZWlnaHQ6IDEwMCU7CiAgICB3aWR0aDogMCU7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsICMwYWYsICMwZjApOwogICAgYm94LXNoYWRvdzogMCAwIDEwcHggIzBmMDsKICAgIHRyYW5zaXRpb246IHdpZHRoIDAuMDVzIGxpbmVhciwgYmFja2dyb3VuZCAwLjFzOwogICAgYm9yZGVyLXJhZGl1czogNXB4Owp9CgouY2hhcmdlLWhpbnQgewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtdWkpOwogICAgZm9udC1zaXplOiAxMHB4OwogICAgY29sb3I6IHZhcigtLWZmeC1nb2xkKTsKICAgIG1hcmdpbi10b3A6IDVweDsKICAgIG9wYWNpdHk6IDAuODsKICAgIGFuaW1hdGlvbjogYmxpbmsgMC41cyBpbmZpbml0ZTsKfQoKLyogLS0tIEdPQUwgRElTVEFOQ0UgSU5ESUNBVE9SIC0tLSAqLwojZ29hbC1kaXN0YW5jZS1jb250YWluZXIgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiA3NXB4OwogICAgbGVmdDogMjBweDsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgIHBvaW50ZXItZXZlbnRzOiBub25lOwogICAgei1pbmRleDogMTAwOwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCByZ2JhKDAsIDEwLCAzMCwgMC43KSAwJSwgdHJhbnNwYXJlbnQgMTAwJSk7CiAgICBwYWRkaW5nOiA1cHggMTVweCA1cHggMTBweDsKICAgIGJvcmRlci1sZWZ0OiAycHggc29saWQgdmFyKC0tZmZ4LWdvbGQpOwp9CgouZGlzdGFuY2UtbGFiZWwgewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtdWkpOwogICAgZm9udC1zaXplOiA4cHg7CiAgICBjb2xvcjogdmFyKC0tZmZ4LWdvbGQpOwogICAgbGV0dGVyLXNwYWNpbmc6IDJweDsKICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7Cn0KCiNnb2FsLWRpc3RhbmNlIHsKICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LWRhdGEpOwogICAgZm9udC1zaXplOiAyNHB4OwogICAgY29sb3I6IHdoaXRlOwogICAgdGV4dC1zaGFkb3c6IDAgMCA1cHggdmFyKC0tZmZ4LWdvbGQpOwp9CgovKiAtLS0gU0VUVElOR1MgQlVUVE9OIC0tLSAqLwojc2V0dGluZ3MtYnV0dG9uIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMjQwcHg7CiAgICByaWdodDogMjBweDsKICAgIHdpZHRoOiAxMTBweDsKICAgIHBhZGRpbmc6IDhweCAwOwogICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgZm9udC1zaXplOiAxMHB4OwogICAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgICBjb2xvcjogIzg4ODsKICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsIHJnYmEoMjAsIDIwLCAyMCwgMC44KSAwJSwgcmdiYSgxMCwgMTAsIDEwLCAwLjkpIDEwMCUpOwogICAgYm9yZGVyOiAxcHggc29saWQgIzQ0NDsKICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICBsZXR0ZXItc3BhY2luZzogMXB4OwogICAgcG9pbnRlci1ldmVudHM6IGF1dG87CiAgICB0cmFuc2l0aW9uOiBhbGwgMC4yczsKICAgIHotaW5kZXg6IDEwMDsKfQoKI3NldHRpbmdzLWJ1dHRvbjpob3ZlciB7CiAgICBiYWNrZ3JvdW5kOiByZ2JhKDQwLCA0MCwgNDAsIDAuOSk7CiAgICBib3JkZXItY29sb3I6ICM4ODg7CiAgICBjb2xvcjogI2ZmZjsKfQoKLyogLS0tIFNFVFRJTkdTIFBBTkVMIC0tLSAqLwojc2V0dGluZ3MtcGFuZWwgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiA1MCU7CiAgICBsZWZ0OiA1MCU7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKTsKICAgIHdpZHRoOiAyODBweDsKICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxNjBkZWcsIHJnYmEoMCwgMjAsIDUwLCAwLjk4KSAwJSwgcmdiYSgwLCAxMCwgMjAsIDAuOTkpIDEwMCUpOwogICAgYm9yZGVyOiAycHggc29saWQgdmFyKC0tZmZ4LWN5YW4pOwogICAgYm9yZGVyLXJhZGl1czogMTBweDsKICAgIGJveC1zaGFkb3c6IDAgMCAzMHB4IHJnYmEoMCwgMTAwLCAyNTUsIDAuNCk7CiAgICB6LWluZGV4OiAzNTAwOwogICAgcG9pbnRlci1ldmVudHM6IGF1dG87CiAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoMTBweCk7Cn0KCi5zZXR0aW5ncy1oZWFkZXIgewogICAgZGlzcGxheTogZmxleDsKICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICBwYWRkaW5nOiAxNXB4OwogICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHJnYmEoMTAwLCAyMDAsIDI1NSwgMC4zKTsKICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgMzAsIDYwLCAwLjUpOwp9Cgouc2V0dGluZ3MtaGVhZGVyIHNwYW4gewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtdGl0bGUpOwogICAgZm9udC1zaXplOiAyMHB4OwogICAgY29sb3I6IHdoaXRlOwogICAgdGV4dC1zaGFkb3c6IDAgMCA1cHggdmFyKC0tZmZ4LWN5YW4pOwogICAgbGV0dGVyLXNwYWNpbmc6IDNweDsKfQoKI3NldHRpbmdzLWNsb3NlIHsKICAgIHdpZHRoOiAzMHB4OwogICAgaGVpZ2h0OiAzMHB4OwogICAgYm9yZGVyOiAxcHggc29saWQgI2ZmNDQ0NDsKICAgIGJhY2tncm91bmQ6IHJnYmEoNTAsIDAsIDAsIDAuNSk7CiAgICBjb2xvcjogI2ZmNDQ0NDsKICAgIGZvbnQtc2l6ZTogMTRweDsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIGJvcmRlci1yYWRpdXM6IDVweDsKICAgIHRyYW5zaXRpb246IGFsbCAwLjJzOwp9Cgojc2V0dGluZ3MtY2xvc2U6aG92ZXIgewogICAgYmFja2dyb3VuZDogI2ZmNDQ0NDsKICAgIGNvbG9yOiB3aGl0ZTsKfQoKLnNldHRpbmdzLWNvbnRlbnQgewogICAgcGFkZGluZzogMjBweDsKfQoKLnNldHRpbmctcm93IHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgbWFyZ2luLWJvdHRvbTogMTVweDsKICAgIHBhZGRpbmc6IDEwcHg7CiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDAsIDAsIDAuMyk7CiAgICBib3JkZXItcmFkaXVzOiA1cHg7Cn0KCi5zZXR0aW5nLXJvdyBsYWJlbCB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC1kYXRhKTsKICAgIGZvbnQtc2l6ZTogMTRweDsKICAgIGNvbG9yOiAjY2NjOwp9Cgouc2V0dGluZy1yb3cgaW5wdXRbdHlwZT0icmFuZ2UiXSB7CiAgICB3aWR0aDogMTAwcHg7CiAgICBhY2NlbnQtY29sb3I6IHZhcigtLWZmeC1jeWFuKTsKfQoKLnNldHRpbmctcm93IGlucHV0W3R5cGU9ImNoZWNrYm94Il0gewogICAgd2lkdGg6IDIwcHg7CiAgICBoZWlnaHQ6IDIwcHg7CiAgICBhY2NlbnQtY29sb3I6IHZhcigtLWZmeC1jeWFuKTsKICAgIGN1cnNvcjogcG9pbnRlcjsKfQoKLyogLS0tIEdMQVJFIEFOSU1BVElPTiAtLS0gKi8KQGtleWZyYW1lcyBnbGFyZVBhc3MgewogICAgMCUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTEwMCUpIHJvdGF0ZSg0NWRlZyk7IH0KICAgIDMwJSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlWCgxMDAlKSByb3RhdGUoNDVkZWcpOyB9CiAgICAxMDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKDEwMCUpIHJvdGF0ZSg0NWRlZyk7IH0KfQoKLyogLS0tIFNUQVRVUyBUWVBFIEZMT0FUSU5HIFRFWFQgLS0tICovCi5mbG9hdGluZy10ZXh0LWlubmVyLnN0YXR1cyB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC1kYXRhKTsKICAgIGZvbnQtc2l6ZTogMjhweDsKICAgIGZvbnQtc3R5bGU6IGl0YWxpYzsKICAgIGNvbG9yOiAjZmYwMGZmOwogICAgdGV4dC1zaGFkb3c6IDAgMCAxMHB4ICNmZjAwZmYsIDJweCAycHggMCAjMDAwOwogICAgYW5pbWF0aW9uOiBzdGF0dXNQb3AgMS4ycyBlYXNlLW91dCBmb3J3YXJkczsKfQoKQGtleWZyYW1lcyBzdGF0dXNQb3AgewogICAgMCUgeyB0cmFuc2Zvcm06IHNjYWxlKDAuNSkgdHJhbnNsYXRlWSgwKTsgb3BhY2l0eTogMDsgfQogICAgMjAlIHsgdHJhbnNmb3JtOiBzY2FsZSgxLjMpIHRyYW5zbGF0ZVkoLTEwcHgpOyBvcGFjaXR5OiAxOyB9CiAgICAxMDAlIHsgdHJhbnNmb3JtOiBzY2FsZSgxLjApIHRyYW5zbGF0ZVkoLTQwcHgpOyBvcGFjaXR5OiAwOyB9Cn0KCi8qIC0tLSBHT0FMIFRZUEUgRkxPQVRJTkcgVEVYVCAtLS0gKi8KLmZsb2F0aW5nLXRleHQtaW5uZXIuZ29hbCB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC1kYXRhKTsKICAgIGZvbnQtc2l6ZTogNDhweDsKICAgIGZvbnQtd2VpZ2h0OiA5MDA7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQodG8gYm90dG9tLCAjZmZmIDAlLCAjZmZkNzAwIDUwJSwgI2ZmODgwMCAxMDAlKTsKICAgIC13ZWJraXQtYmFja2dyb3VuZC1jbGlwOiB0ZXh0OwogICAgLXdlYmtpdC10ZXh0LWZpbGwtY29sb3I6IHRyYW5zcGFyZW50OwogICAgZmlsdGVyOiBkcm9wLXNoYWRvdygwIDRweCA0cHggcmdiYSgwLDAsMCwwLjkpKTsKICAgIGFuaW1hdGlvbjogZ29hbFBvcCAxcyBjdWJpYy1iZXppZXIoMC4xNzUsIDAuODg1LCAwLjMyLCAxLjI3NSkgZm9yd2FyZHM7Cn0KCkBrZXlmcmFtZXMgZ29hbFBvcCB7CiAgICAwJSB7IHRyYW5zZm9ybTogc2NhbGUoMCkgcm90YXRlKC0xMGRlZyk7IG9wYWNpdHk6IDA7IH0KICAgIDUwJSB7IHRyYW5zZm9ybTogc2NhbGUoMS41KSByb3RhdGUoNWRlZyk7IG9wYWNpdHk6IDE7IH0KICAgIDEwMCUgeyB0cmFuc2Zvcm06IHNjYWxlKDEuMikgcm90YXRlKDBkZWcpOyBvcGFjaXR5OiAwOyB9Cn0KCi8qIC0tLSBERUZBVUxUIFRZUEUgRkxPQVRJTkcgVEVYVCAtLS0gKi8KLmZsb2F0aW5nLXRleHQtaW5uZXIuZGVmYXVsdCB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC1kYXRhKTsKICAgIGZvbnQtc2l6ZTogMjRweDsKICAgIGNvbG9yOiB3aGl0ZTsKICAgIHRleHQtc2hhZG93OiAwIDJweCA0cHggcmdiYSgwLDAsMCwwLjgpOwphbmltYXRpb246IGZsb2F0VXAgMC44cyBlYXNlLW91dCBmb3J3YXJkczsKfQoKLyogLS0tIFZFUlNVUyBDTEFTSCBURVhUIC0tLSAqLwovKiAtLS0gVkVSU1VTIENMQVNIIFRFWFQgUkVNT1ZFRCAtLS0gKi8=","./style.css":"data:text/css;base64,OnJvb3QgewogICAgLS1mZngtYmx1ZS1kZWVwOiAjMDIwNDA4OwogICAgLS1mZngtYmx1ZS1kYXJrOiAjMGExNTI1OwogICAgLS1mZngtYmx1ZS1taWQ6ICMxNTJhNDU7CiAgICAtLWZmeC1ibHVlLWxpZ2h0OiAjMmE0ZDc1OwogICAgLS1mZngtY3lhbjogIzYwYzBkMDsKICAgIC0tZmZ4LWN5YW4tZ2xvdzogIzAwZmZmZjsKICAgIC0tZmZ4LWdvbGQ6ICNjOGIwNjA7CiAgICAtLWZmeC1nb2xkLWxpZ2h0OiAjZjBlMDkwOwogICAgLS1mZngtZ29sZC1kYXJrOiAjOGE3MDMwOwogICAgLS1mZngtZ2xhc3MtYmc6IHJnYmEoMTAsIDIwLCA0MCwgMC43NSk7CiAgICAtLWZmeC1nbGFzcy1ib3JkZXI6IHJnYmEoMTAwLCAyMDAsIDI1NSwgMC4zKTsKICAgIAogICAgLS1mb250LXRpdGxlOiAnR2FyYW1vbmQnLCAnVGltZXMgTmV3IFJvbWFuJywgc2VyaWY7CiAgICAtLWZvbnQtZGF0YTogJ0ltcGFjdCcsICdBcmlhbCBOYXJyb3cnLCBzYW5zLXNlcmlmOwogICAgLS1mb250LXVpOiAnQ291cmllciBOZXcnLCBtb25vc3BhY2U7Cn0KCmh0bWwsIGJvZHkgewogICAgbWFyZ2luOiAwOwogICAgcGFkZGluZzogMDsKICAgIGJhY2tncm91bmQtY29sb3I6ICMwMDA7CiAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgLyogRm9yY2UgZnVsbCB2aWV3cG9ydCBmaWxsICovCiAgICB3aWR0aDogMTAwdnc7CiAgICBoZWlnaHQ6IDEwMCU7CiAgICAvKiBGaXhlcyBtb2JpbGUgc2Nyb2xsIGJvdW5jZSBhbmQgbGF5b3V0IGlzc3VlcyAqLwogICAgcG9zaXRpb246IGZpeGVkOyAKICAgIHRvcDogMDsKICAgIGxlZnQ6IDA7CiAgICByaWdodDogMDsKICAgIGJvdHRvbTogMDsKICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LWRhdGEpOwogICAgY29sb3I6IHdoaXRlOwogICAgdXNlci1zZWxlY3Q6IG5vbmU7CiAgICAtd2Via2l0LXVzZXItc2VsZWN0OiBub25lOwogICAgLyogRW5zdXJlIG5vIHNhZmUtYXJlYSBnYXBzIG9uIG5vdGNoZWQgcGhvbmVzICovCiAgICBwYWRkaW5nLXRvcDogZW52KHNhZmUtYXJlYS1pbnNldC10b3ApOwogICAgcGFkZGluZy1ib3R0b206IGVudihzYWZlLWFyZWEtaW5zZXQtYm90dG9tKTsKICAgIHBhZGRpbmctbGVmdDogZW52KHNhZmUtYXJlYS1pbnNldC1sZWZ0KTsKICAgIHBhZGRpbmctcmlnaHQ6IGVudihzYWZlLWFyZWEtaW5zZXQtcmlnaHQpOwp9CgovKiAtLS0gTUFJTiBHQU1FIENPTlRBSU5FUiAtLS0gKi8KI2dhbWUtY29udGFpbmVyIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMDsKICAgIGxlZnQ6IDA7CiAgICB3aWR0aDogMTAwJTsKICAgIGhlaWdodDogMTAwJTsKICAgIG1heC13aWR0aDogbm9uZTsKICAgIGJhY2tncm91bmQ6ICMwMDA1MTA7CiAgICBib3gtc2hhZG93OiBub25lOwogICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgIHRyYW5zaXRpb246IGZpbHRlciAwLjA1czsKICAgIHotaW5kZXg6IDE7Cn0KCi8qIC0tLSBJTVBBQ1QgRlggKENocm9tYXRpYyBBYmVycmF0aW9uIC8gU2hvY2spIC0tLSAqLwojZ2FtZS1jb250YWluZXIuaW1wYWN0LWZ4IHsKICAgIGFuaW1hdGlvbjogaW1wYWN0U2hha2UgMC4xcyBlYXNlLWluLW91dDsKICAgIGZpbHRlcjogY29udHJhc3QoMS4yKSBicmlnaHRuZXNzKDEuMSk7Cn0KCiNnYW1lLWNvbnRhaW5lci5pbXBhY3QtaGVhdnkgewogICAgYW5pbWF0aW9uOiBpbXBhY3RTaGFrZSAwLjJzIGVhc2UtaW4tb3V0OwogICAgZmlsdGVyOiBjb250cmFzdCgxLjUpIGJyaWdodG5lc3MoMS4zKSBzZXBpYSgwLjQpIGh1ZS1yb3RhdGUoLTEwZGVnKTsKfQoKI2dhbWUtY29udGFpbmVyLmltcGFjdC1zaGF0dGVyIHsKICAgIGFuaW1hdGlvbjogaW1wYWN0U2hha2UgMC40cyBlYXNlLWluLW91dDsKICAgIGZpbHRlcjogY29udHJhc3QoMi4wKSBpbnZlcnQoMC4xKSBzYXR1cmF0ZSgyLjApOwp9CgpAa2V5ZnJhbWVzIGltcGFjdFNoYWtlIHsKICAgIDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoMCwgMCk7IH0KICAgIDI1JSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC01cHgsIDVweCk7IH0KICAgIDUwJSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKDVweCwgLTVweCk7IH0KICAgIDc1JSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC01cHgsIC01cHgpOyB9CiAgICAxMDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoMCwgMCk7IH0KfQoKLyogQXNwZWN0IFJhdGlvIGNvbnN0cmFpbnRzIHJlbW92ZWQgZm9yIGZ1bGwgc2NyZWVuICovCgovKiAtLS0gQ0FOVkFTICYgUkVOREVSIC0tLSAqLwpjYW52YXMgewogICAgZGlzcGxheTogYmxvY2s7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IDA7CiAgICBsZWZ0OiAwOwogICAgd2lkdGg6IDEwMCU7CiAgICBoZWlnaHQ6IDEwMCU7CiAgICAvKiBQU1gvUmV0cm8gRmVlbCAqLwogICAgaW1hZ2UtcmVuZGVyaW5nOiBwaXhlbGF0ZWQ7IAogICAgei1pbmRleDogMDsKfQoKLyogLS0tIEdMT0JBTCBPVkVSTEFZUyAoU2NhbmxpbmVzICYgVmlnbmV0dGUpIC0tLSAqLwojZ2FtZS1jb250YWluZXI6OmFmdGVyIHsKICAgIGNvbnRlbnQ6ICIiOwogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiAwOyBsZWZ0OiAwOyB3aWR0aDogMTAwJTsgaGVpZ2h0OiAxMDAlOwogICAgYmFja2dyb3VuZDogCiAgICAgICAgbGluZWFyLWdyYWRpZW50KHJnYmEoMTgsIDE2LCAxNiwgMCkgNTAlLCByZ2JhKDAsIDAsIDAsIDAuMSkgNTAlKSwKICAgICAgICByYWRpYWwtZ3JhZGllbnQoY2lyY2xlIGF0IGNlbnRlciwgdHJhbnNwYXJlbnQgNjAlLCByZ2JhKDAsMCwwLDAuNCkgMTAwJSk7CiAgICBiYWNrZ3JvdW5kLXNpemU6IDEwMCUgNHB4LCAxMDAlIDEwMCU7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgIHotaW5kZXg6IDkwMDsKICAgIG9wYWNpdHk6IDAuMDU7Cn0KCi8qIC0tLSBWSURFTyBPVkVSTEFZIC0tLSAqLwovKiAtLS0gR0lGIE9WRVJMQVkgLS0tICovCiNzY3JlZW4tb3ZlcmxheS1naWYgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiAwOyBsZWZ0OiAwOwogICAgd2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTsKICAgIG9iamVjdC1maXQ6IGNvdmVyOwptaXgtYmxlbmQtbW9kZTogc29mdC1saWdodDsKICAgIG9wYWNpdHk6IDAuNzI7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgIHotaW5kZXg6IDk1MDsKICAgIGltYWdlLXJlbmRlcmluZzogcGl4ZWxhdGVkOyAvKiBOZWFyZXN0IE5laWdoYm9yICovCn0KCiN1aS1sYXllciB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IDA7IGxlZnQ6IDA7IHdpZHRoOiAxMDAlOyBoZWlnaHQ6IDEwMCU7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOwogICAgei1pbmRleDogMTAwMDsKfQoKLyogLS0tIENJTkVNQVRJQyBCQVJTIC0tLSAqLwojY2luZW1hdGljLWJhcnMgLmJhciB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICBsZWZ0OiAwOyB3aWR0aDogMTAwJTsgaGVpZ2h0OiAwOwogICAgYmFja2dyb3VuZDogYmxhY2s7CiAgICB0cmFuc2l0aW9uOiBoZWlnaHQgMC41cyBlYXNlOwogICAgei1pbmRleDogODAwOwp9CiNjaW5lbWF0aWMtYmFycyAuYmFyLnRvcCB7IHRvcDogMDsgfQojY2luZW1hdGljLWJhcnMgLmJhci5ib3R0b20geyBib3R0b206IDA7IH0KCi8qIC0tLSBURUNIIEZMQVNIIE9WRVJMQVkgKFRlY2hjb3B5KSAtLS0gKi8KI3RlY2gtZmxhc2gtb3ZlcmxheSB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IDIwJTsgbGVmdDogMDsgd2lkdGg6IDEwMCU7IGhlaWdodDogMTIwcHg7CiAgICBkaXNwbGF5OiBub25lOyAvKiBUb2dnbGVkIGJ5IEpTICovCiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCByZ2JhKDAsMCwwLDApIDAlLCByZ2JhKDAsIDIwLCA2MCwgMC45KSAyMCUsIHJnYmEoMCwgMjAsIDYwLCAwLjkpIDgwJSwgcmdiYSgwLDAsMCwwKSAxMDAlKTsKICAgIHotaW5kZXg6IDIyMDA7CiAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoMnB4KTsKICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCByZ2JhKDEwMCwgMjU1LCAyNTUsIDAuMyk7CiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgcmdiYSgxMDAsIDI1NSwgMjU1LCAwLjMpOwogICAgYW5pbWF0aW9uOiBmbGFzaEVudGVyIDAuMTVzIGVhc2Utb3V0Owp9CgpAa2V5ZnJhbWVzIGZsYXNoRW50ZXIgewogICAgZnJvbSB7IHRyYW5zZm9ybTogc2NhbGVZKDApOyBvcGFjaXR5OiAwOyB9CiAgICB0byB7IHRyYW5zZm9ybTogc2NhbGVZKDEpOyBvcGFjaXR5OiAxOyB9Cn0KCi50ZWNoLWNvbnRlbnQtd3JhcHBlciB7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICB0cmFuc2Zvcm06IHNrZXdYKC0xMGRlZyk7Cn0KCi50ZWNoLXRleHQgewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtZGF0YSk7CiAgICBmb250LXNpemU6IGNsYW1wKDI4cHgsIDEwdncsIDQycHgpOyAvKiBEeW5hbWljICovCiAgICBjb2xvcjogI2ZmZmZmZjsKICAgIHRleHQtc2hhZG93OiAwIDAgMTBweCAjMDBmZmZmLCAwIDAgMjBweCAjMDAwMGZmOwogICAgbGV0dGVyLXNwYWNpbmc6IDNweDsKICAgIG1hcmdpbi1ib3R0b206IDJweDsKICAgIGZvbnQtc3R5bGU6IGl0YWxpYzsKICAgIGFuaW1hdGlvbjogYmxpbmtUZXh0IDAuMDhzIGluZmluaXRlIGFsdGVybmF0ZTsKICAgIHRleHQtYWxpZ246IGNlbnRlcjsKfQoKLnRlY2gtc3ViLXRleHQgewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtdWkpOwogICAgZm9udC1zaXplOiAxNHB4OwogICAgY29sb3I6ICMwMGZmZmY7CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgbGV0dGVyLXNwYWNpbmc6IDJweDsKICAgIG1hcmdpbi1ib3R0b206IDhweDsKICAgIHRleHQtc2hhZG93OiAwIDAgNXB4IHJnYmEoMCwgMjU1LCAyNTUsIDAuNSk7Cn0KCi50ZWNoLXRpbWVyLXRyYWNrIHsKICAgIHdpZHRoOiAyNTBweDsKICAgIGhlaWdodDogOHB4OwogICAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjYpOwogICAgYm9yZGVyOiAxcHggc29saWQgIzQ0NDsKICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICBib3gtc2hhZG93OiAwIDAgMTBweCByZ2JhKDAsMCwwLDAuNSk7Cn0KCi50ZWNoLXRpbWVyLWZpbGwgewogICAgaGVpZ2h0OiAxMDAlOwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjZmZmZmZmLCAjMDBmZmZmKTsKICAgIHdpZHRoOiAxMDAlOwogICAgdHJhbnNmb3JtLW9yaWdpbjogbGVmdDsKICAgIGJveC1zaGFkb3c6IDAgMCAxMHB4ICMwMGZmZmY7Cn0KCkBrZXlmcmFtZXMgYmxpbmtUZXh0IHsKICAgIGZyb20geyBvcGFjaXR5OiAwLjg7IHRleHQtc2hhZG93OiAwIDAgNXB4ICMwMGZmZmY7IHRyYW5zZm9ybTogc2NhbGUoMSk7IH0KICAgIHRvIHsgb3BhY2l0eTogMS4wOyB0ZXh0LXNoYWRvdzogMCAwIDIwcHggI2ZmZmZmZiwgMCAwIDEwcHggIzAwZmZmZjsgdHJhbnNmb3JtOiBzY2FsZSgxLjAyKTsgfQp9CgovKiAtLS0gSFVEIFRPUCAoVGhlIENyeXN0YWwgSW50ZXJmYWNlKSAtLS0gKi8KI2h1ZC10b3AgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiAwOwogICAgbGVmdDogMDsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgICBhbGlnbi1pdGVtczogZmxleC1zdGFydDsKICAgIHdpZHRoOiAxMDAlOwogICAgcGFkZGluZzogMTVweDsKICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQodG8gYm90dG9tLCByZ2JhKDAsIDUsIDE1LCAwLjkpIDAlLCByZ2JhKDAsMCwwLDApIDEwMCUpOwogICAgcG9pbnRlci1ldmVudHM6IG5vbmU7Cn0KCi8qIFRlYW0gV2luZ3MgKi8KLnRlYW0td2luZyB7CiAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgIHdpZHRoOiAxMzBweDsKICAgIGhlaWdodDogNTBweDsKICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxNjBkZWcsIHZhcigtLWZmeC1ibHVlLW1pZCkgMCUsIHZhcigtLWZmeC1ibHVlLWRlZXApIDEwMCUpOwogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tZmZ4LWJsdWUtbGlnaHQpOwogICAgYm9yZGVyLXRvcDogMnB4IHNvbGlkIHZhcigtLWZmeC1jeWFuKTsKICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgIHRyYW5zZm9ybTogc2tld1goLTE1ZGVnKTsKICAgIGJveC1zaGFkb3c6IDAgNXB4IDE1cHggcmdiYSgwLCAwLCAwLCAwLjUpOwogICAgcGFkZGluZzogMCAxMHB4Owp9CgoudGVhbS13aW5nLmF3YXkgewogICAgdHJhbnNmb3JtOiBza2V3WCgxNWRlZyk7CiAgICBmbGV4LWRpcmVjdGlvbjogcm93LXJldmVyc2U7CiAgICBib3JkZXItdG9wLWNvbG9yOiAjZmY2NjY2OyAvKiBSZWQgdGludCBmb3IgZW5lbXkgKi8KICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgtMTYwZGVnLCAjMmExMDEwIDAlLCAjMTAwNTA1IDEwMCUpOwp9CgoudGVhbS1kYXRhIHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICB0cmFuc2Zvcm06IHNrZXdYKDE1ZGVnKTsgLyogQ291bnRlciBza2V3ICovCn0KLnRlYW0td2luZy5hd2F5IC50ZWFtLWRhdGEgeyB0cmFuc2Zvcm06IHNrZXdYKC0xNWRlZyk7IHRleHQtYWxpZ246IHJpZ2h0OyB9CgoudGVhbS1uYW1lIHsKICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LXRpdGxlKTsKICAgIGZvbnQtc2l6ZTogMTRweDsKICAgIGNvbG9yOiB2YXIoLS1mZngtZ29sZC1saWdodCk7CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgbGV0dGVyLXNwYWNpbmc6IDFweDsKICAgIHRleHQtc2hhZG93OiAwIDJweCAycHggcmdiYSgwLDAsMCwwLjgpOwp9Ci50ZWFtLXN1YiB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC1kYXRhKTsKICAgIGZvbnQtc2l6ZTogMTBweDsKICAgIGNvbG9yOiB2YXIoLS1mZngtY3lhbik7CiAgICBvcGFjaXR5OiAwLjg7Cn0KLnRlYW0td2luZy5hd2F5IC50ZWFtLXN1YiB7IGNvbG9yOiAjZmZhYWFhOyB9Cgouc2NvcmUtYm94IHsKICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LWRhdGEpOwogICAgZm9udC1zaXplOiAzOHB4OwogICAgY29sb3I6IHdoaXRlOwogICAgdGV4dC1zaGFkb3c6IDAgMCAxMHB4IHZhcigtLWZmeC1jeWFuLWdsb3cpOwogICAgdHJhbnNmb3JtOiBza2V3WCgxNWRlZyk7CiAgICBtYXJnaW46IDAgMTBweDsKfQoudGVhbS13aW5nLmF3YXkgLnNjb3JlLWJveCB7IHRyYW5zZm9ybTogc2tld1goLTE1ZGVnKTsgdGV4dC1zaGFkb3c6IDAgMCAxMHB4ICNmZjQ0NDQ7IH0KCi8qIFRpbWVyIENvbXBsZXggKi8KLnRpbWVyLWNvbXBsZXggewogICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgZGlzcGxheTogZmxleDsKICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgbWFyZ2luLXRvcDogLTVweDsKfQoKLnRpbWVyLWNyeXN0YWwtcmluZyB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IC0yNXB4OwogICAgd2lkdGg6IDEyMHB4OwogICAgaGVpZ2h0OiA2MHB4OwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgYm9yZGVyLXRvcDogM3B4IHNvbGlkIHZhcigtLWZmeC1nb2xkKTsKICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCB0cmFuc3BhcmVudDsKICAgIGJveC1zaGFkb3c6IDAgLTVweCAxNXB4IHJnYmEoMjAwLCAxODAsIDEwMCwgMC4zKTsKICAgIHotaW5kZXg6IC0xOwogICAgYmFja2dyb3VuZDogcmFkaWFsLWdyYWRpZW50KGVsbGlwc2UgYXQgdG9wLCByZ2JhKDIwLCA0MCwgODAsIDAuOCksIHRyYW5zcGFyZW50IDcwJSk7Cn0KCiNoYWxmLWluZGljYXRvciB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC1kYXRhKTsKICAgIGZvbnQtc2l6ZTogMTBweDsKICAgIGNvbG9yOiB2YXIoLS1mZngtZ29sZCk7CiAgICBsZXR0ZXItc3BhY2luZzogMnB4OwogICAgbWFyZ2luLWJvdHRvbTogLTJweDsKICAgIHRleHQtc2hhZG93OiAwIDAgNXB4IHZhcigtLWZmeC1nb2xkLWRhcmspOwp9CgojdGltZXItZGlzcGxheSB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC1kYXRhKTsKICAgIGZvbnQtc2l6ZTogNDJweDsKICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCh0byBib3R0b20sICNmZmYgMCUsICNmZmQ3MDAgNTAlLCAjYjg4NjBiIDEwMCUpOwogICAgLXdlYmtpdC1iYWNrZ3JvdW5kLWNsaXA6IHRleHQ7CiAgICAtd2Via2l0LXRleHQtZmlsbC1jb2xvcjogdHJhbnNwYXJlbnQ7CiAgICBmaWx0ZXI6IGRyb3Atc2hhZG93KDJweCAycHggMHB4IHJnYmEoMCwwLDAsMC44KSk7CiAgICBsZXR0ZXItc3BhY2luZzogMXB4Owp9CgovKiAtLS0gUExBWUVSIFNUQVRVUyBQQU5FTCAoQm90dG9tIExlZnQpIC0tLSAqLwojcGxheWVyLXN0YXR1cy1wYW5lbCB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICBib3R0b206IDE2MHB4OyAvKiBBYm92ZSBqb3lzdGljayAqLwogICAgbGVmdDogMjBweDsKICAgIHdpZHRoOiAxNjBweDsKICAgIHBhZGRpbmc6IDEwcHg7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsIHJnYmEoMCwgMTAsIDMwLCAwLjgpIDAlLCByZ2JhKDAsMCwwLDApIDEwMCUpOwogICAgYm9yZGVyLWxlZnQ6IDNweCBzb2xpZCB2YXIoLS1mZngtY3lhbik7CiAgICBib3JkZXItcmFkaXVzOiAwIDEwcHggMTBweCAwOwogICAgYmFja2Ryb3AtZmlsdGVyOiBibHVyKDRweCk7CiAgICB0cmFuc2Zvcm06IHNrZXdYKC0xMGRlZyk7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgIGRpc3BsYXk6IG5vbmU7IC8qIEhpZGRlbiBieSBkZWZhdWx0LCBzaG93biBieSBKUyAqLwp9CgouY2hhci1uYW1lIHsKICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LXRpdGxlKTsKICAgIGZvbnQtc2l6ZTogMThweDsKICAgIGNvbG9yOiB3aGl0ZTsKICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICBtYXJnaW4tYm90dG9tOiA1cHg7CiAgICB0cmFuc2Zvcm06IHNrZXdYKDEwZGVnKTsKICAgIHRleHQtc2hhZG93OiAwIDAgNXB4IHZhcigtLWZmeC1ibHVlLWxpZ2h0KTsKfQoKLmhwLWdhdWdlLWNvbnRhaW5lciB7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgIG1hcmdpbi1ib3R0b206IDRweDsKICAgIHRyYW5zZm9ybTogc2tld1goMTBkZWcpOwp9Ci5ocC1sYWJlbCB7IGZvbnQtc2l6ZTogMTBweDsgY29sb3I6IHZhcigtLWZmeC1jeWFuKTsgd2lkdGg6IDIwcHg7IH0KLmhwLWJhci10cmFjayB7CiAgICBmbGV4LWdyb3c6IDE7CiAgICBoZWlnaHQ6IDZweDsKICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC41KTsKICAgIGJvcmRlcjogMXB4IHNvbGlkICM0NDQ7CiAgICBtYXJnaW46IDAgNXB4Owp9Ci5ocC1iYXItZmlsbCB7CiAgICBoZWlnaHQ6IDEwMCU7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsICMwMGZmMDAsICNjY2ZmY2MpOwogICAgYm94LXNoYWRvdzogMCAwIDVweCAjMDBmZjAwOwp9Ci5ocC12YWx1ZSB7IGZvbnQtc2l6ZTogMTBweDsgY29sb3I6ICNmZmY7IHdpZHRoOiA0NXB4OyB0ZXh0LWFsaWduOiByaWdodDsgfQoKLnRlY2gtZ2F1Z2UtY29udGFpbmVyIHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgdHJhbnNmb3JtOiBza2V3WCgxMGRlZyk7Cn0KLnRlY2gtbGFiZWwgeyBmb250LXNpemU6IDEwcHg7IGNvbG9yOiB2YXIoLS1mZngtZ29sZCk7IHdpZHRoOiAyMHB4OyB9Ci50ZWNoLWJhci10cmFjayB7CiAgICBmbGV4LWdyb3c6IDE7CiAgICBoZWlnaHQ6IDRweDsKICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC41KTsKICAgIGJvcmRlcjogMXB4IHNvbGlkICM0NDQ7CiAgICBtYXJnaW46IDAgNXB4Owp9Ci50ZWNoLWJhci1maWxsIHsKICAgIGhlaWdodDogMTAwJTsKICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCg5MGRlZywgI2ZmYWEwMCwgI2ZmZmZhYSk7Cn0KCi8qIC0tLSBNSU5JTUFQIChTcGhlcmUgUmFkYXIpIC0tLSAqLwojbWluaW1hcC1jb250YWluZXIgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiA4MHB4OwogICAgcmlnaHQ6IDIwcHg7CiAgICB3aWR0aDogMTEwcHg7CiAgICBoZWlnaHQ6IDExMHB4OwogICAgZGlzcGxheTogZmxleDsKICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKfQoKLnJhZGFyLXJpbSB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB3aWR0aDogMTAwJTsgaGVpZ2h0OiAxMDAlOwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgYm9yZGVyOiAycHggc29saWQgdmFyKC0tZmZ4LWJsdWUtbGlnaHQpOwogICAgYm94LXNoYWRvdzogMCAwIDE1cHggdmFyKC0tZmZ4LWJsdWUtbWlkKSwgaW5zZXQgMCAwIDIwcHggcmdiYSgwLDAsMCwwLjgpOwogICAgYmFja2dyb3VuZDogcmFkaWFsLWdyYWRpZW50KGNpcmNsZSwgcmdiYSgwLCAyMCwgNjAsIDAuNCkgMCUsIHJnYmEoMCwgNSwgMTAsIDAuOCkgMTAwJSk7CiAgICB6LWluZGV4OiA1Owp9CgojbWluaW1hcCB7CiAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICB3aWR0aDogMTAwcHg7CiAgICBoZWlnaHQ6IDEwMHB4OwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgei1pbmRleDogNjsKICAgIG92ZXJmbG93OiBoaWRkZW47Cn0KCi5yYWRhci1sYWJlbCB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICBib3R0b206IC0xNXB4OwogICAgd2lkdGg6IDEwMCU7CiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICBmb250LXNpemU6IDlweDsKICAgIGNvbG9yOiB2YXIoLS1mZngtY3lhbik7CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgbGV0dGVyLXNwYWNpbmc6IDFweDsKICAgIHRleHQtc2hhZG93OiAwIDAgNXB4IHZhcigtLWZmeC1jeWFuKTsKfQoKLyogTWFwIERvdHMgKi8KLm1hcC1kb3QgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgd2lkdGg6IDZweDsgaGVpZ2h0OiA2cHg7CiAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKTsgLyogQ2VudGVyIGFuY2hvciAqLwogICAgYm94LXNoYWRvdzogMCAwIDRweCBjdXJyZW50Q29sb3I7Cn0KLm1hcC1kb3QuaG9tZSB7IGJhY2tncm91bmQ6IHZhcigtLWZmeC1jeWFuKTsgY29sb3I6IHZhcigtLWZmeC1jeWFuKTsgfQoubWFwLWRvdC5hd2F5IHsgYmFja2dyb3VuZDogI2ZmNDQ0NDsgY29sb3I6ICNmZjQ0NDQ7IH0KLm1hcC1kb3QuYmFsbCB7IAogICAgYmFja2dyb3VuZDogI2ZmMDBjYzsgLyogSG90IFBpbmsgZm9yIHZpc2liaWxpdHkgKi8KICAgIGNvbG9yOiAjZmYwMGNjOyAKICAgIHdpZHRoOiAxMnB4OyBoZWlnaHQ6IDEycHg7CiAgICBib3JkZXI6IDJweCBzb2xpZCAjZmZmZmZmOwogICAgei1pbmRleDogMjA7CiAgICBhbmltYXRpb246IGJsaW5rQmFsbCAwLjNzIGluZmluaXRlIGFsdGVybmF0ZTsKICAgIGJveC1zaGFkb3c6IDAgMCA2cHggI2ZmMDBjYzsKfQoubWFwLWRvdC5uYXAgeyBiYWNrZ3JvdW5kOiAjMzMzOyBjb2xvcjogIzAwMDsgYm9yZGVyOiAxcHggc29saWQgIzU1NTsgfQoubWFwLWRvdC5hY3RpdmUtcGxheWVyIHsgCiAgICBiYWNrZ3JvdW5kOiAjMDBmZjAwICFpbXBvcnRhbnQ7IAogICAgY29sb3I6ICMwMGZmMDAgIWltcG9ydGFudDsgCiAgICBib3gtc2hhZG93OiAwIDAgOHB4ICMwMGZmMDA7CiAgICB6LWluZGV4OiAxNTsKdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSkgc2NhbGUoMS4yKTsKfQoKLm1hcC1kb3QuYmFsbC1jYXJyaWVyIHsKICAgIGJveC1zaGFkb3c6IDAgMCAxNXB4ICNmZmYsIDAgMCAzMHB4ICNmZmFhMDA7CiAgICBib3JkZXI6IDJweCBzb2xpZCAjZmZmZmZmOwogICAgYmFja2dyb3VuZC1jb2xvcjogI2ZmYWEwMCAhaW1wb3J0YW50OwogICAgei1pbmRleDogMTAwOwogICAgd2lkdGg6IDEwcHg7IGhlaWdodDogMTBweDsgLyogU2xpZ2h0bHkgbGFyZ2VyICovCiAgICBhbmltYXRpb246IGNhcnJpZXJQdWxzZSAwLjhzIGluZmluaXRlIGFsdGVybmF0ZTsKfQpAa2V5ZnJhbWVzIGNhcnJpZXJQdWxzZSB7CiAgICBmcm9tIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSkgc2NhbGUoMS4yKTsgYm94LXNoYWRvdzogMCAwIDEwcHggI2ZmZjsgb3BhY2l0eTogMC44OyB9CiAgICB0byB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpIHNjYWxlKDEuOCk7IGJveC1zaGFkb3c6IDAgMCAyNXB4ICNmZmNjMDA7IG9wYWNpdHk6IDEuMDsgfQp9CkBrZXlmcmFtZXMgYmxpbmtCYWxsIHsgZnJvbSB7IG9wYWNpdHk6IDE7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpIHNjYWxlKDEpOyB9IHRvIHsgb3BhY2l0eTogMC41OyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKSBzY2FsZSgxLjMpOyB9IH0KCi8qIC0tLSBBTk5PVU5DRU1FTlRTIChHb2FsLCBCbGl0em9mZikgLS0tICovCiNhbm5vdW5jZW1lbnQgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiA0MCU7IAogICAgbGVmdDogNSU7IAogICAgd2lkdGg6IDkwJTsKICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LWRhdGEpOwogICAgZm9udC1zaXplOiBjbGFtcCg0MHB4LCAxMnZ3LCA3MnB4KTsgLyogRHluYW1pYyBzaXppbmcgKi8KICAgIGZvbnQtd2VpZ2h0OiA5MDA7CiAgICBmb250LXN0eWxlOiBpdGFsaWM7CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgbGV0dGVyLXNwYWNpbmc6IDJweDsgLyogUmVkdWNlZCBzcGFjaW5nIHRvIGZpdCAqLwogICAgbGluZS1oZWlnaHQ6IDEuMDsKICAgIHdoaXRlLXNwYWNlOiBub3JtYWw7IC8qIEFsbG93IHdyYXBwaW5nICovCiAgICAKICAgIC8qIE1ldGFsbGljIEdvbGQgR3JhZGllbnQgKi8KICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCh0byBib3R0b20sICNmZmYgMCUsICNmZmQ3MDAgNDAlLCAjYjg4NjBiIDEwMCUpOwogICAgLXdlYmtpdC1iYWNrZ3JvdW5kLWNsaXA6IHRleHQ7CiAgICAtd2Via2l0LXRleHQtZmlsbC1jb2xvcjogdHJhbnNwYXJlbnQ7CiAgICBmaWx0ZXI6IGRyb3Atc2hhZG93KDAgMCAxMHB4IHJnYmEoMjU1LCAxMDAsIDAsIDAuNSkpIGRyb3Atc2hhZG93KDNweCAzcHggMCAjMDAwKTsKICAgIAogICAgZGlzcGxheTogbm9uZTsKICAgIHotaW5kZXg6IDIwMDA7CiAgICBhbmltYXRpb246IGFubm91bmNlU2xpZGUgMC41cyBjdWJpYy1iZXppZXIoMC4xNzUsIDAuODg1LCAwLjMyLCAxLjI3NSk7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsgLyogQ2xpY2sgdGhyb3VnaCAqLwp9CgpAa2V5ZnJhbWVzIGFubm91bmNlU2xpZGUgewogICAgZnJvbSB7IHRyYW5zZm9ybTogc2NhbGUoMCkgcm90YXRlKC01ZGVnKTsgb3BhY2l0eTogMDsgfQogICAgdG8geyB0cmFuc2Zvcm06IHNjYWxlKDEpIHJvdGF0ZSgwZGVnKTsgb3BhY2l0eTogMTsgfQp9CgovKiAtLS0gQ09OVFJPTFMgKFNQSEVSRSBHUklEIEFSVElGQUNUUykgLS0tICovCgovKiBKb3lzdGljazogVGhlIE5hdmlnYXRpb24gU3BoZXJlICovCi8qIC0tLSBKT1lTVElDSyAoRkxPQVRJTkcpIC0tLSAqLwojam95c3RpY2staGl0LXpvbmUgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgYm90dG9tOiAwOyBsZWZ0OiAwOwogICAgd2lkdGg6IDUwJTsgaGVpZ2h0OiA1MCU7CiAgICB6LWluZGV4OiAxMDAwOwogICAgLyogdHJhbnNwYXJlbnQgYnV0IGludGVyYWN0aXZlICovCiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDApOyAKICAgIHRvdWNoLWFjdGlvbjogbm9uZTsKICAgIHBvaW50ZXItZXZlbnRzOiBhdXRvOwp9Cgojam95c3RpY2stdmlzdWFsLWNvbnRhaW5lciB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IDA7IGxlZnQ6IDA7CiAgICB3aWR0aDogMDsgaGVpZ2h0OiAwOwogICAgb3ZlcmZsb3c6IHZpc2libGU7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgIGRpc3BsYXk6IG5vbmU7IC8qIEhpZGRlbiB1bnRpbCB0b3VjaGVkICovCiAgICB6LWluZGV4OiAxMTAwOwp9Cgojam95c3RpY2stYmFzZSB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IDUwJTsgbGVmdDogNTAlOwogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSk7CiAgICB3aWR0aDogMTIwcHg7IGhlaWdodDogMTIwcHg7CiAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICAKICAgIC8qIEdsYXNzeSBCYXNlICovCiAgICBiYWNrZ3JvdW5kOiByYWRpYWwtZ3JhZGllbnQoY2lyY2xlLCByZ2JhKDAsIDQwLCA4MCwgMC40KSAwJSwgcmdiYSgwLCAxMCwgMjAsIDAuMSkgNjAlLCB0cmFuc3BhcmVudCAxMDAlKTsKICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMTAwLCAyMjAsIDI1NSwgMC4zKTsKICAgIGJveC1zaGFkb3c6IDAgMCAyMHB4IHJnYmEoMCwgMTAwLCAyNTUsIDAuMiksIGluc2V0IDAgMCAzMHB4IHJnYmEoMCwgNTAsIDEwMCwgMC4zKTsKICAgIAogICAgYW5pbWF0aW9uOiBiYXNlUHVsc2UgMnMgaW5maW5pdGUgYWx0ZXJuYXRlOwp9CgpAa2V5ZnJhbWVzIGJhc2VQdWxzZSB7CiAgICBmcm9tIHsgYm94LXNoYWRvdzogMCAwIDEwcHggcmdiYSgwLCAxMDAsIDI1NSwgMC4yKTsgYm9yZGVyLWNvbG9yOiByZ2JhKDEwMCwgMjIwLCAyNTUsIDAuMik7IH0KICAgIHRvIHsgYm94LXNoYWRvdzogMCAwIDI1cHggcmdiYSgwLCAxMDAsIDI1NSwgMC41KTsgYm9yZGVyLWNvbG9yOiByZ2JhKDEwMCwgMjU1LCAyNTUsIDAuNik7IH0KfQoKI2pveXN0aWNrLWtub2IgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiA1MCU7IGxlZnQ6IDUwJTsKICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpOyAvKiBDZW50ZXJlZCBpbml0aWFsbHksIG1vdmVkIGJ5IEpTICovCiAgICB3aWR0aDogNTBweDsgaGVpZ2h0OiA1MHB4OwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgCiAgICAvKiBTcGhlcmUgTG9vazogQ3lhbi9CbHVlICovCiAgICBiYWNrZ3JvdW5kOiByYWRpYWwtZ3JhZGllbnQoY2lyY2xlIGF0IDMwJSAzMCUsICNlMGZmZmYgMCUsICMwMGFhZmYgNDAlLCAjMDA0NDg4IDgwJSwgIzAwMTEyMiAxMDAlKTsKICAgIGJvcmRlcjogMnB4IHNvbGlkICM4OGNjZmY7CiAgICBib3gtc2hhZG93OiAwIDAgMTVweCAjMDBmZmZmLCBpbnNldCAwIDAgMTBweCByZ2JhKDI1NSwyNTUsMjU1LDAuOCk7CiAgICAKICAgIHRyYW5zaXRpb246IHRyYW5zZm9ybSAwLjA1cyBsaW5lYXI7Cn0KCi8qIElubmVyIGxpZ2h0IG9mIGtub2IgKi8KI2pveXN0aWNrLWtub2I6OmFmdGVyIHsKICAgIGNvbnRlbnQ6ICIiOwogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiAyMCU7IGxlZnQ6IDIwJTsgd2lkdGg6IDIwJTsgaGVpZ2h0OiAyMCU7CiAgICBiYWNrZ3JvdW5kOiByYWRpYWwtZ3JhZGllbnQoY2lyY2xlLCAjZmZmZmZmIDAlLCB0cmFuc3BhcmVudCA3MCUpOwogICAgZmlsdGVyOiBibHVyKDJweCk7CiAgICBvcGFjaXR5OiAwLjg7Cn0KCi8qIC0tLSBUT1VDSCBSSVBQTEUgRlggLS0tICovCi50b3VjaC1yaXBwbGUgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgYmFja2dyb3VuZDogcmFkaWFsLWdyYWRpZW50KGNpcmNsZSwgcmdiYSgyMDAsIDI1NSwgMjU1LCAwLjgpIDAlLCByZ2JhKDAsIDI1NSwgMjU1LCAwLjQpIDQwJSwgdHJhbnNwYXJlbnQgNzAlKTsKICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpIHNjYWxlKDApOwogICAgYW5pbWF0aW9uOiByaXBwbGVBbmltIDAuNnMgZWFzZS1vdXQgZm9yd2FyZHM7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgIHotaW5kZXg6IDkwMDA7CiAgICBtaXgtYmxlbmQtbW9kZTogc2NyZWVuOwp9CgpAa2V5ZnJhbWVzIHJpcHBsZUFuaW0gewogICAgMCUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKSBzY2FsZSgwKTsgb3BhY2l0eTogMTsgfQogICAgMTAwJSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpIHNjYWxlKDMuMCk7IG9wYWNpdHk6IDA7IH0KfQoKI2NhbWVyYS16b25lIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMDsgcmlnaHQ6IDA7IHdpZHRoOiA1MCU7IGhlaWdodDogMTAwJTsKICAgIHBvaW50ZXItZXZlbnRzOiBhdXRvOwogICAgdG91Y2gtYWN0aW9uOiBub25lOwogICAgei1pbmRleDogNTA7Cn0KCi8qIC0tLSBBQ1RJT04gQlVUVE9OIChUSEUgTElNSVQgU1BIRVJFKSAtLS0gKi8KI2FjdGlvbi1jb250YWluZXIgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgYm90dG9tOiA0MHB4OyByaWdodDogNDBweDsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgIHBvaW50ZXItZXZlbnRzOiBhdXRvOwogICAgei1pbmRleDogMTAwOwp9CgouY29tbWFuZC1tZW51LWJnIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHdpZHRoOiAxODBweDsgaGVpZ2h0OiA4MHB4OwogICAgYm90dG9tOiAxNXB4OwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCB0cmFuc3BhcmVudCAwJSwgcmdiYSgwLCAxMCwgMzAsIDAuOCkgNTAlLCB0cmFuc3BhcmVudCAxMDAlKTsKICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCByZ2JhKDAsIDIwMCwgMjU1LCAwLjMpOwogICAgei1pbmRleDogLTE7Cn0KCi5jb21tYW5kLXJpbmcgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiA1MCU7IGxlZnQ6IDUwJTsKICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpOwogICAgd2lkdGg6IDEzMHB4OyBoZWlnaHQ6IDEzMHB4OwogICAgYm9yZGVyOiAycHggc29saWQgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjEpOwogICAgYm9yZGVyLXRvcDogMnB4IHNvbGlkIHJnYmEoMCwgMjU1LCAyNTUsIDAuNik7CiAgICBib3JkZXItYm90dG9tOiAycHggc29saWQgcmdiYSgwLCAyNTUsIDI1NSwgMC42KTsKICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgIGFuaW1hdGlvbjogc3BpblJldmVyc2UgMTVzIGxpbmVhciBpbmZpbml0ZTsKICAgIHBvaW50ZXItZXZlbnRzOiBub25lOwogICAgYm94LXNoYWRvdzogMCAwIDE1cHggcmdiYSgwLCAxMDAsIDI1NSwgMC4yKTsKfQpAa2V5ZnJhbWVzIHNwaW5SZXZlcnNlIHsgZnJvbSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpIHJvdGF0ZSgzNjBkZWcpOyB9IHRvIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSkgcm90YXRlKDBkZWcpOyB9IH0KCiNhY3Rpb24tbGFiZWwgewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtZGF0YSk7CiAgICBmb250LXNpemU6IDEycHg7CiAgICBjb2xvcjogdmFyKC0tZmZ4LWN5YW4pOwogICAgYmFja2dyb3VuZDogcmdiYSgwLCA1LCAxMCwgMC44KTsKICAgIHBhZGRpbmc6IDRweCAxMnB4OwogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tZmZ4LWJsdWUtbGlnaHQpOwogICAgYm9yZGVyLXJhZGl1czogMTBweDsKICAgIG1hcmdpbi1ib3R0b206IDE1cHg7CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgbGV0dGVyLXNwYWNpbmc6IDJweDsKICAgIGJveC1zaGFkb3c6IDAgMCAxMHB4IHJnYmEoMCwwLDAsMC44KTsKICAgIHRleHQtc2hhZG93OiAwIDAgNXB4IHZhcigtLWZmeC1jeWFuKTsKICAgIHRyYW5zaXRpb246IGFsbCAwLjNzOwp9CgojYWN0aW9uLWJ1dHRvbiB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IDA7IGxlZnQ6IDA7CiAgICB3aWR0aDogMTAwcHg7IGhlaWdodDogMTAwcHg7CiAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gMC4xcywgZmlsdGVyIDAuM3M7CiAgICAKICAgIC8qIERlZmF1bHQ6IFN3aW0gTW9kZSAoQmx1ZSBTcGhlcmUpICovCiAgICBiYWNrZ3JvdW5kOiByYWRpYWwtZ3JhZGllbnQoY2lyY2xlIGF0IDM1JSAzNSUsICNmZmZmZmYgMCUsICMwMDg4ZmYgNDAlLCAjMDAyMjY2IDgwJSwgIzAwMCAxMDAlKTsKICAgIGJvcmRlcjogM3B4IHNvbGlkICM0NGFhZmY7CiAgICBib3gtc2hhZG93OiAKICAgICAgICAwIDAgMjBweCByZ2JhKDAsIDEwMCwgMjU1LCAwLjgpLAogICAgICAgIGluc2V0IDAgMCAyMHB4IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC40KTsKICAgICAgICAKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICBvdmVyZmxvdzogdmlzaWJsZTsgLyogQWxsb3cgcmluZyB0byBwdWxzZSBvdXQgKi8KICAgIHotaW5kZXg6IDEwOwp9CgojcGFzcy1idXR0b24gewogICAgZGlzcGxheTogbm9uZSAhaW1wb3J0YW50OyAvKiBIaWRkZW4gYXMgcGVyIHVzZXIgcmVxdWVzdCAqLwogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgYm90dG9tOiAtMjBweDsgbGVmdDogLTMwcHg7CiAgICB3aWR0aDogNjBweDsgaGVpZ2h0OiA2MHB4OwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgY3Vyc29yOiBwb2ludGVyOwogICAgei1pbmRleDogOTsKfQoKI3Bhc3MtYnV0dG9uOmFjdGl2ZSB7IHRyYW5zZm9ybTogc2NhbGUoMC45Mik7IH0KI3Bhc3MtYnV0dG9uLnZpc2libGUgeyBkaXNwbGF5OiBmbGV4OyBhbmltYXRpb246IHBvcEluIDAuM3MgY3ViaWMtYmV6aWVyKDAuMTc1LCAwLjg4NSwgMC4zMiwgMS4yNzUpOyB9CgpAa2V5ZnJhbWVzIHBvcEluIHsKICAgIGZyb20geyB0cmFuc2Zvcm06IHNjYWxlKDApOyBvcGFjaXR5OiAwOyB9CiAgICB0byB7IHRyYW5zZm9ybTogc2NhbGUoMSk7IG9wYWNpdHk6IDE7IH0KfQoKI3Bhc3MtYnV0dG9uIC5idG4tdGV4dCB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC1kYXRhKTsKICAgIGZvbnQtc2l6ZTogMTRweDsKICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgY29sb3I6IHdoaXRlOwogICAgdGV4dC1zaGFkb3c6IDAgMXB4IDJweCByZ2JhKDAsMCwwLDAuOCk7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKfQoKI3Bhc3MtYnV0dG9uIC5idG4tZ2xhcmUgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiAtNTAlOyBsZWZ0OiAtNTAlOyB3aWR0aDogMjAwJTsgaGVpZ2h0OiAyMDAlOwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDQ1ZGVnLCB0cmFuc3BhcmVudCA0MCUsIHJnYmEoMjU1LDI1NSwyNTUsMC4zKSA1MCUsIHRyYW5zcGFyZW50IDYwJSk7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKfQoKLyogRXhwYW5kZWQgSGl0IEFyZWEgKEludmlzaWJsZSkgKi8KI2FjdGlvbi1idXR0b246OmJlZm9yZSB7CiAgICBjb250ZW50OiAnJzsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogLTQwcHg7IGxlZnQ6IC00MHB4OyByaWdodDogLTQwcHg7IGJvdHRvbTogLTQwcHg7CiAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICB6LWluZGV4OiAxMDsKICAgIC8qIERlYnVnOiBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwgMCwgMCwgMC4yKTsgKi8KfQoKI2FjdGlvbi1idXR0b246YWN0aXZlIHsgdHJhbnNmb3JtOiBzY2FsZSgwLjkyKTsgfQoKLyogVGV4dCBpbnNpZGUgYnV0dG9uICovCiNhY3Rpb24tYnV0dG9uIC5idG4tdGV4dCB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC10aXRsZSk7CiAgICBmb250LXNpemU6IDIycHg7CiAgICBmb250LXdlaWdodDogYm9sZDsKICAgIGNvbG9yOiB3aGl0ZTsKICAgIHRleHQtc2hhZG93OiAwIDJweCA0cHggcmdiYSgwLDAsMCwwLjgpLCAwIDAgMTBweCByZ2JhKDI1NSwyNTUsMjU1LDAuNSk7CiAgICB6LWluZGV4OiA1OwogICAgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgICBsZXR0ZXItc3BhY2luZzogMXB4Owp9CgovKiBHbGFyZSBFZmZlY3QgKi8KI2FjdGlvbi1idXR0b24gLmJ0bi1nbGFyZSB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IC01MCU7IGxlZnQ6IC01MCU7IHdpZHRoOiAyMDAlOyBoZWlnaHQ6IDIwMCU7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoNDVkZWcsIHRyYW5zcGFyZW50IDQwJSwgcmdiYSgyNTUsMjU1LDI1NSwwLjQpIDUwJSwgdHJhbnNwYXJlbnQgNjAlKTsKICAgIGFuaW1hdGlvbjogZ2xhcmVQYXNzIDVzIGluZmluaXRlOwogICAgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgICB6LWluZGV4OiA2OwogICAgYm9yZGVyLXJhZGl1czogNTAlOwp9CgovKiBMaW1pdCBSaW5nIChUaGUgR2xvdyBQdWxzZSkgKi8KLmxpbWl0LXJpbmcgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiAtNXB4OyBsZWZ0OiAtNXB4OyByaWdodDogLTVweDsgYm90dG9tOiAtNXB4OwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgYm9yZGVyOiAycHggc29saWQgdHJhbnNwYXJlbnQ7CiAgICBib3gtc2hhZG93OiAwIDAgMCB0cmFuc3BhcmVudDsKICAgIHRyYW5zaXRpb246IGFsbCAwLjVzOwogICAgei1pbmRleDogMTsKICAgIHBvaW50ZXItZXZlbnRzOiBub25lOwp9CgovKiAtLS0gU0hPT1QgTU9ERSAoT0ZGRU5TRSkgLS0tICovCiNhY3Rpb24tYnV0dG9uLnNob290LW1vZGUgewogICAgLyogR29sZC9GaXJlIFNwaGVyZSAqLwogICAgYmFja2dyb3VuZDogcmFkaWFsLWdyYWRpZW50KGNpcmNsZSBhdCAzNSUgMzUlLCAjZmZmZmFhIDAlLCAjZmZhYTAwIDQwJSwgIzg4MjIwMCA4MCUsICMyMjAwMDAgMTAwJSk7CiAgICBib3JkZXItY29sb3I6ICNmZmNjMDA7CiAgICBib3gtc2hhZG93OiAKICAgICAgICAwIDAgMzBweCByZ2JhKDI1NSwgMTAwLCAwLCAwLjgpLAogICAgICAgIGluc2V0IDAgMCAyMHB4IHJnYmEoMjU1LCAyNTUsIDAsIDAuNSk7Cn0KCi8qIExpbWl0IEJyZWFrIEdsb3cgKEhpZ2ggRW5lcmd5KSAqLwojYWN0aW9uLWJ1dHRvbi5saW1pdC1yZWFkeSAubGltaXQtcmluZyB7CiAgICBib3JkZXItY29sb3I6ICNmZmRkNDQ7CiAgICBhbmltYXRpb246IGxpbWl0UHVsc2UgMC44cyBlYXNlLWluLW91dCBpbmZpbml0ZSBhbHRlcm5hdGU7Cn0KCi8qIExhYmVsIENoYW5nZSAqLwouc2hvb3QtbGFiZWwgewogICAgY29sb3I6ICNmZmRkNDQgIWltcG9ydGFudDsKICAgIGJvcmRlci1jb2xvcjogI2ZmYWEwMCAhaW1wb3J0YW50OwogICAgdGV4dC1zaGFkb3c6IDAgMCAxMHB4ICNmZjQ0MDAgIWltcG9ydGFudDsKfQoKQGtleWZyYW1lcyBsaW1pdFB1bHNlIHsKICAgIDAlIHsgCiAgICAgICAgdHJhbnNmb3JtOiBzY2FsZSgxLjApOyAKICAgICAgICBib3gtc2hhZG93OiAwIDAgMTBweCAjZmZhYTAwLCBpbnNldCAwIDAgNXB4ICNmZmFhMDA7IAogICAgICAgIG9wYWNpdHk6IDAuNTsKICAgIH0KICAgIDEwMCUgeyAKICAgICAgICB0cmFuc2Zvcm06IHNjYWxlKDEuMTUpOyAKICAgICAgICBib3gtc2hhZG93OiAwIDAgMzBweCAjZmY0NDAwLCBpbnNldCAwIDAgMTVweCAjZmYwMDAwOyAKICAgICAgICBvcGFjaXR5OiAxLjA7CiAgICB9Cn0KCi8qIC0tLSBBVVRPIFRPR0dMRSAoR2xhc3MgQnV0dG9uKSAtLS0gKi8KI2F1dG8tdG9nZ2xlIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMjAwcHg7IHJpZ2h0OiAyMHB4OwogICAgd2lkdGg6IDExMHB4OwogICAgcGFkZGluZzogMTBweCAwOwogICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgZm9udC1zaXplOiAxMnB4OwogICAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgICBjb2xvcjogdmFyKC0tZmZ4LWN5YW4pOwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgcmdiYSgwLCAyMCwgNDAsIDAuOCkgMCUsIHJnYmEoMCwgNSwgMTAsIDAuOSkgMTAwJSk7CiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1mZngtYmx1ZS1saWdodCk7CiAgICBib3JkZXItdG9wOiAxcHggc29saWQgdmFyKC0tZmZ4LWN5YW4pOwogICAgYm9yZGVyLXJhZGl1czogNHB4OwogICAgY3Vyc29yOiBwb2ludGVyOwogICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsKICAgIGxldHRlci1zcGFjaW5nOiAxcHg7CiAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoNHB4KTsKICAgIGJveC1zaGFkb3c6IDAgNXB4IDE1cHggcmdiYSgwLDAsMCwwLjMpOwogICAgcG9pbnRlci1ldmVudHM6IGF1dG87CiAgICB0cmFuc2l0aW9uOiBhbGwgMC4yczsKICAgIHotaW5kZXg6IDEwMDsKfQoKI2F1dG8tdG9nZ2xlOmhvdmVyIHsKICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgNDAsIDgwLCAwLjkpOwogICAgYm94LXNoYWRvdzogMCAwIDE1cHggdmFyKC0tZmZ4LWN5YW4pOwogICAgY29sb3I6IHdoaXRlOwp9CgojYXV0by10b2dnbGUuYWN0aXZlIHsKICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsIHJnYmEoMTAwLCAyMCwgMCwgMC44KSAwJSwgcmdiYSg0MCwgMCwgMCwgMC45KSAxMDAlKTsKICAgIGJvcmRlci1jb2xvcjogI2ZmNDQwMDsKICAgIGNvbG9yOiAjZmZhYTAwOwogICAgYW5pbWF0aW9uOiBwdWxzZVJlZCAycyBpbmZpbml0ZTsKfQpAa2V5ZnJhbWVzIHB1bHNlUmVkIHsgMCUgeyBib3gtc2hhZG93OiAwIDAgNXB4ICNmZjAwMDA7IH0gNTAlIHsgYm94LXNoYWRvdzogMCAwIDIwcHggI2ZmNDQwMDsgfSAxMDAlIHsgYm94LXNoYWRvdzogMCAwIDVweCAjZmYwMDAwOyB9IH0KCi8qIC0tLSBGTE9BVElORyBURVhUIC0tLSAqLwovKiAtLS0gRkxPQVRJTkcgVEVYVCBNQU5BR0VSIC0tLSAqLwouZmxvYXRpbmctdGV4dC13cmFwcGVyIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMDsgbGVmdDogMDsKICAgIHBvaW50ZXItZXZlbnRzOiBub25lOwogICAgei1pbmRleDogMjAwMDsKICAgIHdpbGwtY2hhbmdlOiB0cmFuc2Zvcm07Cn0KCi5mbG9hdGluZy10ZXh0LWlubmVyIHsKICAgIGRpc3BsYXk6IGJsb2NrOwogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtZGF0YSk7CiAgICBmb250LXdlaWdodDogOTAwOwogICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsKICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7CiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAvKiBSZWR1Y2VkIGRlZmF1bHQgc2l6ZSBhbmQgc2hhZG93IGZvciBjbGFyaXR5ICovCiAgICBmb250LXNpemU6IDI0cHg7IAogICAgdGV4dC1zaGFkb3c6IDFweCAxcHggMCAjMDAwOwogICAgb3BhY2l0eTogMC45Owp9CgovKiBEQU1BR0UgKE51bWVyaWMpICovCi5mbG9hdGluZy10ZXh0LWlubmVyLmRhbWFnZSB7CiAgICBmb250LXNpemU6IDQycHg7CiAgICBmb250LXN0eWxlOiBpdGFsaWM7CiAgICAvKiBHb2xkL09yYW5nZSBHcmFkaWVudCAqLwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KHRvIGJvdHRvbSwgI2ZmZmZmZiAwJSwgI2ZmY2MwMCA0MCUsICNmZjQ0MDAgMTAwJSk7CiAgICAtd2Via2l0LWJhY2tncm91bmQtY2xpcDogdGV4dDsKICAgIC13ZWJraXQtdGV4dC1maWxsLWNvbG9yOiB0cmFuc3BhcmVudDsKICAgIGZpbHRlcjogZHJvcC1zaGFkb3coMCA0cHggNHB4IHJnYmEoMCwwLDAsMC44KSk7CiAgICBhbmltYXRpb246IHBvcERhbWFnZSAwLjhzIGN1YmljLWJlemllcigwLjE3NSwgMC44ODUsIDAuMzIsIDEuMjc1KSBmb3J3YXJkczsKfQoKLyogSEVBTCAqLwouZmxvYXRpbmctdGV4dC1pbm5lci5oZWFsIHsKICAgIGZvbnQtc2l6ZTogMzZweDsKICAgIGNvbG9yOiAjNDRmZjQ0OwogICAgdGV4dC1zaGFkb3c6IDAgMCAxMHB4ICMwMGZmMDA7CiAgICBhbmltYXRpb246IGZsb2F0VXAgMXMgZWFzZS1vdXQgZm9yd2FyZHM7Cn0KCi8qIFNUQVRVUzogVkVOT00gKi8KLyogU1RBVFVTOiBWRU5PTSAoQmlvLUdyZWVuLCBTaGFycCkgKi8KLmZsb2F0aW5nLXRleHQtaW5uZXIudmVub20gewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtZGF0YSk7IC8qIENvbnNpc3RlbnQgRkZYIGZvbnQgKi8KICAgIGZvbnQtc2l6ZTogNDJweDsKICAgIGZvbnQtc3R5bGU6IGl0YWxpYzsKICAgIGNvbG9yOiAjYWFmZjAwOwogICAgdGV4dC1zaGFkb3c6IDAgMCAxMHB4ICM0NDg4MDAsIDJweCAycHggMCAjMDAyMjAwOwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KHRvIGJvdHRvbSwgI2NjZmY2NiAwJSwgIzY2Y2MwMCAxMDAlKTsKICAgIC13ZWJraXQtYmFja2dyb3VuZC1jbGlwOiB0ZXh0OwogICAgLXdlYmtpdC10ZXh0LWZpbGwtY29sb3I6IHRyYW5zcGFyZW50OwogICAgZmlsdGVyOiBkcm9wLXNoYWRvdygwIDAgNXB4IHJnYmEoMTAwLCAyNTUsIDAsIDAuNSkpOwogICAgYW5pbWF0aW9uOiBkcmlwU3RhdHVzIDJzIGluZmluaXRlOwp9CgovKiBTVEFUVVM6IFNMRUVQIChIYXp5IEJsdWUsIERyZWFteSkgKi8KLmZsb2F0aW5nLXRleHQtaW5uZXIuc2xlZXAgewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtdGl0bGUpOwogICAgZm9udC1zaXplOiA0MnB4OwogICAgY29sb3I6ICNmZmZmZmY7CiAgICB0ZXh0LXNoYWRvdzogMCAwIDE1cHggIzAwNDRmZiwgMCAwIDMwcHggIzAwMDBmZjsKICAgIG9wYWNpdHk6IDAuOTsKICAgIGFuaW1hdGlvbjogZHJpZnRTdGF0dXMgM3MgZWFzZS1pbi1vdXQgaW5maW5pdGU7Cn0KCi8qIFNUQVRVUzogV0lUSEVSIChEZXNhdHVyYXRlZCwgU3RvbmUtbGlrZSkgKi8KLmZsb2F0aW5nLXRleHQtaW5uZXIud2l0aGVyIHsKICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LWRhdGEpOwogICAgZm9udC1zaXplOiAzOHB4OwogICAgY29sb3I6ICNjY2NjY2M7CiAgICB0ZXh0LXNoYWRvdzogMnB4IDJweCAwICM0NDQ0NDQ7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQodG8gYm90dG9tLCAjZWVlZWVlIDAlLCAjODg4ODg4IDEwMCUpOwogICAgLXdlYmtpdC1iYWNrZ3JvdW5kLWNsaXA6IHRleHQ7CiAgICAtd2Via2l0LXRleHQtZmlsbC1jb2xvcjogdHJhbnNwYXJlbnQ7CiAgICBhbmltYXRpb246IHdpdGhlclN0YXR1cyAxLjVzIGZvcndhcmRzOwp9CgovKiBURUNIIENBTExPVVRTIChTcGhlcmUgU2hvdCwgSmVjaHQgU2hvdCkgKi8KLyogVEVDSCBDQUxMT1VUUyAoU3BoZXJlIFNob3QsIEplY2h0IFNob3QpICovCi5mbG9hdGluZy10ZXh0LWlubmVyLnRlY2ggewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtdGl0bGUpOwogICAgZm9udC1zaXplOiAzMnB4OyAvKiBXYXMgNDhweCAqLwogICAgY29sb3I6ICMwMGZmZmY7CiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDEwLCAzMCwgMC43KTsKICAgIHBhZGRpbmc6IDJweCAxMHB4OwogICAgYm9yZGVyOiAxcHggc29saWQgIzAwZmZmZjsKICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgIGJveC1zaGFkb3c6IDAgMCAxMHB4ICMwMDg4ZmY7CiAgICB0ZXh0LXNoYWRvdzogMCAwIDVweCAjZmZmOwogICAgYW5pbWF0aW9uOiBzaGFrZVRlY2ggMC42cyBlYXNlLWluLW91dCwgZmxhc2hUZWNoIDAuM3M7CiAgICB0cmFuc2Zvcm0tb3JpZ2luOiBjZW50ZXI7Cn0KCi8qIFNBVkUgLyBCTE9DSyAqLwouZmxvYXRpbmctdGV4dC1pbm5lci5zYXZlLCAuZmxvYXRpbmctdGV4dC1pbm5lci5ibG9jayB7CiAgICBmb250LXNpemU6IDQ4cHg7CiAgICBmb250LXdlaWdodDogOTAwOwogICAgY29sb3I6ICNmZmZmZmY7CiAgICAtd2Via2l0LXRleHQtc3Ryb2tlOiAxcHggIzAwNDQ4ODsKICAgIHRleHQtc2hhZG93OiAwIDAgMjBweCAjMDA4OGZmOwogICAgYW5pbWF0aW9uOiBwb3BEYW1hZ2UgMC41cyBlYXNlLW91dCBmb3J3YXJkczsKfQoKLyogLS0tIEFOSU1BVElPTlMgLS0tICovCgpAa2V5ZnJhbWVzIHBvcERhbWFnZSB7CiAgICAwJSB7IHRyYW5zZm9ybTogc2NhbGUoMC41KTsgb3BhY2l0eTogMDsgfQogICAgMjAlIHsgdHJhbnNmb3JtOiBzY2FsZSgxLjUpOyBvcGFjaXR5OiAxOyB9CiAgICA0MCUgeyB0cmFuc2Zvcm06IHNjYWxlKDEuMCk7IG9wYWNpdHk6IDE7IH0KICAgIDEwMCUgeyB0cmFuc2Zvcm06IHNjYWxlKDEuMCk7IG9wYWNpdHk6IDA7IH0KfQoKQGtleWZyYW1lcyBmbG9hdFVwIHsKICAgIDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDApOyBvcGFjaXR5OiAxOyB9CiAgICAxMDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC01MHB4KTsgb3BhY2l0eTogMDsgfQp9CgpAa2V5ZnJhbWVzIGRyaXBTdGF0dXMgewogICAgMCUgeyB0cmFuc2Zvcm06IHNjYWxlWSgxKTsgZmlsdGVyOiBibHVyKDBweCk7IH0KICAgIDUwJSB7IHRyYW5zZm9ybTogc2NhbGVZKDEuMSkgdHJhbnNsYXRlWSg1cHgpOyBmaWx0ZXI6IGJsdXIoMXB4KTsgfQogICAgMTAwJSB7IHRyYW5zZm9ybTogc2NhbGVZKDEpOyBmaWx0ZXI6IGJsdXIoMHB4KTsgfQp9CgpAa2V5ZnJhbWVzIGRyaWZ0U3RhdHVzIHsKICAgIDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKDApIHJvdGF0ZSgwZGVnKTsgb3BhY2l0eTogMDsgfQogICAgMjAlIHsgb3BhY2l0eTogMTsgfQogICAgNTAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKDE1cHgpIHRyYW5zbGF0ZVkoLTIwcHgpIHJvdGF0ZSgxMGRlZyk7IH0KICAgIDEwMCUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTE1cHgpIHRyYW5zbGF0ZVkoLTUwcHgpIHJvdGF0ZSgtMTBkZWcpOyBvcGFjaXR5OiAwOyB9Cn0KCkBrZXlmcmFtZXMgd2l0aGVyU3RhdHVzIHsKICAgIDAlIHsgdHJhbnNmb3JtOiBzY2FsZSgxKTsgZmlsdGVyOiBncmF5c2NhbGUoMCUpOyBvcGFjaXR5OiAxOyB9CiAgICAxMDAlIHsgdHJhbnNmb3JtOiBzY2FsZSgwLjYpOyBmaWx0ZXI6IGdyYXlzY2FsZSgxMDAlKTsgb3BhY2l0eTogMDsgfQp9CgpAa2V5ZnJhbWVzIHNoYWtlVGVjaCB7CiAgICAwJSB7IHRyYW5zZm9ybTogc2NhbGUoMC44KTsgfQogICAgMTAlLCAzMCUsIDUwJSwgNzAlLCA5MCUgeyB0cmFuc2Zvcm06IHNjYWxlKDEuMSkgdHJhbnNsYXRlKC0ycHgsIDJweCk7IH0KICAgIDIwJSwgNDAlLCA2MCUsIDgwJSB7IHRyYW5zZm9ybTogc2NhbGUoMS4xKSB0cmFuc2xhdGUoMnB4LCAtMnB4KTsgfQogICAgMTAwJSB7IHRyYW5zZm9ybTogc2NhbGUoMS4wKTsgfQp9CgpAa2V5ZnJhbWVzIGZsYXNoVGVjaCB7CiAgICAwJSB7IGJhY2tncm91bmQtY29sb3I6ICNmZmY7IGNvbG9yOiAjMDAwOyBib3JkZXItY29sb3I6ICNmZmY7IH0KICAgIDEwMCUgeyBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDAsIDEwLCAzMCwgMC44NSk7IGNvbG9yOiAjMDBmZmZmOyBib3JkZXItY29sb3I6ICMwMGZmZmY7IH0KfQovKiBMb2FkaW5nIE92ZXJsYXkgKi8KI2xvYWRpbmcgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiA1MCU7IGxlZnQ6IDUwJTsKICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpOwogICAgZm9udC1zaXplOiAyNHB4OwogICAgY29sb3I6IHZhcigtLWZmeC1jeWFuKTsKICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICBsZXR0ZXItc3BhY2luZzogNXB4OwogICAgYW5pbWF0aW9uOiBibGluayAxcyBpbmZpbml0ZTsKfQpAa2V5ZnJhbWVzIGJsaW5rIHsgNTAlIHsgb3BhY2l0eTogMC41OyB9IH0KCiNjb250cm9scy1oaW50IHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMTMwcHg7IHdpZHRoOiAxMDAlOwogICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgZm9udC1zaXplOiAxMHB4OwogICAgY29sb3I6IHJnYmEoMjU1LDI1NSwyNTUsMC40KTsKICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKfQoKLyogLS0tIENPTUlDIEJPT0sgRlggLS0tICovCi8qIC0tLSBDT01JQyBCT09LIEZYIChTY2FsZWQgRG93bikgLS0tICovCi5mbG9hdGluZy10ZXh0LWlubmVyLmNvbWljLWltcGFjdCB7CiAgICBmb250LWZhbWlseTogJ0ltcGFjdCcsIHNhbnMtc2VyaWY7CiAgICBmb250LXNpemU6IDQycHg7IC8qIFdhcyA2MHB4ICovCiAgICBjb2xvcjogI2ZmZmYwMDsgCiAgICAtd2Via2l0LXRleHQtc3Ryb2tlOiAxcHggIzAwMDsKICAgIHRleHQtc2hhZG93OiAzcHggM3B4IDAgI2ZmMDAwMDsKICAgIGZvbnQtc3R5bGU6IGl0YWxpYzsKICAgIHRyYW5zZm9ybS1vcmlnaW46IGNlbnRlcjsKICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7CiAgICBhbmltYXRpb246IGNvbWljUG9wIDAuNHMgY3ViaWMtYmV6aWVyKDAuMTc1LCAwLjg4NSwgMC4zMiwgMS4yNzUpIGZvcndhcmRzOwogICAgei1pbmRleDogMjUwMDsKfQoKLmZsb2F0aW5nLXRleHQtaW5uZXIuY29taWMtYWN0aW9uIHsKICAgIGZvbnQtZmFtaWx5OiAnQXJpYWwgQmxhY2snLCBzYW5zLXNlcmlmOwogICAgZm9udC1zaXplOiAyOHB4OyAvKiBXYXMgNDBweCAqLwogICAgY29sb3I6ICMwMGZmZmY7IAogICAgLXdlYmtpdC10ZXh0LXN0cm9rZTogMXB4ICMwMDA7CiAgICB0ZXh0LXNoYWRvdzogMnB4IDJweCAwICMwMDQ0YWE7CiAgICBmb250LXN0eWxlOiBpdGFsaWM7CiAgICB3aGl0ZS1zcGFjZTogbm93cmFwOwogICAgYW5pbWF0aW9uOiBjb21pY1NsaWRlIDAuNHMgZWFzZS1vdXQgZm9yd2FyZHM7CiAgICB6LWluZGV4OiAyNTAwOwp9CgpAa2V5ZnJhbWVzIGNvbWljUG9wIHsKICAgIDAlIHsgdHJhbnNmb3JtOiBzY2FsZSgwKSByb3RhdGUoLTIwZGVnKTsgb3BhY2l0eTogMDsgfQogICAgNDAlIHsgdHJhbnNmb3JtOiBzY2FsZSgxLjIpIHJvdGF0ZSg1ZGVnKTsgb3BhY2l0eTogMTsgfQogICAgNjAlIHsgdHJhbnNmb3JtOiBzY2FsZSgxLjApIHJvdGF0ZSgtNWRlZyk7IG9wYWNpdHk6IDE7IH0KICAgIDEwMCUgeyB0cmFuc2Zvcm06IHNjYWxlKDEuMSkgcm90YXRlKDBkZWcpOyBvcGFjaXR5OiAwOyB9Cn0KCkBrZXlmcmFtZXMgY29taWNTbGlkZSB7CiAgICAwJSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC0yMHB4LCAyMHB4KSBzY2FsZSgwLjUpOyBvcGFjaXR5OiAwOyB9CiAgICAxMDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoMjBweCwgLTIwcHgpIHNjYWxlKDEuMik7IG9wYWNpdHk6IDA7IH0KfQovKiAtLS0gTUFJTiBNRU5VIChGRlggU3R5bGUpIC0tLSAqLwojbWFpbi1tZW51IHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMDsgbGVmdDogMDsgd2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgei1pbmRleDogMzAwMDsKICAgIG9wYWNpdHk6IDA7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgIHRyYW5zaXRpb246IG9wYWNpdHkgMC41cyBlYXNlLWluLW91dDsKICAgIGJhY2tncm91bmQ6IHJhZGlhbC1ncmFkaWVudChjaXJjbGUgYXQgY2VudGVyLCByZ2JhKDAsIDIwLCA2MCwgMC44KSAwJSwgcmdiYSgwLCA1LCAxMCwgMC45NSkgMTAwJSk7CiAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoNXB4KTsKfQoKI21haW4tbWVudS5hY3RpdmUgewogICAgb3BhY2l0eTogMTsKICAgIHBvaW50ZXItZXZlbnRzOiBhdXRvOwp9CgoubWVudS1iZy1vdmVybGF5IHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMDsgbGVmdDogMDsgd2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTsKICAgIGJhY2tncm91bmQ6IAogICAgICAgIGxpbmVhci1ncmFkaWVudChyZ2JhKDAsMCwwLDApIDUwJSwgcmdiYSgwLDAsMCwwLjIpIDUwJSksIAogICAgICAgIGxpbmVhci1ncmFkaWVudCg5MGRlZywgcmdiYSgyNTUsMCwwLDAuMDYpLCByZ2JhKDAsMjU1LDAsMC4wMiksIHJnYmEoMCwwLDI1NSwwLjA2KSk7CiAgICBiYWNrZ3JvdW5kLXNpemU6IDEwMCUgMnB4LCAzcHggMTAwJTsKICAgIHBvaW50ZXItZXZlbnRzOiBub25lOwogICAgei1pbmRleDogLTE7Cn0KCi5mZngtbG9nby1jb250YWluZXIgewogICAgbWFyZ2luLWJvdHRvbTogNjBweDsKICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgIHRyYW5zZm9ybTogc2tld1goLTEwZGVnKTsKfQoKLmZmeC1sb2dvLW1haW4gewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtdGl0bGUpOwogICAgZm9udC1zaXplOiA2NHB4OwogICAgY29sb3I6ICNmZmZmZmY7CiAgICB0ZXh0LXNoYWRvdzogCiAgICAgICAgMCAwIDEwcHggIzAwZmZmZiwKICAgICAgICAwIDAgMjBweCAjMDA4OGZmLAogICAgICAgIDAgMCA0MHB4ICMwMDAwZmY7CiAgICBsZXR0ZXItc3BhY2luZzogNXB4OwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KHRvIGJvdHRvbSwgI2ZmZmZmZiAwJSwgI2FhY2NmZiA1MCUsICMwMDg4ZmYgMTAwJSk7CiAgICAtd2Via2l0LWJhY2tncm91bmQtY2xpcDogdGV4dDsKICAgIC13ZWJraXQtdGV4dC1maWxsLWNvbG9yOiB0cmFuc3BhcmVudDsKICAgIGZpbHRlcjogZHJvcC1zaGFkb3coMCA1cHggNXB4IHJnYmEoMCwwLDAsMC44KSk7Cn0KCi5mZngtbG9nby1zdWIgewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtZGF0YSk7CiAgICBmb250LXNpemU6IDE4cHg7CiAgICBjb2xvcjogdmFyKC0tZmZ4LWdvbGQpOwogICAgbGV0dGVyLXNwYWNpbmc6IDEycHg7CiAgICBtYXJnaW4tdG9wOiAtNXB4OwogICAgdGV4dC1zaGFkb3c6IDAgMCA1cHggI2ZmYWEwMDsKfQoKLm1lbnUtb3B0aW9ucyB7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgIGdhcDogMTVweDsKICAgIHdpZHRoOiAzMDBweDsKfQoKLm1lbnUtaXRlbSB7CiAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICBwYWRkaW5nOiAxNXB4IDMwcHg7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsIHJnYmEoMCwgNDAsIDgwLCAwLjYpIDAlLCByZ2JhKDAsIDEwLCAyMCwgMC4wKSAxMDAlKTsKICAgIGJvcmRlci1sZWZ0OiA0cHggc29saWQgcmdiYSgxMDAsIDIwMCwgMjU1LCAwLjMpOwogICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHJnYmEoMTAwLCAyMDAsIDI1NSwgMC4xKTsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIHRyYW5zaXRpb246IGFsbCAwLjJzOwogICAgdHJhbnNmb3JtOiBza2V3WCgtMTBkZWcpOwogICAgZGlzcGxheTogZmxleDsKICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7Cn0KCi5tZW51LWl0ZW06aG92ZXIgewogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCByZ2JhKDAsIDgwLCAxNjAsIDAuOCkgMCUsIHJnYmEoMCwgMjAsIDQwLCAwLjApIDEwMCUpOwogICAgYm9yZGVyLWxlZnQtY29sb3I6ICMwMGZmZmY7CiAgICBwYWRkaW5nLWxlZnQ6IDQwcHg7CiAgICBib3gtc2hhZG93OiAwIDAgMTVweCByZ2JhKDAsIDI1NSwgMjU1LCAwLjIpOwp9CgoubWVudS1pdGVtIC5sYWJlbCB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC10aXRsZSk7CiAgICBmb250LXNpemU6IDI0cHg7CiAgICBjb2xvcjogI2NjY2NjYzsKICAgIGxldHRlci1zcGFjaW5nOiAycHg7CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgdHJhbnNmb3JtOiBza2V3WCgxMGRlZyk7IC8qIENvdW50ZXIgc2tldyAqLwogICAgdHJhbnNpdGlvbjogY29sb3IgMC4yczsKfQoKLm1lbnUtaXRlbTpob3ZlciAubGFiZWwgewogICAgY29sb3I6ICNmZmZmZmY7CiAgICB0ZXh0LXNoYWRvdzogMCAwIDEwcHggIzAwZmZmZjsKfQoKLm1lbnUtaXRlbSAuY3Vyc29yIHsKICAgIGZvbnQtc2l6ZTogMThweDsKICAgIGNvbG9yOiB2YXIoLS1mZngtZ29sZCk7CiAgICBtYXJnaW4tcmlnaHQ6IDE1cHg7CiAgICBvcGFjaXR5OiAwOwogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKC0xMHB4KSBza2V3WCgxMGRlZyk7CiAgICB0cmFuc2l0aW9uOiBhbGwgMC4yczsKfQoKLm1lbnUtaXRlbTpob3ZlciAuY3Vyc29yIHsKICAgIG9wYWNpdHk6IDE7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoMCkgc2tld1goMTBkZWcpOwp9CgoubWVudS1mb290ZXIgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgYm90dG9tOiAyMHB4OwogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtdWkpOwogICAgZm9udC1zaXplOiAxMHB4OwogICAgY29sb3I6IHJnYmEoMjU1LDI1NSwyNTUsMC4zKTsKICAgIGxldHRlci1zcGFjaW5nOiAycHg7Cn0KLyogLS0tIFBSQUNUSUNFIE9WRVJMQVkgKEZGWCBTdHlsZSkgLS0tICovCiNwcmFjdGljZS1vdmVybGF5IHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMDsgbGVmdDogMDsgd2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTsKICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgNSwgMTAsIDAuNik7IC8qIERpbSBiYWNrZ3JvdW5kICovCiAgICBkaXNwbGF5OiBub25lOyAvKiBUb2dnbGVkIGJ5IEpTICovCiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICB6LWluZGV4OiAyNTAwOwogICAgcG9pbnRlci1ldmVudHM6IG5vbmU7IC8qIExldCBjbGlja3MgcGFzcyB0aHJvdWdoIHRvIGdhbWUgdXN1YWxseSwgYnV0IHBhbmVsIG5lZWRzIGV2ZW50cyAqLwp9CgojcHJhY3RpY2Utb3ZlcmxheS5hY3RpdmUgewogICAgZGlzcGxheTogZmxleDsKfQoKLnByYWN0aWNlLXBhbmVsIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogNjBweDsgcmlnaHQ6IDIwcHg7IC8qIFRvcCBSaWdodCBwb3NpdGlvbmluZyBsaWtlIGEgZGVidWcgbWVudSAqLwogICAgd2lkdGg6IDI4MHB4OwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDE2MGRlZywgcmdiYSgwLCAyMCwgNTAsIDAuOTUpIDAlLCByZ2JhKDAsIDEwLCAyMCwgMC45OCkgMTAwJSk7CiAgICBib3JkZXI6IDFweCBzb2xpZCAjNDQ4OGZmOwogICAgYm9yZGVyLXJhZGl1czogMCAwIDE1cHggMDsKICAgIGJveC1zaGFkb3c6IDAgMCAyMHB4IHJnYmEoMCwgMTAwLCAyNTUsIDAuMiksIGluc2V0IDAgMCA1MHB4IHJnYmEoMCwgMjAsIDYwLCAwLjUpOwogICAgcGFkZGluZzogMTVweDsKICAgIHBvaW50ZXItZXZlbnRzOiBhdXRvOwogICAgdHJhbnNmb3JtOiBza2V3WCgtMmRlZyk7CiAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoNXB4KTsKfQoKLnBhbmVsLWhlYWRlciB7CiAgICBtYXJnaW4tYm90dG9tOiAxNXB4OwogICAgdGV4dC1hbGlnbjogY2VudGVyOwp9CgoucGFuZWwtdGl0bGUtZ3JvdXAgewogICAgZGlzcGxheTogZmxleDsKICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47Cn0KCi5wYW5lbC10aXRsZSB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC10aXRsZSk7CiAgICBmb250LXNpemU6IGNsYW1wKDE4cHgsIDZ2dywgMjRweCk7IC8qIER5bmFtaWMgKi8KICAgIGNvbG9yOiAjZmZmZmZmOwogICAgdGV4dC1zaGFkb3c6IDAgMCAxMHB4ICMwMGZmZmY7CiAgICBsZXR0ZXItc3BhY2luZzogMnB4Owp9CgoucGFuZWwtc3VidGl0bGUgewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtdWkpOwogICAgZm9udC1zaXplOiA4cHg7CiAgICBjb2xvcjogIzQ0ODhmZjsKICAgIGxldHRlci1zcGFjaW5nOiA0cHg7CiAgICBtYXJnaW4tdG9wOiAtMnB4Owp9CgoucGFuZWwtZGVjby1saW5lIHsKICAgIHdpZHRoOiAxMDAlOwogICAgaGVpZ2h0OiAycHg7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsIHRyYW5zcGFyZW50LCAjMDBmZmZmLCB0cmFuc3BhcmVudCk7CiAgICBtYXJnaW4tdG9wOiA1cHg7CiAgICBib3gtc2hhZG93OiAwIDAgNXB4ICMwMGZmZmY7Cn0KCi5wYW5lbC1jb250ZW50IHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgZ2FwOiAxNXB4Owp9Cgouc2VjdGlvbi1sYWJlbCB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC11aSk7CiAgICBmb250LXNpemU6IDEwcHg7CiAgICBjb2xvcjogdmFyKC0tZmZ4LWdvbGQpOwogICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHJnYmEoMjAwLCAxNzYsIDk2LCAwLjMpOwogICAgbWFyZ2luLWJvdHRvbTogNXB4OwogICAgcGFkZGluZy1ib3R0b206IDJweDsKICAgIGxldHRlci1zcGFjaW5nOiAxcHg7Cn0KCi8qIERyaWxsIEJ1dHRvbnMgKi8KLmRyaWxsLWxpc3QgewogICAgZGlzcGxheTogZmxleDsKICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICBnYXA6IDVweDsKfQoKLmRyaWxsLWJ0biB7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgIHBhZGRpbmc6IDhweCAxMnB4OwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMDUpLCB0cmFuc3BhcmVudCk7CiAgICBib3JkZXItbGVmdDogMnB4IHNvbGlkIHRyYW5zcGFyZW50OwogICAgY3Vyc29yOiBwb2ludGVyOwogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtZGF0YSk7CiAgICBmb250LXNpemU6IDE0cHg7CiAgICBjb2xvcjogI2FhYTsKICAgIHRyYW5zaXRpb246IGFsbCAwLjJzOwp9CgouZHJpbGwtYnRuOmhvdmVyIHsKICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCg5MGRlZywgcmdiYSgwLCAyNTUsIDI1NSwgMC4xKSwgdHJhbnNwYXJlbnQpOwogICAgY29sb3I6ICNmZmY7CiAgICBwYWRkaW5nLWxlZnQ6IDE1cHg7Cn0KCi5kcmlsbC1idG4uYWN0aXZlIHsKICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCg5MGRlZywgcmdiYSgwLCAxMDAsIDI1NSwgMC40KSwgdHJhbnNwYXJlbnQpOwogICAgYm9yZGVyLWxlZnQ6IDNweCBzb2xpZCAjMDBmZmZmOwogICAgY29sb3I6ICNmZmY7CiAgICB0ZXh0LXNoYWRvdzogMCAwIDVweCAjMDBmZmZmOwp9CgouZHJpbGwtYnRuIC5pY29uIHsKICAgIHdpZHRoOiAyMHB4OwogICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgbWFyZ2luLXJpZ2h0OiAxMHB4OwogICAgY29sb3I6IHZhcigtLWZmeC1jeWFuKTsKfQoKLyogT3B0aW9ucyAqLwoub3B0aW9uLWxpc3QgewogICAgZGlzcGxheTogZmxleDsKICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICBnYXA6IDVweDsKfQoKLm9wdGlvbi10b2dnbGUgewogICAgZGlzcGxheTogZmxleDsKICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICBwYWRkaW5nOiA1cHggMTBweDsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIGZvbnQtc2l6ZTogMTJweDsKICAgIGNvbG9yOiAjY2NjOwogICAgdHJhbnNpdGlvbjogY29sb3IgMC4yczsKfQoKLm9wdGlvbi10b2dnbGU6aG92ZXIgeyBjb2xvcjogI2ZmZjsgfQoKLm9wdGlvbi10b2dnbGUgLmNoZWNrYm94IHsKICAgIG1hcmdpbi1yaWdodDogMTBweDsKICAgIGNvbG9yOiAjNDQ0OwogICAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTsKICAgIGZvbnQtc2l6ZTogMTRweDsKfQoKLm9wdGlvbi10b2dnbGUuYWN0aXZlIC5jaGVja2JveCB7CiAgICBjb2xvcjogIzAwZmYwMDsKICAgIHRleHQtc2hhZG93OiAwIDAgNXB4ICMwMGZmMDA7Cn0KCi5vcHRpb24tdG9nZ2xlLmFjdGl2ZSB7CiAgICBjb2xvcjogI2ZmZjsKfQoKLyogQWN0aW9uIEJ1dHRvbnMgKi8KLmFjdGlvbi1idG4gewogICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjUpOwogICAgYm9yZGVyOiAxcHggc29saWQgIzQ0NDsKICAgIHBhZGRpbmc6IDZweDsKICAgIGZvbnQtc2l6ZTogMTFweDsKICAgIGNvbG9yOiAjYWFhOwogICAgY3Vyc29yOiBwb2ludGVyOwogICAgdHJhbnNpdGlvbjogYWxsIDAuMnM7CiAgICBtYXJnaW4tYm90dG9tOiA1cHg7CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgbGV0dGVyLXNwYWNpbmc6IDFweDsKfQoKLmFjdGlvbi1idG46aG92ZXIgewogICAgYm9yZGVyLWNvbG9yOiAjZmZmOwogICAgY29sb3I6ICNmZmY7CiAgICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMSk7Cn0KCiNwLWV4aXQ6aG92ZXIgewogICAgYm9yZGVyLWNvbG9yOiAjZmY0NDQ0OwogICAgY29sb3I6ICNmZjQ0NDQ7CiAgICBiYWNrZ3JvdW5kOiByZ2JhKDUwLCAwLCAwLCAwLjMpOwp9CgovKiBGb290ZXIgKi8KLnBhbmVsLWZvb3RlciB7CiAgICBtYXJnaW4tdG9wOiAxNXB4OwogICAgcGFkZGluZy10b3A6IDEwcHg7CiAgICBib3JkZXItdG9wOiAxcHggc29saWQgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjEpOwogICAgdGV4dC1hbGlnbjogY2VudGVyOwp9CgojZHJpbGwtaW5zdHJ1Y3Rpb24gewogICAgZm9udC1zaXplOiAxMHB4OwogICAgY29sb3I6IHZhcigtLWZmeC1jeWFuKTsKICAgIG1hcmdpbi1ib3R0b206IDVweDsKICAgIGZvbnQtc3R5bGU6IGl0YWxpYzsKfQoKI2RyaWxsLXNjb3JlIHsKICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LWRhdGEpOwogICAgZm9udC1zaXplOiAyNHB4OwogICAgY29sb3I6IHZhcigtLWZmeC1nb2xkKTsKdGV4dC1zaGFkb3c6IDAgMCAxMHB4IHJnYmEoMjU1LCAyMTUsIDAsIDAuNSk7Cn0KCi8qIC0tLSBQUkFDVElDRSBNSU5JTUlaRS9SRVNUT1JFIC0tLSAqLwovKiAtLS0gUFJBQ1RJQ0UgTUlOSU1JWkUvUkVTVE9SRSAtLS0gKi8KLnBhbmVsLW1pbmltaXplLWJ0biB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IDEwcHg7IHJpZ2h0OiAxMHB4OwogICAgd2lkdGg6IDIwcHg7IGhlaWdodDogMjBweDsKICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWZmeC1jeWFuKTsKICAgIGNvbG9yOiB2YXIoLS1mZngtY3lhbik7CiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICBsaW5lLWhlaWdodDogMThweDsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIGZvbnQtc2l6ZTogMTRweDsKICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC41KTsKICAgIHRyYW5zaXRpb246IGFsbCAwLjJzOwp9Ci5wYW5lbC1taW5pbWl6ZS1idG46aG92ZXIgeyAKICAgIGJhY2tncm91bmQ6IHZhcigtLWZmeC1jeWFuKTsgCiAgICBjb2xvcjogIzAwMDsgCiAgICBib3gtc2hhZG93OiAwIDAgNXB4IHZhcigtLWZmeC1jeWFuKTsKfQoKI3ByYWN0aWNlLXJlc3RvcmUtYnRuIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogNjBweDsgcmlnaHQ6IDIwcHg7CiAgICBwYWRkaW5nOiA4cHggMTVweDsKICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCg5MGRlZywgcmdiYSgwLCAyMCwgNTAsIDAuOSkgMCUsIHJnYmEoMCwgMTAsIDIwLCAwLjkpIDEwMCUpOwogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tZmZ4LWN5YW4pOwogICAgYm9yZGVyLWxlZnQ6IDNweCBzb2xpZCB2YXIoLS1mZngtY3lhbik7CiAgICBjb2xvcjogdmFyKC0tZmZ4LWN5YW4pOwogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtZGF0YSk7CiAgICBmb250LXNpemU6IDEycHg7CiAgICBsZXR0ZXItc3BhY2luZzogMXB4OwogICAgY3Vyc29yOiBwb2ludGVyOwogICAgei1pbmRleDogMjQwMDsKICAgIGRpc3BsYXk6IG5vbmU7IC8qIEhpZGRlbiBieSBkZWZhdWx0ICovCiAgICBwb2ludGVyLWV2ZW50czogYXV0bzsKICAgIHRyYW5zZm9ybTogc2tld1goLTEwZGVnKTsKICAgIGJveC1zaGFkb3c6IDAgMCAxMHB4IHJnYmEoMCwgMTAwLCAyNTUsIDAuMik7CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwp9CiNwcmFjdGljZS1yZXN0b3JlLWJ0bjpob3ZlciB7CiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDQwLCA4MCwgMC45KTsKICAgIGNvbG9yOiAjZmZmOwogICAgdGV4dC1zaGFkb3c6IDAgMCA1cHggIzAwZmZmZjsKICAgIGJveC1zaGFkb3c6IDAgMCAxNXB4IHJnYmEoMCwgMjU1LCAyNTUsIDAuMyk7Cn0KCi8qID09PSBORVcgVUkgRUxFTUVOVFMgKHYyLjAgVXBncmFkZSkgPT09ICovCgovKiAtLS0gQUlNIEpPWVNUSUNLIChSaWdodCBTaWRlKSAtLS0gKi8KI2FpbS1qb3lzdGljay16b25lIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIGJvdHRvbTogMTUwcHg7CiAgICByaWdodDogMDsKICAgIHdpZHRoOiA0MCU7CiAgICBoZWlnaHQ6IDM1JTsKICAgIHotaW5kZXg6IDEwMDA7CiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDApOwogICAgdG91Y2gtYWN0aW9uOiBub25lOwogICAgcG9pbnRlci1ldmVudHM6IGF1dG87Cn0KCiNhaW0tam95c3RpY2stdmlzdWFsIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMDsgbGVmdDogMDsKICAgIHdpZHRoOiAwOyBoZWlnaHQ6IDA7CiAgICBvdmVyZmxvdzogdmlzaWJsZTsKICAgIHBvaW50ZXItZXZlbnRzOiBub25lOwogICAgZGlzcGxheTogbm9uZTsKICAgIHotaW5kZXg6IDExMDA7Cn0KCiNhaW0tam95c3RpY2stYmFzZSB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IDUwJTsgbGVmdDogNTAlOwogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSk7CiAgICB3aWR0aDogOTBweDsgaGVpZ2h0OiA5MHB4OwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgYmFja2dyb3VuZDogcmFkaWFsLWdyYWRpZW50KGNpcmNsZSwgcmdiYSgyNTUsIDEwMCwgMCwgMC4zKSAwJSwgcmdiYSg4MCwgMjAsIDAsIDAuMSkgNjAlLCB0cmFuc3BhcmVudCAxMDAlKTsKICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMjU1LCAxNTAsIDUwLCAwLjQpOwogICAgYm94LXNoYWRvdzogMCAwIDE1cHggcmdiYSgyNTUsIDEwMCwgMCwgMC4yKSwgaW5zZXQgMCAwIDIwcHggcmdiYSgyNTUsIDUwLCAwLCAwLjIpOwp9CgojYWltLWpveXN0aWNrLWtub2IgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiA1MCU7IGxlZnQ6IDUwJTsKICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpOwogICAgd2lkdGg6IDQwcHg7IGhlaWdodDogNDBweDsKICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgIGJhY2tncm91bmQ6IHJhZGlhbC1ncmFkaWVudChjaXJjbGUgYXQgMzAlIDMwJSwgI2ZmY2M4OCAwJSwgI2ZmNjYwMCA0MCUsICM4ODIyMDAgODAlLCAjMjIwMDAwIDEwMCUpOwogICAgYm9yZGVyOiAycHggc29saWQgI2ZmYWE0NDsKICAgIGJveC1zaGFkb3c6IDAgMCAxMHB4ICNmZjQ0MDAsIGluc2V0IDAgMCA4cHggcmdiYSgyNTUsMjU1LDI1NSwwLjYpOwogICAgdHJhbnNpdGlvbjogdHJhbnNmb3JtIDAuMDVzIGxpbmVhcjsKfQoKI2FpbS1qb3lzdGljay1rbm9iOjphZnRlciB7CiAgICBjb250ZW50OiAiQUlNIjsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogNTAlOyBsZWZ0OiA1MCU7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKTsKICAgIGZvbnQtc2l6ZTogOHB4OwogICAgY29sb3I6IHdoaXRlOwogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtZGF0YSk7CiAgICB0ZXh0LXNoYWRvdzogMCAwIDNweCAjMDAwOwp9CgovKiAtLS0gVEFDS0xFIEJVVFRPTiAtLS0gKi8KI3RhY2tsZS1idXR0b24gewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgYm90dG9tOiAxNjBweDsKICAgIHJpZ2h0OiA0MHB4OwogICAgd2lkdGg6IDcwcHg7CiAgICBoZWlnaHQ6IDcwcHg7CiAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICBkaXNwbGF5OiBub25lOwogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgcG9pbnRlci1ldmVudHM6IGF1dG87CiAgICB6LWluZGV4OiAxMDA7CiAgICBiYWNrZ3JvdW5kOiByYWRpYWwtZ3JhZGllbnQoY2lyY2xlIGF0IDM1JSAzNSUsICNmZjg4ODggMCUsICNjYzAwMDAgNDAlLCAjNjYwMDAwIDgwJSwgIzIyMDAwMCAxMDAlKTsKICAgIGJvcmRlcjogM3B4IHNvbGlkICNmZjQ0NDQ7CiAgICBib3gtc2hhZG93OiAwIDAgMTVweCByZ2JhKDI1NSwgNTAsIDUwLCAwLjYpLCBpbnNldCAwIDAgMTVweCByZ2JhKDI1NSwgMjAwLCAyMDAsIDAuMyk7CiAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gMC4xcywgZmlsdGVyIDAuMnM7Cn0KCiN0YWNrbGUtYnV0dG9uOmFjdGl2ZSB7CiAgICB0cmFuc2Zvcm06IHNjYWxlKDAuOSk7CiAgICBmaWx0ZXI6IGJyaWdodG5lc3MoMS4yKTsKfQoKI3RhY2tsZS1idXR0b24uYWN0aXZlIHsKICAgIGJhY2tncm91bmQ6IHJhZGlhbC1ncmFkaWVudChjaXJjbGUgYXQgMzUlIDM1JSwgI2ZmZmZmZiAwJSwgI2ZmNDQ0NCA0MCUsICNhYTAwMDAgODAlLCAjNDQwMDAwIDEwMCUpOwogICAgYm94LXNoYWRvdzogMCAwIDI1cHggcmdiYSgyNTUsIDEwMCwgMTAwLCAwLjkpOwp9CgojdGFja2xlLWJ1dHRvbiAuYnRuLXRleHQgewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtZGF0YSk7CiAgICBmb250LXNpemU6IDEycHg7CiAgICBmb250LXdlaWdodDogYm9sZDsKICAgIGNvbG9yOiB3aGl0ZTsKICAgIHRleHQtc2hhZG93OiAwIDFweCAycHggcmdiYSgwLDAsMCwwLjgpOwogICAgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgbGV0dGVyLXNwYWNpbmc6IDFweDsKfQoKI3RhY2tsZS1idXR0b24gLmJ0bi1nbGFyZSB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IC01MCU7IGxlZnQ6IC01MCU7CiAgICB3aWR0aDogMjAwJTsgaGVpZ2h0OiAyMDAlOwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDQ1ZGVnLCB0cmFuc3BhcmVudCA0MCUsIHJnYmEoMjU1LDI1NSwyNTUsMC4zKSA1MCUsIHRyYW5zcGFyZW50IDYwJSk7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgIGFuaW1hdGlvbjogZ2xhcmVQYXNzIDRzIGluZmluaXRlOwp9CgovKiAtLS0gQ0hBUkdFIFBPV0VSIE1FVEVSIC0tLSAqLwojdGFja2xlLWJ1dHRvbi51cmdlbnQgewogICAgYW5pbWF0aW9uOiB1cmdlbnRQdWxzZSAwLjVzIGluZmluaXRlIGFsdGVybmF0ZTsKICAgIGJhY2tncm91bmQ6IHJhZGlhbC1ncmFkaWVudChjaXJjbGUgYXQgMzUlIDM1JSwgI2ZmNTU1NSAwJSwgI2ZmMDAwMCA0MCUsICM4ODAwMDAgMTAwJSk7CiAgICBib3JkZXItY29sb3I6ICNmZmFhYWE7CiAgICBib3gtc2hhZG93OiAwIDAgMjBweCAjZmYwMDAwOwp9CgpAa2V5ZnJhbWVzIHVyZ2VudFB1bHNlIHsKICAgIGZyb20geyB0cmFuc2Zvcm06IHNjYWxlKDEuMCk7IH0KICAgIHRvIHsgdHJhbnNmb3JtOiBzY2FsZSgxLjE1KTsgfQp9CgovKiAtLS0gQ0hBUkdFIFBPV0VSIE1FVEVSIC0tLSAqLwojY2hhcmdlLW1ldGVyLWNvbnRhaW5lciB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICBib3R0b206IDI1MHB4OwogICAgbGVmdDogNTAlOwogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKC01MCUpOwogICAgd2lkdGg6IDIwMHB4OwogICAgZGlzcGxheTogbm9uZTsKICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgICB6LWluZGV4OiAyMDAwOwogICAgYmFja2dyb3VuZDogcmdiYSgwLCAxMCwgMzAsIDAuOCk7CiAgICBwYWRkaW5nOiAxMHB4IDE1cHg7CiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1mZngtY3lhbik7CiAgICBib3JkZXItcmFkaXVzOiA1cHg7CiAgICBib3gtc2hhZG93OiAwIDAgMTVweCByZ2JhKDAsIDEwMCwgMjU1LCAwLjMpOwp9CgouY2hhcmdlLWxhYmVsIHsKICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LWRhdGEpOwogICAgZm9udC1zaXplOiAxMnB4OwogICAgY29sb3I6IHZhcigtLWZmeC1jeWFuKTsKICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICBsZXR0ZXItc3BhY2luZzogMnB4OwogICAgbWFyZ2luLWJvdHRvbTogNXB4Owp9CgouY2hhcmdlLW1ldGVyLXRyYWNrIHsKICAgIHdpZHRoOiAxMDAlOwogICAgaGVpZ2h0OiAxMnB4OwogICAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjYpOwogICAgYm9yZGVyOiAxcHggc29saWQgIzQ0NDsKICAgIGJvcmRlci1yYWRpdXM6IDZweDsKICAgIG92ZXJmbG93OiBoaWRkZW47Cn0KCiNjaGFyZ2UtbWV0ZXItZmlsbCB7CiAgICBoZWlnaHQ6IDEwMCU7CiAgICB3aWR0aDogMCU7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsICMwYWYsICMwZjApOwogICAgYm94LXNoYWRvdzogMCAwIDEwcHggIzBmMDsKICAgIHRyYW5zaXRpb246IHdpZHRoIDAuMDVzIGxpbmVhciwgYmFja2dyb3VuZCAwLjFzOwogICAgYm9yZGVyLXJhZGl1czogNXB4Owp9CgouY2hhcmdlLWhpbnQgewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtdWkpOwogICAgZm9udC1zaXplOiAxMHB4OwogICAgY29sb3I6IHZhcigtLWZmeC1nb2xkKTsKICAgIG1hcmdpbi10b3A6IDVweDsKICAgIG9wYWNpdHk6IDAuODsKICAgIGFuaW1hdGlvbjogYmxpbmsgMC41cyBpbmZpbml0ZTsKfQoKLyogLS0tIEdPQUwgRElTVEFOQ0UgSU5ESUNBVE9SIC0tLSAqLwojZ29hbC1kaXN0YW5jZS1jb250YWluZXIgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiA3NXB4OwogICAgbGVmdDogMjBweDsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgIHBvaW50ZXItZXZlbnRzOiBub25lOwogICAgei1pbmRleDogMTAwOwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCByZ2JhKDAsIDEwLCAzMCwgMC43KSAwJSwgdHJhbnNwYXJlbnQgMTAwJSk7CiAgICBwYWRkaW5nOiA1cHggMTVweCA1cHggMTBweDsKICAgIGJvcmRlci1sZWZ0OiAycHggc29saWQgdmFyKC0tZmZ4LWdvbGQpOwp9CgouZGlzdGFuY2UtbGFiZWwgewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtdWkpOwogICAgZm9udC1zaXplOiA4cHg7CiAgICBjb2xvcjogdmFyKC0tZmZ4LWdvbGQpOwogICAgbGV0dGVyLXNwYWNpbmc6IDJweDsKICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7Cn0KCiNnb2FsLWRpc3RhbmNlIHsKICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LWRhdGEpOwogICAgZm9udC1zaXplOiAyNHB4OwogICAgY29sb3I6IHdoaXRlOwogICAgdGV4dC1zaGFkb3c6IDAgMCA1cHggdmFyKC0tZmZ4LWdvbGQpOwp9CgovKiAtLS0gU0VUVElOR1MgQlVUVE9OIC0tLSAqLwojc2V0dGluZ3MtYnV0dG9uIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMjQwcHg7CiAgICByaWdodDogMjBweDsKICAgIHdpZHRoOiAxMTBweDsKICAgIHBhZGRpbmc6IDhweCAwOwogICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgZm9udC1zaXplOiAxMHB4OwogICAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgICBjb2xvcjogIzg4ODsKICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsIHJnYmEoMjAsIDIwLCAyMCwgMC44KSAwJSwgcmdiYSgxMCwgMTAsIDEwLCAwLjkpIDEwMCUpOwogICAgYm9yZGVyOiAxcHggc29saWQgIzQ0NDsKICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICBsZXR0ZXItc3BhY2luZzogMXB4OwogICAgcG9pbnRlci1ldmVudHM6IGF1dG87CiAgICB0cmFuc2l0aW9uOiBhbGwgMC4yczsKICAgIHotaW5kZXg6IDEwMDsKfQoKI3NldHRpbmdzLWJ1dHRvbjpob3ZlciB7CiAgICBiYWNrZ3JvdW5kOiByZ2JhKDQwLCA0MCwgNDAsIDAuOSk7CiAgICBib3JkZXItY29sb3I6ICM4ODg7CiAgICBjb2xvcjogI2ZmZjsKfQoKLyogLS0tIFNFVFRJTkdTIFBBTkVMIC0tLSAqLwojc2V0dGluZ3MtcGFuZWwgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiA1MCU7CiAgICBsZWZ0OiA1MCU7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKTsKICAgIHdpZHRoOiAyODBweDsKICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxNjBkZWcsIHJnYmEoMCwgMjAsIDUwLCAwLjk4KSAwJSwgcmdiYSgwLCAxMCwgMjAsIDAuOTkpIDEwMCUpOwogICAgYm9yZGVyOiAycHggc29saWQgdmFyKC0tZmZ4LWN5YW4pOwogICAgYm9yZGVyLXJhZGl1czogMTBweDsKICAgIGJveC1zaGFkb3c6IDAgMCAzMHB4IHJnYmEoMCwgMTAwLCAyNTUsIDAuNCk7CiAgICB6LWluZGV4OiAzNTAwOwogICAgcG9pbnRlci1ldmVudHM6IGF1dG87CiAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoMTBweCk7Cn0KCi5zZXR0aW5ncy1oZWFkZXIgewogICAgZGlzcGxheTogZmxleDsKICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICBwYWRkaW5nOiAxNXB4OwogICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHJnYmEoMTAwLCAyMDAsIDI1NSwgMC4zKTsKICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgMzAsIDYwLCAwLjUpOwp9Cgouc2V0dGluZ3MtaGVhZGVyIHNwYW4gewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtdGl0bGUpOwogICAgZm9udC1zaXplOiAyMHB4OwogICAgY29sb3I6IHdoaXRlOwogICAgdGV4dC1zaGFkb3c6IDAgMCA1cHggdmFyKC0tZmZ4LWN5YW4pOwogICAgbGV0dGVyLXNwYWNpbmc6IDNweDsKfQoKI3NldHRpbmdzLWNsb3NlIHsKICAgIHdpZHRoOiAzMHB4OwogICAgaGVpZ2h0OiAzMHB4OwogICAgYm9yZGVyOiAxcHggc29saWQgI2ZmNDQ0NDsKICAgIGJhY2tncm91bmQ6IHJnYmEoNTAsIDAsIDAsIDAuNSk7CiAgICBjb2xvcjogI2ZmNDQ0NDsKICAgIGZvbnQtc2l6ZTogMTRweDsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIGJvcmRlci1yYWRpdXM6IDVweDsKICAgIHRyYW5zaXRpb246IGFsbCAwLjJzOwp9Cgojc2V0dGluZ3MtY2xvc2U6aG92ZXIgewogICAgYmFja2dyb3VuZDogI2ZmNDQ0NDsKICAgIGNvbG9yOiB3aGl0ZTsKfQoKLnNldHRpbmdzLWNvbnRlbnQgewogICAgcGFkZGluZzogMjBweDsKfQoKLnNldHRpbmctcm93IHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgbWFyZ2luLWJvdHRvbTogMTVweDsKICAgIHBhZGRpbmc6IDEwcHg7CiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDAsIDAsIDAuMyk7CiAgICBib3JkZXItcmFkaXVzOiA1cHg7Cn0KCi5zZXR0aW5nLXJvdyBsYWJlbCB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC1kYXRhKTsKICAgIGZvbnQtc2l6ZTogMTRweDsKICAgIGNvbG9yOiAjY2NjOwp9Cgouc2V0dGluZy1yb3cgaW5wdXRbdHlwZT0icmFuZ2UiXSB7CiAgICB3aWR0aDogMTAwcHg7CiAgICBhY2NlbnQtY29sb3I6IHZhcigtLWZmeC1jeWFuKTsKfQoKLnNldHRpbmctcm93IGlucHV0W3R5cGU9ImNoZWNrYm94Il0gewogICAgd2lkdGg6IDIwcHg7CiAgICBoZWlnaHQ6IDIwcHg7CiAgICBhY2NlbnQtY29sb3I6IHZhcigtLWZmeC1jeWFuKTsKICAgIGN1cnNvcjogcG9pbnRlcjsKfQoKLyogLS0tIEdMQVJFIEFOSU1BVElPTiAtLS0gKi8KQGtleWZyYW1lcyBnbGFyZVBhc3MgewogICAgMCUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTEwMCUpIHJvdGF0ZSg0NWRlZyk7IH0KICAgIDMwJSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlWCgxMDAlKSByb3RhdGUoNDVkZWcpOyB9CiAgICAxMDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKDEwMCUpIHJvdGF0ZSg0NWRlZyk7IH0KfQoKLyogLS0tIFNUQVRVUyBUWVBFIEZMT0FUSU5HIFRFWFQgLS0tICovCi5mbG9hdGluZy10ZXh0LWlubmVyLnN0YXR1cyB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC1kYXRhKTsKICAgIGZvbnQtc2l6ZTogMjhweDsKICAgIGZvbnQtc3R5bGU6IGl0YWxpYzsKICAgIGNvbG9yOiAjZmYwMGZmOwogICAgdGV4dC1zaGFkb3c6IDAgMCAxMHB4ICNmZjAwZmYsIDJweCAycHggMCAjMDAwOwogICAgYW5pbWF0aW9uOiBzdGF0dXNQb3AgMS4ycyBlYXNlLW91dCBmb3J3YXJkczsKfQoKQGtleWZyYW1lcyBzdGF0dXNQb3AgewogICAgMCUgeyB0cmFuc2Zvcm06IHNjYWxlKDAuNSkgdHJhbnNsYXRlWSgwKTsgb3BhY2l0eTogMDsgfQogICAgMjAlIHsgdHJhbnNmb3JtOiBzY2FsZSgxLjMpIHRyYW5zbGF0ZVkoLTEwcHgpOyBvcGFjaXR5OiAxOyB9CiAgICAxMDAlIHsgdHJhbnNmb3JtOiBzY2FsZSgxLjApIHRyYW5zbGF0ZVkoLTQwcHgpOyBvcGFjaXR5OiAwOyB9Cn0KCi8qIC0tLSBHT0FMIFRZUEUgRkxPQVRJTkcgVEVYVCAtLS0gKi8KLmZsb2F0aW5nLXRleHQtaW5uZXIuZ29hbCB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC1kYXRhKTsKICAgIGZvbnQtc2l6ZTogNDhweDsKICAgIGZvbnQtd2VpZ2h0OiA5MDA7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQodG8gYm90dG9tLCAjZmZmIDAlLCAjZmZkNzAwIDUwJSwgI2ZmODgwMCAxMDAlKTsKICAgIC13ZWJraXQtYmFja2dyb3VuZC1jbGlwOiB0ZXh0OwogICAgLXdlYmtpdC10ZXh0LWZpbGwtY29sb3I6IHRyYW5zcGFyZW50OwogICAgZmlsdGVyOiBkcm9wLXNoYWRvdygwIDRweCA0cHggcmdiYSgwLDAsMCwwLjkpKTsKICAgIGFuaW1hdGlvbjogZ29hbFBvcCAxcyBjdWJpYy1iZXppZXIoMC4xNzUsIDAuODg1LCAwLjMyLCAxLjI3NSkgZm9yd2FyZHM7Cn0KCkBrZXlmcmFtZXMgZ29hbFBvcCB7CiAgICAwJSB7IHRyYW5zZm9ybTogc2NhbGUoMCkgcm90YXRlKC0xMGRlZyk7IG9wYWNpdHk6IDA7IH0KICAgIDUwJSB7IHRyYW5zZm9ybTogc2NhbGUoMS41KSByb3RhdGUoNWRlZyk7IG9wYWNpdHk6IDE7IH0KICAgIDEwMCUgeyB0cmFuc2Zvcm06IHNjYWxlKDEuMikgcm90YXRlKDBkZWcpOyBvcGFjaXR5OiAwOyB9Cn0KCi8qIC0tLSBERUZBVUxUIFRZUEUgRkxPQVRJTkcgVEVYVCAtLS0gKi8KLmZsb2F0aW5nLXRleHQtaW5uZXIuZGVmYXVsdCB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC1kYXRhKTsKICAgIGZvbnQtc2l6ZTogMjRweDsKICAgIGNvbG9yOiB3aGl0ZTsKICAgIHRleHQtc2hhZG93OiAwIDJweCA0cHggcmdiYSgwLDAsMCwwLjgpOwphbmltYXRpb246IGZsb2F0VXAgMC44cyBlYXNlLW91dCBmb3J3YXJkczsKfQoKLyogLS0tIFZFUlNVUyBDTEFTSCBURVhUIC0tLSAqLwovKiAtLS0gVkVSU1VTIENMQVNIIFRFWFQgUkVNT1ZFRCAtLS0gKi8=","/style.css":"data:text/css;base64,OnJvb3QgewogICAgLS1mZngtYmx1ZS1kZWVwOiAjMDIwNDA4OwogICAgLS1mZngtYmx1ZS1kYXJrOiAjMGExNTI1OwogICAgLS1mZngtYmx1ZS1taWQ6ICMxNTJhNDU7CiAgICAtLWZmeC1ibHVlLWxpZ2h0OiAjMmE0ZDc1OwogICAgLS1mZngtY3lhbjogIzYwYzBkMDsKICAgIC0tZmZ4LWN5YW4tZ2xvdzogIzAwZmZmZjsKICAgIC0tZmZ4LWdvbGQ6ICNjOGIwNjA7CiAgICAtLWZmeC1nb2xkLWxpZ2h0OiAjZjBlMDkwOwogICAgLS1mZngtZ29sZC1kYXJrOiAjOGE3MDMwOwogICAgLS1mZngtZ2xhc3MtYmc6IHJnYmEoMTAsIDIwLCA0MCwgMC43NSk7CiAgICAtLWZmeC1nbGFzcy1ib3JkZXI6IHJnYmEoMTAwLCAyMDAsIDI1NSwgMC4zKTsKICAgIAogICAgLS1mb250LXRpdGxlOiAnR2FyYW1vbmQnLCAnVGltZXMgTmV3IFJvbWFuJywgc2VyaWY7CiAgICAtLWZvbnQtZGF0YTogJ0ltcGFjdCcsICdBcmlhbCBOYXJyb3cnLCBzYW5zLXNlcmlmOwogICAgLS1mb250LXVpOiAnQ291cmllciBOZXcnLCBtb25vc3BhY2U7Cn0KCmh0bWwsIGJvZHkgewogICAgbWFyZ2luOiAwOwogICAgcGFkZGluZzogMDsKICAgIGJhY2tncm91bmQtY29sb3I6ICMwMDA7CiAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgLyogRm9yY2UgZnVsbCB2aWV3cG9ydCBmaWxsICovCiAgICB3aWR0aDogMTAwdnc7CiAgICBoZWlnaHQ6IDEwMCU7CiAgICAvKiBGaXhlcyBtb2JpbGUgc2Nyb2xsIGJvdW5jZSBhbmQgbGF5b3V0IGlzc3VlcyAqLwogICAgcG9zaXRpb246IGZpeGVkOyAKICAgIHRvcDogMDsKICAgIGxlZnQ6IDA7CiAgICByaWdodDogMDsKICAgIGJvdHRvbTogMDsKICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LWRhdGEpOwogICAgY29sb3I6IHdoaXRlOwogICAgdXNlci1zZWxlY3Q6IG5vbmU7CiAgICAtd2Via2l0LXVzZXItc2VsZWN0OiBub25lOwogICAgLyogRW5zdXJlIG5vIHNhZmUtYXJlYSBnYXBzIG9uIG5vdGNoZWQgcGhvbmVzICovCiAgICBwYWRkaW5nLXRvcDogZW52KHNhZmUtYXJlYS1pbnNldC10b3ApOwogICAgcGFkZGluZy1ib3R0b206IGVudihzYWZlLWFyZWEtaW5zZXQtYm90dG9tKTsKICAgIHBhZGRpbmctbGVmdDogZW52KHNhZmUtYXJlYS1pbnNldC1sZWZ0KTsKICAgIHBhZGRpbmctcmlnaHQ6IGVudihzYWZlLWFyZWEtaW5zZXQtcmlnaHQpOwp9CgovKiAtLS0gTUFJTiBHQU1FIENPTlRBSU5FUiAtLS0gKi8KI2dhbWUtY29udGFpbmVyIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMDsKICAgIGxlZnQ6IDA7CiAgICB3aWR0aDogMTAwJTsKICAgIGhlaWdodDogMTAwJTsKICAgIG1heC13aWR0aDogbm9uZTsKICAgIGJhY2tncm91bmQ6ICMwMDA1MTA7CiAgICBib3gtc2hhZG93OiBub25lOwogICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgIHRyYW5zaXRpb246IGZpbHRlciAwLjA1czsKICAgIHotaW5kZXg6IDE7Cn0KCi8qIC0tLSBJTVBBQ1QgRlggKENocm9tYXRpYyBBYmVycmF0aW9uIC8gU2hvY2spIC0tLSAqLwojZ2FtZS1jb250YWluZXIuaW1wYWN0LWZ4IHsKICAgIGFuaW1hdGlvbjogaW1wYWN0U2hha2UgMC4xcyBlYXNlLWluLW91dDsKICAgIGZpbHRlcjogY29udHJhc3QoMS4yKSBicmlnaHRuZXNzKDEuMSk7Cn0KCiNnYW1lLWNvbnRhaW5lci5pbXBhY3QtaGVhdnkgewogICAgYW5pbWF0aW9uOiBpbXBhY3RTaGFrZSAwLjJzIGVhc2UtaW4tb3V0OwogICAgZmlsdGVyOiBjb250cmFzdCgxLjUpIGJyaWdodG5lc3MoMS4zKSBzZXBpYSgwLjQpIGh1ZS1yb3RhdGUoLTEwZGVnKTsKfQoKI2dhbWUtY29udGFpbmVyLmltcGFjdC1zaGF0dGVyIHsKICAgIGFuaW1hdGlvbjogaW1wYWN0U2hha2UgMC40cyBlYXNlLWluLW91dDsKICAgIGZpbHRlcjogY29udHJhc3QoMi4wKSBpbnZlcnQoMC4xKSBzYXR1cmF0ZSgyLjApOwp9CgpAa2V5ZnJhbWVzIGltcGFjdFNoYWtlIHsKICAgIDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoMCwgMCk7IH0KICAgIDI1JSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC01cHgsIDVweCk7IH0KICAgIDUwJSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKDVweCwgLTVweCk7IH0KICAgIDc1JSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC01cHgsIC01cHgpOyB9CiAgICAxMDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoMCwgMCk7IH0KfQoKLyogQXNwZWN0IFJhdGlvIGNvbnN0cmFpbnRzIHJlbW92ZWQgZm9yIGZ1bGwgc2NyZWVuICovCgovKiAtLS0gQ0FOVkFTICYgUkVOREVSIC0tLSAqLwpjYW52YXMgewogICAgZGlzcGxheTogYmxvY2s7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IDA7CiAgICBsZWZ0OiAwOwogICAgd2lkdGg6IDEwMCU7CiAgICBoZWlnaHQ6IDEwMCU7CiAgICAvKiBQU1gvUmV0cm8gRmVlbCAqLwogICAgaW1hZ2UtcmVuZGVyaW5nOiBwaXhlbGF0ZWQ7IAogICAgei1pbmRleDogMDsKfQoKLyogLS0tIEdMT0JBTCBPVkVSTEFZUyAoU2NhbmxpbmVzICYgVmlnbmV0dGUpIC0tLSAqLwojZ2FtZS1jb250YWluZXI6OmFmdGVyIHsKICAgIGNvbnRlbnQ6ICIiOwogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiAwOyBsZWZ0OiAwOyB3aWR0aDogMTAwJTsgaGVpZ2h0OiAxMDAlOwogICAgYmFja2dyb3VuZDogCiAgICAgICAgbGluZWFyLWdyYWRpZW50KHJnYmEoMTgsIDE2LCAxNiwgMCkgNTAlLCByZ2JhKDAsIDAsIDAsIDAuMSkgNTAlKSwKICAgICAgICByYWRpYWwtZ3JhZGllbnQoY2lyY2xlIGF0IGNlbnRlciwgdHJhbnNwYXJlbnQgNjAlLCByZ2JhKDAsMCwwLDAuNCkgMTAwJSk7CiAgICBiYWNrZ3JvdW5kLXNpemU6IDEwMCUgNHB4LCAxMDAlIDEwMCU7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgIHotaW5kZXg6IDkwMDsKICAgIG9wYWNpdHk6IDAuMDU7Cn0KCi8qIC0tLSBWSURFTyBPVkVSTEFZIC0tLSAqLwovKiAtLS0gR0lGIE9WRVJMQVkgLS0tICovCiNzY3JlZW4tb3ZlcmxheS1naWYgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiAwOyBsZWZ0OiAwOwogICAgd2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTsKICAgIG9iamVjdC1maXQ6IGNvdmVyOwptaXgtYmxlbmQtbW9kZTogc29mdC1saWdodDsKICAgIG9wYWNpdHk6IDAuNzI7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgIHotaW5kZXg6IDk1MDsKICAgIGltYWdlLXJlbmRlcmluZzogcGl4ZWxhdGVkOyAvKiBOZWFyZXN0IE5laWdoYm9yICovCn0KCiN1aS1sYXllciB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IDA7IGxlZnQ6IDA7IHdpZHRoOiAxMDAlOyBoZWlnaHQ6IDEwMCU7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOwogICAgei1pbmRleDogMTAwMDsKfQoKLyogLS0tIENJTkVNQVRJQyBCQVJTIC0tLSAqLwojY2luZW1hdGljLWJhcnMgLmJhciB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICBsZWZ0OiAwOyB3aWR0aDogMTAwJTsgaGVpZ2h0OiAwOwogICAgYmFja2dyb3VuZDogYmxhY2s7CiAgICB0cmFuc2l0aW9uOiBoZWlnaHQgMC41cyBlYXNlOwogICAgei1pbmRleDogODAwOwp9CiNjaW5lbWF0aWMtYmFycyAuYmFyLnRvcCB7IHRvcDogMDsgfQojY2luZW1hdGljLWJhcnMgLmJhci5ib3R0b20geyBib3R0b206IDA7IH0KCi8qIC0tLSBURUNIIEZMQVNIIE9WRVJMQVkgKFRlY2hjb3B5KSAtLS0gKi8KI3RlY2gtZmxhc2gtb3ZlcmxheSB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IDIwJTsgbGVmdDogMDsgd2lkdGg6IDEwMCU7IGhlaWdodDogMTIwcHg7CiAgICBkaXNwbGF5OiBub25lOyAvKiBUb2dnbGVkIGJ5IEpTICovCiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCByZ2JhKDAsMCwwLDApIDAlLCByZ2JhKDAsIDIwLCA2MCwgMC45KSAyMCUsIHJnYmEoMCwgMjAsIDYwLCAwLjkpIDgwJSwgcmdiYSgwLDAsMCwwKSAxMDAlKTsKICAgIHotaW5kZXg6IDIyMDA7CiAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoMnB4KTsKICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCByZ2JhKDEwMCwgMjU1LCAyNTUsIDAuMyk7CiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgcmdiYSgxMDAsIDI1NSwgMjU1LCAwLjMpOwogICAgYW5pbWF0aW9uOiBmbGFzaEVudGVyIDAuMTVzIGVhc2Utb3V0Owp9CgpAa2V5ZnJhbWVzIGZsYXNoRW50ZXIgewogICAgZnJvbSB7IHRyYW5zZm9ybTogc2NhbGVZKDApOyBvcGFjaXR5OiAwOyB9CiAgICB0byB7IHRyYW5zZm9ybTogc2NhbGVZKDEpOyBvcGFjaXR5OiAxOyB9Cn0KCi50ZWNoLWNvbnRlbnQtd3JhcHBlciB7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICB0cmFuc2Zvcm06IHNrZXdYKC0xMGRlZyk7Cn0KCi50ZWNoLXRleHQgewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtZGF0YSk7CiAgICBmb250LXNpemU6IGNsYW1wKDI4cHgsIDEwdncsIDQycHgpOyAvKiBEeW5hbWljICovCiAgICBjb2xvcjogI2ZmZmZmZjsKICAgIHRleHQtc2hhZG93OiAwIDAgMTBweCAjMDBmZmZmLCAwIDAgMjBweCAjMDAwMGZmOwogICAgbGV0dGVyLXNwYWNpbmc6IDNweDsKICAgIG1hcmdpbi1ib3R0b206IDJweDsKICAgIGZvbnQtc3R5bGU6IGl0YWxpYzsKICAgIGFuaW1hdGlvbjogYmxpbmtUZXh0IDAuMDhzIGluZmluaXRlIGFsdGVybmF0ZTsKICAgIHRleHQtYWxpZ246IGNlbnRlcjsKfQoKLnRlY2gtc3ViLXRleHQgewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtdWkpOwogICAgZm9udC1zaXplOiAxNHB4OwogICAgY29sb3I6ICMwMGZmZmY7CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgbGV0dGVyLXNwYWNpbmc6IDJweDsKICAgIG1hcmdpbi1ib3R0b206IDhweDsKICAgIHRleHQtc2hhZG93OiAwIDAgNXB4IHJnYmEoMCwgMjU1LCAyNTUsIDAuNSk7Cn0KCi50ZWNoLXRpbWVyLXRyYWNrIHsKICAgIHdpZHRoOiAyNTBweDsKICAgIGhlaWdodDogOHB4OwogICAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjYpOwogICAgYm9yZGVyOiAxcHggc29saWQgIzQ0NDsKICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICBib3gtc2hhZG93OiAwIDAgMTBweCByZ2JhKDAsMCwwLDAuNSk7Cn0KCi50ZWNoLXRpbWVyLWZpbGwgewogICAgaGVpZ2h0OiAxMDAlOwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjZmZmZmZmLCAjMDBmZmZmKTsKICAgIHdpZHRoOiAxMDAlOwogICAgdHJhbnNmb3JtLW9yaWdpbjogbGVmdDsKICAgIGJveC1zaGFkb3c6IDAgMCAxMHB4ICMwMGZmZmY7Cn0KCkBrZXlmcmFtZXMgYmxpbmtUZXh0IHsKICAgIGZyb20geyBvcGFjaXR5OiAwLjg7IHRleHQtc2hhZG93OiAwIDAgNXB4ICMwMGZmZmY7IHRyYW5zZm9ybTogc2NhbGUoMSk7IH0KICAgIHRvIHsgb3BhY2l0eTogMS4wOyB0ZXh0LXNoYWRvdzogMCAwIDIwcHggI2ZmZmZmZiwgMCAwIDEwcHggIzAwZmZmZjsgdHJhbnNmb3JtOiBzY2FsZSgxLjAyKTsgfQp9CgovKiAtLS0gSFVEIFRPUCAoVGhlIENyeXN0YWwgSW50ZXJmYWNlKSAtLS0gKi8KI2h1ZC10b3AgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiAwOwogICAgbGVmdDogMDsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgICBhbGlnbi1pdGVtczogZmxleC1zdGFydDsKICAgIHdpZHRoOiAxMDAlOwogICAgcGFkZGluZzogMTVweDsKICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQodG8gYm90dG9tLCByZ2JhKDAsIDUsIDE1LCAwLjkpIDAlLCByZ2JhKDAsMCwwLDApIDEwMCUpOwogICAgcG9pbnRlci1ldmVudHM6IG5vbmU7Cn0KCi8qIFRlYW0gV2luZ3MgKi8KLnRlYW0td2luZyB7CiAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgIHdpZHRoOiAxMzBweDsKICAgIGhlaWdodDogNTBweDsKICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxNjBkZWcsIHZhcigtLWZmeC1ibHVlLW1pZCkgMCUsIHZhcigtLWZmeC1ibHVlLWRlZXApIDEwMCUpOwogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tZmZ4LWJsdWUtbGlnaHQpOwogICAgYm9yZGVyLXRvcDogMnB4IHNvbGlkIHZhcigtLWZmeC1jeWFuKTsKICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgIHRyYW5zZm9ybTogc2tld1goLTE1ZGVnKTsKICAgIGJveC1zaGFkb3c6IDAgNXB4IDE1cHggcmdiYSgwLCAwLCAwLCAwLjUpOwogICAgcGFkZGluZzogMCAxMHB4Owp9CgoudGVhbS13aW5nLmF3YXkgewogICAgdHJhbnNmb3JtOiBza2V3WCgxNWRlZyk7CiAgICBmbGV4LWRpcmVjdGlvbjogcm93LXJldmVyc2U7CiAgICBib3JkZXItdG9wLWNvbG9yOiAjZmY2NjY2OyAvKiBSZWQgdGludCBmb3IgZW5lbXkgKi8KICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgtMTYwZGVnLCAjMmExMDEwIDAlLCAjMTAwNTA1IDEwMCUpOwp9CgoudGVhbS1kYXRhIHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICB0cmFuc2Zvcm06IHNrZXdYKDE1ZGVnKTsgLyogQ291bnRlciBza2V3ICovCn0KLnRlYW0td2luZy5hd2F5IC50ZWFtLWRhdGEgeyB0cmFuc2Zvcm06IHNrZXdYKC0xNWRlZyk7IHRleHQtYWxpZ246IHJpZ2h0OyB9CgoudGVhbS1uYW1lIHsKICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LXRpdGxlKTsKICAgIGZvbnQtc2l6ZTogMTRweDsKICAgIGNvbG9yOiB2YXIoLS1mZngtZ29sZC1saWdodCk7CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgbGV0dGVyLXNwYWNpbmc6IDFweDsKICAgIHRleHQtc2hhZG93OiAwIDJweCAycHggcmdiYSgwLDAsMCwwLjgpOwp9Ci50ZWFtLXN1YiB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC1kYXRhKTsKICAgIGZvbnQtc2l6ZTogMTBweDsKICAgIGNvbG9yOiB2YXIoLS1mZngtY3lhbik7CiAgICBvcGFjaXR5OiAwLjg7Cn0KLnRlYW0td2luZy5hd2F5IC50ZWFtLXN1YiB7IGNvbG9yOiAjZmZhYWFhOyB9Cgouc2NvcmUtYm94IHsKICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LWRhdGEpOwogICAgZm9udC1zaXplOiAzOHB4OwogICAgY29sb3I6IHdoaXRlOwogICAgdGV4dC1zaGFkb3c6IDAgMCAxMHB4IHZhcigtLWZmeC1jeWFuLWdsb3cpOwogICAgdHJhbnNmb3JtOiBza2V3WCgxNWRlZyk7CiAgICBtYXJnaW46IDAgMTBweDsKfQoudGVhbS13aW5nLmF3YXkgLnNjb3JlLWJveCB7IHRyYW5zZm9ybTogc2tld1goLTE1ZGVnKTsgdGV4dC1zaGFkb3c6IDAgMCAxMHB4ICNmZjQ0NDQ7IH0KCi8qIFRpbWVyIENvbXBsZXggKi8KLnRpbWVyLWNvbXBsZXggewogICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgZGlzcGxheTogZmxleDsKICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgbWFyZ2luLXRvcDogLTVweDsKfQoKLnRpbWVyLWNyeXN0YWwtcmluZyB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IC0yNXB4OwogICAgd2lkdGg6IDEyMHB4OwogICAgaGVpZ2h0OiA2MHB4OwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgYm9yZGVyLXRvcDogM3B4IHNvbGlkIHZhcigtLWZmeC1nb2xkKTsKICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCB0cmFuc3BhcmVudDsKICAgIGJveC1zaGFkb3c6IDAgLTVweCAxNXB4IHJnYmEoMjAwLCAxODAsIDEwMCwgMC4zKTsKICAgIHotaW5kZXg6IC0xOwogICAgYmFja2dyb3VuZDogcmFkaWFsLWdyYWRpZW50KGVsbGlwc2UgYXQgdG9wLCByZ2JhKDIwLCA0MCwgODAsIDAuOCksIHRyYW5zcGFyZW50IDcwJSk7Cn0KCiNoYWxmLWluZGljYXRvciB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC1kYXRhKTsKICAgIGZvbnQtc2l6ZTogMTBweDsKICAgIGNvbG9yOiB2YXIoLS1mZngtZ29sZCk7CiAgICBsZXR0ZXItc3BhY2luZzogMnB4OwogICAgbWFyZ2luLWJvdHRvbTogLTJweDsKICAgIHRleHQtc2hhZG93OiAwIDAgNXB4IHZhcigtLWZmeC1nb2xkLWRhcmspOwp9CgojdGltZXItZGlzcGxheSB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC1kYXRhKTsKICAgIGZvbnQtc2l6ZTogNDJweDsKICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCh0byBib3R0b20sICNmZmYgMCUsICNmZmQ3MDAgNTAlLCAjYjg4NjBiIDEwMCUpOwogICAgLXdlYmtpdC1iYWNrZ3JvdW5kLWNsaXA6IHRleHQ7CiAgICAtd2Via2l0LXRleHQtZmlsbC1jb2xvcjogdHJhbnNwYXJlbnQ7CiAgICBmaWx0ZXI6IGRyb3Atc2hhZG93KDJweCAycHggMHB4IHJnYmEoMCwwLDAsMC44KSk7CiAgICBsZXR0ZXItc3BhY2luZzogMXB4Owp9CgovKiAtLS0gUExBWUVSIFNUQVRVUyBQQU5FTCAoQm90dG9tIExlZnQpIC0tLSAqLwojcGxheWVyLXN0YXR1cy1wYW5lbCB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICBib3R0b206IDE2MHB4OyAvKiBBYm92ZSBqb3lzdGljayAqLwogICAgbGVmdDogMjBweDsKICAgIHdpZHRoOiAxNjBweDsKICAgIHBhZGRpbmc6IDEwcHg7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsIHJnYmEoMCwgMTAsIDMwLCAwLjgpIDAlLCByZ2JhKDAsMCwwLDApIDEwMCUpOwogICAgYm9yZGVyLWxlZnQ6IDNweCBzb2xpZCB2YXIoLS1mZngtY3lhbik7CiAgICBib3JkZXItcmFkaXVzOiAwIDEwcHggMTBweCAwOwogICAgYmFja2Ryb3AtZmlsdGVyOiBibHVyKDRweCk7CiAgICB0cmFuc2Zvcm06IHNrZXdYKC0xMGRlZyk7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgIGRpc3BsYXk6IG5vbmU7IC8qIEhpZGRlbiBieSBkZWZhdWx0LCBzaG93biBieSBKUyAqLwp9CgouY2hhci1uYW1lIHsKICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LXRpdGxlKTsKICAgIGZvbnQtc2l6ZTogMThweDsKICAgIGNvbG9yOiB3aGl0ZTsKICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICBtYXJnaW4tYm90dG9tOiA1cHg7CiAgICB0cmFuc2Zvcm06IHNrZXdYKDEwZGVnKTsKICAgIHRleHQtc2hhZG93OiAwIDAgNXB4IHZhcigtLWZmeC1ibHVlLWxpZ2h0KTsKfQoKLmhwLWdhdWdlLWNvbnRhaW5lciB7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgIG1hcmdpbi1ib3R0b206IDRweDsKICAgIHRyYW5zZm9ybTogc2tld1goMTBkZWcpOwp9Ci5ocC1sYWJlbCB7IGZvbnQtc2l6ZTogMTBweDsgY29sb3I6IHZhcigtLWZmeC1jeWFuKTsgd2lkdGg6IDIwcHg7IH0KLmhwLWJhci10cmFjayB7CiAgICBmbGV4LWdyb3c6IDE7CiAgICBoZWlnaHQ6IDZweDsKICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC41KTsKICAgIGJvcmRlcjogMXB4IHNvbGlkICM0NDQ7CiAgICBtYXJnaW46IDAgNXB4Owp9Ci5ocC1iYXItZmlsbCB7CiAgICBoZWlnaHQ6IDEwMCU7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsICMwMGZmMDAsICNjY2ZmY2MpOwogICAgYm94LXNoYWRvdzogMCAwIDVweCAjMDBmZjAwOwp9Ci5ocC12YWx1ZSB7IGZvbnQtc2l6ZTogMTBweDsgY29sb3I6ICNmZmY7IHdpZHRoOiA0NXB4OyB0ZXh0LWFsaWduOiByaWdodDsgfQoKLnRlY2gtZ2F1Z2UtY29udGFpbmVyIHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgdHJhbnNmb3JtOiBza2V3WCgxMGRlZyk7Cn0KLnRlY2gtbGFiZWwgeyBmb250LXNpemU6IDEwcHg7IGNvbG9yOiB2YXIoLS1mZngtZ29sZCk7IHdpZHRoOiAyMHB4OyB9Ci50ZWNoLWJhci10cmFjayB7CiAgICBmbGV4LWdyb3c6IDE7CiAgICBoZWlnaHQ6IDRweDsKICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC41KTsKICAgIGJvcmRlcjogMXB4IHNvbGlkICM0NDQ7CiAgICBtYXJnaW46IDAgNXB4Owp9Ci50ZWNoLWJhci1maWxsIHsKICAgIGhlaWdodDogMTAwJTsKICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCg5MGRlZywgI2ZmYWEwMCwgI2ZmZmZhYSk7Cn0KCi8qIC0tLSBNSU5JTUFQIChTcGhlcmUgUmFkYXIpIC0tLSAqLwojbWluaW1hcC1jb250YWluZXIgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiA4MHB4OwogICAgcmlnaHQ6IDIwcHg7CiAgICB3aWR0aDogMTEwcHg7CiAgICBoZWlnaHQ6IDExMHB4OwogICAgZGlzcGxheTogZmxleDsKICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKfQoKLnJhZGFyLXJpbSB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB3aWR0aDogMTAwJTsgaGVpZ2h0OiAxMDAlOwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgYm9yZGVyOiAycHggc29saWQgdmFyKC0tZmZ4LWJsdWUtbGlnaHQpOwogICAgYm94LXNoYWRvdzogMCAwIDE1cHggdmFyKC0tZmZ4LWJsdWUtbWlkKSwgaW5zZXQgMCAwIDIwcHggcmdiYSgwLDAsMCwwLjgpOwogICAgYmFja2dyb3VuZDogcmFkaWFsLWdyYWRpZW50KGNpcmNsZSwgcmdiYSgwLCAyMCwgNjAsIDAuNCkgMCUsIHJnYmEoMCwgNSwgMTAsIDAuOCkgMTAwJSk7CiAgICB6LWluZGV4OiA1Owp9CgojbWluaW1hcCB7CiAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICB3aWR0aDogMTAwcHg7CiAgICBoZWlnaHQ6IDEwMHB4OwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgei1pbmRleDogNjsKICAgIG92ZXJmbG93OiBoaWRkZW47Cn0KCi5yYWRhci1sYWJlbCB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICBib3R0b206IC0xNXB4OwogICAgd2lkdGg6IDEwMCU7CiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICBmb250LXNpemU6IDlweDsKICAgIGNvbG9yOiB2YXIoLS1mZngtY3lhbik7CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgbGV0dGVyLXNwYWNpbmc6IDFweDsKICAgIHRleHQtc2hhZG93OiAwIDAgNXB4IHZhcigtLWZmeC1jeWFuKTsKfQoKLyogTWFwIERvdHMgKi8KLm1hcC1kb3QgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgd2lkdGg6IDZweDsgaGVpZ2h0OiA2cHg7CiAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKTsgLyogQ2VudGVyIGFuY2hvciAqLwogICAgYm94LXNoYWRvdzogMCAwIDRweCBjdXJyZW50Q29sb3I7Cn0KLm1hcC1kb3QuaG9tZSB7IGJhY2tncm91bmQ6IHZhcigtLWZmeC1jeWFuKTsgY29sb3I6IHZhcigtLWZmeC1jeWFuKTsgfQoubWFwLWRvdC5hd2F5IHsgYmFja2dyb3VuZDogI2ZmNDQ0NDsgY29sb3I6ICNmZjQ0NDQ7IH0KLm1hcC1kb3QuYmFsbCB7IAogICAgYmFja2dyb3VuZDogI2ZmMDBjYzsgLyogSG90IFBpbmsgZm9yIHZpc2liaWxpdHkgKi8KICAgIGNvbG9yOiAjZmYwMGNjOyAKICAgIHdpZHRoOiAxMnB4OyBoZWlnaHQ6IDEycHg7CiAgICBib3JkZXI6IDJweCBzb2xpZCAjZmZmZmZmOwogICAgei1pbmRleDogMjA7CiAgICBhbmltYXRpb246IGJsaW5rQmFsbCAwLjNzIGluZmluaXRlIGFsdGVybmF0ZTsKICAgIGJveC1zaGFkb3c6IDAgMCA2cHggI2ZmMDBjYzsKfQoubWFwLWRvdC5uYXAgeyBiYWNrZ3JvdW5kOiAjMzMzOyBjb2xvcjogIzAwMDsgYm9yZGVyOiAxcHggc29saWQgIzU1NTsgfQoubWFwLWRvdC5hY3RpdmUtcGxheWVyIHsgCiAgICBiYWNrZ3JvdW5kOiAjMDBmZjAwICFpbXBvcnRhbnQ7IAogICAgY29sb3I6ICMwMGZmMDAgIWltcG9ydGFudDsgCiAgICBib3gtc2hhZG93OiAwIDAgOHB4ICMwMGZmMDA7CiAgICB6LWluZGV4OiAxNTsKdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSkgc2NhbGUoMS4yKTsKfQoKLm1hcC1kb3QuYmFsbC1jYXJyaWVyIHsKICAgIGJveC1zaGFkb3c6IDAgMCAxNXB4ICNmZmYsIDAgMCAzMHB4ICNmZmFhMDA7CiAgICBib3JkZXI6IDJweCBzb2xpZCAjZmZmZmZmOwogICAgYmFja2dyb3VuZC1jb2xvcjogI2ZmYWEwMCAhaW1wb3J0YW50OwogICAgei1pbmRleDogMTAwOwogICAgd2lkdGg6IDEwcHg7IGhlaWdodDogMTBweDsgLyogU2xpZ2h0bHkgbGFyZ2VyICovCiAgICBhbmltYXRpb246IGNhcnJpZXJQdWxzZSAwLjhzIGluZmluaXRlIGFsdGVybmF0ZTsKfQpAa2V5ZnJhbWVzIGNhcnJpZXJQdWxzZSB7CiAgICBmcm9tIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSkgc2NhbGUoMS4yKTsgYm94LXNoYWRvdzogMCAwIDEwcHggI2ZmZjsgb3BhY2l0eTogMC44OyB9CiAgICB0byB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpIHNjYWxlKDEuOCk7IGJveC1zaGFkb3c6IDAgMCAyNXB4ICNmZmNjMDA7IG9wYWNpdHk6IDEuMDsgfQp9CkBrZXlmcmFtZXMgYmxpbmtCYWxsIHsgZnJvbSB7IG9wYWNpdHk6IDE7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpIHNjYWxlKDEpOyB9IHRvIHsgb3BhY2l0eTogMC41OyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKSBzY2FsZSgxLjMpOyB9IH0KCi8qIC0tLSBBTk5PVU5DRU1FTlRTIChHb2FsLCBCbGl0em9mZikgLS0tICovCiNhbm5vdW5jZW1lbnQgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiA0MCU7IAogICAgbGVmdDogNSU7IAogICAgd2lkdGg6IDkwJTsKICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LWRhdGEpOwogICAgZm9udC1zaXplOiBjbGFtcCg0MHB4LCAxMnZ3LCA3MnB4KTsgLyogRHluYW1pYyBzaXppbmcgKi8KICAgIGZvbnQtd2VpZ2h0OiA5MDA7CiAgICBmb250LXN0eWxlOiBpdGFsaWM7CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgbGV0dGVyLXNwYWNpbmc6IDJweDsgLyogUmVkdWNlZCBzcGFjaW5nIHRvIGZpdCAqLwogICAgbGluZS1oZWlnaHQ6IDEuMDsKICAgIHdoaXRlLXNwYWNlOiBub3JtYWw7IC8qIEFsbG93IHdyYXBwaW5nICovCiAgICAKICAgIC8qIE1ldGFsbGljIEdvbGQgR3JhZGllbnQgKi8KICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCh0byBib3R0b20sICNmZmYgMCUsICNmZmQ3MDAgNDAlLCAjYjg4NjBiIDEwMCUpOwogICAgLXdlYmtpdC1iYWNrZ3JvdW5kLWNsaXA6IHRleHQ7CiAgICAtd2Via2l0LXRleHQtZmlsbC1jb2xvcjogdHJhbnNwYXJlbnQ7CiAgICBmaWx0ZXI6IGRyb3Atc2hhZG93KDAgMCAxMHB4IHJnYmEoMjU1LCAxMDAsIDAsIDAuNSkpIGRyb3Atc2hhZG93KDNweCAzcHggMCAjMDAwKTsKICAgIAogICAgZGlzcGxheTogbm9uZTsKICAgIHotaW5kZXg6IDIwMDA7CiAgICBhbmltYXRpb246IGFubm91bmNlU2xpZGUgMC41cyBjdWJpYy1iZXppZXIoMC4xNzUsIDAuODg1LCAwLjMyLCAxLjI3NSk7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsgLyogQ2xpY2sgdGhyb3VnaCAqLwp9CgpAa2V5ZnJhbWVzIGFubm91bmNlU2xpZGUgewogICAgZnJvbSB7IHRyYW5zZm9ybTogc2NhbGUoMCkgcm90YXRlKC01ZGVnKTsgb3BhY2l0eTogMDsgfQogICAgdG8geyB0cmFuc2Zvcm06IHNjYWxlKDEpIHJvdGF0ZSgwZGVnKTsgb3BhY2l0eTogMTsgfQp9CgovKiAtLS0gQ09OVFJPTFMgKFNQSEVSRSBHUklEIEFSVElGQUNUUykgLS0tICovCgovKiBKb3lzdGljazogVGhlIE5hdmlnYXRpb24gU3BoZXJlICovCi8qIC0tLSBKT1lTVElDSyAoRkxPQVRJTkcpIC0tLSAqLwojam95c3RpY2staGl0LXpvbmUgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgYm90dG9tOiAwOyBsZWZ0OiAwOwogICAgd2lkdGg6IDUwJTsgaGVpZ2h0OiA1MCU7CiAgICB6LWluZGV4OiAxMDAwOwogICAgLyogdHJhbnNwYXJlbnQgYnV0IGludGVyYWN0aXZlICovCiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDApOyAKICAgIHRvdWNoLWFjdGlvbjogbm9uZTsKICAgIHBvaW50ZXItZXZlbnRzOiBhdXRvOwp9Cgojam95c3RpY2stdmlzdWFsLWNvbnRhaW5lciB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IDA7IGxlZnQ6IDA7CiAgICB3aWR0aDogMDsgaGVpZ2h0OiAwOwogICAgb3ZlcmZsb3c6IHZpc2libGU7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgIGRpc3BsYXk6IG5vbmU7IC8qIEhpZGRlbiB1bnRpbCB0b3VjaGVkICovCiAgICB6LWluZGV4OiAxMTAwOwp9Cgojam95c3RpY2stYmFzZSB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IDUwJTsgbGVmdDogNTAlOwogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSk7CiAgICB3aWR0aDogMTIwcHg7IGhlaWdodDogMTIwcHg7CiAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICAKICAgIC8qIEdsYXNzeSBCYXNlICovCiAgICBiYWNrZ3JvdW5kOiByYWRpYWwtZ3JhZGllbnQoY2lyY2xlLCByZ2JhKDAsIDQwLCA4MCwgMC40KSAwJSwgcmdiYSgwLCAxMCwgMjAsIDAuMSkgNjAlLCB0cmFuc3BhcmVudCAxMDAlKTsKICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMTAwLCAyMjAsIDI1NSwgMC4zKTsKICAgIGJveC1zaGFkb3c6IDAgMCAyMHB4IHJnYmEoMCwgMTAwLCAyNTUsIDAuMiksIGluc2V0IDAgMCAzMHB4IHJnYmEoMCwgNTAsIDEwMCwgMC4zKTsKICAgIAogICAgYW5pbWF0aW9uOiBiYXNlUHVsc2UgMnMgaW5maW5pdGUgYWx0ZXJuYXRlOwp9CgpAa2V5ZnJhbWVzIGJhc2VQdWxzZSB7CiAgICBmcm9tIHsgYm94LXNoYWRvdzogMCAwIDEwcHggcmdiYSgwLCAxMDAsIDI1NSwgMC4yKTsgYm9yZGVyLWNvbG9yOiByZ2JhKDEwMCwgMjIwLCAyNTUsIDAuMik7IH0KICAgIHRvIHsgYm94LXNoYWRvdzogMCAwIDI1cHggcmdiYSgwLCAxMDAsIDI1NSwgMC41KTsgYm9yZGVyLWNvbG9yOiByZ2JhKDEwMCwgMjU1LCAyNTUsIDAuNik7IH0KfQoKI2pveXN0aWNrLWtub2IgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiA1MCU7IGxlZnQ6IDUwJTsKICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpOyAvKiBDZW50ZXJlZCBpbml0aWFsbHksIG1vdmVkIGJ5IEpTICovCiAgICB3aWR0aDogNTBweDsgaGVpZ2h0OiA1MHB4OwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgCiAgICAvKiBTcGhlcmUgTG9vazogQ3lhbi9CbHVlICovCiAgICBiYWNrZ3JvdW5kOiByYWRpYWwtZ3JhZGllbnQoY2lyY2xlIGF0IDMwJSAzMCUsICNlMGZmZmYgMCUsICMwMGFhZmYgNDAlLCAjMDA0NDg4IDgwJSwgIzAwMTEyMiAxMDAlKTsKICAgIGJvcmRlcjogMnB4IHNvbGlkICM4OGNjZmY7CiAgICBib3gtc2hhZG93OiAwIDAgMTVweCAjMDBmZmZmLCBpbnNldCAwIDAgMTBweCByZ2JhKDI1NSwyNTUsMjU1LDAuOCk7CiAgICAKICAgIHRyYW5zaXRpb246IHRyYW5zZm9ybSAwLjA1cyBsaW5lYXI7Cn0KCi8qIElubmVyIGxpZ2h0IG9mIGtub2IgKi8KI2pveXN0aWNrLWtub2I6OmFmdGVyIHsKICAgIGNvbnRlbnQ6ICIiOwogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiAyMCU7IGxlZnQ6IDIwJTsgd2lkdGg6IDIwJTsgaGVpZ2h0OiAyMCU7CiAgICBiYWNrZ3JvdW5kOiByYWRpYWwtZ3JhZGllbnQoY2lyY2xlLCAjZmZmZmZmIDAlLCB0cmFuc3BhcmVudCA3MCUpOwogICAgZmlsdGVyOiBibHVyKDJweCk7CiAgICBvcGFjaXR5OiAwLjg7Cn0KCi8qIC0tLSBUT1VDSCBSSVBQTEUgRlggLS0tICovCi50b3VjaC1yaXBwbGUgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgYmFja2dyb3VuZDogcmFkaWFsLWdyYWRpZW50KGNpcmNsZSwgcmdiYSgyMDAsIDI1NSwgMjU1LCAwLjgpIDAlLCByZ2JhKDAsIDI1NSwgMjU1LCAwLjQpIDQwJSwgdHJhbnNwYXJlbnQgNzAlKTsKICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpIHNjYWxlKDApOwogICAgYW5pbWF0aW9uOiByaXBwbGVBbmltIDAuNnMgZWFzZS1vdXQgZm9yd2FyZHM7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgIHotaW5kZXg6IDkwMDA7CiAgICBtaXgtYmxlbmQtbW9kZTogc2NyZWVuOwp9CgpAa2V5ZnJhbWVzIHJpcHBsZUFuaW0gewogICAgMCUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKSBzY2FsZSgwKTsgb3BhY2l0eTogMTsgfQogICAgMTAwJSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpIHNjYWxlKDMuMCk7IG9wYWNpdHk6IDA7IH0KfQoKI2NhbWVyYS16b25lIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMDsgcmlnaHQ6IDA7IHdpZHRoOiA1MCU7IGhlaWdodDogMTAwJTsKICAgIHBvaW50ZXItZXZlbnRzOiBhdXRvOwogICAgdG91Y2gtYWN0aW9uOiBub25lOwogICAgei1pbmRleDogNTA7Cn0KCi8qIC0tLSBBQ1RJT04gQlVUVE9OIChUSEUgTElNSVQgU1BIRVJFKSAtLS0gKi8KI2FjdGlvbi1jb250YWluZXIgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgYm90dG9tOiA0MHB4OyByaWdodDogNDBweDsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgIHBvaW50ZXItZXZlbnRzOiBhdXRvOwogICAgei1pbmRleDogMTAwOwp9CgouY29tbWFuZC1tZW51LWJnIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHdpZHRoOiAxODBweDsgaGVpZ2h0OiA4MHB4OwogICAgYm90dG9tOiAxNXB4OwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCB0cmFuc3BhcmVudCAwJSwgcmdiYSgwLCAxMCwgMzAsIDAuOCkgNTAlLCB0cmFuc3BhcmVudCAxMDAlKTsKICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCByZ2JhKDAsIDIwMCwgMjU1LCAwLjMpOwogICAgei1pbmRleDogLTE7Cn0KCi5jb21tYW5kLXJpbmcgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiA1MCU7IGxlZnQ6IDUwJTsKICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpOwogICAgd2lkdGg6IDEzMHB4OyBoZWlnaHQ6IDEzMHB4OwogICAgYm9yZGVyOiAycHggc29saWQgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjEpOwogICAgYm9yZGVyLXRvcDogMnB4IHNvbGlkIHJnYmEoMCwgMjU1LCAyNTUsIDAuNik7CiAgICBib3JkZXItYm90dG9tOiAycHggc29saWQgcmdiYSgwLCAyNTUsIDI1NSwgMC42KTsKICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgIGFuaW1hdGlvbjogc3BpblJldmVyc2UgMTVzIGxpbmVhciBpbmZpbml0ZTsKICAgIHBvaW50ZXItZXZlbnRzOiBub25lOwogICAgYm94LXNoYWRvdzogMCAwIDE1cHggcmdiYSgwLCAxMDAsIDI1NSwgMC4yKTsKfQpAa2V5ZnJhbWVzIHNwaW5SZXZlcnNlIHsgZnJvbSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpIHJvdGF0ZSgzNjBkZWcpOyB9IHRvIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSkgcm90YXRlKDBkZWcpOyB9IH0KCiNhY3Rpb24tbGFiZWwgewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtZGF0YSk7CiAgICBmb250LXNpemU6IDEycHg7CiAgICBjb2xvcjogdmFyKC0tZmZ4LWN5YW4pOwogICAgYmFja2dyb3VuZDogcmdiYSgwLCA1LCAxMCwgMC44KTsKICAgIHBhZGRpbmc6IDRweCAxMnB4OwogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tZmZ4LWJsdWUtbGlnaHQpOwogICAgYm9yZGVyLXJhZGl1czogMTBweDsKICAgIG1hcmdpbi1ib3R0b206IDE1cHg7CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgbGV0dGVyLXNwYWNpbmc6IDJweDsKICAgIGJveC1zaGFkb3c6IDAgMCAxMHB4IHJnYmEoMCwwLDAsMC44KTsKICAgIHRleHQtc2hhZG93OiAwIDAgNXB4IHZhcigtLWZmeC1jeWFuKTsKICAgIHRyYW5zaXRpb246IGFsbCAwLjNzOwp9CgojYWN0aW9uLWJ1dHRvbiB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IDA7IGxlZnQ6IDA7CiAgICB3aWR0aDogMTAwcHg7IGhlaWdodDogMTAwcHg7CiAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gMC4xcywgZmlsdGVyIDAuM3M7CiAgICAKICAgIC8qIERlZmF1bHQ6IFN3aW0gTW9kZSAoQmx1ZSBTcGhlcmUpICovCiAgICBiYWNrZ3JvdW5kOiByYWRpYWwtZ3JhZGllbnQoY2lyY2xlIGF0IDM1JSAzNSUsICNmZmZmZmYgMCUsICMwMDg4ZmYgNDAlLCAjMDAyMjY2IDgwJSwgIzAwMCAxMDAlKTsKICAgIGJvcmRlcjogM3B4IHNvbGlkICM0NGFhZmY7CiAgICBib3gtc2hhZG93OiAKICAgICAgICAwIDAgMjBweCByZ2JhKDAsIDEwMCwgMjU1LCAwLjgpLAogICAgICAgIGluc2V0IDAgMCAyMHB4IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC40KTsKICAgICAgICAKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICBvdmVyZmxvdzogdmlzaWJsZTsgLyogQWxsb3cgcmluZyB0byBwdWxzZSBvdXQgKi8KICAgIHotaW5kZXg6IDEwOwp9CgojcGFzcy1idXR0b24gewogICAgZGlzcGxheTogbm9uZSAhaW1wb3J0YW50OyAvKiBIaWRkZW4gYXMgcGVyIHVzZXIgcmVxdWVzdCAqLwogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgYm90dG9tOiAtMjBweDsgbGVmdDogLTMwcHg7CiAgICB3aWR0aDogNjBweDsgaGVpZ2h0OiA2MHB4OwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgY3Vyc29yOiBwb2ludGVyOwogICAgei1pbmRleDogOTsKfQoKI3Bhc3MtYnV0dG9uOmFjdGl2ZSB7IHRyYW5zZm9ybTogc2NhbGUoMC45Mik7IH0KI3Bhc3MtYnV0dG9uLnZpc2libGUgeyBkaXNwbGF5OiBmbGV4OyBhbmltYXRpb246IHBvcEluIDAuM3MgY3ViaWMtYmV6aWVyKDAuMTc1LCAwLjg4NSwgMC4zMiwgMS4yNzUpOyB9CgpAa2V5ZnJhbWVzIHBvcEluIHsKICAgIGZyb20geyB0cmFuc2Zvcm06IHNjYWxlKDApOyBvcGFjaXR5OiAwOyB9CiAgICB0byB7IHRyYW5zZm9ybTogc2NhbGUoMSk7IG9wYWNpdHk6IDE7IH0KfQoKI3Bhc3MtYnV0dG9uIC5idG4tdGV4dCB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC1kYXRhKTsKICAgIGZvbnQtc2l6ZTogMTRweDsKICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgY29sb3I6IHdoaXRlOwogICAgdGV4dC1zaGFkb3c6IDAgMXB4IDJweCByZ2JhKDAsMCwwLDAuOCk7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKfQoKI3Bhc3MtYnV0dG9uIC5idG4tZ2xhcmUgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiAtNTAlOyBsZWZ0OiAtNTAlOyB3aWR0aDogMjAwJTsgaGVpZ2h0OiAyMDAlOwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDQ1ZGVnLCB0cmFuc3BhcmVudCA0MCUsIHJnYmEoMjU1LDI1NSwyNTUsMC4zKSA1MCUsIHRyYW5zcGFyZW50IDYwJSk7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKfQoKLyogRXhwYW5kZWQgSGl0IEFyZWEgKEludmlzaWJsZSkgKi8KI2FjdGlvbi1idXR0b246OmJlZm9yZSB7CiAgICBjb250ZW50OiAnJzsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogLTQwcHg7IGxlZnQ6IC00MHB4OyByaWdodDogLTQwcHg7IGJvdHRvbTogLTQwcHg7CiAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICB6LWluZGV4OiAxMDsKICAgIC8qIERlYnVnOiBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwgMCwgMCwgMC4yKTsgKi8KfQoKI2FjdGlvbi1idXR0b246YWN0aXZlIHsgdHJhbnNmb3JtOiBzY2FsZSgwLjkyKTsgfQoKLyogVGV4dCBpbnNpZGUgYnV0dG9uICovCiNhY3Rpb24tYnV0dG9uIC5idG4tdGV4dCB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC10aXRsZSk7CiAgICBmb250LXNpemU6IDIycHg7CiAgICBmb250LXdlaWdodDogYm9sZDsKICAgIGNvbG9yOiB3aGl0ZTsKICAgIHRleHQtc2hhZG93OiAwIDJweCA0cHggcmdiYSgwLDAsMCwwLjgpLCAwIDAgMTBweCByZ2JhKDI1NSwyNTUsMjU1LDAuNSk7CiAgICB6LWluZGV4OiA1OwogICAgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgICBsZXR0ZXItc3BhY2luZzogMXB4Owp9CgovKiBHbGFyZSBFZmZlY3QgKi8KI2FjdGlvbi1idXR0b24gLmJ0bi1nbGFyZSB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IC01MCU7IGxlZnQ6IC01MCU7IHdpZHRoOiAyMDAlOyBoZWlnaHQ6IDIwMCU7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoNDVkZWcsIHRyYW5zcGFyZW50IDQwJSwgcmdiYSgyNTUsMjU1LDI1NSwwLjQpIDUwJSwgdHJhbnNwYXJlbnQgNjAlKTsKICAgIGFuaW1hdGlvbjogZ2xhcmVQYXNzIDVzIGluZmluaXRlOwogICAgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgICB6LWluZGV4OiA2OwogICAgYm9yZGVyLXJhZGl1czogNTAlOwp9CgovKiBMaW1pdCBSaW5nIChUaGUgR2xvdyBQdWxzZSkgKi8KLmxpbWl0LXJpbmcgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiAtNXB4OyBsZWZ0OiAtNXB4OyByaWdodDogLTVweDsgYm90dG9tOiAtNXB4OwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgYm9yZGVyOiAycHggc29saWQgdHJhbnNwYXJlbnQ7CiAgICBib3gtc2hhZG93OiAwIDAgMCB0cmFuc3BhcmVudDsKICAgIHRyYW5zaXRpb246IGFsbCAwLjVzOwogICAgei1pbmRleDogMTsKICAgIHBvaW50ZXItZXZlbnRzOiBub25lOwp9CgovKiAtLS0gU0hPT1QgTU9ERSAoT0ZGRU5TRSkgLS0tICovCiNhY3Rpb24tYnV0dG9uLnNob290LW1vZGUgewogICAgLyogR29sZC9GaXJlIFNwaGVyZSAqLwogICAgYmFja2dyb3VuZDogcmFkaWFsLWdyYWRpZW50KGNpcmNsZSBhdCAzNSUgMzUlLCAjZmZmZmFhIDAlLCAjZmZhYTAwIDQwJSwgIzg4MjIwMCA4MCUsICMyMjAwMDAgMTAwJSk7CiAgICBib3JkZXItY29sb3I6ICNmZmNjMDA7CiAgICBib3gtc2hhZG93OiAKICAgICAgICAwIDAgMzBweCByZ2JhKDI1NSwgMTAwLCAwLCAwLjgpLAogICAgICAgIGluc2V0IDAgMCAyMHB4IHJnYmEoMjU1LCAyNTUsIDAsIDAuNSk7Cn0KCi8qIExpbWl0IEJyZWFrIEdsb3cgKEhpZ2ggRW5lcmd5KSAqLwojYWN0aW9uLWJ1dHRvbi5saW1pdC1yZWFkeSAubGltaXQtcmluZyB7CiAgICBib3JkZXItY29sb3I6ICNmZmRkNDQ7CiAgICBhbmltYXRpb246IGxpbWl0UHVsc2UgMC44cyBlYXNlLWluLW91dCBpbmZpbml0ZSBhbHRlcm5hdGU7Cn0KCi8qIExhYmVsIENoYW5nZSAqLwouc2hvb3QtbGFiZWwgewogICAgY29sb3I6ICNmZmRkNDQgIWltcG9ydGFudDsKICAgIGJvcmRlci1jb2xvcjogI2ZmYWEwMCAhaW1wb3J0YW50OwogICAgdGV4dC1zaGFkb3c6IDAgMCAxMHB4ICNmZjQ0MDAgIWltcG9ydGFudDsKfQoKQGtleWZyYW1lcyBsaW1pdFB1bHNlIHsKICAgIDAlIHsgCiAgICAgICAgdHJhbnNmb3JtOiBzY2FsZSgxLjApOyAKICAgICAgICBib3gtc2hhZG93OiAwIDAgMTBweCAjZmZhYTAwLCBpbnNldCAwIDAgNXB4ICNmZmFhMDA7IAogICAgICAgIG9wYWNpdHk6IDAuNTsKICAgIH0KICAgIDEwMCUgeyAKICAgICAgICB0cmFuc2Zvcm06IHNjYWxlKDEuMTUpOyAKICAgICAgICBib3gtc2hhZG93OiAwIDAgMzBweCAjZmY0NDAwLCBpbnNldCAwIDAgMTVweCAjZmYwMDAwOyAKICAgICAgICBvcGFjaXR5OiAxLjA7CiAgICB9Cn0KCi8qIC0tLSBBVVRPIFRPR0dMRSAoR2xhc3MgQnV0dG9uKSAtLS0gKi8KI2F1dG8tdG9nZ2xlIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMjAwcHg7IHJpZ2h0OiAyMHB4OwogICAgd2lkdGg6IDExMHB4OwogICAgcGFkZGluZzogMTBweCAwOwogICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgZm9udC1zaXplOiAxMnB4OwogICAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgICBjb2xvcjogdmFyKC0tZmZ4LWN5YW4pOwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgcmdiYSgwLCAyMCwgNDAsIDAuOCkgMCUsIHJnYmEoMCwgNSwgMTAsIDAuOSkgMTAwJSk7CiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1mZngtYmx1ZS1saWdodCk7CiAgICBib3JkZXItdG9wOiAxcHggc29saWQgdmFyKC0tZmZ4LWN5YW4pOwogICAgYm9yZGVyLXJhZGl1czogNHB4OwogICAgY3Vyc29yOiBwb2ludGVyOwogICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsKICAgIGxldHRlci1zcGFjaW5nOiAxcHg7CiAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoNHB4KTsKICAgIGJveC1zaGFkb3c6IDAgNXB4IDE1cHggcmdiYSgwLDAsMCwwLjMpOwogICAgcG9pbnRlci1ldmVudHM6IGF1dG87CiAgICB0cmFuc2l0aW9uOiBhbGwgMC4yczsKICAgIHotaW5kZXg6IDEwMDsKfQoKI2F1dG8tdG9nZ2xlOmhvdmVyIHsKICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgNDAsIDgwLCAwLjkpOwogICAgYm94LXNoYWRvdzogMCAwIDE1cHggdmFyKC0tZmZ4LWN5YW4pOwogICAgY29sb3I6IHdoaXRlOwp9CgojYXV0by10b2dnbGUuYWN0aXZlIHsKICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsIHJnYmEoMTAwLCAyMCwgMCwgMC44KSAwJSwgcmdiYSg0MCwgMCwgMCwgMC45KSAxMDAlKTsKICAgIGJvcmRlci1jb2xvcjogI2ZmNDQwMDsKICAgIGNvbG9yOiAjZmZhYTAwOwogICAgYW5pbWF0aW9uOiBwdWxzZVJlZCAycyBpbmZpbml0ZTsKfQpAa2V5ZnJhbWVzIHB1bHNlUmVkIHsgMCUgeyBib3gtc2hhZG93OiAwIDAgNXB4ICNmZjAwMDA7IH0gNTAlIHsgYm94LXNoYWRvdzogMCAwIDIwcHggI2ZmNDQwMDsgfSAxMDAlIHsgYm94LXNoYWRvdzogMCAwIDVweCAjZmYwMDAwOyB9IH0KCi8qIC0tLSBGTE9BVElORyBURVhUIC0tLSAqLwovKiAtLS0gRkxPQVRJTkcgVEVYVCBNQU5BR0VSIC0tLSAqLwouZmxvYXRpbmctdGV4dC13cmFwcGVyIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMDsgbGVmdDogMDsKICAgIHBvaW50ZXItZXZlbnRzOiBub25lOwogICAgei1pbmRleDogMjAwMDsKICAgIHdpbGwtY2hhbmdlOiB0cmFuc2Zvcm07Cn0KCi5mbG9hdGluZy10ZXh0LWlubmVyIHsKICAgIGRpc3BsYXk6IGJsb2NrOwogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtZGF0YSk7CiAgICBmb250LXdlaWdodDogOTAwOwogICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsKICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7CiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAvKiBSZWR1Y2VkIGRlZmF1bHQgc2l6ZSBhbmQgc2hhZG93IGZvciBjbGFyaXR5ICovCiAgICBmb250LXNpemU6IDI0cHg7IAogICAgdGV4dC1zaGFkb3c6IDFweCAxcHggMCAjMDAwOwogICAgb3BhY2l0eTogMC45Owp9CgovKiBEQU1BR0UgKE51bWVyaWMpICovCi5mbG9hdGluZy10ZXh0LWlubmVyLmRhbWFnZSB7CiAgICBmb250LXNpemU6IDQycHg7CiAgICBmb250LXN0eWxlOiBpdGFsaWM7CiAgICAvKiBHb2xkL09yYW5nZSBHcmFkaWVudCAqLwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KHRvIGJvdHRvbSwgI2ZmZmZmZiAwJSwgI2ZmY2MwMCA0MCUsICNmZjQ0MDAgMTAwJSk7CiAgICAtd2Via2l0LWJhY2tncm91bmQtY2xpcDogdGV4dDsKICAgIC13ZWJraXQtdGV4dC1maWxsLWNvbG9yOiB0cmFuc3BhcmVudDsKICAgIGZpbHRlcjogZHJvcC1zaGFkb3coMCA0cHggNHB4IHJnYmEoMCwwLDAsMC44KSk7CiAgICBhbmltYXRpb246IHBvcERhbWFnZSAwLjhzIGN1YmljLWJlemllcigwLjE3NSwgMC44ODUsIDAuMzIsIDEuMjc1KSBmb3J3YXJkczsKfQoKLyogSEVBTCAqLwouZmxvYXRpbmctdGV4dC1pbm5lci5oZWFsIHsKICAgIGZvbnQtc2l6ZTogMzZweDsKICAgIGNvbG9yOiAjNDRmZjQ0OwogICAgdGV4dC1zaGFkb3c6IDAgMCAxMHB4ICMwMGZmMDA7CiAgICBhbmltYXRpb246IGZsb2F0VXAgMXMgZWFzZS1vdXQgZm9yd2FyZHM7Cn0KCi8qIFNUQVRVUzogVkVOT00gKi8KLyogU1RBVFVTOiBWRU5PTSAoQmlvLUdyZWVuLCBTaGFycCkgKi8KLmZsb2F0aW5nLXRleHQtaW5uZXIudmVub20gewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtZGF0YSk7IC8qIENvbnNpc3RlbnQgRkZYIGZvbnQgKi8KICAgIGZvbnQtc2l6ZTogNDJweDsKICAgIGZvbnQtc3R5bGU6IGl0YWxpYzsKICAgIGNvbG9yOiAjYWFmZjAwOwogICAgdGV4dC1zaGFkb3c6IDAgMCAxMHB4ICM0NDg4MDAsIDJweCAycHggMCAjMDAyMjAwOwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KHRvIGJvdHRvbSwgI2NjZmY2NiAwJSwgIzY2Y2MwMCAxMDAlKTsKICAgIC13ZWJraXQtYmFja2dyb3VuZC1jbGlwOiB0ZXh0OwogICAgLXdlYmtpdC10ZXh0LWZpbGwtY29sb3I6IHRyYW5zcGFyZW50OwogICAgZmlsdGVyOiBkcm9wLXNoYWRvdygwIDAgNXB4IHJnYmEoMTAwLCAyNTUsIDAsIDAuNSkpOwogICAgYW5pbWF0aW9uOiBkcmlwU3RhdHVzIDJzIGluZmluaXRlOwp9CgovKiBTVEFUVVM6IFNMRUVQIChIYXp5IEJsdWUsIERyZWFteSkgKi8KLmZsb2F0aW5nLXRleHQtaW5uZXIuc2xlZXAgewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtdGl0bGUpOwogICAgZm9udC1zaXplOiA0MnB4OwogICAgY29sb3I6ICNmZmZmZmY7CiAgICB0ZXh0LXNoYWRvdzogMCAwIDE1cHggIzAwNDRmZiwgMCAwIDMwcHggIzAwMDBmZjsKICAgIG9wYWNpdHk6IDAuOTsKICAgIGFuaW1hdGlvbjogZHJpZnRTdGF0dXMgM3MgZWFzZS1pbi1vdXQgaW5maW5pdGU7Cn0KCi8qIFNUQVRVUzogV0lUSEVSIChEZXNhdHVyYXRlZCwgU3RvbmUtbGlrZSkgKi8KLmZsb2F0aW5nLXRleHQtaW5uZXIud2l0aGVyIHsKICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LWRhdGEpOwogICAgZm9udC1zaXplOiAzOHB4OwogICAgY29sb3I6ICNjY2NjY2M7CiAgICB0ZXh0LXNoYWRvdzogMnB4IDJweCAwICM0NDQ0NDQ7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQodG8gYm90dG9tLCAjZWVlZWVlIDAlLCAjODg4ODg4IDEwMCUpOwogICAgLXdlYmtpdC1iYWNrZ3JvdW5kLWNsaXA6IHRleHQ7CiAgICAtd2Via2l0LXRleHQtZmlsbC1jb2xvcjogdHJhbnNwYXJlbnQ7CiAgICBhbmltYXRpb246IHdpdGhlclN0YXR1cyAxLjVzIGZvcndhcmRzOwp9CgovKiBURUNIIENBTExPVVRTIChTcGhlcmUgU2hvdCwgSmVjaHQgU2hvdCkgKi8KLyogVEVDSCBDQUxMT1VUUyAoU3BoZXJlIFNob3QsIEplY2h0IFNob3QpICovCi5mbG9hdGluZy10ZXh0LWlubmVyLnRlY2ggewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtdGl0bGUpOwogICAgZm9udC1zaXplOiAzMnB4OyAvKiBXYXMgNDhweCAqLwogICAgY29sb3I6ICMwMGZmZmY7CiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDEwLCAzMCwgMC43KTsKICAgIHBhZGRpbmc6IDJweCAxMHB4OwogICAgYm9yZGVyOiAxcHggc29saWQgIzAwZmZmZjsKICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgIGJveC1zaGFkb3c6IDAgMCAxMHB4ICMwMDg4ZmY7CiAgICB0ZXh0LXNoYWRvdzogMCAwIDVweCAjZmZmOwogICAgYW5pbWF0aW9uOiBzaGFrZVRlY2ggMC42cyBlYXNlLWluLW91dCwgZmxhc2hUZWNoIDAuM3M7CiAgICB0cmFuc2Zvcm0tb3JpZ2luOiBjZW50ZXI7Cn0KCi8qIFNBVkUgLyBCTE9DSyAqLwouZmxvYXRpbmctdGV4dC1pbm5lci5zYXZlLCAuZmxvYXRpbmctdGV4dC1pbm5lci5ibG9jayB7CiAgICBmb250LXNpemU6IDQ4cHg7CiAgICBmb250LXdlaWdodDogOTAwOwogICAgY29sb3I6ICNmZmZmZmY7CiAgICAtd2Via2l0LXRleHQtc3Ryb2tlOiAxcHggIzAwNDQ4ODsKICAgIHRleHQtc2hhZG93OiAwIDAgMjBweCAjMDA4OGZmOwogICAgYW5pbWF0aW9uOiBwb3BEYW1hZ2UgMC41cyBlYXNlLW91dCBmb3J3YXJkczsKfQoKLyogLS0tIEFOSU1BVElPTlMgLS0tICovCgpAa2V5ZnJhbWVzIHBvcERhbWFnZSB7CiAgICAwJSB7IHRyYW5zZm9ybTogc2NhbGUoMC41KTsgb3BhY2l0eTogMDsgfQogICAgMjAlIHsgdHJhbnNmb3JtOiBzY2FsZSgxLjUpOyBvcGFjaXR5OiAxOyB9CiAgICA0MCUgeyB0cmFuc2Zvcm06IHNjYWxlKDEuMCk7IG9wYWNpdHk6IDE7IH0KICAgIDEwMCUgeyB0cmFuc2Zvcm06IHNjYWxlKDEuMCk7IG9wYWNpdHk6IDA7IH0KfQoKQGtleWZyYW1lcyBmbG9hdFVwIHsKICAgIDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDApOyBvcGFjaXR5OiAxOyB9CiAgICAxMDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC01MHB4KTsgb3BhY2l0eTogMDsgfQp9CgpAa2V5ZnJhbWVzIGRyaXBTdGF0dXMgewogICAgMCUgeyB0cmFuc2Zvcm06IHNjYWxlWSgxKTsgZmlsdGVyOiBibHVyKDBweCk7IH0KICAgIDUwJSB7IHRyYW5zZm9ybTogc2NhbGVZKDEuMSkgdHJhbnNsYXRlWSg1cHgpOyBmaWx0ZXI6IGJsdXIoMXB4KTsgfQogICAgMTAwJSB7IHRyYW5zZm9ybTogc2NhbGVZKDEpOyBmaWx0ZXI6IGJsdXIoMHB4KTsgfQp9CgpAa2V5ZnJhbWVzIGRyaWZ0U3RhdHVzIHsKICAgIDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKDApIHJvdGF0ZSgwZGVnKTsgb3BhY2l0eTogMDsgfQogICAgMjAlIHsgb3BhY2l0eTogMTsgfQogICAgNTAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKDE1cHgpIHRyYW5zbGF0ZVkoLTIwcHgpIHJvdGF0ZSgxMGRlZyk7IH0KICAgIDEwMCUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTE1cHgpIHRyYW5zbGF0ZVkoLTUwcHgpIHJvdGF0ZSgtMTBkZWcpOyBvcGFjaXR5OiAwOyB9Cn0KCkBrZXlmcmFtZXMgd2l0aGVyU3RhdHVzIHsKICAgIDAlIHsgdHJhbnNmb3JtOiBzY2FsZSgxKTsgZmlsdGVyOiBncmF5c2NhbGUoMCUpOyBvcGFjaXR5OiAxOyB9CiAgICAxMDAlIHsgdHJhbnNmb3JtOiBzY2FsZSgwLjYpOyBmaWx0ZXI6IGdyYXlzY2FsZSgxMDAlKTsgb3BhY2l0eTogMDsgfQp9CgpAa2V5ZnJhbWVzIHNoYWtlVGVjaCB7CiAgICAwJSB7IHRyYW5zZm9ybTogc2NhbGUoMC44KTsgfQogICAgMTAlLCAzMCUsIDUwJSwgNzAlLCA5MCUgeyB0cmFuc2Zvcm06IHNjYWxlKDEuMSkgdHJhbnNsYXRlKC0ycHgsIDJweCk7IH0KICAgIDIwJSwgNDAlLCA2MCUsIDgwJSB7IHRyYW5zZm9ybTogc2NhbGUoMS4xKSB0cmFuc2xhdGUoMnB4LCAtMnB4KTsgfQogICAgMTAwJSB7IHRyYW5zZm9ybTogc2NhbGUoMS4wKTsgfQp9CgpAa2V5ZnJhbWVzIGZsYXNoVGVjaCB7CiAgICAwJSB7IGJhY2tncm91bmQtY29sb3I6ICNmZmY7IGNvbG9yOiAjMDAwOyBib3JkZXItY29sb3I6ICNmZmY7IH0KICAgIDEwMCUgeyBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDAsIDEwLCAzMCwgMC44NSk7IGNvbG9yOiAjMDBmZmZmOyBib3JkZXItY29sb3I6ICMwMGZmZmY7IH0KfQovKiBMb2FkaW5nIE92ZXJsYXkgKi8KI2xvYWRpbmcgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiA1MCU7IGxlZnQ6IDUwJTsKICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpOwogICAgZm9udC1zaXplOiAyNHB4OwogICAgY29sb3I6IHZhcigtLWZmeC1jeWFuKTsKICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICBsZXR0ZXItc3BhY2luZzogNXB4OwogICAgYW5pbWF0aW9uOiBibGluayAxcyBpbmZpbml0ZTsKfQpAa2V5ZnJhbWVzIGJsaW5rIHsgNTAlIHsgb3BhY2l0eTogMC41OyB9IH0KCiNjb250cm9scy1oaW50IHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMTMwcHg7IHdpZHRoOiAxMDAlOwogICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgZm9udC1zaXplOiAxMHB4OwogICAgY29sb3I6IHJnYmEoMjU1LDI1NSwyNTUsMC40KTsKICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKfQoKLyogLS0tIENPTUlDIEJPT0sgRlggLS0tICovCi8qIC0tLSBDT01JQyBCT09LIEZYIChTY2FsZWQgRG93bikgLS0tICovCi5mbG9hdGluZy10ZXh0LWlubmVyLmNvbWljLWltcGFjdCB7CiAgICBmb250LWZhbWlseTogJ0ltcGFjdCcsIHNhbnMtc2VyaWY7CiAgICBmb250LXNpemU6IDQycHg7IC8qIFdhcyA2MHB4ICovCiAgICBjb2xvcjogI2ZmZmYwMDsgCiAgICAtd2Via2l0LXRleHQtc3Ryb2tlOiAxcHggIzAwMDsKICAgIHRleHQtc2hhZG93OiAzcHggM3B4IDAgI2ZmMDAwMDsKICAgIGZvbnQtc3R5bGU6IGl0YWxpYzsKICAgIHRyYW5zZm9ybS1vcmlnaW46IGNlbnRlcjsKICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7CiAgICBhbmltYXRpb246IGNvbWljUG9wIDAuNHMgY3ViaWMtYmV6aWVyKDAuMTc1LCAwLjg4NSwgMC4zMiwgMS4yNzUpIGZvcndhcmRzOwogICAgei1pbmRleDogMjUwMDsKfQoKLmZsb2F0aW5nLXRleHQtaW5uZXIuY29taWMtYWN0aW9uIHsKICAgIGZvbnQtZmFtaWx5OiAnQXJpYWwgQmxhY2snLCBzYW5zLXNlcmlmOwogICAgZm9udC1zaXplOiAyOHB4OyAvKiBXYXMgNDBweCAqLwogICAgY29sb3I6ICMwMGZmZmY7IAogICAgLXdlYmtpdC10ZXh0LXN0cm9rZTogMXB4ICMwMDA7CiAgICB0ZXh0LXNoYWRvdzogMnB4IDJweCAwICMwMDQ0YWE7CiAgICBmb250LXN0eWxlOiBpdGFsaWM7CiAgICB3aGl0ZS1zcGFjZTogbm93cmFwOwogICAgYW5pbWF0aW9uOiBjb21pY1NsaWRlIDAuNHMgZWFzZS1vdXQgZm9yd2FyZHM7CiAgICB6LWluZGV4OiAyNTAwOwp9CgpAa2V5ZnJhbWVzIGNvbWljUG9wIHsKICAgIDAlIHsgdHJhbnNmb3JtOiBzY2FsZSgwKSByb3RhdGUoLTIwZGVnKTsgb3BhY2l0eTogMDsgfQogICAgNDAlIHsgdHJhbnNmb3JtOiBzY2FsZSgxLjIpIHJvdGF0ZSg1ZGVnKTsgb3BhY2l0eTogMTsgfQogICAgNjAlIHsgdHJhbnNmb3JtOiBzY2FsZSgxLjApIHJvdGF0ZSgtNWRlZyk7IG9wYWNpdHk6IDE7IH0KICAgIDEwMCUgeyB0cmFuc2Zvcm06IHNjYWxlKDEuMSkgcm90YXRlKDBkZWcpOyBvcGFjaXR5OiAwOyB9Cn0KCkBrZXlmcmFtZXMgY29taWNTbGlkZSB7CiAgICAwJSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC0yMHB4LCAyMHB4KSBzY2FsZSgwLjUpOyBvcGFjaXR5OiAwOyB9CiAgICAxMDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoMjBweCwgLTIwcHgpIHNjYWxlKDEuMik7IG9wYWNpdHk6IDA7IH0KfQovKiAtLS0gTUFJTiBNRU5VIChGRlggU3R5bGUpIC0tLSAqLwojbWFpbi1tZW51IHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMDsgbGVmdDogMDsgd2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgei1pbmRleDogMzAwMDsKICAgIG9wYWNpdHk6IDA7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgIHRyYW5zaXRpb246IG9wYWNpdHkgMC41cyBlYXNlLWluLW91dDsKICAgIGJhY2tncm91bmQ6IHJhZGlhbC1ncmFkaWVudChjaXJjbGUgYXQgY2VudGVyLCByZ2JhKDAsIDIwLCA2MCwgMC44KSAwJSwgcmdiYSgwLCA1LCAxMCwgMC45NSkgMTAwJSk7CiAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoNXB4KTsKfQoKI21haW4tbWVudS5hY3RpdmUgewogICAgb3BhY2l0eTogMTsKICAgIHBvaW50ZXItZXZlbnRzOiBhdXRvOwp9CgoubWVudS1iZy1vdmVybGF5IHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMDsgbGVmdDogMDsgd2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTsKICAgIGJhY2tncm91bmQ6IAogICAgICAgIGxpbmVhci1ncmFkaWVudChyZ2JhKDAsMCwwLDApIDUwJSwgcmdiYSgwLDAsMCwwLjIpIDUwJSksIAogICAgICAgIGxpbmVhci1ncmFkaWVudCg5MGRlZywgcmdiYSgyNTUsMCwwLDAuMDYpLCByZ2JhKDAsMjU1LDAsMC4wMiksIHJnYmEoMCwwLDI1NSwwLjA2KSk7CiAgICBiYWNrZ3JvdW5kLXNpemU6IDEwMCUgMnB4LCAzcHggMTAwJTsKICAgIHBvaW50ZXItZXZlbnRzOiBub25lOwogICAgei1pbmRleDogLTE7Cn0KCi5mZngtbG9nby1jb250YWluZXIgewogICAgbWFyZ2luLWJvdHRvbTogNjBweDsKICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgIHRyYW5zZm9ybTogc2tld1goLTEwZGVnKTsKfQoKLmZmeC1sb2dvLW1haW4gewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtdGl0bGUpOwogICAgZm9udC1zaXplOiA2NHB4OwogICAgY29sb3I6ICNmZmZmZmY7CiAgICB0ZXh0LXNoYWRvdzogCiAgICAgICAgMCAwIDEwcHggIzAwZmZmZiwKICAgICAgICAwIDAgMjBweCAjMDA4OGZmLAogICAgICAgIDAgMCA0MHB4ICMwMDAwZmY7CiAgICBsZXR0ZXItc3BhY2luZzogNXB4OwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KHRvIGJvdHRvbSwgI2ZmZmZmZiAwJSwgI2FhY2NmZiA1MCUsICMwMDg4ZmYgMTAwJSk7CiAgICAtd2Via2l0LWJhY2tncm91bmQtY2xpcDogdGV4dDsKICAgIC13ZWJraXQtdGV4dC1maWxsLWNvbG9yOiB0cmFuc3BhcmVudDsKICAgIGZpbHRlcjogZHJvcC1zaGFkb3coMCA1cHggNXB4IHJnYmEoMCwwLDAsMC44KSk7Cn0KCi5mZngtbG9nby1zdWIgewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtZGF0YSk7CiAgICBmb250LXNpemU6IDE4cHg7CiAgICBjb2xvcjogdmFyKC0tZmZ4LWdvbGQpOwogICAgbGV0dGVyLXNwYWNpbmc6IDEycHg7CiAgICBtYXJnaW4tdG9wOiAtNXB4OwogICAgdGV4dC1zaGFkb3c6IDAgMCA1cHggI2ZmYWEwMDsKfQoKLm1lbnUtb3B0aW9ucyB7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgIGdhcDogMTVweDsKICAgIHdpZHRoOiAzMDBweDsKfQoKLm1lbnUtaXRlbSB7CiAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICBwYWRkaW5nOiAxNXB4IDMwcHg7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsIHJnYmEoMCwgNDAsIDgwLCAwLjYpIDAlLCByZ2JhKDAsIDEwLCAyMCwgMC4wKSAxMDAlKTsKICAgIGJvcmRlci1sZWZ0OiA0cHggc29saWQgcmdiYSgxMDAsIDIwMCwgMjU1LCAwLjMpOwogICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHJnYmEoMTAwLCAyMDAsIDI1NSwgMC4xKTsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIHRyYW5zaXRpb246IGFsbCAwLjJzOwogICAgdHJhbnNmb3JtOiBza2V3WCgtMTBkZWcpOwogICAgZGlzcGxheTogZmxleDsKICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7Cn0KCi5tZW51LWl0ZW06aG92ZXIgewogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCByZ2JhKDAsIDgwLCAxNjAsIDAuOCkgMCUsIHJnYmEoMCwgMjAsIDQwLCAwLjApIDEwMCUpOwogICAgYm9yZGVyLWxlZnQtY29sb3I6ICMwMGZmZmY7CiAgICBwYWRkaW5nLWxlZnQ6IDQwcHg7CiAgICBib3gtc2hhZG93OiAwIDAgMTVweCByZ2JhKDAsIDI1NSwgMjU1LCAwLjIpOwp9CgoubWVudS1pdGVtIC5sYWJlbCB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC10aXRsZSk7CiAgICBmb250LXNpemU6IDI0cHg7CiAgICBjb2xvcjogI2NjY2NjYzsKICAgIGxldHRlci1zcGFjaW5nOiAycHg7CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgdHJhbnNmb3JtOiBza2V3WCgxMGRlZyk7IC8qIENvdW50ZXIgc2tldyAqLwogICAgdHJhbnNpdGlvbjogY29sb3IgMC4yczsKfQoKLm1lbnUtaXRlbTpob3ZlciAubGFiZWwgewogICAgY29sb3I6ICNmZmZmZmY7CiAgICB0ZXh0LXNoYWRvdzogMCAwIDEwcHggIzAwZmZmZjsKfQoKLm1lbnUtaXRlbSAuY3Vyc29yIHsKICAgIGZvbnQtc2l6ZTogMThweDsKICAgIGNvbG9yOiB2YXIoLS1mZngtZ29sZCk7CiAgICBtYXJnaW4tcmlnaHQ6IDE1cHg7CiAgICBvcGFjaXR5OiAwOwogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKC0xMHB4KSBza2V3WCgxMGRlZyk7CiAgICB0cmFuc2l0aW9uOiBhbGwgMC4yczsKfQoKLm1lbnUtaXRlbTpob3ZlciAuY3Vyc29yIHsKICAgIG9wYWNpdHk6IDE7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoMCkgc2tld1goMTBkZWcpOwp9CgoubWVudS1mb290ZXIgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgYm90dG9tOiAyMHB4OwogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtdWkpOwogICAgZm9udC1zaXplOiAxMHB4OwogICAgY29sb3I6IHJnYmEoMjU1LDI1NSwyNTUsMC4zKTsKICAgIGxldHRlci1zcGFjaW5nOiAycHg7Cn0KLyogLS0tIFBSQUNUSUNFIE9WRVJMQVkgKEZGWCBTdHlsZSkgLS0tICovCiNwcmFjdGljZS1vdmVybGF5IHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMDsgbGVmdDogMDsgd2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTsKICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgNSwgMTAsIDAuNik7IC8qIERpbSBiYWNrZ3JvdW5kICovCiAgICBkaXNwbGF5OiBub25lOyAvKiBUb2dnbGVkIGJ5IEpTICovCiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICB6LWluZGV4OiAyNTAwOwogICAgcG9pbnRlci1ldmVudHM6IG5vbmU7IC8qIExldCBjbGlja3MgcGFzcyB0aHJvdWdoIHRvIGdhbWUgdXN1YWxseSwgYnV0IHBhbmVsIG5lZWRzIGV2ZW50cyAqLwp9CgojcHJhY3RpY2Utb3ZlcmxheS5hY3RpdmUgewogICAgZGlzcGxheTogZmxleDsKfQoKLnByYWN0aWNlLXBhbmVsIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogNjBweDsgcmlnaHQ6IDIwcHg7IC8qIFRvcCBSaWdodCBwb3NpdGlvbmluZyBsaWtlIGEgZGVidWcgbWVudSAqLwogICAgd2lkdGg6IDI4MHB4OwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDE2MGRlZywgcmdiYSgwLCAyMCwgNTAsIDAuOTUpIDAlLCByZ2JhKDAsIDEwLCAyMCwgMC45OCkgMTAwJSk7CiAgICBib3JkZXI6IDFweCBzb2xpZCAjNDQ4OGZmOwogICAgYm9yZGVyLXJhZGl1czogMCAwIDE1cHggMDsKICAgIGJveC1zaGFkb3c6IDAgMCAyMHB4IHJnYmEoMCwgMTAwLCAyNTUsIDAuMiksIGluc2V0IDAgMCA1MHB4IHJnYmEoMCwgMjAsIDYwLCAwLjUpOwogICAgcGFkZGluZzogMTVweDsKICAgIHBvaW50ZXItZXZlbnRzOiBhdXRvOwogICAgdHJhbnNmb3JtOiBza2V3WCgtMmRlZyk7CiAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoNXB4KTsKfQoKLnBhbmVsLWhlYWRlciB7CiAgICBtYXJnaW4tYm90dG9tOiAxNXB4OwogICAgdGV4dC1hbGlnbjogY2VudGVyOwp9CgoucGFuZWwtdGl0bGUtZ3JvdXAgewogICAgZGlzcGxheTogZmxleDsKICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47Cn0KCi5wYW5lbC10aXRsZSB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC10aXRsZSk7CiAgICBmb250LXNpemU6IGNsYW1wKDE4cHgsIDZ2dywgMjRweCk7IC8qIER5bmFtaWMgKi8KICAgIGNvbG9yOiAjZmZmZmZmOwogICAgdGV4dC1zaGFkb3c6IDAgMCAxMHB4ICMwMGZmZmY7CiAgICBsZXR0ZXItc3BhY2luZzogMnB4Owp9CgoucGFuZWwtc3VidGl0bGUgewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtdWkpOwogICAgZm9udC1zaXplOiA4cHg7CiAgICBjb2xvcjogIzQ0ODhmZjsKICAgIGxldHRlci1zcGFjaW5nOiA0cHg7CiAgICBtYXJnaW4tdG9wOiAtMnB4Owp9CgoucGFuZWwtZGVjby1saW5lIHsKICAgIHdpZHRoOiAxMDAlOwogICAgaGVpZ2h0OiAycHg7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsIHRyYW5zcGFyZW50LCAjMDBmZmZmLCB0cmFuc3BhcmVudCk7CiAgICBtYXJnaW4tdG9wOiA1cHg7CiAgICBib3gtc2hhZG93OiAwIDAgNXB4ICMwMGZmZmY7Cn0KCi5wYW5lbC1jb250ZW50IHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgZ2FwOiAxNXB4Owp9Cgouc2VjdGlvbi1sYWJlbCB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC11aSk7CiAgICBmb250LXNpemU6IDEwcHg7CiAgICBjb2xvcjogdmFyKC0tZmZ4LWdvbGQpOwogICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHJnYmEoMjAwLCAxNzYsIDk2LCAwLjMpOwogICAgbWFyZ2luLWJvdHRvbTogNXB4OwogICAgcGFkZGluZy1ib3R0b206IDJweDsKICAgIGxldHRlci1zcGFjaW5nOiAxcHg7Cn0KCi8qIERyaWxsIEJ1dHRvbnMgKi8KLmRyaWxsLWxpc3QgewogICAgZGlzcGxheTogZmxleDsKICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICBnYXA6IDVweDsKfQoKLmRyaWxsLWJ0biB7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgIHBhZGRpbmc6IDhweCAxMnB4OwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMDUpLCB0cmFuc3BhcmVudCk7CiAgICBib3JkZXItbGVmdDogMnB4IHNvbGlkIHRyYW5zcGFyZW50OwogICAgY3Vyc29yOiBwb2ludGVyOwogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtZGF0YSk7CiAgICBmb250LXNpemU6IDE0cHg7CiAgICBjb2xvcjogI2FhYTsKICAgIHRyYW5zaXRpb246IGFsbCAwLjJzOwp9CgouZHJpbGwtYnRuOmhvdmVyIHsKICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCg5MGRlZywgcmdiYSgwLCAyNTUsIDI1NSwgMC4xKSwgdHJhbnNwYXJlbnQpOwogICAgY29sb3I6ICNmZmY7CiAgICBwYWRkaW5nLWxlZnQ6IDE1cHg7Cn0KCi5kcmlsbC1idG4uYWN0aXZlIHsKICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCg5MGRlZywgcmdiYSgwLCAxMDAsIDI1NSwgMC40KSwgdHJhbnNwYXJlbnQpOwogICAgYm9yZGVyLWxlZnQ6IDNweCBzb2xpZCAjMDBmZmZmOwogICAgY29sb3I6ICNmZmY7CiAgICB0ZXh0LXNoYWRvdzogMCAwIDVweCAjMDBmZmZmOwp9CgouZHJpbGwtYnRuIC5pY29uIHsKICAgIHdpZHRoOiAyMHB4OwogICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgbWFyZ2luLXJpZ2h0OiAxMHB4OwogICAgY29sb3I6IHZhcigtLWZmeC1jeWFuKTsKfQoKLyogT3B0aW9ucyAqLwoub3B0aW9uLWxpc3QgewogICAgZGlzcGxheTogZmxleDsKICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICBnYXA6IDVweDsKfQoKLm9wdGlvbi10b2dnbGUgewogICAgZGlzcGxheTogZmxleDsKICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICBwYWRkaW5nOiA1cHggMTBweDsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIGZvbnQtc2l6ZTogMTJweDsKICAgIGNvbG9yOiAjY2NjOwogICAgdHJhbnNpdGlvbjogY29sb3IgMC4yczsKfQoKLm9wdGlvbi10b2dnbGU6aG92ZXIgeyBjb2xvcjogI2ZmZjsgfQoKLm9wdGlvbi10b2dnbGUgLmNoZWNrYm94IHsKICAgIG1hcmdpbi1yaWdodDogMTBweDsKICAgIGNvbG9yOiAjNDQ0OwogICAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTsKICAgIGZvbnQtc2l6ZTogMTRweDsKfQoKLm9wdGlvbi10b2dnbGUuYWN0aXZlIC5jaGVja2JveCB7CiAgICBjb2xvcjogIzAwZmYwMDsKICAgIHRleHQtc2hhZG93OiAwIDAgNXB4ICMwMGZmMDA7Cn0KCi5vcHRpb24tdG9nZ2xlLmFjdGl2ZSB7CiAgICBjb2xvcjogI2ZmZjsKfQoKLyogQWN0aW9uIEJ1dHRvbnMgKi8KLmFjdGlvbi1idG4gewogICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjUpOwogICAgYm9yZGVyOiAxcHggc29saWQgIzQ0NDsKICAgIHBhZGRpbmc6IDZweDsKICAgIGZvbnQtc2l6ZTogMTFweDsKICAgIGNvbG9yOiAjYWFhOwogICAgY3Vyc29yOiBwb2ludGVyOwogICAgdHJhbnNpdGlvbjogYWxsIDAuMnM7CiAgICBtYXJnaW4tYm90dG9tOiA1cHg7CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgbGV0dGVyLXNwYWNpbmc6IDFweDsKfQoKLmFjdGlvbi1idG46aG92ZXIgewogICAgYm9yZGVyLWNvbG9yOiAjZmZmOwogICAgY29sb3I6ICNmZmY7CiAgICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMSk7Cn0KCiNwLWV4aXQ6aG92ZXIgewogICAgYm9yZGVyLWNvbG9yOiAjZmY0NDQ0OwogICAgY29sb3I6ICNmZjQ0NDQ7CiAgICBiYWNrZ3JvdW5kOiByZ2JhKDUwLCAwLCAwLCAwLjMpOwp9CgovKiBGb290ZXIgKi8KLnBhbmVsLWZvb3RlciB7CiAgICBtYXJnaW4tdG9wOiAxNXB4OwogICAgcGFkZGluZy10b3A6IDEwcHg7CiAgICBib3JkZXItdG9wOiAxcHggc29saWQgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjEpOwogICAgdGV4dC1hbGlnbjogY2VudGVyOwp9CgojZHJpbGwtaW5zdHJ1Y3Rpb24gewogICAgZm9udC1zaXplOiAxMHB4OwogICAgY29sb3I6IHZhcigtLWZmeC1jeWFuKTsKICAgIG1hcmdpbi1ib3R0b206IDVweDsKICAgIGZvbnQtc3R5bGU6IGl0YWxpYzsKfQoKI2RyaWxsLXNjb3JlIHsKICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LWRhdGEpOwogICAgZm9udC1zaXplOiAyNHB4OwogICAgY29sb3I6IHZhcigtLWZmeC1nb2xkKTsKdGV4dC1zaGFkb3c6IDAgMCAxMHB4IHJnYmEoMjU1LCAyMTUsIDAsIDAuNSk7Cn0KCi8qIC0tLSBQUkFDVElDRSBNSU5JTUlaRS9SRVNUT1JFIC0tLSAqLwovKiAtLS0gUFJBQ1RJQ0UgTUlOSU1JWkUvUkVTVE9SRSAtLS0gKi8KLnBhbmVsLW1pbmltaXplLWJ0biB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IDEwcHg7IHJpZ2h0OiAxMHB4OwogICAgd2lkdGg6IDIwcHg7IGhlaWdodDogMjBweDsKICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWZmeC1jeWFuKTsKICAgIGNvbG9yOiB2YXIoLS1mZngtY3lhbik7CiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICBsaW5lLWhlaWdodDogMThweDsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIGZvbnQtc2l6ZTogMTRweDsKICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC41KTsKICAgIHRyYW5zaXRpb246IGFsbCAwLjJzOwp9Ci5wYW5lbC1taW5pbWl6ZS1idG46aG92ZXIgeyAKICAgIGJhY2tncm91bmQ6IHZhcigtLWZmeC1jeWFuKTsgCiAgICBjb2xvcjogIzAwMDsgCiAgICBib3gtc2hhZG93OiAwIDAgNXB4IHZhcigtLWZmeC1jeWFuKTsKfQoKI3ByYWN0aWNlLXJlc3RvcmUtYnRuIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogNjBweDsgcmlnaHQ6IDIwcHg7CiAgICBwYWRkaW5nOiA4cHggMTVweDsKICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCg5MGRlZywgcmdiYSgwLCAyMCwgNTAsIDAuOSkgMCUsIHJnYmEoMCwgMTAsIDIwLCAwLjkpIDEwMCUpOwogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tZmZ4LWN5YW4pOwogICAgYm9yZGVyLWxlZnQ6IDNweCBzb2xpZCB2YXIoLS1mZngtY3lhbik7CiAgICBjb2xvcjogdmFyKC0tZmZ4LWN5YW4pOwogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtZGF0YSk7CiAgICBmb250LXNpemU6IDEycHg7CiAgICBsZXR0ZXItc3BhY2luZzogMXB4OwogICAgY3Vyc29yOiBwb2ludGVyOwogICAgei1pbmRleDogMjQwMDsKICAgIGRpc3BsYXk6IG5vbmU7IC8qIEhpZGRlbiBieSBkZWZhdWx0ICovCiAgICBwb2ludGVyLWV2ZW50czogYXV0bzsKICAgIHRyYW5zZm9ybTogc2tld1goLTEwZGVnKTsKICAgIGJveC1zaGFkb3c6IDAgMCAxMHB4IHJnYmEoMCwgMTAwLCAyNTUsIDAuMik7CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwp9CiNwcmFjdGljZS1yZXN0b3JlLWJ0bjpob3ZlciB7CiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDQwLCA4MCwgMC45KTsKICAgIGNvbG9yOiAjZmZmOwogICAgdGV4dC1zaGFkb3c6IDAgMCA1cHggIzAwZmZmZjsKICAgIGJveC1zaGFkb3c6IDAgMCAxNXB4IHJnYmEoMCwgMjU1LCAyNTUsIDAuMyk7Cn0KCi8qID09PSBORVcgVUkgRUxFTUVOVFMgKHYyLjAgVXBncmFkZSkgPT09ICovCgovKiAtLS0gQUlNIEpPWVNUSUNLIChSaWdodCBTaWRlKSAtLS0gKi8KI2FpbS1qb3lzdGljay16b25lIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIGJvdHRvbTogMTUwcHg7CiAgICByaWdodDogMDsKICAgIHdpZHRoOiA0MCU7CiAgICBoZWlnaHQ6IDM1JTsKICAgIHotaW5kZXg6IDEwMDA7CiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDApOwogICAgdG91Y2gtYWN0aW9uOiBub25lOwogICAgcG9pbnRlci1ldmVudHM6IGF1dG87Cn0KCiNhaW0tam95c3RpY2stdmlzdWFsIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMDsgbGVmdDogMDsKICAgIHdpZHRoOiAwOyBoZWlnaHQ6IDA7CiAgICBvdmVyZmxvdzogdmlzaWJsZTsKICAgIHBvaW50ZXItZXZlbnRzOiBub25lOwogICAgZGlzcGxheTogbm9uZTsKICAgIHotaW5kZXg6IDExMDA7Cn0KCiNhaW0tam95c3RpY2stYmFzZSB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IDUwJTsgbGVmdDogNTAlOwogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSk7CiAgICB3aWR0aDogOTBweDsgaGVpZ2h0OiA5MHB4OwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgYmFja2dyb3VuZDogcmFkaWFsLWdyYWRpZW50KGNpcmNsZSwgcmdiYSgyNTUsIDEwMCwgMCwgMC4zKSAwJSwgcmdiYSg4MCwgMjAsIDAsIDAuMSkgNjAlLCB0cmFuc3BhcmVudCAxMDAlKTsKICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMjU1LCAxNTAsIDUwLCAwLjQpOwogICAgYm94LXNoYWRvdzogMCAwIDE1cHggcmdiYSgyNTUsIDEwMCwgMCwgMC4yKSwgaW5zZXQgMCAwIDIwcHggcmdiYSgyNTUsIDUwLCAwLCAwLjIpOwp9CgojYWltLWpveXN0aWNrLWtub2IgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiA1MCU7IGxlZnQ6IDUwJTsKICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpOwogICAgd2lkdGg6IDQwcHg7IGhlaWdodDogNDBweDsKICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgIGJhY2tncm91bmQ6IHJhZGlhbC1ncmFkaWVudChjaXJjbGUgYXQgMzAlIDMwJSwgI2ZmY2M4OCAwJSwgI2ZmNjYwMCA0MCUsICM4ODIyMDAgODAlLCAjMjIwMDAwIDEwMCUpOwogICAgYm9yZGVyOiAycHggc29saWQgI2ZmYWE0NDsKICAgIGJveC1zaGFkb3c6IDAgMCAxMHB4ICNmZjQ0MDAsIGluc2V0IDAgMCA4cHggcmdiYSgyNTUsMjU1LDI1NSwwLjYpOwogICAgdHJhbnNpdGlvbjogdHJhbnNmb3JtIDAuMDVzIGxpbmVhcjsKfQoKI2FpbS1qb3lzdGljay1rbm9iOjphZnRlciB7CiAgICBjb250ZW50OiAiQUlNIjsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogNTAlOyBsZWZ0OiA1MCU7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKTsKICAgIGZvbnQtc2l6ZTogOHB4OwogICAgY29sb3I6IHdoaXRlOwogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtZGF0YSk7CiAgICB0ZXh0LXNoYWRvdzogMCAwIDNweCAjMDAwOwp9CgovKiAtLS0gVEFDS0xFIEJVVFRPTiAtLS0gKi8KI3RhY2tsZS1idXR0b24gewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgYm90dG9tOiAxNjBweDsKICAgIHJpZ2h0OiA0MHB4OwogICAgd2lkdGg6IDcwcHg7CiAgICBoZWlnaHQ6IDcwcHg7CiAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICBkaXNwbGF5OiBub25lOwogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgcG9pbnRlci1ldmVudHM6IGF1dG87CiAgICB6LWluZGV4OiAxMDA7CiAgICBiYWNrZ3JvdW5kOiByYWRpYWwtZ3JhZGllbnQoY2lyY2xlIGF0IDM1JSAzNSUsICNmZjg4ODggMCUsICNjYzAwMDAgNDAlLCAjNjYwMDAwIDgwJSwgIzIyMDAwMCAxMDAlKTsKICAgIGJvcmRlcjogM3B4IHNvbGlkICNmZjQ0NDQ7CiAgICBib3gtc2hhZG93OiAwIDAgMTVweCByZ2JhKDI1NSwgNTAsIDUwLCAwLjYpLCBpbnNldCAwIDAgMTVweCByZ2JhKDI1NSwgMjAwLCAyMDAsIDAuMyk7CiAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gMC4xcywgZmlsdGVyIDAuMnM7Cn0KCiN0YWNrbGUtYnV0dG9uOmFjdGl2ZSB7CiAgICB0cmFuc2Zvcm06IHNjYWxlKDAuOSk7CiAgICBmaWx0ZXI6IGJyaWdodG5lc3MoMS4yKTsKfQoKI3RhY2tsZS1idXR0b24uYWN0aXZlIHsKICAgIGJhY2tncm91bmQ6IHJhZGlhbC1ncmFkaWVudChjaXJjbGUgYXQgMzUlIDM1JSwgI2ZmZmZmZiAwJSwgI2ZmNDQ0NCA0MCUsICNhYTAwMDAgODAlLCAjNDQwMDAwIDEwMCUpOwogICAgYm94LXNoYWRvdzogMCAwIDI1cHggcmdiYSgyNTUsIDEwMCwgMTAwLCAwLjkpOwp9CgojdGFja2xlLWJ1dHRvbiAuYnRuLXRleHQgewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtZGF0YSk7CiAgICBmb250LXNpemU6IDEycHg7CiAgICBmb250LXdlaWdodDogYm9sZDsKICAgIGNvbG9yOiB3aGl0ZTsKICAgIHRleHQtc2hhZG93OiAwIDFweCAycHggcmdiYSgwLDAsMCwwLjgpOwogICAgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgbGV0dGVyLXNwYWNpbmc6IDFweDsKfQoKI3RhY2tsZS1idXR0b24gLmJ0bi1nbGFyZSB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IC01MCU7IGxlZnQ6IC01MCU7CiAgICB3aWR0aDogMjAwJTsgaGVpZ2h0OiAyMDAlOwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDQ1ZGVnLCB0cmFuc3BhcmVudCA0MCUsIHJnYmEoMjU1LDI1NSwyNTUsMC4zKSA1MCUsIHRyYW5zcGFyZW50IDYwJSk7CiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgIGFuaW1hdGlvbjogZ2xhcmVQYXNzIDRzIGluZmluaXRlOwp9CgovKiAtLS0gQ0hBUkdFIFBPV0VSIE1FVEVSIC0tLSAqLwojdGFja2xlLWJ1dHRvbi51cmdlbnQgewogICAgYW5pbWF0aW9uOiB1cmdlbnRQdWxzZSAwLjVzIGluZmluaXRlIGFsdGVybmF0ZTsKICAgIGJhY2tncm91bmQ6IHJhZGlhbC1ncmFkaWVudChjaXJjbGUgYXQgMzUlIDM1JSwgI2ZmNTU1NSAwJSwgI2ZmMDAwMCA0MCUsICM4ODAwMDAgMTAwJSk7CiAgICBib3JkZXItY29sb3I6ICNmZmFhYWE7CiAgICBib3gtc2hhZG93OiAwIDAgMjBweCAjZmYwMDAwOwp9CgpAa2V5ZnJhbWVzIHVyZ2VudFB1bHNlIHsKICAgIGZyb20geyB0cmFuc2Zvcm06IHNjYWxlKDEuMCk7IH0KICAgIHRvIHsgdHJhbnNmb3JtOiBzY2FsZSgxLjE1KTsgfQp9CgovKiAtLS0gQ0hBUkdFIFBPV0VSIE1FVEVSIC0tLSAqLwojY2hhcmdlLW1ldGVyLWNvbnRhaW5lciB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICBib3R0b206IDI1MHB4OwogICAgbGVmdDogNTAlOwogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKC01MCUpOwogICAgd2lkdGg6IDIwMHB4OwogICAgZGlzcGxheTogbm9uZTsKICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgICB6LWluZGV4OiAyMDAwOwogICAgYmFja2dyb3VuZDogcmdiYSgwLCAxMCwgMzAsIDAuOCk7CiAgICBwYWRkaW5nOiAxMHB4IDE1cHg7CiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1mZngtY3lhbik7CiAgICBib3JkZXItcmFkaXVzOiA1cHg7CiAgICBib3gtc2hhZG93OiAwIDAgMTVweCByZ2JhKDAsIDEwMCwgMjU1LCAwLjMpOwp9CgouY2hhcmdlLWxhYmVsIHsKICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LWRhdGEpOwogICAgZm9udC1zaXplOiAxMnB4OwogICAgY29sb3I6IHZhcigtLWZmeC1jeWFuKTsKICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICBsZXR0ZXItc3BhY2luZzogMnB4OwogICAgbWFyZ2luLWJvdHRvbTogNXB4Owp9CgouY2hhcmdlLW1ldGVyLXRyYWNrIHsKICAgIHdpZHRoOiAxMDAlOwogICAgaGVpZ2h0OiAxMnB4OwogICAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjYpOwogICAgYm9yZGVyOiAxcHggc29saWQgIzQ0NDsKICAgIGJvcmRlci1yYWRpdXM6IDZweDsKICAgIG92ZXJmbG93OiBoaWRkZW47Cn0KCiNjaGFyZ2UtbWV0ZXItZmlsbCB7CiAgICBoZWlnaHQ6IDEwMCU7CiAgICB3aWR0aDogMCU7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsICMwYWYsICMwZjApOwogICAgYm94LXNoYWRvdzogMCAwIDEwcHggIzBmMDsKICAgIHRyYW5zaXRpb246IHdpZHRoIDAuMDVzIGxpbmVhciwgYmFja2dyb3VuZCAwLjFzOwogICAgYm9yZGVyLXJhZGl1czogNXB4Owp9CgouY2hhcmdlLWhpbnQgewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtdWkpOwogICAgZm9udC1zaXplOiAxMHB4OwogICAgY29sb3I6IHZhcigtLWZmeC1nb2xkKTsKICAgIG1hcmdpbi10b3A6IDVweDsKICAgIG9wYWNpdHk6IDAuODsKICAgIGFuaW1hdGlvbjogYmxpbmsgMC41cyBpbmZpbml0ZTsKfQoKLyogLS0tIEdPQUwgRElTVEFOQ0UgSU5ESUNBVE9SIC0tLSAqLwojZ29hbC1kaXN0YW5jZS1jb250YWluZXIgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiA3NXB4OwogICAgbGVmdDogMjBweDsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgIHBvaW50ZXItZXZlbnRzOiBub25lOwogICAgei1pbmRleDogMTAwOwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCByZ2JhKDAsIDEwLCAzMCwgMC43KSAwJSwgdHJhbnNwYXJlbnQgMTAwJSk7CiAgICBwYWRkaW5nOiA1cHggMTVweCA1cHggMTBweDsKICAgIGJvcmRlci1sZWZ0OiAycHggc29saWQgdmFyKC0tZmZ4LWdvbGQpOwp9CgouZGlzdGFuY2UtbGFiZWwgewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtdWkpOwogICAgZm9udC1zaXplOiA4cHg7CiAgICBjb2xvcjogdmFyKC0tZmZ4LWdvbGQpOwogICAgbGV0dGVyLXNwYWNpbmc6IDJweDsKICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7Cn0KCiNnb2FsLWRpc3RhbmNlIHsKICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LWRhdGEpOwogICAgZm9udC1zaXplOiAyNHB4OwogICAgY29sb3I6IHdoaXRlOwogICAgdGV4dC1zaGFkb3c6IDAgMCA1cHggdmFyKC0tZmZ4LWdvbGQpOwp9CgovKiAtLS0gU0VUVElOR1MgQlVUVE9OIC0tLSAqLwojc2V0dGluZ3MtYnV0dG9uIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMjQwcHg7CiAgICByaWdodDogMjBweDsKICAgIHdpZHRoOiAxMTBweDsKICAgIHBhZGRpbmc6IDhweCAwOwogICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgZm9udC1zaXplOiAxMHB4OwogICAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgICBjb2xvcjogIzg4ODsKICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsIHJnYmEoMjAsIDIwLCAyMCwgMC44KSAwJSwgcmdiYSgxMCwgMTAsIDEwLCAwLjkpIDEwMCUpOwogICAgYm9yZGVyOiAxcHggc29saWQgIzQ0NDsKICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICBsZXR0ZXItc3BhY2luZzogMXB4OwogICAgcG9pbnRlci1ldmVudHM6IGF1dG87CiAgICB0cmFuc2l0aW9uOiBhbGwgMC4yczsKICAgIHotaW5kZXg6IDEwMDsKfQoKI3NldHRpbmdzLWJ1dHRvbjpob3ZlciB7CiAgICBiYWNrZ3JvdW5kOiByZ2JhKDQwLCA0MCwgNDAsIDAuOSk7CiAgICBib3JkZXItY29sb3I6ICM4ODg7CiAgICBjb2xvcjogI2ZmZjsKfQoKLyogLS0tIFNFVFRJTkdTIFBBTkVMIC0tLSAqLwojc2V0dGluZ3MtcGFuZWwgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiA1MCU7CiAgICBsZWZ0OiA1MCU7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKTsKICAgIHdpZHRoOiAyODBweDsKICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxNjBkZWcsIHJnYmEoMCwgMjAsIDUwLCAwLjk4KSAwJSwgcmdiYSgwLCAxMCwgMjAsIDAuOTkpIDEwMCUpOwogICAgYm9yZGVyOiAycHggc29saWQgdmFyKC0tZmZ4LWN5YW4pOwogICAgYm9yZGVyLXJhZGl1czogMTBweDsKICAgIGJveC1zaGFkb3c6IDAgMCAzMHB4IHJnYmEoMCwgMTAwLCAyNTUsIDAuNCk7CiAgICB6LWluZGV4OiAzNTAwOwogICAgcG9pbnRlci1ldmVudHM6IGF1dG87CiAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoMTBweCk7Cn0KCi5zZXR0aW5ncy1oZWFkZXIgewogICAgZGlzcGxheTogZmxleDsKICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICBwYWRkaW5nOiAxNXB4OwogICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHJnYmEoMTAwLCAyMDAsIDI1NSwgMC4zKTsKICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgMzAsIDYwLCAwLjUpOwp9Cgouc2V0dGluZ3MtaGVhZGVyIHNwYW4gewogICAgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtdGl0bGUpOwogICAgZm9udC1zaXplOiAyMHB4OwogICAgY29sb3I6IHdoaXRlOwogICAgdGV4dC1zaGFkb3c6IDAgMCA1cHggdmFyKC0tZmZ4LWN5YW4pOwogICAgbGV0dGVyLXNwYWNpbmc6IDNweDsKfQoKI3NldHRpbmdzLWNsb3NlIHsKICAgIHdpZHRoOiAzMHB4OwogICAgaGVpZ2h0OiAzMHB4OwogICAgYm9yZGVyOiAxcHggc29saWQgI2ZmNDQ0NDsKICAgIGJhY2tncm91bmQ6IHJnYmEoNTAsIDAsIDAsIDAuNSk7CiAgICBjb2xvcjogI2ZmNDQ0NDsKICAgIGZvbnQtc2l6ZTogMTRweDsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIGJvcmRlci1yYWRpdXM6IDVweDsKICAgIHRyYW5zaXRpb246IGFsbCAwLjJzOwp9Cgojc2V0dGluZ3MtY2xvc2U6aG92ZXIgewogICAgYmFja2dyb3VuZDogI2ZmNDQ0NDsKICAgIGNvbG9yOiB3aGl0ZTsKfQoKLnNldHRpbmdzLWNvbnRlbnQgewogICAgcGFkZGluZzogMjBweDsKfQoKLnNldHRpbmctcm93IHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgbWFyZ2luLWJvdHRvbTogMTVweDsKICAgIHBhZGRpbmc6IDEwcHg7CiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDAsIDAsIDAuMyk7CiAgICBib3JkZXItcmFkaXVzOiA1cHg7Cn0KCi5zZXR0aW5nLXJvdyBsYWJlbCB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC1kYXRhKTsKICAgIGZvbnQtc2l6ZTogMTRweDsKICAgIGNvbG9yOiAjY2NjOwp9Cgouc2V0dGluZy1yb3cgaW5wdXRbdHlwZT0icmFuZ2UiXSB7CiAgICB3aWR0aDogMTAwcHg7CiAgICBhY2NlbnQtY29sb3I6IHZhcigtLWZmeC1jeWFuKTsKfQoKLnNldHRpbmctcm93IGlucHV0W3R5cGU9ImNoZWNrYm94Il0gewogICAgd2lkdGg6IDIwcHg7CiAgICBoZWlnaHQ6IDIwcHg7CiAgICBhY2NlbnQtY29sb3I6IHZhcigtLWZmeC1jeWFuKTsKICAgIGN1cnNvcjogcG9pbnRlcjsKfQoKLyogLS0tIEdMQVJFIEFOSU1BVElPTiAtLS0gKi8KQGtleWZyYW1lcyBnbGFyZVBhc3MgewogICAgMCUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTEwMCUpIHJvdGF0ZSg0NWRlZyk7IH0KICAgIDMwJSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlWCgxMDAlKSByb3RhdGUoNDVkZWcpOyB9CiAgICAxMDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKDEwMCUpIHJvdGF0ZSg0NWRlZyk7IH0KfQoKLyogLS0tIFNUQVRVUyBUWVBFIEZMT0FUSU5HIFRFWFQgLS0tICovCi5mbG9hdGluZy10ZXh0LWlubmVyLnN0YXR1cyB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC1kYXRhKTsKICAgIGZvbnQtc2l6ZTogMjhweDsKICAgIGZvbnQtc3R5bGU6IGl0YWxpYzsKICAgIGNvbG9yOiAjZmYwMGZmOwogICAgdGV4dC1zaGFkb3c6IDAgMCAxMHB4ICNmZjAwZmYsIDJweCAycHggMCAjMDAwOwogICAgYW5pbWF0aW9uOiBzdGF0dXNQb3AgMS4ycyBlYXNlLW91dCBmb3J3YXJkczsKfQoKQGtleWZyYW1lcyBzdGF0dXNQb3AgewogICAgMCUgeyB0cmFuc2Zvcm06IHNjYWxlKDAuNSkgdHJhbnNsYXRlWSgwKTsgb3BhY2l0eTogMDsgfQogICAgMjAlIHsgdHJhbnNmb3JtOiBzY2FsZSgxLjMpIHRyYW5zbGF0ZVkoLTEwcHgpOyBvcGFjaXR5OiAxOyB9CiAgICAxMDAlIHsgdHJhbnNmb3JtOiBzY2FsZSgxLjApIHRyYW5zbGF0ZVkoLTQwcHgpOyBvcGFjaXR5OiAwOyB9Cn0KCi8qIC0tLSBHT0FMIFRZUEUgRkxPQVRJTkcgVEVYVCAtLS0gKi8KLmZsb2F0aW5nLXRleHQtaW5uZXIuZ29hbCB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC1kYXRhKTsKICAgIGZvbnQtc2l6ZTogNDhweDsKICAgIGZvbnQtd2VpZ2h0OiA5MDA7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQodG8gYm90dG9tLCAjZmZmIDAlLCAjZmZkNzAwIDUwJSwgI2ZmODgwMCAxMDAlKTsKICAgIC13ZWJraXQtYmFja2dyb3VuZC1jbGlwOiB0ZXh0OwogICAgLXdlYmtpdC10ZXh0LWZpbGwtY29sb3I6IHRyYW5zcGFyZW50OwogICAgZmlsdGVyOiBkcm9wLXNoYWRvdygwIDRweCA0cHggcmdiYSgwLDAsMCwwLjkpKTsKICAgIGFuaW1hdGlvbjogZ29hbFBvcCAxcyBjdWJpYy1iZXppZXIoMC4xNzUsIDAuODg1LCAwLjMyLCAxLjI3NSkgZm9yd2FyZHM7Cn0KCkBrZXlmcmFtZXMgZ29hbFBvcCB7CiAgICAwJSB7IHRyYW5zZm9ybTogc2NhbGUoMCkgcm90YXRlKC0xMGRlZyk7IG9wYWNpdHk6IDA7IH0KICAgIDUwJSB7IHRyYW5zZm9ybTogc2NhbGUoMS41KSByb3RhdGUoNWRlZyk7IG9wYWNpdHk6IDE7IH0KICAgIDEwMCUgeyB0cmFuc2Zvcm06IHNjYWxlKDEuMikgcm90YXRlKDBkZWcpOyBvcGFjaXR5OiAwOyB9Cn0KCi8qIC0tLSBERUZBVUxUIFRZUEUgRkxPQVRJTkcgVEVYVCAtLS0gKi8KLmZsb2F0aW5nLXRleHQtaW5uZXIuZGVmYXVsdCB7CiAgICBmb250LWZhbWlseTogdmFyKC0tZm9udC1kYXRhKTsKICAgIGZvbnQtc2l6ZTogMjRweDsKICAgIGNvbG9yOiB3aGl0ZTsKICAgIHRleHQtc2hhZG93OiAwIDJweCA0cHggcmdiYSgwLDAsMCwwLjgpOwphbmltYXRpb246IGZsb2F0VXAgMC44cyBlYXNlLW91dCBmb3J3YXJkczsKfQoKLyogLS0tIFZFUlNVUyBDTEFTSCBURVhUIC0tLSAqLwovKiAtLS0gVkVSU1VTIENMQVNIIFRFWFQgUkVNT1ZFRCAtLS0gKi8=","AssetLoader.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICBjb25zdCBfbG9hZGVyID0gbmV3IFRIUkVFLkdMVEZMb2FkZXIoKTsKCiAgICAvLyBIZWxwZXIgdG8gY29udmVydCBhIHNpbmdsZSBtYXRlcmlhbCB0byBCYXNpYyAoVW5saXQvUFNYKQovLyBIZWxwZXIgdG8gY29udmVydCBhIHNpbmdsZSBtYXRlcmlhbCB0byBCYXNpYyAoVW5saXQvUFNYKQpmdW5jdGlvbiBjb252ZXJ0TWF0ZXJpYWwob2xkTWF0LCBpc1NraW5uZWQpIHsKICAgICAgICBpZiAoIW9sZE1hdCkgcmV0dXJuIG51bGw7CiAgICAgICAgCiAgICAgICAgLy8gUHJlc2VydmUgdGV4dHVyZTogQ2hlY2sgbWFwLCB0aGVuIGVtaXNzaXZlTWFwCiAgICAgICAgY29uc3QgdGV4dHVyZSA9IG9sZE1hdC5tYXAgfHwgb2xkTWF0LmVtaXNzaXZlTWFwIHx8IG51bGw7CgogICAgICAgIC8vIEZPUkNFIE9QQVFVRSBWSVNJQklMSVRZCiAgICAgICAgLy8gV2Ugb3ZlcnJpZGUgdHJhbnNwYXJlbmN5IHRvIGVuc3VyZSBtb2RlbHMgYXJlIGFsd2F5cyB2aXNpYmxlIChmaXhpbmcgdGhlICJpbnZpc2libGUgbW9kZWwiIGlzc3VlKS4KICAgICAgICBjb25zdCBwYXJhbXMgPSB7CiAgICAgICAgICAgIG1hcDogdGV4dHVyZSwKICAgICAgICAgICAgY29sb3I6IDB4ZmZmZmZmLCAgICAgICAgLy8gRk9SQ0UgV0hJVEU6IFJlbW92ZSBhbnkgdGludCBmcm9tIEdMVEYKICAgICAgICAgICAgc2tpbm5pbmc6IGlzU2tpbm5lZCwKICAgICAgICAgICAgc2lkZTogVEhSRUUuRG91YmxlU2lkZSwgLy8gUmVuZGVyIGJvdGggc2lkZXMgdG8gcHJldmVudCBiYWNrZmFjZSBjdWxsaW5nIGludmlzaWJpbGl0eQogICAgICAgICAgICB0cmFuc3BhcmVudDogZmFsc2UsICAgICAvLyBEaXNhYmxlIHRyYW5zcGFyZW5jeSB0byBwcmV2ZW50IHNvcnRpbmcgaXNzdWVzCiAgICAgICAgICAgIG9wYWNpdHk6IDEuMCwgICAgICAgICAgIC8vIEZvcmNlIGZ1bGwgb3BhY2l0eQogICAgICAgICAgICBhbHBoYVRlc3Q6IDAuNSwgICAgICAgICAvLyBTdHJvbmcgYWxwaGEgdGVzdCBmb3IgY3V0b3V0cyAobmV0cy9ncmF0ZXMpCiAgICAgICAgICAgIHZlcnRleENvbG9yczogb2xkTWF0LnZlcnRleENvbG9ycywgLy8gUHJlc2VydmUgdmVydGV4IGNvbG9ycwogICAgICAgICAgICBkZXB0aFRlc3Q6IHRydWUsCiAgICAgICAgICAgIGRlcHRoV3JpdGU6IHRydWUsICAgICAgIC8vIEZvcmNlIGRlcHRoIHdyaXRlIHNvIGl0IG9jY2x1ZGVzIHByb3Blcmx5CiAgICAgICAgICAgIGZvZzogdHJ1ZQogICAgICAgIH07CgogICAgICAgIC8vIEVuc3VyZSB0ZXh0dXJlIGVuY29kaW5nIGlzIGNvcnJlY3QgZm9yIFRocmVlLmpzCiAgICAgICAgaWYgKHBhcmFtcy5tYXApIHBhcmFtcy5tYXAuZW5jb2RpbmcgPSBUSFJFRS5zUkdCRW5jb2Rpbmc7CgogICAgICAgIHJldHVybiBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwocGFyYW1zKTsKICAgIH0KCiAgICB3aW5kb3cuZmx1eC5Bc3NldExvYWRlciA9IHsKICAgICAgICBsb2FkTW9kZWw6IGZ1bmN0aW9uKHVybCwgb25Mb2FkLCBvblByb2dyZXNzLCBvbkVycm9yKSB7CiAgICAgICAgICAgIF9sb2FkZXIubG9hZCh1cmwsIGZ1bmN0aW9uKGdsdGYpIHsKICAgICAgICAgICAgICAgIGdsdGYuc2NlbmUudHJhdmVyc2UoZnVuY3Rpb24obm9kZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChub2RlLmlzTWVzaCkgewpub2RlLmNhc3RTaGFkb3cgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5yZWNlaXZlU2hhZG93ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuZnJ1c3R1bUN1bGxlZCA9IGZhbHNlOyAvLyBQcmV2ZW50IGludmlzaWJpbGl0eQogICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5tYXRlcmlhbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkobm9kZS5tYXRlcmlhbCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlLm1hdGVyaWFsID0gbm9kZS5tYXRlcmlhbC5tYXAobSA9PiBjb252ZXJ0TWF0ZXJpYWwobSwgbm9kZS5pc1NraW5uZWRNZXNoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUubWF0ZXJpYWwgPSBjb252ZXJ0TWF0ZXJpYWwobm9kZS5tYXRlcmlhbCwgbm9kZS5pc1NraW5uZWRNZXNoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgaWYgKG9uTG9hZCkgb25Mb2FkKGdsdGYpOwogICAgICAgICAgICB9LCBvblByb2dyZXNzLCBvbkVycm9yKTsKICAgICAgICB9CiAgICB9Owp9KSgpOw==","./AssetLoader.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICBjb25zdCBfbG9hZGVyID0gbmV3IFRIUkVFLkdMVEZMb2FkZXIoKTsKCiAgICAvLyBIZWxwZXIgdG8gY29udmVydCBhIHNpbmdsZSBtYXRlcmlhbCB0byBCYXNpYyAoVW5saXQvUFNYKQovLyBIZWxwZXIgdG8gY29udmVydCBhIHNpbmdsZSBtYXRlcmlhbCB0byBCYXNpYyAoVW5saXQvUFNYKQpmdW5jdGlvbiBjb252ZXJ0TWF0ZXJpYWwob2xkTWF0LCBpc1NraW5uZWQpIHsKICAgICAgICBpZiAoIW9sZE1hdCkgcmV0dXJuIG51bGw7CiAgICAgICAgCiAgICAgICAgLy8gUHJlc2VydmUgdGV4dHVyZTogQ2hlY2sgbWFwLCB0aGVuIGVtaXNzaXZlTWFwCiAgICAgICAgY29uc3QgdGV4dHVyZSA9IG9sZE1hdC5tYXAgfHwgb2xkTWF0LmVtaXNzaXZlTWFwIHx8IG51bGw7CgogICAgICAgIC8vIEZPUkNFIE9QQVFVRSBWSVNJQklMSVRZCiAgICAgICAgLy8gV2Ugb3ZlcnJpZGUgdHJhbnNwYXJlbmN5IHRvIGVuc3VyZSBtb2RlbHMgYXJlIGFsd2F5cyB2aXNpYmxlIChmaXhpbmcgdGhlICJpbnZpc2libGUgbW9kZWwiIGlzc3VlKS4KICAgICAgICBjb25zdCBwYXJhbXMgPSB7CiAgICAgICAgICAgIG1hcDogdGV4dHVyZSwKICAgICAgICAgICAgY29sb3I6IDB4ZmZmZmZmLCAgICAgICAgLy8gRk9SQ0UgV0hJVEU6IFJlbW92ZSBhbnkgdGludCBmcm9tIEdMVEYKICAgICAgICAgICAgc2tpbm5pbmc6IGlzU2tpbm5lZCwKICAgICAgICAgICAgc2lkZTogVEhSRUUuRG91YmxlU2lkZSwgLy8gUmVuZGVyIGJvdGggc2lkZXMgdG8gcHJldmVudCBiYWNrZmFjZSBjdWxsaW5nIGludmlzaWJpbGl0eQogICAgICAgICAgICB0cmFuc3BhcmVudDogZmFsc2UsICAgICAvLyBEaXNhYmxlIHRyYW5zcGFyZW5jeSB0byBwcmV2ZW50IHNvcnRpbmcgaXNzdWVzCiAgICAgICAgICAgIG9wYWNpdHk6IDEuMCwgICAgICAgICAgIC8vIEZvcmNlIGZ1bGwgb3BhY2l0eQogICAgICAgICAgICBhbHBoYVRlc3Q6IDAuNSwgICAgICAgICAvLyBTdHJvbmcgYWxwaGEgdGVzdCBmb3IgY3V0b3V0cyAobmV0cy9ncmF0ZXMpCiAgICAgICAgICAgIHZlcnRleENvbG9yczogb2xkTWF0LnZlcnRleENvbG9ycywgLy8gUHJlc2VydmUgdmVydGV4IGNvbG9ycwogICAgICAgICAgICBkZXB0aFRlc3Q6IHRydWUsCiAgICAgICAgICAgIGRlcHRoV3JpdGU6IHRydWUsICAgICAgIC8vIEZvcmNlIGRlcHRoIHdyaXRlIHNvIGl0IG9jY2x1ZGVzIHByb3Blcmx5CiAgICAgICAgICAgIGZvZzogdHJ1ZQogICAgICAgIH07CgogICAgICAgIC8vIEVuc3VyZSB0ZXh0dXJlIGVuY29kaW5nIGlzIGNvcnJlY3QgZm9yIFRocmVlLmpzCiAgICAgICAgaWYgKHBhcmFtcy5tYXApIHBhcmFtcy5tYXAuZW5jb2RpbmcgPSBUSFJFRS5zUkdCRW5jb2Rpbmc7CgogICAgICAgIHJldHVybiBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwocGFyYW1zKTsKICAgIH0KCiAgICB3aW5kb3cuZmx1eC5Bc3NldExvYWRlciA9IHsKICAgICAgICBsb2FkTW9kZWw6IGZ1bmN0aW9uKHVybCwgb25Mb2FkLCBvblByb2dyZXNzLCBvbkVycm9yKSB7CiAgICAgICAgICAgIF9sb2FkZXIubG9hZCh1cmwsIGZ1bmN0aW9uKGdsdGYpIHsKICAgICAgICAgICAgICAgIGdsdGYuc2NlbmUudHJhdmVyc2UoZnVuY3Rpb24obm9kZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChub2RlLmlzTWVzaCkgewpub2RlLmNhc3RTaGFkb3cgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5yZWNlaXZlU2hhZG93ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuZnJ1c3R1bUN1bGxlZCA9IGZhbHNlOyAvLyBQcmV2ZW50IGludmlzaWJpbGl0eQogICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5tYXRlcmlhbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkobm9kZS5tYXRlcmlhbCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlLm1hdGVyaWFsID0gbm9kZS5tYXRlcmlhbC5tYXAobSA9PiBjb252ZXJ0TWF0ZXJpYWwobSwgbm9kZS5pc1NraW5uZWRNZXNoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUubWF0ZXJpYWwgPSBjb252ZXJ0TWF0ZXJpYWwobm9kZS5tYXRlcmlhbCwgbm9kZS5pc1NraW5uZWRNZXNoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgaWYgKG9uTG9hZCkgb25Mb2FkKGdsdGYpOwogICAgICAgICAgICB9LCBvblByb2dyZXNzLCBvbkVycm9yKTsKICAgICAgICB9CiAgICB9Owp9KSgpOw==","/AssetLoader.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICBjb25zdCBfbG9hZGVyID0gbmV3IFRIUkVFLkdMVEZMb2FkZXIoKTsKCiAgICAvLyBIZWxwZXIgdG8gY29udmVydCBhIHNpbmdsZSBtYXRlcmlhbCB0byBCYXNpYyAoVW5saXQvUFNYKQovLyBIZWxwZXIgdG8gY29udmVydCBhIHNpbmdsZSBtYXRlcmlhbCB0byBCYXNpYyAoVW5saXQvUFNYKQpmdW5jdGlvbiBjb252ZXJ0TWF0ZXJpYWwob2xkTWF0LCBpc1NraW5uZWQpIHsKICAgICAgICBpZiAoIW9sZE1hdCkgcmV0dXJuIG51bGw7CiAgICAgICAgCiAgICAgICAgLy8gUHJlc2VydmUgdGV4dHVyZTogQ2hlY2sgbWFwLCB0aGVuIGVtaXNzaXZlTWFwCiAgICAgICAgY29uc3QgdGV4dHVyZSA9IG9sZE1hdC5tYXAgfHwgb2xkTWF0LmVtaXNzaXZlTWFwIHx8IG51bGw7CgogICAgICAgIC8vIEZPUkNFIE9QQVFVRSBWSVNJQklMSVRZCiAgICAgICAgLy8gV2Ugb3ZlcnJpZGUgdHJhbnNwYXJlbmN5IHRvIGVuc3VyZSBtb2RlbHMgYXJlIGFsd2F5cyB2aXNpYmxlIChmaXhpbmcgdGhlICJpbnZpc2libGUgbW9kZWwiIGlzc3VlKS4KICAgICAgICBjb25zdCBwYXJhbXMgPSB7CiAgICAgICAgICAgIG1hcDogdGV4dHVyZSwKICAgICAgICAgICAgY29sb3I6IDB4ZmZmZmZmLCAgICAgICAgLy8gRk9SQ0UgV0hJVEU6IFJlbW92ZSBhbnkgdGludCBmcm9tIEdMVEYKICAgICAgICAgICAgc2tpbm5pbmc6IGlzU2tpbm5lZCwKICAgICAgICAgICAgc2lkZTogVEhSRUUuRG91YmxlU2lkZSwgLy8gUmVuZGVyIGJvdGggc2lkZXMgdG8gcHJldmVudCBiYWNrZmFjZSBjdWxsaW5nIGludmlzaWJpbGl0eQogICAgICAgICAgICB0cmFuc3BhcmVudDogZmFsc2UsICAgICAvLyBEaXNhYmxlIHRyYW5zcGFyZW5jeSB0byBwcmV2ZW50IHNvcnRpbmcgaXNzdWVzCiAgICAgICAgICAgIG9wYWNpdHk6IDEuMCwgICAgICAgICAgIC8vIEZvcmNlIGZ1bGwgb3BhY2l0eQogICAgICAgICAgICBhbHBoYVRlc3Q6IDAuNSwgICAgICAgICAvLyBTdHJvbmcgYWxwaGEgdGVzdCBmb3IgY3V0b3V0cyAobmV0cy9ncmF0ZXMpCiAgICAgICAgICAgIHZlcnRleENvbG9yczogb2xkTWF0LnZlcnRleENvbG9ycywgLy8gUHJlc2VydmUgdmVydGV4IGNvbG9ycwogICAgICAgICAgICBkZXB0aFRlc3Q6IHRydWUsCiAgICAgICAgICAgIGRlcHRoV3JpdGU6IHRydWUsICAgICAgIC8vIEZvcmNlIGRlcHRoIHdyaXRlIHNvIGl0IG9jY2x1ZGVzIHByb3Blcmx5CiAgICAgICAgICAgIGZvZzogdHJ1ZQogICAgICAgIH07CgogICAgICAgIC8vIEVuc3VyZSB0ZXh0dXJlIGVuY29kaW5nIGlzIGNvcnJlY3QgZm9yIFRocmVlLmpzCiAgICAgICAgaWYgKHBhcmFtcy5tYXApIHBhcmFtcy5tYXAuZW5jb2RpbmcgPSBUSFJFRS5zUkdCRW5jb2Rpbmc7CgogICAgICAgIHJldHVybiBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwocGFyYW1zKTsKICAgIH0KCiAgICB3aW5kb3cuZmx1eC5Bc3NldExvYWRlciA9IHsKICAgICAgICBsb2FkTW9kZWw6IGZ1bmN0aW9uKHVybCwgb25Mb2FkLCBvblByb2dyZXNzLCBvbkVycm9yKSB7CiAgICAgICAgICAgIF9sb2FkZXIubG9hZCh1cmwsIGZ1bmN0aW9uKGdsdGYpIHsKICAgICAgICAgICAgICAgIGdsdGYuc2NlbmUudHJhdmVyc2UoZnVuY3Rpb24obm9kZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChub2RlLmlzTWVzaCkgewpub2RlLmNhc3RTaGFkb3cgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5yZWNlaXZlU2hhZG93ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuZnJ1c3R1bUN1bGxlZCA9IGZhbHNlOyAvLyBQcmV2ZW50IGludmlzaWJpbGl0eQogICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5tYXRlcmlhbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkobm9kZS5tYXRlcmlhbCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlLm1hdGVyaWFsID0gbm9kZS5tYXRlcmlhbC5tYXAobSA9PiBjb252ZXJ0TWF0ZXJpYWwobSwgbm9kZS5pc1NraW5uZWRNZXNoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUubWF0ZXJpYWwgPSBjb252ZXJ0TWF0ZXJpYWwobm9kZS5tYXRlcmlhbCwgbm9kZS5pc1NraW5uZWRNZXNoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgaWYgKG9uTG9hZCkgb25Mb2FkKGdsdGYpOwogICAgICAgICAgICB9LCBvblByb2dyZXNzLCBvbkVycm9yKTsKICAgICAgICB9CiAgICB9Owp9KSgpOw==","Player.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCi8vIFJldXNhYmxlIG1hdGggb2JqZWN0cwogICAgY29uc3QgX3BWZWMgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgY29uc3QgX3BRdWF0ID0gbmV3IFRIUkVFLlF1YXRlcm5pb24oKTsKICAgIGNvbnN0IF9wVGFyZ2V0UXVhdCA9IG5ldyBUSFJFRS5RdWF0ZXJuaW9uKCk7CmNvbnN0IF9wQXhpc1kgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAxLCAwKTsKICAgIGNvbnN0IF9wQXhpc1ogPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAxKTsKCmNsYXNzIFBsYXllciB7CiAgICAgICAgY29uc3RydWN0b3Ioc2NlbmUsIHJvbGUgPSAnTUYnKSB7CiAgICAgICAgICAgIHRoaXMuc2NlbmUgPSBzY2VuZTsKICAgICAgICAgICAgdGhpcy5yb2xlID0gcm9sZTsKICAgICAgICAgICAgdGhpcy50ZWFtID0gbnVsbDsgLy8gQXNzaWduZWQgYnkgVGVhbS5hZGRQbGF5ZXIKICAgICAgICAgICAgdGhpcy5ob21lUG9zaXRpb24gPSBuZXcgVEhSRUUuVmVjdG9yMygpOwoKICAgICAgICAgICAgdGhpcy5tZXNoID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5taXhlciA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuYWN0aW9ucyA9IHt9OwogICAgICAgICAgICB0aGlzLmFjdGl2ZUFjdGlvbiA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSAnaWRsZSc7CiAgICAgICAgICAgIHRoaXMuaW5wdXRWZWN0b3IgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAwKTsKCiAgICAgICAgICAgIC8vIFBoeXNpY3MgKERyaWZ0L0luZXJ0aWEgTW9kZWwpCiAgICAgICAgICAgIHRoaXMudmVsb2NpdHkgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAwKTsKICAgICAgICAgICAgdGhpcy5hY2NlbGVyYXRpb24gPSAxMi4wOwogICAgICAgICAgICB0aGlzLmRyYWcgPSAzLjA7CiAgICAgICAgICAgIHRoaXMubWF4U3BlZWQgPSA4LjA7CiAgICAgICAgICAgIC8vIEJvbmUgcmVmZXJlbmNlIGZvciBob2xkaW5nIGJhbGwKICAgICAgICAgICAgdGhpcy5oYW5kQm9uZSA9IG51bGw7CnRoaXMuY2FuQ2F0Y2ggPSB0cnVlOwogICAgICAgICAgICB0aGlzLmNhdGNoQ29vbGRvd24gPSAwOyAvLyBSZXBsYWNlcyBzZXRUaW1lb3V0IGZvciBzYWZldHkKCiAgICAgICAgICAgIC8vIEJsaXR6YmFsbCBTdGF0cwogICAgICAgICAgICB0aGlzLnN0YXRzID0gewogICAgICAgICAgICAgICAgSFA6IDEwMCwKICAgICAgICAgICAgICAgIG1heEhQOiAxMDAsCiAgICAgICAgICAgICAgICBFTjogMzAsCiAgICAgICAgICAgICAgICBBVDogMTAsCiAgICAgICAgICAgICAgICBQQTogMTUsCiAgICAgICAgICAgICAgICBCTDogMTAsCiAgICAgICAgICAgICAgICBTSDogMTUsCiAgICAgICAgICAgICAgICBDQTogMTAsCiAgICAgICAgICAgICAgICBTUDogNjAKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8vIExldmVsaW5nIFN5c3RlbQogICAgICAgICAgICB0aGlzLmxldmVsID0gMTsKICAgICAgICAgICAgdGhpcy5leHAgPSAwOwogICAgICAgICAgICB0aGlzLm5leHRMZXZlbEV4cCA9IDEwMDsKCiAgICAgICAgICAgIC8vIFN0YXR1cyBFZmZlY3RzICYgVGVjaG5pcXVlcwogICAgICAgICAgICB0aGlzLnN0YXR1cyA9IHsKICAgICAgICAgICAgICAgIHZlbm9tOiAwLAogICAgICAgICAgICAgICAgbmFwOiAwLAogICAgICAgICAgICAgICAgd2l0aGVyOiB7IFBBOiAwLCBTSDogMCwgQVQ6IDAsIEJMOiAwLCBDQTogMCwgU1A6IDAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgdGhpcy5tYXJraW5nID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5sZWFybmVkVGVjaHMgPSBbXTsKCiAgICAgICAgICAgIHRoaXMudGVjaHMgPSB7CiAgICAgICAgICAgICAgICB0YWNrbGU6IG51bGwsCiAgICAgICAgICAgICAgICBzaG9vdDogbnVsbCwKICAgICAgICAgICAgICAgIHBhc3M6IG51bGwsCiAgICAgICAgICAgICAgICBwYXNzaXZlOiBudWxsCiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBWaXN1YWxzCiAgICAgICAgICAgIHRoaXMuYmFzZUNvbG9ySGV4ID0gMHhmZmZmZmY7CiAgICAgICAgICAgIHRoaXMub3JpZ2luYWxNYXRlcmlhbHMgPSBbXTsKICAgICAgICAgICAgdGhpcy5hdXJhTWVzaCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMucm90YXRpb25PZmZzZXQgPSAwOwp0aGlzLmJhc2VTY2FsZSA9IDEuMTc7IC8vIEluY3JlYXNlZCB+OCUKCiAgICAgICAgICAgIC8vIFJlYWwtdGltZSBTdGF0cwogICAgICAgICAgICB0aGlzLmN1cnJlbnRFTiA9IHRoaXMuc3RhdHMuRU47CnRoaXMudGFja2xlUmFkaXVzID0gMi4wOyAvLyBSZWR1Y2VkIGZyb20gMi41IHRvIHJlZHVjZSBzd2FybSBsb2NrCgogICAgICAgICAgICB0aGlzLnNwZWVkID0gNC4wOwogICAgICAgICAgICB0aGlzLl91cGRhdGVEZXJpdmVkU3RhdHMoKTsKCiAgICAgICAgICAgIHRoaXMuaGFzQmFsbCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmlzVGhyb3dpbmcgPSBmYWxzZTsKCiAgICAgICAgICAgIC8vIERhc2ggU3RhdGUKICAgICAgICAgICAgdGhpcy5pc0Rhc2hpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5kYXNoVGltZSA9IDA7CiAgICAgICAgICAgIHRoaXMuZGFzaFRvdGFsVGltZSA9IDAuNTsKICAgICAgICAgICAgdGhpcy5kYXNoQ29vbGRvd24gPSAwOwp0aGlzLmRhc2hDb29sZG93biA9IDA7CiAgICAgICAgICAgIHRoaXMuY2xhc2hDb29sZG93biA9IDA7IC8vIENvb2xkb3duIGZvciBpbmZsaWN0aW5nIHRhY2tsZXMKICAgICAgICAgICAgdGhpcy5kYXNoVmVjID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKCiAgICAgICAgICAgIC8vIEZlZWRiYWNrIEFjY3VtdWxhdG9ycwogICAgICAgICAgICB0aGlzLl9hY2N1bXVsYXRlZERhbWFnZSA9IDA7CiAgICAgICAgICAgIHRoaXMuX2RhbWFnZVRpbWVyID0gMDsKCiAgICAgICAgICAgIC8vIEhQIEJhcgogICAgICAgICAgICB0aGlzLmhwQmFyID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5ocEJhckZpbGwgPSBudWxsOwoKICAgICAgICAgICAgLy8gR2FtZXBsYXkgRmxvdyBUaW1lcnMKICAgICAgICAgICAgdGhpcy5zdHVuVGltZXIgPSAwOwogICAgICAgICAgICB0aGlzLmltbXVuaXR5VGltZXIgPSAwOwoKICAgICAgICAgICAgLy8gQmFua2luZyAmIFZlcnRpY2FsaXR5CiAgICAgICAgICAgIHRoaXMuYmFua2luZ0Ftb3VudCA9IDA7CiAgICAgICAgICAgIHRoaXMudGFyZ2V0WSA9IDA7CgogICAgICAgICAgICAvLyBFbmNvdW50ZXIgU3lzdGVtCiAgICAgICAgICAgIHRoaXMuaXNFbmdhZ2VkID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuY2xhc2hUaW1lciA9IDA7CnRoaXMuY2xhc2hUaW1lciA9IDA7CiAgICAgICAgICAgIHRoaXMuZW5jb3VudGVyVGltZXIgPSAwOyAvLyBUcmFjayBkdXJhdGlvbiBvZiBjdXJyZW50IGVuZ2FnZW1lbnQKICAgICAgICAgICAgLy8gQ2hhcmdlIE1lY2hhbmljCiAgICAgICAgICAgIHRoaXMuaXNDaGFyZ2luZyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmNoYXJnZVRpbWUgPSAwOwogICAgICAgICAgICB0aGlzLm1heENoYXJnZVRpbWUgPSAxLjU7CgogICAgICAgICAgICAvLyBGSVhFRDogSW1wcm92ZWQgUm90YXRpb24gU3RhdGUgd2l0aCBoeXN0ZXJlc2lzCiAgICAgICAgICAgIHRoaXMuY3VycmVudFlhdyA9IDA7CiAgICAgICAgICAgIHRoaXMudGFyZ2V0WWF3ID0gMDsKICAgICAgICAgICAgdGhpcy5sYXN0VmFsaWRZYXcgPSAwOyAvLyBTdG9yZSBsYXN0IGtub3duIGdvb2QgeWF3IGZvciBkZWFkem9uZSBoYW5kbGluZwogICAgICAgICAgICB0aGlzLnBpdGNoQW1vdW50ID0gMDsKICAgICAgICAgICAgdGhpcy5iYW5raW5nQW1vdW50ID0gMDsKICAgICAgICAgICAgdGhpcy5mYWNpbmdEZWFkem9uZSA9IDAuMzsgLy8gTWluaW11bSBpbnB1dC92ZWxvY2l0eSBtYWduaXR1ZGUgdG8gdXBkYXRlIGZhY2luZwoKICAgICAgICAgICAgLy8gUGFydGljbGUgRW1pc3Npb24gVGltZXJzCiAgICAgICAgICAgIHRoaXMuX3BhcnRpY2xlVGltZXJzID0gewogICAgICAgICAgICAgICAgdmVub206IDAsCiAgICAgICAgICAgICAgICBuYXA6IDAsCiAgICAgICAgICAgICAgICB3aXRoZXI6IDAKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8vIERldlRvb2xzIEZsYWdzCiAgICAgICAgICAgIHRoaXMuaXNHb2RNb2RlID0gZmFsc2U7CgogICAgICAgICAgICAvLyBQYXNzIFRhcmdldCBJbmRpY2F0b3IKLy8gUGFzcyBUYXJnZXQgSW5kaWNhdG9yCiAgICAgICAgICAgIHRoaXMucGFzc1RhcmdldEluZGljYXRvciA9IG51bGw7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBCdWJibGUgVHJhaWwgVGltZXIKICAgICAgICAgICAgdGhpcy5fYnViYmxlVGltZXIgPSAwOwp0aGlzLl9idWJibGVUaW1lciA9IDA7CiAgICAgICAgfQogICAgICAgIHN5bmNSb3RhdGlvbigpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLm1lc2gpIHJldHVybjsKICAgICAgICAgICAgY29uc3QgZXVsZXIgPSBuZXcgVEhSRUUuRXVsZXIoKS5zZXRGcm9tUXVhdGVybmlvbih0aGlzLm1lc2gucXVhdGVybmlvbiwgJ1lYWicpOwogICAgICAgICAgICB0aGlzLmN1cnJlbnRZYXcgPSBldWxlci55IC0gdGhpcy5yb3RhdGlvbk9mZnNldDsKICAgICAgICAgICAgdGhpcy50YXJnZXRZYXcgPSB0aGlzLmN1cnJlbnRZYXc7CiAgICAgICAgICAgIHRoaXMubGFzdFZhbGlkWWF3ID0gdGhpcy5jdXJyZW50WWF3OwogICAgICAgICAgICB0aGlzLmJhbmtpbmdBbW91bnQgPSAwOwogICAgICAgICAgICB0aGlzLnBpdGNoQW1vdW50ID0gMDsKICAgICAgICB9CgogICAgICAgIGdldFN0YXQobmFtZSkgewogICAgICAgICAgICBsZXQgdmFsID0gdGhpcy5zdGF0c1tuYW1lXTsKICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzLndpdGhlcltuYW1lXSA+IDApIHsKICAgICAgICAgICAgICAgIHZhbCAqPSAwLjU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgICB9CgogICAgICAgIGFwcGx5U3RhdHVzKHR5cGUsIGR1cmF0aW9uLCBzdWJUeXBlID0gbnVsbCkgewogICAgICAgICAgICBpZiAodHlwZSA9PT0gJ3Zlbm9tJykgewogICAgICAgICAgICAgICAgY29uc3Qgd2FzQWN0aXZlID0gdGhpcy5zdGF0dXMudmVub20gPiAxLjA7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXR1cy52ZW5vbSA9IE1hdGgubWF4KHRoaXMuc3RhdHVzLnZlbm9tLCBkdXJhdGlvbik7CgogICAgICAgICAgICAgICAgaWYgKCF3YXNBY3RpdmUpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgJHt0aGlzLnJvbGV9IHBvaXNvbmVkIWApOwogICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0KQogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJQT0lTT04iLCB0aGlzLm1lc2gucG9zaXRpb24sICJzdGF0dXMiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnbmFwJykgewogICAgICAgICAgICAgICAgY29uc3Qgd2FzQWN0aXZlID0gdGhpcy5zdGF0dXMubmFwID4gMS4wOwogICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMubmFwID0gTWF0aC5tYXgodGhpcy5zdGF0dXMubmFwLCBkdXJhdGlvbik7CgogICAgICAgICAgICAgICAgaWYgKCF3YXNBY3RpdmUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5oYXNCYWxsKSB0aGlzLmZ1bWJsZSgpOwogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAke3RoaXMucm9sZX0gZmVsbCBhc2xlZXAhYCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQpCiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIlNMRUVQIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAic3RhdHVzIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ3dpdGhlcicgJiYgc3ViVHlwZSkgewogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFZhbCA9IHRoaXMuc3RhdHVzLndpdGhlcltzdWJUeXBlXSB8fCAwOwogICAgICAgICAgICAgICAgY29uc3Qgd2FzQWN0aXZlID0gY3VycmVudFZhbCA+IDEuMDsKICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzLndpdGhlcltzdWJUeXBlXSA9IE1hdGgubWF4KGN1cnJlbnRWYWwsIGR1cmF0aW9uKTsKCiAgICAgICAgICAgICAgICBpZiAoIXdhc0FjdGl2ZSkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAke3RoaXMucm9sZX0gd2l0aGVyZWQgJHtzdWJUeXBlfSFgKTsKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dC5zcGF3bihgV0lUSEVSICR7c3ViVHlwZX1gLCB0aGlzLm1lc2gucG9zaXRpb24sICJzdGF0dXMiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX3VwZGF0ZURlcml2ZWRTdGF0cygpIHsKICAgICAgICAgICAgY29uc3Qgc3AgPSB0aGlzLmdldFN0YXQoJ1NQJyk7CiAgICAgICAgICAgIHRoaXMubWF4U3BlZWQgPSA1LjAgKyAoc3AgLyAxNS4wKTsKICAgICAgICAgICAgdGhpcy5jdXJyZW50RU4gPSB0aGlzLmdldFN0YXQoJ0VOJyk7CiAgICAgICAgfQoKc2V0TWVzaChzb3VyY2VNZXNoLCBhbmltYXRpb25zKSB7CiAgICAgICAgICAgIHRoaXMubWVzaCA9IHNvdXJjZU1lc2g7CiAgICAgICAgICAgIHRoaXMuc2NlbmUuYWRkKHRoaXMubWVzaCk7CiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUhQQmFyKCk7CiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUF1cmEoKTsKICAgICAgICAgICAgdGhpcy5fY3JlYXRlUGFzc1RhcmdldEluZGljYXRvcigpOwoKICAgICAgICAgICAgLy8gQ3VzdG9tIENoYXJhY3RlciBTY2FsaW5nCiAgICAgICAgICAgIGlmICh0aGlzLmNoYXJhY3Rlck5hbWUpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoYXJhY3Rlck5hbWUuaW5jbHVkZXMoJ1RpZHVzJykpIHRoaXMuYmFzZVNjYWxlID0gMS42OwogICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5jaGFyYWN0ZXJOYW1lLmluY2x1ZGVzKCdXYWtrYScpKSB0aGlzLmJhc2VTY2FsZSA9IDEuNDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5tZXNoLnNjYWxlLnNldFNjYWxhcih0aGlzLmJhc2VTY2FsZSk7CgogICAgICAgICAgICB0aGlzLm1lc2gudHJhdmVyc2UoKG5vZGUpID0+IHsKICAgICAgICAgICAgICAgIGlmIChub2RlLmlzTWVzaCAmJiBub2RlLm1hdGVyaWFsKSB7CmNvbnN0IGNvbnZlcnRPbmUgPSAobWF0KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG0gPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwOiBtYXQubWFwIHx8IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogbmV3IFRIUkVFLkNvbG9yKDB4ZmZmZmZmKSwgLy8gRk9SQ0UgV0hJVEU6IElnbm9yZSBzb3VyY2UgY29sb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zcGFyZW50OiAhIW1hdC50cmFuc3BhcmVudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IChtYXQub3BhY2l0eSAhPT0gdW5kZWZpbmVkID8gbWF0Lm9wYWNpdHkgOiAxKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFscGhhVGVzdDogKG1hdC5hbHBoYVRlc3QgIT09IHVuZGVmaW5lZCA/IG1hdC5hbHBoYVRlc3QgOiAwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZGU6IG1hdC5zaWRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVwdGhUZXN0OiBtYXQuZGVwdGhUZXN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVwdGhXcml0ZTogbWF0LmRlcHRoV3JpdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb2c6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBza2lubmluZzogISFub2RlLmlzU2tpbm5lZE1lc2gKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3JpZ2luYWxNYXRlcmlhbHMucHVzaCh7IG1hdGVyaWFsOiBtLCBiYXNlQ29sb3I6IG0uY29sb3IuY2xvbmUoKSB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG07CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBub2RlLm1hdGVyaWFsID0gQXJyYXkuaXNBcnJheShub2RlLm1hdGVyaWFsKQogICAgICAgICAgICAgICAgICAgICAgICA/IG5vZGUubWF0ZXJpYWwubWFwKGNvbnZlcnRPbmUpCiAgICAgICAgICAgICAgICAgICAgICAgIDogY29udmVydE9uZShub2RlLm1hdGVyaWFsKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAobm9kZS5pc0JvbmUpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBuYW1lID0gbm9kZS5uYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKChuYW1lLmluY2x1ZGVzKCdoYW5kJykgJiYgbmFtZS5pbmNsdWRlcygncicpKSB8fCBuYW1lLmluY2x1ZGVzKCdyaWdodGhhbmQnKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRCb25lID0gbm9kZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgdGhpcy5taXhlciA9IG5ldyBUSFJFRS5BbmltYXRpb25NaXhlcih0aGlzLm1lc2gpOwoKICAgICAgICAgICAgaWYgKGFuaW1hdGlvbnMpIHsKICAgICAgICAgICAgICAgIGFuaW1hdGlvbnMuZm9yRWFjaCgoY2xpcCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBjbGlwLm5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICBsZXQgYWN0aW9uID0gdGhpcy5taXhlci5jbGlwQWN0aW9uKGNsaXApOwoKICAgICAgICAgICAgICAgICAgICBpZiAobmFtZS5pbmNsdWRlcygndHJlYWRpbmcnKSB8fCBuYW1lLmluY2x1ZGVzKCdpZGxlJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3Rpb25zWydpZGxlJ10gPSBhY3Rpb247CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuYW1lLmluY2x1ZGVzKCdzd2ltJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3Rpb25zWydzd2ltJ10gPSBhY3Rpb247CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuYW1lLmluY2x1ZGVzKCd0aHJvdycpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aW9uc1sndGhyb3cnXSA9IGFjdGlvbjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5hbWUuaW5jbHVkZXMoJ2NhdGNoJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3Rpb25zWydjYXRjaCddID0gYWN0aW9uOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobmFtZS5pbmNsdWRlcygncmVhY3QnKSB8fCBuYW1lLmluY2x1ZGVzKCdnZXRoaXQnKSB8fCBuYW1lLmluY2x1ZGVzKCdoaXQnKSB8fCBuYW1lLmluY2x1ZGVzKCdodXJ0JykgfHwgbmFtZS5pbmNsdWRlcygnZGFtYWdlJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3Rpb25zWydyZWFjdCddID0gYWN0aW9uOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aW9uc1tjbGlwLm5hbWVdID0gYWN0aW9uOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy5hY3Rpb25zWydpZGxlJ10pIHsKICAgICAgICAgICAgICAgIHRoaXMucGxheSgnaWRsZScpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgZmlyc3QgPSBPYmplY3QudmFsdWVzKHRoaXMuYWN0aW9ucylbMF07CiAgICAgICAgICAgICAgICBpZihmaXJzdCkgZmlyc3QucGxheSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwbGF5KGFjdGlvbk5hbWUsIGR1cmF0aW9uID0gMC41KSB7CiAgICAgICAgICAgIGNvbnN0IG5ld0FjdGlvbiA9IHRoaXMuYWN0aW9uc1thY3Rpb25OYW1lXTsKICAgICAgICAgICAgaWYgKCFuZXdBY3Rpb24gfHwgbmV3QWN0aW9uID09PSB0aGlzLmFjdGl2ZUFjdGlvbikgcmV0dXJuOwoKICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlQWN0aW9uKSB7CiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUFjdGlvbi5mYWRlT3V0KGR1cmF0aW9uKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbmV3QWN0aW9uLnJlc2V0KCk7CiAgICAgICAgICAgIG5ld0FjdGlvbi5mYWRlSW4oZHVyYXRpb24pOwogICAgICAgICAgICBuZXdBY3Rpb24ucGxheSgpOwogICAgICAgICAgICB0aGlzLmFjdGl2ZUFjdGlvbiA9IG5ld0FjdGlvbjsKICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IGFjdGlvbk5hbWU7CiAgICAgICAgfQoKICAgICAgICBzZXRJbnB1dCh4LCB6KSB7CiAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cy5uYXAgPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLmlucHV0VmVjdG9yLnNldCgwLCAwLCAwKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmlucHV0VmVjdG9yLnNldCh4LCAwLCB6KTsKICAgICAgICB9CgogICAgICAgIHJlY2VpdmVCYWxsKCkgewogICAgICAgICAgICB0aGlzLmNhbkNhdGNoID0gZmFsc2U7CgogICAgICAgICAgICBpZiAodGhpcy5zdGF0dXMubmFwID4gMCkgewogICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMubmFwID0gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5oYXNCYWxsID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5pbW11bml0eVRpbWVyID0gMi4wOwoKICAgICAgICAgICAgY29uc3QgYmFsbCA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5lbnRpdGllcy5iYWxsOwogICAgICAgICAgICBpZiAoYmFsbCAmJiBiYWxsLmxhc3RIb2xkZXIgJiYgYmFsbC5sYXN0SG9sZGVyLnRlYW0gPT09IHRoaXMudGVhbSAmJiBiYWxsLmxhc3RIb2xkZXIgIT09IHRoaXMpIHsKICAgICAgICAgICAgICAgIGJhbGwubGFzdEhvbGRlci5nYWluRXhwKDIpOwogICAgICAgICAgICAgICAgdGhpcy5nYWluRXhwKDEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCBjYXRjaEFjdGlvbiA9IHRoaXMuYWN0aW9uc1snY2F0Y2gnXTsKCiAgICAgICAgICAgIGlmIChjYXRjaEFjdGlvbikgewogICAgICAgICAgICAgICAgY2F0Y2hBY3Rpb24uc2V0TG9vcChUSFJFRS5Mb29wT25jZSk7CiAgICAgICAgICAgICAgICBjYXRjaEFjdGlvbi5jbGFtcFdoZW5GaW5pc2hlZCA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMucGxheSgnY2F0Y2gnLCAwLjEpOwoKICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQpIHsKICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIlNOQVAhIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAiY29taWMtYWN0aW9uIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRocm93QmFsbChiYWxsLCBmb3JjZWRUeXBlID0gbnVsbCwgcG93ZXJNdWx0aXBsaWVyID0gMS4wKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5oYXNCYWxsIHx8IHRoaXMuaXNUaHJvd2luZykgcmV0dXJuOwogICAgICAgICAgICBpZiAodGhpcy5zdGF0dXMubmFwID4gMCkgcmV0dXJuOwoKICAgICAgICAgICAgdGhpcy5pc1Rocm93aW5nID0gdHJ1ZTsKCiAgICAgICAgICAgIC8vIExvY2sgYWltIGRpcmVjdGlvbiBhdCBzdGFydCBvZiB0aHJvdwogICAgICAgICAgICB0aGlzLmxvY2tlZEFpbVZlY3RvciA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CgogICAgICAgICAgICBpZiAodGhpcy5pbnB1dFZlY3Rvci5sZW5ndGhTcSgpID4gMC4xKSB7CiAgICAgICAgICAgICAgICB0aGlzLmxvY2tlZEFpbVZlY3Rvci5jb3B5KHRoaXMuaW5wdXRWZWN0b3IpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5sb2NrZWRBaW1WZWN0b3Iuc2V0KDAsIDAsIDEpLmFwcGx5UXVhdGVybmlvbih0aGlzLm1lc2gucXVhdGVybmlvbikubm9ybWFsaXplKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IGdvYWxaID0gKHRoaXMudGVhbSAmJiB0aGlzLnRlYW0uc2lkZSA9PT0gMSkgPyAtMjggOiAyODsKICAgICAgICAgICAgY29uc3QgZGlzdFRvR29hbCA9IE1hdGguYWJzKHRoaXMubWVzaC5wb3NpdGlvbi56IC0gZ29hbFopOwoKICAgICAgICAgICAgbGV0IHR5cGUgPSBmb3JjZWRUeXBlOwogICAgICAgICAgICBpZiAoIXR5cGUpIHsKICAgICAgICAgICAgICAgIHR5cGUgPSAoZGlzdFRvR29hbCA8IDI1KSA/ICdTSCcgOiAnUEEnOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCBpc0ZpbmlzaGVyID0gKHR5cGUgPT09ICdTSCcgJiYgZGlzdFRvR29hbCA8IDEyLjApOwoKICAgICAgICAgICAgbGV0IHRlY2hOYW1lID0gKHR5cGUgPT09ICdTSCcpID8gdGhpcy50ZWNocy5zaG9vdCA6IHRoaXMudGVjaHMucGFzczsKCiAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cy52ZW5vbSA+IDAgJiYgdGVjaE5hbWUpIHsKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0KQogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIlNJTEVOQ0VEIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAic3RhdHVzIik7CiAgICAgICAgICAgICAgICB0ZWNoTmFtZSA9IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCB3aW5kdXBUaW1lID0gMTAwOwogICAgICAgICAgICBsZXQgYW5pbVNwZWVkID0gMS41OwoKICAgICAgICAgICAgaWYgKHBvd2VyTXVsdGlwbGllciA+IDEuMSkgewogICAgICAgICAgICAgICAgd2luZHVwVGltZSArPSAyMDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChpc0ZpbmlzaGVyICYmICF0ZWNoTmFtZSkgewogICAgICAgICAgICAgICAgd2luZHVwVGltZSA9IDUwOwogICAgICAgICAgICAgICAgYW5pbVNwZWVkID0gMy4wOwogICAgICAgICAgICB9CgppZiAodGVjaE5hbWUpIHsKICAgICAgICAgICAgICAgIHdpbmR1cFRpbWUgPSA0MDA7CiAgICAgICAgICAgICAgICBhbmltU3BlZWQgPSAwLjg7CgogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5jYW1lcmFNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmNhbWVyYU1hbmFnZXIucGxheUNpbmVtYXRpYyh0ZWNoTmFtZSwgdGhpcy5tZXNoLCAxLjIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuaW1tdW5pdHlUaW1lciA9IDEuNTsKCiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gdGVjaE5hbWUucmVwbGFjZSgnXycsICcgJykudG9VcHBlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKGxhYmVsLCB0aGlzLm1lc2gucG9zaXRpb24sICJ0ZWNoIik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gTkVXOiBTcGF3biBUZWNoIEdseXBoIChWZXJ0aWNhbCBDYXN0aW5nIENpcmNsZSkKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZ2x5cGhNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmdseXBoTWFuYWdlci5zcGF3bigndGVjaCcsIHRoaXMubWVzaC5wb3NpdGlvbiwgewogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQ6IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGxpZmU6IDEuMiwKICAgICAgICAgICAgICAgICAgICAgICAgcm90YXRpb25TcGVlZDogNC4wLAogICAgICAgICAgICAgICAgICAgICAgICBzY2FsZVNwZWVkOiAxLjUsCiAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldFk6IDEuMiwKICAgICAgICAgICAgICAgICAgICAgICAgZmFjZUNhbWVyYTogdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCB0aHJvd0FjdGlvbiA9IHRoaXMuYWN0aW9uc1sndGhyb3cnXTsKICAgICAgICAgICAgaWYgKHRocm93QWN0aW9uKSB7CiAgICAgICAgICAgICAgICB0aHJvd0FjdGlvbi5zZXRMb29wKFRIUkVFLkxvb3BPbmNlKTsKICAgICAgICAgICAgICAgIHRocm93QWN0aW9uLmNsYW1wV2hlbkZpbmlzaGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRocm93QWN0aW9uLnRpbWVTY2FsZSA9IGFuaW1TcGVlZDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnBsYXkoJ3Rocm93JywgMC4xKTsKCiAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0ICYmICF0ZWNoTmFtZSkgewogICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dC5zcGF3bigiV0hPT1NIIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAiY29taWMtYWN0aW9uIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKHRoaXMuaGFzQmFsbCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aHJvd0FjdGlvbikgdGhyb3dBY3Rpb24udGltZVNjYWxlID0gMS4wOwoKICAgICAgICAgICAgICAgICAgICBsZXQgZmluYWxEaXIgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgICAgICAgICAgICAgICAgIGxldCByZWZlcmVuY2VEaXIgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwoKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vdmVycmlkZUFpbVZlY3RvcikgewogICAgICAgICAgICAgICAgICAgICAgICBmaW5hbERpci5jb3B5KHRoaXMub3ZlcnJpZGVBaW1WZWN0b3IpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VEaXIuY29weShmaW5hbERpcik7CgogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXRBbmdsZSA9IE1hdGguYXRhbjIoZmluYWxEaXIueCwgZmluYWxEaXIueik7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpbmFsQW5nbGUgPSB0YXJnZXRBbmdsZSArIHRoaXMucm90YXRpb25PZmZzZXQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHEgPSBuZXcgVEhSRUUuUXVhdGVybmlvbigpLnNldEZyb21BeGlzQW5nbGUoX3BBeGlzWSwgZmluYWxBbmdsZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5xdWF0ZXJuaW9uLmNvcHkocSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3luY1JvdGF0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmluYWxEaXIuY29weSh0aGlzLmxvY2tlZEFpbVZlY3Rvcik7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZURpci5jb3B5KHRoaXMubG9ja2VkQWltVmVjdG9yKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNwaW4gPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAwKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5wdXRWZWN0b3IubGVuZ3RoU3EoKSA+IDAuMSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnB1dERpciA9IHRoaXMuaW5wdXRWZWN0b3IuY2xvbmUoKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3Jvc3NZID0gbmV3IFRIUkVFLlZlY3RvcjMoKS5jcm9zc1ZlY3RvcnMocmVmZXJlbmNlRGlyLCBpbnB1dERpcikueTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyhjcm9zc1kpID4gMC4xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGluLnNldCgwLCBjcm9zc1kgKiAxMi4wLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgbGV0IGJhc2VDb3N0ID0gKHR5cGUgPT09ICdTSCcpID8gMjAgOiAxMDsKICAgICAgICAgICAgICAgICAgICBsZXQgdGVjaENvc3QgPSAwOwogICAgICAgICAgICAgICAgICAgIGxldCB0ZWNoQm9udXMgPSAwOwogICAgICAgICAgICAgICAgICAgIGxldCB0ZWNoUGF5bG9hZCA9IG51bGw7CgogICAgICAgICAgICAgICAgICAgIGlmICh0ZWNoTmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHRlY2hOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICd2ZW5vbSc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaENvc3QgPSAodHlwZSA9PT0gJ1NIJyA/IDIwIDogMTApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlY2hCb251cyA9IDM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaFBheWxvYWQgPSB7IHR5cGU6ICd2ZW5vbScsIGxldmVsOiAxIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICd3aXRoZXInOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlY2hDb3N0ID0gKHR5cGUgPT09ICdTSCcgPyAyMCA6IDEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZWNoQm9udXMgPSAzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlY2hQYXlsb2FkID0geyB0eXBlOiAnd2l0aGVyJywgbGV2ZWw6IDEgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ25hcCc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaENvc3QgPSAodHlwZSA9PT0gJ1NIJyA/IDM1IDogMzApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlY2hCb251cyA9IDM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaFBheWxvYWQgPSB7IHR5cGU6ICduYXAnLCBsZXZlbDogMSB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnc3BoZXJlJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gJ1NIJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZWNoQ29zdCA9IDI1OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBybmcgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMSkgKyA1OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZWNoQm9udXMgPSBybmc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlY2hQYXlsb2FkID0geyB0eXBlOiAnc3BoZXJlJywgbGV2ZWw6IDEsIGJvbnVzOiBybmcgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKGBTUEhFUkUgKyR7cm5nfWAsIHRoaXMubWVzaC5wb3NpdGlvbiwgImdvYWwiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdqZWNodCc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdTSCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaENvc3QgPSA0MDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaEJvbnVzID0gNTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaFBheWxvYWQgPSB7IHR5cGU6ICdqZWNodCcsIGxldmVsOiAxIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3BlcmZvcm1KZWNodEtub2NrYmFjaygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2ludmlzaWJsZSc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdTSCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaENvc3QgPSAyNTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaEJvbnVzID0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaFBheWxvYWQgPSB7IHR5cGU6ICdpbnZpc2libGUnLCBsZXZlbDogMSB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY29uc3QgdG90YWxDb3N0ID0gYmFzZUNvc3QgKyB0ZWNoQ29zdDsKCiAgICAgICAgICAgICAgICAgICAgbGV0IHBvd2VyRmFjdG9yID0gMS4wOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRzLkhQIDwgdG90YWxDb3N0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBvd2VyRmFjdG9yID0gMC41OwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRzLkhQID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgdGVjaFBheWxvYWQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB0ZWNoQm9udXMgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIlRJUkVEIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAiZGFtYWdlIik7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0cy5IUCAtPSB0b3RhbENvc3Q7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBsZXQgc3RhdFZhbCA9IHRoaXMuZ2V0U3RhdCh0eXBlKTsKICAgICAgICAgICAgICAgICAgICBzdGF0VmFsICs9IHRlY2hCb251czsKICAgICAgICAgICAgICAgICAgICBzdGF0VmFsICo9IHBvd2VyRmFjdG9yOwogICAgICAgICAgICAgICAgICAgIHN0YXRWYWwgKj0gcG93ZXJNdWx0aXBsaWVyOwoKICAgICAgICAgICAgICAgICAgICBjb25zdCBnb2FsWiA9ICh0aGlzLnRlYW0gJiYgdGhpcy50ZWFtLnNpZGUgPT09IDEpID8gLTI4IDogMjg7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZ29hbERpciA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIGdvYWxaIC0gdGhpcy5tZXNoLnBvc2l0aW9uLnopLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGdvYWxEb3QgPSBmaW5hbERpci5kb3QoZ29hbERpcik7CgogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAnU0gnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGdvYWxQb3MgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAyLCBnb2FsWik7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRvR29hbCA9IGdvYWxQb3MuY2xvbmUoKS5zdWIodGhpcy5tZXNoLnBvc2l0aW9uKS5ub3JtYWxpemUoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNoID0gdGhpcy5nZXRTdGF0KCdTSCcpOwogICAgICAgICAgICAgICAgICAgICAgICBsZXQgYXNzaXN0RmFjdG9yID0gTWF0aC5taW4oMC45LCBNYXRoLm1heCgwLjEsIHNoIC8gMTAwLjApKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm92ZXJyaWRlQWltVmVjdG9yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3Npc3RGYWN0b3IgKj0gMC4xOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ29hbERvdCA+IDAuMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWxEaXIubGVycCh0b0dvYWwsIGFzc2lzdEZhY3Rvcik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0ZpbmlzaGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbERpci55ICs9IDAuMDU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIlNMQU0hIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAiY29taWMtaW1wYWN0Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Cn0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbERpci55ICs9IDAuMjU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgCi8vIEdvYWxpZSBMb2Z0IEJvbnVzIChQcmV2ZW50IGludGVyY2VwdGlvbiBieSBpbW1lZGlhdGUgZGVmZW5kZXIpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJvbGUgPT09ICdHTCcpIGZpbmFsRGlyLnkgKz0gMC44OyAvLyBIaWdoIGxvZnQgZm9yIGNsZWFyYW5jZQoKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXQgPSB0aGlzLl9maW5kUGFzc1RhcmdldEluQ29uZShmaW5hbERpcik7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0b01hdGUgPSB0YXJnZXQubWVzaC5wb3NpdGlvbi5jbG9uZSgpLnN1Yih0aGlzLm1lc2gucG9zaXRpb24pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldC52ZWxvY2l0eS5sZW5ndGhTcSgpID4gMC4xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9NYXRlLmFkZFNjYWxlZFZlY3Rvcih0YXJnZXQudmVsb2NpdHksIDAuNSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b01hdGUubm9ybWFsaXplKCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGEgPSB0aGlzLmdldFN0YXQoJ1BBJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgYXNzaXN0RmFjdG9yID0gTWF0aC5taW4oMS4wLCAwLjMgKyAocGEgLyA4MC4wKSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub3ZlcnJpZGVBaW1WZWN0b3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3Npc3RGYWN0b3IgKj0gMC4xOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsRGlyLmxlcnAodG9NYXRlLCBhc3Npc3RGYWN0b3IpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpc3QgPSB0aGlzLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyh0YXJnZXQubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbERpci55ICs9IE1hdGgubWluKDAuNiwgZGlzdCAqIDAuMDMpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewpmaW5hbERpci55ICs9IDAuMjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgLy8gR29hbGllIExvZnQgQm9udXMgZm9yIFBhc3NpbmcKLy8gR29hbGllIExvZnQgQm9udXMgZm9yIFBhc3NpbmcKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucm9sZSA9PT0gJ0dMJykgZmluYWxEaXIueSArPSAwLjg7IC8vIEhpZ2ggbG9mdCBmb3IgY2xlYXJhbmNlCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBmaW5hbERpci5ub3JtYWxpemUoKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHRlY2hQYXlsb2FkICYmIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSAmJiB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UudHJpZ2dlclRlY2hFdmVudCkgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UudHJpZ2dlclRlY2hFdmVudCh0aGlzLCB0ZWNoTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgfQoKYmFsbC5zaG9vdChmaW5hbERpciwgc3RhdFZhbCwgdHlwZSwgdGVjaFBheWxvYWQsIHNwaW4pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEV4dHJhIGdyYWNlIHBlcmlvZCBmb3IgR29hbGllIHRvIHByZXZlbnQgcG9pbnQtYmxhbmsgaW50ZXJjZXB0aW9ucwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJvbGUgPT09ICdHTCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYmFsbC5jYXRjaEdyYWNlUGVyaW9kID0gMC42OyAvLyAwLjZzIGltbXVuaXR5IChhcHByb3ggMTAtMTJtIHRyYXZlbCkKICAgICAgICAgICAgICAgICAgICB9Cgp0aGlzLmxvc2VCYWxsKCk7CgogICAgICAgICAgICAgICAgICAgIHRoaXMuY2F0Y2hDb29sZG93biA9IDEuMDsgLy8gMXMgY29vbGRvd24KICAgICAgICAgICAgICAgICAgICB0aGlzLmNhdGNoQ29vbGRvd24gPSAxLjA7IC8vIDFzIGNvb2xkb3duCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYW5DYXRjaCA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB3aW5kdXBUaW1lKTsKCiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgdGhpcy5pc1Rocm93aW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLm92ZXJyaWRlQWltVmVjdG9yID0gbnVsbDsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmlucHV0VmVjdG9yLmxlbmd0aCgpID4gMC4xKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5KCdzd2ltJywgMC4yKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5KCdpZGxlJywgMC4yKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgd2luZHVwVGltZSArIDUwMCk7CiAgICAgICAgfQoKICAgICAgICBfZmluZFBhc3NUYXJnZXRJbkNvbmUoYWltRGlyKSB7CiAgICAgICAgICAgIGlmICghdGhpcy50ZWFtKSByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIGxldCBiZXN0VGFyZ2V0ID0gbnVsbDsKICAgICAgICAgICAgbGV0IG1heFNjb3JlID0gLUluZmluaXR5OwoKICAgICAgICAgICAgZm9yIChjb25zdCBtYXRlIG9mIHRoaXMudGVhbS5wbGF5ZXJzKSB7CiAgICAgICAgICAgICAgICBpZiAobWF0ZSA9PT0gdGhpcyB8fCAhbWF0ZS5tZXNoKSBjb250aW51ZTsKCiAgICAgICAgICAgICAgICBjb25zdCB0b01hdGUgPSBtYXRlLm1lc2gucG9zaXRpb24uY2xvbmUoKS5zdWIodGhpcy5tZXNoLnBvc2l0aW9uKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGRvdCA9IGFpbURpci5kb3QodG9NYXRlKTsKCiAgICAgICAgICAgICAgICBpZiAoZG90ID4gMC43KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlzdCA9IHRoaXMubWVzaC5wb3NpdGlvbi5kaXN0YW5jZVRvKG1hdGUubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2NvcmUgPSAoZG90ICogMTApIC0gKGRpc3QgKiAwLjEpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcmUgPiBtYXhTY29yZSkgewogICAgICAgICAgICAgICAgICAgICAgICBtYXhTY29yZSA9IHNjb3JlOwogICAgICAgICAgICAgICAgICAgICAgICBiZXN0VGFyZ2V0ID0gbWF0ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGJlc3RUYXJnZXQ7CiAgICAgICAgfQoKc3RhcnRDaGFyZ2UoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5oYXNCYWxsIHx8IHRoaXMuaXNUaHJvd2luZyB8fCB0aGlzLnN0YXR1cy5uYXAgPiAwKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuaXNDaGFyZ2luZyA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuY2hhcmdlVGltZSA9IDA7CgovLyBWaXN1YWxzIGhhbmRsZWQgaW4gdXBkYXRlCgogICAgICAgICAgICAvLyBTaG93IGNoYXJnZSBVSQogICAgICAgICAgICB0aGlzLl91cGRhdGVDaGFyZ2VVSSgwKTsKCiAgICAgICAgICAgIC8vIE5FVzogU3Bhd24gQ2hhcmdlIEdseXBoIChHcm91bmQgUmluZykKICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSAmJiB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZ2x5cGhNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZ2x5cGhNYW5hZ2VyLnNwYXduKCdjaGFyZ2UnLCB0aGlzLm1lc2gucG9zaXRpb24sIHsKICAgICAgICAgICAgICAgICAgICBwYXJlbnQ6IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgbGlmZTogdGhpcy5tYXhDaGFyZ2VUaW1lLAogICAgICAgICAgICAgICAgICAgIHJvdGF0aW9uU3BlZWQ6IDMuMCwKICAgICAgICAgICAgICAgICAgICBzY2FsZVNwZWVkOiAwLjIsCiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0WTogMC4xCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmVsZWFzZUNoYXJnZShkeCA9IDAsIGR5ID0gMCkgewogICAgICAgICAgICBpZiAoIXRoaXMuaXNDaGFyZ2luZykgcmV0dXJuOwogICAgICAgICAgICB0aGlzLmlzQ2hhcmdpbmcgPSBmYWxzZTsKCmNvbnN0IHJhdGlvID0gTWF0aC5taW4odGhpcy5jaGFyZ2VUaW1lIC8gdGhpcy5tYXhDaGFyZ2VUaW1lLCAxLjApOwogICAgICAgICAgICBsZXQgbXVsdGlwbGllciA9IDEuMCArIChyYXRpbyAqIDAuNSk7CgogICAgICAgICAgICBpZiAocmF0aW8gPiAwLjkpIHsKICAgICAgICAgICAgICAgIG11bHRpcGxpZXIgPSAyLjA7CiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIlBFUkZFQ1QhIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAiY29taWMtaW1wYWN0Iik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmNhbWVyYU1hbmFnZXIpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhTWFuYWdlci5hZGRGb3ZJbXB1bHNlKC01KTsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhTWFuYWdlci5hZGRTaGFrZSgwLjUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgovLyBSZXNldCB2aXN1YWxzIGluIHVwZGF0ZQogICAgICAgICAgICB0aGlzLl9oaWRlQ2hhcmdlVUkoKTsKCiAgICAgICAgICAgIGxldCBhaW1WZWMgPSBudWxsOwogICAgICAgICAgICBjb25zdCBzd2lwZUxlbiA9IE1hdGguc3FydChkeCpkeCArIGR5KmR5KTsKCiAgICAgICAgICAgIGlmIChzd2lwZUxlbiA+IDIwKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjYW1lcmEgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhOwogICAgICAgICAgICAgICAgY29uc3QgZndkID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHJpZ2h0ID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKCiAgICAgICAgICAgICAgICBpZiAoY2FtZXJhKSB7CiAgICAgICAgICAgICAgICAgICAgY2FtZXJhLmdldFdvcmxkRGlyZWN0aW9uKGZ3ZCk7CiAgICAgICAgICAgICAgICAgICAgZndkLnkgPSAwOwogICAgICAgICAgICAgICAgICAgIGlmIChmd2QubGVuZ3RoU3EoKSA8IDAuMDAxKSBmd2Quc2V0KDAsIDAsIC0xKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGZ3ZC5ub3JtYWxpemUoKTsKCiAgICAgICAgICAgICAgICAgICAgcmlnaHQuY3Jvc3NWZWN0b3JzKGZ3ZCwgbmV3IFRIUkVFLlZlY3RvcjMoMCwgMSwgMCkpLm5vcm1hbGl6ZSgpOwoKICAgICAgICAgICAgICAgICAgICBjb25zdCB3b3JsZFZlYyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICAgICAgICAgICAgICAgICAgd29ybGRWZWMuYWRkU2NhbGVkVmVjdG9yKHJpZ2h0LCBkeCk7CiAgICAgICAgICAgICAgICAgICAgd29ybGRWZWMuYWRkU2NhbGVkVmVjdG9yKGZ3ZCwgLWR5KTsKICAgICAgICAgICAgICAgICAgICB3b3JsZFZlYy5ub3JtYWxpemUoKTsKCiAgICAgICAgICAgICAgICAgICAgYWltVmVjID0gd29ybGRWZWM7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vdmVycmlkZUFpbVZlY3RvciA9IGFpbVZlYzsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgYWltVmVjID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMSkuYXBwbHlRdWF0ZXJuaW9uKHRoaXMubWVzaC5xdWF0ZXJuaW9uKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm92ZXJyaWRlQWltVmVjdG9yID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGFpbVZlYyA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIDEpLmFwcGx5UXVhdGVybmlvbih0aGlzLm1lc2gucXVhdGVybmlvbikubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICB0aGlzLm92ZXJyaWRlQWltVmVjdG9yID0gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgZ29hbFogPSAodGhpcy50ZWFtICYmIHRoaXMudGVhbS5zaWRlID09PSAxKSA/IC0yOCA6IDI4OwogICAgICAgICAgICBjb25zdCBnb2FsRGlyID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgZ29hbFogLSB0aGlzLm1lc2gucG9zaXRpb24ueikubm9ybWFsaXplKCk7CiAgICAgICAgICAgIGNvbnN0IGRvdEdvYWwgPSBhaW1WZWMuZG90KGdvYWxEaXIpOwoKICAgICAgICAgICAgbGV0IHR5cGUgPSAnUEEnOwoKICAgICAgICAgICAgY29uc3QgZGlzdFRvR29hbCA9IE1hdGguYWJzKHRoaXMubWVzaC5wb3NpdGlvbi56IC0gZ29hbFopOwoKICAgICAgICAgICAgaWYgKGRvdEdvYWwgPiAwLjggJiYgZGlzdFRvR29hbCA8IDMwLjApIHsKICAgICAgICAgICAgICAgIHR5cGUgPSAnU0gnOwogICAgICAgICAgICB9IGVsc2UgaWYgKGRvdEdvYWwgPiAwLjUgJiYgZGlzdFRvR29hbCA8IDE1LjApIHsKICAgICAgICAgICAgICAgIHR5cGUgPSAnU0gnOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCB0YXJnZXRNYXRlID0gdGhpcy5fZmluZFBhc3NUYXJnZXRJbkNvbmUoYWltVmVjKTsKICAgICAgICAgICAgaWYgKHRhcmdldE1hdGUgJiYgdHlwZSA9PT0gJ1NIJykgewogICAgICAgICAgICAgICAgY29uc3QgZGlzdE1hdGUgPSB0aGlzLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyh0YXJnZXRNYXRlLm1lc2gucG9zaXRpb24pOwogICAgICAgICAgICAgICAgaWYgKGRpc3RNYXRlIDwgMTIuMCkgdHlwZSA9ICdQQSc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IGJhbGwgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZW50aXRpZXMuYmFsbDsKICAgICAgICAgICAgaWYgKGJhbGwpIHsKICAgICAgICAgICAgICAgIHRoaXMudGhyb3dCYWxsKGJhbGwsIHR5cGUsIG11bHRpcGxpZXIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBORVc6IENoYXJnZSBVSSBtZXRob2RzCiAgICAgICAgX3VwZGF0ZUNoYXJnZVVJKHJhdGlvKSB7CiAgICAgICAgICAgIGNvbnN0IG1ldGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYXJnZS1tZXRlci1maWxsJyk7CiAgICAgICAgICAgIGlmIChtZXRlcikgewogICAgICAgICAgICAgICAgbWV0ZXIuc3R5bGUud2lkdGggPSBgJHtyYXRpbyAqIDEwMH0lYDsKICAgICAgICAgICAgICAgIGlmIChyYXRpbyA+IDAuOSkgewogICAgICAgICAgICAgICAgICAgIG1ldGVyLnN0eWxlLmJhY2tncm91bmQgPSAnbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjZmYwLCAjZjgwKSc7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJhdGlvID4gMC41KSB7CiAgICAgICAgICAgICAgICAgICAgbWV0ZXIuc3R5bGUuYmFja2dyb3VuZCA9ICdsaW5lYXItZ3JhZGllbnQoOTBkZWcsICMwZjAsICNmZjApJzsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbWV0ZXIuc3R5bGUuYmFja2dyb3VuZCA9ICdsaW5lYXItZ3JhZGllbnQoOTBkZWcsICMwYWYsICMwZjApJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhcmdlLW1ldGVyLWNvbnRhaW5lcicpOwogICAgICAgICAgICBpZiAoY29udGFpbmVyKSBjb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgfQoKICAgICAgICBfaGlkZUNoYXJnZVVJKCkgewogICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhcmdlLW1ldGVyLWNvbnRhaW5lcicpOwogICAgICAgICAgICBpZiAoY29udGFpbmVyKSBjb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICB9CgogICAgICAgIHNldE92ZXJyaWRlQWltKHgsIHopIHsKICAgICAgICAgICAgaWYgKCF0aGlzLm92ZXJyaWRlQWltVmVjdG9yKSB0aGlzLm92ZXJyaWRlQWltVmVjdG9yID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgICAgICAgICAgdGhpcy5vdmVycmlkZUFpbVZlY3Rvci5zZXQoeCwgMCwgeikubm9ybWFsaXplKCk7CiAgICAgICAgfQoKbG9zZUJhbGwoKSB7CiAgICAgICAgICAgIHRoaXMuaGFzQmFsbCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9oaWRlUGFzc1RhcmdldEluZGljYXRvcnMoKTsKICAgICAgICAgICAgLy8gRml4OiBFbnN1cmUgcGxheWVyIGNhbiBjYXRjaCBhZ2FpbiBpZiB0aGV5IGxvc2UgcG9zc2Vzc2lvbiB1bmV4cGVjdGVkbHkKICAgICAgICAgICAgLy8gKFN0YW5kYXJkIHRocm93cy9mdW1ibGVzIHdpbGwgaW1tZWRpYXRlbHkgc2V0IHRoaXMgdG8gZmFsc2Ugd2l0aCBhIHRpbWVvdXQpCiAgICAgICAgICAgIHRoaXMuY2FuQ2F0Y2ggPSB0cnVlOwogICAgICAgIH0KCnVwZGF0ZShkdCkgewogICAgICAgICAgICBpZiAoIXRoaXMubWVzaCkgcmV0dXJuOwoKICAgICAgICAgICAgaWYgKHRoaXMuaXNHb2RNb2RlKSB7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXRzLkhQID0gdGhpcy5zdGF0cy5tYXhIUDsKICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudEVOID0gdGhpcy5nZXRTdGF0KCdFTicpOwogICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMudmVub20gPSAwOwogICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMubmFwID0gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMubWl4ZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMubWl4ZXIudXBkYXRlKGR0KTsKICAgICAgICAgICAgfQoKLy8gdGhpcy5pc0VuZ2FnZWQgPSBmYWxzZTsgLy8gUkVNT1ZFRDogSGFuZGxlZCBpbiBfY2hlY2tUYWNrbGVQcmVzc3VyZSB0byBwcmV2ZW50IHN0YXRlIGZsaWNrZXJpbmcKCiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVN0YXR1cyhkdCk7CgogICAgICAgICAgICAvLyBDaGFyZ2UgTG9naWMKLy8gQ2hhcmdlIExvZ2ljCiAgICAgICAgICAgIGlmICh0aGlzLmlzQ2hhcmdpbmcpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5oYXNCYWxsIHx8IHRoaXMuc3RhdHVzLm5hcCA+IDAgfHwgdGhpcy5zdHVuVGltZXIgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0NoYXJnaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNoLnBvc2l0aW9uLnkgPSAwOwogICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5zY2FsZS5zZXRTY2FsYXIodGhpcy5iYXNlU2NhbGUpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2hpZGVDaGFyZ2VVSSgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYXJnZVRpbWUgKz0gZHQ7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJhdGlvID0gTWF0aC5taW4odGhpcy5jaGFyZ2VUaW1lIC8gdGhpcy5tYXhDaGFyZ2VUaW1lLCAxLjApOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIExldml0YXRpb24gKFBvd2VyaW5nIHVwKQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGhvdmVyID0gKE1hdGguc2luKERhdGUubm93KCkgKiAwLjAyKSAqIDAuMSkgKyAocmF0aW8gKiAwLjgpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFZpYnJhdGlvbiAoSW50ZW5zaXR5IGluY3JlYXNlcyB3aXRoIGNoYXJnZSkKICAgICAgICAgICAgICAgICAgICBjb25zdCBzaGFrZSA9IDAuMDUgKyAoMC4xICogcmF0aW8pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEFwcGx5IFkgb2Zmc2V0IChIb3ZlciArIEppdHRlcikKICAgICAgICAgICAgICAgICAgICB0aGlzLm1lc2gucG9zaXRpb24ueSA9IGhvdmVyICsgKE1hdGgucmFuZG9tKCkgLSAwLjUpICogc2hha2U7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gQXBwbHkgUm90YXRpb24gSml0dGVyICh2aWEgYmFua2luZy9waXRjaCB2YXJpYWJsZXMpCiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBhdm9pZHMgcG9zaXRpb25hbCBkcmlmdCB3aGlsZSBnaXZpbmcgYSAic3RydWdnbGluZyB0byBjb250YWluIHBvd2VyIiBsb29rCiAgICAgICAgICAgICAgICAgICAgdGhpcy5iYW5raW5nQW1vdW50ICs9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIHNoYWtlOwogICAgICAgICAgICAgICAgICAgIHRoaXMucGl0Y2hBbW91bnQgKz0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogc2hha2U7CgogICAgICAgICAgICAgICAgICAgIC8vIEVuc3VyZSBzY2FsZSBzdGF5cyBub3JtYWwgKFJlbW92ZSBzd2VsbGluZyBlZmZlY3QpCiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNoLnNjYWxlLnNldFNjYWxhcih0aGlzLmJhc2VTY2FsZSk7CgogICAgICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUNoYXJnZVVJKHJhdGlvKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQppZiAodGhpcy5kYXNoQ29vbGRvd24gPiAwKSB0aGlzLmRhc2hDb29sZG93biAtPSBkdDsKICAgICAgICAgICAgaWYgKHRoaXMuY2xhc2hDb29sZG93biA+IDApIHRoaXMuY2xhc2hDb29sZG93biAtPSBkdDsKICAgICAgICAgICAgaWYgKHRoaXMuc3R1blRpbWVyID4gMCkgdGhpcy5zdHVuVGltZXIgLT0gZHQ7CiAgICAgICAgICAgIGlmICh0aGlzLmltbXVuaXR5VGltZXIgPiAwKSB0aGlzLmltbXVuaXR5VGltZXIgLT0gZHQ7CiAgICAgICAgICAgIGlmICh0aGlzLmNhdGNoQ29vbGRvd24gPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNhdGNoQ29vbGRvd24gLT0gZHQ7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5jYXRjaENvb2xkb3duIDw9IDApIHRoaXMuY2FuQ2F0Y2ggPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIERhc2ggTG9naWMKICAgICAgICAgICAgaWYgKHRoaXMuaXNEYXNoaW5nKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRhc2hUaW1lIC09IGR0OwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmRhc2hUeXBlID09PSAnaG9yaXpvbnRhbCcpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9jaGVja1RhY2tsZUNvbGxpc2lvbigpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmRhc2hUaW1lIDw9IDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmlzRGFzaGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi55ID0gMDsKICAgICAgICAgICAgICAgICAgICB0aGlzLmRhc2hUeXBlID0gbnVsbDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CmlmICh0aGlzLmRhc2hUeXBlID09PSAndmVydGljYWwnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9wVmVjLmNvcHkodGhpcy5kYXNoVmVjKS5tdWx0aXBseVNjYWxhcihkdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi5hZGQoX3BWZWMpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gMSAtICh0aGlzLmRhc2hUaW1lIC8gdGhpcy5kYXNoVG90YWxUaW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNoLnBvc2l0aW9uLnkgPSBNYXRoLnNpbih0ICogTWF0aC5QSSkgKiAzLjA7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNoLnBvc2l0aW9uLmFkZChfcFZlYyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi55ID0gMDsKCi8vIFZpc3VhbCBUYWNrbGUgTGVhbiAoU2hvdWxkZXIgQmFzaCBBbmltYXRpb24pCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSAxIC0gKHRoaXMuZGFzaFRpbWUgLyB0aGlzLmRhc2hUb3RhbFRpbWUpOyAvLyAwIHRvIDEKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGVhbiA9IE1hdGguc2luKHQgKiBNYXRoLlBJKTsgLy8gUGVhayBhdCAxLjAgaW4gbWlkZGxlCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAvLyBSZS1hcHBseSBiYXNlIGZhY2luZyArIEFnZ3Jlc3NpdmUgU2hvdWxkZXIgQ2hlY2sKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFzZVEgPSBuZXcgVEhSRUUuUXVhdGVybmlvbigpLnNldEZyb21BeGlzQW5nbGUoX3BBeGlzWSwgdGhpcy5jdXJyZW50WWF3ICsgdGhpcy5yb3RhdGlvbk9mZnNldCk7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcGl0Y2ggPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBsZXQgeWF3ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJvbGwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBsZXQgbHVuZ2VBbXQgPSAwOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGFzaFR5cGUgPT09ICdob3Jpem9udGFsJyB8fCB0aGlzLmRhc2hUeXBlID09PSAnYnJlYWsnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVEFDS0xFL0JSRUFLOiBBZ2dyZXNzaXZlIFNob3VsZGVyIENoZWNrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGl0Y2ggPSAxLjIgKiBsZWFuOyAvLyBIZWFkIGRvd24gLyBMZWFuIGZvcndhcmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5YXcgPSAwLjggKiBsZWFuOyAgIC8vIFR1cm4gc2hvdWxkZXIgaW50byB0YXJnZXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb2xsID0gLTAuNiAqIGxlYW47IC8vIERpcCBzaG91bGRlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGx1bmdlQW10ID0gMC44ICogbGVhbjsgLy8gVGhydXN0IG1lc2ggZm9yd2FyZCB2aXN1YWxseQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZGFzaFR5cGUgPT09ICdzcHJpbnQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU1BSSU5UOiBBZXJvZHluYW1pYyBsZWFuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGl0Y2ggPSAwLjUgKiBsZWFuOyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsdW5nZUFtdCA9IDAuMiAqIGxlYW47CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFwcGx5IEx1bmdlIChWaXN1YWwgT2Zmc2V0KQogICAgICAgICAgICAgICAgICAgICAgICBpZiAobHVuZ2VBbXQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbHVuZ2UgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCBsdW5nZUFtdCkuYXBwbHlRdWF0ZXJuaW9uKGJhc2VRKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1lc2gucG9zaXRpb24uYWRkKGx1bmdlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHdpc3RRID0gbmV3IFRIUkVFLlF1YXRlcm5pb24oKS5zZXRGcm9tRXVsZXIobmV3IFRIUkVFLkV1bGVyKHBpdGNoLCB5YXcsIHJvbGwpKTsgCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5xdWF0ZXJuaW9uLm11bHRpcGx5UXVhdGVybmlvbnMoYmFzZVEsIHR3aXN0USk7CgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5Lm11bHRpcGx5U2NhbGFyKDAuOTYpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gU3R1bi9OYXAgQ2hlY2sKICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzLm5hcCA+IDAgfHwgdGhpcy5zdHVuVGltZXIgPiAwKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkcmFnRmFjdG9yID0gTWF0aC5tYXgoMCwgMSAtICgyLjAgKiBkdCkpOwogICAgICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS5tdWx0aXBseVNjYWxhcihkcmFnRmFjdG9yKTsKCiAgICAgICAgICAgICAgICBfcFZlYy5jb3B5KHRoaXMudmVsb2NpdHkpLm11bHRpcGx5U2NhbGFyKGR0KTsKICAgICAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi5hZGQoX3BWZWMpOwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSAnaWRsZScgJiYgdGhpcy5zdGF0ZSAhPT0gJ2NhdGNoJykgdGhpcy5wbGF5KCdpZGxlJywgMC41KTsKCiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVIUEJhcigpOwogICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlUGFzc1RhcmdldEluZGljYXRvcnMoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5fY2hlY2tUYWNrbGVQcmVzc3VyZShkdCk7CgogICAgICAgICAgICBpZiAodGhpcy5pc1Rocm93aW5nKSB7CiAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5Lm11bHRpcGx5U2NhbGFyKE1hdGgubWF4KDAsIDEuMCAtICgyLjAgKiBkdCkpKTsKCiAgICAgICAgICAgICAgICB0aGlzLl9hcHBseVNvZnRDb2xsaXNpb24oZHQpOwogICAgICAgICAgICAgICAgdGhpcy5fYXBwbHlHb2FsQ3JlYXNlKGR0KTsKCiAgICAgICAgICAgICAgICBfcFZlYy5jb3B5KHRoaXMudmVsb2NpdHkpLm11bHRpcGx5U2NhbGFyKGR0KTsKICAgICAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi5hZGQoX3BWZWMpOwoKICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVZlcnRpY2FsaXR5KGR0KTsKCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVQaHlzaWNzKGR0KTsKICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVZlcnRpY2FsaXR5KGR0KTsKICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUJhbmtpbmcoZHQpOwogICAgICAgICAgICB9Cgp0aGlzLl91cGRhdGVIUEJhcigpOwogICAgICAgICAgICB0aGlzLl91cGRhdGVQYXNzVGFyZ2V0SW5kaWNhdG9ycygpOwoKICAgICAgICAgICAgLy8gQnViYmxlIFRyYWlsIExvZ2ljCi8vIEJ1YmJsZSBUcmFpbCBMb2dpYwovLyBCdWJibGUgVHJhaWwgTG9naWMgKER5bmFtaWMpCiAgICAgICAgICAgIGNvbnN0IHNwZWVkU3EgPSB0aGlzLnZlbG9jaXR5Lmxlbmd0aFNxKCk7CiAgICAgICAgICAgIGlmIChzcGVlZFNxID4gMS4wICYmIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSAmJiB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UucGFydGljbGVNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9idWJibGVUaW1lciAtPSBkdDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2J1YmJsZVRpbWVyIDw9IDApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwbSA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5wYXJ0aWNsZU1hbmFnZXI7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFja0RpciA9IHRoaXMudmVsb2NpdHkuY2xvbmUoKS5ub3JtYWxpemUoKS5uZWdhdGUoKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyAxLiBTdGFuZGFyZCBXYWtlIChBbHdheXMgc3Bhd24pCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gYmFja0Rpci5jbG9uZSgpLm11bHRpcGx5U2NhbGFyKDAuOCk7CiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0LnkgPSAwLjUgKyBNYXRoLnJhbmRvbSgpICogMC41OyAKICAgICAgICAgICAgICAgICAgICBvZmZzZXQueCArPSAoTWF0aC5yYW5kb20oKS0wLjUpICogMC41OwogICAgICAgICAgICAgICAgICAgIG9mZnNldC56ICs9IChNYXRoLnJhbmRvbSgpLTAuNSkgKiAwLjU7CiAgICAgICAgICAgICAgICAgICAgcG0uc3Bhd24oJ2J1YmJsZScsIHRoaXMubWVzaC5wb3NpdGlvbi5jbG9uZSgpLmFkZChvZmZzZXQpLCB7IHNjYWxlOiAwLjE1ICsgTWF0aC5yYW5kb20oKSAqIDAuMjUgfSk7CgogICAgICAgICAgICAgICAgICAgIC8vIDIuIENhdml0YXRpb24gKEhpZ2ggU3BlZWQpIC0gQWRkIG9uIHRvcAogICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzSGlnaFNwZWVkID0gc3BlZWRTcSA+IDQwLjA7IAogICAgICAgICAgICAgICAgICAgIGlmIChpc0hpZ2hTcGVlZCkgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTwzOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1PZmZzZXQgPSBiYWNrRGlyLmNsb25lKCkubXVsdGlwbHlTY2FsYXIoMC41ICsgTWF0aC5yYW5kb20oKSowLjUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbU9mZnNldC54ICs9IChNYXRoLnJhbmRvbSgpLTAuNSkqMC44OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbU9mZnNldC55ID0gMC41ICsgKE1hdGgucmFuZG9tKCktMC41KSowLjg7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbU9mZnNldC56ICs9IChNYXRoLnJhbmRvbSgpLTAuNSkqMC44OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbS5zcGF3bignYnViYmxlX21pY3JvJywgdGhpcy5tZXNoLnBvc2l0aW9uLmNsb25lKCkuYWRkKG1PZmZzZXQpLCB7IHNjYWxlOiAwLjA2ICsgTWF0aC5yYW5kb20oKSowLjA4IH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2J1YmJsZVRpbWVyID0gMC4wMzsgCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYnViYmxlVGltZXIgPSAwLjE7IAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQp9CiAgICAgICAgX3VwZGF0ZVN0YXR1cyhkdCkgewogICAgICAgICAgICBjb25zdCBwbSA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSA/IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5wYXJ0aWNsZU1hbmFnZXIgOiBudWxsOwoKICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzLnZlbm9tID4gMCkgewogICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMudmVub20gLT0gZHQ7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXRzLkhQIC09IDUgKiBkdDsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRzLkhQIDwgMCkgdGhpcy5zdGF0cy5IUCA9IDA7CgogICAgICAgICAgICAgICAgdGhpcy5fcGFydGljbGVUaW1lcnMudmVub20gLT0gZHQ7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcGFydGljbGVUaW1lcnMudmVub20gPD0gMCAmJiBwbSkgewogICAgICAgICAgICAgICAgICAgIHBtLnNwYXduKCd2ZW5vbScsIHRoaXMubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGFydGljbGVUaW1lcnMudmVub20gPSAwLjE1OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLmhhc0JhbGwgJiYgdGhpcy5zdGF0cy5IUCA8IHRoaXMuc3RhdHMubWF4SFApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRzLkhQICs9IDUgKiBkdDsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0cy5IUCA+IHRoaXMuc3RhdHMubWF4SFApIHRoaXMuc3RhdHMuSFAgPSB0aGlzLnN0YXRzLm1heEhQOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy5oYXNCYWxsKSB7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXRzLkhQIC09IDIuMCAqIGR0OwogICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHMuSFAgPCAwKSB0aGlzLnN0YXRzLkhQID0gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzLm5hcCA+IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzLm5hcCAtPSBkdDsKCiAgICAgICAgICAgICAgICB0aGlzLl9wYXJ0aWNsZVRpbWVycy5uYXAgLT0gZHQ7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcGFydGljbGVUaW1lcnMubmFwIDw9IDAgJiYgcG0pIHsKICAgICAgICAgICAgICAgICAgICBwbS5zcGF3bignbmFwJywgdGhpcy5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9wYXJ0aWNsZVRpbWVycy5uYXAgPSAwLjg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCBpc1dpdGhlcmluZyA9IGZhbHNlOwogICAgICAgICAgICBmb3IgKGxldCBrZXkgaW4gdGhpcy5zdGF0dXMud2l0aGVyKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0dXMud2l0aGVyW2tleV0gPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMud2l0aGVyW2tleV0gLT0gZHQ7CiAgICAgICAgICAgICAgICAgICAgaXNXaXRoZXJpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoaXNXaXRoZXJpbmcpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3BhcnRpY2xlVGltZXJzLndpdGhlciAtPSBkdDsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9wYXJ0aWNsZVRpbWVycy53aXRoZXIgPD0gMCAmJiBwbSkgewogICAgICAgICAgICAgICAgICAgIHBtLnNwYXduKCd3aXRoZXInLCB0aGlzLm1lc2gucG9zaXRpb24pOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3BhcnRpY2xlVGltZXJzLndpdGhlciA9IDAuMjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5fdXBkYXRlVmlzdWFscygpOwogICAgICAgIH0KCl91cGRhdGVWaXN1YWxzKCkgewogICAgICAgICAgICAvLyBSRU1PVkVEOiBZZWxsb3cgc3BoZXJlL3RpbnQgbG9naWMgYXMgcGVyIHJlcXVlc3QuCiAgICAgICAgICAgIC8vIEFsd2F5cyByZXZlcnQgdG8gYmFzZSBjb2xvci4KICAgICAgICAgICAgdGhpcy5vcmlnaW5hbE1hdGVyaWFscy5mb3JFYWNoKGVudHJ5ID0+IHsKICAgICAgICAgICAgICAgIGVudHJ5Lm1hdGVyaWFsLmNvbG9yLmNvcHkoZW50cnkuYmFzZUNvbG9yKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBfY3JlYXRlQXVyYSgpIHsKICAgICAgICAgICAgLy8gQXVyYSByZW1vdmVkIHBlciB1c2VyIHJlcXVlc3QKICAgICAgICAgICAgdGhpcy5hdXJhTWVzaCA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICAvLyBORVc6IFBhc3MgdGFyZ2V0IGluZGljYXRvcgogICAgICAgIF9jcmVhdGVQYXNzVGFyZ2V0SW5kaWNhdG9yKCkgewogICAgICAgICAgICAvLyBDcmVhdGUgYSByaW5nIHRoYXQgaGlnaGxpZ2h0cyBwb3RlbnRpYWwgcGFzcyB0YXJnZXRzCiAgICAgICAgICAgIGNvbnN0IGdlbyA9IG5ldyBUSFJFRS5SaW5nR2VvbWV0cnkoMC44LCAxLjAsIDE2KTsKICAgICAgICAgICAgY29uc3QgbWF0ID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHsKICAgICAgICAgICAgICAgIGNvbG9yOiAweDAwZmYwMCwKICAgICAgICAgICAgICAgIHRyYW5zcGFyZW50OiB0cnVlLAogICAgICAgICAgICAgICAgb3BhY2l0eTogMC42LAogICAgICAgICAgICAgICAgc2lkZTogVEhSRUUuRG91YmxlU2lkZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5wYXNzVGFyZ2V0SW5kaWNhdG9yID0gbmV3IFRIUkVFLk1lc2goZ2VvLCBtYXQpOwogICAgICAgICAgICB0aGlzLnBhc3NUYXJnZXRJbmRpY2F0b3Iucm90YXRpb24ueCA9IC1NYXRoLlBJIC8gMjsKICAgICAgICAgICAgdGhpcy5wYXNzVGFyZ2V0SW5kaWNhdG9yLnBvc2l0aW9uLnkgPSAwLjE7CiAgICAgICAgICAgIHRoaXMucGFzc1RhcmdldEluZGljYXRvci52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuc2NlbmUuYWRkKHRoaXMucGFzc1RhcmdldEluZGljYXRvcik7CiAgICAgICAgfQoKICAgICAgICBfdXBkYXRlUGFzc1RhcmdldEluZGljYXRvcnMoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5oYXNCYWxsIHx8ICF0aGlzLnRlYW0pIHsKICAgICAgICAgICAgICAgIHRoaXMuX2hpZGVQYXNzVGFyZ2V0SW5kaWNhdG9ycygpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBGaW5kIGJlc3QgcGFzcyB0YXJnZXQKICAgICAgICAgICAgY29uc3QgYWltRGlyID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMSkuYXBwbHlRdWF0ZXJuaW9uKHRoaXMubWVzaC5xdWF0ZXJuaW9uKTsKICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gdGhpcy5fZmluZFBhc3NUYXJnZXRJbkNvbmUoYWltRGlyKTsKCiAgICAgICAgICAgIGlmICh0YXJnZXQgJiYgdGFyZ2V0Lm1lc2ggJiYgdGhpcy5wYXNzVGFyZ2V0SW5kaWNhdG9yKSB7CiAgICAgICAgICAgICAgICB0aGlzLnBhc3NUYXJnZXRJbmRpY2F0b3IudmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLnBhc3NUYXJnZXRJbmRpY2F0b3IucG9zaXRpb24ueCA9IHRhcmdldC5tZXNoLnBvc2l0aW9uLng7CiAgICAgICAgICAgICAgICB0aGlzLnBhc3NUYXJnZXRJbmRpY2F0b3IucG9zaXRpb24ueiA9IHRhcmdldC5tZXNoLnBvc2l0aW9uLno7CiAgICAgICAgICAgICAgICB0aGlzLnBhc3NUYXJnZXRJbmRpY2F0b3IucG9zaXRpb24ueSA9IDAuMTsKICAgICAgICAgICAgICAgIHRoaXMucGFzc1RhcmdldEluZGljYXRvci5yb3RhdGlvbi56ICs9IDAuMDU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl9oaWRlUGFzc1RhcmdldEluZGljYXRvcnMoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX2hpZGVQYXNzVGFyZ2V0SW5kaWNhdG9ycygpIHsKICAgICAgICAgICAgaWYgKHRoaXMucGFzc1RhcmdldEluZGljYXRvcikgewogICAgICAgICAgICAgICAgdGhpcy5wYXNzVGFyZ2V0SW5kaWNhdG9yLnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCl9hcHBseVNvZnRDb2xsaXNpb24oZHQpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLm1lc2ggfHwgIXdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSkgcmV0dXJuOwoKICAgICAgICAgICAgY29uc3QgZ2FtZSA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZTsKICAgICAgICAgICAgY29uc3QgdGVhbXMgPSBbZ2FtZS50ZWFtcy5ob21lLCBnYW1lLnRlYW1zLmF3YXldOwoKICAgICAgICAgICAgY29uc3QgcmVwdWxzaW9uUmFkaXVzID0gMC41OyAvLyBSZWR1Y2VkIHRvIDAuNSB0byBmaXggaW52aXNpYmxlIHdhbGwgaXNzdWVzCiAgICAgICAgICAgIGNvbnN0IHN0aWZmbmVzcyA9IDE1LjA7CgogICAgICAgICAgICB0ZWFtcy5mb3JFYWNoKHRlYW0gPT4gewogICAgICAgICAgICAgICAgaWYgKCF0ZWFtKSByZXR1cm47CiAgICAgICAgICAgICAgICB0ZWFtLnBsYXllcnMuZm9yRWFjaChvdGhlciA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG90aGVyID09PSB0aGlzIHx8ICFvdGhlci5tZXNoKSByZXR1cm47CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGR4ID0gdGhpcy5tZXNoLnBvc2l0aW9uLnggLSBvdGhlci5tZXNoLnBvc2l0aW9uLng7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZHkgPSB0aGlzLm1lc2gucG9zaXRpb24ueSAtIG90aGVyLm1lc2gucG9zaXRpb24ueTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkeiA9IHRoaXMubWVzaC5wb3NpdGlvbi56IC0gb3RoZXIubWVzaC5wb3NpdGlvbi56OwoKICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXN0U3EgPSBkeCpkeCArIGR5KmR5ICsgZHoqZHo7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWluRGlzdCA9IHJlcHVsc2lvblJhZGl1cyAqIDIuMDsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGRpc3RTcSA8IG1pbkRpc3QgKiBtaW5EaXN0ICYmIGRpc3RTcSA+IDAuMDAwMSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gTWF0aC5zcXJ0KGRpc3RTcSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG92ZXJsYXAgPSBtaW5EaXN0IC0gZGlzdDsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZvcmNlID0gb3ZlcmxhcCAqIHN0aWZmbmVzczsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG54ID0gZHggLyBkaXN0OwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBueSA9IGR5IC8gZGlzdDsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbnogPSBkeiAvIGRpc3Q7CgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5LnggKz0gbnggKiBmb3JjZSAqIGR0OwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5LnkgKz0gbnkgKiBmb3JjZSAqIGR0OwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5LnogKz0gbnogKiBmb3JjZSAqIGR0OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIF91cGRhdGVQaHlzaWNzKGR0KSB7CiAgICAgICAgICAgIHRoaXMuX2FwcGx5U29mdENvbGxpc2lvbihkdCk7CiAgICAgICAgICAgIHRoaXMuX2FwcGx5R29hbENyZWFzZShkdCk7CgogICAgICAgICAgICBjb25zdCBpbnB1dExlblNxID0gdGhpcy5pbnB1dFZlY3Rvci5sZW5ndGhTcSgpOwogICAgICAgICAgICBjb25zdCBpc0lucHV0QWN0aXZlID0gaW5wdXRMZW5TcSA+IDAuMDE7CgogICAgICAgICAgICBsZXQgY3VycmVudE1heFNwZWVkID0gdGhpcy5tYXhTcGVlZDsKaWYgKHRoaXMuaXNFbmdhZ2VkKSBjdXJyZW50TWF4U3BlZWQgKj0gMC44OyAvLyBCdWZmZWQgZnJvbSAwLjUgdG8gYWxsb3cgZXNjYXBlCiAgICAgICAgICAgIGlmICh0aGlzLmlzQ2hhcmdpbmcpIGN1cnJlbnRNYXhTcGVlZCAqPSAwLjk7CgogICAgICAgICAgICBpZiAoaXNJbnB1dEFjdGl2ZSkgewogICAgICAgICAgICAgICAgX3BWZWMuY29weSh0aGlzLmlucHV0VmVjdG9yKS5ub3JtYWxpemUoKTsKCiAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXRWZWxYID0gX3BWZWMueCAqIGN1cnJlbnRNYXhTcGVlZDsKICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldFZlbFogPSBfcFZlYy56ICogY3VycmVudE1heFNwZWVkOwoKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRTcGVlZCA9IHRoaXMudmVsb2NpdHkubGVuZ3RoKCk7CiAgICAgICAgICAgICAgICBjb25zdCBzcGVlZFJhdGlvID0gTWF0aC5taW4oMS4wLCBjdXJyZW50U3BlZWQgLyB0aGlzLm1heFNwZWVkKTsKCiAgICAgICAgICAgICAgICBjb25zdCBhZ2lsaXR5ID0gVEhSRUUuTWF0aFV0aWxzLmxlcnAoMTAuMCwgMi4wLCBzcGVlZFJhdGlvKTsKCiAgICAgICAgICAgICAgICBjb25zdCB0ID0gMS4wIC0gTWF0aC5wb3coMC4wMSwgZHQgKiBhZ2lsaXR5KTsKCiAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5LnggKz0gKHRhcmdldFZlbFggLSB0aGlzLnZlbG9jaXR5LngpICogdDsKICAgICAgICAgICAgICAgIHRoaXMudmVsb2NpdHkueiArPSAodGFyZ2V0VmVsWiAtIHRoaXMudmVsb2NpdHkueikgKiB0OwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSAnc3dpbScpIHRoaXMucGxheSgnc3dpbScsIDAuMik7CgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgYnJha2VGYWN0b3IgPSAyLjA7CiAgICAgICAgICAgICAgICBjb25zdCB0ID0gMS4wIC0gTWF0aC5wb3coMC4xLCBkdCAqIGJyYWtlRmFjdG9yKTsKCiAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5LnggKz0gKDAgLSB0aGlzLnZlbG9jaXR5LngpICogdDsKICAgICAgICAgICAgICAgIHRoaXMudmVsb2NpdHkueiArPSAoMCAtIHRoaXMudmVsb2NpdHkueikgKiB0OwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLnZlbG9jaXR5Lmxlbmd0aFNxKCkgPCAwLjAxKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS5zZXQoMCwgdGhpcy52ZWxvY2l0eS55LCAwKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSAhPT0gJ2lkbGUnICYmIHRoaXMuc3RhdGUgIT09ICdjYXRjaCcgJiYgdGhpcy5zdGF0ZSAhPT0gJ3Rocm93JyAmJiB0aGlzLnN0YXRlICE9PSAncmVhY3QnKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5KCdpZGxlJywgMC4zKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS55ICo9IE1hdGgubWF4KDAsIDEuMCAtICgyLjAgKiBkdCkpOwoKICAgICAgICAgICAgX3BWZWMuY29weSh0aGlzLnZlbG9jaXR5KS5tdWx0aXBseVNjYWxhcihkdCk7CiAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi5hZGQoX3BWZWMpOwogICAgICAgIH0KCiAgICAgICAgX3VwZGF0ZVZlcnRpY2FsaXR5KGR0KSB7CiAgICAgICAgICAgIGxldCB0YXJnZXRZID0gMDsKCiAgICAgICAgICAgIGNvbnN0IGJhbGwgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZW50aXRpZXMuYmFsbDsKCiAgICAgICAgICAgIGlmIChiYWxsICYmIGJhbGwubWVzaCAmJiAhdGhpcy5oYXNCYWxsKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0VG9CYWxsID0gdGhpcy5tZXNoLnBvc2l0aW9uLmRpc3RhbmNlVG8oYmFsbC5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgIGlmIChkaXN0VG9CYWxsIDwgMTUuMCkgewogICAgICAgICAgICAgICAgICAgIHRhcmdldFkgPSBiYWxsLm1lc2gucG9zaXRpb24ueTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMuaGFzQmFsbCkgewogICAgICAgICAgICAgICAgdGFyZ2V0WSA9IDAuNTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgeURpZmYgPSB0YXJnZXRZIC0gdGhpcy5tZXNoLnBvc2l0aW9uLnk7CgogICAgICAgICAgICBjb25zdCBsaWZ0ID0geURpZmYgKiAxMC4wICogZHQ7CiAgICAgICAgICAgIHRoaXMudmVsb2NpdHkueSArPSBsaWZ0OwoKICAgICAgICAgICAgaWYgKHRoaXMubWVzaC5wb3NpdGlvbi55ID4gOC4wKSB7CiAgICAgICAgICAgICAgICB0aGlzLm1lc2gucG9zaXRpb24ueSA9IDguMDsKICAgICAgICAgICAgICAgIHRoaXMudmVsb2NpdHkueSAqPSAtMC41OwogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMubWVzaC5wb3NpdGlvbi55IDwgLTguMCkgewogICAgICAgICAgICAgICAgdGhpcy5tZXNoLnBvc2l0aW9uLnkgPSAtOC4wOwogICAgICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS55ICo9IC0wLjU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIEZJWEVEOiBJbXByb3ZlZCBiYW5raW5nIHdpdGggaHlzdGVyZXNpcyB0byBwcmV2ZW50IGZhY2luZyBmbGlwcwogICAgICAgIF91cGRhdGVCYW5raW5nKGR0KSB7CiAgICAgICAgICAgIGNvbnN0IGlucHV0TGVuU3EgPSB0aGlzLmlucHV0VmVjdG9yLmxlbmd0aFNxKCk7CiAgICAgICAgICAgIGNvbnN0IHZlbExlblNxID0gdGhpcy52ZWxvY2l0eS5sZW5ndGhTcSgpOwoKICAgICAgICAgICAgbGV0IHRhcmdldFlhdyA9IHRoaXMudGFyZ2V0WWF3OwogICAgICAgICAgICBsZXQgc2hvdWxkVXBkYXRlWWF3ID0gZmFsc2U7CgogICAgICAgICAgICAvLyBPbmx5IHVwZGF0ZSB5YXcgaWYgaW5wdXQgb3IgdmVsb2NpdHkgZXhjZWVkcyBkZWFkem9uZQogICAgICAgICAgICBpZiAoaW5wdXRMZW5TcSA+IHRoaXMuZmFjaW5nRGVhZHpvbmUgKiB0aGlzLmZhY2luZ0RlYWR6b25lKSB7CiAgICAgICAgICAgICAgICB0YXJnZXRZYXcgPSBNYXRoLmF0YW4yKHRoaXMuaW5wdXRWZWN0b3IueCwgdGhpcy5pbnB1dFZlY3Rvci56KTsKICAgICAgICAgICAgICAgIHNob3VsZFVwZGF0ZVlhdyA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodmVsTGVuU3EgPiB0aGlzLmZhY2luZ0RlYWR6b25lICogdGhpcy5mYWNpbmdEZWFkem9uZSkgewp0YXJnZXRZYXcgPSBNYXRoLmF0YW4yKHRoaXMudmVsb2NpdHkueCwgdGhpcy52ZWxvY2l0eS56KTsKICAgICAgICAgICAgICAgIHNob3VsZFVwZGF0ZVlhdyA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5oYXNCYWxsICYmIHRoaXMudGVhbSAmJiB0aGlzLnRlYW0uaXNIdW1hbiAmJiB0aGlzLnRlYW0uYWN0aXZlUGxheWVyID09PSB0aGlzICYmICF3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuaXNEZW1vTW9kZSkgewogICAgICAgICAgICAgICAgLy8gU3RhdGlvbmFyeSBBaW1pbmcgKEh1bWFuIHdpdGggQmFsbCkKICAgICAgICAgICAgICAgIC8vIFJvdGF0ZSB0b3dhcmRzIGNhbWVyYS9haW0gZGlyZWN0aW9uCiAgICAgICAgICAgICAgICBjb25zdCBjYW0gPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhOwogICAgICAgICAgICAgICAgaWYgKGNhbSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpciA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICAgICAgICAgICAgICAgICAgY2FtLmdldFdvcmxkRGlyZWN0aW9uKGRpcik7CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0WWF3ID0gTWF0aC5hdGFuMihkaXIueCwgZGlyLnopOwogICAgICAgICAgICAgICAgICAgIHNob3VsZFVwZGF0ZVlhdyA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIElmIHdlIHNob3VsZCB1cGRhdGUsIGRvIHNvLiBPdGhlcndpc2Uga2VlcCBsYXN0IHZhbGlkIHlhdwogICAgICAgICAgICBpZiAoc2hvdWxkVXBkYXRlWWF3KSB7CiAgICAgICAgICAgICAgICB0aGlzLmxhc3RWYWxpZFlhdyA9IHRhcmdldFlhdzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRhcmdldFlhdyA9IHRoaXMubGFzdFZhbGlkWWF3OwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBTbW9vdGggWWF3IHdpdGggd3JhcC1hcm91bmQgaGFuZGxpbmcKICAgICAgICAgICAgbGV0IGRpZmYgPSB0YXJnZXRZYXcgLSB0aGlzLmN1cnJlbnRZYXc7CiAgICAgICAgICAgIHdoaWxlIChkaWZmID4gTWF0aC5QSSkgZGlmZiAtPSBNYXRoLlBJICogMjsKICAgICAgICAgICAgd2hpbGUgKGRpZmYgPCAtTWF0aC5QSSkgZGlmZiArPSBNYXRoLlBJICogMjsKCiAgICAgICAgICAgIGNvbnN0IHNwZWVkUmF0aW8gPSBNYXRoLm1pbigxLjAsIHRoaXMudmVsb2NpdHkubGVuZ3RoKCkgLyB0aGlzLm1heFNwZWVkKTsKICAgICAgICAgICAgY29uc3QgdHVyblNwZWVkID0gVEhSRUUuTWF0aFV0aWxzLmxlcnAoMTIuMCwgNi4wLCBzcGVlZFJhdGlvKTsKCiAgICAgICAgICAgIC8vIFByZXZlbnQgc3VkZGVuIHNuYXBzIHdoZW4gZGlmZiBpcyB2ZXJ5IGxhcmdlICh0ZWxlcG9ydC9yZXNldCBzY2VuYXJpb3MpCiAgICAgICAgICAgIGNvbnN0IG1heFlhd0NoYW5nZSA9IE1hdGguUEkgKiBkdCAqIHR1cm5TcGVlZDsKICAgICAgICAgICAgY29uc3QgeWF3Q2hhbmdlID0gTWF0aC5tYXgoLW1heFlhd0NoYW5nZSwgTWF0aC5taW4obWF4WWF3Q2hhbmdlLCBkaWZmICogZHQgKiB0dXJuU3BlZWQpKTsKCiAgICAgICAgICAgIHRoaXMuY3VycmVudFlhdyArPSB5YXdDaGFuZ2U7CiAgICAgICAgICAgIHRoaXMudGFyZ2V0WWF3ID0gdGFyZ2V0WWF3OwoKICAgICAgICAgICAgLy8gQmFua2luZwogICAgICAgICAgICBjb25zdCBiYW5rU2Vuc2l0aXZpdHkgPSAwLjg7CiAgICAgICAgICAgIGNvbnN0IG1heEJhbmsgPSAwLjc1OwoKICAgICAgICAgICAgbGV0IHRhcmdldEJhbmsgPSAtZGlmZiAqIGJhbmtTZW5zaXRpdml0eTsKICAgICAgICAgICAgdGFyZ2V0QmFuayA9IE1hdGgubWF4KC1tYXhCYW5rLCBNYXRoLm1pbihtYXhCYW5rLCB0YXJnZXRCYW5rKSk7CgogICAgICAgICAgICBjb25zdCBiYW5rTGVycCA9IDEuMCAtIE1hdGgucG93KDAuMDIsIGR0KTsKICAgICAgICAgICAgdGhpcy5iYW5raW5nQW1vdW50ICs9ICh0YXJnZXRCYW5rIC0gdGhpcy5iYW5raW5nQW1vdW50KSAqIGJhbmtMZXJwOwoKICAgICAgICAgICAgLy8gUGl0Y2gKICAgICAgICAgICAgY29uc3QgcGl0Y2hTZW5zaXRpdml0eSA9IDAuMTsKICAgICAgICAgICAgY29uc3QgbWF4UGl0Y2ggPSAxLjA7CgogICAgICAgICAgICBsZXQgdGFyZ2V0UGl0Y2ggPSAtdGhpcy52ZWxvY2l0eS55ICogcGl0Y2hTZW5zaXRpdml0eTsKICAgICAgICAgICAgdGFyZ2V0UGl0Y2ggPSBNYXRoLm1heCgtbWF4UGl0Y2gsIE1hdGgubWluKG1heFBpdGNoLCB0YXJnZXRQaXRjaCkpOwoKICAgICAgICAgICAgY29uc3QgcGl0Y2hMZXJwID0gMS4wIC0gTWF0aC5wb3coMC4wNSwgZHQpOwogICAgICAgICAgICB0aGlzLnBpdGNoQW1vdW50ICs9ICh0YXJnZXRQaXRjaCAtIHRoaXMucGl0Y2hBbW91bnQpICogcGl0Y2hMZXJwOwoKICAgICAgICAgICAgLy8gQXBwbHkgUm90YXRpb24KICAgICAgICAgICAgY29uc3QgZmluYWxZYXcgPSB0aGlzLmN1cnJlbnRZYXcgKyB0aGlzLnJvdGF0aW9uT2Zmc2V0OwoKICAgICAgICAgICAgdGhpcy5tZXNoLnF1YXRlcm5pb24uc2V0RnJvbUF4aXNBbmdsZShfcEF4aXNZLCBmaW5hbFlhdyk7CgogICAgICAgICAgICBfcFF1YXQuc2V0RnJvbUF4aXNBbmdsZShuZXcgVEhSRUUuVmVjdG9yMygxLCAwLCAwKSwgdGhpcy5waXRjaEFtb3VudCk7CiAgICAgICAgICAgIHRoaXMubWVzaC5xdWF0ZXJuaW9uLm11bHRpcGx5KF9wUXVhdCk7CgogICAgICAgICAgICBfcFF1YXQuc2V0RnJvbUF4aXNBbmdsZShuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAxKSwgdGhpcy5iYW5raW5nQW1vdW50KTsKICAgICAgICAgICAgdGhpcy5tZXNoLnF1YXRlcm5pb24ubXVsdGlwbHkoX3BRdWF0KTsKCiAgICAgICAgICAgIC8vIElkbGUgQm9iCiAgICAgICAgICAgIGlmICh2ZWxMZW5TcSA8IDAuMSAmJiAhdGhpcy5pc0VuZ2FnZWQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRpbWUgPSBEYXRlLm5vdygpICogMC4wMDE1OwogICAgICAgICAgICAgICAgY29uc3QgYm9iUGl0Y2ggPSBNYXRoLnNpbih0aW1lKSAqIDAuMDM7CiAgICAgICAgICAgICAgICBjb25zdCBib2JSb2xsID0gTWF0aC5jb3ModGltZSAqIDAuNykgKiAwLjAyOwoKICAgICAgICAgICAgICAgIF9wUXVhdC5zZXRGcm9tRXVsZXIobmV3IFRIUkVFLkV1bGVyKGJvYlBpdGNoLCAwLCBib2JSb2xsKSk7CiAgICAgICAgICAgICAgICB0aGlzLm1lc2gucXVhdGVybmlvbi5tdWx0aXBseShfcFF1YXQpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKX2NoZWNrVGFja2xlUHJlc3N1cmUoZHQpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLmhhc0JhbGwpIHsKICAgICAgICAgICAgICAgIHRoaXMuaXNFbmdhZ2VkID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLmVuY291bnRlclRpbWVyID0gMDsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMuaW1tdW5pdHlUaW1lciA+IDApIHJldHVybjsKICAgICAgICAgICAgaWYgKHRoaXMuaXNEYXNoaW5nKSByZXR1cm47CgogICAgICAgICAgICBjb25zdCBnYW1lID0gd2luZG93LmZsdXguZ2FtZUluc3RhbmNlOwogICAgICAgICAgICBpZiAoIWdhbWUgfHwgIXRoaXMudGVhbSkgcmV0dXJuOwoKICAgICAgICAgICAgY29uc3Qgb3Bwb25lbnRUZWFtSWQgPSB0aGlzLnRlYW0uaWQgPT09ICdob21lJyA/ICdhd2F5JyA6ICdob21lJzsKICAgICAgICAgICAgY29uc3Qgb3Bwb25lbnRUZWFtID0gZ2FtZS50ZWFtc1tvcHBvbmVudFRlYW1JZF07CgogICAgICAgICAgICBpZiAoIW9wcG9uZW50VGVhbSkgcmV0dXJuOwoKICAgICAgICAgICAgbGV0IGVuZ2FnZWRUaGlzRnJhbWUgPSBmYWxzZTsKICAgICAgICAgICAgY29uc3QgZWZmZWN0aXZlUmFkaXVzID0gdGhpcy5pc0VuZ2FnZWQgPyB0aGlzLnRhY2tsZVJhZGl1cyAqIDEuMiA6IHRoaXMudGFja2xlUmFkaXVzOwoKICAgICAgICAgICAgLy8gMS4gQ2hlY2sgRW5nYWdlbWVudCBTdGF0dXMKICAgICAgICAgICAgZm9yIChjb25zdCBlbnRpdHkgb2Ygb3Bwb25lbnRUZWFtLnBsYXllcnMpIHsKICAgICAgICAgICAgICAgIGlmICghZW50aXR5Lm1lc2ggfHwgZW50aXR5LnN0YXR1cy5uYXAgPiAwIHx8IGVudGl0eS5zdHVuVGltZXIgPiAwKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGNvbnN0IGRpc3QgPSB0aGlzLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyhlbnRpdHkubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICBpZiAoZGlzdCA8IGVmZmVjdGl2ZVJhZGl1cykgewogICAgICAgICAgICAgICAgICAgIGVuZ2FnZWRUaGlzRnJhbWUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOyAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMi4gVXBkYXRlIFRpbWVyICYgVUkgRmVlZGJhY2sKICAgICAgICAgICAgaWYgKGVuZ2FnZWRUaGlzRnJhbWUpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc0VuZ2FnZWQpIHsKICAgICAgICAgICAgICAgICAgICAvLyBKdXN0IGJlY2FtZSBlbmdhZ2VkCiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbmNvdW50ZXJUaW1lciA9IDA7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudGVhbS5pc0h1bWFuICYmIHRoaXMudGVhbS5hY3RpdmVQbGF5ZXIgPT09IHRoaXMgJiYgZ2FtZS5mbG9hdGluZ1RleHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5mbG9hdGluZ1RleHQuc3Bhd24oIkVOR0FHRUQhIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAiY29taWMtYWN0aW9uIik7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhpbnQgZm9yIHRoZSBwbGF5ZXIKICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0VuZ2FnZWQgJiYgdGhpcy5oYXNCYWxsICYmIGdhbWUuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5mbG9hdGluZ1RleHQuc3Bhd24oIkJSRUFLIE5PVyEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJ0ZWNoIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDIwMCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5lbmNvdW50ZXJUaW1lciArPSBkdDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuZW5jb3VudGVyVGltZXIgPSAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmlzRW5nYWdlZCA9IGVuZ2FnZWRUaGlzRnJhbWU7CgogICAgICAgICAgICAvLyAzLiBBcHBseSBEYW1hZ2UgKFdpdGggR3JhY2UgUGVyaW9kKQogICAgICAgICAgICAvLyBHcmFjZSBQZXJpb2Q6IDAuNXMgYmVmb3JlIGRhbWFnZSBzdGFydHMgdGlja2luZwogICAgICAgICAgICBpZiAodGhpcy5pc0VuZ2FnZWQgJiYgdGhpcy5lbmNvdW50ZXJUaW1lciA+IDAuNSkgewogICAgICAgICAgICAgICAgZm9yIChjb25zdCBlbnRpdHkgb2Ygb3Bwb25lbnRUZWFtLnBsYXllcnMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIWVudGl0eS5tZXNoIHx8IGVudGl0eS5zdGF0dXMubmFwID4gMCB8fCBlbnRpdHkuc3R1blRpbWVyID4gMCkgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlzdCA9IHRoaXMubWVzaC5wb3NpdGlvbi5kaXN0YW5jZVRvKGVudGl0eS5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZGlzdCA8IGVmZmVjdGl2ZVJhZGl1cykgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBEaXNjcmV0ZSBDbGFzaCBFdmVudAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW50aXR5LmNsYXNoQ29vbGRvd24gPD0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVzb2x2ZUNsYXNoKGVudGl0eSwgZ2FtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRpdHkuY2xhc2hDb29sZG93biA9IDIuMDsgLy8gSW5jcmVhc2VkIGNvb2xkb3duICh3YXMgMS41KSB0byByZWR1Y2Ugc3BhbQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50RU4gPD0gMCkgewogICAgICAgICAgICAgICAgdGhpcy5mdW1ibGUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCl9yZXNvbHZlQ2xhc2gob3Bwb25lbnQsIGdhbWUpIHsKICAgICAgICAgICAgY29uc3Qgb3BwQVQgPSBvcHBvbmVudC5nZXRTdGF0KCdBVCcpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVmFyaWFuY2U6IDAuOCB0byAxLjIKICAgICAgICAgICAgY29uc3QgdmFyaWFuY2UgPSAwLjggKyBNYXRoLnJhbmRvbSgpICogMC40OwogICAgICAgICAgICBsZXQgZGFtYWdlID0gTWF0aC5mbG9vcihvcHBBVCAqIHZhcmlhbmNlKTsKICAgICAgICAgICAgaWYgKGRhbWFnZSA8IDEpIGRhbWFnZSA9IDE7CgogICAgICAgICAgICAvLyBEaXJlY3Rpb25hbCBTaGllbGRpbmcKICAgICAgICAgICAgLy8gQ2FycmllciBGb3J3YXJkCiAgICAgICAgICAgIF9wVmVjLmNvcHkoX3BBeGlzWikuYXBwbHlRdWF0ZXJuaW9uKHRoaXMubWVzaC5xdWF0ZXJuaW9uKTsgCiAgICAgICAgICAgIC8vIFZlY3RvciBUbyBPcHBvbmVudAogICAgICAgICAgICBjb25zdCB0b09wcCA9IG9wcG9uZW50Lm1lc2gucG9zaXRpb24uY2xvbmUoKS5zdWIodGhpcy5tZXNoLnBvc2l0aW9uKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGRvdCA9IF9wVmVjLmRvdCh0b09wcCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBJZiBvcHBvbmVudCBpcyBCRUhJTkQgKGRvdCA8IC0wLjIpLCBkYW1hZ2UgaXMgcmVkdWNlZCAoU2hpZWxkaW5nKS4KICAgICAgICAgICAgbGV0IGlzU2hpZWxkZWQgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKGRvdCA8IC0wLjIpIHsKICAgICAgICAgICAgICAgIGRhbWFnZSA9IE1hdGguZmxvb3IoZGFtYWdlICogMC41KTsKICAgICAgICAgICAgICAgIGlzU2hpZWxkZWQgPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBBcHBseSBEYW1hZ2UKICAgICAgICAgICAgdGhpcy5jdXJyZW50RU4gLT0gZGFtYWdlOwogICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50RU4gPCAwKSB0aGlzLmN1cnJlbnRFTiA9IDA7CgogICAgICAgICAgICAvLyBUZWNoIEVmZmVjdHMKICAgICAgICAgICAgaWYgKG9wcG9uZW50LnRlY2hzLnRhY2tsZSkgewogICAgICAgICAgICAgICAgaWYgKG9wcG9uZW50LnRlY2hzLnRhY2tsZSA9PT0gJ3Zlbm9tJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwbHlTdGF0dXMoJ3Zlbm9tJywgMTAuMCk7CiAgICAgICAgICAgICAgICAgICAgZGFtYWdlICs9IDM7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9wcG9uZW50LnRlY2hzLnRhY2tsZSA9PT0gJ3dpdGhlcicpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGF0cyA9IFsnUEEnLCAnU0gnLCAnQVQnLCAnRU4nXTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXQgPSBzdGF0c1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBzdGF0cy5sZW5ndGgpXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGx5U3RhdHVzKCd3aXRoZXInLCAxMC4wLCB0YXJnZXQpOwogICAgICAgICAgICAgICAgICAgIGRhbWFnZSArPSAzOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvcHBvbmVudC50ZWNocy50YWNrbGUgPT09ICdkcmFpbicpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRzLkhQIC09IGRhbWFnZTsgCiAgICAgICAgICAgICAgICAgICAgb3Bwb25lbnQuc3RhdHMuSFAgKz0gZGFtYWdlOwogICAgICAgICAgICAgICAgICAgIGlmIChnYW1lLmZsb2F0aW5nVGV4dCkgZ2FtZS5mbG9hdGluZ1RleHQuc3Bhd24oIkRSQUlOIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAiaGVhbCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBWaXN1YWxzIC0gSlVJQ0VEIFVQCiAgICAgICAgICAgIGNvbnN0IG1pZFBvcyA9IHRoaXMubWVzaC5wb3NpdGlvbi5jbG9uZSgpLmxlcnAob3Bwb25lbnQubWVzaC5wb3NpdGlvbiwgMC41KTsKICAgICAgICAgICAgbWlkUG9zLnkgKz0gMS41OwoKICAgICAgICAgICAgaWYgKGdhbWUuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICBpZiAoaXNTaGllbGRlZCkgewogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2FtZS5mbG9hdGluZ1RleHQpIGdhbWUuZmxvYXRpbmdUZXh0LnNwYXduKCJTSElFTEQiLCB0aGlzLm1lc2gucG9zaXRpb24sICJibG9jayIpOwogICAgICAgICAgICAgICAgICAgIH0sIDEwMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIERhbWFnZSBmZWVkYmFjawogICAgICAgICAgICAgICAgZ2FtZS5mbG9hdGluZ1RleHQuc3Bhd24oYCR7ZGFtYWdlfWAsIHRoaXMubWVzaC5wb3NpdGlvbiwgImRhbWFnZSIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZ2FtZS5wYXJ0aWNsZU1hbmFnZXIpIHsKICAgICAgICAgICAgICAgIC8vIE1hc3NpdmUgSW1wYWN0IEp1aWNlCiAgICAgICAgICAgICAgICBnYW1lLnBhcnRpY2xlTWFuYWdlci5zcGF3bignc2hvY2t3YXZlJywgbWlkUG9zLCB7IHNjYWxlOiAzLjAsIGxpZmU6IDAuNCB9KTsKICAgICAgICAgICAgICAgIGdhbWUucGFydGljbGVNYW5hZ2VyLnNwYXduKCdmbGFzaCcsIG1pZFBvcywgeyBzY2FsZTogNC4wIH0pOwogICAgICAgICAgICAgICAgLy8gRGVicmlzIHNob3dlcgogICAgICAgICAgICAgICAgZm9yKGxldCBpPTA7IGk8NjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgZ2FtZS5wYXJ0aWNsZU1hbmFnZXIuc3Bhd24oJ2RlYnJpcycsIG1pZFBvcywgeyBzY2FsZTogMC40IH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZ2FtZS5jYW1lcmFNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICAvLyBIRVJDVUxFQU4gU0hBS0UKICAgICAgICAgICAgICAgIGdhbWUuY2FtZXJhTWFuYWdlci5hZGRTaGFrZSgyLjUpOyAvLyBJbmNyZWFzZWQgZnJvbSAxLjIKICAgICAgICAgICAgICAgIGdhbWUuY2FtZXJhTWFuYWdlci5hZGRGb3ZJbXB1bHNlKC01KTsgLy8gWm9vbSBpbiBpbXBhY3QKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGdhbWUudHJpZ2dlckltcGFjdCkgewogICAgICAgICAgICAgICAgLy8gRnJlZXplIGZyYW1lCiAgICAgICAgICAgICAgICBnYW1lLnRyaWdnZXJJbXBhY3QoMC4xNSwgJ2hlYXZ5Jyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG9wcG9uZW50LmdhaW5FeHAoMik7CiAgICAgICAgfQoKICAgICAgICBfcGVyZm9ybUplY2h0S25vY2tiYWNrKCkgewogICAgICAgICAgICBpZiAoIXRoaXMudGVhbSkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBnYW1lID0gd2luZG93LmZsdXguZ2FtZUluc3RhbmNlOwogICAgICAgICAgICBjb25zdCBvcHBvbmVudFRlYW1JZCA9IHRoaXMudGVhbS5pZCA9PT0gJ2hvbWUnID8gJ2F3YXknIDogJ2hvbWUnOwogICAgICAgICAgICBjb25zdCBvcHBvbmVudFRlYW0gPSBnYW1lLnRlYW1zW29wcG9uZW50VGVhbUlkXTsKCiAgICAgICAgICAgIGlmICghb3Bwb25lbnRUZWFtKSByZXR1cm47CgogICAgICAgICAgICBjb25zdCByYW5nZSA9IDYuMDsKICAgICAgICAgICAgY29uc3QgZm9yY2UgPSAyNS4wOwoKICAgICAgICAgICAgaWYgKGdhbWUuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICBnYW1lLmZsb2F0aW5nVGV4dC5zcGF3bigiSkVDSFQgU0hPVCEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJnb2FsIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG9wcG9uZW50VGVhbS5wbGF5ZXJzLmZvckVhY2gocCA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIXAubWVzaCkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgZGlzdCA9IHRoaXMubWVzaC5wb3NpdGlvbi5kaXN0YW5jZVRvKHAubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICBpZiAoZGlzdCA8IHJhbmdlKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlyID0gcC5tZXNoLnBvc2l0aW9uLmNsb25lKCkuc3ViKHRoaXMubWVzaC5wb3NpdGlvbikubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICAgICAgZGlyLnkgPSAwLjU7CiAgICAgICAgICAgICAgICAgICAgZGlyLm5vcm1hbGl6ZSgpOwoKICAgICAgICAgICAgICAgICAgICBwLnZlbG9jaXR5LmFkZChkaXIubXVsdGlwbHlTY2FsYXIoZm9yY2UpKTsKCiAgICAgICAgICAgICAgICAgICAgcC5pc0Rhc2hpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBjb25zdCByZWFjdEFjdGlvbiA9IHAuYWN0aW9ucyAmJiBwLmFjdGlvbnNbJ3JlYWN0J107CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlYWN0QWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWN0QWN0aW9uLnNldExvb3AoVEhSRUUuTG9vcE9uY2UpOwogICAgICAgICAgICAgICAgICAgICAgICByZWFjdEFjdGlvbi5jbGFtcFdoZW5GaW5pc2hlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIHAucGxheSgncmVhY3QnLCAwLjEpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHAucGxheSgnY2F0Y2gnLCAwLjUpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKGdhbWUuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuZmxvYXRpbmdUZXh0LnNwYXduKCJTTUFDSyEiLCBwLm1lc2gucG9zaXRpb24sICJkYW1hZ2UiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGdhbWUudHJpZ2dlckltcGFjdCkgZ2FtZS50cmlnZ2VySW1wYWN0KDAuMTUsICdzaGF0dGVyJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgZnVtYmxlKCkgewogICAgICAgICAgICBjb25zb2xlLmxvZygiRlVNQkxFISBFTiBEZXBsZXRlZC4iKTsKICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQgJiYgdGhpcy5tZXNoKSB7CiAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJDUkFTSCEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJjb21pYy1pbXBhY3QiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5zdHVuVGltZXIgPSAxLjU7CgogICAgICAgICAgICBjb25zdCBiYWNrRGlyID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMSkuYXBwbHlRdWF0ZXJuaW9uKHRoaXMubWVzaC5xdWF0ZXJuaW9uKS5ub3JtYWxpemUoKS5uZWdhdGUoKTsKICAgICAgICAgICAgYmFja0Rpci54ICs9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDAuNTsKICAgICAgICAgICAgYmFja0Rpci56ICs9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDAuNTsKICAgICAgICAgICAgYmFja0Rpci5ub3JtYWxpemUoKTsKCiAgICAgICAgICAgIHRoaXMudmVsb2NpdHkuYWRkKGJhY2tEaXIubXVsdGlwbHlTY2FsYXIoMTIuMCkpOwoKICAgICAgICAgICAgaWYgKHRoaXMuaGFzQmFsbCkgewogICAgICAgICAgICAgICAgY29uc3QgYmFsbCA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5lbnRpdGllcy5iYWxsOwogICAgICAgICAgICAgICAgaWYgKGJhbGwpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBlamVjdERpciA9IG5ldyBUSFJFRS5WZWN0b3IzKE1hdGgucmFuZG9tKCktMC41LCAwLjgsIE1hdGgucmFuZG9tKCktMC41KS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgICAgICBiYWxsLnNob290KGVqZWN0RGlyLCA2LjAsICdub25lJyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb3NlQmFsbCgpOwp0aGlzLmxvc2VCYWxsKCk7CgogICAgICAgICAgICAgICAgICAgIHRoaXMuY2F0Y2hDb29sZG93biA9IDEuNTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbkNhdGNoID0gZmFsc2U7CgogICAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudEVOID0gMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZGFzaCh4LCB6KSB7CiAgICAgICAgICAgIGlmICh0aGlzLmlzRGFzaGluZyB8fCB0aGlzLmRhc2hDb29sZG93biA+IDApIHJldHVybjsKICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzLm5hcCA+IDApIHJldHVybjsKCiAgICAgICAgICAgIC8vIE9GRkVOU0U6IEJSRUFLIFRBQ0tMRQogICAgICAgICAgICBpZiAodGhpcy5oYXNCYWxsICYmIHRoaXMuaXNFbmdhZ2VkKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjb3N0ID0gMTU7CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudEVOIDwgY29zdCkgewogICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIkZBSUxFRCEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJkYW1hZ2UiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5mdW1ibGUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50RU4gLT0gY29zdDsKICAgICAgICAgICAgICAgIHRoaXMuaXNEYXNoaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMuZGFzaFRpbWUgPSAwLjQ7CiAgICAgICAgICAgICAgICB0aGlzLmRhc2hDb29sZG93biA9IDIuMDsKICAgICAgICAgICAgICAgIHRoaXMuZGFzaFR5cGUgPSAnYnJlYWsnOwoKICAgICAgICAgICAgICAgIGNvbnN0IGJ1cnN0RGlyID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMSkuYXBwbHlRdWF0ZXJuaW9uKHRoaXMubWVzaC5xdWF0ZXJuaW9uKTsKICAgICAgICAgICAgICAgIHRoaXMudmVsb2NpdHkuYWRkKGJ1cnN0RGlyLm11bHRpcGx5U2NhbGFyKDE1LjApKTsKCiAgICAgICAgICAgICAgICBjb25zdCBnYW1lID0gd2luZG93LmZsdXguZ2FtZUluc3RhbmNlOwogICAgICAgICAgICAgICAgY29uc3Qgb3Bwb25lbnRUZWFtSWQgPSB0aGlzLnRlYW0uaWQgPT09ICdob21lJyA/ICdhd2F5JyA6ICdob21lJzsKICAgICAgICAgICAgICAgIGNvbnN0IG9wcG9uZW50VGVhbSA9IGdhbWUudGVhbXNbb3Bwb25lbnRUZWFtSWRdOwoKICAgICAgICAgICAgICAgIG9wcG9uZW50VGVhbS5wbGF5ZXJzLmZvckVhY2gocCA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFwLm1lc2gpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gdGhpcy5tZXNoLnBvc2l0aW9uLmRpc3RhbmNlVG8ocC5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZGlzdCA8IHRoaXMudGFja2xlUmFkaXVzICogMS41KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHB1c2hEaXIgPSBwLm1lc2gucG9zaXRpb24uY2xvbmUoKS5zdWIodGhpcy5tZXNoLnBvc2l0aW9uKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcHVzaERpci55ID0gMC41OwogICAgICAgICAgICAgICAgICAgICAgICBwLnZlbG9jaXR5LmFkZChwdXNoRGlyLm11bHRpcGx5U2NhbGFyKDE1LjApKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHAuc3R1blRpbWVyID0gMi4wOwogICAgICAgICAgICAgICAgICAgICAgICBwLnBsYXkoJ2NhdGNoJywgMC4yKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnYW1lLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5mbG9hdGluZ1RleHQuc3Bhd24oIlNUVU4hIiwgcC5tZXNoLnBvc2l0aW9uLCAiZGFtYWdlIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCmlmIChnYW1lLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgIGdhbWUuZmxvYXRpbmdUZXh0LnNwYXduKCJCUkVBSyEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJ0ZWNoIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKLy8gTkVXOiBTcGF3biBCcmVhayBHbHlwaCAoRXhwbG9zaXZlIEJ1cnN0KQogICAgICAgICAgICAgICAgaWYgKGdhbWUuZ2x5cGhNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICAgICAgZ2FtZS5nbHlwaE1hbmFnZXIuc3Bhd24oJ3N0YXR1cycsIHRoaXMubWVzaC5wb3NpdGlvbiwgewogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQ6IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGxpZmU6IDAuNSwKICAgICAgICAgICAgICAgICAgICAgICAgcm90YXRpb25TcGVlZDogOC4wLAogICAgICAgICAgICAgICAgICAgICAgICBzY2FsZVNwZWVkOiAzLjAsCiAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldFk6IDAuNQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCi8vIFBhcnRpY2xlIEJ1cnN0IChCcmVhayBUYWNrbGUpCiAgICAgICAgICAgICAgICBpZiAoZ2FtZS5wYXJ0aWNsZU1hbmFnZXIpIHsKICAgICAgICAgICAgICAgICAgICBnYW1lLnBhcnRpY2xlTWFuYWdlci5zcGF3bignc2hvY2t3YXZlJywgdGhpcy5tZXNoLnBvc2l0aW9uLCB7IHNjYWxlOiAyLjAsIGxpZmU6IDAuMyB9KTsKICAgICAgICAgICAgICAgICAgICBnYW1lLnBhcnRpY2xlTWFuYWdlci5zcGF3bignZmxhc2gnLCB0aGlzLm1lc2gucG9zaXRpb24sIHsgc2NhbGU6IDIuNSB9KTsKICAgICAgICAgICAgICAgICAgICAvLyBCdWJibGUgQnVyc3QKICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTwzMDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJQb3MgPSB0aGlzLm1lc2gucG9zaXRpb24uY2xvbmUoKS5hZGQobmV3IFRIUkVFLlZlY3RvcjMoKE1hdGgucmFuZG9tKCktMC41KSwgMS4wKyhNYXRoLnJhbmRvbSgpLTAuNSksIChNYXRoLnJhbmRvbSgpLTAuNSkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5wYXJ0aWNsZU1hbmFnZXIuc3Bhd24oJ2J1YmJsZScsIGJQb3MsIHsgc2NhbGU6IDAuMiArIE1hdGgucmFuZG9tKCkgKiAwLjQgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChnYW1lLnRyaWdnZXJJbXBhY3QpIGdhbWUudHJpZ2dlckltcGFjdCgwLjE1LCAnaGVhdnknKTsKCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIE9GRkVOU0U6IFNQUklOVAogICAgICAgICAgICBpZiAodGhpcy5oYXNCYWxsKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjb3N0ID0gNTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRFTiA8IGNvc3QpIHsKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJOTyBFTiEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJkYW1hZ2UiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudEVOIC09IGNvc3Q7CiAgICAgICAgICAgICAgICB0aGlzLmlzRGFzaGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLmRhc2hUaW1lID0gMC40OwogICAgICAgICAgICAgICAgdGhpcy5kYXNoQ29vbGRvd24gPSAxLjU7CiAgICAgICAgICAgICAgICB0aGlzLmRhc2hUeXBlID0gJ3NwcmludCc7CgogICAgICAgICAgICAgICAgY29uc3QgYnVyc3REaXIgPSB0aGlzLnZlbG9jaXR5LmNsb25lKCkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICBpZiAoYnVyc3REaXIubGVuZ3RoU3EoKSA8IDAuMSkgYnVyc3REaXIuc2V0KDAsIDAsIDEpLmFwcGx5UXVhdGVybmlvbih0aGlzLm1lc2gucXVhdGVybmlvbik7CgogICAgICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS5hZGQoYnVyc3REaXIubXVsdGlwbHlTY2FsYXIoMTUuMCkpOwoKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhTWFuYWdlcikgewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5jYW1lcmFNYW5hZ2VyLmFkZEZvdkltcHVsc2UoMjApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJEQVNIISIsIHRoaXMubWVzaC5wb3NpdGlvbiwgInRlY2giKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gREVGRU5TRTogQkxPQ0sgLyBUQUNLTEUKICAgICAgICAgICAgY29uc3QgYmFsbCA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5lbnRpdGllcy5iYWxsOwogICAgICAgICAgICBsZXQgaXNCbG9ja0NvbnRleHQgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKGJhbGwgJiYgYmFsbC5tZXNoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gdGhpcy5tZXNoLnBvc2l0aW9uLmRpc3RhbmNlVG8oYmFsbC5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgIGlmIChkaXN0IDwgOC4wICYmIGJhbGwubWVzaC5wb3NpdGlvbi55ID4gMi41KSB7CiAgICAgICAgICAgICAgICAgICAgaXNCbG9ja0NvbnRleHQgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmlzRGFzaGluZyA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuZGFzaFRpbWUgPSB0aGlzLmRhc2hUb3RhbFRpbWU7CiAgICAgICAgICAgIHRoaXMuZGFzaENvb2xkb3duID0gMS41OwoKICAgICAgICAgICAgY29uc3QgbGVuID0gTWF0aC5zcXJ0KHgqeCArIHoqeik7CiAgICAgICAgICAgIGNvbnN0IG54ID0gKGxlbiA+IDApID8geC9sZW4gOiAwOwogICAgICAgICAgICBjb25zdCBueiA9IChsZW4gPiAwKSA/IHovbGVuIDogMDsKCmlmIChsZW4gPiAwKSB7CiAgICAgICAgICAgICAgICBsZXQgdGFyZ2V0QW5nbGUgPSBNYXRoLmF0YW4yKG54LCBueik7CiAgICAgICAgICAgICAgICB0YXJnZXRBbmdsZSArPSB0aGlzLnJvdGF0aW9uT2Zmc2V0OwogICAgICAgICAgICAgICAgdGhpcy5tZXNoLnF1YXRlcm5pb24uc2V0RnJvbUF4aXNBbmdsZShfcEF4aXNZLCB0YXJnZXRBbmdsZSk7CiAgICAgICAgICAgICAgICB0aGlzLnN5bmNSb3RhdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChpc0Jsb2NrQ29udGV4dCkgewogICAgICAgICAgICAgICAgdGhpcy5kYXNoVHlwZSA9ICd2ZXJ0aWNhbCc7CgogICAgICAgICAgICAgICAgY29uc3QgZGlyVG9CYWxsID0gYmFsbC5tZXNoLnBvc2l0aW9uLmNsb25lKCkuc3ViKHRoaXMubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICBkaXJUb0JhbGwueSA9IDA7CgogICAgICAgICAgICAgICAgaWYgKGRpclRvQmFsbC5sZW5ndGhTcSgpID4gMC4wMSkgewogICAgICAgICAgICAgICAgICAgIGRpclRvQmFsbC5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmRhc2hWZWMuY29weShkaXJUb0JhbGwpLm11bHRpcGx5U2NhbGFyKDguMCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuZGFzaFZlYy5zZXQoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29uc3QgY2F0Y2hBY3Rpb24gPSB0aGlzLmFjdGlvbnNbJ2NhdGNoJ107CiAgICAgICAgICAgICAgICBpZiAoY2F0Y2hBY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICBjYXRjaEFjdGlvbi5zZXRMb29wKFRIUkVFLkxvb3BPbmNlKTsKICAgICAgICAgICAgICAgICAgICBjYXRjaEFjdGlvbi5jbGFtcFdoZW5GaW5pc2hlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgY2F0Y2hBY3Rpb24udGltZVNjYWxlID0gMS41OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5wbGF5KCdjYXRjaCcsIDAuMSk7CgogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJCTE9DSyEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJkZWZhdWx0Iik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5kYXNoVHlwZSA9ICdob3Jpem9udGFsJzsKICAgICAgICAgICAgICAgIHRoaXMuX2hhc0hpdFRhY2tsZSA9IGZhbHNlOwoKICAgICAgICAgICAgICAgIC8vIEFwcGx5IHZlbG9jaXR5IGltcHVsc2UgaW4gZGFzaCBkaXJlY3Rpb24KICAgICAgICAgICAgICAgIGNvbnN0IGRhc2hEaXIgPSBuZXcgVEhSRUUuVmVjdG9yMyhueCwgMCwgbnopOwogICAgICAgICAgICAgICAgaWYgKGRhc2hEaXIubGVuZ3RoU3EoKSA8IDAuMSkgewogICAgICAgICAgICAgICAgICAgIGRhc2hEaXIuc2V0KDAsIDAsIDEpLmFwcGx5UXVhdGVybmlvbih0aGlzLm1lc2gucXVhdGVybmlvbik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5LmFkZChkYXNoRGlyLm11bHRpcGx5U2NhbGFyKDIwLjApKTsKCiAgICAgICAgICAgICAgICBjb25zdCBsdW5nZUFjdGlvbiA9IHRoaXMuYWN0aW9uc1sndGhyb3cnXTsKICAgICAgICAgICAgICAgIGlmIChsdW5nZUFjdGlvbikgewogICAgICAgICAgICAgICAgICAgIGx1bmdlQWN0aW9uLnNldExvb3AoVEhSRUUuTG9vcE9uY2UpOwogICAgICAgICAgICAgICAgICAgIGx1bmdlQWN0aW9uLmNsYW1wV2hlbkZpbmlzaGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBsdW5nZUFjdGlvbi50aW1lU2NhbGUgPSAyLjA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLnBsYXkoJ3Rocm93JywgMC4xKTsKCiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLnRyaWdnZXJJbXBhY3QpIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS50cmlnZ2VySW1wYWN0KDAuMDUsICdkZWZhdWx0Jyk7CiAgICAgICAgICAgIH0KCmlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhTWFuYWdlcikgewogICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmNhbWVyYU1hbmFnZXIuYWRkRm92SW1wdWxzZSgxMCk7CiAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhTWFuYWdlci5hZGRTaGFrZSgwLjMpOyAvLyBBZGQgc2hha2Ugb24gZGFzaCBzdGFydAogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBfY3JlYXRlSFBCYXIoKSB7CiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IG5ldyBUSFJFRS5Hcm91cCgpOwoKICAgICAgICAgICAgY29uc3QgYmdHZW8gPSBuZXcgVEhSRUUuUGxhbmVHZW9tZXRyeSgxLjIsIDAuMTUpOwogICAgICAgICAgICBjb25zdCBiZ01hdCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7IGNvbG9yOiAweDAwMDAwMCwgc2lkZTogVEhSRUUuRG91YmxlU2lkZSwgZGVwdGhUZXN0OiBmYWxzZSB9KTsKICAgICAgICAgICAgY29uc3QgYmcgPSBuZXcgVEhSRUUuTWVzaChiZ0dlbywgYmdNYXQpOwogICAgICAgICAgICBjb250YWluZXIuYWRkKGJnKTsKCiAgICAgICAgICAgIGNvbnN0IGZpbGxHZW8gPSBuZXcgVEhSRUUuUGxhbmVHZW9tZXRyeSgxLjE2LCAwLjExKTsKICAgICAgICAgICAgZmlsbEdlby50cmFuc2xhdGUoMC41OCwgMCwgMCk7CiAgICAgICAgICAgIGNvbnN0IGZpbGxNYXQgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyBjb2xvcjogMHgwMGZmMDAsIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGUsIGRlcHRoVGVzdDogZmFsc2UgfSk7CiAgICAgICAgICAgIHRoaXMuaHBCYXJGaWxsID0gbmV3IFRIUkVFLk1lc2goZmlsbEdlbywgZmlsbE1hdCk7CiAgICAgICAgICAgIHRoaXMuaHBCYXJGaWxsLnBvc2l0aW9uLnNldCgtMC41OCwgMCwgMC4wMSk7CiAgICAgICAgICAgIGNvbnRhaW5lci5hZGQodGhpcy5ocEJhckZpbGwpOwoKICAgICAgICAgICAgdGhpcy5ocEJhciA9IGNvbnRhaW5lcjsKICAgICAgICAgICAgdGhpcy5zY2VuZS5hZGQodGhpcy5ocEJhcik7CiAgICAgICAgfQoKICAgICAgICBfdXBkYXRlSFBCYXIoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5ocEJhciB8fCAhdGhpcy5tZXNoKSByZXR1cm47CgogICAgICAgICAgICB0aGlzLmhwQmFyLnBvc2l0aW9uLmNvcHkodGhpcy5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgdGhpcy5ocEJhci5wb3NpdGlvbi55ICs9IDIuMjsKCiAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UgJiYgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmNhbWVyYSkgewogICAgICAgICAgICAgICAgdGhpcy5ocEJhci5sb29rQXQod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmNhbWVyYS5wb3NpdGlvbik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IHBjdCA9IE1hdGgubWF4KDAsIHRoaXMuc3RhdHMuSFAgLyB0aGlzLnN0YXRzLm1heEhQKTsKICAgICAgICAgICAgdGhpcy5ocEJhckZpbGwuc2NhbGUuc2V0WChwY3QpOwoKICAgICAgICAgICAgaWYgKHBjdCA+IDAuNSkgdGhpcy5ocEJhckZpbGwubWF0ZXJpYWwuY29sb3Iuc2V0SGV4KDB4MDBmZjAwKTsKICAgICAgICAgICAgZWxzZSBpZiAocGN0ID4gMC4yNSkgdGhpcy5ocEJhckZpbGwubWF0ZXJpYWwuY29sb3Iuc2V0SGV4KDB4ZmZmZjAwKTsKICAgICAgICAgICAgZWxzZSB0aGlzLmhwQmFyRmlsbC5tYXRlcmlhbC5jb2xvci5zZXRIZXgoMHhmZjAwMDApOwoKICAgICAgICAgICAgdGhpcy5ocEJhci52aXNpYmxlID0gKHBjdCA8IDAuOTgpOwogICAgICAgIH0KCiAgICAgICAgZ2FpbkV4cChhbW91bnQpIHsKICAgICAgICAgICAgaWYgKCF3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UgfHwgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLnN0YXRlICE9PSAnYWN0aXZlJykgcmV0dXJuOwoKICAgICAgICAgICAgdGhpcy5leHAgKz0gYW1vdW50OwoKICAgICAgICAgICAgaWYgKHRoaXMuZXhwID49IHRoaXMubmV4dExldmVsRXhwKSB7CiAgICAgICAgICAgICAgICB0aGlzLmxldmVsVXAoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgbGV2ZWxVcCgpIHsKICAgICAgICAgICAgdGhpcy5sZXZlbCsrOwogICAgICAgICAgICB0aGlzLmV4cCAtPSB0aGlzLm5leHRMZXZlbEV4cDsKICAgICAgICAgICAgdGhpcy5uZXh0TGV2ZWxFeHAgPSBNYXRoLmZsb29yKHRoaXMubmV4dExldmVsRXhwICogMS41KTsKCiAgICAgICAgICAgIGNvbnN0IGtleXMgPSBbJ0hQJywgJ0VOJywgJ0FUJywgJ1BBJywgJ0JMJywgJ1NIJywgJ0NBJywgJ1NQJ107CgogICAgICAgICAgICBjb25zdCBocEdhaW4gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyMCkgKyAxMDsKICAgICAgICAgICAgdGhpcy5zdGF0cy5tYXhIUCArPSBocEdhaW47CiAgICAgICAgICAgIHRoaXMuc3RhdHMuSFAgPSB0aGlzLnN0YXRzLm1heEhQOwoKICAgICAgICAgICAga2V5cy5mb3JFYWNoKGsgPT4gewogICAgICAgICAgICAgICAgaWYgKGsgPT09ICdIUCcpIHJldHVybjsKICAgICAgICAgICAgICAgIGlmIChNYXRoLnJhbmRvbSgpID4gMC40KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZ2FpbiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpICsgMTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRzW2tdICs9IGdhaW47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgdGhpcy5fdXBkYXRlRGVyaXZlZFN0YXRzKCk7CgogICAgICAgICAgICBjb25zb2xlLmxvZyhgJHt0aGlzLnJvbGV9IHJlYWNoZWQgTGV2ZWwgJHt0aGlzLmxldmVsfSFgKTsKCiAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0ICYmIHRoaXMubWVzaCkgewogICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dC5zcGF3bigiTEVWRUwgVVAhIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAidGVjaCIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBfY2hlY2tUYWNrbGVDb2xsaXNpb24oKSB7CiAgICAgICAgICAgIGlmICghdGhpcy50ZWFtIHx8IHRoaXMuX2hhc0hpdFRhY2tsZSkgcmV0dXJuOwoKICAgICAgICAgICAgY29uc3QgZ2FtZSA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZTsKICAgICAgICAgICAgaWYgKCFnYW1lKSByZXR1cm47CgogICAgICAgICAgICBjb25zdCBvcHBvbmVudFRlYW1JZCA9IHRoaXMudGVhbS5pZCA9PT0gJ2hvbWUnID8gJ2F3YXknIDogJ2hvbWUnOwogICAgICAgICAgICBjb25zdCBvcHBvbmVudFRlYW0gPSBnYW1lLnRlYW1zW29wcG9uZW50VGVhbUlkXTsKCiAgICAgICAgICAgIGZvciAoY29uc3Qgb3BwIG9mIG9wcG9uZW50VGVhbS5wbGF5ZXJzKSB7CiAgICAgICAgICAgICAgICBpZiAoIW9wcC5tZXNoKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGNvbnN0IGRpc3QgPSB0aGlzLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyhvcHAubWVzaC5wb3NpdGlvbik7CgppZiAoZGlzdCA8IDMuMCkgeyAvLyBJbmNyZWFzZWQgZnJvbSAyLjAgZm9yIGVhc2llciBoaXRzCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVzb2x2ZVRhY2tsZUhpdChvcHApOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2hhc0hpdFRhY2tsZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBfcmVzb2x2ZVRhY2tsZUhpdChvcHApIHsKICAgICAgICAgICAgdGhpcy5pc0Rhc2hpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS5tdWx0aXBseVNjYWxhcigtMC41KTsKICAgICAgICAgICAgdGhpcy5wbGF5KCdpZGxlJywgMC4yKTsKCiAgICAgICAgICAgIGNvbnN0IGF0ID0gdGhpcy5nZXRTdGF0KCdBVCcpOwogICAgICAgICAgICBsZXQgZGFtYWdlID0gYXQgKiAzLjA7CgogICAgICAgICAgICBpZiAodGhpcy50ZWNocy50YWNrbGUgPT09ICd2ZW5vbScpIHsKICAgICAgICAgICAgICAgIG9wcC5hcHBseVN0YXR1cygndmVub20nLCAxMC4wKTsKICAgICAgICAgICAgICAgIGRhbWFnZSArPSA1OwogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMudGVjaHMudGFja2xlID09PSAnd2l0aGVyJykgewogICAgICAgICAgICAgICAgb3BwLmFwcGx5U3RhdHVzKCd3aXRoZXInLCAxMC4wLCAnRU4nKTsKICAgICAgICAgICAgICAgIGRhbWFnZSArPSA1OwogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMudGVjaHMudGFja2xlID09PSAnZHJhaW4nKSB7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXRzLkhQICs9IDIwOwogICAgICAgICAgICAgICAgb3BwLnN0YXRzLkhQIC09IDIwOwogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQpCiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dC5zcGF3bigiRFJBSU4iLCB0aGlzLm1lc2gucG9zaXRpb24sICJoZWFsIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChvcHAuaGFzQmFsbCkgewogICAgICAgICAgICAgICAgb3BwLmN1cnJlbnRFTiAtPSBkYW1hZ2U7CgppZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZWQgIkVOIiBzdWZmaXggZm9yIGNsZWFuZXIgbG9vawogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oYCR7TWF0aC5mbG9vcihkYW1hZ2UpfWAsIG9wcC5tZXNoLnBvc2l0aW9uLCAiZGFtYWdlIik7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dC5zcGF3bigiQkFNISIsIG9wcC5tZXNoLnBvc2l0aW9uLCAiY29taWMtaW1wYWN0Iik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKG9wcC5jdXJyZW50RU4gPD0gMCkgewogICAgICAgICAgICAgICAgICAgIG9wcC5mdW1ibGUoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgb3BwLnN0dW5UaW1lciA9IDAuNTsKICAgICAgICAgICAgICAgICAgICBvcHAucGxheSgncmVhY3QnLCAwLjEpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0aGlzLnRlY2hzLnRhY2tsZSAmJiB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UudHJpZ2dlclRlY2hFdmVudCkgewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS50cmlnZ2VyVGVjaEV2ZW50KHRoaXMsIHRoaXMudGVjaHMudGFja2xlKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBvcHAuc3R1blRpbWVyID0gMS4wOwogICAgICAgICAgICAgICAgb3BwLnBsYXkoJ3JlYWN0JywgMC4xKTsKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dC5zcGF3bigiU01BQ0shIiwgb3BwLm1lc2gucG9zaXRpb24sICJjb21pYy1pbXBhY3QiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgcHVzaERpciA9IG9wcC5tZXNoLnBvc2l0aW9uLmNsb25lKCkuc3ViKHRoaXMubWVzaC5wb3NpdGlvbikubm9ybWFsaXplKCk7CiAgICAgICAgICAgIHB1c2hEaXIueSA9IDAuMjsKICAgICAgICAgICAgb3BwLnZlbG9jaXR5LmFkZChwdXNoRGlyLm11bHRpcGx5U2NhbGFyKDEyLjApKTsKCiAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UudHJpZ2dlckltcGFjdCkgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLnRyaWdnZXJJbXBhY3QoMC4xLCAnaGVhdnknKTsKICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5jYW1lcmFNYW5hZ2VyKSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhTWFuYWdlci5hZGRTaGFrZSgwLjgpOwogICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLnNwYXduQ2xhc2gpIHsKY29uc3QgbWlkID0gdGhpcy5tZXNoLnBvc2l0aW9uLmNsb25lKCkuYWRkKG9wcC5tZXNoLnBvc2l0aW9uKS5tdWx0aXBseVNjYWxhcigwLjUpOwogICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLnNwYXduQ2xhc2gobWlkKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKLy8gQnViYmxlIEJ1cnN0IChUYWNrbGUgSGl0KQogICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLnBhcnRpY2xlTWFuYWdlcikgewogICAgICAgICAgICAgICAgY29uc3QgbWlkID0gdGhpcy5tZXNoLnBvc2l0aW9uLmNsb25lKCkubGVycChvcHAubWVzaC5wb3NpdGlvbiwgMC41KTsKICAgICAgICAgICAgICAgIG1pZC55ICs9IDEuMDsKICAgICAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpPDMwOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBidWJibGVQb3MgPSBtaWQuY2xvbmUoKS5hZGQobmV3IFRIUkVFLlZlY3RvcjMoKE1hdGgucmFuZG9tKCktMC41KSoxLjUsIChNYXRoLnJhbmRvbSgpLTAuNSkqMS41LCAoTWF0aC5yYW5kb20oKS0wLjUpKjEuNSkpOwogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5wYXJ0aWNsZU1hbmFnZXIuc3Bhd24oJ2J1YmJsZScsIGJ1YmJsZVBvcywgeyBzY2FsZTogMC4xNSArIE1hdGgucmFuZG9tKCkgKiAwLjM1IH0pOwogICAgICAgICAgICAgICAgfQp9CiAgICAgICAgfQogICAgICAgIF9hcHBseUdvYWxDcmVhc2UoZHQpIHsKICAgICAgICAgICAgaWYgKHRoaXMucm9sZSA9PT0gJ0dMJykgcmV0dXJuOwoKICAgICAgICAgICAgY29uc3QgZ29hbHMgPSBbCiAgICAgICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAyOCksCiAgICAgICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAtMjgpCiAgICAgICAgICAgIF07CiAgICAgICAgICAgIGNvbnN0IHJhZGl1cyA9IDEwLjA7CgogICAgICAgICAgICBnb2Fscy5mb3JFYWNoKGdvYWwgPT4gewogICAgICAgICAgICAgICAgY29uc3QgZHggPSB0aGlzLm1lc2gucG9zaXRpb24ueCAtIGdvYWwueDsKICAgICAgICAgICAgICAgIGNvbnN0IGR6ID0gdGhpcy5tZXNoLnBvc2l0aW9uLnogLSBnb2FsLno7CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0U3EgPSBkeCpkeCArIGR6KmR6OwoKICAgICAgICAgICAgICAgIGlmIChkaXN0U3EgPCByYWRpdXMgKiByYWRpdXMpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gTWF0aC5zcXJ0KGRpc3RTcSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHVzaFggPSBkaXN0ID4gMCA/IGR4IC8gZGlzdCA6IDE7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHVzaFogPSBkaXN0ID4gMCA/IGR6IC8gZGlzdCA6IDA7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGZvcmNlID0gNTAuMDsKICAgICAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5LnggKz0gcHVzaFggKiBmb3JjZSAqIGR0OwogICAgICAgICAgICAgICAgICAgIHRoaXMudmVsb2NpdHkueiArPSBwdXNoWiAqIGZvcmNlICogZHQ7CgogICAgICAgICAgICAgICAgICAgIGlmIChkaXN0IDwgcmFkaXVzIC0gMC41KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNsYW1wUmF0aW8gPSByYWRpdXMgLyAoZGlzdCArIDAuMDAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNoLnBvc2l0aW9uLnggPSBnb2FsLnggKyBkeCAqIGNsYW1wUmF0aW87CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi56ID0gZ29hbC56ICsgZHogKiBjbGFtcFJhdGlvOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQoKICAgIHdpbmRvdy5mbHV4LlBsYXllciA9IFBsYXllcjsKfSkoKTsK","./Player.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCi8vIFJldXNhYmxlIG1hdGggb2JqZWN0cwogICAgY29uc3QgX3BWZWMgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgY29uc3QgX3BRdWF0ID0gbmV3IFRIUkVFLlF1YXRlcm5pb24oKTsKICAgIGNvbnN0IF9wVGFyZ2V0UXVhdCA9IG5ldyBUSFJFRS5RdWF0ZXJuaW9uKCk7CmNvbnN0IF9wQXhpc1kgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAxLCAwKTsKICAgIGNvbnN0IF9wQXhpc1ogPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAxKTsKCmNsYXNzIFBsYXllciB7CiAgICAgICAgY29uc3RydWN0b3Ioc2NlbmUsIHJvbGUgPSAnTUYnKSB7CiAgICAgICAgICAgIHRoaXMuc2NlbmUgPSBzY2VuZTsKICAgICAgICAgICAgdGhpcy5yb2xlID0gcm9sZTsKICAgICAgICAgICAgdGhpcy50ZWFtID0gbnVsbDsgLy8gQXNzaWduZWQgYnkgVGVhbS5hZGRQbGF5ZXIKICAgICAgICAgICAgdGhpcy5ob21lUG9zaXRpb24gPSBuZXcgVEhSRUUuVmVjdG9yMygpOwoKICAgICAgICAgICAgdGhpcy5tZXNoID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5taXhlciA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuYWN0aW9ucyA9IHt9OwogICAgICAgICAgICB0aGlzLmFjdGl2ZUFjdGlvbiA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSAnaWRsZSc7CiAgICAgICAgICAgIHRoaXMuaW5wdXRWZWN0b3IgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAwKTsKCiAgICAgICAgICAgIC8vIFBoeXNpY3MgKERyaWZ0L0luZXJ0aWEgTW9kZWwpCiAgICAgICAgICAgIHRoaXMudmVsb2NpdHkgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAwKTsKICAgICAgICAgICAgdGhpcy5hY2NlbGVyYXRpb24gPSAxMi4wOwogICAgICAgICAgICB0aGlzLmRyYWcgPSAzLjA7CiAgICAgICAgICAgIHRoaXMubWF4U3BlZWQgPSA4LjA7CiAgICAgICAgICAgIC8vIEJvbmUgcmVmZXJlbmNlIGZvciBob2xkaW5nIGJhbGwKICAgICAgICAgICAgdGhpcy5oYW5kQm9uZSA9IG51bGw7CnRoaXMuY2FuQ2F0Y2ggPSB0cnVlOwogICAgICAgICAgICB0aGlzLmNhdGNoQ29vbGRvd24gPSAwOyAvLyBSZXBsYWNlcyBzZXRUaW1lb3V0IGZvciBzYWZldHkKCiAgICAgICAgICAgIC8vIEJsaXR6YmFsbCBTdGF0cwogICAgICAgICAgICB0aGlzLnN0YXRzID0gewogICAgICAgICAgICAgICAgSFA6IDEwMCwKICAgICAgICAgICAgICAgIG1heEhQOiAxMDAsCiAgICAgICAgICAgICAgICBFTjogMzAsCiAgICAgICAgICAgICAgICBBVDogMTAsCiAgICAgICAgICAgICAgICBQQTogMTUsCiAgICAgICAgICAgICAgICBCTDogMTAsCiAgICAgICAgICAgICAgICBTSDogMTUsCiAgICAgICAgICAgICAgICBDQTogMTAsCiAgICAgICAgICAgICAgICBTUDogNjAKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8vIExldmVsaW5nIFN5c3RlbQogICAgICAgICAgICB0aGlzLmxldmVsID0gMTsKICAgICAgICAgICAgdGhpcy5leHAgPSAwOwogICAgICAgICAgICB0aGlzLm5leHRMZXZlbEV4cCA9IDEwMDsKCiAgICAgICAgICAgIC8vIFN0YXR1cyBFZmZlY3RzICYgVGVjaG5pcXVlcwogICAgICAgICAgICB0aGlzLnN0YXR1cyA9IHsKICAgICAgICAgICAgICAgIHZlbm9tOiAwLAogICAgICAgICAgICAgICAgbmFwOiAwLAogICAgICAgICAgICAgICAgd2l0aGVyOiB7IFBBOiAwLCBTSDogMCwgQVQ6IDAsIEJMOiAwLCBDQTogMCwgU1A6IDAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgdGhpcy5tYXJraW5nID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5sZWFybmVkVGVjaHMgPSBbXTsKCiAgICAgICAgICAgIHRoaXMudGVjaHMgPSB7CiAgICAgICAgICAgICAgICB0YWNrbGU6IG51bGwsCiAgICAgICAgICAgICAgICBzaG9vdDogbnVsbCwKICAgICAgICAgICAgICAgIHBhc3M6IG51bGwsCiAgICAgICAgICAgICAgICBwYXNzaXZlOiBudWxsCiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBWaXN1YWxzCiAgICAgICAgICAgIHRoaXMuYmFzZUNvbG9ySGV4ID0gMHhmZmZmZmY7CiAgICAgICAgICAgIHRoaXMub3JpZ2luYWxNYXRlcmlhbHMgPSBbXTsKICAgICAgICAgICAgdGhpcy5hdXJhTWVzaCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMucm90YXRpb25PZmZzZXQgPSAwOwp0aGlzLmJhc2VTY2FsZSA9IDEuMTc7IC8vIEluY3JlYXNlZCB+OCUKCiAgICAgICAgICAgIC8vIFJlYWwtdGltZSBTdGF0cwogICAgICAgICAgICB0aGlzLmN1cnJlbnRFTiA9IHRoaXMuc3RhdHMuRU47CnRoaXMudGFja2xlUmFkaXVzID0gMi4wOyAvLyBSZWR1Y2VkIGZyb20gMi41IHRvIHJlZHVjZSBzd2FybSBsb2NrCgogICAgICAgICAgICB0aGlzLnNwZWVkID0gNC4wOwogICAgICAgICAgICB0aGlzLl91cGRhdGVEZXJpdmVkU3RhdHMoKTsKCiAgICAgICAgICAgIHRoaXMuaGFzQmFsbCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmlzVGhyb3dpbmcgPSBmYWxzZTsKCiAgICAgICAgICAgIC8vIERhc2ggU3RhdGUKICAgICAgICAgICAgdGhpcy5pc0Rhc2hpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5kYXNoVGltZSA9IDA7CiAgICAgICAgICAgIHRoaXMuZGFzaFRvdGFsVGltZSA9IDAuNTsKICAgICAgICAgICAgdGhpcy5kYXNoQ29vbGRvd24gPSAwOwp0aGlzLmRhc2hDb29sZG93biA9IDA7CiAgICAgICAgICAgIHRoaXMuY2xhc2hDb29sZG93biA9IDA7IC8vIENvb2xkb3duIGZvciBpbmZsaWN0aW5nIHRhY2tsZXMKICAgICAgICAgICAgdGhpcy5kYXNoVmVjID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKCiAgICAgICAgICAgIC8vIEZlZWRiYWNrIEFjY3VtdWxhdG9ycwogICAgICAgICAgICB0aGlzLl9hY2N1bXVsYXRlZERhbWFnZSA9IDA7CiAgICAgICAgICAgIHRoaXMuX2RhbWFnZVRpbWVyID0gMDsKCiAgICAgICAgICAgIC8vIEhQIEJhcgogICAgICAgICAgICB0aGlzLmhwQmFyID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5ocEJhckZpbGwgPSBudWxsOwoKICAgICAgICAgICAgLy8gR2FtZXBsYXkgRmxvdyBUaW1lcnMKICAgICAgICAgICAgdGhpcy5zdHVuVGltZXIgPSAwOwogICAgICAgICAgICB0aGlzLmltbXVuaXR5VGltZXIgPSAwOwoKICAgICAgICAgICAgLy8gQmFua2luZyAmIFZlcnRpY2FsaXR5CiAgICAgICAgICAgIHRoaXMuYmFua2luZ0Ftb3VudCA9IDA7CiAgICAgICAgICAgIHRoaXMudGFyZ2V0WSA9IDA7CgogICAgICAgICAgICAvLyBFbmNvdW50ZXIgU3lzdGVtCiAgICAgICAgICAgIHRoaXMuaXNFbmdhZ2VkID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuY2xhc2hUaW1lciA9IDA7CnRoaXMuY2xhc2hUaW1lciA9IDA7CiAgICAgICAgICAgIHRoaXMuZW5jb3VudGVyVGltZXIgPSAwOyAvLyBUcmFjayBkdXJhdGlvbiBvZiBjdXJyZW50IGVuZ2FnZW1lbnQKICAgICAgICAgICAgLy8gQ2hhcmdlIE1lY2hhbmljCiAgICAgICAgICAgIHRoaXMuaXNDaGFyZ2luZyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmNoYXJnZVRpbWUgPSAwOwogICAgICAgICAgICB0aGlzLm1heENoYXJnZVRpbWUgPSAxLjU7CgogICAgICAgICAgICAvLyBGSVhFRDogSW1wcm92ZWQgUm90YXRpb24gU3RhdGUgd2l0aCBoeXN0ZXJlc2lzCiAgICAgICAgICAgIHRoaXMuY3VycmVudFlhdyA9IDA7CiAgICAgICAgICAgIHRoaXMudGFyZ2V0WWF3ID0gMDsKICAgICAgICAgICAgdGhpcy5sYXN0VmFsaWRZYXcgPSAwOyAvLyBTdG9yZSBsYXN0IGtub3duIGdvb2QgeWF3IGZvciBkZWFkem9uZSBoYW5kbGluZwogICAgICAgICAgICB0aGlzLnBpdGNoQW1vdW50ID0gMDsKICAgICAgICAgICAgdGhpcy5iYW5raW5nQW1vdW50ID0gMDsKICAgICAgICAgICAgdGhpcy5mYWNpbmdEZWFkem9uZSA9IDAuMzsgLy8gTWluaW11bSBpbnB1dC92ZWxvY2l0eSBtYWduaXR1ZGUgdG8gdXBkYXRlIGZhY2luZwoKICAgICAgICAgICAgLy8gUGFydGljbGUgRW1pc3Npb24gVGltZXJzCiAgICAgICAgICAgIHRoaXMuX3BhcnRpY2xlVGltZXJzID0gewogICAgICAgICAgICAgICAgdmVub206IDAsCiAgICAgICAgICAgICAgICBuYXA6IDAsCiAgICAgICAgICAgICAgICB3aXRoZXI6IDAKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8vIERldlRvb2xzIEZsYWdzCiAgICAgICAgICAgIHRoaXMuaXNHb2RNb2RlID0gZmFsc2U7CgogICAgICAgICAgICAvLyBQYXNzIFRhcmdldCBJbmRpY2F0b3IKLy8gUGFzcyBUYXJnZXQgSW5kaWNhdG9yCiAgICAgICAgICAgIHRoaXMucGFzc1RhcmdldEluZGljYXRvciA9IG51bGw7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBCdWJibGUgVHJhaWwgVGltZXIKICAgICAgICAgICAgdGhpcy5fYnViYmxlVGltZXIgPSAwOwp0aGlzLl9idWJibGVUaW1lciA9IDA7CiAgICAgICAgfQogICAgICAgIHN5bmNSb3RhdGlvbigpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLm1lc2gpIHJldHVybjsKICAgICAgICAgICAgY29uc3QgZXVsZXIgPSBuZXcgVEhSRUUuRXVsZXIoKS5zZXRGcm9tUXVhdGVybmlvbih0aGlzLm1lc2gucXVhdGVybmlvbiwgJ1lYWicpOwogICAgICAgICAgICB0aGlzLmN1cnJlbnRZYXcgPSBldWxlci55IC0gdGhpcy5yb3RhdGlvbk9mZnNldDsKICAgICAgICAgICAgdGhpcy50YXJnZXRZYXcgPSB0aGlzLmN1cnJlbnRZYXc7CiAgICAgICAgICAgIHRoaXMubGFzdFZhbGlkWWF3ID0gdGhpcy5jdXJyZW50WWF3OwogICAgICAgICAgICB0aGlzLmJhbmtpbmdBbW91bnQgPSAwOwogICAgICAgICAgICB0aGlzLnBpdGNoQW1vdW50ID0gMDsKICAgICAgICB9CgogICAgICAgIGdldFN0YXQobmFtZSkgewogICAgICAgICAgICBsZXQgdmFsID0gdGhpcy5zdGF0c1tuYW1lXTsKICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzLndpdGhlcltuYW1lXSA+IDApIHsKICAgICAgICAgICAgICAgIHZhbCAqPSAwLjU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgICB9CgogICAgICAgIGFwcGx5U3RhdHVzKHR5cGUsIGR1cmF0aW9uLCBzdWJUeXBlID0gbnVsbCkgewogICAgICAgICAgICBpZiAodHlwZSA9PT0gJ3Zlbm9tJykgewogICAgICAgICAgICAgICAgY29uc3Qgd2FzQWN0aXZlID0gdGhpcy5zdGF0dXMudmVub20gPiAxLjA7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXR1cy52ZW5vbSA9IE1hdGgubWF4KHRoaXMuc3RhdHVzLnZlbm9tLCBkdXJhdGlvbik7CgogICAgICAgICAgICAgICAgaWYgKCF3YXNBY3RpdmUpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgJHt0aGlzLnJvbGV9IHBvaXNvbmVkIWApOwogICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0KQogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJQT0lTT04iLCB0aGlzLm1lc2gucG9zaXRpb24sICJzdGF0dXMiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnbmFwJykgewogICAgICAgICAgICAgICAgY29uc3Qgd2FzQWN0aXZlID0gdGhpcy5zdGF0dXMubmFwID4gMS4wOwogICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMubmFwID0gTWF0aC5tYXgodGhpcy5zdGF0dXMubmFwLCBkdXJhdGlvbik7CgogICAgICAgICAgICAgICAgaWYgKCF3YXNBY3RpdmUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5oYXNCYWxsKSB0aGlzLmZ1bWJsZSgpOwogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAke3RoaXMucm9sZX0gZmVsbCBhc2xlZXAhYCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQpCiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIlNMRUVQIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAic3RhdHVzIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ3dpdGhlcicgJiYgc3ViVHlwZSkgewogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFZhbCA9IHRoaXMuc3RhdHVzLndpdGhlcltzdWJUeXBlXSB8fCAwOwogICAgICAgICAgICAgICAgY29uc3Qgd2FzQWN0aXZlID0gY3VycmVudFZhbCA+IDEuMDsKICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzLndpdGhlcltzdWJUeXBlXSA9IE1hdGgubWF4KGN1cnJlbnRWYWwsIGR1cmF0aW9uKTsKCiAgICAgICAgICAgICAgICBpZiAoIXdhc0FjdGl2ZSkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAke3RoaXMucm9sZX0gd2l0aGVyZWQgJHtzdWJUeXBlfSFgKTsKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dC5zcGF3bihgV0lUSEVSICR7c3ViVHlwZX1gLCB0aGlzLm1lc2gucG9zaXRpb24sICJzdGF0dXMiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX3VwZGF0ZURlcml2ZWRTdGF0cygpIHsKICAgICAgICAgICAgY29uc3Qgc3AgPSB0aGlzLmdldFN0YXQoJ1NQJyk7CiAgICAgICAgICAgIHRoaXMubWF4U3BlZWQgPSA1LjAgKyAoc3AgLyAxNS4wKTsKICAgICAgICAgICAgdGhpcy5jdXJyZW50RU4gPSB0aGlzLmdldFN0YXQoJ0VOJyk7CiAgICAgICAgfQoKc2V0TWVzaChzb3VyY2VNZXNoLCBhbmltYXRpb25zKSB7CiAgICAgICAgICAgIHRoaXMubWVzaCA9IHNvdXJjZU1lc2g7CiAgICAgICAgICAgIHRoaXMuc2NlbmUuYWRkKHRoaXMubWVzaCk7CiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUhQQmFyKCk7CiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUF1cmEoKTsKICAgICAgICAgICAgdGhpcy5fY3JlYXRlUGFzc1RhcmdldEluZGljYXRvcigpOwoKICAgICAgICAgICAgLy8gQ3VzdG9tIENoYXJhY3RlciBTY2FsaW5nCiAgICAgICAgICAgIGlmICh0aGlzLmNoYXJhY3Rlck5hbWUpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoYXJhY3Rlck5hbWUuaW5jbHVkZXMoJ1RpZHVzJykpIHRoaXMuYmFzZVNjYWxlID0gMS42OwogICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5jaGFyYWN0ZXJOYW1lLmluY2x1ZGVzKCdXYWtrYScpKSB0aGlzLmJhc2VTY2FsZSA9IDEuNDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5tZXNoLnNjYWxlLnNldFNjYWxhcih0aGlzLmJhc2VTY2FsZSk7CgogICAgICAgICAgICB0aGlzLm1lc2gudHJhdmVyc2UoKG5vZGUpID0+IHsKICAgICAgICAgICAgICAgIGlmIChub2RlLmlzTWVzaCAmJiBub2RlLm1hdGVyaWFsKSB7CmNvbnN0IGNvbnZlcnRPbmUgPSAobWF0KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG0gPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwOiBtYXQubWFwIHx8IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogbmV3IFRIUkVFLkNvbG9yKDB4ZmZmZmZmKSwgLy8gRk9SQ0UgV0hJVEU6IElnbm9yZSBzb3VyY2UgY29sb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zcGFyZW50OiAhIW1hdC50cmFuc3BhcmVudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IChtYXQub3BhY2l0eSAhPT0gdW5kZWZpbmVkID8gbWF0Lm9wYWNpdHkgOiAxKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFscGhhVGVzdDogKG1hdC5hbHBoYVRlc3QgIT09IHVuZGVmaW5lZCA/IG1hdC5hbHBoYVRlc3QgOiAwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZGU6IG1hdC5zaWRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVwdGhUZXN0OiBtYXQuZGVwdGhUZXN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVwdGhXcml0ZTogbWF0LmRlcHRoV3JpdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb2c6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBza2lubmluZzogISFub2RlLmlzU2tpbm5lZE1lc2gKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3JpZ2luYWxNYXRlcmlhbHMucHVzaCh7IG1hdGVyaWFsOiBtLCBiYXNlQ29sb3I6IG0uY29sb3IuY2xvbmUoKSB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG07CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBub2RlLm1hdGVyaWFsID0gQXJyYXkuaXNBcnJheShub2RlLm1hdGVyaWFsKQogICAgICAgICAgICAgICAgICAgICAgICA/IG5vZGUubWF0ZXJpYWwubWFwKGNvbnZlcnRPbmUpCiAgICAgICAgICAgICAgICAgICAgICAgIDogY29udmVydE9uZShub2RlLm1hdGVyaWFsKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAobm9kZS5pc0JvbmUpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBuYW1lID0gbm9kZS5uYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKChuYW1lLmluY2x1ZGVzKCdoYW5kJykgJiYgbmFtZS5pbmNsdWRlcygncicpKSB8fCBuYW1lLmluY2x1ZGVzKCdyaWdodGhhbmQnKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRCb25lID0gbm9kZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgdGhpcy5taXhlciA9IG5ldyBUSFJFRS5BbmltYXRpb25NaXhlcih0aGlzLm1lc2gpOwoKICAgICAgICAgICAgaWYgKGFuaW1hdGlvbnMpIHsKICAgICAgICAgICAgICAgIGFuaW1hdGlvbnMuZm9yRWFjaCgoY2xpcCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBjbGlwLm5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICBsZXQgYWN0aW9uID0gdGhpcy5taXhlci5jbGlwQWN0aW9uKGNsaXApOwoKICAgICAgICAgICAgICAgICAgICBpZiAobmFtZS5pbmNsdWRlcygndHJlYWRpbmcnKSB8fCBuYW1lLmluY2x1ZGVzKCdpZGxlJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3Rpb25zWydpZGxlJ10gPSBhY3Rpb247CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuYW1lLmluY2x1ZGVzKCdzd2ltJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3Rpb25zWydzd2ltJ10gPSBhY3Rpb247CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuYW1lLmluY2x1ZGVzKCd0aHJvdycpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aW9uc1sndGhyb3cnXSA9IGFjdGlvbjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5hbWUuaW5jbHVkZXMoJ2NhdGNoJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3Rpb25zWydjYXRjaCddID0gYWN0aW9uOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobmFtZS5pbmNsdWRlcygncmVhY3QnKSB8fCBuYW1lLmluY2x1ZGVzKCdnZXRoaXQnKSB8fCBuYW1lLmluY2x1ZGVzKCdoaXQnKSB8fCBuYW1lLmluY2x1ZGVzKCdodXJ0JykgfHwgbmFtZS5pbmNsdWRlcygnZGFtYWdlJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3Rpb25zWydyZWFjdCddID0gYWN0aW9uOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aW9uc1tjbGlwLm5hbWVdID0gYWN0aW9uOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy5hY3Rpb25zWydpZGxlJ10pIHsKICAgICAgICAgICAgICAgIHRoaXMucGxheSgnaWRsZScpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgZmlyc3QgPSBPYmplY3QudmFsdWVzKHRoaXMuYWN0aW9ucylbMF07CiAgICAgICAgICAgICAgICBpZihmaXJzdCkgZmlyc3QucGxheSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwbGF5KGFjdGlvbk5hbWUsIGR1cmF0aW9uID0gMC41KSB7CiAgICAgICAgICAgIGNvbnN0IG5ld0FjdGlvbiA9IHRoaXMuYWN0aW9uc1thY3Rpb25OYW1lXTsKICAgICAgICAgICAgaWYgKCFuZXdBY3Rpb24gfHwgbmV3QWN0aW9uID09PSB0aGlzLmFjdGl2ZUFjdGlvbikgcmV0dXJuOwoKICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlQWN0aW9uKSB7CiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUFjdGlvbi5mYWRlT3V0KGR1cmF0aW9uKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbmV3QWN0aW9uLnJlc2V0KCk7CiAgICAgICAgICAgIG5ld0FjdGlvbi5mYWRlSW4oZHVyYXRpb24pOwogICAgICAgICAgICBuZXdBY3Rpb24ucGxheSgpOwogICAgICAgICAgICB0aGlzLmFjdGl2ZUFjdGlvbiA9IG5ld0FjdGlvbjsKICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IGFjdGlvbk5hbWU7CiAgICAgICAgfQoKICAgICAgICBzZXRJbnB1dCh4LCB6KSB7CiAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cy5uYXAgPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLmlucHV0VmVjdG9yLnNldCgwLCAwLCAwKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmlucHV0VmVjdG9yLnNldCh4LCAwLCB6KTsKICAgICAgICB9CgogICAgICAgIHJlY2VpdmVCYWxsKCkgewogICAgICAgICAgICB0aGlzLmNhbkNhdGNoID0gZmFsc2U7CgogICAgICAgICAgICBpZiAodGhpcy5zdGF0dXMubmFwID4gMCkgewogICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMubmFwID0gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5oYXNCYWxsID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5pbW11bml0eVRpbWVyID0gMi4wOwoKICAgICAgICAgICAgY29uc3QgYmFsbCA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5lbnRpdGllcy5iYWxsOwogICAgICAgICAgICBpZiAoYmFsbCAmJiBiYWxsLmxhc3RIb2xkZXIgJiYgYmFsbC5sYXN0SG9sZGVyLnRlYW0gPT09IHRoaXMudGVhbSAmJiBiYWxsLmxhc3RIb2xkZXIgIT09IHRoaXMpIHsKICAgICAgICAgICAgICAgIGJhbGwubGFzdEhvbGRlci5nYWluRXhwKDIpOwogICAgICAgICAgICAgICAgdGhpcy5nYWluRXhwKDEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCBjYXRjaEFjdGlvbiA9IHRoaXMuYWN0aW9uc1snY2F0Y2gnXTsKCiAgICAgICAgICAgIGlmIChjYXRjaEFjdGlvbikgewogICAgICAgICAgICAgICAgY2F0Y2hBY3Rpb24uc2V0TG9vcChUSFJFRS5Mb29wT25jZSk7CiAgICAgICAgICAgICAgICBjYXRjaEFjdGlvbi5jbGFtcFdoZW5GaW5pc2hlZCA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMucGxheSgnY2F0Y2gnLCAwLjEpOwoKICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQpIHsKICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIlNOQVAhIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAiY29taWMtYWN0aW9uIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRocm93QmFsbChiYWxsLCBmb3JjZWRUeXBlID0gbnVsbCwgcG93ZXJNdWx0aXBsaWVyID0gMS4wKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5oYXNCYWxsIHx8IHRoaXMuaXNUaHJvd2luZykgcmV0dXJuOwogICAgICAgICAgICBpZiAodGhpcy5zdGF0dXMubmFwID4gMCkgcmV0dXJuOwoKICAgICAgICAgICAgdGhpcy5pc1Rocm93aW5nID0gdHJ1ZTsKCiAgICAgICAgICAgIC8vIExvY2sgYWltIGRpcmVjdGlvbiBhdCBzdGFydCBvZiB0aHJvdwogICAgICAgICAgICB0aGlzLmxvY2tlZEFpbVZlY3RvciA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CgogICAgICAgICAgICBpZiAodGhpcy5pbnB1dFZlY3Rvci5sZW5ndGhTcSgpID4gMC4xKSB7CiAgICAgICAgICAgICAgICB0aGlzLmxvY2tlZEFpbVZlY3Rvci5jb3B5KHRoaXMuaW5wdXRWZWN0b3IpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5sb2NrZWRBaW1WZWN0b3Iuc2V0KDAsIDAsIDEpLmFwcGx5UXVhdGVybmlvbih0aGlzLm1lc2gucXVhdGVybmlvbikubm9ybWFsaXplKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IGdvYWxaID0gKHRoaXMudGVhbSAmJiB0aGlzLnRlYW0uc2lkZSA9PT0gMSkgPyAtMjggOiAyODsKICAgICAgICAgICAgY29uc3QgZGlzdFRvR29hbCA9IE1hdGguYWJzKHRoaXMubWVzaC5wb3NpdGlvbi56IC0gZ29hbFopOwoKICAgICAgICAgICAgbGV0IHR5cGUgPSBmb3JjZWRUeXBlOwogICAgICAgICAgICBpZiAoIXR5cGUpIHsKICAgICAgICAgICAgICAgIHR5cGUgPSAoZGlzdFRvR29hbCA8IDI1KSA/ICdTSCcgOiAnUEEnOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCBpc0ZpbmlzaGVyID0gKHR5cGUgPT09ICdTSCcgJiYgZGlzdFRvR29hbCA8IDEyLjApOwoKICAgICAgICAgICAgbGV0IHRlY2hOYW1lID0gKHR5cGUgPT09ICdTSCcpID8gdGhpcy50ZWNocy5zaG9vdCA6IHRoaXMudGVjaHMucGFzczsKCiAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cy52ZW5vbSA+IDAgJiYgdGVjaE5hbWUpIHsKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0KQogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIlNJTEVOQ0VEIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAic3RhdHVzIik7CiAgICAgICAgICAgICAgICB0ZWNoTmFtZSA9IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCB3aW5kdXBUaW1lID0gMTAwOwogICAgICAgICAgICBsZXQgYW5pbVNwZWVkID0gMS41OwoKICAgICAgICAgICAgaWYgKHBvd2VyTXVsdGlwbGllciA+IDEuMSkgewogICAgICAgICAgICAgICAgd2luZHVwVGltZSArPSAyMDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChpc0ZpbmlzaGVyICYmICF0ZWNoTmFtZSkgewogICAgICAgICAgICAgICAgd2luZHVwVGltZSA9IDUwOwogICAgICAgICAgICAgICAgYW5pbVNwZWVkID0gMy4wOwogICAgICAgICAgICB9CgppZiAodGVjaE5hbWUpIHsKICAgICAgICAgICAgICAgIHdpbmR1cFRpbWUgPSA0MDA7CiAgICAgICAgICAgICAgICBhbmltU3BlZWQgPSAwLjg7CgogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5jYW1lcmFNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmNhbWVyYU1hbmFnZXIucGxheUNpbmVtYXRpYyh0ZWNoTmFtZSwgdGhpcy5tZXNoLCAxLjIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuaW1tdW5pdHlUaW1lciA9IDEuNTsKCiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gdGVjaE5hbWUucmVwbGFjZSgnXycsICcgJykudG9VcHBlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKGxhYmVsLCB0aGlzLm1lc2gucG9zaXRpb24sICJ0ZWNoIik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gTkVXOiBTcGF3biBUZWNoIEdseXBoIChWZXJ0aWNhbCBDYXN0aW5nIENpcmNsZSkKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZ2x5cGhNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmdseXBoTWFuYWdlci5zcGF3bigndGVjaCcsIHRoaXMubWVzaC5wb3NpdGlvbiwgewogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQ6IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGxpZmU6IDEuMiwKICAgICAgICAgICAgICAgICAgICAgICAgcm90YXRpb25TcGVlZDogNC4wLAogICAgICAgICAgICAgICAgICAgICAgICBzY2FsZVNwZWVkOiAxLjUsCiAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldFk6IDEuMiwKICAgICAgICAgICAgICAgICAgICAgICAgZmFjZUNhbWVyYTogdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCB0aHJvd0FjdGlvbiA9IHRoaXMuYWN0aW9uc1sndGhyb3cnXTsKICAgICAgICAgICAgaWYgKHRocm93QWN0aW9uKSB7CiAgICAgICAgICAgICAgICB0aHJvd0FjdGlvbi5zZXRMb29wKFRIUkVFLkxvb3BPbmNlKTsKICAgICAgICAgICAgICAgIHRocm93QWN0aW9uLmNsYW1wV2hlbkZpbmlzaGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRocm93QWN0aW9uLnRpbWVTY2FsZSA9IGFuaW1TcGVlZDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnBsYXkoJ3Rocm93JywgMC4xKTsKCiAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0ICYmICF0ZWNoTmFtZSkgewogICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dC5zcGF3bigiV0hPT1NIIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAiY29taWMtYWN0aW9uIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKHRoaXMuaGFzQmFsbCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aHJvd0FjdGlvbikgdGhyb3dBY3Rpb24udGltZVNjYWxlID0gMS4wOwoKICAgICAgICAgICAgICAgICAgICBsZXQgZmluYWxEaXIgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgICAgICAgICAgICAgICAgIGxldCByZWZlcmVuY2VEaXIgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwoKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vdmVycmlkZUFpbVZlY3RvcikgewogICAgICAgICAgICAgICAgICAgICAgICBmaW5hbERpci5jb3B5KHRoaXMub3ZlcnJpZGVBaW1WZWN0b3IpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VEaXIuY29weShmaW5hbERpcik7CgogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXRBbmdsZSA9IE1hdGguYXRhbjIoZmluYWxEaXIueCwgZmluYWxEaXIueik7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpbmFsQW5nbGUgPSB0YXJnZXRBbmdsZSArIHRoaXMucm90YXRpb25PZmZzZXQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHEgPSBuZXcgVEhSRUUuUXVhdGVybmlvbigpLnNldEZyb21BeGlzQW5nbGUoX3BBeGlzWSwgZmluYWxBbmdsZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5xdWF0ZXJuaW9uLmNvcHkocSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3luY1JvdGF0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmluYWxEaXIuY29weSh0aGlzLmxvY2tlZEFpbVZlY3Rvcik7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZURpci5jb3B5KHRoaXMubG9ja2VkQWltVmVjdG9yKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNwaW4gPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAwKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5wdXRWZWN0b3IubGVuZ3RoU3EoKSA+IDAuMSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnB1dERpciA9IHRoaXMuaW5wdXRWZWN0b3IuY2xvbmUoKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3Jvc3NZID0gbmV3IFRIUkVFLlZlY3RvcjMoKS5jcm9zc1ZlY3RvcnMocmVmZXJlbmNlRGlyLCBpbnB1dERpcikueTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyhjcm9zc1kpID4gMC4xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGluLnNldCgwLCBjcm9zc1kgKiAxMi4wLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgbGV0IGJhc2VDb3N0ID0gKHR5cGUgPT09ICdTSCcpID8gMjAgOiAxMDsKICAgICAgICAgICAgICAgICAgICBsZXQgdGVjaENvc3QgPSAwOwogICAgICAgICAgICAgICAgICAgIGxldCB0ZWNoQm9udXMgPSAwOwogICAgICAgICAgICAgICAgICAgIGxldCB0ZWNoUGF5bG9hZCA9IG51bGw7CgogICAgICAgICAgICAgICAgICAgIGlmICh0ZWNoTmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHRlY2hOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICd2ZW5vbSc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaENvc3QgPSAodHlwZSA9PT0gJ1NIJyA/IDIwIDogMTApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlY2hCb251cyA9IDM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaFBheWxvYWQgPSB7IHR5cGU6ICd2ZW5vbScsIGxldmVsOiAxIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICd3aXRoZXInOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlY2hDb3N0ID0gKHR5cGUgPT09ICdTSCcgPyAyMCA6IDEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZWNoQm9udXMgPSAzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlY2hQYXlsb2FkID0geyB0eXBlOiAnd2l0aGVyJywgbGV2ZWw6IDEgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ25hcCc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaENvc3QgPSAodHlwZSA9PT0gJ1NIJyA/IDM1IDogMzApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlY2hCb251cyA9IDM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaFBheWxvYWQgPSB7IHR5cGU6ICduYXAnLCBsZXZlbDogMSB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnc3BoZXJlJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gJ1NIJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZWNoQ29zdCA9IDI1OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBybmcgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMSkgKyA1OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZWNoQm9udXMgPSBybmc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlY2hQYXlsb2FkID0geyB0eXBlOiAnc3BoZXJlJywgbGV2ZWw6IDEsIGJvbnVzOiBybmcgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKGBTUEhFUkUgKyR7cm5nfWAsIHRoaXMubWVzaC5wb3NpdGlvbiwgImdvYWwiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdqZWNodCc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdTSCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaENvc3QgPSA0MDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaEJvbnVzID0gNTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaFBheWxvYWQgPSB7IHR5cGU6ICdqZWNodCcsIGxldmVsOiAxIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3BlcmZvcm1KZWNodEtub2NrYmFjaygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2ludmlzaWJsZSc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdTSCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaENvc3QgPSAyNTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaEJvbnVzID0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaFBheWxvYWQgPSB7IHR5cGU6ICdpbnZpc2libGUnLCBsZXZlbDogMSB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY29uc3QgdG90YWxDb3N0ID0gYmFzZUNvc3QgKyB0ZWNoQ29zdDsKCiAgICAgICAgICAgICAgICAgICAgbGV0IHBvd2VyRmFjdG9yID0gMS4wOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRzLkhQIDwgdG90YWxDb3N0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBvd2VyRmFjdG9yID0gMC41OwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRzLkhQID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgdGVjaFBheWxvYWQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB0ZWNoQm9udXMgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIlRJUkVEIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAiZGFtYWdlIik7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0cy5IUCAtPSB0b3RhbENvc3Q7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBsZXQgc3RhdFZhbCA9IHRoaXMuZ2V0U3RhdCh0eXBlKTsKICAgICAgICAgICAgICAgICAgICBzdGF0VmFsICs9IHRlY2hCb251czsKICAgICAgICAgICAgICAgICAgICBzdGF0VmFsICo9IHBvd2VyRmFjdG9yOwogICAgICAgICAgICAgICAgICAgIHN0YXRWYWwgKj0gcG93ZXJNdWx0aXBsaWVyOwoKICAgICAgICAgICAgICAgICAgICBjb25zdCBnb2FsWiA9ICh0aGlzLnRlYW0gJiYgdGhpcy50ZWFtLnNpZGUgPT09IDEpID8gLTI4IDogMjg7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZ29hbERpciA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIGdvYWxaIC0gdGhpcy5tZXNoLnBvc2l0aW9uLnopLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGdvYWxEb3QgPSBmaW5hbERpci5kb3QoZ29hbERpcik7CgogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAnU0gnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGdvYWxQb3MgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAyLCBnb2FsWik7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRvR29hbCA9IGdvYWxQb3MuY2xvbmUoKS5zdWIodGhpcy5tZXNoLnBvc2l0aW9uKS5ub3JtYWxpemUoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNoID0gdGhpcy5nZXRTdGF0KCdTSCcpOwogICAgICAgICAgICAgICAgICAgICAgICBsZXQgYXNzaXN0RmFjdG9yID0gTWF0aC5taW4oMC45LCBNYXRoLm1heCgwLjEsIHNoIC8gMTAwLjApKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm92ZXJyaWRlQWltVmVjdG9yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3Npc3RGYWN0b3IgKj0gMC4xOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ29hbERvdCA+IDAuMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWxEaXIubGVycCh0b0dvYWwsIGFzc2lzdEZhY3Rvcik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0ZpbmlzaGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbERpci55ICs9IDAuMDU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIlNMQU0hIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAiY29taWMtaW1wYWN0Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Cn0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbERpci55ICs9IDAuMjU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgCi8vIEdvYWxpZSBMb2Z0IEJvbnVzIChQcmV2ZW50IGludGVyY2VwdGlvbiBieSBpbW1lZGlhdGUgZGVmZW5kZXIpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJvbGUgPT09ICdHTCcpIGZpbmFsRGlyLnkgKz0gMC44OyAvLyBIaWdoIGxvZnQgZm9yIGNsZWFyYW5jZQoKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXQgPSB0aGlzLl9maW5kUGFzc1RhcmdldEluQ29uZShmaW5hbERpcik7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0b01hdGUgPSB0YXJnZXQubWVzaC5wb3NpdGlvbi5jbG9uZSgpLnN1Yih0aGlzLm1lc2gucG9zaXRpb24pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldC52ZWxvY2l0eS5sZW5ndGhTcSgpID4gMC4xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9NYXRlLmFkZFNjYWxlZFZlY3Rvcih0YXJnZXQudmVsb2NpdHksIDAuNSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b01hdGUubm9ybWFsaXplKCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGEgPSB0aGlzLmdldFN0YXQoJ1BBJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgYXNzaXN0RmFjdG9yID0gTWF0aC5taW4oMS4wLCAwLjMgKyAocGEgLyA4MC4wKSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub3ZlcnJpZGVBaW1WZWN0b3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3Npc3RGYWN0b3IgKj0gMC4xOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsRGlyLmxlcnAodG9NYXRlLCBhc3Npc3RGYWN0b3IpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpc3QgPSB0aGlzLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyh0YXJnZXQubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbERpci55ICs9IE1hdGgubWluKDAuNiwgZGlzdCAqIDAuMDMpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewpmaW5hbERpci55ICs9IDAuMjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgLy8gR29hbGllIExvZnQgQm9udXMgZm9yIFBhc3NpbmcKLy8gR29hbGllIExvZnQgQm9udXMgZm9yIFBhc3NpbmcKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucm9sZSA9PT0gJ0dMJykgZmluYWxEaXIueSArPSAwLjg7IC8vIEhpZ2ggbG9mdCBmb3IgY2xlYXJhbmNlCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBmaW5hbERpci5ub3JtYWxpemUoKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHRlY2hQYXlsb2FkICYmIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSAmJiB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UudHJpZ2dlclRlY2hFdmVudCkgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UudHJpZ2dlclRlY2hFdmVudCh0aGlzLCB0ZWNoTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgfQoKYmFsbC5zaG9vdChmaW5hbERpciwgc3RhdFZhbCwgdHlwZSwgdGVjaFBheWxvYWQsIHNwaW4pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEV4dHJhIGdyYWNlIHBlcmlvZCBmb3IgR29hbGllIHRvIHByZXZlbnQgcG9pbnQtYmxhbmsgaW50ZXJjZXB0aW9ucwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJvbGUgPT09ICdHTCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYmFsbC5jYXRjaEdyYWNlUGVyaW9kID0gMC42OyAvLyAwLjZzIGltbXVuaXR5IChhcHByb3ggMTAtMTJtIHRyYXZlbCkKICAgICAgICAgICAgICAgICAgICB9Cgp0aGlzLmxvc2VCYWxsKCk7CgogICAgICAgICAgICAgICAgICAgIHRoaXMuY2F0Y2hDb29sZG93biA9IDEuMDsgLy8gMXMgY29vbGRvd24KICAgICAgICAgICAgICAgICAgICB0aGlzLmNhdGNoQ29vbGRvd24gPSAxLjA7IC8vIDFzIGNvb2xkb3duCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYW5DYXRjaCA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB3aW5kdXBUaW1lKTsKCiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgdGhpcy5pc1Rocm93aW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLm92ZXJyaWRlQWltVmVjdG9yID0gbnVsbDsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmlucHV0VmVjdG9yLmxlbmd0aCgpID4gMC4xKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5KCdzd2ltJywgMC4yKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5KCdpZGxlJywgMC4yKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgd2luZHVwVGltZSArIDUwMCk7CiAgICAgICAgfQoKICAgICAgICBfZmluZFBhc3NUYXJnZXRJbkNvbmUoYWltRGlyKSB7CiAgICAgICAgICAgIGlmICghdGhpcy50ZWFtKSByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIGxldCBiZXN0VGFyZ2V0ID0gbnVsbDsKICAgICAgICAgICAgbGV0IG1heFNjb3JlID0gLUluZmluaXR5OwoKICAgICAgICAgICAgZm9yIChjb25zdCBtYXRlIG9mIHRoaXMudGVhbS5wbGF5ZXJzKSB7CiAgICAgICAgICAgICAgICBpZiAobWF0ZSA9PT0gdGhpcyB8fCAhbWF0ZS5tZXNoKSBjb250aW51ZTsKCiAgICAgICAgICAgICAgICBjb25zdCB0b01hdGUgPSBtYXRlLm1lc2gucG9zaXRpb24uY2xvbmUoKS5zdWIodGhpcy5tZXNoLnBvc2l0aW9uKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGRvdCA9IGFpbURpci5kb3QodG9NYXRlKTsKCiAgICAgICAgICAgICAgICBpZiAoZG90ID4gMC43KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlzdCA9IHRoaXMubWVzaC5wb3NpdGlvbi5kaXN0YW5jZVRvKG1hdGUubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2NvcmUgPSAoZG90ICogMTApIC0gKGRpc3QgKiAwLjEpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcmUgPiBtYXhTY29yZSkgewogICAgICAgICAgICAgICAgICAgICAgICBtYXhTY29yZSA9IHNjb3JlOwogICAgICAgICAgICAgICAgICAgICAgICBiZXN0VGFyZ2V0ID0gbWF0ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGJlc3RUYXJnZXQ7CiAgICAgICAgfQoKc3RhcnRDaGFyZ2UoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5oYXNCYWxsIHx8IHRoaXMuaXNUaHJvd2luZyB8fCB0aGlzLnN0YXR1cy5uYXAgPiAwKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuaXNDaGFyZ2luZyA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuY2hhcmdlVGltZSA9IDA7CgovLyBWaXN1YWxzIGhhbmRsZWQgaW4gdXBkYXRlCgogICAgICAgICAgICAvLyBTaG93IGNoYXJnZSBVSQogICAgICAgICAgICB0aGlzLl91cGRhdGVDaGFyZ2VVSSgwKTsKCiAgICAgICAgICAgIC8vIE5FVzogU3Bhd24gQ2hhcmdlIEdseXBoIChHcm91bmQgUmluZykKICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSAmJiB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZ2x5cGhNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZ2x5cGhNYW5hZ2VyLnNwYXduKCdjaGFyZ2UnLCB0aGlzLm1lc2gucG9zaXRpb24sIHsKICAgICAgICAgICAgICAgICAgICBwYXJlbnQ6IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgbGlmZTogdGhpcy5tYXhDaGFyZ2VUaW1lLAogICAgICAgICAgICAgICAgICAgIHJvdGF0aW9uU3BlZWQ6IDMuMCwKICAgICAgICAgICAgICAgICAgICBzY2FsZVNwZWVkOiAwLjIsCiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0WTogMC4xCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmVsZWFzZUNoYXJnZShkeCA9IDAsIGR5ID0gMCkgewogICAgICAgICAgICBpZiAoIXRoaXMuaXNDaGFyZ2luZykgcmV0dXJuOwogICAgICAgICAgICB0aGlzLmlzQ2hhcmdpbmcgPSBmYWxzZTsKCmNvbnN0IHJhdGlvID0gTWF0aC5taW4odGhpcy5jaGFyZ2VUaW1lIC8gdGhpcy5tYXhDaGFyZ2VUaW1lLCAxLjApOwogICAgICAgICAgICBsZXQgbXVsdGlwbGllciA9IDEuMCArIChyYXRpbyAqIDAuNSk7CgogICAgICAgICAgICBpZiAocmF0aW8gPiAwLjkpIHsKICAgICAgICAgICAgICAgIG11bHRpcGxpZXIgPSAyLjA7CiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIlBFUkZFQ1QhIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAiY29taWMtaW1wYWN0Iik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmNhbWVyYU1hbmFnZXIpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhTWFuYWdlci5hZGRGb3ZJbXB1bHNlKC01KTsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhTWFuYWdlci5hZGRTaGFrZSgwLjUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgovLyBSZXNldCB2aXN1YWxzIGluIHVwZGF0ZQogICAgICAgICAgICB0aGlzLl9oaWRlQ2hhcmdlVUkoKTsKCiAgICAgICAgICAgIGxldCBhaW1WZWMgPSBudWxsOwogICAgICAgICAgICBjb25zdCBzd2lwZUxlbiA9IE1hdGguc3FydChkeCpkeCArIGR5KmR5KTsKCiAgICAgICAgICAgIGlmIChzd2lwZUxlbiA+IDIwKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjYW1lcmEgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhOwogICAgICAgICAgICAgICAgY29uc3QgZndkID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHJpZ2h0ID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKCiAgICAgICAgICAgICAgICBpZiAoY2FtZXJhKSB7CiAgICAgICAgICAgICAgICAgICAgY2FtZXJhLmdldFdvcmxkRGlyZWN0aW9uKGZ3ZCk7CiAgICAgICAgICAgICAgICAgICAgZndkLnkgPSAwOwogICAgICAgICAgICAgICAgICAgIGlmIChmd2QubGVuZ3RoU3EoKSA8IDAuMDAxKSBmd2Quc2V0KDAsIDAsIC0xKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGZ3ZC5ub3JtYWxpemUoKTsKCiAgICAgICAgICAgICAgICAgICAgcmlnaHQuY3Jvc3NWZWN0b3JzKGZ3ZCwgbmV3IFRIUkVFLlZlY3RvcjMoMCwgMSwgMCkpLm5vcm1hbGl6ZSgpOwoKICAgICAgICAgICAgICAgICAgICBjb25zdCB3b3JsZFZlYyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICAgICAgICAgICAgICAgICAgd29ybGRWZWMuYWRkU2NhbGVkVmVjdG9yKHJpZ2h0LCBkeCk7CiAgICAgICAgICAgICAgICAgICAgd29ybGRWZWMuYWRkU2NhbGVkVmVjdG9yKGZ3ZCwgLWR5KTsKICAgICAgICAgICAgICAgICAgICB3b3JsZFZlYy5ub3JtYWxpemUoKTsKCiAgICAgICAgICAgICAgICAgICAgYWltVmVjID0gd29ybGRWZWM7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vdmVycmlkZUFpbVZlY3RvciA9IGFpbVZlYzsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgYWltVmVjID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMSkuYXBwbHlRdWF0ZXJuaW9uKHRoaXMubWVzaC5xdWF0ZXJuaW9uKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm92ZXJyaWRlQWltVmVjdG9yID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGFpbVZlYyA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIDEpLmFwcGx5UXVhdGVybmlvbih0aGlzLm1lc2gucXVhdGVybmlvbikubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICB0aGlzLm92ZXJyaWRlQWltVmVjdG9yID0gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgZ29hbFogPSAodGhpcy50ZWFtICYmIHRoaXMudGVhbS5zaWRlID09PSAxKSA/IC0yOCA6IDI4OwogICAgICAgICAgICBjb25zdCBnb2FsRGlyID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgZ29hbFogLSB0aGlzLm1lc2gucG9zaXRpb24ueikubm9ybWFsaXplKCk7CiAgICAgICAgICAgIGNvbnN0IGRvdEdvYWwgPSBhaW1WZWMuZG90KGdvYWxEaXIpOwoKICAgICAgICAgICAgbGV0IHR5cGUgPSAnUEEnOwoKICAgICAgICAgICAgY29uc3QgZGlzdFRvR29hbCA9IE1hdGguYWJzKHRoaXMubWVzaC5wb3NpdGlvbi56IC0gZ29hbFopOwoKICAgICAgICAgICAgaWYgKGRvdEdvYWwgPiAwLjggJiYgZGlzdFRvR29hbCA8IDMwLjApIHsKICAgICAgICAgICAgICAgIHR5cGUgPSAnU0gnOwogICAgICAgICAgICB9IGVsc2UgaWYgKGRvdEdvYWwgPiAwLjUgJiYgZGlzdFRvR29hbCA8IDE1LjApIHsKICAgICAgICAgICAgICAgIHR5cGUgPSAnU0gnOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCB0YXJnZXRNYXRlID0gdGhpcy5fZmluZFBhc3NUYXJnZXRJbkNvbmUoYWltVmVjKTsKICAgICAgICAgICAgaWYgKHRhcmdldE1hdGUgJiYgdHlwZSA9PT0gJ1NIJykgewogICAgICAgICAgICAgICAgY29uc3QgZGlzdE1hdGUgPSB0aGlzLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyh0YXJnZXRNYXRlLm1lc2gucG9zaXRpb24pOwogICAgICAgICAgICAgICAgaWYgKGRpc3RNYXRlIDwgMTIuMCkgdHlwZSA9ICdQQSc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IGJhbGwgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZW50aXRpZXMuYmFsbDsKICAgICAgICAgICAgaWYgKGJhbGwpIHsKICAgICAgICAgICAgICAgIHRoaXMudGhyb3dCYWxsKGJhbGwsIHR5cGUsIG11bHRpcGxpZXIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBORVc6IENoYXJnZSBVSSBtZXRob2RzCiAgICAgICAgX3VwZGF0ZUNoYXJnZVVJKHJhdGlvKSB7CiAgICAgICAgICAgIGNvbnN0IG1ldGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYXJnZS1tZXRlci1maWxsJyk7CiAgICAgICAgICAgIGlmIChtZXRlcikgewogICAgICAgICAgICAgICAgbWV0ZXIuc3R5bGUud2lkdGggPSBgJHtyYXRpbyAqIDEwMH0lYDsKICAgICAgICAgICAgICAgIGlmIChyYXRpbyA+IDAuOSkgewogICAgICAgICAgICAgICAgICAgIG1ldGVyLnN0eWxlLmJhY2tncm91bmQgPSAnbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjZmYwLCAjZjgwKSc7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJhdGlvID4gMC41KSB7CiAgICAgICAgICAgICAgICAgICAgbWV0ZXIuc3R5bGUuYmFja2dyb3VuZCA9ICdsaW5lYXItZ3JhZGllbnQoOTBkZWcsICMwZjAsICNmZjApJzsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbWV0ZXIuc3R5bGUuYmFja2dyb3VuZCA9ICdsaW5lYXItZ3JhZGllbnQoOTBkZWcsICMwYWYsICMwZjApJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhcmdlLW1ldGVyLWNvbnRhaW5lcicpOwogICAgICAgICAgICBpZiAoY29udGFpbmVyKSBjb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgfQoKICAgICAgICBfaGlkZUNoYXJnZVVJKCkgewogICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhcmdlLW1ldGVyLWNvbnRhaW5lcicpOwogICAgICAgICAgICBpZiAoY29udGFpbmVyKSBjb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICB9CgogICAgICAgIHNldE92ZXJyaWRlQWltKHgsIHopIHsKICAgICAgICAgICAgaWYgKCF0aGlzLm92ZXJyaWRlQWltVmVjdG9yKSB0aGlzLm92ZXJyaWRlQWltVmVjdG9yID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgICAgICAgICAgdGhpcy5vdmVycmlkZUFpbVZlY3Rvci5zZXQoeCwgMCwgeikubm9ybWFsaXplKCk7CiAgICAgICAgfQoKbG9zZUJhbGwoKSB7CiAgICAgICAgICAgIHRoaXMuaGFzQmFsbCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9oaWRlUGFzc1RhcmdldEluZGljYXRvcnMoKTsKICAgICAgICAgICAgLy8gRml4OiBFbnN1cmUgcGxheWVyIGNhbiBjYXRjaCBhZ2FpbiBpZiB0aGV5IGxvc2UgcG9zc2Vzc2lvbiB1bmV4cGVjdGVkbHkKICAgICAgICAgICAgLy8gKFN0YW5kYXJkIHRocm93cy9mdW1ibGVzIHdpbGwgaW1tZWRpYXRlbHkgc2V0IHRoaXMgdG8gZmFsc2Ugd2l0aCBhIHRpbWVvdXQpCiAgICAgICAgICAgIHRoaXMuY2FuQ2F0Y2ggPSB0cnVlOwogICAgICAgIH0KCnVwZGF0ZShkdCkgewogICAgICAgICAgICBpZiAoIXRoaXMubWVzaCkgcmV0dXJuOwoKICAgICAgICAgICAgaWYgKHRoaXMuaXNHb2RNb2RlKSB7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXRzLkhQID0gdGhpcy5zdGF0cy5tYXhIUDsKICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudEVOID0gdGhpcy5nZXRTdGF0KCdFTicpOwogICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMudmVub20gPSAwOwogICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMubmFwID0gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMubWl4ZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMubWl4ZXIudXBkYXRlKGR0KTsKICAgICAgICAgICAgfQoKLy8gdGhpcy5pc0VuZ2FnZWQgPSBmYWxzZTsgLy8gUkVNT1ZFRDogSGFuZGxlZCBpbiBfY2hlY2tUYWNrbGVQcmVzc3VyZSB0byBwcmV2ZW50IHN0YXRlIGZsaWNrZXJpbmcKCiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVN0YXR1cyhkdCk7CgogICAgICAgICAgICAvLyBDaGFyZ2UgTG9naWMKLy8gQ2hhcmdlIExvZ2ljCiAgICAgICAgICAgIGlmICh0aGlzLmlzQ2hhcmdpbmcpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5oYXNCYWxsIHx8IHRoaXMuc3RhdHVzLm5hcCA+IDAgfHwgdGhpcy5zdHVuVGltZXIgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0NoYXJnaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNoLnBvc2l0aW9uLnkgPSAwOwogICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5zY2FsZS5zZXRTY2FsYXIodGhpcy5iYXNlU2NhbGUpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2hpZGVDaGFyZ2VVSSgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYXJnZVRpbWUgKz0gZHQ7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJhdGlvID0gTWF0aC5taW4odGhpcy5jaGFyZ2VUaW1lIC8gdGhpcy5tYXhDaGFyZ2VUaW1lLCAxLjApOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIExldml0YXRpb24gKFBvd2VyaW5nIHVwKQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGhvdmVyID0gKE1hdGguc2luKERhdGUubm93KCkgKiAwLjAyKSAqIDAuMSkgKyAocmF0aW8gKiAwLjgpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFZpYnJhdGlvbiAoSW50ZW5zaXR5IGluY3JlYXNlcyB3aXRoIGNoYXJnZSkKICAgICAgICAgICAgICAgICAgICBjb25zdCBzaGFrZSA9IDAuMDUgKyAoMC4xICogcmF0aW8pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEFwcGx5IFkgb2Zmc2V0IChIb3ZlciArIEppdHRlcikKICAgICAgICAgICAgICAgICAgICB0aGlzLm1lc2gucG9zaXRpb24ueSA9IGhvdmVyICsgKE1hdGgucmFuZG9tKCkgLSAwLjUpICogc2hha2U7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gQXBwbHkgUm90YXRpb24gSml0dGVyICh2aWEgYmFua2luZy9waXRjaCB2YXJpYWJsZXMpCiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBhdm9pZHMgcG9zaXRpb25hbCBkcmlmdCB3aGlsZSBnaXZpbmcgYSAic3RydWdnbGluZyB0byBjb250YWluIHBvd2VyIiBsb29rCiAgICAgICAgICAgICAgICAgICAgdGhpcy5iYW5raW5nQW1vdW50ICs9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIHNoYWtlOwogICAgICAgICAgICAgICAgICAgIHRoaXMucGl0Y2hBbW91bnQgKz0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogc2hha2U7CgogICAgICAgICAgICAgICAgICAgIC8vIEVuc3VyZSBzY2FsZSBzdGF5cyBub3JtYWwgKFJlbW92ZSBzd2VsbGluZyBlZmZlY3QpCiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNoLnNjYWxlLnNldFNjYWxhcih0aGlzLmJhc2VTY2FsZSk7CgogICAgICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUNoYXJnZVVJKHJhdGlvKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQppZiAodGhpcy5kYXNoQ29vbGRvd24gPiAwKSB0aGlzLmRhc2hDb29sZG93biAtPSBkdDsKICAgICAgICAgICAgaWYgKHRoaXMuY2xhc2hDb29sZG93biA+IDApIHRoaXMuY2xhc2hDb29sZG93biAtPSBkdDsKICAgICAgICAgICAgaWYgKHRoaXMuc3R1blRpbWVyID4gMCkgdGhpcy5zdHVuVGltZXIgLT0gZHQ7CiAgICAgICAgICAgIGlmICh0aGlzLmltbXVuaXR5VGltZXIgPiAwKSB0aGlzLmltbXVuaXR5VGltZXIgLT0gZHQ7CiAgICAgICAgICAgIGlmICh0aGlzLmNhdGNoQ29vbGRvd24gPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNhdGNoQ29vbGRvd24gLT0gZHQ7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5jYXRjaENvb2xkb3duIDw9IDApIHRoaXMuY2FuQ2F0Y2ggPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIERhc2ggTG9naWMKICAgICAgICAgICAgaWYgKHRoaXMuaXNEYXNoaW5nKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRhc2hUaW1lIC09IGR0OwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmRhc2hUeXBlID09PSAnaG9yaXpvbnRhbCcpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9jaGVja1RhY2tsZUNvbGxpc2lvbigpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmRhc2hUaW1lIDw9IDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmlzRGFzaGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi55ID0gMDsKICAgICAgICAgICAgICAgICAgICB0aGlzLmRhc2hUeXBlID0gbnVsbDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CmlmICh0aGlzLmRhc2hUeXBlID09PSAndmVydGljYWwnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9wVmVjLmNvcHkodGhpcy5kYXNoVmVjKS5tdWx0aXBseVNjYWxhcihkdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi5hZGQoX3BWZWMpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gMSAtICh0aGlzLmRhc2hUaW1lIC8gdGhpcy5kYXNoVG90YWxUaW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNoLnBvc2l0aW9uLnkgPSBNYXRoLnNpbih0ICogTWF0aC5QSSkgKiAzLjA7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNoLnBvc2l0aW9uLmFkZChfcFZlYyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi55ID0gMDsKCi8vIFZpc3VhbCBUYWNrbGUgTGVhbiAoU2hvdWxkZXIgQmFzaCBBbmltYXRpb24pCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSAxIC0gKHRoaXMuZGFzaFRpbWUgLyB0aGlzLmRhc2hUb3RhbFRpbWUpOyAvLyAwIHRvIDEKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGVhbiA9IE1hdGguc2luKHQgKiBNYXRoLlBJKTsgLy8gUGVhayBhdCAxLjAgaW4gbWlkZGxlCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAvLyBSZS1hcHBseSBiYXNlIGZhY2luZyArIEFnZ3Jlc3NpdmUgU2hvdWxkZXIgQ2hlY2sKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFzZVEgPSBuZXcgVEhSRUUuUXVhdGVybmlvbigpLnNldEZyb21BeGlzQW5nbGUoX3BBeGlzWSwgdGhpcy5jdXJyZW50WWF3ICsgdGhpcy5yb3RhdGlvbk9mZnNldCk7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcGl0Y2ggPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBsZXQgeWF3ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJvbGwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBsZXQgbHVuZ2VBbXQgPSAwOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGFzaFR5cGUgPT09ICdob3Jpem9udGFsJyB8fCB0aGlzLmRhc2hUeXBlID09PSAnYnJlYWsnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVEFDS0xFL0JSRUFLOiBBZ2dyZXNzaXZlIFNob3VsZGVyIENoZWNrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGl0Y2ggPSAxLjIgKiBsZWFuOyAvLyBIZWFkIGRvd24gLyBMZWFuIGZvcndhcmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5YXcgPSAwLjggKiBsZWFuOyAgIC8vIFR1cm4gc2hvdWxkZXIgaW50byB0YXJnZXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb2xsID0gLTAuNiAqIGxlYW47IC8vIERpcCBzaG91bGRlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGx1bmdlQW10ID0gMC44ICogbGVhbjsgLy8gVGhydXN0IG1lc2ggZm9yd2FyZCB2aXN1YWxseQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZGFzaFR5cGUgPT09ICdzcHJpbnQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU1BSSU5UOiBBZXJvZHluYW1pYyBsZWFuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGl0Y2ggPSAwLjUgKiBsZWFuOyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsdW5nZUFtdCA9IDAuMiAqIGxlYW47CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFwcGx5IEx1bmdlIChWaXN1YWwgT2Zmc2V0KQogICAgICAgICAgICAgICAgICAgICAgICBpZiAobHVuZ2VBbXQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbHVuZ2UgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCBsdW5nZUFtdCkuYXBwbHlRdWF0ZXJuaW9uKGJhc2VRKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1lc2gucG9zaXRpb24uYWRkKGx1bmdlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHdpc3RRID0gbmV3IFRIUkVFLlF1YXRlcm5pb24oKS5zZXRGcm9tRXVsZXIobmV3IFRIUkVFLkV1bGVyKHBpdGNoLCB5YXcsIHJvbGwpKTsgCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5xdWF0ZXJuaW9uLm11bHRpcGx5UXVhdGVybmlvbnMoYmFzZVEsIHR3aXN0USk7CgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5Lm11bHRpcGx5U2NhbGFyKDAuOTYpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gU3R1bi9OYXAgQ2hlY2sKICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzLm5hcCA+IDAgfHwgdGhpcy5zdHVuVGltZXIgPiAwKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkcmFnRmFjdG9yID0gTWF0aC5tYXgoMCwgMSAtICgyLjAgKiBkdCkpOwogICAgICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS5tdWx0aXBseVNjYWxhcihkcmFnRmFjdG9yKTsKCiAgICAgICAgICAgICAgICBfcFZlYy5jb3B5KHRoaXMudmVsb2NpdHkpLm11bHRpcGx5U2NhbGFyKGR0KTsKICAgICAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi5hZGQoX3BWZWMpOwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSAnaWRsZScgJiYgdGhpcy5zdGF0ZSAhPT0gJ2NhdGNoJykgdGhpcy5wbGF5KCdpZGxlJywgMC41KTsKCiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVIUEJhcigpOwogICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlUGFzc1RhcmdldEluZGljYXRvcnMoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5fY2hlY2tUYWNrbGVQcmVzc3VyZShkdCk7CgogICAgICAgICAgICBpZiAodGhpcy5pc1Rocm93aW5nKSB7CiAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5Lm11bHRpcGx5U2NhbGFyKE1hdGgubWF4KDAsIDEuMCAtICgyLjAgKiBkdCkpKTsKCiAgICAgICAgICAgICAgICB0aGlzLl9hcHBseVNvZnRDb2xsaXNpb24oZHQpOwogICAgICAgICAgICAgICAgdGhpcy5fYXBwbHlHb2FsQ3JlYXNlKGR0KTsKCiAgICAgICAgICAgICAgICBfcFZlYy5jb3B5KHRoaXMudmVsb2NpdHkpLm11bHRpcGx5U2NhbGFyKGR0KTsKICAgICAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi5hZGQoX3BWZWMpOwoKICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVZlcnRpY2FsaXR5KGR0KTsKCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVQaHlzaWNzKGR0KTsKICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVZlcnRpY2FsaXR5KGR0KTsKICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUJhbmtpbmcoZHQpOwogICAgICAgICAgICB9Cgp0aGlzLl91cGRhdGVIUEJhcigpOwogICAgICAgICAgICB0aGlzLl91cGRhdGVQYXNzVGFyZ2V0SW5kaWNhdG9ycygpOwoKICAgICAgICAgICAgLy8gQnViYmxlIFRyYWlsIExvZ2ljCi8vIEJ1YmJsZSBUcmFpbCBMb2dpYwovLyBCdWJibGUgVHJhaWwgTG9naWMgKER5bmFtaWMpCiAgICAgICAgICAgIGNvbnN0IHNwZWVkU3EgPSB0aGlzLnZlbG9jaXR5Lmxlbmd0aFNxKCk7CiAgICAgICAgICAgIGlmIChzcGVlZFNxID4gMS4wICYmIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSAmJiB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UucGFydGljbGVNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9idWJibGVUaW1lciAtPSBkdDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2J1YmJsZVRpbWVyIDw9IDApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwbSA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5wYXJ0aWNsZU1hbmFnZXI7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFja0RpciA9IHRoaXMudmVsb2NpdHkuY2xvbmUoKS5ub3JtYWxpemUoKS5uZWdhdGUoKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyAxLiBTdGFuZGFyZCBXYWtlIChBbHdheXMgc3Bhd24pCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gYmFja0Rpci5jbG9uZSgpLm11bHRpcGx5U2NhbGFyKDAuOCk7CiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0LnkgPSAwLjUgKyBNYXRoLnJhbmRvbSgpICogMC41OyAKICAgICAgICAgICAgICAgICAgICBvZmZzZXQueCArPSAoTWF0aC5yYW5kb20oKS0wLjUpICogMC41OwogICAgICAgICAgICAgICAgICAgIG9mZnNldC56ICs9IChNYXRoLnJhbmRvbSgpLTAuNSkgKiAwLjU7CiAgICAgICAgICAgICAgICAgICAgcG0uc3Bhd24oJ2J1YmJsZScsIHRoaXMubWVzaC5wb3NpdGlvbi5jbG9uZSgpLmFkZChvZmZzZXQpLCB7IHNjYWxlOiAwLjE1ICsgTWF0aC5yYW5kb20oKSAqIDAuMjUgfSk7CgogICAgICAgICAgICAgICAgICAgIC8vIDIuIENhdml0YXRpb24gKEhpZ2ggU3BlZWQpIC0gQWRkIG9uIHRvcAogICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzSGlnaFNwZWVkID0gc3BlZWRTcSA+IDQwLjA7IAogICAgICAgICAgICAgICAgICAgIGlmIChpc0hpZ2hTcGVlZCkgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTwzOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1PZmZzZXQgPSBiYWNrRGlyLmNsb25lKCkubXVsdGlwbHlTY2FsYXIoMC41ICsgTWF0aC5yYW5kb20oKSowLjUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbU9mZnNldC54ICs9IChNYXRoLnJhbmRvbSgpLTAuNSkqMC44OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbU9mZnNldC55ID0gMC41ICsgKE1hdGgucmFuZG9tKCktMC41KSowLjg7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbU9mZnNldC56ICs9IChNYXRoLnJhbmRvbSgpLTAuNSkqMC44OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbS5zcGF3bignYnViYmxlX21pY3JvJywgdGhpcy5tZXNoLnBvc2l0aW9uLmNsb25lKCkuYWRkKG1PZmZzZXQpLCB7IHNjYWxlOiAwLjA2ICsgTWF0aC5yYW5kb20oKSowLjA4IH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2J1YmJsZVRpbWVyID0gMC4wMzsgCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYnViYmxlVGltZXIgPSAwLjE7IAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQp9CiAgICAgICAgX3VwZGF0ZVN0YXR1cyhkdCkgewogICAgICAgICAgICBjb25zdCBwbSA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSA/IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5wYXJ0aWNsZU1hbmFnZXIgOiBudWxsOwoKICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzLnZlbm9tID4gMCkgewogICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMudmVub20gLT0gZHQ7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXRzLkhQIC09IDUgKiBkdDsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRzLkhQIDwgMCkgdGhpcy5zdGF0cy5IUCA9IDA7CgogICAgICAgICAgICAgICAgdGhpcy5fcGFydGljbGVUaW1lcnMudmVub20gLT0gZHQ7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcGFydGljbGVUaW1lcnMudmVub20gPD0gMCAmJiBwbSkgewogICAgICAgICAgICAgICAgICAgIHBtLnNwYXduKCd2ZW5vbScsIHRoaXMubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGFydGljbGVUaW1lcnMudmVub20gPSAwLjE1OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLmhhc0JhbGwgJiYgdGhpcy5zdGF0cy5IUCA8IHRoaXMuc3RhdHMubWF4SFApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRzLkhQICs9IDUgKiBkdDsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0cy5IUCA+IHRoaXMuc3RhdHMubWF4SFApIHRoaXMuc3RhdHMuSFAgPSB0aGlzLnN0YXRzLm1heEhQOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy5oYXNCYWxsKSB7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXRzLkhQIC09IDIuMCAqIGR0OwogICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHMuSFAgPCAwKSB0aGlzLnN0YXRzLkhQID0gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzLm5hcCA+IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzLm5hcCAtPSBkdDsKCiAgICAgICAgICAgICAgICB0aGlzLl9wYXJ0aWNsZVRpbWVycy5uYXAgLT0gZHQ7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcGFydGljbGVUaW1lcnMubmFwIDw9IDAgJiYgcG0pIHsKICAgICAgICAgICAgICAgICAgICBwbS5zcGF3bignbmFwJywgdGhpcy5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9wYXJ0aWNsZVRpbWVycy5uYXAgPSAwLjg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCBpc1dpdGhlcmluZyA9IGZhbHNlOwogICAgICAgICAgICBmb3IgKGxldCBrZXkgaW4gdGhpcy5zdGF0dXMud2l0aGVyKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0dXMud2l0aGVyW2tleV0gPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMud2l0aGVyW2tleV0gLT0gZHQ7CiAgICAgICAgICAgICAgICAgICAgaXNXaXRoZXJpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoaXNXaXRoZXJpbmcpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3BhcnRpY2xlVGltZXJzLndpdGhlciAtPSBkdDsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9wYXJ0aWNsZVRpbWVycy53aXRoZXIgPD0gMCAmJiBwbSkgewogICAgICAgICAgICAgICAgICAgIHBtLnNwYXduKCd3aXRoZXInLCB0aGlzLm1lc2gucG9zaXRpb24pOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3BhcnRpY2xlVGltZXJzLndpdGhlciA9IDAuMjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5fdXBkYXRlVmlzdWFscygpOwogICAgICAgIH0KCl91cGRhdGVWaXN1YWxzKCkgewogICAgICAgICAgICAvLyBSRU1PVkVEOiBZZWxsb3cgc3BoZXJlL3RpbnQgbG9naWMgYXMgcGVyIHJlcXVlc3QuCiAgICAgICAgICAgIC8vIEFsd2F5cyByZXZlcnQgdG8gYmFzZSBjb2xvci4KICAgICAgICAgICAgdGhpcy5vcmlnaW5hbE1hdGVyaWFscy5mb3JFYWNoKGVudHJ5ID0+IHsKICAgICAgICAgICAgICAgIGVudHJ5Lm1hdGVyaWFsLmNvbG9yLmNvcHkoZW50cnkuYmFzZUNvbG9yKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBfY3JlYXRlQXVyYSgpIHsKICAgICAgICAgICAgLy8gQXVyYSByZW1vdmVkIHBlciB1c2VyIHJlcXVlc3QKICAgICAgICAgICAgdGhpcy5hdXJhTWVzaCA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICAvLyBORVc6IFBhc3MgdGFyZ2V0IGluZGljYXRvcgogICAgICAgIF9jcmVhdGVQYXNzVGFyZ2V0SW5kaWNhdG9yKCkgewogICAgICAgICAgICAvLyBDcmVhdGUgYSByaW5nIHRoYXQgaGlnaGxpZ2h0cyBwb3RlbnRpYWwgcGFzcyB0YXJnZXRzCiAgICAgICAgICAgIGNvbnN0IGdlbyA9IG5ldyBUSFJFRS5SaW5nR2VvbWV0cnkoMC44LCAxLjAsIDE2KTsKICAgICAgICAgICAgY29uc3QgbWF0ID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHsKICAgICAgICAgICAgICAgIGNvbG9yOiAweDAwZmYwMCwKICAgICAgICAgICAgICAgIHRyYW5zcGFyZW50OiB0cnVlLAogICAgICAgICAgICAgICAgb3BhY2l0eTogMC42LAogICAgICAgICAgICAgICAgc2lkZTogVEhSRUUuRG91YmxlU2lkZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5wYXNzVGFyZ2V0SW5kaWNhdG9yID0gbmV3IFRIUkVFLk1lc2goZ2VvLCBtYXQpOwogICAgICAgICAgICB0aGlzLnBhc3NUYXJnZXRJbmRpY2F0b3Iucm90YXRpb24ueCA9IC1NYXRoLlBJIC8gMjsKICAgICAgICAgICAgdGhpcy5wYXNzVGFyZ2V0SW5kaWNhdG9yLnBvc2l0aW9uLnkgPSAwLjE7CiAgICAgICAgICAgIHRoaXMucGFzc1RhcmdldEluZGljYXRvci52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuc2NlbmUuYWRkKHRoaXMucGFzc1RhcmdldEluZGljYXRvcik7CiAgICAgICAgfQoKICAgICAgICBfdXBkYXRlUGFzc1RhcmdldEluZGljYXRvcnMoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5oYXNCYWxsIHx8ICF0aGlzLnRlYW0pIHsKICAgICAgICAgICAgICAgIHRoaXMuX2hpZGVQYXNzVGFyZ2V0SW5kaWNhdG9ycygpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBGaW5kIGJlc3QgcGFzcyB0YXJnZXQKICAgICAgICAgICAgY29uc3QgYWltRGlyID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMSkuYXBwbHlRdWF0ZXJuaW9uKHRoaXMubWVzaC5xdWF0ZXJuaW9uKTsKICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gdGhpcy5fZmluZFBhc3NUYXJnZXRJbkNvbmUoYWltRGlyKTsKCiAgICAgICAgICAgIGlmICh0YXJnZXQgJiYgdGFyZ2V0Lm1lc2ggJiYgdGhpcy5wYXNzVGFyZ2V0SW5kaWNhdG9yKSB7CiAgICAgICAgICAgICAgICB0aGlzLnBhc3NUYXJnZXRJbmRpY2F0b3IudmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLnBhc3NUYXJnZXRJbmRpY2F0b3IucG9zaXRpb24ueCA9IHRhcmdldC5tZXNoLnBvc2l0aW9uLng7CiAgICAgICAgICAgICAgICB0aGlzLnBhc3NUYXJnZXRJbmRpY2F0b3IucG9zaXRpb24ueiA9IHRhcmdldC5tZXNoLnBvc2l0aW9uLno7CiAgICAgICAgICAgICAgICB0aGlzLnBhc3NUYXJnZXRJbmRpY2F0b3IucG9zaXRpb24ueSA9IDAuMTsKICAgICAgICAgICAgICAgIHRoaXMucGFzc1RhcmdldEluZGljYXRvci5yb3RhdGlvbi56ICs9IDAuMDU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl9oaWRlUGFzc1RhcmdldEluZGljYXRvcnMoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX2hpZGVQYXNzVGFyZ2V0SW5kaWNhdG9ycygpIHsKICAgICAgICAgICAgaWYgKHRoaXMucGFzc1RhcmdldEluZGljYXRvcikgewogICAgICAgICAgICAgICAgdGhpcy5wYXNzVGFyZ2V0SW5kaWNhdG9yLnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCl9hcHBseVNvZnRDb2xsaXNpb24oZHQpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLm1lc2ggfHwgIXdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSkgcmV0dXJuOwoKICAgICAgICAgICAgY29uc3QgZ2FtZSA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZTsKICAgICAgICAgICAgY29uc3QgdGVhbXMgPSBbZ2FtZS50ZWFtcy5ob21lLCBnYW1lLnRlYW1zLmF3YXldOwoKICAgICAgICAgICAgY29uc3QgcmVwdWxzaW9uUmFkaXVzID0gMC41OyAvLyBSZWR1Y2VkIHRvIDAuNSB0byBmaXggaW52aXNpYmxlIHdhbGwgaXNzdWVzCiAgICAgICAgICAgIGNvbnN0IHN0aWZmbmVzcyA9IDE1LjA7CgogICAgICAgICAgICB0ZWFtcy5mb3JFYWNoKHRlYW0gPT4gewogICAgICAgICAgICAgICAgaWYgKCF0ZWFtKSByZXR1cm47CiAgICAgICAgICAgICAgICB0ZWFtLnBsYXllcnMuZm9yRWFjaChvdGhlciA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG90aGVyID09PSB0aGlzIHx8ICFvdGhlci5tZXNoKSByZXR1cm47CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGR4ID0gdGhpcy5tZXNoLnBvc2l0aW9uLnggLSBvdGhlci5tZXNoLnBvc2l0aW9uLng7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZHkgPSB0aGlzLm1lc2gucG9zaXRpb24ueSAtIG90aGVyLm1lc2gucG9zaXRpb24ueTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkeiA9IHRoaXMubWVzaC5wb3NpdGlvbi56IC0gb3RoZXIubWVzaC5wb3NpdGlvbi56OwoKICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXN0U3EgPSBkeCpkeCArIGR5KmR5ICsgZHoqZHo7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWluRGlzdCA9IHJlcHVsc2lvblJhZGl1cyAqIDIuMDsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGRpc3RTcSA8IG1pbkRpc3QgKiBtaW5EaXN0ICYmIGRpc3RTcSA+IDAuMDAwMSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gTWF0aC5zcXJ0KGRpc3RTcSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG92ZXJsYXAgPSBtaW5EaXN0IC0gZGlzdDsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZvcmNlID0gb3ZlcmxhcCAqIHN0aWZmbmVzczsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG54ID0gZHggLyBkaXN0OwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBueSA9IGR5IC8gZGlzdDsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbnogPSBkeiAvIGRpc3Q7CgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5LnggKz0gbnggKiBmb3JjZSAqIGR0OwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5LnkgKz0gbnkgKiBmb3JjZSAqIGR0OwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5LnogKz0gbnogKiBmb3JjZSAqIGR0OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIF91cGRhdGVQaHlzaWNzKGR0KSB7CiAgICAgICAgICAgIHRoaXMuX2FwcGx5U29mdENvbGxpc2lvbihkdCk7CiAgICAgICAgICAgIHRoaXMuX2FwcGx5R29hbENyZWFzZShkdCk7CgogICAgICAgICAgICBjb25zdCBpbnB1dExlblNxID0gdGhpcy5pbnB1dFZlY3Rvci5sZW5ndGhTcSgpOwogICAgICAgICAgICBjb25zdCBpc0lucHV0QWN0aXZlID0gaW5wdXRMZW5TcSA+IDAuMDE7CgogICAgICAgICAgICBsZXQgY3VycmVudE1heFNwZWVkID0gdGhpcy5tYXhTcGVlZDsKaWYgKHRoaXMuaXNFbmdhZ2VkKSBjdXJyZW50TWF4U3BlZWQgKj0gMC44OyAvLyBCdWZmZWQgZnJvbSAwLjUgdG8gYWxsb3cgZXNjYXBlCiAgICAgICAgICAgIGlmICh0aGlzLmlzQ2hhcmdpbmcpIGN1cnJlbnRNYXhTcGVlZCAqPSAwLjk7CgogICAgICAgICAgICBpZiAoaXNJbnB1dEFjdGl2ZSkgewogICAgICAgICAgICAgICAgX3BWZWMuY29weSh0aGlzLmlucHV0VmVjdG9yKS5ub3JtYWxpemUoKTsKCiAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXRWZWxYID0gX3BWZWMueCAqIGN1cnJlbnRNYXhTcGVlZDsKICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldFZlbFogPSBfcFZlYy56ICogY3VycmVudE1heFNwZWVkOwoKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRTcGVlZCA9IHRoaXMudmVsb2NpdHkubGVuZ3RoKCk7CiAgICAgICAgICAgICAgICBjb25zdCBzcGVlZFJhdGlvID0gTWF0aC5taW4oMS4wLCBjdXJyZW50U3BlZWQgLyB0aGlzLm1heFNwZWVkKTsKCiAgICAgICAgICAgICAgICBjb25zdCBhZ2lsaXR5ID0gVEhSRUUuTWF0aFV0aWxzLmxlcnAoMTAuMCwgMi4wLCBzcGVlZFJhdGlvKTsKCiAgICAgICAgICAgICAgICBjb25zdCB0ID0gMS4wIC0gTWF0aC5wb3coMC4wMSwgZHQgKiBhZ2lsaXR5KTsKCiAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5LnggKz0gKHRhcmdldFZlbFggLSB0aGlzLnZlbG9jaXR5LngpICogdDsKICAgICAgICAgICAgICAgIHRoaXMudmVsb2NpdHkueiArPSAodGFyZ2V0VmVsWiAtIHRoaXMudmVsb2NpdHkueikgKiB0OwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSAnc3dpbScpIHRoaXMucGxheSgnc3dpbScsIDAuMik7CgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgYnJha2VGYWN0b3IgPSAyLjA7CiAgICAgICAgICAgICAgICBjb25zdCB0ID0gMS4wIC0gTWF0aC5wb3coMC4xLCBkdCAqIGJyYWtlRmFjdG9yKTsKCiAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5LnggKz0gKDAgLSB0aGlzLnZlbG9jaXR5LngpICogdDsKICAgICAgICAgICAgICAgIHRoaXMudmVsb2NpdHkueiArPSAoMCAtIHRoaXMudmVsb2NpdHkueikgKiB0OwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLnZlbG9jaXR5Lmxlbmd0aFNxKCkgPCAwLjAxKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS5zZXQoMCwgdGhpcy52ZWxvY2l0eS55LCAwKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSAhPT0gJ2lkbGUnICYmIHRoaXMuc3RhdGUgIT09ICdjYXRjaCcgJiYgdGhpcy5zdGF0ZSAhPT0gJ3Rocm93JyAmJiB0aGlzLnN0YXRlICE9PSAncmVhY3QnKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5KCdpZGxlJywgMC4zKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS55ICo9IE1hdGgubWF4KDAsIDEuMCAtICgyLjAgKiBkdCkpOwoKICAgICAgICAgICAgX3BWZWMuY29weSh0aGlzLnZlbG9jaXR5KS5tdWx0aXBseVNjYWxhcihkdCk7CiAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi5hZGQoX3BWZWMpOwogICAgICAgIH0KCiAgICAgICAgX3VwZGF0ZVZlcnRpY2FsaXR5KGR0KSB7CiAgICAgICAgICAgIGxldCB0YXJnZXRZID0gMDsKCiAgICAgICAgICAgIGNvbnN0IGJhbGwgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZW50aXRpZXMuYmFsbDsKCiAgICAgICAgICAgIGlmIChiYWxsICYmIGJhbGwubWVzaCAmJiAhdGhpcy5oYXNCYWxsKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0VG9CYWxsID0gdGhpcy5tZXNoLnBvc2l0aW9uLmRpc3RhbmNlVG8oYmFsbC5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgIGlmIChkaXN0VG9CYWxsIDwgMTUuMCkgewogICAgICAgICAgICAgICAgICAgIHRhcmdldFkgPSBiYWxsLm1lc2gucG9zaXRpb24ueTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMuaGFzQmFsbCkgewogICAgICAgICAgICAgICAgdGFyZ2V0WSA9IDAuNTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgeURpZmYgPSB0YXJnZXRZIC0gdGhpcy5tZXNoLnBvc2l0aW9uLnk7CgogICAgICAgICAgICBjb25zdCBsaWZ0ID0geURpZmYgKiAxMC4wICogZHQ7CiAgICAgICAgICAgIHRoaXMudmVsb2NpdHkueSArPSBsaWZ0OwoKICAgICAgICAgICAgaWYgKHRoaXMubWVzaC5wb3NpdGlvbi55ID4gOC4wKSB7CiAgICAgICAgICAgICAgICB0aGlzLm1lc2gucG9zaXRpb24ueSA9IDguMDsKICAgICAgICAgICAgICAgIHRoaXMudmVsb2NpdHkueSAqPSAtMC41OwogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMubWVzaC5wb3NpdGlvbi55IDwgLTguMCkgewogICAgICAgICAgICAgICAgdGhpcy5tZXNoLnBvc2l0aW9uLnkgPSAtOC4wOwogICAgICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS55ICo9IC0wLjU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIEZJWEVEOiBJbXByb3ZlZCBiYW5raW5nIHdpdGggaHlzdGVyZXNpcyB0byBwcmV2ZW50IGZhY2luZyBmbGlwcwogICAgICAgIF91cGRhdGVCYW5raW5nKGR0KSB7CiAgICAgICAgICAgIGNvbnN0IGlucHV0TGVuU3EgPSB0aGlzLmlucHV0VmVjdG9yLmxlbmd0aFNxKCk7CiAgICAgICAgICAgIGNvbnN0IHZlbExlblNxID0gdGhpcy52ZWxvY2l0eS5sZW5ndGhTcSgpOwoKICAgICAgICAgICAgbGV0IHRhcmdldFlhdyA9IHRoaXMudGFyZ2V0WWF3OwogICAgICAgICAgICBsZXQgc2hvdWxkVXBkYXRlWWF3ID0gZmFsc2U7CgogICAgICAgICAgICAvLyBPbmx5IHVwZGF0ZSB5YXcgaWYgaW5wdXQgb3IgdmVsb2NpdHkgZXhjZWVkcyBkZWFkem9uZQogICAgICAgICAgICBpZiAoaW5wdXRMZW5TcSA+IHRoaXMuZmFjaW5nRGVhZHpvbmUgKiB0aGlzLmZhY2luZ0RlYWR6b25lKSB7CiAgICAgICAgICAgICAgICB0YXJnZXRZYXcgPSBNYXRoLmF0YW4yKHRoaXMuaW5wdXRWZWN0b3IueCwgdGhpcy5pbnB1dFZlY3Rvci56KTsKICAgICAgICAgICAgICAgIHNob3VsZFVwZGF0ZVlhdyA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodmVsTGVuU3EgPiB0aGlzLmZhY2luZ0RlYWR6b25lICogdGhpcy5mYWNpbmdEZWFkem9uZSkgewp0YXJnZXRZYXcgPSBNYXRoLmF0YW4yKHRoaXMudmVsb2NpdHkueCwgdGhpcy52ZWxvY2l0eS56KTsKICAgICAgICAgICAgICAgIHNob3VsZFVwZGF0ZVlhdyA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5oYXNCYWxsICYmIHRoaXMudGVhbSAmJiB0aGlzLnRlYW0uaXNIdW1hbiAmJiB0aGlzLnRlYW0uYWN0aXZlUGxheWVyID09PSB0aGlzICYmICF3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuaXNEZW1vTW9kZSkgewogICAgICAgICAgICAgICAgLy8gU3RhdGlvbmFyeSBBaW1pbmcgKEh1bWFuIHdpdGggQmFsbCkKICAgICAgICAgICAgICAgIC8vIFJvdGF0ZSB0b3dhcmRzIGNhbWVyYS9haW0gZGlyZWN0aW9uCiAgICAgICAgICAgICAgICBjb25zdCBjYW0gPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhOwogICAgICAgICAgICAgICAgaWYgKGNhbSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpciA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICAgICAgICAgICAgICAgICAgY2FtLmdldFdvcmxkRGlyZWN0aW9uKGRpcik7CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0WWF3ID0gTWF0aC5hdGFuMihkaXIueCwgZGlyLnopOwogICAgICAgICAgICAgICAgICAgIHNob3VsZFVwZGF0ZVlhdyA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIElmIHdlIHNob3VsZCB1cGRhdGUsIGRvIHNvLiBPdGhlcndpc2Uga2VlcCBsYXN0IHZhbGlkIHlhdwogICAgICAgICAgICBpZiAoc2hvdWxkVXBkYXRlWWF3KSB7CiAgICAgICAgICAgICAgICB0aGlzLmxhc3RWYWxpZFlhdyA9IHRhcmdldFlhdzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRhcmdldFlhdyA9IHRoaXMubGFzdFZhbGlkWWF3OwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBTbW9vdGggWWF3IHdpdGggd3JhcC1hcm91bmQgaGFuZGxpbmcKICAgICAgICAgICAgbGV0IGRpZmYgPSB0YXJnZXRZYXcgLSB0aGlzLmN1cnJlbnRZYXc7CiAgICAgICAgICAgIHdoaWxlIChkaWZmID4gTWF0aC5QSSkgZGlmZiAtPSBNYXRoLlBJICogMjsKICAgICAgICAgICAgd2hpbGUgKGRpZmYgPCAtTWF0aC5QSSkgZGlmZiArPSBNYXRoLlBJICogMjsKCiAgICAgICAgICAgIGNvbnN0IHNwZWVkUmF0aW8gPSBNYXRoLm1pbigxLjAsIHRoaXMudmVsb2NpdHkubGVuZ3RoKCkgLyB0aGlzLm1heFNwZWVkKTsKICAgICAgICAgICAgY29uc3QgdHVyblNwZWVkID0gVEhSRUUuTWF0aFV0aWxzLmxlcnAoMTIuMCwgNi4wLCBzcGVlZFJhdGlvKTsKCiAgICAgICAgICAgIC8vIFByZXZlbnQgc3VkZGVuIHNuYXBzIHdoZW4gZGlmZiBpcyB2ZXJ5IGxhcmdlICh0ZWxlcG9ydC9yZXNldCBzY2VuYXJpb3MpCiAgICAgICAgICAgIGNvbnN0IG1heFlhd0NoYW5nZSA9IE1hdGguUEkgKiBkdCAqIHR1cm5TcGVlZDsKICAgICAgICAgICAgY29uc3QgeWF3Q2hhbmdlID0gTWF0aC5tYXgoLW1heFlhd0NoYW5nZSwgTWF0aC5taW4obWF4WWF3Q2hhbmdlLCBkaWZmICogZHQgKiB0dXJuU3BlZWQpKTsKCiAgICAgICAgICAgIHRoaXMuY3VycmVudFlhdyArPSB5YXdDaGFuZ2U7CiAgICAgICAgICAgIHRoaXMudGFyZ2V0WWF3ID0gdGFyZ2V0WWF3OwoKICAgICAgICAgICAgLy8gQmFua2luZwogICAgICAgICAgICBjb25zdCBiYW5rU2Vuc2l0aXZpdHkgPSAwLjg7CiAgICAgICAgICAgIGNvbnN0IG1heEJhbmsgPSAwLjc1OwoKICAgICAgICAgICAgbGV0IHRhcmdldEJhbmsgPSAtZGlmZiAqIGJhbmtTZW5zaXRpdml0eTsKICAgICAgICAgICAgdGFyZ2V0QmFuayA9IE1hdGgubWF4KC1tYXhCYW5rLCBNYXRoLm1pbihtYXhCYW5rLCB0YXJnZXRCYW5rKSk7CgogICAgICAgICAgICBjb25zdCBiYW5rTGVycCA9IDEuMCAtIE1hdGgucG93KDAuMDIsIGR0KTsKICAgICAgICAgICAgdGhpcy5iYW5raW5nQW1vdW50ICs9ICh0YXJnZXRCYW5rIC0gdGhpcy5iYW5raW5nQW1vdW50KSAqIGJhbmtMZXJwOwoKICAgICAgICAgICAgLy8gUGl0Y2gKICAgICAgICAgICAgY29uc3QgcGl0Y2hTZW5zaXRpdml0eSA9IDAuMTsKICAgICAgICAgICAgY29uc3QgbWF4UGl0Y2ggPSAxLjA7CgogICAgICAgICAgICBsZXQgdGFyZ2V0UGl0Y2ggPSAtdGhpcy52ZWxvY2l0eS55ICogcGl0Y2hTZW5zaXRpdml0eTsKICAgICAgICAgICAgdGFyZ2V0UGl0Y2ggPSBNYXRoLm1heCgtbWF4UGl0Y2gsIE1hdGgubWluKG1heFBpdGNoLCB0YXJnZXRQaXRjaCkpOwoKICAgICAgICAgICAgY29uc3QgcGl0Y2hMZXJwID0gMS4wIC0gTWF0aC5wb3coMC4wNSwgZHQpOwogICAgICAgICAgICB0aGlzLnBpdGNoQW1vdW50ICs9ICh0YXJnZXRQaXRjaCAtIHRoaXMucGl0Y2hBbW91bnQpICogcGl0Y2hMZXJwOwoKICAgICAgICAgICAgLy8gQXBwbHkgUm90YXRpb24KICAgICAgICAgICAgY29uc3QgZmluYWxZYXcgPSB0aGlzLmN1cnJlbnRZYXcgKyB0aGlzLnJvdGF0aW9uT2Zmc2V0OwoKICAgICAgICAgICAgdGhpcy5tZXNoLnF1YXRlcm5pb24uc2V0RnJvbUF4aXNBbmdsZShfcEF4aXNZLCBmaW5hbFlhdyk7CgogICAgICAgICAgICBfcFF1YXQuc2V0RnJvbUF4aXNBbmdsZShuZXcgVEhSRUUuVmVjdG9yMygxLCAwLCAwKSwgdGhpcy5waXRjaEFtb3VudCk7CiAgICAgICAgICAgIHRoaXMubWVzaC5xdWF0ZXJuaW9uLm11bHRpcGx5KF9wUXVhdCk7CgogICAgICAgICAgICBfcFF1YXQuc2V0RnJvbUF4aXNBbmdsZShuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAxKSwgdGhpcy5iYW5raW5nQW1vdW50KTsKICAgICAgICAgICAgdGhpcy5tZXNoLnF1YXRlcm5pb24ubXVsdGlwbHkoX3BRdWF0KTsKCiAgICAgICAgICAgIC8vIElkbGUgQm9iCiAgICAgICAgICAgIGlmICh2ZWxMZW5TcSA8IDAuMSAmJiAhdGhpcy5pc0VuZ2FnZWQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRpbWUgPSBEYXRlLm5vdygpICogMC4wMDE1OwogICAgICAgICAgICAgICAgY29uc3QgYm9iUGl0Y2ggPSBNYXRoLnNpbih0aW1lKSAqIDAuMDM7CiAgICAgICAgICAgICAgICBjb25zdCBib2JSb2xsID0gTWF0aC5jb3ModGltZSAqIDAuNykgKiAwLjAyOwoKICAgICAgICAgICAgICAgIF9wUXVhdC5zZXRGcm9tRXVsZXIobmV3IFRIUkVFLkV1bGVyKGJvYlBpdGNoLCAwLCBib2JSb2xsKSk7CiAgICAgICAgICAgICAgICB0aGlzLm1lc2gucXVhdGVybmlvbi5tdWx0aXBseShfcFF1YXQpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKX2NoZWNrVGFja2xlUHJlc3N1cmUoZHQpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLmhhc0JhbGwpIHsKICAgICAgICAgICAgICAgIHRoaXMuaXNFbmdhZ2VkID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLmVuY291bnRlclRpbWVyID0gMDsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMuaW1tdW5pdHlUaW1lciA+IDApIHJldHVybjsKICAgICAgICAgICAgaWYgKHRoaXMuaXNEYXNoaW5nKSByZXR1cm47CgogICAgICAgICAgICBjb25zdCBnYW1lID0gd2luZG93LmZsdXguZ2FtZUluc3RhbmNlOwogICAgICAgICAgICBpZiAoIWdhbWUgfHwgIXRoaXMudGVhbSkgcmV0dXJuOwoKICAgICAgICAgICAgY29uc3Qgb3Bwb25lbnRUZWFtSWQgPSB0aGlzLnRlYW0uaWQgPT09ICdob21lJyA/ICdhd2F5JyA6ICdob21lJzsKICAgICAgICAgICAgY29uc3Qgb3Bwb25lbnRUZWFtID0gZ2FtZS50ZWFtc1tvcHBvbmVudFRlYW1JZF07CgogICAgICAgICAgICBpZiAoIW9wcG9uZW50VGVhbSkgcmV0dXJuOwoKICAgICAgICAgICAgbGV0IGVuZ2FnZWRUaGlzRnJhbWUgPSBmYWxzZTsKICAgICAgICAgICAgY29uc3QgZWZmZWN0aXZlUmFkaXVzID0gdGhpcy5pc0VuZ2FnZWQgPyB0aGlzLnRhY2tsZVJhZGl1cyAqIDEuMiA6IHRoaXMudGFja2xlUmFkaXVzOwoKICAgICAgICAgICAgLy8gMS4gQ2hlY2sgRW5nYWdlbWVudCBTdGF0dXMKICAgICAgICAgICAgZm9yIChjb25zdCBlbnRpdHkgb2Ygb3Bwb25lbnRUZWFtLnBsYXllcnMpIHsKICAgICAgICAgICAgICAgIGlmICghZW50aXR5Lm1lc2ggfHwgZW50aXR5LnN0YXR1cy5uYXAgPiAwIHx8IGVudGl0eS5zdHVuVGltZXIgPiAwKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGNvbnN0IGRpc3QgPSB0aGlzLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyhlbnRpdHkubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICBpZiAoZGlzdCA8IGVmZmVjdGl2ZVJhZGl1cykgewogICAgICAgICAgICAgICAgICAgIGVuZ2FnZWRUaGlzRnJhbWUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOyAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMi4gVXBkYXRlIFRpbWVyICYgVUkgRmVlZGJhY2sKICAgICAgICAgICAgaWYgKGVuZ2FnZWRUaGlzRnJhbWUpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc0VuZ2FnZWQpIHsKICAgICAgICAgICAgICAgICAgICAvLyBKdXN0IGJlY2FtZSBlbmdhZ2VkCiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbmNvdW50ZXJUaW1lciA9IDA7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudGVhbS5pc0h1bWFuICYmIHRoaXMudGVhbS5hY3RpdmVQbGF5ZXIgPT09IHRoaXMgJiYgZ2FtZS5mbG9hdGluZ1RleHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5mbG9hdGluZ1RleHQuc3Bhd24oIkVOR0FHRUQhIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAiY29taWMtYWN0aW9uIik7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhpbnQgZm9yIHRoZSBwbGF5ZXIKICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0VuZ2FnZWQgJiYgdGhpcy5oYXNCYWxsICYmIGdhbWUuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5mbG9hdGluZ1RleHQuc3Bhd24oIkJSRUFLIE5PVyEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJ0ZWNoIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDIwMCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5lbmNvdW50ZXJUaW1lciArPSBkdDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuZW5jb3VudGVyVGltZXIgPSAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmlzRW5nYWdlZCA9IGVuZ2FnZWRUaGlzRnJhbWU7CgogICAgICAgICAgICAvLyAzLiBBcHBseSBEYW1hZ2UgKFdpdGggR3JhY2UgUGVyaW9kKQogICAgICAgICAgICAvLyBHcmFjZSBQZXJpb2Q6IDAuNXMgYmVmb3JlIGRhbWFnZSBzdGFydHMgdGlja2luZwogICAgICAgICAgICBpZiAodGhpcy5pc0VuZ2FnZWQgJiYgdGhpcy5lbmNvdW50ZXJUaW1lciA+IDAuNSkgewogICAgICAgICAgICAgICAgZm9yIChjb25zdCBlbnRpdHkgb2Ygb3Bwb25lbnRUZWFtLnBsYXllcnMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIWVudGl0eS5tZXNoIHx8IGVudGl0eS5zdGF0dXMubmFwID4gMCB8fCBlbnRpdHkuc3R1blRpbWVyID4gMCkgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlzdCA9IHRoaXMubWVzaC5wb3NpdGlvbi5kaXN0YW5jZVRvKGVudGl0eS5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZGlzdCA8IGVmZmVjdGl2ZVJhZGl1cykgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBEaXNjcmV0ZSBDbGFzaCBFdmVudAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW50aXR5LmNsYXNoQ29vbGRvd24gPD0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVzb2x2ZUNsYXNoKGVudGl0eSwgZ2FtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRpdHkuY2xhc2hDb29sZG93biA9IDIuMDsgLy8gSW5jcmVhc2VkIGNvb2xkb3duICh3YXMgMS41KSB0byByZWR1Y2Ugc3BhbQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50RU4gPD0gMCkgewogICAgICAgICAgICAgICAgdGhpcy5mdW1ibGUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCl9yZXNvbHZlQ2xhc2gob3Bwb25lbnQsIGdhbWUpIHsKICAgICAgICAgICAgY29uc3Qgb3BwQVQgPSBvcHBvbmVudC5nZXRTdGF0KCdBVCcpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVmFyaWFuY2U6IDAuOCB0byAxLjIKICAgICAgICAgICAgY29uc3QgdmFyaWFuY2UgPSAwLjggKyBNYXRoLnJhbmRvbSgpICogMC40OwogICAgICAgICAgICBsZXQgZGFtYWdlID0gTWF0aC5mbG9vcihvcHBBVCAqIHZhcmlhbmNlKTsKICAgICAgICAgICAgaWYgKGRhbWFnZSA8IDEpIGRhbWFnZSA9IDE7CgogICAgICAgICAgICAvLyBEaXJlY3Rpb25hbCBTaGllbGRpbmcKICAgICAgICAgICAgLy8gQ2FycmllciBGb3J3YXJkCiAgICAgICAgICAgIF9wVmVjLmNvcHkoX3BBeGlzWikuYXBwbHlRdWF0ZXJuaW9uKHRoaXMubWVzaC5xdWF0ZXJuaW9uKTsgCiAgICAgICAgICAgIC8vIFZlY3RvciBUbyBPcHBvbmVudAogICAgICAgICAgICBjb25zdCB0b09wcCA9IG9wcG9uZW50Lm1lc2gucG9zaXRpb24uY2xvbmUoKS5zdWIodGhpcy5tZXNoLnBvc2l0aW9uKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGRvdCA9IF9wVmVjLmRvdCh0b09wcCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBJZiBvcHBvbmVudCBpcyBCRUhJTkQgKGRvdCA8IC0wLjIpLCBkYW1hZ2UgaXMgcmVkdWNlZCAoU2hpZWxkaW5nKS4KICAgICAgICAgICAgbGV0IGlzU2hpZWxkZWQgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKGRvdCA8IC0wLjIpIHsKICAgICAgICAgICAgICAgIGRhbWFnZSA9IE1hdGguZmxvb3IoZGFtYWdlICogMC41KTsKICAgICAgICAgICAgICAgIGlzU2hpZWxkZWQgPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBBcHBseSBEYW1hZ2UKICAgICAgICAgICAgdGhpcy5jdXJyZW50RU4gLT0gZGFtYWdlOwogICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50RU4gPCAwKSB0aGlzLmN1cnJlbnRFTiA9IDA7CgogICAgICAgICAgICAvLyBUZWNoIEVmZmVjdHMKICAgICAgICAgICAgaWYgKG9wcG9uZW50LnRlY2hzLnRhY2tsZSkgewogICAgICAgICAgICAgICAgaWYgKG9wcG9uZW50LnRlY2hzLnRhY2tsZSA9PT0gJ3Zlbm9tJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwbHlTdGF0dXMoJ3Zlbm9tJywgMTAuMCk7CiAgICAgICAgICAgICAgICAgICAgZGFtYWdlICs9IDM7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9wcG9uZW50LnRlY2hzLnRhY2tsZSA9PT0gJ3dpdGhlcicpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGF0cyA9IFsnUEEnLCAnU0gnLCAnQVQnLCAnRU4nXTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXQgPSBzdGF0c1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBzdGF0cy5sZW5ndGgpXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGx5U3RhdHVzKCd3aXRoZXInLCAxMC4wLCB0YXJnZXQpOwogICAgICAgICAgICAgICAgICAgIGRhbWFnZSArPSAzOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvcHBvbmVudC50ZWNocy50YWNrbGUgPT09ICdkcmFpbicpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRzLkhQIC09IGRhbWFnZTsgCiAgICAgICAgICAgICAgICAgICAgb3Bwb25lbnQuc3RhdHMuSFAgKz0gZGFtYWdlOwogICAgICAgICAgICAgICAgICAgIGlmIChnYW1lLmZsb2F0aW5nVGV4dCkgZ2FtZS5mbG9hdGluZ1RleHQuc3Bhd24oIkRSQUlOIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAiaGVhbCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBWaXN1YWxzIC0gSlVJQ0VEIFVQCiAgICAgICAgICAgIGNvbnN0IG1pZFBvcyA9IHRoaXMubWVzaC5wb3NpdGlvbi5jbG9uZSgpLmxlcnAob3Bwb25lbnQubWVzaC5wb3NpdGlvbiwgMC41KTsKICAgICAgICAgICAgbWlkUG9zLnkgKz0gMS41OwoKICAgICAgICAgICAgaWYgKGdhbWUuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICBpZiAoaXNTaGllbGRlZCkgewogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2FtZS5mbG9hdGluZ1RleHQpIGdhbWUuZmxvYXRpbmdUZXh0LnNwYXduKCJTSElFTEQiLCB0aGlzLm1lc2gucG9zaXRpb24sICJibG9jayIpOwogICAgICAgICAgICAgICAgICAgIH0sIDEwMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIERhbWFnZSBmZWVkYmFjawogICAgICAgICAgICAgICAgZ2FtZS5mbG9hdGluZ1RleHQuc3Bhd24oYCR7ZGFtYWdlfWAsIHRoaXMubWVzaC5wb3NpdGlvbiwgImRhbWFnZSIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZ2FtZS5wYXJ0aWNsZU1hbmFnZXIpIHsKICAgICAgICAgICAgICAgIC8vIE1hc3NpdmUgSW1wYWN0IEp1aWNlCiAgICAgICAgICAgICAgICBnYW1lLnBhcnRpY2xlTWFuYWdlci5zcGF3bignc2hvY2t3YXZlJywgbWlkUG9zLCB7IHNjYWxlOiAzLjAsIGxpZmU6IDAuNCB9KTsKICAgICAgICAgICAgICAgIGdhbWUucGFydGljbGVNYW5hZ2VyLnNwYXduKCdmbGFzaCcsIG1pZFBvcywgeyBzY2FsZTogNC4wIH0pOwogICAgICAgICAgICAgICAgLy8gRGVicmlzIHNob3dlcgogICAgICAgICAgICAgICAgZm9yKGxldCBpPTA7IGk8NjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgZ2FtZS5wYXJ0aWNsZU1hbmFnZXIuc3Bhd24oJ2RlYnJpcycsIG1pZFBvcywgeyBzY2FsZTogMC40IH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZ2FtZS5jYW1lcmFNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICAvLyBIRVJDVUxFQU4gU0hBS0UKICAgICAgICAgICAgICAgIGdhbWUuY2FtZXJhTWFuYWdlci5hZGRTaGFrZSgyLjUpOyAvLyBJbmNyZWFzZWQgZnJvbSAxLjIKICAgICAgICAgICAgICAgIGdhbWUuY2FtZXJhTWFuYWdlci5hZGRGb3ZJbXB1bHNlKC01KTsgLy8gWm9vbSBpbiBpbXBhY3QKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGdhbWUudHJpZ2dlckltcGFjdCkgewogICAgICAgICAgICAgICAgLy8gRnJlZXplIGZyYW1lCiAgICAgICAgICAgICAgICBnYW1lLnRyaWdnZXJJbXBhY3QoMC4xNSwgJ2hlYXZ5Jyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG9wcG9uZW50LmdhaW5FeHAoMik7CiAgICAgICAgfQoKICAgICAgICBfcGVyZm9ybUplY2h0S25vY2tiYWNrKCkgewogICAgICAgICAgICBpZiAoIXRoaXMudGVhbSkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBnYW1lID0gd2luZG93LmZsdXguZ2FtZUluc3RhbmNlOwogICAgICAgICAgICBjb25zdCBvcHBvbmVudFRlYW1JZCA9IHRoaXMudGVhbS5pZCA9PT0gJ2hvbWUnID8gJ2F3YXknIDogJ2hvbWUnOwogICAgICAgICAgICBjb25zdCBvcHBvbmVudFRlYW0gPSBnYW1lLnRlYW1zW29wcG9uZW50VGVhbUlkXTsKCiAgICAgICAgICAgIGlmICghb3Bwb25lbnRUZWFtKSByZXR1cm47CgogICAgICAgICAgICBjb25zdCByYW5nZSA9IDYuMDsKICAgICAgICAgICAgY29uc3QgZm9yY2UgPSAyNS4wOwoKICAgICAgICAgICAgaWYgKGdhbWUuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICBnYW1lLmZsb2F0aW5nVGV4dC5zcGF3bigiSkVDSFQgU0hPVCEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJnb2FsIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG9wcG9uZW50VGVhbS5wbGF5ZXJzLmZvckVhY2gocCA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIXAubWVzaCkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgZGlzdCA9IHRoaXMubWVzaC5wb3NpdGlvbi5kaXN0YW5jZVRvKHAubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICBpZiAoZGlzdCA8IHJhbmdlKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlyID0gcC5tZXNoLnBvc2l0aW9uLmNsb25lKCkuc3ViKHRoaXMubWVzaC5wb3NpdGlvbikubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICAgICAgZGlyLnkgPSAwLjU7CiAgICAgICAgICAgICAgICAgICAgZGlyLm5vcm1hbGl6ZSgpOwoKICAgICAgICAgICAgICAgICAgICBwLnZlbG9jaXR5LmFkZChkaXIubXVsdGlwbHlTY2FsYXIoZm9yY2UpKTsKCiAgICAgICAgICAgICAgICAgICAgcC5pc0Rhc2hpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBjb25zdCByZWFjdEFjdGlvbiA9IHAuYWN0aW9ucyAmJiBwLmFjdGlvbnNbJ3JlYWN0J107CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlYWN0QWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWN0QWN0aW9uLnNldExvb3AoVEhSRUUuTG9vcE9uY2UpOwogICAgICAgICAgICAgICAgICAgICAgICByZWFjdEFjdGlvbi5jbGFtcFdoZW5GaW5pc2hlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIHAucGxheSgncmVhY3QnLCAwLjEpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHAucGxheSgnY2F0Y2gnLCAwLjUpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKGdhbWUuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuZmxvYXRpbmdUZXh0LnNwYXduKCJTTUFDSyEiLCBwLm1lc2gucG9zaXRpb24sICJkYW1hZ2UiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGdhbWUudHJpZ2dlckltcGFjdCkgZ2FtZS50cmlnZ2VySW1wYWN0KDAuMTUsICdzaGF0dGVyJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgZnVtYmxlKCkgewogICAgICAgICAgICBjb25zb2xlLmxvZygiRlVNQkxFISBFTiBEZXBsZXRlZC4iKTsKICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQgJiYgdGhpcy5tZXNoKSB7CiAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJDUkFTSCEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJjb21pYy1pbXBhY3QiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5zdHVuVGltZXIgPSAxLjU7CgogICAgICAgICAgICBjb25zdCBiYWNrRGlyID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMSkuYXBwbHlRdWF0ZXJuaW9uKHRoaXMubWVzaC5xdWF0ZXJuaW9uKS5ub3JtYWxpemUoKS5uZWdhdGUoKTsKICAgICAgICAgICAgYmFja0Rpci54ICs9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDAuNTsKICAgICAgICAgICAgYmFja0Rpci56ICs9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDAuNTsKICAgICAgICAgICAgYmFja0Rpci5ub3JtYWxpemUoKTsKCiAgICAgICAgICAgIHRoaXMudmVsb2NpdHkuYWRkKGJhY2tEaXIubXVsdGlwbHlTY2FsYXIoMTIuMCkpOwoKICAgICAgICAgICAgaWYgKHRoaXMuaGFzQmFsbCkgewogICAgICAgICAgICAgICAgY29uc3QgYmFsbCA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5lbnRpdGllcy5iYWxsOwogICAgICAgICAgICAgICAgaWYgKGJhbGwpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBlamVjdERpciA9IG5ldyBUSFJFRS5WZWN0b3IzKE1hdGgucmFuZG9tKCktMC41LCAwLjgsIE1hdGgucmFuZG9tKCktMC41KS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgICAgICBiYWxsLnNob290KGVqZWN0RGlyLCA2LjAsICdub25lJyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb3NlQmFsbCgpOwp0aGlzLmxvc2VCYWxsKCk7CgogICAgICAgICAgICAgICAgICAgIHRoaXMuY2F0Y2hDb29sZG93biA9IDEuNTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbkNhdGNoID0gZmFsc2U7CgogICAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudEVOID0gMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZGFzaCh4LCB6KSB7CiAgICAgICAgICAgIGlmICh0aGlzLmlzRGFzaGluZyB8fCB0aGlzLmRhc2hDb29sZG93biA+IDApIHJldHVybjsKICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzLm5hcCA+IDApIHJldHVybjsKCiAgICAgICAgICAgIC8vIE9GRkVOU0U6IEJSRUFLIFRBQ0tMRQogICAgICAgICAgICBpZiAodGhpcy5oYXNCYWxsICYmIHRoaXMuaXNFbmdhZ2VkKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjb3N0ID0gMTU7CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudEVOIDwgY29zdCkgewogICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIkZBSUxFRCEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJkYW1hZ2UiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5mdW1ibGUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50RU4gLT0gY29zdDsKICAgICAgICAgICAgICAgIHRoaXMuaXNEYXNoaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMuZGFzaFRpbWUgPSAwLjQ7CiAgICAgICAgICAgICAgICB0aGlzLmRhc2hDb29sZG93biA9IDIuMDsKICAgICAgICAgICAgICAgIHRoaXMuZGFzaFR5cGUgPSAnYnJlYWsnOwoKICAgICAgICAgICAgICAgIGNvbnN0IGJ1cnN0RGlyID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMSkuYXBwbHlRdWF0ZXJuaW9uKHRoaXMubWVzaC5xdWF0ZXJuaW9uKTsKICAgICAgICAgICAgICAgIHRoaXMudmVsb2NpdHkuYWRkKGJ1cnN0RGlyLm11bHRpcGx5U2NhbGFyKDE1LjApKTsKCiAgICAgICAgICAgICAgICBjb25zdCBnYW1lID0gd2luZG93LmZsdXguZ2FtZUluc3RhbmNlOwogICAgICAgICAgICAgICAgY29uc3Qgb3Bwb25lbnRUZWFtSWQgPSB0aGlzLnRlYW0uaWQgPT09ICdob21lJyA/ICdhd2F5JyA6ICdob21lJzsKICAgICAgICAgICAgICAgIGNvbnN0IG9wcG9uZW50VGVhbSA9IGdhbWUudGVhbXNbb3Bwb25lbnRUZWFtSWRdOwoKICAgICAgICAgICAgICAgIG9wcG9uZW50VGVhbS5wbGF5ZXJzLmZvckVhY2gocCA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFwLm1lc2gpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gdGhpcy5tZXNoLnBvc2l0aW9uLmRpc3RhbmNlVG8ocC5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZGlzdCA8IHRoaXMudGFja2xlUmFkaXVzICogMS41KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHB1c2hEaXIgPSBwLm1lc2gucG9zaXRpb24uY2xvbmUoKS5zdWIodGhpcy5tZXNoLnBvc2l0aW9uKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcHVzaERpci55ID0gMC41OwogICAgICAgICAgICAgICAgICAgICAgICBwLnZlbG9jaXR5LmFkZChwdXNoRGlyLm11bHRpcGx5U2NhbGFyKDE1LjApKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHAuc3R1blRpbWVyID0gMi4wOwogICAgICAgICAgICAgICAgICAgICAgICBwLnBsYXkoJ2NhdGNoJywgMC4yKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnYW1lLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5mbG9hdGluZ1RleHQuc3Bhd24oIlNUVU4hIiwgcC5tZXNoLnBvc2l0aW9uLCAiZGFtYWdlIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCmlmIChnYW1lLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgIGdhbWUuZmxvYXRpbmdUZXh0LnNwYXduKCJCUkVBSyEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJ0ZWNoIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKLy8gTkVXOiBTcGF3biBCcmVhayBHbHlwaCAoRXhwbG9zaXZlIEJ1cnN0KQogICAgICAgICAgICAgICAgaWYgKGdhbWUuZ2x5cGhNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICAgICAgZ2FtZS5nbHlwaE1hbmFnZXIuc3Bhd24oJ3N0YXR1cycsIHRoaXMubWVzaC5wb3NpdGlvbiwgewogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQ6IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGxpZmU6IDAuNSwKICAgICAgICAgICAgICAgICAgICAgICAgcm90YXRpb25TcGVlZDogOC4wLAogICAgICAgICAgICAgICAgICAgICAgICBzY2FsZVNwZWVkOiAzLjAsCiAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldFk6IDAuNQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCi8vIFBhcnRpY2xlIEJ1cnN0IChCcmVhayBUYWNrbGUpCiAgICAgICAgICAgICAgICBpZiAoZ2FtZS5wYXJ0aWNsZU1hbmFnZXIpIHsKICAgICAgICAgICAgICAgICAgICBnYW1lLnBhcnRpY2xlTWFuYWdlci5zcGF3bignc2hvY2t3YXZlJywgdGhpcy5tZXNoLnBvc2l0aW9uLCB7IHNjYWxlOiAyLjAsIGxpZmU6IDAuMyB9KTsKICAgICAgICAgICAgICAgICAgICBnYW1lLnBhcnRpY2xlTWFuYWdlci5zcGF3bignZmxhc2gnLCB0aGlzLm1lc2gucG9zaXRpb24sIHsgc2NhbGU6IDIuNSB9KTsKICAgICAgICAgICAgICAgICAgICAvLyBCdWJibGUgQnVyc3QKICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTwzMDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJQb3MgPSB0aGlzLm1lc2gucG9zaXRpb24uY2xvbmUoKS5hZGQobmV3IFRIUkVFLlZlY3RvcjMoKE1hdGgucmFuZG9tKCktMC41KSwgMS4wKyhNYXRoLnJhbmRvbSgpLTAuNSksIChNYXRoLnJhbmRvbSgpLTAuNSkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5wYXJ0aWNsZU1hbmFnZXIuc3Bhd24oJ2J1YmJsZScsIGJQb3MsIHsgc2NhbGU6IDAuMiArIE1hdGgucmFuZG9tKCkgKiAwLjQgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChnYW1lLnRyaWdnZXJJbXBhY3QpIGdhbWUudHJpZ2dlckltcGFjdCgwLjE1LCAnaGVhdnknKTsKCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIE9GRkVOU0U6IFNQUklOVAogICAgICAgICAgICBpZiAodGhpcy5oYXNCYWxsKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjb3N0ID0gNTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRFTiA8IGNvc3QpIHsKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJOTyBFTiEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJkYW1hZ2UiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudEVOIC09IGNvc3Q7CiAgICAgICAgICAgICAgICB0aGlzLmlzRGFzaGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLmRhc2hUaW1lID0gMC40OwogICAgICAgICAgICAgICAgdGhpcy5kYXNoQ29vbGRvd24gPSAxLjU7CiAgICAgICAgICAgICAgICB0aGlzLmRhc2hUeXBlID0gJ3NwcmludCc7CgogICAgICAgICAgICAgICAgY29uc3QgYnVyc3REaXIgPSB0aGlzLnZlbG9jaXR5LmNsb25lKCkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICBpZiAoYnVyc3REaXIubGVuZ3RoU3EoKSA8IDAuMSkgYnVyc3REaXIuc2V0KDAsIDAsIDEpLmFwcGx5UXVhdGVybmlvbih0aGlzLm1lc2gucXVhdGVybmlvbik7CgogICAgICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS5hZGQoYnVyc3REaXIubXVsdGlwbHlTY2FsYXIoMTUuMCkpOwoKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhTWFuYWdlcikgewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5jYW1lcmFNYW5hZ2VyLmFkZEZvdkltcHVsc2UoMjApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJEQVNIISIsIHRoaXMubWVzaC5wb3NpdGlvbiwgInRlY2giKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gREVGRU5TRTogQkxPQ0sgLyBUQUNLTEUKICAgICAgICAgICAgY29uc3QgYmFsbCA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5lbnRpdGllcy5iYWxsOwogICAgICAgICAgICBsZXQgaXNCbG9ja0NvbnRleHQgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKGJhbGwgJiYgYmFsbC5tZXNoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gdGhpcy5tZXNoLnBvc2l0aW9uLmRpc3RhbmNlVG8oYmFsbC5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgIGlmIChkaXN0IDwgOC4wICYmIGJhbGwubWVzaC5wb3NpdGlvbi55ID4gMi41KSB7CiAgICAgICAgICAgICAgICAgICAgaXNCbG9ja0NvbnRleHQgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmlzRGFzaGluZyA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuZGFzaFRpbWUgPSB0aGlzLmRhc2hUb3RhbFRpbWU7CiAgICAgICAgICAgIHRoaXMuZGFzaENvb2xkb3duID0gMS41OwoKICAgICAgICAgICAgY29uc3QgbGVuID0gTWF0aC5zcXJ0KHgqeCArIHoqeik7CiAgICAgICAgICAgIGNvbnN0IG54ID0gKGxlbiA+IDApID8geC9sZW4gOiAwOwogICAgICAgICAgICBjb25zdCBueiA9IChsZW4gPiAwKSA/IHovbGVuIDogMDsKCmlmIChsZW4gPiAwKSB7CiAgICAgICAgICAgICAgICBsZXQgdGFyZ2V0QW5nbGUgPSBNYXRoLmF0YW4yKG54LCBueik7CiAgICAgICAgICAgICAgICB0YXJnZXRBbmdsZSArPSB0aGlzLnJvdGF0aW9uT2Zmc2V0OwogICAgICAgICAgICAgICAgdGhpcy5tZXNoLnF1YXRlcm5pb24uc2V0RnJvbUF4aXNBbmdsZShfcEF4aXNZLCB0YXJnZXRBbmdsZSk7CiAgICAgICAgICAgICAgICB0aGlzLnN5bmNSb3RhdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChpc0Jsb2NrQ29udGV4dCkgewogICAgICAgICAgICAgICAgdGhpcy5kYXNoVHlwZSA9ICd2ZXJ0aWNhbCc7CgogICAgICAgICAgICAgICAgY29uc3QgZGlyVG9CYWxsID0gYmFsbC5tZXNoLnBvc2l0aW9uLmNsb25lKCkuc3ViKHRoaXMubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICBkaXJUb0JhbGwueSA9IDA7CgogICAgICAgICAgICAgICAgaWYgKGRpclRvQmFsbC5sZW5ndGhTcSgpID4gMC4wMSkgewogICAgICAgICAgICAgICAgICAgIGRpclRvQmFsbC5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmRhc2hWZWMuY29weShkaXJUb0JhbGwpLm11bHRpcGx5U2NhbGFyKDguMCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuZGFzaFZlYy5zZXQoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29uc3QgY2F0Y2hBY3Rpb24gPSB0aGlzLmFjdGlvbnNbJ2NhdGNoJ107CiAgICAgICAgICAgICAgICBpZiAoY2F0Y2hBY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICBjYXRjaEFjdGlvbi5zZXRMb29wKFRIUkVFLkxvb3BPbmNlKTsKICAgICAgICAgICAgICAgICAgICBjYXRjaEFjdGlvbi5jbGFtcFdoZW5GaW5pc2hlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgY2F0Y2hBY3Rpb24udGltZVNjYWxlID0gMS41OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5wbGF5KCdjYXRjaCcsIDAuMSk7CgogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJCTE9DSyEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJkZWZhdWx0Iik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5kYXNoVHlwZSA9ICdob3Jpem9udGFsJzsKICAgICAgICAgICAgICAgIHRoaXMuX2hhc0hpdFRhY2tsZSA9IGZhbHNlOwoKICAgICAgICAgICAgICAgIC8vIEFwcGx5IHZlbG9jaXR5IGltcHVsc2UgaW4gZGFzaCBkaXJlY3Rpb24KICAgICAgICAgICAgICAgIGNvbnN0IGRhc2hEaXIgPSBuZXcgVEhSRUUuVmVjdG9yMyhueCwgMCwgbnopOwogICAgICAgICAgICAgICAgaWYgKGRhc2hEaXIubGVuZ3RoU3EoKSA8IDAuMSkgewogICAgICAgICAgICAgICAgICAgIGRhc2hEaXIuc2V0KDAsIDAsIDEpLmFwcGx5UXVhdGVybmlvbih0aGlzLm1lc2gucXVhdGVybmlvbik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5LmFkZChkYXNoRGlyLm11bHRpcGx5U2NhbGFyKDIwLjApKTsKCiAgICAgICAgICAgICAgICBjb25zdCBsdW5nZUFjdGlvbiA9IHRoaXMuYWN0aW9uc1sndGhyb3cnXTsKICAgICAgICAgICAgICAgIGlmIChsdW5nZUFjdGlvbikgewogICAgICAgICAgICAgICAgICAgIGx1bmdlQWN0aW9uLnNldExvb3AoVEhSRUUuTG9vcE9uY2UpOwogICAgICAgICAgICAgICAgICAgIGx1bmdlQWN0aW9uLmNsYW1wV2hlbkZpbmlzaGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBsdW5nZUFjdGlvbi50aW1lU2NhbGUgPSAyLjA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLnBsYXkoJ3Rocm93JywgMC4xKTsKCiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLnRyaWdnZXJJbXBhY3QpIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS50cmlnZ2VySW1wYWN0KDAuMDUsICdkZWZhdWx0Jyk7CiAgICAgICAgICAgIH0KCmlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhTWFuYWdlcikgewogICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmNhbWVyYU1hbmFnZXIuYWRkRm92SW1wdWxzZSgxMCk7CiAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhTWFuYWdlci5hZGRTaGFrZSgwLjMpOyAvLyBBZGQgc2hha2Ugb24gZGFzaCBzdGFydAogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBfY3JlYXRlSFBCYXIoKSB7CiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IG5ldyBUSFJFRS5Hcm91cCgpOwoKICAgICAgICAgICAgY29uc3QgYmdHZW8gPSBuZXcgVEhSRUUuUGxhbmVHZW9tZXRyeSgxLjIsIDAuMTUpOwogICAgICAgICAgICBjb25zdCBiZ01hdCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7IGNvbG9yOiAweDAwMDAwMCwgc2lkZTogVEhSRUUuRG91YmxlU2lkZSwgZGVwdGhUZXN0OiBmYWxzZSB9KTsKICAgICAgICAgICAgY29uc3QgYmcgPSBuZXcgVEhSRUUuTWVzaChiZ0dlbywgYmdNYXQpOwogICAgICAgICAgICBjb250YWluZXIuYWRkKGJnKTsKCiAgICAgICAgICAgIGNvbnN0IGZpbGxHZW8gPSBuZXcgVEhSRUUuUGxhbmVHZW9tZXRyeSgxLjE2LCAwLjExKTsKICAgICAgICAgICAgZmlsbEdlby50cmFuc2xhdGUoMC41OCwgMCwgMCk7CiAgICAgICAgICAgIGNvbnN0IGZpbGxNYXQgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyBjb2xvcjogMHgwMGZmMDAsIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGUsIGRlcHRoVGVzdDogZmFsc2UgfSk7CiAgICAgICAgICAgIHRoaXMuaHBCYXJGaWxsID0gbmV3IFRIUkVFLk1lc2goZmlsbEdlbywgZmlsbE1hdCk7CiAgICAgICAgICAgIHRoaXMuaHBCYXJGaWxsLnBvc2l0aW9uLnNldCgtMC41OCwgMCwgMC4wMSk7CiAgICAgICAgICAgIGNvbnRhaW5lci5hZGQodGhpcy5ocEJhckZpbGwpOwoKICAgICAgICAgICAgdGhpcy5ocEJhciA9IGNvbnRhaW5lcjsKICAgICAgICAgICAgdGhpcy5zY2VuZS5hZGQodGhpcy5ocEJhcik7CiAgICAgICAgfQoKICAgICAgICBfdXBkYXRlSFBCYXIoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5ocEJhciB8fCAhdGhpcy5tZXNoKSByZXR1cm47CgogICAgICAgICAgICB0aGlzLmhwQmFyLnBvc2l0aW9uLmNvcHkodGhpcy5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgdGhpcy5ocEJhci5wb3NpdGlvbi55ICs9IDIuMjsKCiAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UgJiYgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmNhbWVyYSkgewogICAgICAgICAgICAgICAgdGhpcy5ocEJhci5sb29rQXQod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmNhbWVyYS5wb3NpdGlvbik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IHBjdCA9IE1hdGgubWF4KDAsIHRoaXMuc3RhdHMuSFAgLyB0aGlzLnN0YXRzLm1heEhQKTsKICAgICAgICAgICAgdGhpcy5ocEJhckZpbGwuc2NhbGUuc2V0WChwY3QpOwoKICAgICAgICAgICAgaWYgKHBjdCA+IDAuNSkgdGhpcy5ocEJhckZpbGwubWF0ZXJpYWwuY29sb3Iuc2V0SGV4KDB4MDBmZjAwKTsKICAgICAgICAgICAgZWxzZSBpZiAocGN0ID4gMC4yNSkgdGhpcy5ocEJhckZpbGwubWF0ZXJpYWwuY29sb3Iuc2V0SGV4KDB4ZmZmZjAwKTsKICAgICAgICAgICAgZWxzZSB0aGlzLmhwQmFyRmlsbC5tYXRlcmlhbC5jb2xvci5zZXRIZXgoMHhmZjAwMDApOwoKICAgICAgICAgICAgdGhpcy5ocEJhci52aXNpYmxlID0gKHBjdCA8IDAuOTgpOwogICAgICAgIH0KCiAgICAgICAgZ2FpbkV4cChhbW91bnQpIHsKICAgICAgICAgICAgaWYgKCF3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UgfHwgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLnN0YXRlICE9PSAnYWN0aXZlJykgcmV0dXJuOwoKICAgICAgICAgICAgdGhpcy5leHAgKz0gYW1vdW50OwoKICAgICAgICAgICAgaWYgKHRoaXMuZXhwID49IHRoaXMubmV4dExldmVsRXhwKSB7CiAgICAgICAgICAgICAgICB0aGlzLmxldmVsVXAoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgbGV2ZWxVcCgpIHsKICAgICAgICAgICAgdGhpcy5sZXZlbCsrOwogICAgICAgICAgICB0aGlzLmV4cCAtPSB0aGlzLm5leHRMZXZlbEV4cDsKICAgICAgICAgICAgdGhpcy5uZXh0TGV2ZWxFeHAgPSBNYXRoLmZsb29yKHRoaXMubmV4dExldmVsRXhwICogMS41KTsKCiAgICAgICAgICAgIGNvbnN0IGtleXMgPSBbJ0hQJywgJ0VOJywgJ0FUJywgJ1BBJywgJ0JMJywgJ1NIJywgJ0NBJywgJ1NQJ107CgogICAgICAgICAgICBjb25zdCBocEdhaW4gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyMCkgKyAxMDsKICAgICAgICAgICAgdGhpcy5zdGF0cy5tYXhIUCArPSBocEdhaW47CiAgICAgICAgICAgIHRoaXMuc3RhdHMuSFAgPSB0aGlzLnN0YXRzLm1heEhQOwoKICAgICAgICAgICAga2V5cy5mb3JFYWNoKGsgPT4gewogICAgICAgICAgICAgICAgaWYgKGsgPT09ICdIUCcpIHJldHVybjsKICAgICAgICAgICAgICAgIGlmIChNYXRoLnJhbmRvbSgpID4gMC40KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZ2FpbiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpICsgMTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRzW2tdICs9IGdhaW47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgdGhpcy5fdXBkYXRlRGVyaXZlZFN0YXRzKCk7CgogICAgICAgICAgICBjb25zb2xlLmxvZyhgJHt0aGlzLnJvbGV9IHJlYWNoZWQgTGV2ZWwgJHt0aGlzLmxldmVsfSFgKTsKCiAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0ICYmIHRoaXMubWVzaCkgewogICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dC5zcGF3bigiTEVWRUwgVVAhIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAidGVjaCIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBfY2hlY2tUYWNrbGVDb2xsaXNpb24oKSB7CiAgICAgICAgICAgIGlmICghdGhpcy50ZWFtIHx8IHRoaXMuX2hhc0hpdFRhY2tsZSkgcmV0dXJuOwoKICAgICAgICAgICAgY29uc3QgZ2FtZSA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZTsKICAgICAgICAgICAgaWYgKCFnYW1lKSByZXR1cm47CgogICAgICAgICAgICBjb25zdCBvcHBvbmVudFRlYW1JZCA9IHRoaXMudGVhbS5pZCA9PT0gJ2hvbWUnID8gJ2F3YXknIDogJ2hvbWUnOwogICAgICAgICAgICBjb25zdCBvcHBvbmVudFRlYW0gPSBnYW1lLnRlYW1zW29wcG9uZW50VGVhbUlkXTsKCiAgICAgICAgICAgIGZvciAoY29uc3Qgb3BwIG9mIG9wcG9uZW50VGVhbS5wbGF5ZXJzKSB7CiAgICAgICAgICAgICAgICBpZiAoIW9wcC5tZXNoKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGNvbnN0IGRpc3QgPSB0aGlzLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyhvcHAubWVzaC5wb3NpdGlvbik7CgppZiAoZGlzdCA8IDMuMCkgeyAvLyBJbmNyZWFzZWQgZnJvbSAyLjAgZm9yIGVhc2llciBoaXRzCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVzb2x2ZVRhY2tsZUhpdChvcHApOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2hhc0hpdFRhY2tsZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBfcmVzb2x2ZVRhY2tsZUhpdChvcHApIHsKICAgICAgICAgICAgdGhpcy5pc0Rhc2hpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS5tdWx0aXBseVNjYWxhcigtMC41KTsKICAgICAgICAgICAgdGhpcy5wbGF5KCdpZGxlJywgMC4yKTsKCiAgICAgICAgICAgIGNvbnN0IGF0ID0gdGhpcy5nZXRTdGF0KCdBVCcpOwogICAgICAgICAgICBsZXQgZGFtYWdlID0gYXQgKiAzLjA7CgogICAgICAgICAgICBpZiAodGhpcy50ZWNocy50YWNrbGUgPT09ICd2ZW5vbScpIHsKICAgICAgICAgICAgICAgIG9wcC5hcHBseVN0YXR1cygndmVub20nLCAxMC4wKTsKICAgICAgICAgICAgICAgIGRhbWFnZSArPSA1OwogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMudGVjaHMudGFja2xlID09PSAnd2l0aGVyJykgewogICAgICAgICAgICAgICAgb3BwLmFwcGx5U3RhdHVzKCd3aXRoZXInLCAxMC4wLCAnRU4nKTsKICAgICAgICAgICAgICAgIGRhbWFnZSArPSA1OwogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMudGVjaHMudGFja2xlID09PSAnZHJhaW4nKSB7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXRzLkhQICs9IDIwOwogICAgICAgICAgICAgICAgb3BwLnN0YXRzLkhQIC09IDIwOwogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQpCiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dC5zcGF3bigiRFJBSU4iLCB0aGlzLm1lc2gucG9zaXRpb24sICJoZWFsIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChvcHAuaGFzQmFsbCkgewogICAgICAgICAgICAgICAgb3BwLmN1cnJlbnRFTiAtPSBkYW1hZ2U7CgppZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZWQgIkVOIiBzdWZmaXggZm9yIGNsZWFuZXIgbG9vawogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oYCR7TWF0aC5mbG9vcihkYW1hZ2UpfWAsIG9wcC5tZXNoLnBvc2l0aW9uLCAiZGFtYWdlIik7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dC5zcGF3bigiQkFNISIsIG9wcC5tZXNoLnBvc2l0aW9uLCAiY29taWMtaW1wYWN0Iik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKG9wcC5jdXJyZW50RU4gPD0gMCkgewogICAgICAgICAgICAgICAgICAgIG9wcC5mdW1ibGUoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgb3BwLnN0dW5UaW1lciA9IDAuNTsKICAgICAgICAgICAgICAgICAgICBvcHAucGxheSgncmVhY3QnLCAwLjEpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0aGlzLnRlY2hzLnRhY2tsZSAmJiB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UudHJpZ2dlclRlY2hFdmVudCkgewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS50cmlnZ2VyVGVjaEV2ZW50KHRoaXMsIHRoaXMudGVjaHMudGFja2xlKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBvcHAuc3R1blRpbWVyID0gMS4wOwogICAgICAgICAgICAgICAgb3BwLnBsYXkoJ3JlYWN0JywgMC4xKTsKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dC5zcGF3bigiU01BQ0shIiwgb3BwLm1lc2gucG9zaXRpb24sICJjb21pYy1pbXBhY3QiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgcHVzaERpciA9IG9wcC5tZXNoLnBvc2l0aW9uLmNsb25lKCkuc3ViKHRoaXMubWVzaC5wb3NpdGlvbikubm9ybWFsaXplKCk7CiAgICAgICAgICAgIHB1c2hEaXIueSA9IDAuMjsKICAgICAgICAgICAgb3BwLnZlbG9jaXR5LmFkZChwdXNoRGlyLm11bHRpcGx5U2NhbGFyKDEyLjApKTsKCiAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UudHJpZ2dlckltcGFjdCkgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLnRyaWdnZXJJbXBhY3QoMC4xLCAnaGVhdnknKTsKICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5jYW1lcmFNYW5hZ2VyKSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhTWFuYWdlci5hZGRTaGFrZSgwLjgpOwogICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLnNwYXduQ2xhc2gpIHsKY29uc3QgbWlkID0gdGhpcy5tZXNoLnBvc2l0aW9uLmNsb25lKCkuYWRkKG9wcC5tZXNoLnBvc2l0aW9uKS5tdWx0aXBseVNjYWxhcigwLjUpOwogICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLnNwYXduQ2xhc2gobWlkKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKLy8gQnViYmxlIEJ1cnN0IChUYWNrbGUgSGl0KQogICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLnBhcnRpY2xlTWFuYWdlcikgewogICAgICAgICAgICAgICAgY29uc3QgbWlkID0gdGhpcy5tZXNoLnBvc2l0aW9uLmNsb25lKCkubGVycChvcHAubWVzaC5wb3NpdGlvbiwgMC41KTsKICAgICAgICAgICAgICAgIG1pZC55ICs9IDEuMDsKICAgICAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpPDMwOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBidWJibGVQb3MgPSBtaWQuY2xvbmUoKS5hZGQobmV3IFRIUkVFLlZlY3RvcjMoKE1hdGgucmFuZG9tKCktMC41KSoxLjUsIChNYXRoLnJhbmRvbSgpLTAuNSkqMS41LCAoTWF0aC5yYW5kb20oKS0wLjUpKjEuNSkpOwogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5wYXJ0aWNsZU1hbmFnZXIuc3Bhd24oJ2J1YmJsZScsIGJ1YmJsZVBvcywgeyBzY2FsZTogMC4xNSArIE1hdGgucmFuZG9tKCkgKiAwLjM1IH0pOwogICAgICAgICAgICAgICAgfQp9CiAgICAgICAgfQogICAgICAgIF9hcHBseUdvYWxDcmVhc2UoZHQpIHsKICAgICAgICAgICAgaWYgKHRoaXMucm9sZSA9PT0gJ0dMJykgcmV0dXJuOwoKICAgICAgICAgICAgY29uc3QgZ29hbHMgPSBbCiAgICAgICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAyOCksCiAgICAgICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAtMjgpCiAgICAgICAgICAgIF07CiAgICAgICAgICAgIGNvbnN0IHJhZGl1cyA9IDEwLjA7CgogICAgICAgICAgICBnb2Fscy5mb3JFYWNoKGdvYWwgPT4gewogICAgICAgICAgICAgICAgY29uc3QgZHggPSB0aGlzLm1lc2gucG9zaXRpb24ueCAtIGdvYWwueDsKICAgICAgICAgICAgICAgIGNvbnN0IGR6ID0gdGhpcy5tZXNoLnBvc2l0aW9uLnogLSBnb2FsLno7CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0U3EgPSBkeCpkeCArIGR6KmR6OwoKICAgICAgICAgICAgICAgIGlmIChkaXN0U3EgPCByYWRpdXMgKiByYWRpdXMpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gTWF0aC5zcXJ0KGRpc3RTcSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHVzaFggPSBkaXN0ID4gMCA/IGR4IC8gZGlzdCA6IDE7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHVzaFogPSBkaXN0ID4gMCA/IGR6IC8gZGlzdCA6IDA7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGZvcmNlID0gNTAuMDsKICAgICAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5LnggKz0gcHVzaFggKiBmb3JjZSAqIGR0OwogICAgICAgICAgICAgICAgICAgIHRoaXMudmVsb2NpdHkueiArPSBwdXNoWiAqIGZvcmNlICogZHQ7CgogICAgICAgICAgICAgICAgICAgIGlmIChkaXN0IDwgcmFkaXVzIC0gMC41KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNsYW1wUmF0aW8gPSByYWRpdXMgLyAoZGlzdCArIDAuMDAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNoLnBvc2l0aW9uLnggPSBnb2FsLnggKyBkeCAqIGNsYW1wUmF0aW87CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi56ID0gZ29hbC56ICsgZHogKiBjbGFtcFJhdGlvOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQoKICAgIHdpbmRvdy5mbHV4LlBsYXllciA9IFBsYXllcjsKfSkoKTsK","/Player.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCi8vIFJldXNhYmxlIG1hdGggb2JqZWN0cwogICAgY29uc3QgX3BWZWMgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgY29uc3QgX3BRdWF0ID0gbmV3IFRIUkVFLlF1YXRlcm5pb24oKTsKICAgIGNvbnN0IF9wVGFyZ2V0UXVhdCA9IG5ldyBUSFJFRS5RdWF0ZXJuaW9uKCk7CmNvbnN0IF9wQXhpc1kgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAxLCAwKTsKICAgIGNvbnN0IF9wQXhpc1ogPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAxKTsKCmNsYXNzIFBsYXllciB7CiAgICAgICAgY29uc3RydWN0b3Ioc2NlbmUsIHJvbGUgPSAnTUYnKSB7CiAgICAgICAgICAgIHRoaXMuc2NlbmUgPSBzY2VuZTsKICAgICAgICAgICAgdGhpcy5yb2xlID0gcm9sZTsKICAgICAgICAgICAgdGhpcy50ZWFtID0gbnVsbDsgLy8gQXNzaWduZWQgYnkgVGVhbS5hZGRQbGF5ZXIKICAgICAgICAgICAgdGhpcy5ob21lUG9zaXRpb24gPSBuZXcgVEhSRUUuVmVjdG9yMygpOwoKICAgICAgICAgICAgdGhpcy5tZXNoID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5taXhlciA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuYWN0aW9ucyA9IHt9OwogICAgICAgICAgICB0aGlzLmFjdGl2ZUFjdGlvbiA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSAnaWRsZSc7CiAgICAgICAgICAgIHRoaXMuaW5wdXRWZWN0b3IgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAwKTsKCiAgICAgICAgICAgIC8vIFBoeXNpY3MgKERyaWZ0L0luZXJ0aWEgTW9kZWwpCiAgICAgICAgICAgIHRoaXMudmVsb2NpdHkgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAwKTsKICAgICAgICAgICAgdGhpcy5hY2NlbGVyYXRpb24gPSAxMi4wOwogICAgICAgICAgICB0aGlzLmRyYWcgPSAzLjA7CiAgICAgICAgICAgIHRoaXMubWF4U3BlZWQgPSA4LjA7CiAgICAgICAgICAgIC8vIEJvbmUgcmVmZXJlbmNlIGZvciBob2xkaW5nIGJhbGwKICAgICAgICAgICAgdGhpcy5oYW5kQm9uZSA9IG51bGw7CnRoaXMuY2FuQ2F0Y2ggPSB0cnVlOwogICAgICAgICAgICB0aGlzLmNhdGNoQ29vbGRvd24gPSAwOyAvLyBSZXBsYWNlcyBzZXRUaW1lb3V0IGZvciBzYWZldHkKCiAgICAgICAgICAgIC8vIEJsaXR6YmFsbCBTdGF0cwogICAgICAgICAgICB0aGlzLnN0YXRzID0gewogICAgICAgICAgICAgICAgSFA6IDEwMCwKICAgICAgICAgICAgICAgIG1heEhQOiAxMDAsCiAgICAgICAgICAgICAgICBFTjogMzAsCiAgICAgICAgICAgICAgICBBVDogMTAsCiAgICAgICAgICAgICAgICBQQTogMTUsCiAgICAgICAgICAgICAgICBCTDogMTAsCiAgICAgICAgICAgICAgICBTSDogMTUsCiAgICAgICAgICAgICAgICBDQTogMTAsCiAgICAgICAgICAgICAgICBTUDogNjAKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8vIExldmVsaW5nIFN5c3RlbQogICAgICAgICAgICB0aGlzLmxldmVsID0gMTsKICAgICAgICAgICAgdGhpcy5leHAgPSAwOwogICAgICAgICAgICB0aGlzLm5leHRMZXZlbEV4cCA9IDEwMDsKCiAgICAgICAgICAgIC8vIFN0YXR1cyBFZmZlY3RzICYgVGVjaG5pcXVlcwogICAgICAgICAgICB0aGlzLnN0YXR1cyA9IHsKICAgICAgICAgICAgICAgIHZlbm9tOiAwLAogICAgICAgICAgICAgICAgbmFwOiAwLAogICAgICAgICAgICAgICAgd2l0aGVyOiB7IFBBOiAwLCBTSDogMCwgQVQ6IDAsIEJMOiAwLCBDQTogMCwgU1A6IDAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgdGhpcy5tYXJraW5nID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5sZWFybmVkVGVjaHMgPSBbXTsKCiAgICAgICAgICAgIHRoaXMudGVjaHMgPSB7CiAgICAgICAgICAgICAgICB0YWNrbGU6IG51bGwsCiAgICAgICAgICAgICAgICBzaG9vdDogbnVsbCwKICAgICAgICAgICAgICAgIHBhc3M6IG51bGwsCiAgICAgICAgICAgICAgICBwYXNzaXZlOiBudWxsCiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBWaXN1YWxzCiAgICAgICAgICAgIHRoaXMuYmFzZUNvbG9ySGV4ID0gMHhmZmZmZmY7CiAgICAgICAgICAgIHRoaXMub3JpZ2luYWxNYXRlcmlhbHMgPSBbXTsKICAgICAgICAgICAgdGhpcy5hdXJhTWVzaCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMucm90YXRpb25PZmZzZXQgPSAwOwp0aGlzLmJhc2VTY2FsZSA9IDEuMTc7IC8vIEluY3JlYXNlZCB+OCUKCiAgICAgICAgICAgIC8vIFJlYWwtdGltZSBTdGF0cwogICAgICAgICAgICB0aGlzLmN1cnJlbnRFTiA9IHRoaXMuc3RhdHMuRU47CnRoaXMudGFja2xlUmFkaXVzID0gMi4wOyAvLyBSZWR1Y2VkIGZyb20gMi41IHRvIHJlZHVjZSBzd2FybSBsb2NrCgogICAgICAgICAgICB0aGlzLnNwZWVkID0gNC4wOwogICAgICAgICAgICB0aGlzLl91cGRhdGVEZXJpdmVkU3RhdHMoKTsKCiAgICAgICAgICAgIHRoaXMuaGFzQmFsbCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmlzVGhyb3dpbmcgPSBmYWxzZTsKCiAgICAgICAgICAgIC8vIERhc2ggU3RhdGUKICAgICAgICAgICAgdGhpcy5pc0Rhc2hpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5kYXNoVGltZSA9IDA7CiAgICAgICAgICAgIHRoaXMuZGFzaFRvdGFsVGltZSA9IDAuNTsKICAgICAgICAgICAgdGhpcy5kYXNoQ29vbGRvd24gPSAwOwp0aGlzLmRhc2hDb29sZG93biA9IDA7CiAgICAgICAgICAgIHRoaXMuY2xhc2hDb29sZG93biA9IDA7IC8vIENvb2xkb3duIGZvciBpbmZsaWN0aW5nIHRhY2tsZXMKICAgICAgICAgICAgdGhpcy5kYXNoVmVjID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKCiAgICAgICAgICAgIC8vIEZlZWRiYWNrIEFjY3VtdWxhdG9ycwogICAgICAgICAgICB0aGlzLl9hY2N1bXVsYXRlZERhbWFnZSA9IDA7CiAgICAgICAgICAgIHRoaXMuX2RhbWFnZVRpbWVyID0gMDsKCiAgICAgICAgICAgIC8vIEhQIEJhcgogICAgICAgICAgICB0aGlzLmhwQmFyID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5ocEJhckZpbGwgPSBudWxsOwoKICAgICAgICAgICAgLy8gR2FtZXBsYXkgRmxvdyBUaW1lcnMKICAgICAgICAgICAgdGhpcy5zdHVuVGltZXIgPSAwOwogICAgICAgICAgICB0aGlzLmltbXVuaXR5VGltZXIgPSAwOwoKICAgICAgICAgICAgLy8gQmFua2luZyAmIFZlcnRpY2FsaXR5CiAgICAgICAgICAgIHRoaXMuYmFua2luZ0Ftb3VudCA9IDA7CiAgICAgICAgICAgIHRoaXMudGFyZ2V0WSA9IDA7CgogICAgICAgICAgICAvLyBFbmNvdW50ZXIgU3lzdGVtCiAgICAgICAgICAgIHRoaXMuaXNFbmdhZ2VkID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuY2xhc2hUaW1lciA9IDA7CnRoaXMuY2xhc2hUaW1lciA9IDA7CiAgICAgICAgICAgIHRoaXMuZW5jb3VudGVyVGltZXIgPSAwOyAvLyBUcmFjayBkdXJhdGlvbiBvZiBjdXJyZW50IGVuZ2FnZW1lbnQKICAgICAgICAgICAgLy8gQ2hhcmdlIE1lY2hhbmljCiAgICAgICAgICAgIHRoaXMuaXNDaGFyZ2luZyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmNoYXJnZVRpbWUgPSAwOwogICAgICAgICAgICB0aGlzLm1heENoYXJnZVRpbWUgPSAxLjU7CgogICAgICAgICAgICAvLyBGSVhFRDogSW1wcm92ZWQgUm90YXRpb24gU3RhdGUgd2l0aCBoeXN0ZXJlc2lzCiAgICAgICAgICAgIHRoaXMuY3VycmVudFlhdyA9IDA7CiAgICAgICAgICAgIHRoaXMudGFyZ2V0WWF3ID0gMDsKICAgICAgICAgICAgdGhpcy5sYXN0VmFsaWRZYXcgPSAwOyAvLyBTdG9yZSBsYXN0IGtub3duIGdvb2QgeWF3IGZvciBkZWFkem9uZSBoYW5kbGluZwogICAgICAgICAgICB0aGlzLnBpdGNoQW1vdW50ID0gMDsKICAgICAgICAgICAgdGhpcy5iYW5raW5nQW1vdW50ID0gMDsKICAgICAgICAgICAgdGhpcy5mYWNpbmdEZWFkem9uZSA9IDAuMzsgLy8gTWluaW11bSBpbnB1dC92ZWxvY2l0eSBtYWduaXR1ZGUgdG8gdXBkYXRlIGZhY2luZwoKICAgICAgICAgICAgLy8gUGFydGljbGUgRW1pc3Npb24gVGltZXJzCiAgICAgICAgICAgIHRoaXMuX3BhcnRpY2xlVGltZXJzID0gewogICAgICAgICAgICAgICAgdmVub206IDAsCiAgICAgICAgICAgICAgICBuYXA6IDAsCiAgICAgICAgICAgICAgICB3aXRoZXI6IDAKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8vIERldlRvb2xzIEZsYWdzCiAgICAgICAgICAgIHRoaXMuaXNHb2RNb2RlID0gZmFsc2U7CgogICAgICAgICAgICAvLyBQYXNzIFRhcmdldCBJbmRpY2F0b3IKLy8gUGFzcyBUYXJnZXQgSW5kaWNhdG9yCiAgICAgICAgICAgIHRoaXMucGFzc1RhcmdldEluZGljYXRvciA9IG51bGw7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBCdWJibGUgVHJhaWwgVGltZXIKICAgICAgICAgICAgdGhpcy5fYnViYmxlVGltZXIgPSAwOwp0aGlzLl9idWJibGVUaW1lciA9IDA7CiAgICAgICAgfQogICAgICAgIHN5bmNSb3RhdGlvbigpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLm1lc2gpIHJldHVybjsKICAgICAgICAgICAgY29uc3QgZXVsZXIgPSBuZXcgVEhSRUUuRXVsZXIoKS5zZXRGcm9tUXVhdGVybmlvbih0aGlzLm1lc2gucXVhdGVybmlvbiwgJ1lYWicpOwogICAgICAgICAgICB0aGlzLmN1cnJlbnRZYXcgPSBldWxlci55IC0gdGhpcy5yb3RhdGlvbk9mZnNldDsKICAgICAgICAgICAgdGhpcy50YXJnZXRZYXcgPSB0aGlzLmN1cnJlbnRZYXc7CiAgICAgICAgICAgIHRoaXMubGFzdFZhbGlkWWF3ID0gdGhpcy5jdXJyZW50WWF3OwogICAgICAgICAgICB0aGlzLmJhbmtpbmdBbW91bnQgPSAwOwogICAgICAgICAgICB0aGlzLnBpdGNoQW1vdW50ID0gMDsKICAgICAgICB9CgogICAgICAgIGdldFN0YXQobmFtZSkgewogICAgICAgICAgICBsZXQgdmFsID0gdGhpcy5zdGF0c1tuYW1lXTsKICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzLndpdGhlcltuYW1lXSA+IDApIHsKICAgICAgICAgICAgICAgIHZhbCAqPSAwLjU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgICB9CgogICAgICAgIGFwcGx5U3RhdHVzKHR5cGUsIGR1cmF0aW9uLCBzdWJUeXBlID0gbnVsbCkgewogICAgICAgICAgICBpZiAodHlwZSA9PT0gJ3Zlbm9tJykgewogICAgICAgICAgICAgICAgY29uc3Qgd2FzQWN0aXZlID0gdGhpcy5zdGF0dXMudmVub20gPiAxLjA7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXR1cy52ZW5vbSA9IE1hdGgubWF4KHRoaXMuc3RhdHVzLnZlbm9tLCBkdXJhdGlvbik7CgogICAgICAgICAgICAgICAgaWYgKCF3YXNBY3RpdmUpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgJHt0aGlzLnJvbGV9IHBvaXNvbmVkIWApOwogICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0KQogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJQT0lTT04iLCB0aGlzLm1lc2gucG9zaXRpb24sICJzdGF0dXMiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnbmFwJykgewogICAgICAgICAgICAgICAgY29uc3Qgd2FzQWN0aXZlID0gdGhpcy5zdGF0dXMubmFwID4gMS4wOwogICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMubmFwID0gTWF0aC5tYXgodGhpcy5zdGF0dXMubmFwLCBkdXJhdGlvbik7CgogICAgICAgICAgICAgICAgaWYgKCF3YXNBY3RpdmUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5oYXNCYWxsKSB0aGlzLmZ1bWJsZSgpOwogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAke3RoaXMucm9sZX0gZmVsbCBhc2xlZXAhYCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQpCiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIlNMRUVQIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAic3RhdHVzIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ3dpdGhlcicgJiYgc3ViVHlwZSkgewogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFZhbCA9IHRoaXMuc3RhdHVzLndpdGhlcltzdWJUeXBlXSB8fCAwOwogICAgICAgICAgICAgICAgY29uc3Qgd2FzQWN0aXZlID0gY3VycmVudFZhbCA+IDEuMDsKICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzLndpdGhlcltzdWJUeXBlXSA9IE1hdGgubWF4KGN1cnJlbnRWYWwsIGR1cmF0aW9uKTsKCiAgICAgICAgICAgICAgICBpZiAoIXdhc0FjdGl2ZSkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAke3RoaXMucm9sZX0gd2l0aGVyZWQgJHtzdWJUeXBlfSFgKTsKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dC5zcGF3bihgV0lUSEVSICR7c3ViVHlwZX1gLCB0aGlzLm1lc2gucG9zaXRpb24sICJzdGF0dXMiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX3VwZGF0ZURlcml2ZWRTdGF0cygpIHsKICAgICAgICAgICAgY29uc3Qgc3AgPSB0aGlzLmdldFN0YXQoJ1NQJyk7CiAgICAgICAgICAgIHRoaXMubWF4U3BlZWQgPSA1LjAgKyAoc3AgLyAxNS4wKTsKICAgICAgICAgICAgdGhpcy5jdXJyZW50RU4gPSB0aGlzLmdldFN0YXQoJ0VOJyk7CiAgICAgICAgfQoKc2V0TWVzaChzb3VyY2VNZXNoLCBhbmltYXRpb25zKSB7CiAgICAgICAgICAgIHRoaXMubWVzaCA9IHNvdXJjZU1lc2g7CiAgICAgICAgICAgIHRoaXMuc2NlbmUuYWRkKHRoaXMubWVzaCk7CiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUhQQmFyKCk7CiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUF1cmEoKTsKICAgICAgICAgICAgdGhpcy5fY3JlYXRlUGFzc1RhcmdldEluZGljYXRvcigpOwoKICAgICAgICAgICAgLy8gQ3VzdG9tIENoYXJhY3RlciBTY2FsaW5nCiAgICAgICAgICAgIGlmICh0aGlzLmNoYXJhY3Rlck5hbWUpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoYXJhY3Rlck5hbWUuaW5jbHVkZXMoJ1RpZHVzJykpIHRoaXMuYmFzZVNjYWxlID0gMS42OwogICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5jaGFyYWN0ZXJOYW1lLmluY2x1ZGVzKCdXYWtrYScpKSB0aGlzLmJhc2VTY2FsZSA9IDEuNDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5tZXNoLnNjYWxlLnNldFNjYWxhcih0aGlzLmJhc2VTY2FsZSk7CgogICAgICAgICAgICB0aGlzLm1lc2gudHJhdmVyc2UoKG5vZGUpID0+IHsKICAgICAgICAgICAgICAgIGlmIChub2RlLmlzTWVzaCAmJiBub2RlLm1hdGVyaWFsKSB7CmNvbnN0IGNvbnZlcnRPbmUgPSAobWF0KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG0gPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwOiBtYXQubWFwIHx8IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogbmV3IFRIUkVFLkNvbG9yKDB4ZmZmZmZmKSwgLy8gRk9SQ0UgV0hJVEU6IElnbm9yZSBzb3VyY2UgY29sb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zcGFyZW50OiAhIW1hdC50cmFuc3BhcmVudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IChtYXQub3BhY2l0eSAhPT0gdW5kZWZpbmVkID8gbWF0Lm9wYWNpdHkgOiAxKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFscGhhVGVzdDogKG1hdC5hbHBoYVRlc3QgIT09IHVuZGVmaW5lZCA/IG1hdC5hbHBoYVRlc3QgOiAwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZGU6IG1hdC5zaWRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVwdGhUZXN0OiBtYXQuZGVwdGhUZXN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVwdGhXcml0ZTogbWF0LmRlcHRoV3JpdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb2c6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBza2lubmluZzogISFub2RlLmlzU2tpbm5lZE1lc2gKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3JpZ2luYWxNYXRlcmlhbHMucHVzaCh7IG1hdGVyaWFsOiBtLCBiYXNlQ29sb3I6IG0uY29sb3IuY2xvbmUoKSB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG07CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBub2RlLm1hdGVyaWFsID0gQXJyYXkuaXNBcnJheShub2RlLm1hdGVyaWFsKQogICAgICAgICAgICAgICAgICAgICAgICA/IG5vZGUubWF0ZXJpYWwubWFwKGNvbnZlcnRPbmUpCiAgICAgICAgICAgICAgICAgICAgICAgIDogY29udmVydE9uZShub2RlLm1hdGVyaWFsKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAobm9kZS5pc0JvbmUpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBuYW1lID0gbm9kZS5uYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKChuYW1lLmluY2x1ZGVzKCdoYW5kJykgJiYgbmFtZS5pbmNsdWRlcygncicpKSB8fCBuYW1lLmluY2x1ZGVzKCdyaWdodGhhbmQnKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRCb25lID0gbm9kZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgdGhpcy5taXhlciA9IG5ldyBUSFJFRS5BbmltYXRpb25NaXhlcih0aGlzLm1lc2gpOwoKICAgICAgICAgICAgaWYgKGFuaW1hdGlvbnMpIHsKICAgICAgICAgICAgICAgIGFuaW1hdGlvbnMuZm9yRWFjaCgoY2xpcCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBjbGlwLm5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICBsZXQgYWN0aW9uID0gdGhpcy5taXhlci5jbGlwQWN0aW9uKGNsaXApOwoKICAgICAgICAgICAgICAgICAgICBpZiAobmFtZS5pbmNsdWRlcygndHJlYWRpbmcnKSB8fCBuYW1lLmluY2x1ZGVzKCdpZGxlJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3Rpb25zWydpZGxlJ10gPSBhY3Rpb247CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuYW1lLmluY2x1ZGVzKCdzd2ltJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3Rpb25zWydzd2ltJ10gPSBhY3Rpb247CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuYW1lLmluY2x1ZGVzKCd0aHJvdycpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aW9uc1sndGhyb3cnXSA9IGFjdGlvbjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5hbWUuaW5jbHVkZXMoJ2NhdGNoJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3Rpb25zWydjYXRjaCddID0gYWN0aW9uOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobmFtZS5pbmNsdWRlcygncmVhY3QnKSB8fCBuYW1lLmluY2x1ZGVzKCdnZXRoaXQnKSB8fCBuYW1lLmluY2x1ZGVzKCdoaXQnKSB8fCBuYW1lLmluY2x1ZGVzKCdodXJ0JykgfHwgbmFtZS5pbmNsdWRlcygnZGFtYWdlJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3Rpb25zWydyZWFjdCddID0gYWN0aW9uOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aW9uc1tjbGlwLm5hbWVdID0gYWN0aW9uOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy5hY3Rpb25zWydpZGxlJ10pIHsKICAgICAgICAgICAgICAgIHRoaXMucGxheSgnaWRsZScpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgZmlyc3QgPSBPYmplY3QudmFsdWVzKHRoaXMuYWN0aW9ucylbMF07CiAgICAgICAgICAgICAgICBpZihmaXJzdCkgZmlyc3QucGxheSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwbGF5KGFjdGlvbk5hbWUsIGR1cmF0aW9uID0gMC41KSB7CiAgICAgICAgICAgIGNvbnN0IG5ld0FjdGlvbiA9IHRoaXMuYWN0aW9uc1thY3Rpb25OYW1lXTsKICAgICAgICAgICAgaWYgKCFuZXdBY3Rpb24gfHwgbmV3QWN0aW9uID09PSB0aGlzLmFjdGl2ZUFjdGlvbikgcmV0dXJuOwoKICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlQWN0aW9uKSB7CiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUFjdGlvbi5mYWRlT3V0KGR1cmF0aW9uKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbmV3QWN0aW9uLnJlc2V0KCk7CiAgICAgICAgICAgIG5ld0FjdGlvbi5mYWRlSW4oZHVyYXRpb24pOwogICAgICAgICAgICBuZXdBY3Rpb24ucGxheSgpOwogICAgICAgICAgICB0aGlzLmFjdGl2ZUFjdGlvbiA9IG5ld0FjdGlvbjsKICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IGFjdGlvbk5hbWU7CiAgICAgICAgfQoKICAgICAgICBzZXRJbnB1dCh4LCB6KSB7CiAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cy5uYXAgPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLmlucHV0VmVjdG9yLnNldCgwLCAwLCAwKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmlucHV0VmVjdG9yLnNldCh4LCAwLCB6KTsKICAgICAgICB9CgogICAgICAgIHJlY2VpdmVCYWxsKCkgewogICAgICAgICAgICB0aGlzLmNhbkNhdGNoID0gZmFsc2U7CgogICAgICAgICAgICBpZiAodGhpcy5zdGF0dXMubmFwID4gMCkgewogICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMubmFwID0gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5oYXNCYWxsID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5pbW11bml0eVRpbWVyID0gMi4wOwoKICAgICAgICAgICAgY29uc3QgYmFsbCA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5lbnRpdGllcy5iYWxsOwogICAgICAgICAgICBpZiAoYmFsbCAmJiBiYWxsLmxhc3RIb2xkZXIgJiYgYmFsbC5sYXN0SG9sZGVyLnRlYW0gPT09IHRoaXMudGVhbSAmJiBiYWxsLmxhc3RIb2xkZXIgIT09IHRoaXMpIHsKICAgICAgICAgICAgICAgIGJhbGwubGFzdEhvbGRlci5nYWluRXhwKDIpOwogICAgICAgICAgICAgICAgdGhpcy5nYWluRXhwKDEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCBjYXRjaEFjdGlvbiA9IHRoaXMuYWN0aW9uc1snY2F0Y2gnXTsKCiAgICAgICAgICAgIGlmIChjYXRjaEFjdGlvbikgewogICAgICAgICAgICAgICAgY2F0Y2hBY3Rpb24uc2V0TG9vcChUSFJFRS5Mb29wT25jZSk7CiAgICAgICAgICAgICAgICBjYXRjaEFjdGlvbi5jbGFtcFdoZW5GaW5pc2hlZCA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMucGxheSgnY2F0Y2gnLCAwLjEpOwoKICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQpIHsKICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIlNOQVAhIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAiY29taWMtYWN0aW9uIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRocm93QmFsbChiYWxsLCBmb3JjZWRUeXBlID0gbnVsbCwgcG93ZXJNdWx0aXBsaWVyID0gMS4wKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5oYXNCYWxsIHx8IHRoaXMuaXNUaHJvd2luZykgcmV0dXJuOwogICAgICAgICAgICBpZiAodGhpcy5zdGF0dXMubmFwID4gMCkgcmV0dXJuOwoKICAgICAgICAgICAgdGhpcy5pc1Rocm93aW5nID0gdHJ1ZTsKCiAgICAgICAgICAgIC8vIExvY2sgYWltIGRpcmVjdGlvbiBhdCBzdGFydCBvZiB0aHJvdwogICAgICAgICAgICB0aGlzLmxvY2tlZEFpbVZlY3RvciA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CgogICAgICAgICAgICBpZiAodGhpcy5pbnB1dFZlY3Rvci5sZW5ndGhTcSgpID4gMC4xKSB7CiAgICAgICAgICAgICAgICB0aGlzLmxvY2tlZEFpbVZlY3Rvci5jb3B5KHRoaXMuaW5wdXRWZWN0b3IpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5sb2NrZWRBaW1WZWN0b3Iuc2V0KDAsIDAsIDEpLmFwcGx5UXVhdGVybmlvbih0aGlzLm1lc2gucXVhdGVybmlvbikubm9ybWFsaXplKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IGdvYWxaID0gKHRoaXMudGVhbSAmJiB0aGlzLnRlYW0uc2lkZSA9PT0gMSkgPyAtMjggOiAyODsKICAgICAgICAgICAgY29uc3QgZGlzdFRvR29hbCA9IE1hdGguYWJzKHRoaXMubWVzaC5wb3NpdGlvbi56IC0gZ29hbFopOwoKICAgICAgICAgICAgbGV0IHR5cGUgPSBmb3JjZWRUeXBlOwogICAgICAgICAgICBpZiAoIXR5cGUpIHsKICAgICAgICAgICAgICAgIHR5cGUgPSAoZGlzdFRvR29hbCA8IDI1KSA/ICdTSCcgOiAnUEEnOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCBpc0ZpbmlzaGVyID0gKHR5cGUgPT09ICdTSCcgJiYgZGlzdFRvR29hbCA8IDEyLjApOwoKICAgICAgICAgICAgbGV0IHRlY2hOYW1lID0gKHR5cGUgPT09ICdTSCcpID8gdGhpcy50ZWNocy5zaG9vdCA6IHRoaXMudGVjaHMucGFzczsKCiAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cy52ZW5vbSA+IDAgJiYgdGVjaE5hbWUpIHsKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0KQogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIlNJTEVOQ0VEIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAic3RhdHVzIik7CiAgICAgICAgICAgICAgICB0ZWNoTmFtZSA9IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCB3aW5kdXBUaW1lID0gMTAwOwogICAgICAgICAgICBsZXQgYW5pbVNwZWVkID0gMS41OwoKICAgICAgICAgICAgaWYgKHBvd2VyTXVsdGlwbGllciA+IDEuMSkgewogICAgICAgICAgICAgICAgd2luZHVwVGltZSArPSAyMDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChpc0ZpbmlzaGVyICYmICF0ZWNoTmFtZSkgewogICAgICAgICAgICAgICAgd2luZHVwVGltZSA9IDUwOwogICAgICAgICAgICAgICAgYW5pbVNwZWVkID0gMy4wOwogICAgICAgICAgICB9CgppZiAodGVjaE5hbWUpIHsKICAgICAgICAgICAgICAgIHdpbmR1cFRpbWUgPSA0MDA7CiAgICAgICAgICAgICAgICBhbmltU3BlZWQgPSAwLjg7CgogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5jYW1lcmFNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmNhbWVyYU1hbmFnZXIucGxheUNpbmVtYXRpYyh0ZWNoTmFtZSwgdGhpcy5tZXNoLCAxLjIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuaW1tdW5pdHlUaW1lciA9IDEuNTsKCiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gdGVjaE5hbWUucmVwbGFjZSgnXycsICcgJykudG9VcHBlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKGxhYmVsLCB0aGlzLm1lc2gucG9zaXRpb24sICJ0ZWNoIik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gTkVXOiBTcGF3biBUZWNoIEdseXBoIChWZXJ0aWNhbCBDYXN0aW5nIENpcmNsZSkKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZ2x5cGhNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmdseXBoTWFuYWdlci5zcGF3bigndGVjaCcsIHRoaXMubWVzaC5wb3NpdGlvbiwgewogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQ6IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGxpZmU6IDEuMiwKICAgICAgICAgICAgICAgICAgICAgICAgcm90YXRpb25TcGVlZDogNC4wLAogICAgICAgICAgICAgICAgICAgICAgICBzY2FsZVNwZWVkOiAxLjUsCiAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldFk6IDEuMiwKICAgICAgICAgICAgICAgICAgICAgICAgZmFjZUNhbWVyYTogdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCB0aHJvd0FjdGlvbiA9IHRoaXMuYWN0aW9uc1sndGhyb3cnXTsKICAgICAgICAgICAgaWYgKHRocm93QWN0aW9uKSB7CiAgICAgICAgICAgICAgICB0aHJvd0FjdGlvbi5zZXRMb29wKFRIUkVFLkxvb3BPbmNlKTsKICAgICAgICAgICAgICAgIHRocm93QWN0aW9uLmNsYW1wV2hlbkZpbmlzaGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRocm93QWN0aW9uLnRpbWVTY2FsZSA9IGFuaW1TcGVlZDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnBsYXkoJ3Rocm93JywgMC4xKTsKCiAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0ICYmICF0ZWNoTmFtZSkgewogICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dC5zcGF3bigiV0hPT1NIIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAiY29taWMtYWN0aW9uIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKHRoaXMuaGFzQmFsbCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aHJvd0FjdGlvbikgdGhyb3dBY3Rpb24udGltZVNjYWxlID0gMS4wOwoKICAgICAgICAgICAgICAgICAgICBsZXQgZmluYWxEaXIgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgICAgICAgICAgICAgICAgIGxldCByZWZlcmVuY2VEaXIgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwoKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vdmVycmlkZUFpbVZlY3RvcikgewogICAgICAgICAgICAgICAgICAgICAgICBmaW5hbERpci5jb3B5KHRoaXMub3ZlcnJpZGVBaW1WZWN0b3IpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VEaXIuY29weShmaW5hbERpcik7CgogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXRBbmdsZSA9IE1hdGguYXRhbjIoZmluYWxEaXIueCwgZmluYWxEaXIueik7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpbmFsQW5nbGUgPSB0YXJnZXRBbmdsZSArIHRoaXMucm90YXRpb25PZmZzZXQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHEgPSBuZXcgVEhSRUUuUXVhdGVybmlvbigpLnNldEZyb21BeGlzQW5nbGUoX3BBeGlzWSwgZmluYWxBbmdsZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5xdWF0ZXJuaW9uLmNvcHkocSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3luY1JvdGF0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmluYWxEaXIuY29weSh0aGlzLmxvY2tlZEFpbVZlY3Rvcik7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZURpci5jb3B5KHRoaXMubG9ja2VkQWltVmVjdG9yKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNwaW4gPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAwKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5wdXRWZWN0b3IubGVuZ3RoU3EoKSA+IDAuMSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnB1dERpciA9IHRoaXMuaW5wdXRWZWN0b3IuY2xvbmUoKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3Jvc3NZID0gbmV3IFRIUkVFLlZlY3RvcjMoKS5jcm9zc1ZlY3RvcnMocmVmZXJlbmNlRGlyLCBpbnB1dERpcikueTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyhjcm9zc1kpID4gMC4xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGluLnNldCgwLCBjcm9zc1kgKiAxMi4wLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgbGV0IGJhc2VDb3N0ID0gKHR5cGUgPT09ICdTSCcpID8gMjAgOiAxMDsKICAgICAgICAgICAgICAgICAgICBsZXQgdGVjaENvc3QgPSAwOwogICAgICAgICAgICAgICAgICAgIGxldCB0ZWNoQm9udXMgPSAwOwogICAgICAgICAgICAgICAgICAgIGxldCB0ZWNoUGF5bG9hZCA9IG51bGw7CgogICAgICAgICAgICAgICAgICAgIGlmICh0ZWNoTmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHRlY2hOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICd2ZW5vbSc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaENvc3QgPSAodHlwZSA9PT0gJ1NIJyA/IDIwIDogMTApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlY2hCb251cyA9IDM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaFBheWxvYWQgPSB7IHR5cGU6ICd2ZW5vbScsIGxldmVsOiAxIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICd3aXRoZXInOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlY2hDb3N0ID0gKHR5cGUgPT09ICdTSCcgPyAyMCA6IDEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZWNoQm9udXMgPSAzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlY2hQYXlsb2FkID0geyB0eXBlOiAnd2l0aGVyJywgbGV2ZWw6IDEgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ25hcCc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaENvc3QgPSAodHlwZSA9PT0gJ1NIJyA/IDM1IDogMzApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlY2hCb251cyA9IDM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaFBheWxvYWQgPSB7IHR5cGU6ICduYXAnLCBsZXZlbDogMSB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnc3BoZXJlJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gJ1NIJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZWNoQ29zdCA9IDI1OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBybmcgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMSkgKyA1OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZWNoQm9udXMgPSBybmc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlY2hQYXlsb2FkID0geyB0eXBlOiAnc3BoZXJlJywgbGV2ZWw6IDEsIGJvbnVzOiBybmcgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKGBTUEhFUkUgKyR7cm5nfWAsIHRoaXMubWVzaC5wb3NpdGlvbiwgImdvYWwiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdqZWNodCc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdTSCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaENvc3QgPSA0MDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaEJvbnVzID0gNTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaFBheWxvYWQgPSB7IHR5cGU6ICdqZWNodCcsIGxldmVsOiAxIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3BlcmZvcm1KZWNodEtub2NrYmFjaygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2ludmlzaWJsZSc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdTSCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaENvc3QgPSAyNTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaEJvbnVzID0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVjaFBheWxvYWQgPSB7IHR5cGU6ICdpbnZpc2libGUnLCBsZXZlbDogMSB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY29uc3QgdG90YWxDb3N0ID0gYmFzZUNvc3QgKyB0ZWNoQ29zdDsKCiAgICAgICAgICAgICAgICAgICAgbGV0IHBvd2VyRmFjdG9yID0gMS4wOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRzLkhQIDwgdG90YWxDb3N0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBvd2VyRmFjdG9yID0gMC41OwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRzLkhQID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgdGVjaFBheWxvYWQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB0ZWNoQm9udXMgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIlRJUkVEIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAiZGFtYWdlIik7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0cy5IUCAtPSB0b3RhbENvc3Q7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBsZXQgc3RhdFZhbCA9IHRoaXMuZ2V0U3RhdCh0eXBlKTsKICAgICAgICAgICAgICAgICAgICBzdGF0VmFsICs9IHRlY2hCb251czsKICAgICAgICAgICAgICAgICAgICBzdGF0VmFsICo9IHBvd2VyRmFjdG9yOwogICAgICAgICAgICAgICAgICAgIHN0YXRWYWwgKj0gcG93ZXJNdWx0aXBsaWVyOwoKICAgICAgICAgICAgICAgICAgICBjb25zdCBnb2FsWiA9ICh0aGlzLnRlYW0gJiYgdGhpcy50ZWFtLnNpZGUgPT09IDEpID8gLTI4IDogMjg7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZ29hbERpciA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIGdvYWxaIC0gdGhpcy5tZXNoLnBvc2l0aW9uLnopLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGdvYWxEb3QgPSBmaW5hbERpci5kb3QoZ29hbERpcik7CgogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAnU0gnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGdvYWxQb3MgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAyLCBnb2FsWik7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRvR29hbCA9IGdvYWxQb3MuY2xvbmUoKS5zdWIodGhpcy5tZXNoLnBvc2l0aW9uKS5ub3JtYWxpemUoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNoID0gdGhpcy5nZXRTdGF0KCdTSCcpOwogICAgICAgICAgICAgICAgICAgICAgICBsZXQgYXNzaXN0RmFjdG9yID0gTWF0aC5taW4oMC45LCBNYXRoLm1heCgwLjEsIHNoIC8gMTAwLjApKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm92ZXJyaWRlQWltVmVjdG9yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3Npc3RGYWN0b3IgKj0gMC4xOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ29hbERvdCA+IDAuMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWxEaXIubGVycCh0b0dvYWwsIGFzc2lzdEZhY3Rvcik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0ZpbmlzaGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbERpci55ICs9IDAuMDU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIlNMQU0hIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAiY29taWMtaW1wYWN0Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Cn0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbERpci55ICs9IDAuMjU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgCi8vIEdvYWxpZSBMb2Z0IEJvbnVzIChQcmV2ZW50IGludGVyY2VwdGlvbiBieSBpbW1lZGlhdGUgZGVmZW5kZXIpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJvbGUgPT09ICdHTCcpIGZpbmFsRGlyLnkgKz0gMC44OyAvLyBIaWdoIGxvZnQgZm9yIGNsZWFyYW5jZQoKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXQgPSB0aGlzLl9maW5kUGFzc1RhcmdldEluQ29uZShmaW5hbERpcik7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0b01hdGUgPSB0YXJnZXQubWVzaC5wb3NpdGlvbi5jbG9uZSgpLnN1Yih0aGlzLm1lc2gucG9zaXRpb24pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldC52ZWxvY2l0eS5sZW5ndGhTcSgpID4gMC4xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9NYXRlLmFkZFNjYWxlZFZlY3Rvcih0YXJnZXQudmVsb2NpdHksIDAuNSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b01hdGUubm9ybWFsaXplKCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGEgPSB0aGlzLmdldFN0YXQoJ1BBJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgYXNzaXN0RmFjdG9yID0gTWF0aC5taW4oMS4wLCAwLjMgKyAocGEgLyA4MC4wKSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub3ZlcnJpZGVBaW1WZWN0b3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3Npc3RGYWN0b3IgKj0gMC4xOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsRGlyLmxlcnAodG9NYXRlLCBhc3Npc3RGYWN0b3IpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpc3QgPSB0aGlzLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyh0YXJnZXQubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbERpci55ICs9IE1hdGgubWluKDAuNiwgZGlzdCAqIDAuMDMpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewpmaW5hbERpci55ICs9IDAuMjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgLy8gR29hbGllIExvZnQgQm9udXMgZm9yIFBhc3NpbmcKLy8gR29hbGllIExvZnQgQm9udXMgZm9yIFBhc3NpbmcKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucm9sZSA9PT0gJ0dMJykgZmluYWxEaXIueSArPSAwLjg7IC8vIEhpZ2ggbG9mdCBmb3IgY2xlYXJhbmNlCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBmaW5hbERpci5ub3JtYWxpemUoKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHRlY2hQYXlsb2FkICYmIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSAmJiB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UudHJpZ2dlclRlY2hFdmVudCkgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UudHJpZ2dlclRlY2hFdmVudCh0aGlzLCB0ZWNoTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgfQoKYmFsbC5zaG9vdChmaW5hbERpciwgc3RhdFZhbCwgdHlwZSwgdGVjaFBheWxvYWQsIHNwaW4pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEV4dHJhIGdyYWNlIHBlcmlvZCBmb3IgR29hbGllIHRvIHByZXZlbnQgcG9pbnQtYmxhbmsgaW50ZXJjZXB0aW9ucwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJvbGUgPT09ICdHTCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYmFsbC5jYXRjaEdyYWNlUGVyaW9kID0gMC42OyAvLyAwLjZzIGltbXVuaXR5IChhcHByb3ggMTAtMTJtIHRyYXZlbCkKICAgICAgICAgICAgICAgICAgICB9Cgp0aGlzLmxvc2VCYWxsKCk7CgogICAgICAgICAgICAgICAgICAgIHRoaXMuY2F0Y2hDb29sZG93biA9IDEuMDsgLy8gMXMgY29vbGRvd24KICAgICAgICAgICAgICAgICAgICB0aGlzLmNhdGNoQ29vbGRvd24gPSAxLjA7IC8vIDFzIGNvb2xkb3duCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYW5DYXRjaCA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB3aW5kdXBUaW1lKTsKCiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgdGhpcy5pc1Rocm93aW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLm92ZXJyaWRlQWltVmVjdG9yID0gbnVsbDsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmlucHV0VmVjdG9yLmxlbmd0aCgpID4gMC4xKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5KCdzd2ltJywgMC4yKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5KCdpZGxlJywgMC4yKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgd2luZHVwVGltZSArIDUwMCk7CiAgICAgICAgfQoKICAgICAgICBfZmluZFBhc3NUYXJnZXRJbkNvbmUoYWltRGlyKSB7CiAgICAgICAgICAgIGlmICghdGhpcy50ZWFtKSByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIGxldCBiZXN0VGFyZ2V0ID0gbnVsbDsKICAgICAgICAgICAgbGV0IG1heFNjb3JlID0gLUluZmluaXR5OwoKICAgICAgICAgICAgZm9yIChjb25zdCBtYXRlIG9mIHRoaXMudGVhbS5wbGF5ZXJzKSB7CiAgICAgICAgICAgICAgICBpZiAobWF0ZSA9PT0gdGhpcyB8fCAhbWF0ZS5tZXNoKSBjb250aW51ZTsKCiAgICAgICAgICAgICAgICBjb25zdCB0b01hdGUgPSBtYXRlLm1lc2gucG9zaXRpb24uY2xvbmUoKS5zdWIodGhpcy5tZXNoLnBvc2l0aW9uKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGRvdCA9IGFpbURpci5kb3QodG9NYXRlKTsKCiAgICAgICAgICAgICAgICBpZiAoZG90ID4gMC43KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlzdCA9IHRoaXMubWVzaC5wb3NpdGlvbi5kaXN0YW5jZVRvKG1hdGUubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2NvcmUgPSAoZG90ICogMTApIC0gKGRpc3QgKiAwLjEpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcmUgPiBtYXhTY29yZSkgewogICAgICAgICAgICAgICAgICAgICAgICBtYXhTY29yZSA9IHNjb3JlOwogICAgICAgICAgICAgICAgICAgICAgICBiZXN0VGFyZ2V0ID0gbWF0ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGJlc3RUYXJnZXQ7CiAgICAgICAgfQoKc3RhcnRDaGFyZ2UoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5oYXNCYWxsIHx8IHRoaXMuaXNUaHJvd2luZyB8fCB0aGlzLnN0YXR1cy5uYXAgPiAwKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuaXNDaGFyZ2luZyA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuY2hhcmdlVGltZSA9IDA7CgovLyBWaXN1YWxzIGhhbmRsZWQgaW4gdXBkYXRlCgogICAgICAgICAgICAvLyBTaG93IGNoYXJnZSBVSQogICAgICAgICAgICB0aGlzLl91cGRhdGVDaGFyZ2VVSSgwKTsKCiAgICAgICAgICAgIC8vIE5FVzogU3Bhd24gQ2hhcmdlIEdseXBoIChHcm91bmQgUmluZykKICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSAmJiB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZ2x5cGhNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZ2x5cGhNYW5hZ2VyLnNwYXduKCdjaGFyZ2UnLCB0aGlzLm1lc2gucG9zaXRpb24sIHsKICAgICAgICAgICAgICAgICAgICBwYXJlbnQ6IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgbGlmZTogdGhpcy5tYXhDaGFyZ2VUaW1lLAogICAgICAgICAgICAgICAgICAgIHJvdGF0aW9uU3BlZWQ6IDMuMCwKICAgICAgICAgICAgICAgICAgICBzY2FsZVNwZWVkOiAwLjIsCiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0WTogMC4xCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmVsZWFzZUNoYXJnZShkeCA9IDAsIGR5ID0gMCkgewogICAgICAgICAgICBpZiAoIXRoaXMuaXNDaGFyZ2luZykgcmV0dXJuOwogICAgICAgICAgICB0aGlzLmlzQ2hhcmdpbmcgPSBmYWxzZTsKCmNvbnN0IHJhdGlvID0gTWF0aC5taW4odGhpcy5jaGFyZ2VUaW1lIC8gdGhpcy5tYXhDaGFyZ2VUaW1lLCAxLjApOwogICAgICAgICAgICBsZXQgbXVsdGlwbGllciA9IDEuMCArIChyYXRpbyAqIDAuNSk7CgogICAgICAgICAgICBpZiAocmF0aW8gPiAwLjkpIHsKICAgICAgICAgICAgICAgIG11bHRpcGxpZXIgPSAyLjA7CiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIlBFUkZFQ1QhIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAiY29taWMtaW1wYWN0Iik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmNhbWVyYU1hbmFnZXIpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhTWFuYWdlci5hZGRGb3ZJbXB1bHNlKC01KTsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhTWFuYWdlci5hZGRTaGFrZSgwLjUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgovLyBSZXNldCB2aXN1YWxzIGluIHVwZGF0ZQogICAgICAgICAgICB0aGlzLl9oaWRlQ2hhcmdlVUkoKTsKCiAgICAgICAgICAgIGxldCBhaW1WZWMgPSBudWxsOwogICAgICAgICAgICBjb25zdCBzd2lwZUxlbiA9IE1hdGguc3FydChkeCpkeCArIGR5KmR5KTsKCiAgICAgICAgICAgIGlmIChzd2lwZUxlbiA+IDIwKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjYW1lcmEgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhOwogICAgICAgICAgICAgICAgY29uc3QgZndkID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHJpZ2h0ID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKCiAgICAgICAgICAgICAgICBpZiAoY2FtZXJhKSB7CiAgICAgICAgICAgICAgICAgICAgY2FtZXJhLmdldFdvcmxkRGlyZWN0aW9uKGZ3ZCk7CiAgICAgICAgICAgICAgICAgICAgZndkLnkgPSAwOwogICAgICAgICAgICAgICAgICAgIGlmIChmd2QubGVuZ3RoU3EoKSA8IDAuMDAxKSBmd2Quc2V0KDAsIDAsIC0xKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGZ3ZC5ub3JtYWxpemUoKTsKCiAgICAgICAgICAgICAgICAgICAgcmlnaHQuY3Jvc3NWZWN0b3JzKGZ3ZCwgbmV3IFRIUkVFLlZlY3RvcjMoMCwgMSwgMCkpLm5vcm1hbGl6ZSgpOwoKICAgICAgICAgICAgICAgICAgICBjb25zdCB3b3JsZFZlYyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICAgICAgICAgICAgICAgICAgd29ybGRWZWMuYWRkU2NhbGVkVmVjdG9yKHJpZ2h0LCBkeCk7CiAgICAgICAgICAgICAgICAgICAgd29ybGRWZWMuYWRkU2NhbGVkVmVjdG9yKGZ3ZCwgLWR5KTsKICAgICAgICAgICAgICAgICAgICB3b3JsZFZlYy5ub3JtYWxpemUoKTsKCiAgICAgICAgICAgICAgICAgICAgYWltVmVjID0gd29ybGRWZWM7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vdmVycmlkZUFpbVZlY3RvciA9IGFpbVZlYzsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgYWltVmVjID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMSkuYXBwbHlRdWF0ZXJuaW9uKHRoaXMubWVzaC5xdWF0ZXJuaW9uKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm92ZXJyaWRlQWltVmVjdG9yID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGFpbVZlYyA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIDEpLmFwcGx5UXVhdGVybmlvbih0aGlzLm1lc2gucXVhdGVybmlvbikubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICB0aGlzLm92ZXJyaWRlQWltVmVjdG9yID0gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgZ29hbFogPSAodGhpcy50ZWFtICYmIHRoaXMudGVhbS5zaWRlID09PSAxKSA/IC0yOCA6IDI4OwogICAgICAgICAgICBjb25zdCBnb2FsRGlyID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgZ29hbFogLSB0aGlzLm1lc2gucG9zaXRpb24ueikubm9ybWFsaXplKCk7CiAgICAgICAgICAgIGNvbnN0IGRvdEdvYWwgPSBhaW1WZWMuZG90KGdvYWxEaXIpOwoKICAgICAgICAgICAgbGV0IHR5cGUgPSAnUEEnOwoKICAgICAgICAgICAgY29uc3QgZGlzdFRvR29hbCA9IE1hdGguYWJzKHRoaXMubWVzaC5wb3NpdGlvbi56IC0gZ29hbFopOwoKICAgICAgICAgICAgaWYgKGRvdEdvYWwgPiAwLjggJiYgZGlzdFRvR29hbCA8IDMwLjApIHsKICAgICAgICAgICAgICAgIHR5cGUgPSAnU0gnOwogICAgICAgICAgICB9IGVsc2UgaWYgKGRvdEdvYWwgPiAwLjUgJiYgZGlzdFRvR29hbCA8IDE1LjApIHsKICAgICAgICAgICAgICAgIHR5cGUgPSAnU0gnOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCB0YXJnZXRNYXRlID0gdGhpcy5fZmluZFBhc3NUYXJnZXRJbkNvbmUoYWltVmVjKTsKICAgICAgICAgICAgaWYgKHRhcmdldE1hdGUgJiYgdHlwZSA9PT0gJ1NIJykgewogICAgICAgICAgICAgICAgY29uc3QgZGlzdE1hdGUgPSB0aGlzLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyh0YXJnZXRNYXRlLm1lc2gucG9zaXRpb24pOwogICAgICAgICAgICAgICAgaWYgKGRpc3RNYXRlIDwgMTIuMCkgdHlwZSA9ICdQQSc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IGJhbGwgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZW50aXRpZXMuYmFsbDsKICAgICAgICAgICAgaWYgKGJhbGwpIHsKICAgICAgICAgICAgICAgIHRoaXMudGhyb3dCYWxsKGJhbGwsIHR5cGUsIG11bHRpcGxpZXIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBORVc6IENoYXJnZSBVSSBtZXRob2RzCiAgICAgICAgX3VwZGF0ZUNoYXJnZVVJKHJhdGlvKSB7CiAgICAgICAgICAgIGNvbnN0IG1ldGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYXJnZS1tZXRlci1maWxsJyk7CiAgICAgICAgICAgIGlmIChtZXRlcikgewogICAgICAgICAgICAgICAgbWV0ZXIuc3R5bGUud2lkdGggPSBgJHtyYXRpbyAqIDEwMH0lYDsKICAgICAgICAgICAgICAgIGlmIChyYXRpbyA+IDAuOSkgewogICAgICAgICAgICAgICAgICAgIG1ldGVyLnN0eWxlLmJhY2tncm91bmQgPSAnbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjZmYwLCAjZjgwKSc7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJhdGlvID4gMC41KSB7CiAgICAgICAgICAgICAgICAgICAgbWV0ZXIuc3R5bGUuYmFja2dyb3VuZCA9ICdsaW5lYXItZ3JhZGllbnQoOTBkZWcsICMwZjAsICNmZjApJzsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbWV0ZXIuc3R5bGUuYmFja2dyb3VuZCA9ICdsaW5lYXItZ3JhZGllbnQoOTBkZWcsICMwYWYsICMwZjApJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhcmdlLW1ldGVyLWNvbnRhaW5lcicpOwogICAgICAgICAgICBpZiAoY29udGFpbmVyKSBjb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgfQoKICAgICAgICBfaGlkZUNoYXJnZVVJKCkgewogICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhcmdlLW1ldGVyLWNvbnRhaW5lcicpOwogICAgICAgICAgICBpZiAoY29udGFpbmVyKSBjb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICB9CgogICAgICAgIHNldE92ZXJyaWRlQWltKHgsIHopIHsKICAgICAgICAgICAgaWYgKCF0aGlzLm92ZXJyaWRlQWltVmVjdG9yKSB0aGlzLm92ZXJyaWRlQWltVmVjdG9yID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgICAgICAgICAgdGhpcy5vdmVycmlkZUFpbVZlY3Rvci5zZXQoeCwgMCwgeikubm9ybWFsaXplKCk7CiAgICAgICAgfQoKbG9zZUJhbGwoKSB7CiAgICAgICAgICAgIHRoaXMuaGFzQmFsbCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9oaWRlUGFzc1RhcmdldEluZGljYXRvcnMoKTsKICAgICAgICAgICAgLy8gRml4OiBFbnN1cmUgcGxheWVyIGNhbiBjYXRjaCBhZ2FpbiBpZiB0aGV5IGxvc2UgcG9zc2Vzc2lvbiB1bmV4cGVjdGVkbHkKICAgICAgICAgICAgLy8gKFN0YW5kYXJkIHRocm93cy9mdW1ibGVzIHdpbGwgaW1tZWRpYXRlbHkgc2V0IHRoaXMgdG8gZmFsc2Ugd2l0aCBhIHRpbWVvdXQpCiAgICAgICAgICAgIHRoaXMuY2FuQ2F0Y2ggPSB0cnVlOwogICAgICAgIH0KCnVwZGF0ZShkdCkgewogICAgICAgICAgICBpZiAoIXRoaXMubWVzaCkgcmV0dXJuOwoKICAgICAgICAgICAgaWYgKHRoaXMuaXNHb2RNb2RlKSB7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXRzLkhQID0gdGhpcy5zdGF0cy5tYXhIUDsKICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudEVOID0gdGhpcy5nZXRTdGF0KCdFTicpOwogICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMudmVub20gPSAwOwogICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMubmFwID0gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMubWl4ZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMubWl4ZXIudXBkYXRlKGR0KTsKICAgICAgICAgICAgfQoKLy8gdGhpcy5pc0VuZ2FnZWQgPSBmYWxzZTsgLy8gUkVNT1ZFRDogSGFuZGxlZCBpbiBfY2hlY2tUYWNrbGVQcmVzc3VyZSB0byBwcmV2ZW50IHN0YXRlIGZsaWNrZXJpbmcKCiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVN0YXR1cyhkdCk7CgogICAgICAgICAgICAvLyBDaGFyZ2UgTG9naWMKLy8gQ2hhcmdlIExvZ2ljCiAgICAgICAgICAgIGlmICh0aGlzLmlzQ2hhcmdpbmcpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5oYXNCYWxsIHx8IHRoaXMuc3RhdHVzLm5hcCA+IDAgfHwgdGhpcy5zdHVuVGltZXIgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0NoYXJnaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNoLnBvc2l0aW9uLnkgPSAwOwogICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5zY2FsZS5zZXRTY2FsYXIodGhpcy5iYXNlU2NhbGUpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2hpZGVDaGFyZ2VVSSgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYXJnZVRpbWUgKz0gZHQ7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJhdGlvID0gTWF0aC5taW4odGhpcy5jaGFyZ2VUaW1lIC8gdGhpcy5tYXhDaGFyZ2VUaW1lLCAxLjApOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIExldml0YXRpb24gKFBvd2VyaW5nIHVwKQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGhvdmVyID0gKE1hdGguc2luKERhdGUubm93KCkgKiAwLjAyKSAqIDAuMSkgKyAocmF0aW8gKiAwLjgpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFZpYnJhdGlvbiAoSW50ZW5zaXR5IGluY3JlYXNlcyB3aXRoIGNoYXJnZSkKICAgICAgICAgICAgICAgICAgICBjb25zdCBzaGFrZSA9IDAuMDUgKyAoMC4xICogcmF0aW8pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEFwcGx5IFkgb2Zmc2V0IChIb3ZlciArIEppdHRlcikKICAgICAgICAgICAgICAgICAgICB0aGlzLm1lc2gucG9zaXRpb24ueSA9IGhvdmVyICsgKE1hdGgucmFuZG9tKCkgLSAwLjUpICogc2hha2U7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gQXBwbHkgUm90YXRpb24gSml0dGVyICh2aWEgYmFua2luZy9waXRjaCB2YXJpYWJsZXMpCiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBhdm9pZHMgcG9zaXRpb25hbCBkcmlmdCB3aGlsZSBnaXZpbmcgYSAic3RydWdnbGluZyB0byBjb250YWluIHBvd2VyIiBsb29rCiAgICAgICAgICAgICAgICAgICAgdGhpcy5iYW5raW5nQW1vdW50ICs9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIHNoYWtlOwogICAgICAgICAgICAgICAgICAgIHRoaXMucGl0Y2hBbW91bnQgKz0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogc2hha2U7CgogICAgICAgICAgICAgICAgICAgIC8vIEVuc3VyZSBzY2FsZSBzdGF5cyBub3JtYWwgKFJlbW92ZSBzd2VsbGluZyBlZmZlY3QpCiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNoLnNjYWxlLnNldFNjYWxhcih0aGlzLmJhc2VTY2FsZSk7CgogICAgICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUNoYXJnZVVJKHJhdGlvKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQppZiAodGhpcy5kYXNoQ29vbGRvd24gPiAwKSB0aGlzLmRhc2hDb29sZG93biAtPSBkdDsKICAgICAgICAgICAgaWYgKHRoaXMuY2xhc2hDb29sZG93biA+IDApIHRoaXMuY2xhc2hDb29sZG93biAtPSBkdDsKICAgICAgICAgICAgaWYgKHRoaXMuc3R1blRpbWVyID4gMCkgdGhpcy5zdHVuVGltZXIgLT0gZHQ7CiAgICAgICAgICAgIGlmICh0aGlzLmltbXVuaXR5VGltZXIgPiAwKSB0aGlzLmltbXVuaXR5VGltZXIgLT0gZHQ7CiAgICAgICAgICAgIGlmICh0aGlzLmNhdGNoQ29vbGRvd24gPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNhdGNoQ29vbGRvd24gLT0gZHQ7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5jYXRjaENvb2xkb3duIDw9IDApIHRoaXMuY2FuQ2F0Y2ggPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIERhc2ggTG9naWMKICAgICAgICAgICAgaWYgKHRoaXMuaXNEYXNoaW5nKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRhc2hUaW1lIC09IGR0OwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmRhc2hUeXBlID09PSAnaG9yaXpvbnRhbCcpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9jaGVja1RhY2tsZUNvbGxpc2lvbigpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmRhc2hUaW1lIDw9IDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmlzRGFzaGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi55ID0gMDsKICAgICAgICAgICAgICAgICAgICB0aGlzLmRhc2hUeXBlID0gbnVsbDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CmlmICh0aGlzLmRhc2hUeXBlID09PSAndmVydGljYWwnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9wVmVjLmNvcHkodGhpcy5kYXNoVmVjKS5tdWx0aXBseVNjYWxhcihkdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi5hZGQoX3BWZWMpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gMSAtICh0aGlzLmRhc2hUaW1lIC8gdGhpcy5kYXNoVG90YWxUaW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNoLnBvc2l0aW9uLnkgPSBNYXRoLnNpbih0ICogTWF0aC5QSSkgKiAzLjA7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNoLnBvc2l0aW9uLmFkZChfcFZlYyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi55ID0gMDsKCi8vIFZpc3VhbCBUYWNrbGUgTGVhbiAoU2hvdWxkZXIgQmFzaCBBbmltYXRpb24pCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSAxIC0gKHRoaXMuZGFzaFRpbWUgLyB0aGlzLmRhc2hUb3RhbFRpbWUpOyAvLyAwIHRvIDEKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGVhbiA9IE1hdGguc2luKHQgKiBNYXRoLlBJKTsgLy8gUGVhayBhdCAxLjAgaW4gbWlkZGxlCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAvLyBSZS1hcHBseSBiYXNlIGZhY2luZyArIEFnZ3Jlc3NpdmUgU2hvdWxkZXIgQ2hlY2sKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFzZVEgPSBuZXcgVEhSRUUuUXVhdGVybmlvbigpLnNldEZyb21BeGlzQW5nbGUoX3BBeGlzWSwgdGhpcy5jdXJyZW50WWF3ICsgdGhpcy5yb3RhdGlvbk9mZnNldCk7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcGl0Y2ggPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBsZXQgeWF3ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJvbGwgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBsZXQgbHVuZ2VBbXQgPSAwOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGFzaFR5cGUgPT09ICdob3Jpem9udGFsJyB8fCB0aGlzLmRhc2hUeXBlID09PSAnYnJlYWsnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVEFDS0xFL0JSRUFLOiBBZ2dyZXNzaXZlIFNob3VsZGVyIENoZWNrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGl0Y2ggPSAxLjIgKiBsZWFuOyAvLyBIZWFkIGRvd24gLyBMZWFuIGZvcndhcmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5YXcgPSAwLjggKiBsZWFuOyAgIC8vIFR1cm4gc2hvdWxkZXIgaW50byB0YXJnZXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb2xsID0gLTAuNiAqIGxlYW47IC8vIERpcCBzaG91bGRlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGx1bmdlQW10ID0gMC44ICogbGVhbjsgLy8gVGhydXN0IG1lc2ggZm9yd2FyZCB2aXN1YWxseQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZGFzaFR5cGUgPT09ICdzcHJpbnQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU1BSSU5UOiBBZXJvZHluYW1pYyBsZWFuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGl0Y2ggPSAwLjUgKiBsZWFuOyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsdW5nZUFtdCA9IDAuMiAqIGxlYW47CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFwcGx5IEx1bmdlIChWaXN1YWwgT2Zmc2V0KQogICAgICAgICAgICAgICAgICAgICAgICBpZiAobHVuZ2VBbXQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbHVuZ2UgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCBsdW5nZUFtdCkuYXBwbHlRdWF0ZXJuaW9uKGJhc2VRKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1lc2gucG9zaXRpb24uYWRkKGx1bmdlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHdpc3RRID0gbmV3IFRIUkVFLlF1YXRlcm5pb24oKS5zZXRGcm9tRXVsZXIobmV3IFRIUkVFLkV1bGVyKHBpdGNoLCB5YXcsIHJvbGwpKTsgCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5xdWF0ZXJuaW9uLm11bHRpcGx5UXVhdGVybmlvbnMoYmFzZVEsIHR3aXN0USk7CgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5Lm11bHRpcGx5U2NhbGFyKDAuOTYpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gU3R1bi9OYXAgQ2hlY2sKICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzLm5hcCA+IDAgfHwgdGhpcy5zdHVuVGltZXIgPiAwKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkcmFnRmFjdG9yID0gTWF0aC5tYXgoMCwgMSAtICgyLjAgKiBkdCkpOwogICAgICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS5tdWx0aXBseVNjYWxhcihkcmFnRmFjdG9yKTsKCiAgICAgICAgICAgICAgICBfcFZlYy5jb3B5KHRoaXMudmVsb2NpdHkpLm11bHRpcGx5U2NhbGFyKGR0KTsKICAgICAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi5hZGQoX3BWZWMpOwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSAnaWRsZScgJiYgdGhpcy5zdGF0ZSAhPT0gJ2NhdGNoJykgdGhpcy5wbGF5KCdpZGxlJywgMC41KTsKCiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVIUEJhcigpOwogICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlUGFzc1RhcmdldEluZGljYXRvcnMoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5fY2hlY2tUYWNrbGVQcmVzc3VyZShkdCk7CgogICAgICAgICAgICBpZiAodGhpcy5pc1Rocm93aW5nKSB7CiAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5Lm11bHRpcGx5U2NhbGFyKE1hdGgubWF4KDAsIDEuMCAtICgyLjAgKiBkdCkpKTsKCiAgICAgICAgICAgICAgICB0aGlzLl9hcHBseVNvZnRDb2xsaXNpb24oZHQpOwogICAgICAgICAgICAgICAgdGhpcy5fYXBwbHlHb2FsQ3JlYXNlKGR0KTsKCiAgICAgICAgICAgICAgICBfcFZlYy5jb3B5KHRoaXMudmVsb2NpdHkpLm11bHRpcGx5U2NhbGFyKGR0KTsKICAgICAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi5hZGQoX3BWZWMpOwoKICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVZlcnRpY2FsaXR5KGR0KTsKCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVQaHlzaWNzKGR0KTsKICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVZlcnRpY2FsaXR5KGR0KTsKICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUJhbmtpbmcoZHQpOwogICAgICAgICAgICB9Cgp0aGlzLl91cGRhdGVIUEJhcigpOwogICAgICAgICAgICB0aGlzLl91cGRhdGVQYXNzVGFyZ2V0SW5kaWNhdG9ycygpOwoKICAgICAgICAgICAgLy8gQnViYmxlIFRyYWlsIExvZ2ljCi8vIEJ1YmJsZSBUcmFpbCBMb2dpYwovLyBCdWJibGUgVHJhaWwgTG9naWMgKER5bmFtaWMpCiAgICAgICAgICAgIGNvbnN0IHNwZWVkU3EgPSB0aGlzLnZlbG9jaXR5Lmxlbmd0aFNxKCk7CiAgICAgICAgICAgIGlmIChzcGVlZFNxID4gMS4wICYmIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSAmJiB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UucGFydGljbGVNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9idWJibGVUaW1lciAtPSBkdDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2J1YmJsZVRpbWVyIDw9IDApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwbSA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5wYXJ0aWNsZU1hbmFnZXI7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFja0RpciA9IHRoaXMudmVsb2NpdHkuY2xvbmUoKS5ub3JtYWxpemUoKS5uZWdhdGUoKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyAxLiBTdGFuZGFyZCBXYWtlIChBbHdheXMgc3Bhd24pCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gYmFja0Rpci5jbG9uZSgpLm11bHRpcGx5U2NhbGFyKDAuOCk7CiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0LnkgPSAwLjUgKyBNYXRoLnJhbmRvbSgpICogMC41OyAKICAgICAgICAgICAgICAgICAgICBvZmZzZXQueCArPSAoTWF0aC5yYW5kb20oKS0wLjUpICogMC41OwogICAgICAgICAgICAgICAgICAgIG9mZnNldC56ICs9IChNYXRoLnJhbmRvbSgpLTAuNSkgKiAwLjU7CiAgICAgICAgICAgICAgICAgICAgcG0uc3Bhd24oJ2J1YmJsZScsIHRoaXMubWVzaC5wb3NpdGlvbi5jbG9uZSgpLmFkZChvZmZzZXQpLCB7IHNjYWxlOiAwLjE1ICsgTWF0aC5yYW5kb20oKSAqIDAuMjUgfSk7CgogICAgICAgICAgICAgICAgICAgIC8vIDIuIENhdml0YXRpb24gKEhpZ2ggU3BlZWQpIC0gQWRkIG9uIHRvcAogICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzSGlnaFNwZWVkID0gc3BlZWRTcSA+IDQwLjA7IAogICAgICAgICAgICAgICAgICAgIGlmIChpc0hpZ2hTcGVlZCkgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTwzOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1PZmZzZXQgPSBiYWNrRGlyLmNsb25lKCkubXVsdGlwbHlTY2FsYXIoMC41ICsgTWF0aC5yYW5kb20oKSowLjUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbU9mZnNldC54ICs9IChNYXRoLnJhbmRvbSgpLTAuNSkqMC44OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbU9mZnNldC55ID0gMC41ICsgKE1hdGgucmFuZG9tKCktMC41KSowLjg7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbU9mZnNldC56ICs9IChNYXRoLnJhbmRvbSgpLTAuNSkqMC44OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbS5zcGF3bignYnViYmxlX21pY3JvJywgdGhpcy5tZXNoLnBvc2l0aW9uLmNsb25lKCkuYWRkKG1PZmZzZXQpLCB7IHNjYWxlOiAwLjA2ICsgTWF0aC5yYW5kb20oKSowLjA4IH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2J1YmJsZVRpbWVyID0gMC4wMzsgCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYnViYmxlVGltZXIgPSAwLjE7IAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQp9CiAgICAgICAgX3VwZGF0ZVN0YXR1cyhkdCkgewogICAgICAgICAgICBjb25zdCBwbSA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSA/IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5wYXJ0aWNsZU1hbmFnZXIgOiBudWxsOwoKICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzLnZlbm9tID4gMCkgewogICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMudmVub20gLT0gZHQ7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXRzLkhQIC09IDUgKiBkdDsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRzLkhQIDwgMCkgdGhpcy5zdGF0cy5IUCA9IDA7CgogICAgICAgICAgICAgICAgdGhpcy5fcGFydGljbGVUaW1lcnMudmVub20gLT0gZHQ7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcGFydGljbGVUaW1lcnMudmVub20gPD0gMCAmJiBwbSkgewogICAgICAgICAgICAgICAgICAgIHBtLnNwYXduKCd2ZW5vbScsIHRoaXMubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGFydGljbGVUaW1lcnMudmVub20gPSAwLjE1OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLmhhc0JhbGwgJiYgdGhpcy5zdGF0cy5IUCA8IHRoaXMuc3RhdHMubWF4SFApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRzLkhQICs9IDUgKiBkdDsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0cy5IUCA+IHRoaXMuc3RhdHMubWF4SFApIHRoaXMuc3RhdHMuSFAgPSB0aGlzLnN0YXRzLm1heEhQOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy5oYXNCYWxsKSB7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXRzLkhQIC09IDIuMCAqIGR0OwogICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHMuSFAgPCAwKSB0aGlzLnN0YXRzLkhQID0gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzLm5hcCA+IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzLm5hcCAtPSBkdDsKCiAgICAgICAgICAgICAgICB0aGlzLl9wYXJ0aWNsZVRpbWVycy5uYXAgLT0gZHQ7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcGFydGljbGVUaW1lcnMubmFwIDw9IDAgJiYgcG0pIHsKICAgICAgICAgICAgICAgICAgICBwbS5zcGF3bignbmFwJywgdGhpcy5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9wYXJ0aWNsZVRpbWVycy5uYXAgPSAwLjg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCBpc1dpdGhlcmluZyA9IGZhbHNlOwogICAgICAgICAgICBmb3IgKGxldCBrZXkgaW4gdGhpcy5zdGF0dXMud2l0aGVyKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0dXMud2l0aGVyW2tleV0gPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMud2l0aGVyW2tleV0gLT0gZHQ7CiAgICAgICAgICAgICAgICAgICAgaXNXaXRoZXJpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoaXNXaXRoZXJpbmcpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3BhcnRpY2xlVGltZXJzLndpdGhlciAtPSBkdDsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9wYXJ0aWNsZVRpbWVycy53aXRoZXIgPD0gMCAmJiBwbSkgewogICAgICAgICAgICAgICAgICAgIHBtLnNwYXduKCd3aXRoZXInLCB0aGlzLm1lc2gucG9zaXRpb24pOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3BhcnRpY2xlVGltZXJzLndpdGhlciA9IDAuMjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5fdXBkYXRlVmlzdWFscygpOwogICAgICAgIH0KCl91cGRhdGVWaXN1YWxzKCkgewogICAgICAgICAgICAvLyBSRU1PVkVEOiBZZWxsb3cgc3BoZXJlL3RpbnQgbG9naWMgYXMgcGVyIHJlcXVlc3QuCiAgICAgICAgICAgIC8vIEFsd2F5cyByZXZlcnQgdG8gYmFzZSBjb2xvci4KICAgICAgICAgICAgdGhpcy5vcmlnaW5hbE1hdGVyaWFscy5mb3JFYWNoKGVudHJ5ID0+IHsKICAgICAgICAgICAgICAgIGVudHJ5Lm1hdGVyaWFsLmNvbG9yLmNvcHkoZW50cnkuYmFzZUNvbG9yKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBfY3JlYXRlQXVyYSgpIHsKICAgICAgICAgICAgLy8gQXVyYSByZW1vdmVkIHBlciB1c2VyIHJlcXVlc3QKICAgICAgICAgICAgdGhpcy5hdXJhTWVzaCA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICAvLyBORVc6IFBhc3MgdGFyZ2V0IGluZGljYXRvcgogICAgICAgIF9jcmVhdGVQYXNzVGFyZ2V0SW5kaWNhdG9yKCkgewogICAgICAgICAgICAvLyBDcmVhdGUgYSByaW5nIHRoYXQgaGlnaGxpZ2h0cyBwb3RlbnRpYWwgcGFzcyB0YXJnZXRzCiAgICAgICAgICAgIGNvbnN0IGdlbyA9IG5ldyBUSFJFRS5SaW5nR2VvbWV0cnkoMC44LCAxLjAsIDE2KTsKICAgICAgICAgICAgY29uc3QgbWF0ID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHsKICAgICAgICAgICAgICAgIGNvbG9yOiAweDAwZmYwMCwKICAgICAgICAgICAgICAgIHRyYW5zcGFyZW50OiB0cnVlLAogICAgICAgICAgICAgICAgb3BhY2l0eTogMC42LAogICAgICAgICAgICAgICAgc2lkZTogVEhSRUUuRG91YmxlU2lkZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5wYXNzVGFyZ2V0SW5kaWNhdG9yID0gbmV3IFRIUkVFLk1lc2goZ2VvLCBtYXQpOwogICAgICAgICAgICB0aGlzLnBhc3NUYXJnZXRJbmRpY2F0b3Iucm90YXRpb24ueCA9IC1NYXRoLlBJIC8gMjsKICAgICAgICAgICAgdGhpcy5wYXNzVGFyZ2V0SW5kaWNhdG9yLnBvc2l0aW9uLnkgPSAwLjE7CiAgICAgICAgICAgIHRoaXMucGFzc1RhcmdldEluZGljYXRvci52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuc2NlbmUuYWRkKHRoaXMucGFzc1RhcmdldEluZGljYXRvcik7CiAgICAgICAgfQoKICAgICAgICBfdXBkYXRlUGFzc1RhcmdldEluZGljYXRvcnMoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5oYXNCYWxsIHx8ICF0aGlzLnRlYW0pIHsKICAgICAgICAgICAgICAgIHRoaXMuX2hpZGVQYXNzVGFyZ2V0SW5kaWNhdG9ycygpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBGaW5kIGJlc3QgcGFzcyB0YXJnZXQKICAgICAgICAgICAgY29uc3QgYWltRGlyID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMSkuYXBwbHlRdWF0ZXJuaW9uKHRoaXMubWVzaC5xdWF0ZXJuaW9uKTsKICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gdGhpcy5fZmluZFBhc3NUYXJnZXRJbkNvbmUoYWltRGlyKTsKCiAgICAgICAgICAgIGlmICh0YXJnZXQgJiYgdGFyZ2V0Lm1lc2ggJiYgdGhpcy5wYXNzVGFyZ2V0SW5kaWNhdG9yKSB7CiAgICAgICAgICAgICAgICB0aGlzLnBhc3NUYXJnZXRJbmRpY2F0b3IudmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLnBhc3NUYXJnZXRJbmRpY2F0b3IucG9zaXRpb24ueCA9IHRhcmdldC5tZXNoLnBvc2l0aW9uLng7CiAgICAgICAgICAgICAgICB0aGlzLnBhc3NUYXJnZXRJbmRpY2F0b3IucG9zaXRpb24ueiA9IHRhcmdldC5tZXNoLnBvc2l0aW9uLno7CiAgICAgICAgICAgICAgICB0aGlzLnBhc3NUYXJnZXRJbmRpY2F0b3IucG9zaXRpb24ueSA9IDAuMTsKICAgICAgICAgICAgICAgIHRoaXMucGFzc1RhcmdldEluZGljYXRvci5yb3RhdGlvbi56ICs9IDAuMDU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl9oaWRlUGFzc1RhcmdldEluZGljYXRvcnMoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX2hpZGVQYXNzVGFyZ2V0SW5kaWNhdG9ycygpIHsKICAgICAgICAgICAgaWYgKHRoaXMucGFzc1RhcmdldEluZGljYXRvcikgewogICAgICAgICAgICAgICAgdGhpcy5wYXNzVGFyZ2V0SW5kaWNhdG9yLnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCl9hcHBseVNvZnRDb2xsaXNpb24oZHQpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLm1lc2ggfHwgIXdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSkgcmV0dXJuOwoKICAgICAgICAgICAgY29uc3QgZ2FtZSA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZTsKICAgICAgICAgICAgY29uc3QgdGVhbXMgPSBbZ2FtZS50ZWFtcy5ob21lLCBnYW1lLnRlYW1zLmF3YXldOwoKICAgICAgICAgICAgY29uc3QgcmVwdWxzaW9uUmFkaXVzID0gMC41OyAvLyBSZWR1Y2VkIHRvIDAuNSB0byBmaXggaW52aXNpYmxlIHdhbGwgaXNzdWVzCiAgICAgICAgICAgIGNvbnN0IHN0aWZmbmVzcyA9IDE1LjA7CgogICAgICAgICAgICB0ZWFtcy5mb3JFYWNoKHRlYW0gPT4gewogICAgICAgICAgICAgICAgaWYgKCF0ZWFtKSByZXR1cm47CiAgICAgICAgICAgICAgICB0ZWFtLnBsYXllcnMuZm9yRWFjaChvdGhlciA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG90aGVyID09PSB0aGlzIHx8ICFvdGhlci5tZXNoKSByZXR1cm47CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGR4ID0gdGhpcy5tZXNoLnBvc2l0aW9uLnggLSBvdGhlci5tZXNoLnBvc2l0aW9uLng7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZHkgPSB0aGlzLm1lc2gucG9zaXRpb24ueSAtIG90aGVyLm1lc2gucG9zaXRpb24ueTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkeiA9IHRoaXMubWVzaC5wb3NpdGlvbi56IC0gb3RoZXIubWVzaC5wb3NpdGlvbi56OwoKICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXN0U3EgPSBkeCpkeCArIGR5KmR5ICsgZHoqZHo7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWluRGlzdCA9IHJlcHVsc2lvblJhZGl1cyAqIDIuMDsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGRpc3RTcSA8IG1pbkRpc3QgKiBtaW5EaXN0ICYmIGRpc3RTcSA+IDAuMDAwMSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gTWF0aC5zcXJ0KGRpc3RTcSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG92ZXJsYXAgPSBtaW5EaXN0IC0gZGlzdDsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZvcmNlID0gb3ZlcmxhcCAqIHN0aWZmbmVzczsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG54ID0gZHggLyBkaXN0OwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBueSA9IGR5IC8gZGlzdDsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbnogPSBkeiAvIGRpc3Q7CgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5LnggKz0gbnggKiBmb3JjZSAqIGR0OwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5LnkgKz0gbnkgKiBmb3JjZSAqIGR0OwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5LnogKz0gbnogKiBmb3JjZSAqIGR0OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIF91cGRhdGVQaHlzaWNzKGR0KSB7CiAgICAgICAgICAgIHRoaXMuX2FwcGx5U29mdENvbGxpc2lvbihkdCk7CiAgICAgICAgICAgIHRoaXMuX2FwcGx5R29hbENyZWFzZShkdCk7CgogICAgICAgICAgICBjb25zdCBpbnB1dExlblNxID0gdGhpcy5pbnB1dFZlY3Rvci5sZW5ndGhTcSgpOwogICAgICAgICAgICBjb25zdCBpc0lucHV0QWN0aXZlID0gaW5wdXRMZW5TcSA+IDAuMDE7CgogICAgICAgICAgICBsZXQgY3VycmVudE1heFNwZWVkID0gdGhpcy5tYXhTcGVlZDsKaWYgKHRoaXMuaXNFbmdhZ2VkKSBjdXJyZW50TWF4U3BlZWQgKj0gMC44OyAvLyBCdWZmZWQgZnJvbSAwLjUgdG8gYWxsb3cgZXNjYXBlCiAgICAgICAgICAgIGlmICh0aGlzLmlzQ2hhcmdpbmcpIGN1cnJlbnRNYXhTcGVlZCAqPSAwLjk7CgogICAgICAgICAgICBpZiAoaXNJbnB1dEFjdGl2ZSkgewogICAgICAgICAgICAgICAgX3BWZWMuY29weSh0aGlzLmlucHV0VmVjdG9yKS5ub3JtYWxpemUoKTsKCiAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXRWZWxYID0gX3BWZWMueCAqIGN1cnJlbnRNYXhTcGVlZDsKICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldFZlbFogPSBfcFZlYy56ICogY3VycmVudE1heFNwZWVkOwoKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRTcGVlZCA9IHRoaXMudmVsb2NpdHkubGVuZ3RoKCk7CiAgICAgICAgICAgICAgICBjb25zdCBzcGVlZFJhdGlvID0gTWF0aC5taW4oMS4wLCBjdXJyZW50U3BlZWQgLyB0aGlzLm1heFNwZWVkKTsKCiAgICAgICAgICAgICAgICBjb25zdCBhZ2lsaXR5ID0gVEhSRUUuTWF0aFV0aWxzLmxlcnAoMTAuMCwgMi4wLCBzcGVlZFJhdGlvKTsKCiAgICAgICAgICAgICAgICBjb25zdCB0ID0gMS4wIC0gTWF0aC5wb3coMC4wMSwgZHQgKiBhZ2lsaXR5KTsKCiAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5LnggKz0gKHRhcmdldFZlbFggLSB0aGlzLnZlbG9jaXR5LngpICogdDsKICAgICAgICAgICAgICAgIHRoaXMudmVsb2NpdHkueiArPSAodGFyZ2V0VmVsWiAtIHRoaXMudmVsb2NpdHkueikgKiB0OwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSAnc3dpbScpIHRoaXMucGxheSgnc3dpbScsIDAuMik7CgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgYnJha2VGYWN0b3IgPSAyLjA7CiAgICAgICAgICAgICAgICBjb25zdCB0ID0gMS4wIC0gTWF0aC5wb3coMC4xLCBkdCAqIGJyYWtlRmFjdG9yKTsKCiAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5LnggKz0gKDAgLSB0aGlzLnZlbG9jaXR5LngpICogdDsKICAgICAgICAgICAgICAgIHRoaXMudmVsb2NpdHkueiArPSAoMCAtIHRoaXMudmVsb2NpdHkueikgKiB0OwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLnZlbG9jaXR5Lmxlbmd0aFNxKCkgPCAwLjAxKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS5zZXQoMCwgdGhpcy52ZWxvY2l0eS55LCAwKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSAhPT0gJ2lkbGUnICYmIHRoaXMuc3RhdGUgIT09ICdjYXRjaCcgJiYgdGhpcy5zdGF0ZSAhPT0gJ3Rocm93JyAmJiB0aGlzLnN0YXRlICE9PSAncmVhY3QnKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5KCdpZGxlJywgMC4zKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS55ICo9IE1hdGgubWF4KDAsIDEuMCAtICgyLjAgKiBkdCkpOwoKICAgICAgICAgICAgX3BWZWMuY29weSh0aGlzLnZlbG9jaXR5KS5tdWx0aXBseVNjYWxhcihkdCk7CiAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi5hZGQoX3BWZWMpOwogICAgICAgIH0KCiAgICAgICAgX3VwZGF0ZVZlcnRpY2FsaXR5KGR0KSB7CiAgICAgICAgICAgIGxldCB0YXJnZXRZID0gMDsKCiAgICAgICAgICAgIGNvbnN0IGJhbGwgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZW50aXRpZXMuYmFsbDsKCiAgICAgICAgICAgIGlmIChiYWxsICYmIGJhbGwubWVzaCAmJiAhdGhpcy5oYXNCYWxsKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0VG9CYWxsID0gdGhpcy5tZXNoLnBvc2l0aW9uLmRpc3RhbmNlVG8oYmFsbC5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgIGlmIChkaXN0VG9CYWxsIDwgMTUuMCkgewogICAgICAgICAgICAgICAgICAgIHRhcmdldFkgPSBiYWxsLm1lc2gucG9zaXRpb24ueTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMuaGFzQmFsbCkgewogICAgICAgICAgICAgICAgdGFyZ2V0WSA9IDAuNTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgeURpZmYgPSB0YXJnZXRZIC0gdGhpcy5tZXNoLnBvc2l0aW9uLnk7CgogICAgICAgICAgICBjb25zdCBsaWZ0ID0geURpZmYgKiAxMC4wICogZHQ7CiAgICAgICAgICAgIHRoaXMudmVsb2NpdHkueSArPSBsaWZ0OwoKICAgICAgICAgICAgaWYgKHRoaXMubWVzaC5wb3NpdGlvbi55ID4gOC4wKSB7CiAgICAgICAgICAgICAgICB0aGlzLm1lc2gucG9zaXRpb24ueSA9IDguMDsKICAgICAgICAgICAgICAgIHRoaXMudmVsb2NpdHkueSAqPSAtMC41OwogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMubWVzaC5wb3NpdGlvbi55IDwgLTguMCkgewogICAgICAgICAgICAgICAgdGhpcy5tZXNoLnBvc2l0aW9uLnkgPSAtOC4wOwogICAgICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS55ICo9IC0wLjU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIEZJWEVEOiBJbXByb3ZlZCBiYW5raW5nIHdpdGggaHlzdGVyZXNpcyB0byBwcmV2ZW50IGZhY2luZyBmbGlwcwogICAgICAgIF91cGRhdGVCYW5raW5nKGR0KSB7CiAgICAgICAgICAgIGNvbnN0IGlucHV0TGVuU3EgPSB0aGlzLmlucHV0VmVjdG9yLmxlbmd0aFNxKCk7CiAgICAgICAgICAgIGNvbnN0IHZlbExlblNxID0gdGhpcy52ZWxvY2l0eS5sZW5ndGhTcSgpOwoKICAgICAgICAgICAgbGV0IHRhcmdldFlhdyA9IHRoaXMudGFyZ2V0WWF3OwogICAgICAgICAgICBsZXQgc2hvdWxkVXBkYXRlWWF3ID0gZmFsc2U7CgogICAgICAgICAgICAvLyBPbmx5IHVwZGF0ZSB5YXcgaWYgaW5wdXQgb3IgdmVsb2NpdHkgZXhjZWVkcyBkZWFkem9uZQogICAgICAgICAgICBpZiAoaW5wdXRMZW5TcSA+IHRoaXMuZmFjaW5nRGVhZHpvbmUgKiB0aGlzLmZhY2luZ0RlYWR6b25lKSB7CiAgICAgICAgICAgICAgICB0YXJnZXRZYXcgPSBNYXRoLmF0YW4yKHRoaXMuaW5wdXRWZWN0b3IueCwgdGhpcy5pbnB1dFZlY3Rvci56KTsKICAgICAgICAgICAgICAgIHNob3VsZFVwZGF0ZVlhdyA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodmVsTGVuU3EgPiB0aGlzLmZhY2luZ0RlYWR6b25lICogdGhpcy5mYWNpbmdEZWFkem9uZSkgewp0YXJnZXRZYXcgPSBNYXRoLmF0YW4yKHRoaXMudmVsb2NpdHkueCwgdGhpcy52ZWxvY2l0eS56KTsKICAgICAgICAgICAgICAgIHNob3VsZFVwZGF0ZVlhdyA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5oYXNCYWxsICYmIHRoaXMudGVhbSAmJiB0aGlzLnRlYW0uaXNIdW1hbiAmJiB0aGlzLnRlYW0uYWN0aXZlUGxheWVyID09PSB0aGlzICYmICF3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuaXNEZW1vTW9kZSkgewogICAgICAgICAgICAgICAgLy8gU3RhdGlvbmFyeSBBaW1pbmcgKEh1bWFuIHdpdGggQmFsbCkKICAgICAgICAgICAgICAgIC8vIFJvdGF0ZSB0b3dhcmRzIGNhbWVyYS9haW0gZGlyZWN0aW9uCiAgICAgICAgICAgICAgICBjb25zdCBjYW0gPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhOwogICAgICAgICAgICAgICAgaWYgKGNhbSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpciA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICAgICAgICAgICAgICAgICAgY2FtLmdldFdvcmxkRGlyZWN0aW9uKGRpcik7CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0WWF3ID0gTWF0aC5hdGFuMihkaXIueCwgZGlyLnopOwogICAgICAgICAgICAgICAgICAgIHNob3VsZFVwZGF0ZVlhdyA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIElmIHdlIHNob3VsZCB1cGRhdGUsIGRvIHNvLiBPdGhlcndpc2Uga2VlcCBsYXN0IHZhbGlkIHlhdwogICAgICAgICAgICBpZiAoc2hvdWxkVXBkYXRlWWF3KSB7CiAgICAgICAgICAgICAgICB0aGlzLmxhc3RWYWxpZFlhdyA9IHRhcmdldFlhdzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRhcmdldFlhdyA9IHRoaXMubGFzdFZhbGlkWWF3OwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBTbW9vdGggWWF3IHdpdGggd3JhcC1hcm91bmQgaGFuZGxpbmcKICAgICAgICAgICAgbGV0IGRpZmYgPSB0YXJnZXRZYXcgLSB0aGlzLmN1cnJlbnRZYXc7CiAgICAgICAgICAgIHdoaWxlIChkaWZmID4gTWF0aC5QSSkgZGlmZiAtPSBNYXRoLlBJICogMjsKICAgICAgICAgICAgd2hpbGUgKGRpZmYgPCAtTWF0aC5QSSkgZGlmZiArPSBNYXRoLlBJICogMjsKCiAgICAgICAgICAgIGNvbnN0IHNwZWVkUmF0aW8gPSBNYXRoLm1pbigxLjAsIHRoaXMudmVsb2NpdHkubGVuZ3RoKCkgLyB0aGlzLm1heFNwZWVkKTsKICAgICAgICAgICAgY29uc3QgdHVyblNwZWVkID0gVEhSRUUuTWF0aFV0aWxzLmxlcnAoMTIuMCwgNi4wLCBzcGVlZFJhdGlvKTsKCiAgICAgICAgICAgIC8vIFByZXZlbnQgc3VkZGVuIHNuYXBzIHdoZW4gZGlmZiBpcyB2ZXJ5IGxhcmdlICh0ZWxlcG9ydC9yZXNldCBzY2VuYXJpb3MpCiAgICAgICAgICAgIGNvbnN0IG1heFlhd0NoYW5nZSA9IE1hdGguUEkgKiBkdCAqIHR1cm5TcGVlZDsKICAgICAgICAgICAgY29uc3QgeWF3Q2hhbmdlID0gTWF0aC5tYXgoLW1heFlhd0NoYW5nZSwgTWF0aC5taW4obWF4WWF3Q2hhbmdlLCBkaWZmICogZHQgKiB0dXJuU3BlZWQpKTsKCiAgICAgICAgICAgIHRoaXMuY3VycmVudFlhdyArPSB5YXdDaGFuZ2U7CiAgICAgICAgICAgIHRoaXMudGFyZ2V0WWF3ID0gdGFyZ2V0WWF3OwoKICAgICAgICAgICAgLy8gQmFua2luZwogICAgICAgICAgICBjb25zdCBiYW5rU2Vuc2l0aXZpdHkgPSAwLjg7CiAgICAgICAgICAgIGNvbnN0IG1heEJhbmsgPSAwLjc1OwoKICAgICAgICAgICAgbGV0IHRhcmdldEJhbmsgPSAtZGlmZiAqIGJhbmtTZW5zaXRpdml0eTsKICAgICAgICAgICAgdGFyZ2V0QmFuayA9IE1hdGgubWF4KC1tYXhCYW5rLCBNYXRoLm1pbihtYXhCYW5rLCB0YXJnZXRCYW5rKSk7CgogICAgICAgICAgICBjb25zdCBiYW5rTGVycCA9IDEuMCAtIE1hdGgucG93KDAuMDIsIGR0KTsKICAgICAgICAgICAgdGhpcy5iYW5raW5nQW1vdW50ICs9ICh0YXJnZXRCYW5rIC0gdGhpcy5iYW5raW5nQW1vdW50KSAqIGJhbmtMZXJwOwoKICAgICAgICAgICAgLy8gUGl0Y2gKICAgICAgICAgICAgY29uc3QgcGl0Y2hTZW5zaXRpdml0eSA9IDAuMTsKICAgICAgICAgICAgY29uc3QgbWF4UGl0Y2ggPSAxLjA7CgogICAgICAgICAgICBsZXQgdGFyZ2V0UGl0Y2ggPSAtdGhpcy52ZWxvY2l0eS55ICogcGl0Y2hTZW5zaXRpdml0eTsKICAgICAgICAgICAgdGFyZ2V0UGl0Y2ggPSBNYXRoLm1heCgtbWF4UGl0Y2gsIE1hdGgubWluKG1heFBpdGNoLCB0YXJnZXRQaXRjaCkpOwoKICAgICAgICAgICAgY29uc3QgcGl0Y2hMZXJwID0gMS4wIC0gTWF0aC5wb3coMC4wNSwgZHQpOwogICAgICAgICAgICB0aGlzLnBpdGNoQW1vdW50ICs9ICh0YXJnZXRQaXRjaCAtIHRoaXMucGl0Y2hBbW91bnQpICogcGl0Y2hMZXJwOwoKICAgICAgICAgICAgLy8gQXBwbHkgUm90YXRpb24KICAgICAgICAgICAgY29uc3QgZmluYWxZYXcgPSB0aGlzLmN1cnJlbnRZYXcgKyB0aGlzLnJvdGF0aW9uT2Zmc2V0OwoKICAgICAgICAgICAgdGhpcy5tZXNoLnF1YXRlcm5pb24uc2V0RnJvbUF4aXNBbmdsZShfcEF4aXNZLCBmaW5hbFlhdyk7CgogICAgICAgICAgICBfcFF1YXQuc2V0RnJvbUF4aXNBbmdsZShuZXcgVEhSRUUuVmVjdG9yMygxLCAwLCAwKSwgdGhpcy5waXRjaEFtb3VudCk7CiAgICAgICAgICAgIHRoaXMubWVzaC5xdWF0ZXJuaW9uLm11bHRpcGx5KF9wUXVhdCk7CgogICAgICAgICAgICBfcFF1YXQuc2V0RnJvbUF4aXNBbmdsZShuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAxKSwgdGhpcy5iYW5raW5nQW1vdW50KTsKICAgICAgICAgICAgdGhpcy5tZXNoLnF1YXRlcm5pb24ubXVsdGlwbHkoX3BRdWF0KTsKCiAgICAgICAgICAgIC8vIElkbGUgQm9iCiAgICAgICAgICAgIGlmICh2ZWxMZW5TcSA8IDAuMSAmJiAhdGhpcy5pc0VuZ2FnZWQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRpbWUgPSBEYXRlLm5vdygpICogMC4wMDE1OwogICAgICAgICAgICAgICAgY29uc3QgYm9iUGl0Y2ggPSBNYXRoLnNpbih0aW1lKSAqIDAuMDM7CiAgICAgICAgICAgICAgICBjb25zdCBib2JSb2xsID0gTWF0aC5jb3ModGltZSAqIDAuNykgKiAwLjAyOwoKICAgICAgICAgICAgICAgIF9wUXVhdC5zZXRGcm9tRXVsZXIobmV3IFRIUkVFLkV1bGVyKGJvYlBpdGNoLCAwLCBib2JSb2xsKSk7CiAgICAgICAgICAgICAgICB0aGlzLm1lc2gucXVhdGVybmlvbi5tdWx0aXBseShfcFF1YXQpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKX2NoZWNrVGFja2xlUHJlc3N1cmUoZHQpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLmhhc0JhbGwpIHsKICAgICAgICAgICAgICAgIHRoaXMuaXNFbmdhZ2VkID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLmVuY291bnRlclRpbWVyID0gMDsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMuaW1tdW5pdHlUaW1lciA+IDApIHJldHVybjsKICAgICAgICAgICAgaWYgKHRoaXMuaXNEYXNoaW5nKSByZXR1cm47CgogICAgICAgICAgICBjb25zdCBnYW1lID0gd2luZG93LmZsdXguZ2FtZUluc3RhbmNlOwogICAgICAgICAgICBpZiAoIWdhbWUgfHwgIXRoaXMudGVhbSkgcmV0dXJuOwoKICAgICAgICAgICAgY29uc3Qgb3Bwb25lbnRUZWFtSWQgPSB0aGlzLnRlYW0uaWQgPT09ICdob21lJyA/ICdhd2F5JyA6ICdob21lJzsKICAgICAgICAgICAgY29uc3Qgb3Bwb25lbnRUZWFtID0gZ2FtZS50ZWFtc1tvcHBvbmVudFRlYW1JZF07CgogICAgICAgICAgICBpZiAoIW9wcG9uZW50VGVhbSkgcmV0dXJuOwoKICAgICAgICAgICAgbGV0IGVuZ2FnZWRUaGlzRnJhbWUgPSBmYWxzZTsKICAgICAgICAgICAgY29uc3QgZWZmZWN0aXZlUmFkaXVzID0gdGhpcy5pc0VuZ2FnZWQgPyB0aGlzLnRhY2tsZVJhZGl1cyAqIDEuMiA6IHRoaXMudGFja2xlUmFkaXVzOwoKICAgICAgICAgICAgLy8gMS4gQ2hlY2sgRW5nYWdlbWVudCBTdGF0dXMKICAgICAgICAgICAgZm9yIChjb25zdCBlbnRpdHkgb2Ygb3Bwb25lbnRUZWFtLnBsYXllcnMpIHsKICAgICAgICAgICAgICAgIGlmICghZW50aXR5Lm1lc2ggfHwgZW50aXR5LnN0YXR1cy5uYXAgPiAwIHx8IGVudGl0eS5zdHVuVGltZXIgPiAwKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGNvbnN0IGRpc3QgPSB0aGlzLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyhlbnRpdHkubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICBpZiAoZGlzdCA8IGVmZmVjdGl2ZVJhZGl1cykgewogICAgICAgICAgICAgICAgICAgIGVuZ2FnZWRUaGlzRnJhbWUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOyAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMi4gVXBkYXRlIFRpbWVyICYgVUkgRmVlZGJhY2sKICAgICAgICAgICAgaWYgKGVuZ2FnZWRUaGlzRnJhbWUpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc0VuZ2FnZWQpIHsKICAgICAgICAgICAgICAgICAgICAvLyBKdXN0IGJlY2FtZSBlbmdhZ2VkCiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbmNvdW50ZXJUaW1lciA9IDA7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudGVhbS5pc0h1bWFuICYmIHRoaXMudGVhbS5hY3RpdmVQbGF5ZXIgPT09IHRoaXMgJiYgZ2FtZS5mbG9hdGluZ1RleHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5mbG9hdGluZ1RleHQuc3Bhd24oIkVOR0FHRUQhIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAiY29taWMtYWN0aW9uIik7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhpbnQgZm9yIHRoZSBwbGF5ZXIKICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0VuZ2FnZWQgJiYgdGhpcy5oYXNCYWxsICYmIGdhbWUuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5mbG9hdGluZ1RleHQuc3Bhd24oIkJSRUFLIE5PVyEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJ0ZWNoIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDIwMCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5lbmNvdW50ZXJUaW1lciArPSBkdDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuZW5jb3VudGVyVGltZXIgPSAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmlzRW5nYWdlZCA9IGVuZ2FnZWRUaGlzRnJhbWU7CgogICAgICAgICAgICAvLyAzLiBBcHBseSBEYW1hZ2UgKFdpdGggR3JhY2UgUGVyaW9kKQogICAgICAgICAgICAvLyBHcmFjZSBQZXJpb2Q6IDAuNXMgYmVmb3JlIGRhbWFnZSBzdGFydHMgdGlja2luZwogICAgICAgICAgICBpZiAodGhpcy5pc0VuZ2FnZWQgJiYgdGhpcy5lbmNvdW50ZXJUaW1lciA+IDAuNSkgewogICAgICAgICAgICAgICAgZm9yIChjb25zdCBlbnRpdHkgb2Ygb3Bwb25lbnRUZWFtLnBsYXllcnMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIWVudGl0eS5tZXNoIHx8IGVudGl0eS5zdGF0dXMubmFwID4gMCB8fCBlbnRpdHkuc3R1blRpbWVyID4gMCkgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlzdCA9IHRoaXMubWVzaC5wb3NpdGlvbi5kaXN0YW5jZVRvKGVudGl0eS5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZGlzdCA8IGVmZmVjdGl2ZVJhZGl1cykgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBEaXNjcmV0ZSBDbGFzaCBFdmVudAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW50aXR5LmNsYXNoQ29vbGRvd24gPD0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVzb2x2ZUNsYXNoKGVudGl0eSwgZ2FtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRpdHkuY2xhc2hDb29sZG93biA9IDIuMDsgLy8gSW5jcmVhc2VkIGNvb2xkb3duICh3YXMgMS41KSB0byByZWR1Y2Ugc3BhbQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50RU4gPD0gMCkgewogICAgICAgICAgICAgICAgdGhpcy5mdW1ibGUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCl9yZXNvbHZlQ2xhc2gob3Bwb25lbnQsIGdhbWUpIHsKICAgICAgICAgICAgY29uc3Qgb3BwQVQgPSBvcHBvbmVudC5nZXRTdGF0KCdBVCcpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVmFyaWFuY2U6IDAuOCB0byAxLjIKICAgICAgICAgICAgY29uc3QgdmFyaWFuY2UgPSAwLjggKyBNYXRoLnJhbmRvbSgpICogMC40OwogICAgICAgICAgICBsZXQgZGFtYWdlID0gTWF0aC5mbG9vcihvcHBBVCAqIHZhcmlhbmNlKTsKICAgICAgICAgICAgaWYgKGRhbWFnZSA8IDEpIGRhbWFnZSA9IDE7CgogICAgICAgICAgICAvLyBEaXJlY3Rpb25hbCBTaGllbGRpbmcKICAgICAgICAgICAgLy8gQ2FycmllciBGb3J3YXJkCiAgICAgICAgICAgIF9wVmVjLmNvcHkoX3BBeGlzWikuYXBwbHlRdWF0ZXJuaW9uKHRoaXMubWVzaC5xdWF0ZXJuaW9uKTsgCiAgICAgICAgICAgIC8vIFZlY3RvciBUbyBPcHBvbmVudAogICAgICAgICAgICBjb25zdCB0b09wcCA9IG9wcG9uZW50Lm1lc2gucG9zaXRpb24uY2xvbmUoKS5zdWIodGhpcy5tZXNoLnBvc2l0aW9uKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGRvdCA9IF9wVmVjLmRvdCh0b09wcCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBJZiBvcHBvbmVudCBpcyBCRUhJTkQgKGRvdCA8IC0wLjIpLCBkYW1hZ2UgaXMgcmVkdWNlZCAoU2hpZWxkaW5nKS4KICAgICAgICAgICAgbGV0IGlzU2hpZWxkZWQgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKGRvdCA8IC0wLjIpIHsKICAgICAgICAgICAgICAgIGRhbWFnZSA9IE1hdGguZmxvb3IoZGFtYWdlICogMC41KTsKICAgICAgICAgICAgICAgIGlzU2hpZWxkZWQgPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBBcHBseSBEYW1hZ2UKICAgICAgICAgICAgdGhpcy5jdXJyZW50RU4gLT0gZGFtYWdlOwogICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50RU4gPCAwKSB0aGlzLmN1cnJlbnRFTiA9IDA7CgogICAgICAgICAgICAvLyBUZWNoIEVmZmVjdHMKICAgICAgICAgICAgaWYgKG9wcG9uZW50LnRlY2hzLnRhY2tsZSkgewogICAgICAgICAgICAgICAgaWYgKG9wcG9uZW50LnRlY2hzLnRhY2tsZSA9PT0gJ3Zlbm9tJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwbHlTdGF0dXMoJ3Zlbm9tJywgMTAuMCk7CiAgICAgICAgICAgICAgICAgICAgZGFtYWdlICs9IDM7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9wcG9uZW50LnRlY2hzLnRhY2tsZSA9PT0gJ3dpdGhlcicpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGF0cyA9IFsnUEEnLCAnU0gnLCAnQVQnLCAnRU4nXTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXQgPSBzdGF0c1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBzdGF0cy5sZW5ndGgpXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGx5U3RhdHVzKCd3aXRoZXInLCAxMC4wLCB0YXJnZXQpOwogICAgICAgICAgICAgICAgICAgIGRhbWFnZSArPSAzOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvcHBvbmVudC50ZWNocy50YWNrbGUgPT09ICdkcmFpbicpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRzLkhQIC09IGRhbWFnZTsgCiAgICAgICAgICAgICAgICAgICAgb3Bwb25lbnQuc3RhdHMuSFAgKz0gZGFtYWdlOwogICAgICAgICAgICAgICAgICAgIGlmIChnYW1lLmZsb2F0aW5nVGV4dCkgZ2FtZS5mbG9hdGluZ1RleHQuc3Bhd24oIkRSQUlOIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAiaGVhbCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBWaXN1YWxzIC0gSlVJQ0VEIFVQCiAgICAgICAgICAgIGNvbnN0IG1pZFBvcyA9IHRoaXMubWVzaC5wb3NpdGlvbi5jbG9uZSgpLmxlcnAob3Bwb25lbnQubWVzaC5wb3NpdGlvbiwgMC41KTsKICAgICAgICAgICAgbWlkUG9zLnkgKz0gMS41OwoKICAgICAgICAgICAgaWYgKGdhbWUuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICBpZiAoaXNTaGllbGRlZCkgewogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2FtZS5mbG9hdGluZ1RleHQpIGdhbWUuZmxvYXRpbmdUZXh0LnNwYXduKCJTSElFTEQiLCB0aGlzLm1lc2gucG9zaXRpb24sICJibG9jayIpOwogICAgICAgICAgICAgICAgICAgIH0sIDEwMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIERhbWFnZSBmZWVkYmFjawogICAgICAgICAgICAgICAgZ2FtZS5mbG9hdGluZ1RleHQuc3Bhd24oYCR7ZGFtYWdlfWAsIHRoaXMubWVzaC5wb3NpdGlvbiwgImRhbWFnZSIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZ2FtZS5wYXJ0aWNsZU1hbmFnZXIpIHsKICAgICAgICAgICAgICAgIC8vIE1hc3NpdmUgSW1wYWN0IEp1aWNlCiAgICAgICAgICAgICAgICBnYW1lLnBhcnRpY2xlTWFuYWdlci5zcGF3bignc2hvY2t3YXZlJywgbWlkUG9zLCB7IHNjYWxlOiAzLjAsIGxpZmU6IDAuNCB9KTsKICAgICAgICAgICAgICAgIGdhbWUucGFydGljbGVNYW5hZ2VyLnNwYXduKCdmbGFzaCcsIG1pZFBvcywgeyBzY2FsZTogNC4wIH0pOwogICAgICAgICAgICAgICAgLy8gRGVicmlzIHNob3dlcgogICAgICAgICAgICAgICAgZm9yKGxldCBpPTA7IGk8NjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgZ2FtZS5wYXJ0aWNsZU1hbmFnZXIuc3Bhd24oJ2RlYnJpcycsIG1pZFBvcywgeyBzY2FsZTogMC40IH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZ2FtZS5jYW1lcmFNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICAvLyBIRVJDVUxFQU4gU0hBS0UKICAgICAgICAgICAgICAgIGdhbWUuY2FtZXJhTWFuYWdlci5hZGRTaGFrZSgyLjUpOyAvLyBJbmNyZWFzZWQgZnJvbSAxLjIKICAgICAgICAgICAgICAgIGdhbWUuY2FtZXJhTWFuYWdlci5hZGRGb3ZJbXB1bHNlKC01KTsgLy8gWm9vbSBpbiBpbXBhY3QKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGdhbWUudHJpZ2dlckltcGFjdCkgewogICAgICAgICAgICAgICAgLy8gRnJlZXplIGZyYW1lCiAgICAgICAgICAgICAgICBnYW1lLnRyaWdnZXJJbXBhY3QoMC4xNSwgJ2hlYXZ5Jyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG9wcG9uZW50LmdhaW5FeHAoMik7CiAgICAgICAgfQoKICAgICAgICBfcGVyZm9ybUplY2h0S25vY2tiYWNrKCkgewogICAgICAgICAgICBpZiAoIXRoaXMudGVhbSkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBnYW1lID0gd2luZG93LmZsdXguZ2FtZUluc3RhbmNlOwogICAgICAgICAgICBjb25zdCBvcHBvbmVudFRlYW1JZCA9IHRoaXMudGVhbS5pZCA9PT0gJ2hvbWUnID8gJ2F3YXknIDogJ2hvbWUnOwogICAgICAgICAgICBjb25zdCBvcHBvbmVudFRlYW0gPSBnYW1lLnRlYW1zW29wcG9uZW50VGVhbUlkXTsKCiAgICAgICAgICAgIGlmICghb3Bwb25lbnRUZWFtKSByZXR1cm47CgogICAgICAgICAgICBjb25zdCByYW5nZSA9IDYuMDsKICAgICAgICAgICAgY29uc3QgZm9yY2UgPSAyNS4wOwoKICAgICAgICAgICAgaWYgKGdhbWUuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICBnYW1lLmZsb2F0aW5nVGV4dC5zcGF3bigiSkVDSFQgU0hPVCEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJnb2FsIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG9wcG9uZW50VGVhbS5wbGF5ZXJzLmZvckVhY2gocCA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIXAubWVzaCkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgZGlzdCA9IHRoaXMubWVzaC5wb3NpdGlvbi5kaXN0YW5jZVRvKHAubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICBpZiAoZGlzdCA8IHJhbmdlKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlyID0gcC5tZXNoLnBvc2l0aW9uLmNsb25lKCkuc3ViKHRoaXMubWVzaC5wb3NpdGlvbikubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICAgICAgZGlyLnkgPSAwLjU7CiAgICAgICAgICAgICAgICAgICAgZGlyLm5vcm1hbGl6ZSgpOwoKICAgICAgICAgICAgICAgICAgICBwLnZlbG9jaXR5LmFkZChkaXIubXVsdGlwbHlTY2FsYXIoZm9yY2UpKTsKCiAgICAgICAgICAgICAgICAgICAgcC5pc0Rhc2hpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBjb25zdCByZWFjdEFjdGlvbiA9IHAuYWN0aW9ucyAmJiBwLmFjdGlvbnNbJ3JlYWN0J107CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlYWN0QWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWN0QWN0aW9uLnNldExvb3AoVEhSRUUuTG9vcE9uY2UpOwogICAgICAgICAgICAgICAgICAgICAgICByZWFjdEFjdGlvbi5jbGFtcFdoZW5GaW5pc2hlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIHAucGxheSgncmVhY3QnLCAwLjEpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHAucGxheSgnY2F0Y2gnLCAwLjUpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKGdhbWUuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuZmxvYXRpbmdUZXh0LnNwYXduKCJTTUFDSyEiLCBwLm1lc2gucG9zaXRpb24sICJkYW1hZ2UiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGdhbWUudHJpZ2dlckltcGFjdCkgZ2FtZS50cmlnZ2VySW1wYWN0KDAuMTUsICdzaGF0dGVyJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgZnVtYmxlKCkgewogICAgICAgICAgICBjb25zb2xlLmxvZygiRlVNQkxFISBFTiBEZXBsZXRlZC4iKTsKICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQgJiYgdGhpcy5tZXNoKSB7CiAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJDUkFTSCEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJjb21pYy1pbXBhY3QiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5zdHVuVGltZXIgPSAxLjU7CgogICAgICAgICAgICBjb25zdCBiYWNrRGlyID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMSkuYXBwbHlRdWF0ZXJuaW9uKHRoaXMubWVzaC5xdWF0ZXJuaW9uKS5ub3JtYWxpemUoKS5uZWdhdGUoKTsKICAgICAgICAgICAgYmFja0Rpci54ICs9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDAuNTsKICAgICAgICAgICAgYmFja0Rpci56ICs9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDAuNTsKICAgICAgICAgICAgYmFja0Rpci5ub3JtYWxpemUoKTsKCiAgICAgICAgICAgIHRoaXMudmVsb2NpdHkuYWRkKGJhY2tEaXIubXVsdGlwbHlTY2FsYXIoMTIuMCkpOwoKICAgICAgICAgICAgaWYgKHRoaXMuaGFzQmFsbCkgewogICAgICAgICAgICAgICAgY29uc3QgYmFsbCA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5lbnRpdGllcy5iYWxsOwogICAgICAgICAgICAgICAgaWYgKGJhbGwpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBlamVjdERpciA9IG5ldyBUSFJFRS5WZWN0b3IzKE1hdGgucmFuZG9tKCktMC41LCAwLjgsIE1hdGgucmFuZG9tKCktMC41KS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgICAgICBiYWxsLnNob290KGVqZWN0RGlyLCA2LjAsICdub25lJyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb3NlQmFsbCgpOwp0aGlzLmxvc2VCYWxsKCk7CgogICAgICAgICAgICAgICAgICAgIHRoaXMuY2F0Y2hDb29sZG93biA9IDEuNTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbkNhdGNoID0gZmFsc2U7CgogICAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudEVOID0gMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZGFzaCh4LCB6KSB7CiAgICAgICAgICAgIGlmICh0aGlzLmlzRGFzaGluZyB8fCB0aGlzLmRhc2hDb29sZG93biA+IDApIHJldHVybjsKICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzLm5hcCA+IDApIHJldHVybjsKCiAgICAgICAgICAgIC8vIE9GRkVOU0U6IEJSRUFLIFRBQ0tMRQogICAgICAgICAgICBpZiAodGhpcy5oYXNCYWxsICYmIHRoaXMuaXNFbmdhZ2VkKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjb3N0ID0gMTU7CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudEVOIDwgY29zdCkgewogICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIkZBSUxFRCEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJkYW1hZ2UiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5mdW1ibGUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50RU4gLT0gY29zdDsKICAgICAgICAgICAgICAgIHRoaXMuaXNEYXNoaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMuZGFzaFRpbWUgPSAwLjQ7CiAgICAgICAgICAgICAgICB0aGlzLmRhc2hDb29sZG93biA9IDIuMDsKICAgICAgICAgICAgICAgIHRoaXMuZGFzaFR5cGUgPSAnYnJlYWsnOwoKICAgICAgICAgICAgICAgIGNvbnN0IGJ1cnN0RGlyID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMSkuYXBwbHlRdWF0ZXJuaW9uKHRoaXMubWVzaC5xdWF0ZXJuaW9uKTsKICAgICAgICAgICAgICAgIHRoaXMudmVsb2NpdHkuYWRkKGJ1cnN0RGlyLm11bHRpcGx5U2NhbGFyKDE1LjApKTsKCiAgICAgICAgICAgICAgICBjb25zdCBnYW1lID0gd2luZG93LmZsdXguZ2FtZUluc3RhbmNlOwogICAgICAgICAgICAgICAgY29uc3Qgb3Bwb25lbnRUZWFtSWQgPSB0aGlzLnRlYW0uaWQgPT09ICdob21lJyA/ICdhd2F5JyA6ICdob21lJzsKICAgICAgICAgICAgICAgIGNvbnN0IG9wcG9uZW50VGVhbSA9IGdhbWUudGVhbXNbb3Bwb25lbnRUZWFtSWRdOwoKICAgICAgICAgICAgICAgIG9wcG9uZW50VGVhbS5wbGF5ZXJzLmZvckVhY2gocCA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFwLm1lc2gpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gdGhpcy5tZXNoLnBvc2l0aW9uLmRpc3RhbmNlVG8ocC5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZGlzdCA8IHRoaXMudGFja2xlUmFkaXVzICogMS41KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHB1c2hEaXIgPSBwLm1lc2gucG9zaXRpb24uY2xvbmUoKS5zdWIodGhpcy5tZXNoLnBvc2l0aW9uKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcHVzaERpci55ID0gMC41OwogICAgICAgICAgICAgICAgICAgICAgICBwLnZlbG9jaXR5LmFkZChwdXNoRGlyLm11bHRpcGx5U2NhbGFyKDE1LjApKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHAuc3R1blRpbWVyID0gMi4wOwogICAgICAgICAgICAgICAgICAgICAgICBwLnBsYXkoJ2NhdGNoJywgMC4yKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnYW1lLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5mbG9hdGluZ1RleHQuc3Bhd24oIlNUVU4hIiwgcC5tZXNoLnBvc2l0aW9uLCAiZGFtYWdlIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCmlmIChnYW1lLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgIGdhbWUuZmxvYXRpbmdUZXh0LnNwYXduKCJCUkVBSyEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJ0ZWNoIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKLy8gTkVXOiBTcGF3biBCcmVhayBHbHlwaCAoRXhwbG9zaXZlIEJ1cnN0KQogICAgICAgICAgICAgICAgaWYgKGdhbWUuZ2x5cGhNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICAgICAgZ2FtZS5nbHlwaE1hbmFnZXIuc3Bhd24oJ3N0YXR1cycsIHRoaXMubWVzaC5wb3NpdGlvbiwgewogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQ6IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGxpZmU6IDAuNSwKICAgICAgICAgICAgICAgICAgICAgICAgcm90YXRpb25TcGVlZDogOC4wLAogICAgICAgICAgICAgICAgICAgICAgICBzY2FsZVNwZWVkOiAzLjAsCiAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldFk6IDAuNQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCi8vIFBhcnRpY2xlIEJ1cnN0IChCcmVhayBUYWNrbGUpCiAgICAgICAgICAgICAgICBpZiAoZ2FtZS5wYXJ0aWNsZU1hbmFnZXIpIHsKICAgICAgICAgICAgICAgICAgICBnYW1lLnBhcnRpY2xlTWFuYWdlci5zcGF3bignc2hvY2t3YXZlJywgdGhpcy5tZXNoLnBvc2l0aW9uLCB7IHNjYWxlOiAyLjAsIGxpZmU6IDAuMyB9KTsKICAgICAgICAgICAgICAgICAgICBnYW1lLnBhcnRpY2xlTWFuYWdlci5zcGF3bignZmxhc2gnLCB0aGlzLm1lc2gucG9zaXRpb24sIHsgc2NhbGU6IDIuNSB9KTsKICAgICAgICAgICAgICAgICAgICAvLyBCdWJibGUgQnVyc3QKICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTwzMDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJQb3MgPSB0aGlzLm1lc2gucG9zaXRpb24uY2xvbmUoKS5hZGQobmV3IFRIUkVFLlZlY3RvcjMoKE1hdGgucmFuZG9tKCktMC41KSwgMS4wKyhNYXRoLnJhbmRvbSgpLTAuNSksIChNYXRoLnJhbmRvbSgpLTAuNSkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5wYXJ0aWNsZU1hbmFnZXIuc3Bhd24oJ2J1YmJsZScsIGJQb3MsIHsgc2NhbGU6IDAuMiArIE1hdGgucmFuZG9tKCkgKiAwLjQgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChnYW1lLnRyaWdnZXJJbXBhY3QpIGdhbWUudHJpZ2dlckltcGFjdCgwLjE1LCAnaGVhdnknKTsKCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIE9GRkVOU0U6IFNQUklOVAogICAgICAgICAgICBpZiAodGhpcy5oYXNCYWxsKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjb3N0ID0gNTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRFTiA8IGNvc3QpIHsKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJOTyBFTiEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJkYW1hZ2UiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudEVOIC09IGNvc3Q7CiAgICAgICAgICAgICAgICB0aGlzLmlzRGFzaGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLmRhc2hUaW1lID0gMC40OwogICAgICAgICAgICAgICAgdGhpcy5kYXNoQ29vbGRvd24gPSAxLjU7CiAgICAgICAgICAgICAgICB0aGlzLmRhc2hUeXBlID0gJ3NwcmludCc7CgogICAgICAgICAgICAgICAgY29uc3QgYnVyc3REaXIgPSB0aGlzLnZlbG9jaXR5LmNsb25lKCkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICBpZiAoYnVyc3REaXIubGVuZ3RoU3EoKSA8IDAuMSkgYnVyc3REaXIuc2V0KDAsIDAsIDEpLmFwcGx5UXVhdGVybmlvbih0aGlzLm1lc2gucXVhdGVybmlvbik7CgogICAgICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS5hZGQoYnVyc3REaXIubXVsdGlwbHlTY2FsYXIoMTUuMCkpOwoKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhTWFuYWdlcikgewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5jYW1lcmFNYW5hZ2VyLmFkZEZvdkltcHVsc2UoMjApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJEQVNIISIsIHRoaXMubWVzaC5wb3NpdGlvbiwgInRlY2giKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gREVGRU5TRTogQkxPQ0sgLyBUQUNLTEUKICAgICAgICAgICAgY29uc3QgYmFsbCA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5lbnRpdGllcy5iYWxsOwogICAgICAgICAgICBsZXQgaXNCbG9ja0NvbnRleHQgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKGJhbGwgJiYgYmFsbC5tZXNoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gdGhpcy5tZXNoLnBvc2l0aW9uLmRpc3RhbmNlVG8oYmFsbC5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgIGlmIChkaXN0IDwgOC4wICYmIGJhbGwubWVzaC5wb3NpdGlvbi55ID4gMi41KSB7CiAgICAgICAgICAgICAgICAgICAgaXNCbG9ja0NvbnRleHQgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmlzRGFzaGluZyA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuZGFzaFRpbWUgPSB0aGlzLmRhc2hUb3RhbFRpbWU7CiAgICAgICAgICAgIHRoaXMuZGFzaENvb2xkb3duID0gMS41OwoKICAgICAgICAgICAgY29uc3QgbGVuID0gTWF0aC5zcXJ0KHgqeCArIHoqeik7CiAgICAgICAgICAgIGNvbnN0IG54ID0gKGxlbiA+IDApID8geC9sZW4gOiAwOwogICAgICAgICAgICBjb25zdCBueiA9IChsZW4gPiAwKSA/IHovbGVuIDogMDsKCmlmIChsZW4gPiAwKSB7CiAgICAgICAgICAgICAgICBsZXQgdGFyZ2V0QW5nbGUgPSBNYXRoLmF0YW4yKG54LCBueik7CiAgICAgICAgICAgICAgICB0YXJnZXRBbmdsZSArPSB0aGlzLnJvdGF0aW9uT2Zmc2V0OwogICAgICAgICAgICAgICAgdGhpcy5tZXNoLnF1YXRlcm5pb24uc2V0RnJvbUF4aXNBbmdsZShfcEF4aXNZLCB0YXJnZXRBbmdsZSk7CiAgICAgICAgICAgICAgICB0aGlzLnN5bmNSb3RhdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChpc0Jsb2NrQ29udGV4dCkgewogICAgICAgICAgICAgICAgdGhpcy5kYXNoVHlwZSA9ICd2ZXJ0aWNhbCc7CgogICAgICAgICAgICAgICAgY29uc3QgZGlyVG9CYWxsID0gYmFsbC5tZXNoLnBvc2l0aW9uLmNsb25lKCkuc3ViKHRoaXMubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICBkaXJUb0JhbGwueSA9IDA7CgogICAgICAgICAgICAgICAgaWYgKGRpclRvQmFsbC5sZW5ndGhTcSgpID4gMC4wMSkgewogICAgICAgICAgICAgICAgICAgIGRpclRvQmFsbC5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmRhc2hWZWMuY29weShkaXJUb0JhbGwpLm11bHRpcGx5U2NhbGFyKDguMCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuZGFzaFZlYy5zZXQoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29uc3QgY2F0Y2hBY3Rpb24gPSB0aGlzLmFjdGlvbnNbJ2NhdGNoJ107CiAgICAgICAgICAgICAgICBpZiAoY2F0Y2hBY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICBjYXRjaEFjdGlvbi5zZXRMb29wKFRIUkVFLkxvb3BPbmNlKTsKICAgICAgICAgICAgICAgICAgICBjYXRjaEFjdGlvbi5jbGFtcFdoZW5GaW5pc2hlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgY2F0Y2hBY3Rpb24udGltZVNjYWxlID0gMS41OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5wbGF5KCdjYXRjaCcsIDAuMSk7CgogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJCTE9DSyEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJkZWZhdWx0Iik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5kYXNoVHlwZSA9ICdob3Jpem9udGFsJzsKICAgICAgICAgICAgICAgIHRoaXMuX2hhc0hpdFRhY2tsZSA9IGZhbHNlOwoKICAgICAgICAgICAgICAgIC8vIEFwcGx5IHZlbG9jaXR5IGltcHVsc2UgaW4gZGFzaCBkaXJlY3Rpb24KICAgICAgICAgICAgICAgIGNvbnN0IGRhc2hEaXIgPSBuZXcgVEhSRUUuVmVjdG9yMyhueCwgMCwgbnopOwogICAgICAgICAgICAgICAgaWYgKGRhc2hEaXIubGVuZ3RoU3EoKSA8IDAuMSkgewogICAgICAgICAgICAgICAgICAgIGRhc2hEaXIuc2V0KDAsIDAsIDEpLmFwcGx5UXVhdGVybmlvbih0aGlzLm1lc2gucXVhdGVybmlvbik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5LmFkZChkYXNoRGlyLm11bHRpcGx5U2NhbGFyKDIwLjApKTsKCiAgICAgICAgICAgICAgICBjb25zdCBsdW5nZUFjdGlvbiA9IHRoaXMuYWN0aW9uc1sndGhyb3cnXTsKICAgICAgICAgICAgICAgIGlmIChsdW5nZUFjdGlvbikgewogICAgICAgICAgICAgICAgICAgIGx1bmdlQWN0aW9uLnNldExvb3AoVEhSRUUuTG9vcE9uY2UpOwogICAgICAgICAgICAgICAgICAgIGx1bmdlQWN0aW9uLmNsYW1wV2hlbkZpbmlzaGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBsdW5nZUFjdGlvbi50aW1lU2NhbGUgPSAyLjA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLnBsYXkoJ3Rocm93JywgMC4xKTsKCiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLnRyaWdnZXJJbXBhY3QpIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS50cmlnZ2VySW1wYWN0KDAuMDUsICdkZWZhdWx0Jyk7CiAgICAgICAgICAgIH0KCmlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhTWFuYWdlcikgewogICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmNhbWVyYU1hbmFnZXIuYWRkRm92SW1wdWxzZSgxMCk7CiAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhTWFuYWdlci5hZGRTaGFrZSgwLjMpOyAvLyBBZGQgc2hha2Ugb24gZGFzaCBzdGFydAogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBfY3JlYXRlSFBCYXIoKSB7CiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IG5ldyBUSFJFRS5Hcm91cCgpOwoKICAgICAgICAgICAgY29uc3QgYmdHZW8gPSBuZXcgVEhSRUUuUGxhbmVHZW9tZXRyeSgxLjIsIDAuMTUpOwogICAgICAgICAgICBjb25zdCBiZ01hdCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7IGNvbG9yOiAweDAwMDAwMCwgc2lkZTogVEhSRUUuRG91YmxlU2lkZSwgZGVwdGhUZXN0OiBmYWxzZSB9KTsKICAgICAgICAgICAgY29uc3QgYmcgPSBuZXcgVEhSRUUuTWVzaChiZ0dlbywgYmdNYXQpOwogICAgICAgICAgICBjb250YWluZXIuYWRkKGJnKTsKCiAgICAgICAgICAgIGNvbnN0IGZpbGxHZW8gPSBuZXcgVEhSRUUuUGxhbmVHZW9tZXRyeSgxLjE2LCAwLjExKTsKICAgICAgICAgICAgZmlsbEdlby50cmFuc2xhdGUoMC41OCwgMCwgMCk7CiAgICAgICAgICAgIGNvbnN0IGZpbGxNYXQgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyBjb2xvcjogMHgwMGZmMDAsIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGUsIGRlcHRoVGVzdDogZmFsc2UgfSk7CiAgICAgICAgICAgIHRoaXMuaHBCYXJGaWxsID0gbmV3IFRIUkVFLk1lc2goZmlsbEdlbywgZmlsbE1hdCk7CiAgICAgICAgICAgIHRoaXMuaHBCYXJGaWxsLnBvc2l0aW9uLnNldCgtMC41OCwgMCwgMC4wMSk7CiAgICAgICAgICAgIGNvbnRhaW5lci5hZGQodGhpcy5ocEJhckZpbGwpOwoKICAgICAgICAgICAgdGhpcy5ocEJhciA9IGNvbnRhaW5lcjsKICAgICAgICAgICAgdGhpcy5zY2VuZS5hZGQodGhpcy5ocEJhcik7CiAgICAgICAgfQoKICAgICAgICBfdXBkYXRlSFBCYXIoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5ocEJhciB8fCAhdGhpcy5tZXNoKSByZXR1cm47CgogICAgICAgICAgICB0aGlzLmhwQmFyLnBvc2l0aW9uLmNvcHkodGhpcy5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgdGhpcy5ocEJhci5wb3NpdGlvbi55ICs9IDIuMjsKCiAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UgJiYgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmNhbWVyYSkgewogICAgICAgICAgICAgICAgdGhpcy5ocEJhci5sb29rQXQod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmNhbWVyYS5wb3NpdGlvbik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IHBjdCA9IE1hdGgubWF4KDAsIHRoaXMuc3RhdHMuSFAgLyB0aGlzLnN0YXRzLm1heEhQKTsKICAgICAgICAgICAgdGhpcy5ocEJhckZpbGwuc2NhbGUuc2V0WChwY3QpOwoKICAgICAgICAgICAgaWYgKHBjdCA+IDAuNSkgdGhpcy5ocEJhckZpbGwubWF0ZXJpYWwuY29sb3Iuc2V0SGV4KDB4MDBmZjAwKTsKICAgICAgICAgICAgZWxzZSBpZiAocGN0ID4gMC4yNSkgdGhpcy5ocEJhckZpbGwubWF0ZXJpYWwuY29sb3Iuc2V0SGV4KDB4ZmZmZjAwKTsKICAgICAgICAgICAgZWxzZSB0aGlzLmhwQmFyRmlsbC5tYXRlcmlhbC5jb2xvci5zZXRIZXgoMHhmZjAwMDApOwoKICAgICAgICAgICAgdGhpcy5ocEJhci52aXNpYmxlID0gKHBjdCA8IDAuOTgpOwogICAgICAgIH0KCiAgICAgICAgZ2FpbkV4cChhbW91bnQpIHsKICAgICAgICAgICAgaWYgKCF3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UgfHwgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLnN0YXRlICE9PSAnYWN0aXZlJykgcmV0dXJuOwoKICAgICAgICAgICAgdGhpcy5leHAgKz0gYW1vdW50OwoKICAgICAgICAgICAgaWYgKHRoaXMuZXhwID49IHRoaXMubmV4dExldmVsRXhwKSB7CiAgICAgICAgICAgICAgICB0aGlzLmxldmVsVXAoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgbGV2ZWxVcCgpIHsKICAgICAgICAgICAgdGhpcy5sZXZlbCsrOwogICAgICAgICAgICB0aGlzLmV4cCAtPSB0aGlzLm5leHRMZXZlbEV4cDsKICAgICAgICAgICAgdGhpcy5uZXh0TGV2ZWxFeHAgPSBNYXRoLmZsb29yKHRoaXMubmV4dExldmVsRXhwICogMS41KTsKCiAgICAgICAgICAgIGNvbnN0IGtleXMgPSBbJ0hQJywgJ0VOJywgJ0FUJywgJ1BBJywgJ0JMJywgJ1NIJywgJ0NBJywgJ1NQJ107CgogICAgICAgICAgICBjb25zdCBocEdhaW4gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyMCkgKyAxMDsKICAgICAgICAgICAgdGhpcy5zdGF0cy5tYXhIUCArPSBocEdhaW47CiAgICAgICAgICAgIHRoaXMuc3RhdHMuSFAgPSB0aGlzLnN0YXRzLm1heEhQOwoKICAgICAgICAgICAga2V5cy5mb3JFYWNoKGsgPT4gewogICAgICAgICAgICAgICAgaWYgKGsgPT09ICdIUCcpIHJldHVybjsKICAgICAgICAgICAgICAgIGlmIChNYXRoLnJhbmRvbSgpID4gMC40KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZ2FpbiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpICsgMTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRzW2tdICs9IGdhaW47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgdGhpcy5fdXBkYXRlRGVyaXZlZFN0YXRzKCk7CgogICAgICAgICAgICBjb25zb2xlLmxvZyhgJHt0aGlzLnJvbGV9IHJlYWNoZWQgTGV2ZWwgJHt0aGlzLmxldmVsfSFgKTsKCiAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0ICYmIHRoaXMubWVzaCkgewogICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dC5zcGF3bigiTEVWRUwgVVAhIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAidGVjaCIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBfY2hlY2tUYWNrbGVDb2xsaXNpb24oKSB7CiAgICAgICAgICAgIGlmICghdGhpcy50ZWFtIHx8IHRoaXMuX2hhc0hpdFRhY2tsZSkgcmV0dXJuOwoKICAgICAgICAgICAgY29uc3QgZ2FtZSA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZTsKICAgICAgICAgICAgaWYgKCFnYW1lKSByZXR1cm47CgogICAgICAgICAgICBjb25zdCBvcHBvbmVudFRlYW1JZCA9IHRoaXMudGVhbS5pZCA9PT0gJ2hvbWUnID8gJ2F3YXknIDogJ2hvbWUnOwogICAgICAgICAgICBjb25zdCBvcHBvbmVudFRlYW0gPSBnYW1lLnRlYW1zW29wcG9uZW50VGVhbUlkXTsKCiAgICAgICAgICAgIGZvciAoY29uc3Qgb3BwIG9mIG9wcG9uZW50VGVhbS5wbGF5ZXJzKSB7CiAgICAgICAgICAgICAgICBpZiAoIW9wcC5tZXNoKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGNvbnN0IGRpc3QgPSB0aGlzLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyhvcHAubWVzaC5wb3NpdGlvbik7CgppZiAoZGlzdCA8IDMuMCkgeyAvLyBJbmNyZWFzZWQgZnJvbSAyLjAgZm9yIGVhc2llciBoaXRzCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVzb2x2ZVRhY2tsZUhpdChvcHApOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2hhc0hpdFRhY2tsZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBfcmVzb2x2ZVRhY2tsZUhpdChvcHApIHsKICAgICAgICAgICAgdGhpcy5pc0Rhc2hpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS5tdWx0aXBseVNjYWxhcigtMC41KTsKICAgICAgICAgICAgdGhpcy5wbGF5KCdpZGxlJywgMC4yKTsKCiAgICAgICAgICAgIGNvbnN0IGF0ID0gdGhpcy5nZXRTdGF0KCdBVCcpOwogICAgICAgICAgICBsZXQgZGFtYWdlID0gYXQgKiAzLjA7CgogICAgICAgICAgICBpZiAodGhpcy50ZWNocy50YWNrbGUgPT09ICd2ZW5vbScpIHsKICAgICAgICAgICAgICAgIG9wcC5hcHBseVN0YXR1cygndmVub20nLCAxMC4wKTsKICAgICAgICAgICAgICAgIGRhbWFnZSArPSA1OwogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMudGVjaHMudGFja2xlID09PSAnd2l0aGVyJykgewogICAgICAgICAgICAgICAgb3BwLmFwcGx5U3RhdHVzKCd3aXRoZXInLCAxMC4wLCAnRU4nKTsKICAgICAgICAgICAgICAgIGRhbWFnZSArPSA1OwogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMudGVjaHMudGFja2xlID09PSAnZHJhaW4nKSB7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXRzLkhQICs9IDIwOwogICAgICAgICAgICAgICAgb3BwLnN0YXRzLkhQIC09IDIwOwogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQpCiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dC5zcGF3bigiRFJBSU4iLCB0aGlzLm1lc2gucG9zaXRpb24sICJoZWFsIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChvcHAuaGFzQmFsbCkgewogICAgICAgICAgICAgICAgb3BwLmN1cnJlbnRFTiAtPSBkYW1hZ2U7CgppZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZWQgIkVOIiBzdWZmaXggZm9yIGNsZWFuZXIgbG9vawogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oYCR7TWF0aC5mbG9vcihkYW1hZ2UpfWAsIG9wcC5tZXNoLnBvc2l0aW9uLCAiZGFtYWdlIik7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dC5zcGF3bigiQkFNISIsIG9wcC5tZXNoLnBvc2l0aW9uLCAiY29taWMtaW1wYWN0Iik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKG9wcC5jdXJyZW50RU4gPD0gMCkgewogICAgICAgICAgICAgICAgICAgIG9wcC5mdW1ibGUoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgb3BwLnN0dW5UaW1lciA9IDAuNTsKICAgICAgICAgICAgICAgICAgICBvcHAucGxheSgncmVhY3QnLCAwLjEpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0aGlzLnRlY2hzLnRhY2tsZSAmJiB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UudHJpZ2dlclRlY2hFdmVudCkgewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS50cmlnZ2VyVGVjaEV2ZW50KHRoaXMsIHRoaXMudGVjaHMudGFja2xlKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBvcHAuc3R1blRpbWVyID0gMS4wOwogICAgICAgICAgICAgICAgb3BwLnBsYXkoJ3JlYWN0JywgMC4xKTsKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dC5zcGF3bigiU01BQ0shIiwgb3BwLm1lc2gucG9zaXRpb24sICJjb21pYy1pbXBhY3QiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgcHVzaERpciA9IG9wcC5tZXNoLnBvc2l0aW9uLmNsb25lKCkuc3ViKHRoaXMubWVzaC5wb3NpdGlvbikubm9ybWFsaXplKCk7CiAgICAgICAgICAgIHB1c2hEaXIueSA9IDAuMjsKICAgICAgICAgICAgb3BwLnZlbG9jaXR5LmFkZChwdXNoRGlyLm11bHRpcGx5U2NhbGFyKDEyLjApKTsKCiAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UudHJpZ2dlckltcGFjdCkgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLnRyaWdnZXJJbXBhY3QoMC4xLCAnaGVhdnknKTsKICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5jYW1lcmFNYW5hZ2VyKSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhTWFuYWdlci5hZGRTaGFrZSgwLjgpOwogICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLnNwYXduQ2xhc2gpIHsKY29uc3QgbWlkID0gdGhpcy5tZXNoLnBvc2l0aW9uLmNsb25lKCkuYWRkKG9wcC5tZXNoLnBvc2l0aW9uKS5tdWx0aXBseVNjYWxhcigwLjUpOwogICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLnNwYXduQ2xhc2gobWlkKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKLy8gQnViYmxlIEJ1cnN0IChUYWNrbGUgSGl0KQogICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLnBhcnRpY2xlTWFuYWdlcikgewogICAgICAgICAgICAgICAgY29uc3QgbWlkID0gdGhpcy5tZXNoLnBvc2l0aW9uLmNsb25lKCkubGVycChvcHAubWVzaC5wb3NpdGlvbiwgMC41KTsKICAgICAgICAgICAgICAgIG1pZC55ICs9IDEuMDsKICAgICAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpPDMwOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBidWJibGVQb3MgPSBtaWQuY2xvbmUoKS5hZGQobmV3IFRIUkVFLlZlY3RvcjMoKE1hdGgucmFuZG9tKCktMC41KSoxLjUsIChNYXRoLnJhbmRvbSgpLTAuNSkqMS41LCAoTWF0aC5yYW5kb20oKS0wLjUpKjEuNSkpOwogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5wYXJ0aWNsZU1hbmFnZXIuc3Bhd24oJ2J1YmJsZScsIGJ1YmJsZVBvcywgeyBzY2FsZTogMC4xNSArIE1hdGgucmFuZG9tKCkgKiAwLjM1IH0pOwogICAgICAgICAgICAgICAgfQp9CiAgICAgICAgfQogICAgICAgIF9hcHBseUdvYWxDcmVhc2UoZHQpIHsKICAgICAgICAgICAgaWYgKHRoaXMucm9sZSA9PT0gJ0dMJykgcmV0dXJuOwoKICAgICAgICAgICAgY29uc3QgZ29hbHMgPSBbCiAgICAgICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAyOCksCiAgICAgICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAtMjgpCiAgICAgICAgICAgIF07CiAgICAgICAgICAgIGNvbnN0IHJhZGl1cyA9IDEwLjA7CgogICAgICAgICAgICBnb2Fscy5mb3JFYWNoKGdvYWwgPT4gewogICAgICAgICAgICAgICAgY29uc3QgZHggPSB0aGlzLm1lc2gucG9zaXRpb24ueCAtIGdvYWwueDsKICAgICAgICAgICAgICAgIGNvbnN0IGR6ID0gdGhpcy5tZXNoLnBvc2l0aW9uLnogLSBnb2FsLno7CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0U3EgPSBkeCpkeCArIGR6KmR6OwoKICAgICAgICAgICAgICAgIGlmIChkaXN0U3EgPCByYWRpdXMgKiByYWRpdXMpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gTWF0aC5zcXJ0KGRpc3RTcSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHVzaFggPSBkaXN0ID4gMCA/IGR4IC8gZGlzdCA6IDE7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHVzaFogPSBkaXN0ID4gMCA/IGR6IC8gZGlzdCA6IDA7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGZvcmNlID0gNTAuMDsKICAgICAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5LnggKz0gcHVzaFggKiBmb3JjZSAqIGR0OwogICAgICAgICAgICAgICAgICAgIHRoaXMudmVsb2NpdHkueiArPSBwdXNoWiAqIGZvcmNlICogZHQ7CgogICAgICAgICAgICAgICAgICAgIGlmIChkaXN0IDwgcmFkaXVzIC0gMC41KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNsYW1wUmF0aW8gPSByYWRpdXMgLyAoZGlzdCArIDAuMDAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNoLnBvc2l0aW9uLnggPSBnb2FsLnggKyBkeCAqIGNsYW1wUmF0aW87CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi56ID0gZ29hbC56ICsgZHogKiBjbGFtcFJhdGlvOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQoKICAgIHdpbmRvdy5mbHV4LlBsYXllciA9IFBsYXllcjsKfSkoKTsK","main.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgLy8gTmFtZXNwYWNlCiAgICB3aW5kb3cuZmx1eCA9IHdpbmRvdy5mbHV4IHx8IHt9OwoKICAgIC8vIENvbmZpZwpjb25zdCBfY29uZmlnID0gewogICAgICAgIGludGVybmFsV2lkdGg6IDM2MCwKICAgICAgICBpbnRlcm5hbEhlaWdodDogNjQwLAogICAgICAgIGJnQ29sb3I6IDB4MDAxZTM2LAogICAgICAgIGZvZ0NvbG9yOiAweDAwMWUzNiwKICAgICAgICBmb2dEZW5zaXR5OiAwLjAwMDEsIC8vIERyYXN0aWNhbGx5IHJlZHVjZWQgdG8gZW5zdXJlIHZpc2liaWxpdHkKICAgICAgICBhcmVuYVJhZGl1czogMzIuMAogICAgfTsKCiAgICAvLyBHbG9iYWxzCiAgICBsZXQgX3NjZW5lLCBfY2FtZXJhLCBfcmVuZGVyZXIsIF9jbG9jazsKICAgIGxldCBfaG9tZVRlYW0sIF9hd2F5VGVhbTsKbGV0IF9iYWxsOwogICAgbGV0IF9nYW1lTWFuYWdlcjsKICAgIGxldCBfbWVudU1hbmFnZXI7CgpsZXQgX2NhbWVyYU1hbmFnZXI7CiAgICBsZXQgX3dhdGVyT3ZlcmxheTsKICAgIGxldCBfbGlnaHRTaGFmdHM7CiAgICBsZXQgX3N0YWRpdW07CiAgICBsZXQgX2dseXBoTWFuYWdlcjsKCiAgICAvLyBJTVBST1ZFRDogU2V0dGluZ3Mgb2JqZWN0CiAgICBjb25zdCBfc2V0dGluZ3MgPSB7CiAgICAgICAgam95c3RpY2tTZW5zaXRpdml0eTogMS4wLAogICAgICAgIGFpbUFzc2lzdDogdHJ1ZSwKICAgICAgICBjYW1lcmFTaGFrZTogdHJ1ZSwKICAgICAgICBoaXRTdG9wOiB0cnVlLAogICAgICAgIGludmVydENhbWVyYTogZmFsc2UsCiAgICAgICAgYXV0b1JlY2VudGVyOiB0cnVlCiAgICB9OwoKICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgX2NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYW1lLWNvbnRhaW5lcicpOwoKICAgICAgICAvLyAxLiBTY2VuZQogICAgICAgIF9zY2VuZSA9IG5ldyBUSFJFRS5TY2VuZSgpOwogICAgICAgIF9zY2VuZS5iYWNrZ3JvdW5kID0gbmV3IFRIUkVFLkNvbG9yKF9jb25maWcuYmdDb2xvcik7CiAgICAgICAgX3NjZW5lLmZvZyA9IG5ldyBUSFJFRS5Gb2dFeHAyKF9jb25maWcuZm9nQ29sb3IsIF9jb25maWcuZm9nRGVuc2l0eSk7CgogICAgICAgIC8vIDIuIENhbWVyYQogICAgICAgIGNvbnN0IGFzcGVjdCA9IF9jb25maWcuaW50ZXJuYWxXaWR0aCAvIF9jb25maWcuaW50ZXJuYWxIZWlnaHQ7Cl9jYW1lcmEgPSBuZXcgVEhSRUUuUGVyc3BlY3RpdmVDYW1lcmEoNjAsIGFzcGVjdCwgMC4xLCA1MDApOwpfY2FtZXJhLnBvc2l0aW9uLnNldCgwLCAxNCwgMjIpOwogICAgICAgIF9jYW1lcmEubG9va0F0KDAsIDAsIDApOwogICAgICAgIF9zY2VuZS5hZGQoX2NhbWVyYSk7IC8vIEVuc3VyZSBjYW1lcmEgaXMgaW4gc2NlbmUgZm9yIGNoaWxkcmVuIHRvIHJlbmRlcgoKICAgICAgICAvLyAzLiBSZW5kZXJlcgpfcmVuZGVyZXIgPSBuZXcgVEhSRUUuV2ViR0xSZW5kZXJlcih7IGFudGlhbGlhczogZmFsc2UgfSk7CiAgICAgICAgLy8gRXhwb3NlIHJlbmRlcmVyIGZvciBEZXZUb29scwogICAgICAgIGlmIChfZ2FtZU1hbmFnZXIpIF9nYW1lTWFuYWdlci5yZW5kZXJlciA9IF9yZW5kZXJlcjsgCiAgICAgICAgZWxzZSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UgPSB7IHJlbmRlcmVyOiBfcmVuZGVyZXIgfTsgLy8gVGVtcCBob29rCl9jb250YWluZXIuYXBwZW5kQ2hpbGQoX3JlbmRlcmVyLmRvbUVsZW1lbnQpOwoKICAgICAgICAvLyAtLS0gVmlkZW8gT3ZlcmxheSBFbmZvcmNlbWVudCAtLS0KLy8gLS0tIE92ZXJsYXkgVmlkZW8gTG9naWMgUmVtb3ZlZCAoU3dpdGNoZWQgdG8gR0lGKSAtLS0KICAgICAgICAvLyA1LiBFbnZpcm9ubWVudAogICAgICAgIGNyZWF0ZVBhcnRpY2xlcygpOwogICAgICAgIGNyZWF0ZUFyZW5hKCk7CgovLyA1LjUgR2FtZSBNYW5hZ2VyCl9nYW1lTWFuYWdlciA9IG5ldyB3aW5kb3cuZmx1eC5HYW1lTWFuYWdlcihfc2NlbmUsICd1aS1sYXllcicsIF9jYW1lcmEsIF9yZW5kZXJlcik7CiAgICAgICAgCiAgICAgICAgLy8gNS41LjEgQXVkaW8gTWFuYWdlcgogICAgICAgIF9hdWRpb01hbmFnZXIgPSBuZXcgd2luZG93LmZsdXguQXVkaW9NYW5hZ2VyKCk7CiAgICAgICAgX2dhbWVNYW5hZ2VyLmF1ZGlvTWFuYWdlciA9IF9hdWRpb01hbmFnZXI7CgogICAgICAgIC8vIDUuNiBDYW1lcmEgTWFuYWdlcgogICAgICAgIF9jYW1lcmFNYW5hZ2VyID0gbmV3IHdpbmRvdy5mbHV4LkNhbWVyYU1hbmFnZXIoX2NhbWVyYSwgX3NjZW5lKTsKICAgICAgICBfZ2FtZU1hbmFnZXIuY2FtZXJhTWFuYWdlciA9IF9jYW1lcmFNYW5hZ2VyOwoKICAgICAgICAvLyA1LjcgRGV2IFRvb2xzCmlmICh3aW5kb3cuZmx1eC5EZXZUb29scykgewogICAgICAgICAgICBuZXcgd2luZG93LmZsdXguRGV2VG9vbHMoX2dhbWVNYW5hZ2VyKTsKICAgICAgICB9Ci8vIDUuOCBXYXRlciBPdmVybGF5LCBMaWdodCBTaGFmdHMsIFN0YWRpdW0sIEdseXBocwogICAgICAgIF93YXRlck92ZXJsYXkgPSBuZXcgd2luZG93LmZsdXguV2F0ZXJPdmVybGF5KF9jYW1lcmEpOwogICAgICAgIF9saWdodFNoYWZ0cyA9IG5ldyB3aW5kb3cuZmx1eC5MaWdodFNoYWZ0cyhfc2NlbmUpOwogICAgICAgIF9zdGFkaXVtID0gbmV3IHdpbmRvdy5mbHV4LlN0YWRpdW0oX3NjZW5lKTsKICAgICAgICBfZ2x5cGhNYW5hZ2VyID0gbmV3IHdpbmRvdy5mbHV4LkdseXBoTWFuYWdlcihfc2NlbmUpOwogICAgICAgIAppZiAoX2dhbWVNYW5hZ2VyKSB7CiAgICAgICAgICAgIF9nYW1lTWFuYWdlci5nbHlwaE1hbmFnZXIgPSBfZ2x5cGhNYW5hZ2VyOwogICAgICAgICAgICBfZ2FtZU1hbmFnZXIud2F0ZXJPdmVybGF5ID0gX3dhdGVyT3ZlcmxheTsKICAgICAgICAgICAgX2dhbWVNYW5hZ2VyLmxpZ2h0U2hhZnRzID0gX2xpZ2h0U2hhZnRzOwogICAgICAgICAgICBfZ2FtZU1hbmFnZXIuc3RhZGl1bSA9IF9zdGFkaXVtOwogICAgICAgIH0KICAgICAgICAvLyA2LiBUZWFtcyBTZXR1cAogICAgICAgIF9ob21lVGVhbSA9IG5ldyB3aW5kb3cuZmx1eC5UZWFtKF9zY2VuZSwgJ2hvbWUnLCAxLCAweDAwYWFmZiwgdHJ1ZSk7CiAgICAgICAgX2F3YXlUZWFtID0gbmV3IHdpbmRvdy5mbHV4LlRlYW0oX3NjZW5lLCAnYXdheScsIC0xLCAweGZmNjY2NiwgZmFsc2UpOwoKICAgICAgICAvLyA3LiBCYWxsCiAgICAgICAgX2JhbGwgPSBuZXcgd2luZG93LmZsdXguQmFsbChfc2NlbmUpOwoKICAgICAgICAvLyBJTVBST1ZFRDogTGluayBiYWxsIHRvIGNhbWVyYSBmb3Igc21hcnQgZnJhbWluZwogICAgICAgIF9jYW1lcmFNYW5hZ2VyLnNldEJhbGwoX2JhbGwpOwoKICAgICAgICAvLyA4LiBUZWFtIFJvc3RlciBNb2RlbHMKICAgICAgICBjb25zdCByb2xlcyA9IFsnTEYnLCAnUkYnLCAnTUYnLCAnTEQnLCAnUkQnLCAnR0wnXTsKICAgICAgICBjb25zdCBob21lUm9zdGVyID0gewogICAgICAgICAgICBMRjogeyBuYW1lOiAnVGlkdXMnLCB1cmw6ICdodHRwczovL2Nkbi50aW55Z2xiLmNvbS9tb2RlbHMvZGE3ODhiZWYyNThjNGYwYjhkOWVmMWFjYzE5YzU1NjcuZ2xiJyB9LAogICAgICAgICAgICBSRjogeyBuYW1lOiAnV2Fra2EnLCB1cmw6ICdodHRwczovL2Nkbi50aW55Z2xiLmNvbS9tb2RlbHMvNTkxMTRjOTg5NTE2NDdjOWI4ZGE3NGIwYmQzNjM2Y2IuZ2xiJyB9LAogICAgICAgICAgICBNRjogeyBuYW1lOiAnTGV0dHknLCB1cmw6ICdodHRwczovL2Nkbi50aW55Z2xiLmNvbS9tb2RlbHMvNDNhY2UzNGM2ZmQ5NDIxNTk2N2U4NDJiZjkwOWRhNWUuZ2xiJyB9LAogICAgICAgICAgICBMRDogeyBuYW1lOiAnRGF0dG8nLCB1cmw6ICdodHRwczovL2Nkbi50aW55Z2xiLmNvbS9tb2RlbHMvZTZkNjdlY2IyZTRjNDcxNWJkNzNhNDA3OTVlMWQzZDUuZ2xiJyB9LAogICAgICAgICAgICBSRDogeyBuYW1lOiAnSmFzc3UnLCB1cmw6ICdodHRwczovL2Nkbi50aW55Z2xiLmNvbS9tb2RlbHMvODIxNjQ1OTU2NzM1NGU2Mzk1OGQ0MTA4ZDgyOGRlOTguZ2xiJyB9LAogICAgICAgICAgICBHTDogeyBuYW1lOiAnQm90dGEnLCB1cmw6ICdodHRwczovL2Nkbi50aW55Z2xiLmNvbS9tb2RlbHMvYWQxNTVlZmVkYzBkNDhmZGFkMDlkYTNlMWNhZTljOTcuZ2xiJyB9CiAgICAgICAgfTsKCiAgICAgICAgY29uc3QgYXBwbHlTdGF0cyA9IChwLCByb2xlLCBpc0hvbWUpID0+IHsKICAgICAgICAgICAgY29uc3QgdGVhbUxldmVsID0gaXNIb21lID8gMjUgOiAyMjsKICAgICAgICAgICAgd2luZG93LmZsdXguVGVhbS5nZW5lcmF0ZVN0YXRzKHAsIHJvbGUsIHRlYW1MZXZlbCwgaXNIb21lKTsKCiAgICAgICAgICAgIGlmIChwLmNoYXJhY3Rlck5hbWUuaW5jbHVkZXMoJ1RpZHVzJykpIHsKICAgICAgICAgICAgICAgIHAuc3RhdHMuU0ggKz0gNTsKICAgICAgICAgICAgICAgIHAuc3RhdHMuU1AgKz0gMzsKICAgICAgICAgICAgfSBlbHNlIGlmIChwLmNoYXJhY3Rlck5hbWUuaW5jbHVkZXMoJ1dha2thJykpIHsKICAgICAgICAgICAgICAgIHAuc3RhdHMuU0ggKz0gMzsKICAgICAgICAgICAgICAgIHAuc3RhdHMuRU4gKz0gNTsKICAgICAgICAgICAgfSBlbHNlIGlmIChwLmNoYXJhY3Rlck5hbWUuaW5jbHVkZXMoJ0Jyb3RoZXInKSkgewogICAgICAgICAgICAgICAgcC5zdGF0cy5TUCA9IDk5OwogICAgICAgICAgICB9CgogICAgICAgICAgICBwLl91cGRhdGVEZXJpdmVkU3RhdHMoKTsKICAgICAgICB9OwoKICAgICAgICBsZXQgaG9tZUxvYWRlZCA9IDA7CiAgICAgICAgY29uc3Qgcm9sZUdsdGZzID0ge307CgogICAgICAgIGNvbnN0IGZpbmFsaXplVGVhbXMgPSAoKSA9PiB7CiAgICAgICAgICAgIHJvbGVzLmZvckVhY2gocm9sZSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBnbHRmID0gcm9sZUdsdGZzW3JvbGVdIHx8IHJvbGVHbHRmcy5MRjsKCiAgICAgICAgICAgICAgICBjb25zdCBwID0gKHJvbGUgPT09ICdHTCcpCiAgICAgICAgICAgICAgICAgICAgPyBuZXcgd2luZG93LmZsdXguR29hbGllKF9zY2VuZSwgcm9sZSkKICAgICAgICAgICAgICAgICAgICA6IG5ldyB3aW5kb3cuZmx1eC5BSVBsYXllcihfc2NlbmUsIHJvbGUpOwoKICAgICAgICAgICAgICAgIGNvbnN0IGVudHJ5ID0gaG9tZVJvc3Rlcltyb2xlXTsKICAgICAgICAgICAgICAgIHAuY2hhcmFjdGVyTmFtZSA9IGVudHJ5ID8gYENQVSAke2VudHJ5Lm5hbWV9YCA6ICdDUFUnOwogICAgICAgICAgICAgICAgYXBwbHlTdGF0cyhwLCByb2xlLCBmYWxzZSk7CgogICAgICAgICAgICAgICAgaWYgKGdsdGYgJiYgZ2x0Zi5zY2VuZSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNsb25lID0gVEhSRUUuU2tlbGV0b25VdGlscy5jbG9uZShnbHRmLnNjZW5lKTsKICAgICAgICAgICAgICAgICAgICBwLnNldE1lc2goY2xvbmUsIGdsdGYuYW5pbWF0aW9ucyB8fCBbXSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignTWlzc2luZyBHTFRGIGZvciBhd2F5IHJvbGU6Jywgcm9sZSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2F3YXlUZWFtLmFkZFBsYXllcihwKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjb25zdCBhbGxQbGF5ZXJzID0gWy4uLl9ob21lVGVhbS5wbGF5ZXJzLCAuLi5fYXdheVRlYW0ucGxheWVyc107CiAgICAgICAgICAgIGFsbFBsYXllcnMuZm9yRWFjaChwID0+IHsKICAgICAgICAgICAgICAgIGlmIChwLmJhbGxSZWYgPT09IG51bGwpIHAuYmFsbFJlZiA9IF9iYWxsOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIF9ob21lVGVhbS5hY3RpdmVQbGF5ZXIgPSBfaG9tZVRlYW0ucGxheWVycy5maW5kKHAgPT4gcC5yb2xlID09PSAnTUYnKTsKCiAgICAgICAgICAgIGlmIChfaG9tZVRlYW0uYWN0aXZlUGxheWVyKSB7CiAgICAgICAgICAgICAgICBfaG9tZVRlYW0uYWN0aXZlUGxheWVyLnRlY2hzLnRhY2tsZSA9ICd2ZW5vbSc7CiAgICAgICAgICAgICAgICBfaG9tZVRlYW0uYWN0aXZlUGxheWVyLnRlY2hzLnNob290ID0gJ3NwaGVyZSc7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRXF1aXBwZWQgSG9tZSBNRiB3aXRoIFZlbm9tIFRhY2tsZSAmIFNwaGVyZSBTaG90Jyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IGF3YXlNRiA9IF9hd2F5VGVhbS5wbGF5ZXJzLmZpbmQocCA9PiBwLnJvbGUgPT09ICdNRicpOwogICAgICAgICAgICBpZiAoYXdheU1GKSB7CiAgICAgICAgICAgICAgICBhd2F5TUYudGVjaHMudGFja2xlID0gJ3dpdGhlcic7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2F3YXlUZWFtLnNldEZvcm1hdGlvbignQ291bnRlcicpOwoKICAgICAgICAgICAgY29uc3QgYXdheUdMID0gX2F3YXlUZWFtLnBsYXllcnMuZmluZChwID0+IHAucm9sZSA9PT0gJ0dMJyk7CiAgICAgICAgICAgIGlmIChhd2F5R0wpIHsKICAgICAgICAgICAgICAgIGF3YXlHTC50ZWNocy5hY3RpdmUgPSAnc3VwZXJfZ29hbGllJzsKICAgICAgICAgICAgICAgIGF3YXlHTC50ZWNocy5wYXNzaXZlID0gJ2dyaXBfZ2xvdmVzJzsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFcXVpcHBlZCBBd2F5IEdMIHdpdGggU3VwZXIgR29hbGllJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9ob21lVGVhbS5hc3NpZ25NYXJrcyhfYXdheVRlYW0pOwogICAgICAgICAgICBfYXdheVRlYW0uYXNzaWduTWFya3MoX2hvbWVUZWFtKTsKCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgaWYgKF9nYW1lTWFuYWdlcikgewogICAgICAgICAgICAgICAgX2dhbWVNYW5hZ2VyLnJlZ2lzdGVyVGVhbXMoX2hvbWVUZWFtLCBfYXdheVRlYW0sIF9iYWxsKTsKCiAgICAgICAgICAgICAgICBfbWVudU1hbmFnZXIgPSBuZXcgd2luZG93LmZsdXguTWVudU1hbmFnZXIoX2dhbWVNYW5hZ2VyKTsKICAgICAgICAgICAgICAgIF9tZW51TWFuYWdlci5zaG93KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKcm9sZXMuZm9yRWFjaChyb2xlID0+IHsKICAgICAgICAgICAgY29uc3QgZW50cnkgPSBob21lUm9zdGVyW3JvbGVdOwogICAgICAgICAgICBpZiAoIWVudHJ5KSByZXR1cm47CgogICAgICAgICAgICBjb25zdCBvbkNvbXBsZXRlID0gKCkgPT4gewogICAgICAgICAgICAgICAgaG9tZUxvYWRlZCsrOwogICAgICAgICAgICAgICAgaWYgKGhvbWVMb2FkZWQgPj0gcm9sZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgZmluYWxpemVUZWFtcygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgd2luZG93LmZsdXguQXNzZXRMb2FkZXIubG9hZE1vZGVsKGVudHJ5LnVybCwgKGdsdGYpID0+IHsKICAgICAgICAgICAgICAgIHJvbGVHbHRmc1tyb2xlXSA9IGdsdGY7CgogICAgICAgICAgICAgICAgY29uc3QgcCA9IChyb2xlID09PSAnR0wnKQogICAgICAgICAgICAgICAgICAgID8gbmV3IHdpbmRvdy5mbHV4LkdvYWxpZShfc2NlbmUsIHJvbGUpCiAgICAgICAgICAgICAgICAgICAgOiBuZXcgd2luZG93LmZsdXguQUlQbGF5ZXIoX3NjZW5lLCByb2xlKTsKCiAgICAgICAgICAgICAgICBwLmNoYXJhY3Rlck5hbWUgPSBlbnRyeS5uYW1lOwogICAgICAgICAgICAgICAgYXBwbHlTdGF0cyhwLCByb2xlLCB0cnVlKTsKCiAgICAgICAgICAgICAgICBjb25zdCBjbG9uZSA9IFRIUkVFLlNrZWxldG9uVXRpbHMuY2xvbmUoZ2x0Zi5zY2VuZSk7CiAgICAgICAgICAgICAgICBwLnNldE1lc2goY2xvbmUsIGdsdGYuYW5pbWF0aW9ucyk7CiAgICAgICAgICAgICAgICBfaG9tZVRlYW0uYWRkUGxheWVyKHApOwoKICAgICAgICAgICAgICAgIG9uQ29tcGxldGUoKTsKICAgICAgICAgICAgfSwgdW5kZWZpbmVkLCAoZXJyKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gbG9hZCBtb2RlbCcsIGVudHJ5Lm5hbWUsIGVudHJ5LnVybCwgZXJyKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRmFsbGJhY2sgTWVzaCAoUmVkIEJveCkKICAgICAgICAgICAgICAgIGNvbnN0IGZhbGxiYWNrR2VvID0gbmV3IFRIUkVFLkJveEdlb21ldHJ5KDEsIDIsIDEpOwogICAgICAgICAgICAgICAgY29uc3QgZmFsbGJhY2tNYXQgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyBjb2xvcjogMHhmZjAwMDAsIHdpcmVmcmFtZTogdHJ1ZSB9KTsKICAgICAgICAgICAgICAgIGNvbnN0IGZhbGxiYWNrTWVzaCA9IG5ldyBUSFJFRS5NZXNoKGZhbGxiYWNrR2VvLCBmYWxsYmFja01hdCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFN0b3JlIGR1bW15IGluIHJvbGVHbHRmcyBmb3IgYXdheSB0ZWFtIGNsb25pbmcKICAgICAgICAgICAgICAgIHJvbGVHbHRmc1tyb2xlXSA9IHsgc2NlbmU6IGZhbGxiYWNrTWVzaCwgYW5pbWF0aW9uczogW10gfTsKCiAgICAgICAgICAgICAgICBjb25zdCBwID0gKHJvbGUgPT09ICdHTCcpCiAgICAgICAgICAgICAgICAgICAgPyBuZXcgd2luZG93LmZsdXguR29hbGllKF9zY2VuZSwgcm9sZSkKICAgICAgICAgICAgICAgICAgICA6IG5ldyB3aW5kb3cuZmx1eC5BSVBsYXllcihfc2NlbmUsIHJvbGUpOwoKICAgICAgICAgICAgICAgIHAuY2hhcmFjdGVyTmFtZSA9IGVudHJ5Lm5hbWUgKyAiIChFcnJvcikiOwogICAgICAgICAgICAgICAgYXBwbHlTdGF0cyhwLCByb2xlLCB0cnVlKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcC5zZXRNZXNoKGZhbGxiYWNrTWVzaC5jbG9uZSgpLCBbXSk7CiAgICAgICAgICAgICAgICBfaG9tZVRlYW0uYWRkUGxheWVyKHApOwoKICAgICAgICAgICAgICAgIG9uQ29tcGxldGUoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vIDguIElucHV0CiAgICAgICAgc2V0dXBJbnB1dHMoKTsKCiAgICAgICAgLy8gOS4gTG9vcAogICAgICAgIF9jbG9jayA9IG5ldyBUSFJFRS5DbG9jaygpOwogICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKCiAgICAgICAgLy8gSGFuZGxlIHJlc2l6ZQogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBvblJlc2l6ZSk7CiAgICAgICAgb25SZXNpemUoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGVQYXJ0aWNsZXMoKSB7CiAgICAgICAgY29uc3QgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuQnVmZmVyR2VvbWV0cnkoKTsKICAgICAgICBjb25zdCB2ZXJ0aWNlcyA9IFtdOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNTAwOyBpKyspIHsKICAgICAgICAgICAgdmVydGljZXMucHVzaCgKICAgICAgICAgICAgICAgIChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDIwLAogICAgICAgICAgICAgICAgKE1hdGgucmFuZG9tKCkgLSAwLjUpICogMjAsCiAgICAgICAgICAgICAgICAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiAyMAogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBnZW9tZXRyeS5zZXRBdHRyaWJ1dGUoJ3Bvc2l0aW9uJywgbmV3IFRIUkVFLkZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUodmVydGljZXMsIDMpKTsKICAgICAgICBjb25zdCBtYXRlcmlhbCA9IG5ldyBUSFJFRS5Qb2ludHNNYXRlcmlhbCh7IGNvbG9yOiAweDg4Y2NmZiwgc2l6ZTogMC4wNSwgdHJhbnNwYXJlbnQ6IHRydWUsIG9wYWNpdHk6IDAuNiB9KTsKICAgICAgICBjb25zdCBwb2ludHMgPSBuZXcgVEhSRUUuUG9pbnRzKGdlb21ldHJ5LCBtYXRlcmlhbCk7CiAgICAgICAgX3NjZW5lLmFkZChwb2ludHMpOwogICAgfQoKZnVuY3Rpb24gY3JlYXRlQXJlbmEoKSB7CiAgICAgICAgY29uc3QgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuU3BoZXJlR2VvbWV0cnkoX2NvbmZpZy5hcmVuYVJhZGl1cywgMzIsIDMyKTsKICAgICAgICAKICAgICAgICBjb25zdCB0ZXhMb2FkZXIgPSBuZXcgVEhSRUUuVGV4dHVyZUxvYWRlcigpOwpjb25zdCBhcmVuYVRleCA9IHRleExvYWRlci5sb2FkKCdodHRwczovL2kucG9zdGltZy5jYy9XMUxzSDY4US9maWxlLTAwMDAwMDAwMjNlYzcxZjU5NjU5MzgyOWU4MTE4NzYwLSgxKS5wbmcnKTsKICAgICAgICBhcmVuYVRleC5tYWdGaWx0ZXIgPSBUSFJFRS5OZWFyZXN0RmlsdGVyOwogICAgICAgIGFyZW5hVGV4Lm1pbkZpbHRlciA9IFRIUkVFLk5lYXJlc3RGaWx0ZXI7CiAgICAgICAgYXJlbmFUZXgud3JhcFMgPSBUSFJFRS5SZXBlYXRXcmFwcGluZzsKICAgICAgICBhcmVuYVRleC53cmFwVCA9IFRIUkVFLlJlcGVhdFdyYXBwaW5nOwogICAgICAgIGFyZW5hVGV4LnJlcGVhdC5zZXQoNiwgNCk7Cgpjb25zdCBtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7CiAgICAgICAgICAgIG1hcDogYXJlbmFUZXgsCiAgICAgICAgICAgIGNvbG9yOiAweGZmZmZmZiwKICAgICAgICAgICAgd2lyZWZyYW1lOiBmYWxzZSwKICAgICAgICAgICAgdHJhbnNwYXJlbnQ6IHRydWUsCiAgICAgICAgICAgIG9wYWNpdHk6IDAuMCwgLy8gRGVmYXVsdCBpbnZpc2libGUgKDAuMCkgYXMgcmVxdWVzdGVkCiAgICAgICAgICAgIGJsZW5kaW5nOiBUSFJFRS5NdWx0aXBseUJsZW5kaW5nLAogICAgICAgICAgICBzaWRlOiBUSFJFRS5CYWNrU2lkZQogICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICBjb25zdCBhcmVuYSA9IG5ldyBUSFJFRS5NZXNoKGdlb21ldHJ5LCBtYXRlcmlhbCk7CiAgICAgICAgX3NjZW5lLmFkZChhcmVuYSk7CiAgICAgICAgd2luZG93LmZsdXguYXJlbmFNZXNoID0gYXJlbmE7CgovLyAtLS0gQXJlbmEgMiAoTm9ybWFsIEJsZW5kLCA1JSBPcGFjaXR5KSAtLS0KICAgICAgICBjb25zdCBtYXRlcmlhbDIgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoewogICAgICAgICAgICBtYXA6IGFyZW5hVGV4LAogICAgICAgICAgICBjb2xvcjogMHhmZmZmZmYsCiAgICAgICAgICAgIHdpcmVmcmFtZTogZmFsc2UsCiAgICAgICAgICAgIHRyYW5zcGFyZW50OiB0cnVlLAogICAgICAgICAgICBvcGFjaXR5OiAwLjA1LAogICAgICAgICAgICBibGVuZGluZzogVEhSRUUuTm9ybWFsQmxlbmRpbmcsCiAgICAgICAgICAgIHNpZGU6IFRIUkVFLkJhY2tTaWRlCiAgICAgICAgfSk7CiAgICAgICAgY29uc3QgYXJlbmEyID0gbmV3IFRIUkVFLk1lc2goZ2VvbWV0cnksIG1hdGVyaWFsMik7CiAgICAgICAgYXJlbmEyLnNjYWxlLnNldFNjYWxhcigwLjk5NSk7IC8vIFNsaWdodCBvZmZzZXQgdG8gcHJldmVudCB6LWZpZ2h0aW5nCiAgICAgICAgX3NjZW5lLmFkZChhcmVuYTIpOwogICAgICAgIHdpbmRvdy5mbHV4LmFyZW5hTWVzaDIgPSBhcmVuYTI7CgogICAgICAgIC8vIC0tLSBORVc6IEZGWCBHT0FMIE1PREVMUyAtLS0KICAgICAgICBjb25zdCBnb2FsVXJsID0gJ2h0dHBzOi8vY2RuLnRpbnlnbGIuY29tL21vZGVscy9hNTE2YmQ5MGZhN2M0ZGVkYjVkY2JmZGY4MDNmMTNkNS5nbGInOwogICAgICAgIApjb25zdCBvbkdvYWxMb2FkZWQgPSAobW9kZWwsIGlzRmFsbGJhY2spID0+IHsKICAgICAgICAgICAgY29uc3QgZ29hbEEgPSBtb2RlbDsKICAgICAgICAgICAgLy8gTW92ZWQgZG93biB+N2Z0ICgyLjJtKSBhcyByZXF1ZXN0ZWQKICAgICAgICAgICAgZ29hbEEucG9zaXRpb24uc2V0KDAsIC0yLjIsIC0zMik7IAogICAgICAgICAgICAKaWYgKCFpc0ZhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICBnb2FsQS5zY2FsZS5zZXRTY2FsYXIoMzYuMCk7IC8vIEluY3JlYXNlZCA1MCUgKHdhcyAyNC4wKQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIFNldHVwIEdvYWwgQQogICAgICAgICAgICBnb2FsQS50cmF2ZXJzZShjID0+IHsKICAgICAgICAgICAgICAgIGlmKGMuaXNNZXNoKSB7CiAgICAgICAgICAgICAgICAgICAgYy5mcnVzdHVtQ3VsbGVkID0gZmFsc2U7IC8vIENSSVRJQ0FMOiBQcmV2ZW50IGN1bGxpbmcKICAgICAgICAgICAgICAgICAgICBjLnJlbmRlck9yZGVyID0gMDsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBFbnN1cmUgbWF0ZXJpYWwgaXMgdmlzaWJsZQogICAgICAgICAgICAgICAgICAgIGlmIChjLm1hdGVyaWFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGMubWF0ZXJpYWwuY29sb3Iuc2V0SGV4KDB4ZmZmZmZmKTsgLy8gV2hpdGUgdG8gc2hvdyBvcmlnaW5hbCB0ZXh0dXJlL2NvbG9ycyAod2FzIGJsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgIGMubWF0ZXJpYWwudHJhbnNwYXJlbnQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgYy5tYXRlcmlhbC5vcGFjaXR5ID0gMS4wOwogICAgICAgICAgICAgICAgICAgICAgICBjLm1hdGVyaWFsLnNpZGUgPSBUSFJFRS5Eb3VibGVTaWRlOwogICAgICAgICAgICAgICAgICAgICAgICBjLm1hdGVyaWFsLmRlcHRoV3JpdGUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBjLm1hdGVyaWFsLmRlcHRoVGVzdCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgX3NjZW5lLmFkZChnb2FsQSk7CgogICAgICAgICAgICAvLyBTZXR1cCBHb2FsIEIKICAgICAgICAgICAgY29uc3QgZ29hbEIgPSBpc0ZhbGxiYWNrID8gZ29hbEEuY2xvbmUoKSA6IFRIUkVFLlNrZWxldG9uVXRpbHMuY2xvbmUoZ29hbEEpOwoKICAgICAgICAgICAgZ29hbEIucG9zaXRpb24uc2V0KDAsIC0yLjIsIDMyKTsgLy8gTW92ZWQgY2xvc2VyICh3YXMgNDUpIGFuZCBkb3duCiAgICAgICAgICAgIGdvYWxCLnJvdGF0aW9uLnkgPSBNYXRoLlBJOwogICAgICAgICAgICAvLyBFbnN1cmUgR29hbCBCIG1lc2hlcyBhcmUgYWxzbyBwZXJzaXN0ZW50CiAgICAgICAgICAgIGdvYWxCLnRyYXZlcnNlKGMgPT4gewogICAgICAgICAgICAgICAgaWYoYy5pc01lc2gpIGMuZnJ1c3R1bUN1bGxlZCA9IGZhbHNlOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIF9zY2VuZS5hZGQoZ29hbEIpOwogICAgICAgIH07CgogICAgICAgIHdpbmRvdy5mbHV4LkFzc2V0TG9hZGVyLmxvYWRNb2RlbChnb2FsVXJsLCAoZ2x0ZikgPT4gewogICAgICAgICAgICBvbkdvYWxMb2FkZWQoZ2x0Zi5zY2VuZSwgZmFsc2UpOwogICAgICAgIH0sIHVuZGVmaW5lZCwgKGVycikgPT4gewpjb25zb2xlLndhcm4oIkdvYWwgbW9kZWwgZmFpbGVkIHRvIGxvYWQuIFVzaW5nIGZhbGxiYWNrLiIsIGVycik7CmNvbnN0IGdlbyA9IG5ldyBUSFJFRS5Cb3hHZW9tZXRyeSg3NSwgNDUsIDEwKTsgLy8gRmFsbGJhY2sgbWFzc2l2ZSBib3ggKFNjYWxlZCAxLjV4KQogICAgICAgICAgICBjb25zdCBmYWxsYmFja01hdCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7IGNvbG9yOiAweGZmZmZmZiwgd2lyZWZyYW1lOiB0cnVlIH0pOwogICAgICAgICAgICBjb25zdCBmYWxsYmFjayA9IG5ldyBUSFJFRS5NZXNoKGdlbywgZmFsbGJhY2tNYXQpOwogICAgICAgICAgICBvbkdvYWxMb2FkZWQoZmFsbGJhY2ssIHRydWUpOwogICAgICAgIH0pOwoKICAgICAgICAvLyAtLS0gTkVXOiBNQVNTSVZFIEZJRUxEIE1BUktJTkdTIC0tLQogICAgICAgIGNyZWF0ZUZpZWxkTWFya2luZ3MoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGVGaWVsZE1hcmtpbmdzKCkgewogICAgICAgIGNvbnN0IHNpemUgPSAxMDI0OwogICAgICAgIGNvbnN0IGMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgICBjLndpZHRoID0gc2l6ZTsgYy5oZWlnaHQgPSBzaXplOwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjb25zdCBjeCA9IHNpemUvMjsgY29uc3QgY3kgPSBzaXplLzI7CgogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgc2l6ZSwgc2l6ZSk7CgogICAgICAgIC8vIEdsb3cgU2V0dGluZ3MKICAgICAgICBjdHguc2hhZG93Qmx1ciA9IDIwOwogICAgICAgIGN0eC5zaGFkb3dDb2xvciA9ICcjMDBmZmZmJzsKICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAncmdiYSgxMDAsIDI1NSwgMjU1LCAwLjkpJzsKICAgICAgICBjdHgubGluZVdpZHRoID0gNTsKICAgICAgICBjdHgubGluZUNhcCA9ICdyb3VuZCc7CgogICAgICAgIC8vIDEuIE1haW4gRmllbGQgQ2lyY2xlIChUaGUgU3BoZXJlIEVxdWF0b3IpCiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgIGN0eC5hcmMoY3gsIGN5LCA0NTAsIDAsIE1hdGguUEkqMik7CiAgICAgICAgY3R4LnN0cm9rZSgpOwoKICAgICAgICAvLyAyLiBJbm5lciBEZWNvcmF0aXZlIFJpbmcKICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgY3R4LmFyYyhjeCwgY3ksIDQyMCwgMCwgTWF0aC5QSSoyKTsKICAgICAgICBjdHgubGluZVdpZHRoID0gMjsKICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAncmdiYSgwLCAyMDAsIDI1NSwgMC41KSc7CiAgICAgICAgY3R4LnN0cm9rZSgpOwoKICAgICAgICAvLyAzLiBDZW50ZXIgQmxpdHpvZmYgWm9uZSAoQ29tcGxleCBTdGFyL1J1bmUpCiAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDQ7CiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC45KSc7CiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgIGN0eC5hcmMoY3gsIGN5LCA4MCwgMCwgTWF0aC5QSSoyKTsKICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgICAgCiAgICAgICAgLy8gSW5uZXIgU3RhciBQYXR0ZXJuCiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgIGZvcihsZXQgaT0wOyBpPDU7IGkrKykgewogICAgICAgICAgICBjb25zdCBhID0gKGkvNSkqTWF0aC5QSSoyIC0gTWF0aC5QSS8yOwogICAgICAgICAgICBjb25zdCB4ID0gY3ggKyBNYXRoLmNvcyhhKSo2MDsKICAgICAgICAgICAgY29uc3QgeSA9IGN5ICsgTWF0aC5zaW4oYSkqNjA7CiAgICAgICAgICAgIGlmKGk9PT0wKSBjdHgubW92ZVRvKHgseSk7IGVsc2UgY3R4LmxpbmVUbyh4LHkpOwogICAgICAgICAgICAvLyBJbm5lciBwb2ludAogICAgICAgICAgICBjb25zdCBhMiA9ICgoaSswLjUpLzUpKk1hdGguUEkqMiAtIE1hdGguUEkvMjsKICAgICAgICAgICAgY29uc3QgeDIgPSBjeCArIE1hdGguY29zKGEyKSoyNTsKICAgICAgICAgICAgY29uc3QgeTIgPSBjeSArIE1hdGguc2luKGEyKSoyNTsKICAgICAgICAgICAgY3R4LmxpbmVUbyh4Mix5Mik7CiAgICAgICAgfQogICAgICAgIGN0eC5jbG9zZVBhdGgoKTsKICAgICAgICBjdHguc3Ryb2tlKCk7CgogICAgICAgIC8vIDQuIE1pZGZpZWxkIExpbmUKICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgY3R4Lm1vdmVUbygwLCBjeSk7IGN0eC5saW5lVG8oc2l6ZSwgY3kpOwogICAgICAgIGN0eC5zdHJva2UoKTsKCiAgICAgICAgLy8gNS4gR29hbCBCb3hlcyAoVHJhcGV6b2lkcykKICAgICAgICBjb25zdCBkcmF3R29hbEJveCA9ICh5UG9zLCBkaXIpID0+IHsKY29uc3QgZHJhd0dvYWxCb3ggPSAoeVBvcywgZGlyKSA9PiB7CiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgY3R4Lm1vdmVUbyhjeCAtIDE1MCwgeVBvcyk7CiAgICAgICAgICAgIGN0eC5saW5lVG8oY3ggKyAxNTAsIHlQb3MpOwogICAgICAgICAgICBjdHgubGluZVRvKGN4ICsgMjI1LCB5UG9zICsgKGRpciAqIDEyMCkpOwogICAgICAgICAgICBjdHgubGluZVRvKGN4IC0gMjI1LCB5UG9zICsgKGRpciAqIDEyMCkpOwogICAgICAgICAgICBjdHguY2xvc2VQYXRoKCk7CiAgICAgICAgICAgIGN0eC5zdHJva2UoKTsKICAgICAgICB9OwogICAgICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgICAgfTsKICAgICAgICBkcmF3R29hbEJveCg1MCwgMSk7IC8vIFRvcCAoSG9tZSBzaWRlIGluIHRleHR1cmUgc3BhY2UpCiAgICAgICAgZHJhd0dvYWxCb3goc2l6ZS01MCwgLTEpOyAvLyBCb3R0b20KCiAgICAgICAgLy8gNi4gUnVuZXMgKFByb2NlZHVyYWwgVGV4dCBSaW5nKQogICAgICAgIGN0eC5mb250ID0gJ2JvbGQgMzJweCBtb25vc3BhY2UnOwogICAgICAgIGN0eC5maWxsU3R5bGUgPSAncmdiYSgwLCAyNTUsIDI1NSwgMC43KSc7CiAgICAgICAgY3R4LnRleHRBbGlnbiA9ICdjZW50ZXInOwogICAgICAgIGN0eC50ZXh0QmFzZWxpbmUgPSAnbWlkZGxlJzsKICAgICAgICAKICAgICAgICBjb25zdCBydW5lcyA9ICJCTElUWkJBTEwgU1BIRVJFIFBPT0wgWkFOQVJLQU5EIEFCWVNTIEVURVJOQUwgQ0FMTSAiOwogICAgICAgIGNvbnN0IHJ1bmVDb3VudCA9IDMyOwogICAgICAgIGZvcihsZXQgaT0wOyBpPHJ1bmVDb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IGFuZ2xlID0gKGkgLyBydW5lQ291bnQpICogTWF0aC5QSSAqIDI7CiAgICAgICAgICAgIGNvbnN0IHIgPSA0ODA7CiAgICAgICAgICAgIGNvbnN0IHggPSBjeCArIE1hdGguY29zKGFuZ2xlKSAqIHI7CiAgICAgICAgICAgIGNvbnN0IHkgPSBjeSArIE1hdGguc2luKGFuZ2xlKSAqIHI7CiAgICAgICAgICAgIAogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICBjdHgudHJhbnNsYXRlKHgsIHkpOwogICAgICAgICAgICBjdHgucm90YXRlKGFuZ2xlICsgTWF0aC5QSS8yKTsKICAgICAgICAgICAgLy8gVXNlIGEgY2hhciBmcm9tIHRoZSBzdHJpbmcgb3IgcmFuZG9tIHJ1bmUtbGlrZSBjaGFyCiAgICAgICAgICAgIGNvbnN0IGNoYXIgPSBydW5lc1tpICUgcnVuZXMubGVuZ3RoXTsKICAgICAgICAgICAgY3R4LmZpbGxUZXh0KGNoYXIsIDAsIDApOwogICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgdGV4ID0gbmV3IFRIUkVFLkNhbnZhc1RleHR1cmUoYyk7CiAgICAgICAgdGV4LmFuaXNvdHJvcHkgPSAxNjsKCiAgICAgICAgLy8gRmxvb3IgUGxhbmUgKERlZXApCiAgICAgICAgY29uc3QgZ2VvID0gbmV3IFRIUkVFLlBsYW5lR2VvbWV0cnkoNjQsIDY0KTsKICAgICAgICBjb25zdCBtYXQgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoewogICAgICAgICAgICBtYXA6IHRleCwKICAgICAgICAgICAgdHJhbnNwYXJlbnQ6IHRydWUsCiAgICAgICAgICAgIG9wYWNpdHk6IDAuOCwKICAgICAgICAgICAgc2lkZTogVEhSRUUuRG91YmxlU2lkZSwKICAgICAgICAgICAgZGVwdGhXcml0ZTogZmFsc2UsCiAgICAgICAgICAgIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nCiAgICAgICAgfSk7CgogICAgICAgIGNvbnN0IGZpZWxkID0gbmV3IFRIUkVFLk1lc2goZ2VvLCBtYXQpOwogICAgICAgIGZpZWxkLnJvdGF0aW9uLnggPSAtTWF0aC5QSSAvIDI7CiAgICAgICAgZmllbGQucG9zaXRpb24ueSA9IC04LjA7IC8vIFN1bmsgZGVlcCBpbnRvIHRoZSBzcGhlcmUKICAgICAgICBfc2NlbmUuYWRkKGZpZWxkKTsKCiAgICAgICAgLy8gRmxvYXRpbmcgSG9sb2dyYXBoaWMgUmluZ3MgKE1pZC1oZWlnaHQpCiAgICAgICAgY29uc3QgcmluZ0dlbyA9IG5ldyBUSFJFRS5Ub3J1c0dlb21ldHJ5KDIwLCAwLjEsIDE2LCAxMDApOwogICAgICAgIGNvbnN0IHJpbmdNYXQgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyBjb2xvcjogMHgwMGZmZmYsIHRyYW5zcGFyZW50OiB0cnVlLCBvcGFjaXR5OiAwLjMsIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nIH0pOwogICAgICAgIGNvbnN0IHJpbmcxID0gbmV3IFRIUkVFLk1lc2gocmluZ0dlbywgcmluZ01hdCk7CiAgICAgICAgcmluZzEucm90YXRpb24ueCA9IE1hdGguUEkgLyAyOwogICAgICAgIHJpbmcxLnBvc2l0aW9uLnkgPSAwOwogICAgICAgIF9zY2VuZS5hZGQocmluZzEpOwogICAgICAgIAogICAgICAgIGNvbnN0IHJpbmcyID0gbmV3IFRIUkVFLk1lc2gocmluZ0dlbywgcmluZ01hdCk7CiAgICAgICAgcmluZzIucm90YXRpb24ueCA9IE1hdGguUEkgLyAyOwogICAgICAgIHJpbmcyLnNjYWxlLnNldFNjYWxhcigxLjIpOwogICAgICAgIHJpbmcyLnBvc2l0aW9uLnkgPSA0LjA7CiAgICAgICAgX3NjZW5lLmFkZChyaW5nMik7CgogICAgICAgIC8vIEFuaW1hdGUgUmluZ3MKICAgICAgICBjb25zdCBhbmltYXRlID0gKCkgPT4gewogICAgICAgICAgICBpZihyaW5nMSkgewogICAgICAgICAgICAgICAgcmluZzEucm90YXRpb24ueiArPSAwLjAwMTsKICAgICAgICAgICAgICAgIHJpbmcxLnNjYWxlLnNldFNjYWxhcigxLjAgKyBNYXRoLnNpbihEYXRlLm5vdygpKjAuMDAwNSkqMC4wNSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYocmluZzIpIHsKICAgICAgICAgICAgICAgIHJpbmcyLnJvdGF0aW9uLnogLT0gMC4wMDE1OwogICAgICAgICAgICAgICAgcmluZzIucG9zaXRpb24ueSA9IDQuMCArIE1hdGguY29zKERhdGUubm93KCkqMC4wMDA3KSoxLjA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIH07CiAgICAgICAgYW5pbWF0ZSgpOwogICAgfQoKICAgIC8vIC0tLSBJTlBVVCBTWVNURU0gLS0tCiAgICBjb25zdCBfaW5wdXQgPSB7IHg6IDAsIHk6IDAgfTsKICAgIGNvbnN0IF9haW1JbnB1dCA9IHsgeDogMCwgeTogMCwgYWN0aXZlOiBmYWxzZSB9OyAvLyBORVc6IEFpbSBqb3lzdGljawogICAgY29uc3QgX2tleXMgPSB7IHc6IGZhbHNlLCBhOiBmYWxzZSwgczogZmFsc2UsIGQ6IGZhbHNlLCBBcnJvd1VwOiBmYWxzZSwgQXJyb3dMZWZ0OiBmYWxzZSwgQXJyb3dEb3duOiBmYWxzZSwgQXJyb3dSaWdodDogZmFsc2UgfTsKCiAgICBjb25zdCBfYWN0aW9uQnVmZmVyID0geyBhY3RpdmU6IGZhbHNlLCB0aW1lc3RhbXA6IDAsIGR1cmF0aW9uOiAzMDAgfTsKCiAgICBjb25zdCBfY2FtRndkID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgIGNvbnN0IF9jYW1SaWdodCA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfdXBBeGlzID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMSwgMCk7CgogICAgZnVuY3Rpb24gc2V0dXBJbnB1dHMoKSB7CiAgICAgICAgLy8gS2V5Ym9hcmQKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChlKSA9PiB7CiAgICAgICAgICAgIF9rZXlzW2Uua2V5XSA9IHRydWU7CiAgICAgICAgICAgIGlmIChlLmNvZGUgPT09ICdTcGFjZScgJiYgX2hvbWVUZWFtICYmIF9ob21lVGVhbS5hY3RpdmVQbGF5ZXIgJiYgX2JhbGwpIHsKICAgICAgICAgICAgICAgIF9ob21lVGVhbS5hY3RpdmVQbGF5ZXIudGhyb3dCYWxsKF9iYWxsKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBORVc6IFRhY2tsZSBvbiBTaGlmdAogICAgICAgICAgICBpZiAoZS5jb2RlID09PSAnU2hpZnRMZWZ0JyB8fCBlLmNvZGUgPT09ICdTaGlmdFJpZ2h0JykgewogICAgICAgICAgICAgICAgaWYgKF9ob21lVGVhbSAmJiBfaG9tZVRlYW0uYWN0aXZlUGxheWVyKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IF9ob21lVGVhbS5hY3RpdmVQbGF5ZXI7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFwLmhhc0JhbGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcC5kYXNoKHAuaW5wdXRWZWN0b3IueCwgcC5pbnB1dFZlY3Rvci56KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdXBkYXRlSW5wdXRWZWN0b3IoKTsKICAgICAgICB9KTsKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCAoZSkgPT4geyBfa2V5c1tlLmtleV0gPSBmYWxzZTsgdXBkYXRlSW5wdXRWZWN0b3IoKTsgfSk7CgogICAgICAgIC8vIC0tLSBGTE9BVElORyBKT1lTVElDSyAoTW92ZW1lbnQpIC0tLQogICAgICAgIGNvbnN0IGhpdFpvbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnam95c3RpY2staGl0LXpvbmUnKTsKICAgICAgICBjb25zdCB2aXN1YWxzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pveXN0aWNrLXZpc3VhbC1jb250YWluZXInKTsKICAgICAgICBjb25zdCBiYXNlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pveXN0aWNrLWJhc2UnKTsKICAgICAgICBjb25zdCBrbm9iID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pveXN0aWNrLWtub2InKTsKCiAgICAgICAgbGV0IHN0YXJ0WCA9IDAsIHN0YXJ0WSA9IDA7CiAgICAgICAgbGV0IGRyYWdnaW5nID0gZmFsc2U7CiAgICAgICAgY29uc3QgbWF4RGlzdCA9IDQwOwoKICAgICAgICBjb25zdCBoYW5kbGVTdGFydCA9IChjbGllbnRYLCBjbGllbnRZKSA9PiB7CiAgICAgICAgICAgIGRyYWdnaW5nID0gdHJ1ZTsKICAgICAgICAgICAgc3RhcnRYID0gY2xpZW50WDsKICAgICAgICAgICAgc3RhcnRZID0gY2xpZW50WTsKCiAgICAgICAgICAgIHZpc3VhbHMuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgIHZpc3VhbHMuc3R5bGUubGVmdCA9IGAke2NsaWVudFh9cHhgOwogICAgICAgICAgICB2aXN1YWxzLnN0eWxlLnRvcCA9IGAke2NsaWVudFl9cHhgOwoKICAgICAgICAgICAga25vYi5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKC01MCUsIC01MCUpYDsKCiAgICAgICAgICAgIGNyZWF0ZVJpcHBsZShjbGllbnRYLCBjbGllbnRZKTsKCiAgICAgICAgICAgIF9pbnB1dC54ID0gMDsKICAgICAgICAgICAgX2lucHV0LnkgPSAwOwogICAgICAgICAgICB1cGRhdGVJbnB1dFZlY3RvcigpOwogICAgICAgIH07CgogICAgICAgIGNvbnN0IGhhbmRsZU1vdmUgPSAoY2xpZW50WCwgY2xpZW50WSkgPT4gewogICAgICAgICAgICBpZiAoIWRyYWdnaW5nKSByZXR1cm47CgogICAgICAgICAgICBsZXQgZHggPSBjbGllbnRYIC0gc3RhcnRYOwogICAgICAgICAgICBsZXQgZHkgPSBjbGllbnRZIC0gc3RhcnRZOwoKICAgICAgICAgICAgY29uc3QgZGlzdCA9IE1hdGguc3FydChkeCpkeCArIGR5KmR5KTsKCiAgICAgICAgICAgIGlmIChkaXN0ID4gbWF4RGlzdCkgewogICAgICAgICAgICAgICAgZHggPSAoZHggLyBkaXN0KSAqIG1heERpc3Q7CiAgICAgICAgICAgICAgICBkeSA9IChkeSAvIGRpc3QpICogbWF4RGlzdDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAga25vYi5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKGNhbGMoLTUwJSArICR7ZHh9cHgpLCBjYWxjKC01MCUgKyAke2R5fXB4KSlgOwoKICAgICAgICAgICAgX2lucHV0LnggPSAoZHggLyBtYXhEaXN0KSAqIF9zZXR0aW5ncy5qb3lzdGlja1NlbnNpdGl2aXR5OwogICAgICAgICAgICBfaW5wdXQueSA9IChkeSAvIG1heERpc3QpICogX3NldHRpbmdzLmpveXN0aWNrU2Vuc2l0aXZpdHk7CiAgICAgICAgICAgIHVwZGF0ZUlucHV0VmVjdG9yKCk7CiAgICAgICAgfTsKCiAgICAgICAgY29uc3QgaGFuZGxlRW5kID0gKCkgPT4gewogICAgICAgICAgICBpZiAoIWRyYWdnaW5nKSByZXR1cm47CiAgICAgICAgICAgIGRyYWdnaW5nID0gZmFsc2U7CgogICAgICAgICAgICB2aXN1YWxzLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgogICAgICAgICAgICBfaW5wdXQueCA9IDA7CiAgICAgICAgICAgIF9pbnB1dC55ID0gMDsKICAgICAgICAgICAgdXBkYXRlSW5wdXRWZWN0b3IoKTsKICAgICAgICB9OwoKICAgICAgICBpZiAoaGl0Wm9uZSkgewogICAgICAgICAgICBoaXRab25lLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCAoZSkgPT4gewogICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgaGFuZGxlU3RhcnQoZS50b3VjaGVzWzBdLmNsaWVudFgsIGUudG91Y2hlc1swXS5jbGllbnRZKTsKICAgICAgICAgICAgfSwgeyBwYXNzaXZlOiBmYWxzZSB9KTsKCiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCAoZSkgPT4gewogICAgICAgICAgICAgICAgaWYoZHJhZ2dpbmcpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZS5jYW5jZWxhYmxlKSBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgaGFuZGxlTW92ZShlLnRvdWNoZXNbMF0uY2xpZW50WCwgZS50b3VjaGVzWzBdLmNsaWVudFkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB7IHBhc3NpdmU6IGZhbHNlIH0pOwoKICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgaGFuZGxlRW5kKTsKCiAgICAgICAgICAgIGhpdFpvbmUuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgKGUpID0+IHsKICAgICAgICAgICAgICAgIGhhbmRsZVN0YXJ0KGUuY2xpZW50WCwgZS5jbGllbnRZKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCAoZSkgPT4gewogICAgICAgICAgICAgICAgaWYgKGRyYWdnaW5nKSBoYW5kbGVNb3ZlKGUuY2xpZW50WCwgZS5jbGllbnRZKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgaGFuZGxlRW5kKTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLSBORVc6IEFJTSBKT1lTVElDSyAoUmlnaHQgc2lkZSkgLS0tCiAgICAgICAgc2V0dXBBaW1Kb3lzdGljaygpOwoKICAgICAgICAvLyAtLS0gTkVXOiBUQUNLTEUgQlVUVE9OIC0tLQogICAgICAgIHNldHVwVGFja2xlQnV0dG9uKCk7CgogICAgICAgIC8vIFN3aXBlIERldGVjdGlvbgogICAgICAgIGxldCBzd2lwZVN0YXJ0ID0geyB4OiAwLCB5OiAwLCB0OiAwIH07CgogICAgICAgIGNvbnN0IG9uU3dpcGVTdGFydCA9ICh4LCB5KSA9PiB7CiAgICAgICAgICAgIHN3aXBlU3RhcnQueCA9IHg7CiAgICAgICAgICAgIHN3aXBlU3RhcnQueSA9IHk7CiAgICAgICAgICAgIHN3aXBlU3RhcnQudCA9IERhdGUubm93KCk7CiAgICAgICAgfTsKCiAgICAgICAgY29uc3Qgb25Td2lwZUVuZCA9ICh4LCB5KSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGR0ID0gRGF0ZS5ub3coKSAtIHN3aXBlU3RhcnQudDsKICAgICAgICAgICAgY29uc3QgZHggPSB4IC0gc3dpcGVTdGFydC54OwogICAgICAgICAgICBjb25zdCBkeSA9IHkgLSBzd2lwZVN0YXJ0Lnk7CiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLnNxcnQoZHgqZHggKyBkeSpkeSk7CgogICAgICAgICAgICBpZiAoZHQgPCAzMDAgJiYgZGlzdCA+IDMwKSB7CiAgICAgICAgICAgICAgICBpZiAoX2hvbWVUZWFtICYmIF9ob21lVGVhbS5hY3RpdmVQbGF5ZXIgJiYgX2NhbWVyYSkgewogICAgICAgICAgICAgICAgICAgIF9jYW1lcmEuZ2V0V29ybGREaXJlY3Rpb24oX2NhbUZ3ZCk7CiAgICAgICAgICAgICAgICAgICAgX2NhbUZ3ZC55ID0gMDsKICAgICAgICAgICAgICAgICAgICBpZiAoX2NhbUZ3ZC5sZW5ndGhTcSgpIDwgMC4wMDEpIF9jYW1Gd2Quc2V0KDAsIDAsIC0xKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIF9jYW1Gd2Qubm9ybWFsaXplKCk7CgogICAgICAgICAgICAgICAgICAgIF9jYW1SaWdodC5jcm9zc1ZlY3RvcnMoX2NhbUZ3ZCwgX3VwQXhpcykubm9ybWFsaXplKCk7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdvcmxkWCA9IChfY2FtUmlnaHQueCAqIGR4KSArIChfY2FtRndkLnggKiAtZHkpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdvcmxkWiA9IChfY2FtUmlnaHQueiAqIGR4KSArIChfY2FtRndkLnogKiAtZHkpOwoKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gX2hvbWVUZWFtLmFjdGl2ZVBsYXllcjsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHAuaXNUaHJvd2luZykgewogICAgICAgICAgICAgICAgICAgICAgICBwLnNldE92ZXJyaWRlQWltKHdvcmxkWCwgd29ybGRaKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIkFJTSEiLCBwLm1lc2gucG9zaXRpb24sICJkZWZhdWx0Iik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBwLmRhc2god29ybGRYLCB3b3JsZFopOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlUmlwcGxlKHgsIHkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgLy8gVG91Y2ggU3dpcGUgKGV4Y2x1ZGluZyBjb250cm9scykKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIChlKSA9PiB7CiAgICAgICAgICAgIGlmIChlLnRhcmdldC5jbG9zZXN0KCcjam95c3RpY2staGl0LXpvbmUnKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI2FjdGlvbi1idXR0b24nKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI3RhY2tsZS1idXR0b24nKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI2FpbS1qb3lzdGljay16b25lJykgfHwKICAgICAgICAgICAgICAgIGUudGFyZ2V0LmNsb3Nlc3QoJyNhdXRvLXRvZ2dsZScpIHx8CiAgICAgICAgICAgICAgICBlLnRhcmdldC5jbG9zZXN0KCcjc2V0dGluZ3MtYnV0dG9uJykpIHJldHVybjsKICAgICAgICAgICAgb25Td2lwZVN0YXJ0KGUudG91Y2hlc1swXS5jbGllbnRYLCBlLnRvdWNoZXNbMF0uY2xpZW50WSk7CiAgICAgICAgICAgIGNyZWF0ZVJpcHBsZShlLnRvdWNoZXNbMF0uY2xpZW50WCwgZS50b3VjaGVzWzBdLmNsaWVudFkpOwogICAgICAgIH0sIHsgcGFzc2l2ZTogZmFsc2UgfSk7CgogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIChlKSA9PiB7CiAgICAgICAgICAgIGlmIChlLnRhcmdldC5jbG9zZXN0KCcjam95c3RpY2staGl0LXpvbmUnKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI2FjdGlvbi1idXR0b24nKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI3RhY2tsZS1idXR0b24nKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI2FpbS1qb3lzdGljay16b25lJykgfHwKICAgICAgICAgICAgICAgIGUudGFyZ2V0LmNsb3Nlc3QoJyNhdXRvLXRvZ2dsZScpIHx8CiAgICAgICAgICAgICAgICBlLnRhcmdldC5jbG9zZXN0KCcjc2V0dGluZ3MtYnV0dG9uJykpIHJldHVybjsKICAgICAgICAgICAgb25Td2lwZUVuZChlLmNoYW5nZWRUb3VjaGVzWzBdLmNsaWVudFgsIGUuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vIE1vdXNlIFN3aXBlCiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIChlKSA9PiB7CiAgICAgICAgICAgIGlmIChlLnRhcmdldC5jbG9zZXN0KCcjam95c3RpY2staGl0LXpvbmUnKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI2FjdGlvbi1idXR0b24nKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI3RhY2tsZS1idXR0b24nKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI2FpbS1qb3lzdGljay16b25lJykgfHwKICAgICAgICAgICAgICAgIGUudGFyZ2V0LmNsb3Nlc3QoJyNhdXRvLXRvZ2dsZScpIHx8CiAgICAgICAgICAgICAgICBlLnRhcmdldC5jbG9zZXN0KCcjc2V0dGluZ3MtYnV0dG9uJykpIHJldHVybjsKICAgICAgICAgICAgb25Td2lwZVN0YXJ0KGUuY2xpZW50WCwgZS5jbGllbnRZKTsKICAgICAgICAgICAgY3JlYXRlUmlwcGxlKGUuY2xpZW50WCwgZS5jbGllbnRZKTsKICAgICAgICB9KTsKCiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCAoZSkgPT4gewogICAgICAgICAgICBpZiAoZS50YXJnZXQuY2xvc2VzdCgnI2pveXN0aWNrLWhpdC16b25lJykgfHwKICAgICAgICAgICAgICAgIGUudGFyZ2V0LmNsb3Nlc3QoJyNhY3Rpb24tYnV0dG9uJykgfHwKICAgICAgICAgICAgICAgIGUudGFyZ2V0LmNsb3Nlc3QoJyN0YWNrbGUtYnV0dG9uJykgfHwKICAgICAgICAgICAgICAgIGUudGFyZ2V0LmNsb3Nlc3QoJyNhaW0tam95c3RpY2stem9uZScpIHx8CiAgICAgICAgICAgICAgICBlLnRhcmdldC5jbG9zZXN0KCcjYXV0by10b2dnbGUnKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI3NldHRpbmdzLWJ1dHRvbicpKSByZXR1cm47CiAgICAgICAgICAgIG9uU3dpcGVFbmQoZS5jbGllbnRYLCBlLmNsaWVudFkpOwogICAgICAgIH0pOwoKICAgICAgICAvLyBBY3Rpb24gQnV0dG9uIChTaG9vdC9QYXNzKQogICAgICAgIGNvbnN0IGFjdGlvbkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY3Rpb24tYnV0dG9uJyk7CgogICAgICAgIGNvbnN0IHNldHVwQnV0dG9uID0gKGJ0bikgPT4gewogICAgICAgICAgICBpZiAoIWJ0bikgcmV0dXJuOwoKICAgICAgICAgICAgbGV0IGJ0blN0YXJ0WCA9IDA7CiAgICAgICAgICAgIGxldCBidG5TdGFydFkgPSAwOwogICAgICAgICAgICBsZXQgaXNEcmFnZ2luZyA9IGZhbHNlOwoKICAgICAgICAgICAgY29uc3QgYXR0ZW1wdEFjdGlvbiA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGlmICghX2hvbWVUZWFtIHx8ICFfaG9tZVRlYW0uYWN0aXZlUGxheWVyKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBjb25zdCBwID0gX2hvbWVUZWFtLmFjdGl2ZVBsYXllcjsKCiAgICAgICAgICAgICAgICBpZiAocC5oYXNCYWxsICYmICFwLmlzQ2hhcmdpbmcgJiYgIXAuaXNUaHJvd2luZyAmJiBwLnN0YXR1cy5uYXAgPD0gMCkgewogICAgICAgICAgICAgICAgICAgIHAuc3RhcnRDaGFyZ2UoKTsKICAgICAgICAgICAgICAgICAgICBidG4uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBjb25zdCBoYW5kbGVTdGFydCA9IChlKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoZS5jYW5jZWxhYmxlKSBlLnByZXZlbnREZWZhdWx0KCk7CgogICAgICAgICAgICAgICAgaWYgKF9nYW1lTWFuYWdlciAmJiBfZ2FtZU1hbmFnZXIudGVjaENvcHlTdGF0ZS5hY3RpdmUpIHsKICAgICAgICAgICAgICAgICAgICBfZ2FtZU1hbmFnZXIuYXR0ZW1wdFRlY2hDb3B5KCk7CiAgICAgICAgICAgICAgICAgICAgYnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gYnRuLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpLCAxMDApOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoX2dhbWVNYW5hZ2VyICYmIF9nYW1lTWFuYWdlci5pc0RlbW9Nb2RlKSByZXR1cm47CgogICAgICAgICAgICAgICAgY29uc3QgY2xpZW50WCA9IGUudG91Y2hlcyA/IGUudG91Y2hlc1swXS5jbGllbnRYIDogZS5jbGllbnRYOwogICAgICAgICAgICAgICAgY29uc3QgY2xpZW50WSA9IGUudG91Y2hlcyA/IGUudG91Y2hlc1swXS5jbGllbnRZIDogZS5jbGllbnRZOwogICAgICAgICAgICAgICAgYnRuU3RhcnRYID0gY2xpZW50WDsKICAgICAgICAgICAgICAgIGJ0blN0YXJ0WSA9IGNsaWVudFk7CiAgICAgICAgICAgICAgICBpc0RyYWdnaW5nID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICBfYWN0aW9uQnVmZmVyLmFjdGl2ZSA9IHRydWU7CiAgICAgICAgICAgICAgICBfYWN0aW9uQnVmZmVyLnRpbWVzdGFtcCA9IERhdGUubm93KCk7CgogICAgICAgICAgICAgICAgaWYgKGF0dGVtcHRBY3Rpb24oKSkgewogICAgICAgICAgICAgICAgICAgIF9hY3Rpb25CdWZmZXIuYWN0aXZlID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBjb25zdCBoYW5kbGVFbmQgPSAoZSkgPT4gewogICAgICAgICAgICAgICAgaWYgKGUuY2FuY2VsYWJsZSkgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgX2FjdGlvbkJ1ZmZlci5hY3RpdmUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGlzRHJhZ2dpbmcgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICBsZXQgZHggPSAwLCBkeSA9IDA7CgogICAgICAgICAgICAgICAgY29uc3QgY2xpZW50WCA9IGUuY2hhbmdlZFRvdWNoZXMgPyBlLmNoYW5nZWRUb3VjaGVzWzBdLmNsaWVudFggOiBlLmNsaWVudFg7CiAgICAgICAgICAgICAgICBjb25zdCBjbGllbnRZID0gZS5jaGFuZ2VkVG91Y2hlcyA/IGUuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WSA6IGUuY2xpZW50WTsKCiAgICAgICAgICAgICAgICBkeCA9IGNsaWVudFggLSBidG5TdGFydFg7CiAgICAgICAgICAgICAgICBkeSA9IGNsaWVudFkgLSBidG5TdGFydFk7CgogICAgICAgICAgICAgICAgaWYgKF9ob21lVGVhbSAmJiBfaG9tZVRlYW0uYWN0aXZlUGxheWVyKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IF9ob21lVGVhbS5hY3RpdmVQbGF5ZXI7CiAgICAgICAgICAgICAgICAgICAgaWYgKHAuaXNDaGFyZ2luZykgewogICAgICAgICAgICAgICAgICAgICAgICBwLnJlbGVhc2VDaGFyZ2UoZHgsIGR5KTsKICAgICAgICAgICAgICAgICAgICAgICAgYnRuLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgaGFuZGxlU3RhcnQsIHsgcGFzc2l2ZTogZmFsc2UgfSk7CiAgICAgICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBoYW5kbGVTdGFydCk7CiAgICAgICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIGhhbmRsZUVuZCk7CiAgICAgICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgaGFuZGxlRW5kKTsKICAgICAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbGVhdmUnLCBoYW5kbGVFbmQpOwogICAgICAgIH07CgogICAgICAgIHNldHVwQnV0dG9uKGFjdGlvbkJ0bik7CgogICAgICAgIC8vIEF1dG8gVG9nZ2xlCiAgICAgICAgY29uc3QgYXV0b0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhdXRvLXRvZ2dsZScpOwogICAgICAgIGlmIChhdXRvQnRuKSB7CiAgICAgICAgICAgIGNvbnN0IGhhbmRsZVRvZ2dsZSA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGlmIChfZ2FtZU1hbmFnZXIpIHsKICAgICAgICAgICAgICAgICAgICBfZ2FtZU1hbmFnZXIudG9nZ2xlRGVtb01vZGUoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoX2hvbWVUZWFtICYmIF9ob21lVGVhbS5hY3RpdmVQbGF5ZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2hvbWVUZWFtLmFjdGl2ZVBsYXllci5zZXRJbnB1dCgwLCAwKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBhdXRvQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlVG9nZ2xlKTsKICAgICAgICAgICAgYXV0b0J0bi5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgKGUpID0+IHsKICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIGhhbmRsZVRvZ2dsZSgpOwogICAgICAgICAgICB9LCB7IHBhc3NpdmU6IGZhbHNlIH0pOwogICAgICAgIH0KCiAgICAgICAgLy8gTkVXOiBTZXR0aW5ncyBCdXR0b24KICAgICAgICBzZXR1cFNldHRpbmdzQnV0dG9uKCk7CiAgICB9CgogICAgLy8gTkVXOiBBaW0gSm95c3RpY2sgU2V0dXAKICAgIGZ1bmN0aW9uIHNldHVwQWltSm95c3RpY2soKSB7CiAgICAgICAgY29uc3QgYWltWm9uZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhaW0tam95c3RpY2stem9uZScpOwogICAgICAgIGNvbnN0IGFpbVZpc3VhbHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWltLWpveXN0aWNrLXZpc3VhbCcpOwogICAgICAgIGNvbnN0IGFpbUtub2IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWltLWpveXN0aWNrLWtub2InKTsKCiAgICAgICAgaWYgKCFhaW1ab25lKSByZXR1cm47CgogICAgICAgIGxldCBhaW1TdGFydFggPSAwLCBhaW1TdGFydFkgPSAwOwogICAgICAgIGxldCBhaW1EcmFnZ2luZyA9IGZhbHNlOwogICAgICAgIGNvbnN0IGFpbU1heERpc3QgPSAzNTsKCiAgICAgICAgY29uc3QgaGFuZGxlQWltU3RhcnQgPSAoY2xpZW50WCwgY2xpZW50WSkgPT4gewogICAgICAgICAgICBhaW1EcmFnZ2luZyA9IHRydWU7CiAgICAgICAgICAgIGFpbVN0YXJ0WCA9IGNsaWVudFg7CiAgICAgICAgICAgIGFpbVN0YXJ0WSA9IGNsaWVudFk7CiAgICAgICAgICAgIF9haW1JbnB1dC5hY3RpdmUgPSB0cnVlOwoKICAgICAgICAgICAgaWYgKGFpbVZpc3VhbHMpIHsKICAgICAgICAgICAgICAgIGFpbVZpc3VhbHMuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgICAgICBhaW1WaXN1YWxzLnN0eWxlLmxlZnQgPSBgJHtjbGllbnRYfXB4YDsKICAgICAgICAgICAgICAgIGFpbVZpc3VhbHMuc3R5bGUudG9wID0gYCR7Y2xpZW50WX1weGA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGFpbUtub2IpIHsKICAgICAgICAgICAgICAgIGFpbUtub2Iuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSgtNTAlLCAtNTAlKWA7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBjb25zdCBoYW5kbGVBaW1Nb3ZlID0gKGNsaWVudFgsIGNsaWVudFkpID0+IHsKICAgICAgICAgICAgaWYgKCFhaW1EcmFnZ2luZykgcmV0dXJuOwoKICAgICAgICAgICAgbGV0IGR4ID0gY2xpZW50WCAtIGFpbVN0YXJ0WDsKICAgICAgICAgICAgbGV0IGR5ID0gY2xpZW50WSAtIGFpbVN0YXJ0WTsKCiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLnNxcnQoZHgqZHggKyBkeSpkeSk7CgogICAgICAgICAgICBpZiAoZGlzdCA+IGFpbU1heERpc3QpIHsKICAgICAgICAgICAgICAgIGR4ID0gKGR4IC8gZGlzdCkgKiBhaW1NYXhEaXN0OwogICAgICAgICAgICAgICAgZHkgPSAoZHkgLyBkaXN0KSAqIGFpbU1heERpc3Q7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChhaW1Lbm9iKSB7CiAgICAgICAgICAgICAgICBhaW1Lbm9iLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoY2FsYygtNTAlICsgJHtkeH1weCksIGNhbGMoLTUwJSArICR7ZHl9cHgpKWA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIE5vcm1hbGl6ZSBhbmQgdHJhbnNmb3JtIHRvIHdvcmxkIHNwYWNlCiAgICAgICAgICAgIF9haW1JbnB1dC54ID0gZHggLyBhaW1NYXhEaXN0OwogICAgICAgICAgICBfYWltSW5wdXQueSA9IGR5IC8gYWltTWF4RGlzdDsKCiAgICAgICAgICAgIC8vIEFwcGx5IGFpbSB0byBwbGF5ZXIgaWYgY2hhcmdpbmcKICAgICAgICAgICAgaWYgKF9ob21lVGVhbSAmJiBfaG9tZVRlYW0uYWN0aXZlUGxheWVyKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwID0gX2hvbWVUZWFtLmFjdGl2ZVBsYXllcjsKICAgICAgICAgICAgICAgIGlmIChwLmlzQ2hhcmdpbmcgfHwgcC5pc1Rocm93aW5nKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gVHJhbnNmb3JtIHNjcmVlbiBhaW0gdG8gd29ybGQgc3BhY2UKICAgICAgICAgICAgICAgICAgICBfY2FtZXJhLmdldFdvcmxkRGlyZWN0aW9uKF9jYW1Gd2QpOwogICAgICAgICAgICAgICAgICAgIF9jYW1Gd2QueSA9IDA7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9jYW1Gd2QubGVuZ3RoU3EoKSA8IDAuMDAxKSBfY2FtRndkLnNldCgwLCAwLCAtMSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBfY2FtRndkLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgICAgIF9jYW1SaWdodC5jcm9zc1ZlY3RvcnMoX2NhbUZ3ZCwgX3VwQXhpcykubm9ybWFsaXplKCk7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdvcmxkWCA9IChfY2FtUmlnaHQueCAqIF9haW1JbnB1dC54KSArIChfY2FtRndkLnggKiAtX2FpbUlucHV0LnkpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdvcmxkWiA9IChfY2FtUmlnaHQueiAqIF9haW1JbnB1dC54KSArIChfY2FtRndkLnogKiAtX2FpbUlucHV0LnkpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnMod29ybGRYKSA+IDAuMSB8fCBNYXRoLmFicyh3b3JsZFopID4gMC4xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHAuc2V0T3ZlcnJpZGVBaW0od29ybGRYLCB3b3JsZFopOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIGNvbnN0IGhhbmRsZUFpbUVuZCA9ICgpID0+IHsKICAgICAgICAgICAgaWYgKCFhaW1EcmFnZ2luZykgcmV0dXJuOwogICAgICAgICAgICBhaW1EcmFnZ2luZyA9IGZhbHNlOwogICAgICAgICAgICBfYWltSW5wdXQuYWN0aXZlID0gZmFsc2U7CiAgICAgICAgICAgIF9haW1JbnB1dC54ID0gMDsKICAgICAgICAgICAgX2FpbUlucHV0LnkgPSAwOwoKICAgICAgICAgICAgaWYgKGFpbVZpc3VhbHMpIHsKICAgICAgICAgICAgICAgIGFpbVZpc3VhbHMuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIGFpbVpvbmUuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIChlKSA9PiB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgaGFuZGxlQWltU3RhcnQoZS50b3VjaGVzWzBdLmNsaWVudFgsIGUudG91Y2hlc1swXS5jbGllbnRZKTsKICAgICAgICB9LCB7IHBhc3NpdmU6IGZhbHNlIH0pOwoKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgKGUpID0+IHsKICAgICAgICAgICAgaWYgKGFpbURyYWdnaW5nKSB7CiAgICAgICAgICAgICAgICBpZiAoZS5jYW5jZWxhYmxlKSBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICBoYW5kbGVBaW1Nb3ZlKGUudG91Y2hlc1swXS5jbGllbnRYLCBlLnRvdWNoZXNbMF0uY2xpZW50WSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7IHBhc3NpdmU6IGZhbHNlIH0pOwoKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCAoZSkgPT4gewogICAgICAgICAgICBpZiAoYWltRHJhZ2dpbmcpIHsKICAgICAgICAgICAgICAgIGhhbmRsZUFpbUVuZCgpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIC8vIE1vdXNlIHN1cHBvcnQgZm9yIGRlc2t0b3AgdGVzdGluZwogICAgICAgIGFpbVpvbmUuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgKGUpID0+IHsKICAgICAgICAgICAgaGFuZGxlQWltU3RhcnQoZS5jbGllbnRYLCBlLmNsaWVudFkpOwogICAgICAgIH0pOwogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCAoZSkgPT4gewogICAgICAgICAgICBpZiAoYWltRHJhZ2dpbmcpIGhhbmRsZUFpbU1vdmUoZS5jbGllbnRYLCBlLmNsaWVudFkpOwogICAgICAgIH0pOwogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgKGUpID0+IHsKICAgICAgICAgICAgaWYgKGFpbURyYWdnaW5nKSBoYW5kbGVBaW1FbmQoKTsKICAgICAgICB9KTsKICAgIH0KCiAgICAvLyBORVc6IFRhY2tsZSBCdXR0b24gU2V0dXAKICAgIGZ1bmN0aW9uIHNldHVwVGFja2xlQnV0dG9uKCkgewogICAgICAgIGNvbnN0IHRhY2tsZUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YWNrbGUtYnV0dG9uJyk7CiAgICAgICAgaWYgKCF0YWNrbGVCdG4pIHJldHVybjsKCiAgICAgICAgY29uc3QgaGFuZGxlVGFja2xlID0gKGUpID0+IHsKICAgICAgICAgICAgaWYgKGUuY2FuY2VsYWJsZSkgZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgaWYgKF9nYW1lTWFuYWdlciAmJiBfZ2FtZU1hbmFnZXIuaXNEZW1vTW9kZSkgcmV0dXJuOwoKICAgICAgICAgICAgaWYgKF9ob21lVGVhbSAmJiBfaG9tZVRlYW0uYWN0aXZlUGxheWVyKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwID0gX2hvbWVUZWFtLmFjdGl2ZVBsYXllcjsKCiAgICAgICAgICAgICAgICAvLyBJZiB3ZSBkb24ndCBoYXZlIHRoZSBiYWxsLCBkYXNoL3RhY2tsZQogICAgICAgICAgICAgICAgaWYgKCFwLmhhc0JhbGwpIHsKICAgICAgICAgICAgICAgICAgICAvLyBHZXQgY3VycmVudCBtb3ZlbWVudCBkaXJlY3Rpb24gb3IgZm9yd2FyZAogICAgICAgICAgICAgICAgICAgIGxldCBkYXNoWCA9IHAuaW5wdXRWZWN0b3IueDsKICAgICAgICAgICAgICAgICAgICBsZXQgZGFzaFogPSBwLmlucHV0VmVjdG9yLno7CgogICAgICAgICAgICAgICAgICAgIC8vIElmIG5vdCBtb3ZpbmcsIGRhc2ggZm9yd2FyZAogICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyhkYXNoWCkgPCAwLjEgJiYgTWF0aC5hYnMoZGFzaFopIDwgMC4xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZ3ZCA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIDEpLmFwcGx5UXVhdGVybmlvbihwLm1lc2gucXVhdGVybmlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhc2hYID0gZndkLng7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhc2haID0gZndkLno7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBwLmRhc2goZGFzaFgsIGRhc2haKTsKCiAgICAgICAgICAgICAgICAgICAgdGFja2xlQnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGFja2xlQnRuLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpLCAyMDApOwoKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJUQUNLTEUhIiwgcC5tZXNoLnBvc2l0aW9uLCAidGVjaCIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocC5pc0VuZ2FnZWQpIHsKICAgICAgICAgICAgICAgICAgICAvLyBCcmVhayB0YWNrbGUgaWYgZW5nYWdlZAogICAgICAgICAgICAgICAgICAgIHAuZGFzaChwLmlucHV0VmVjdG9yLngsIHAuaW5wdXRWZWN0b3Iueik7CiAgICAgICAgICAgICAgICAgICAgdGFja2xlQnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGFja2xlQnRuLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpLCAyMDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgdGFja2xlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBoYW5kbGVUYWNrbGUsIHsgcGFzc2l2ZTogZmFsc2UgfSk7CiAgICAgICAgdGFja2xlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGhhbmRsZVRhY2tsZSk7CiAgICB9CgogICAgLy8gTkVXOiBTZXR0aW5ncyBCdXR0b24gU2V0dXAKLy8gTkVXOiBTZXR0aW5ncyBCdXR0b24gU2V0dXAKICAgIGZ1bmN0aW9uIHNldHVwU2V0dGluZ3NCdXR0b24oKSB7CiAgICAgICAgY29uc3Qgc2V0dGluZ3NCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2V0dGluZ3MtYnV0dG9uJyk7CiAgICAgICAgY29uc3Qgc2V0dGluZ3NQYW5lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZXR0aW5ncy1wYW5lbCcpOwogICAgICAgIGNvbnN0IHNldHRpbmdzQ2xvc2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2V0dGluZ3MtY2xvc2UnKTsKCiAgICAgICAgaWYgKCFzZXR0aW5nc0J0biB8fCAhc2V0dGluZ3NQYW5lbCkgcmV0dXJuOwoKICAgICAgICBzZXR0aW5nc0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgc2V0dGluZ3NQYW5lbC5zdHlsZS5kaXNwbGF5ID0gc2V0dGluZ3NQYW5lbC5zdHlsZS5kaXNwbGF5ID09PSAnbm9uZScgPyAnYmxvY2snIDogJ25vbmUnOwogICAgICAgIH0pOwoKICAgICAgICBpZiAoc2V0dGluZ3NDbG9zZSkgewogICAgICAgICAgICBzZXR0aW5nc0Nsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICAgICAgc2V0dGluZ3NQYW5lbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIC8vIFNlbnNpdGl2aXR5IHNsaWRlcgogICAgICAgIGNvbnN0IHNlbnNpdGl2aXR5U2xpZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbnNpdGl2aXR5LXNsaWRlcicpOwogICAgICAgIGlmIChzZW5zaXRpdml0eVNsaWRlcikgewogICAgICAgICAgICBzZW5zaXRpdml0eVNsaWRlci52YWx1ZSA9IF9zZXR0aW5ncy5qb3lzdGlja1NlbnNpdGl2aXR5ICogMTAwOwogICAgICAgICAgICBzZW5zaXRpdml0eVNsaWRlci5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIChlKSA9PiB7CiAgICAgICAgICAgICAgICBfc2V0dGluZ3Muam95c3RpY2tTZW5zaXRpdml0eSA9IGUudGFyZ2V0LnZhbHVlIC8gMTAwOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIC8vIEFpbSBhc3Npc3QgdG9nZ2xlCiAgICAgICAgY29uc3QgYWltQXNzaXN0VG9nZ2xlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FpbS1hc3Npc3QtdG9nZ2xlJyk7CiAgICAgICAgaWYgKGFpbUFzc2lzdFRvZ2dsZSkgewogICAgICAgICAgICBhaW1Bc3Npc3RUb2dnbGUuY2hlY2tlZCA9IF9zZXR0aW5ncy5haW1Bc3Npc3Q7CiAgICAgICAgICAgIGFpbUFzc2lzdFRvZ2dsZS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4gewogICAgICAgICAgICAgICAgX3NldHRpbmdzLmFpbUFzc2lzdCA9IGUudGFyZ2V0LmNoZWNrZWQ7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgLy8gQ2FtZXJhIHNoYWtlIHRvZ2dsZQogICAgICAgIGNvbnN0IHNoYWtlVG9nZ2xlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NoYWtlLXRvZ2dsZScpOwogICAgICAgIGlmIChzaGFrZVRvZ2dsZSkgewogICAgICAgICAgICBzaGFrZVRvZ2dsZS5jaGVja2VkID0gX3NldHRpbmdzLmNhbWVyYVNoYWtlOwogICAgICAgICAgICBzaGFrZVRvZ2dsZS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4gewogICAgICAgICAgICAgICAgX3NldHRpbmdzLmNhbWVyYVNoYWtlID0gZS50YXJnZXQuY2hlY2tlZDsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICAvLyBWb2x1bWUgc2xpZGVyCiAgICAgICAgY29uc3Qgdm9sdW1lU2xpZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZvbHVtZS1zbGlkZXInKTsKICAgICAgICBpZiAodm9sdW1lU2xpZGVyICYmIF9hdWRpb01hbmFnZXIpIHsKICAgICAgICAgICAgdm9sdW1lU2xpZGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKGUpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHZvbCA9IGUudGFyZ2V0LnZhbHVlIC8gMTAwOwogICAgICAgICAgICAgICAgX2F1ZGlvTWFuYWdlci5zZXRWb2x1bWUodm9sKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICAvLyBFeGl0IHRvIE1lbnUKICAgICAgICBjb25zdCBleGl0QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4aXQtdG8tbWVudS1idG4nKTsKICAgICAgICBpZiAoZXhpdEJ0bikgewogICAgICAgICAgICBleGl0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKF9tZW51TWFuYWdlcikgewogICAgICAgICAgICAgICAgICAgIF9tZW51TWFuYWdlci5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9nYW1lTWFuYWdlcikgewogICAgICAgICAgICAgICAgICAgICAgICBfZ2FtZU1hbmFnZXIuc3RhdGUgPSAnbWVudSc7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN0b3AgcHJhY3RpY2UgaWYgcnVubmluZwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoX2dhbWVNYW5hZ2VyLnByYWN0aWNlTWFuYWdlcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2dhbWVNYW5hZ2VyLnByYWN0aWNlTWFuYWdlci5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVzZXQgY2FtZXJhIHRvIG1lbnUgb3JiaXQgaWYgbmVlZGVkCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfZ2FtZU1hbmFnZXIuY2FtZXJhTWFuYWdlcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gT3B0aW9uYWw6IFJlc2V0IGNhbWVyYSBwYXJhbWV0ZXJzCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NQYW5lbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gdXBkYXRlSW5wdXRWZWN0b3IoKSB7CiAgICAgICAgbGV0IHggPSBfaW5wdXQueCB8fCAwOwogICAgICAgIGxldCB6ID0gX2lucHV0LnkgfHwgMDsKCiAgICAgICAgaWYgKF9rZXlzWyd3J10gfHwgX2tleXNbJ0Fycm93VXAnXSkgeiAtPSAxOwogICAgICAgIGlmIChfa2V5c1sncyddIHx8IF9rZXlzWydBcnJvd0Rvd24nXSkgeiArPSAxOwogICAgICAgIGlmIChfa2V5c1snYSddIHx8IF9rZXlzWydBcnJvd0xlZnQnXSkgeCAtPSAxOwogICAgICAgIGlmIChfa2V5c1snZCddIHx8IF9rZXlzWydBcnJvd1JpZ2h0J10pIHggKz0gMTsKCiAgICAgICAgY29uc3QgbGVuU3EgPSB4KnggKyB6Kno7CiAgICAgICAgaWYgKGxlblNxID4gMSkgewogICAgICAgICAgICBjb25zdCBsZW4gPSBNYXRoLnNxcnQobGVuU3EpOwogICAgICAgICAgICB4IC89IGxlbjsKICAgICAgICAgICAgeiAvPSBsZW47CiAgICAgICAgfQoKICAgICAgICBpZiAoaXNOYU4oeCkpIHggPSAwOwogICAgICAgIGlmIChpc05hTih6KSkgeiA9IDA7CgogICAgICAgIGlmIChfY2FtZXJhKSB7CiAgICAgICAgICAgIF9jYW1lcmEuZ2V0V29ybGREaXJlY3Rpb24oX2NhbUZ3ZCk7CiAgICAgICAgICAgIF9jYW1Gd2QueSA9IDA7CgogICAgICAgICAgICBpZiAoX2NhbUZ3ZC5sZW5ndGhTcSgpIDwgMC4wMDEpIHsKICAgICAgICAgICAgICAgIF9jYW1Gd2Quc2V0KDAsIDAsIC0xKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIF9jYW1Gd2Qubm9ybWFsaXplKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9jYW1SaWdodC5jcm9zc1ZlY3RvcnMoX2NhbUZ3ZCwgX3VwQXhpcykubm9ybWFsaXplKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX2NhbUZ3ZC5zZXQoMCwgMCwgLTEpOwogICAgICAgICAgICBfY2FtUmlnaHQuc2V0KDEsIDAsIDApOwogICAgICAgIH0KCiAgICAgICAgbGV0IHdvcmxkWCA9IChfY2FtRndkLnggKiAteikgKyAoX2NhbVJpZ2h0LnggKiB4KTsKICAgICAgICBsZXQgd29ybGRaID0gKF9jYW1Gd2QueiAqIC16KSArIChfY2FtUmlnaHQueiAqIHgpOwoKICAgICAgICBpZiAoaXNOYU4od29ybGRYKSB8fCBpc05hTih3b3JsZFopKSB7CiAgICAgICAgICAgIHdvcmxkWCA9IDA7CiAgICAgICAgICAgIHdvcmxkWiA9IDA7CiAgICAgICAgfQoKICAgICAgICBpZiAoX2hvbWVUZWFtICYmIF9ob21lVGVhbS5hY3RpdmVQbGF5ZXIpIHsKICAgICAgICAgICAgaWYgKF9nYW1lTWFuYWdlciAmJiAhX2dhbWVNYW5hZ2VyLmlzRGVtb01vZGUpIHsKICAgICAgICAgICAgICAgIF9ob21lVGVhbS5hY3RpdmVQbGF5ZXIuc2V0SW5wdXQod29ybGRYLCB3b3JsZFopOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGNyZWF0ZVJpcHBsZSh4LCB5KSB7CiAgICAgICAgY29uc3QgcmlwcGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgcmlwcGxlLmNsYXNzTmFtZSA9ICd0b3VjaC1yaXBwbGUnOwogICAgICAgIHJpcHBsZS5zdHlsZS5sZWZ0ID0gYCR7eH1weGA7CiAgICAgICAgcmlwcGxlLnN0eWxlLnRvcCA9IGAke3l9cHhgOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1aS1sYXllcicpLmFwcGVuZENoaWxkKHJpcHBsZSk7CgogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICBpZiAocmlwcGxlLnBhcmVudE5vZGUpIHJpcHBsZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHJpcHBsZSk7CiAgICAgICAgfSwgNjAwKTsKICAgIH0KCmZ1bmN0aW9uIG9uUmVzaXplKCkgewogICAgICAgIGNvbnN0IHdpZHRoID0gd2luZG93LmlubmVyV2lkdGg7CiAgICAgICAgY29uc3QgaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0OwogICAgICAgIAogICAgICAgIGlmIChfY2FtZXJhKSB7CiAgICAgICAgICAgIF9jYW1lcmEuYXNwZWN0ID0gd2lkdGggLyBoZWlnaHQ7CiAgICAgICAgICAgIF9jYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBTdHJpY3RseSAwLjUwIGFzIHJlcXVlc3RlZAogICAgICAgIGNvbnN0IHJlc1NjYWxlID0gMC41MDsKICAgICAgICAKICAgICAgICBfY29uZmlnLmludGVybmFsV2lkdGggPSBNYXRoLmZsb29yKHdpZHRoICogcmVzU2NhbGUpOwogICAgICAgIF9jb25maWcuaW50ZXJuYWxIZWlnaHQgPSBNYXRoLmZsb29yKGhlaWdodCAqIHJlc1NjYWxlKTsKCiAgICAgICAgaWYgKF9yZW5kZXJlcikgewogICAgICAgICAgICBfcmVuZGVyZXIuc2V0U2l6ZShfY29uZmlnLmludGVybmFsV2lkdGgsIF9jb25maWcuaW50ZXJuYWxIZWlnaHQsIGZhbHNlKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CgogICAgICAgIGNvbnN0IHJhd0R0ID0gX2Nsb2NrLmdldERlbHRhKCk7CmNvbnN0IGR0ID0gcmF3RHQgKiAod2luZG93LmZsdXgudGltZVNjYWxlICE9PSB1bmRlZmluZWQgPyB3aW5kb3cuZmx1eC50aW1lU2NhbGUgOiAwLjgpOyAvLyBEZWZhdWx0IDgwJSBzcGVlZAoKICAgICAgICAvLyBJbXBhY3QgRnJhbWVzCiAgICAgICAgaWYgKF9nYW1lTWFuYWdlciAmJiBfZ2FtZU1hbmFnZXIuaW1wYWN0UGF1c2UgPiAwKSB7CiAgICAgICAgICAgIF9nYW1lTWFuYWdlci5pbXBhY3RQYXVzZSAtPSBkdDsKICAgICAgICAgICAgaWYgKF9yZW5kZXJlciAmJiBfc2NlbmUgJiYgX2NhbWVyYSkgewogICAgICAgICAgICAgICAgX3JlbmRlcmVyLnJlbmRlcihfc2NlbmUsIF9jYW1lcmEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHVwZGF0ZUlucHV0VmVjdG9yKCk7CgogICAgICAgIC8vIEFjdGlvbiBCdWZmZXIgUHJvY2Vzc2luZwogICAgICAgIGlmIChfYWN0aW9uQnVmZmVyLmFjdGl2ZSkgewogICAgICAgICAgICBpZiAoRGF0ZS5ub3coKSAtIF9hY3Rpb25CdWZmZXIudGltZXN0YW1wID4gX2FjdGlvbkJ1ZmZlci5kdXJhdGlvbikgewogICAgICAgICAgICAgICAgX2FjdGlvbkJ1ZmZlci5hY3RpdmUgPSBmYWxzZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChfaG9tZVRlYW0gJiYgX2hvbWVUZWFtLmFjdGl2ZVBsYXllcikgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBfaG9tZVRlYW0uYWN0aXZlUGxheWVyOwoKICAgICAgICAgICAgICAgICAgICBpZiAocC5oYXNCYWxsICYmICFwLmlzQ2hhcmdpbmcgJiYgIXAuaXNUaHJvd2luZyAmJiBwLnN0YXR1cy5uYXAgPD0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBwLnN0YXJ0Q2hhcmdlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY3Rpb24tYnV0dG9uJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChidG4pIGJ0bi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgX2FjdGlvbkJ1ZmZlci5hY3RpdmUgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIE1lbnUgU3RhdGUgSGFuZGxpbmcKICAgICAgICBpZiAoX2dhbWVNYW5hZ2VyICYmIF9nYW1lTWFuYWdlci5zdGF0ZSA9PT0gJ21lbnUnICYmIF9jYW1lcmEpIHsKICAgICAgICAgICAgY29uc3QgdGltZSA9IERhdGUubm93KCkgKiAwLjAwMDU7CiAgICAgICAgICAgIGNvbnN0IHJhZGl1cyA9IDUwOwogICAgICAgICAgICBfY2FtZXJhLnBvc2l0aW9uLnggPSBNYXRoLnNpbih0aW1lKSAqIHJhZGl1czsKICAgICAgICAgICAgX2NhbWVyYS5wb3NpdGlvbi56ID0gTWF0aC5jb3ModGltZSkgKiByYWRpdXM7CiAgICAgICAgICAgIF9jYW1lcmEucG9zaXRpb24ueSA9IDIwOwogICAgICAgICAgICBfY2FtZXJhLmxvb2tBdCgwLCAwLCAwKTsKCiAgICAgICAgICAgIGlmIChfcmVuZGVyZXIgJiYgX3NjZW5lKSB7CiAgICAgICAgICAgICAgICBfcmVuZGVyZXIucmVuZGVyKF9zY2VuZSwgX2NhbWVyYSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKF9nYW1lTWFuYWdlcikgX2dhbWVNYW5hZ2VyLnVwZGF0ZShkdCk7CgogICAgICAgIC8vIFVwZGF0ZSBFbnRpdGllcwogICAgICAgIGlmIChfaG9tZVRlYW0pIHsKICAgICAgICAgICAgX2hvbWVUZWFtLnVwZGF0ZShkdCk7CiAgICAgICAgICAgIF9ob21lVGVhbS5wbGF5ZXJzLmZvckVhY2gocCA9PiBjaGVja0JhbGxHcmFiKHApKTsKICAgICAgICB9CgogICAgICAgIGlmIChfYXdheVRlYW0pIHsKICAgICAgICAgICAgX2F3YXlUZWFtLnVwZGF0ZShkdCk7CiAgICAgICAgICAgIF9hd2F5VGVhbS5wbGF5ZXJzLmZvckVhY2gocCA9PiBjaGVja0JhbGxHcmFiKHApKTsKICAgICAgICB9CgogICAgICAgIGlmIChfYmFsbCkgewogICAgICAgICAgICBfYmFsbC51cGRhdGUoZHQpOwogICAgICAgIH0KCiAgICAgICAgLy8gVXBkYXRlIENhbWVyYQovLyBVcGRhdGUgQ2FtZXJhCiAgICAgICAgdXBkYXRlQ2FtZXJhTG9naWMoZHQpOwovLyBVcGRhdGUgVmlzdWFscwogICAgICAgIGlmIChfd2F0ZXJPdmVybGF5KSBfd2F0ZXJPdmVybGF5LnVwZGF0ZShkdCk7CiAgICAgICAgaWYgKF9saWdodFNoYWZ0cykgX2xpZ2h0U2hhZnRzLnVwZGF0ZShkdCk7CiAgICAgICAgaWYgKF9zdGFkaXVtKSBfc3RhZGl1bS51cGRhdGUoZHQpOwogICAgICAgIGlmIChfZ2x5cGhNYW5hZ2VyKSBfZ2x5cGhNYW5hZ2VyLnVwZGF0ZShkdCk7CgppZiAoX3JlbmRlcmVyICYmIF9zY2VuZSAmJiBfY2FtZXJhKSB7CiAgICAgICAgICAgIF9yZW5kZXJlci5yZW5kZXIoX3NjZW5lLCBfY2FtZXJhKTsKICAgICAgICB9CgogICAgICAgIC8vIFVJIFVwZGF0ZXMKICAgICAgICB1cGRhdGVVSSgpOwogICAgfQoKICAgIGZ1bmN0aW9uIHVwZGF0ZVVJKCkgewogICAgICAgIGlmICghX2hvbWVUZWFtIHx8ICFfaG9tZVRlYW0uYWN0aXZlUGxheWVyKSByZXR1cm47CgogICAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY3Rpb24tYnV0dG9uJyk7CiAgICAgICAgY29uc3QgbGJsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FjdGlvbi1sYWJlbCcpOwogICAgICAgIGNvbnN0IHRhY2tsZUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YWNrbGUtYnV0dG9uJyk7CiAgICAgICAgY29uc3QgcCA9IF9ob21lVGVhbS5hY3RpdmVQbGF5ZXI7CgogICAgICAgIGlmIChidG4gJiYgbGJsKSB7CiAgICAgICAgICAgIGNvbnN0IGJ0blRleHQgPSBidG4ucXVlcnlTZWxlY3RvcignLmJ0bi10ZXh0Jyk7CgogICAgICAgICAgICBpZiAocC5oYXNCYWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoYnRuVGV4dCAmJiBidG5UZXh0LmlubmVyVGV4dCAhPT0gIkFDVElPTiIpIHsKICAgICAgICAgICAgICAgICAgICBidG5UZXh0LmlubmVyVGV4dCA9ICJBQ1RJT04iOwogICAgICAgICAgICAgICAgICAgIGJ0bi5jbGFzc0xpc3QuYWRkKCdzaG9vdC1tb2RlJyk7CiAgICAgICAgICAgICAgICAgICAgbGJsLmlubmVyVGV4dCA9ICJPRkZFTlNFIjsKICAgICAgICAgICAgICAgICAgICBsYmwuY2xhc3NMaXN0LmFkZCgnc2hvb3QtbGFiZWwnKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCBpc0hpZ2hFbmVyZ3kgPSAocC5zdGF0cy5IUCAvIHAuc3RhdHMubWF4SFApID4gMC40OwogICAgICAgICAgICAgICAgaWYgKGlzSGlnaEVuZXJneSkgewogICAgICAgICAgICAgICAgICAgIGlmICghYnRuLmNsYXNzTGlzdC5jb250YWlucygnbGltaXQtcmVhZHknKSkgYnRuLmNsYXNzTGlzdC5hZGQoJ2xpbWl0LXJlYWR5Jyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChidG4uY2xhc3NMaXN0LmNvbnRhaW5zKCdsaW1pdC1yZWFkeScpKSBidG4uY2xhc3NMaXN0LnJlbW92ZSgnbGltaXQtcmVhZHknKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoYnRuVGV4dCAmJiBidG5UZXh0LmlubmVyVGV4dCAhPT0gIlNXSU0iKSB7CiAgICAgICAgICAgICAgICAgICAgYnRuVGV4dC5pbm5lclRleHQgPSAiU1dJTSI7CiAgICAgICAgICAgICAgICAgICAgYnRuLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob290LW1vZGUnKTsKICAgICAgICAgICAgICAgICAgICBidG4uY2xhc3NMaXN0LnJlbW92ZSgnbGltaXQtcmVhZHknKTsKICAgICAgICAgICAgICAgICAgICBsYmwuaW5uZXJUZXh0ID0gIk5PUk1BTCI7CiAgICAgICAgICAgICAgICAgICAgbGJsLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob290LWxhYmVsJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFVwZGF0ZSB0YWNrbGUgYnV0dG9uIHZpc2liaWxpdHkKICAgICAgICBpZiAodGFja2xlQnRuKSB7CiAgICAgICAgICAgIGlmICghcC5oYXNCYWxsIHx8IHAuaXNFbmdhZ2VkKSB7CiAgICAgICAgICAgICAgICB0YWNrbGVCdG4uc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0YWNrbGUgYnV0dG9uIHRleHQgYmFzZWQgb24gY29udGV4dAogICAgICAgICAgICAgICAgY29uc3QgdGFja2xlVGV4dCA9IHRhY2tsZUJ0bi5xdWVyeVNlbGVjdG9yKCcuYnRuLXRleHQnKTsKICAgICAgICAgICAgICAgIGlmICh0YWNrbGVUZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHAuaXNFbmdhZ2VkICYmIHAuaGFzQmFsbCkgewp0YWNrbGVUZXh0LmlubmVyVGV4dCA9ICdCUkVBSyc7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhY2tsZUJ0bi5jbGFzc0xpc3QuYWRkKCd1cmdlbnQnKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0YWNrbGVUZXh0LmlubmVyVGV4dCA9ICdUQUNLTEUnOwogICAgICAgICAgICAgICAgICAgICAgICB0YWNrbGVCdG4uY2xhc3NMaXN0LnJlbW92ZSgndXJnZW50Jyk7CiAgICAgICAgICAgICAgICAgICAgfQp9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0YWNrbGVCdG4uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gVXBkYXRlIGRpc3RhbmNlIHRvIGdvYWwgaW5kaWNhdG9yCiAgICAgICAgY29uc3QgZGlzdEluZGljYXRvciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnb2FsLWRpc3RhbmNlJyk7CiAgICAgICAgaWYgKGRpc3RJbmRpY2F0b3IgJiYgcC5tZXNoKSB7CiAgICAgICAgICAgIGNvbnN0IGdvYWxaID0gKHAudGVhbSAmJiBwLnRlYW0uc2lkZSA9PT0gMSkgPyAtMjggOiAyODsKICAgICAgICAgICAgY29uc3QgZGlzdCA9IE1hdGguYWJzKHAubWVzaC5wb3NpdGlvbi56IC0gZ29hbFopOwogICAgICAgICAgICBkaXN0SW5kaWNhdG9yLmlubmVyVGV4dCA9IGAke01hdGguZmxvb3IoZGlzdCl9bWA7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHVwZGF0ZUNhbWVyYUxvZ2ljKGR0KSB7CiAgICAgICAgaWYgKCFfY2FtZXJhTWFuYWdlciB8fCAhX2JhbGwpIHJldHVybjsKCiAgICAgICAgbGV0IHRhcmdldE1lc2ggPSBfYmFsbC5tZXNoOwogICAgICAgIGxldCB0YXJnZXRWZWwgPSBfYmFsbC52ZWxvY2l0eTsKICAgICAgICBsZXQgdGFyZ2V0SW5wdXQgPSBudWxsOwoKICAgICAgICBpZiAoX2JhbGwuaG9sZGVyICYmIF9iYWxsLmhvbGRlci5tZXNoKSB7CiAgICAgICAgICAgIHRhcmdldE1lc2ggPSBfYmFsbC5ob2xkZXIubWVzaDsKICAgICAgICAgICAgdGFyZ2V0VmVsID0gX2JhbGwuaG9sZGVyLnZlbG9jaXR5OwogICAgICAgICAgICBpZiAoX2JhbGwuaG9sZGVyLmlucHV0VmVjdG9yKSB7CiAgICAgICAgICAgICAgICB0YXJnZXRJbnB1dCA9IF9iYWxsLmhvbGRlci5pbnB1dFZlY3RvcjsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX2NhbWVyYU1hbmFnZXIuc2V0VGFyZ2V0KHRhcmdldE1lc2gsIHRhcmdldFZlbCwgdGFyZ2V0SW5wdXQpOwogICAgICAgIF9jYW1lcmFNYW5hZ2VyLnVwZGF0ZShkdCk7CiAgICB9CgpmdW5jdGlvbiBjaGVja0JhbGxHcmFiKGVudGl0eSkgewogICAgICAgIGlmICghZW50aXR5LmNhbkNhdGNoKSByZXR1cm47CiAgICAgICAgaWYgKF9iYWxsICYmICFfYmFsbC5pc0NhdGNoYWJsZSgpKSByZXR1cm47CiAgICAgICAgaWYgKGVudGl0eS5zdHVuVGltZXIgPiAwIHx8IChlbnRpdHkuc3RhdHVzICYmIGVudGl0eS5zdGF0dXMubmFwID4gMCkpIHJldHVybjsKICAgICAgICBpZiAoX2JhbGwuc3RhdGUgIT09ICdmcmVlJykgcmV0dXJuOwogICAgICAgIGlmICghX2JhbGwubWVzaCB8fCAhZW50aXR5Lm1lc2gpIHJldHVybjsKCiAgICAgICAgY29uc3QgYmFsbFBvcyA9IF9iYWxsLm1lc2gucG9zaXRpb247CiAgICAgICAgY29uc3QgZW50UG9zID0gZW50aXR5Lm1lc2gucG9zaXRpb247CgogICAgICAgIGNvbnN0IGR4ID0gYmFsbFBvcy54IC0gZW50UG9zLng7CiAgICAgICAgY29uc3QgZHogPSBiYWxsUG9zLnogLSBlbnRQb3MuejsKICAgICAgICBjb25zdCBkaXN0WFogPSBNYXRoLnNxcnQoZHgqZHggKyBkeipkeik7CiAgICAgICAgY29uc3QgZGlzdFkgPSBNYXRoLmFicyhiYWxsUG9zLnkgLSBlbnRQb3MueSk7CgogICAgICAgIGNvbnN0IHRvdWNoUmFkaXVzID0gMS4wOyAvLyBSZWR1Y2VkIGZyb20gMS41CiAgICAgICAgLy8gUmVkdWNlZCByYWRpaSB0byBwcmV2ZW50ICJJbnZpc2libGUgV2FsbCIgY2F0Y2ggc25hcHBpbmcKICAgICAgICBsZXQgbWFnbmV0UmFkaXVzID0gMS44OyAvLyBSZWR1Y2VkIGZyb20gMi41CiAgICAgICAgbGV0IGludGVyYWN0aW9uUmFkaXVzID0gMy41OyAvLyBSZWR1Y2VkIGZyb20gNC4wCiAgICAgICAgbGV0IGNhdGNoSGVpZ2h0ID0gMy4wOyAvLyBSZWR1Y2VkIGZyb20gMy41CgogICAgICAgIGlmIChlbnRpdHkuaXNEYXNoaW5nKSB7CiAgICAgICAgICAgIG1hZ25ldFJhZGl1cyA9IDMuMDsKICAgICAgICAgICAgaW50ZXJhY3Rpb25SYWRpdXMgPSA0LjU7CiAgICAgICAgICAgIGNhdGNoSGVpZ2h0ID0gNC41OwogICAgICAgIH0KCiAgICAgICAgaWYgKGRpc3RYWiA+IGludGVyYWN0aW9uUmFkaXVzIHx8IGRpc3RZID4gY2F0Y2hIZWlnaHQpIHJldHVybjsKCiAgICAgICAgY29uc3QgdG9CYWxsID0gYmFsbFBvcy5jbG9uZSgpLnN1YihlbnRQb3MpLm5vcm1hbGl6ZSgpOwogICAgICAgIGNvbnN0IHBsYXllckZvcndhcmQgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAxKS5hcHBseVF1YXRlcm5pb24oZW50aXR5Lm1lc2gucXVhdGVybmlvbikubm9ybWFsaXplKCk7CgogICAgICAgIGNvbnN0IGZhY2luZ0RvdCA9IHBsYXllckZvcndhcmQuZG90KHRvQmFsbCk7CgogICAgICAgIGNvbnN0IGNvbmVUaHJlc2hvbGQgPSAtMC4yOwogICAgICAgIGNvbnN0IGlzSW5Db25lID0gZmFjaW5nRG90ID4gY29uZVRocmVzaG9sZDsKICAgICAgICBjb25zdCBpc0luVG91Y2ggPSBkaXN0WFogPCB0b3VjaFJhZGl1czsKCiAgICAgICAgaWYgKGRpc3RYWiA8IGludGVyYWN0aW9uUmFkaXVzICYmICFpc0luQ29uZSkgewogICAgICAgICAgICBjb25zdCB0YXJnZXRBbmdsZSA9IE1hdGguYXRhbjIodG9CYWxsLngsIHRvQmFsbC56KTsKICAgICAgICAgICAgY29uc3QgcSA9IG5ldyBUSFJFRS5RdWF0ZXJuaW9uKCkuc2V0RnJvbUF4aXNBbmdsZShuZXcgVEhSRUUuVmVjdG9yMygwLDEsMCksIHRhcmdldEFuZ2xlKTsKICAgICAgICAgICAgZW50aXR5Lm1lc2gucXVhdGVybmlvbi5zbGVycChxLCAwLjEpOwogICAgICAgICAgICBpZiAoZW50aXR5LnN5bmNSb3RhdGlvbikgZW50aXR5LnN5bmNSb3RhdGlvbigpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzSW5Ub3VjaCB8fCAoZGlzdFhaIDwgbWFnbmV0UmFkaXVzICYmIGlzSW5Db25lKSkgewogICAgICAgICAgICAvLyBCTEFTVCBUSFJPVUdIIExPR0lDCiAgICAgICAgICAgIGNvbnN0IGJhbGxTcGVlZCA9IF9iYWxsLnZlbG9jaXR5Lmxlbmd0aCgpOwogICAgICAgICAgICBsZXQgY2F0Y2hDaGFuY2UgPSAxLjA7CgogICAgICAgICAgICAvLyBJZiBiYWxsIGlzIG1vdmluZyBmYXN0IChlLmcuID4gMjApLCBjaGVjayBDQQogICAgICAgICAgICBpZiAoYmFsbFNwZWVkID4gMjAuMCkgewogICAgICAgICAgICAgICAgY29uc3QgY2EgPSBlbnRpdHkuZ2V0U3RhdCgnQ0EnKTsKICAgICAgICAgICAgICAgIC8vIERpZmZpY3VsdHkgc2NhbGVzIHdpdGggc3BlZWQuIAogICAgICAgICAgICAgICAgY29uc3QgZGlmZmljdWx0eSA9IGJhbGxTcGVlZCAqIDEuMjsgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChkaWZmaWN1bHR5ID4gY2EpIHsKICAgICAgICAgICAgICAgICAgICBjYXRjaENoYW5jZSA9IDAuNCArIChjYSAvIGRpZmZpY3VsdHkpICogMC42OwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFBvaW50IEJsYW5rIFBlbmFsdHk6IEhhcmRlciB0byByZWFjdCBpZiBiYWxsIGlzIHJpZ2h0IG9uIHRvcCBvZiB5b3UgbW92aW5nIGZhc3QKICAgICAgICAgICAgICAgICAgICBpZiAoZGlzdFhaIDwgMS4yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoQ2hhbmNlICo9IDAuNjsgLy8gQmxhc3QgdGhyb3VnaCBsaWtlbHkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKGVudGl0eS5pc0Rhc2hpbmcpIGNhdGNoQ2hhbmNlICs9IDAuMjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChfYmFsbC5wb3dlclR5cGUgPT09ICdTSCcgJiYgX2JhbGwucG93ZXIgPiAxNS4wKSB7CiAgICAgICAgICAgICAgICAvLyBTaG90IHBvd2VyIGNoZWNrCiAgICAgICAgICAgICAgICBjb25zdCBjYSA9IGVudGl0eS5nZXRTdGF0KCdDQScpOwogICAgICAgICAgICAgICAgaWYgKF9iYWxsLnBvd2VyID4gY2EgKiAxLjIpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGFuY2UgPSBNYXRoLm1pbigwLjcsIChfYmFsbC5wb3dlciAtIGNhKSAqIDAuMDQpOwogICAgICAgICAgICAgICAgICAgIGNhdGNoQ2hhbmNlID0gMS4wIC0gY2hhbmNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBsZXQgZnVtYmxlID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChNYXRoLnJhbmRvbSgpID4gY2F0Y2hDaGFuY2UpIHsKICAgICAgICAgICAgICAgIGZ1bWJsZSA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmdW1ibGUpIHsKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgLy8gVmlzdWFsIGZlZWRiYWNrIGZvciBibGFzdCB0aHJvdWdoCiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dC5zcGF3bigiQkxBU1QgVEhST1VHSCEiLCBlbnRQb3MsICJkYW1hZ2UiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRGVmbGVjdCBzbGlnaHRseSBidXQga2VlcCBtb3ZpbmcgZmFzdCAoQmxhc3QgVGhyb3VnaCkKICAgICAgICAgICAgICAgIC8vIERvbid0IHN0b3AgaXQgY29tcGxldGVseSBsaWtlIGEgYmxvY2ssIGp1c3QgcGVydHVyYiBpdAogICAgICAgICAgICAgICAgX2JhbGwudmVsb2NpdHkubXVsdGlwbHlTY2FsYXIoMC44NSk7IAogICAgICAgICAgICAgICAgX2JhbGwudmVsb2NpdHkueCArPSAoTWF0aC5yYW5kb20oKS0wLjUpICogNS4wOwogICAgICAgICAgICAgICAgX2JhbGwudmVsb2NpdHkueSArPSAoTWF0aC5yYW5kb20oKSkgKiA1LjA7IC8vIFBvcCB1cAogICAgICAgICAgICAgICAgX2JhbGwudmVsb2NpdHkueiArPSAoTWF0aC5yYW5kb20oKS0wLjUpICogNS4wOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfYmFsbC5wb3dlciAqPSAwLjc7CgogICAgICAgICAgICAgICAgZW50aXR5LmNhbkNhdGNoID0gZmFsc2U7CiAgICAgICAgICAgICAgICAvLyBTdHVuIGJyaWVmbHkKICAgICAgICAgICAgICAgIGVudGl0eS5zdHVuVGltZXIgPSAwLjU7CiAgICAgICAgICAgICAgICBpZihlbnRpdHkucGxheSkgZW50aXR5LnBsYXkoJ3JlYWN0JywgMC4xKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7IGVudGl0eS5jYW5DYXRjaCA9IHRydWU7IH0sIDEwMDApOwoKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIF9iYWxsLm1hZ25ldGl6ZShlbnRpdHkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vIFN0YXJ0CiAgICBpbml0KCk7Cn0pKCk7Cg==","./main.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgLy8gTmFtZXNwYWNlCiAgICB3aW5kb3cuZmx1eCA9IHdpbmRvdy5mbHV4IHx8IHt9OwoKICAgIC8vIENvbmZpZwpjb25zdCBfY29uZmlnID0gewogICAgICAgIGludGVybmFsV2lkdGg6IDM2MCwKICAgICAgICBpbnRlcm5hbEhlaWdodDogNjQwLAogICAgICAgIGJnQ29sb3I6IDB4MDAxZTM2LAogICAgICAgIGZvZ0NvbG9yOiAweDAwMWUzNiwKICAgICAgICBmb2dEZW5zaXR5OiAwLjAwMDEsIC8vIERyYXN0aWNhbGx5IHJlZHVjZWQgdG8gZW5zdXJlIHZpc2liaWxpdHkKICAgICAgICBhcmVuYVJhZGl1czogMzIuMAogICAgfTsKCiAgICAvLyBHbG9iYWxzCiAgICBsZXQgX3NjZW5lLCBfY2FtZXJhLCBfcmVuZGVyZXIsIF9jbG9jazsKICAgIGxldCBfaG9tZVRlYW0sIF9hd2F5VGVhbTsKbGV0IF9iYWxsOwogICAgbGV0IF9nYW1lTWFuYWdlcjsKICAgIGxldCBfbWVudU1hbmFnZXI7CgpsZXQgX2NhbWVyYU1hbmFnZXI7CiAgICBsZXQgX3dhdGVyT3ZlcmxheTsKICAgIGxldCBfbGlnaHRTaGFmdHM7CiAgICBsZXQgX3N0YWRpdW07CiAgICBsZXQgX2dseXBoTWFuYWdlcjsKCiAgICAvLyBJTVBST1ZFRDogU2V0dGluZ3Mgb2JqZWN0CiAgICBjb25zdCBfc2V0dGluZ3MgPSB7CiAgICAgICAgam95c3RpY2tTZW5zaXRpdml0eTogMS4wLAogICAgICAgIGFpbUFzc2lzdDogdHJ1ZSwKICAgICAgICBjYW1lcmFTaGFrZTogdHJ1ZSwKICAgICAgICBoaXRTdG9wOiB0cnVlLAogICAgICAgIGludmVydENhbWVyYTogZmFsc2UsCiAgICAgICAgYXV0b1JlY2VudGVyOiB0cnVlCiAgICB9OwoKICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgX2NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYW1lLWNvbnRhaW5lcicpOwoKICAgICAgICAvLyAxLiBTY2VuZQogICAgICAgIF9zY2VuZSA9IG5ldyBUSFJFRS5TY2VuZSgpOwogICAgICAgIF9zY2VuZS5iYWNrZ3JvdW5kID0gbmV3IFRIUkVFLkNvbG9yKF9jb25maWcuYmdDb2xvcik7CiAgICAgICAgX3NjZW5lLmZvZyA9IG5ldyBUSFJFRS5Gb2dFeHAyKF9jb25maWcuZm9nQ29sb3IsIF9jb25maWcuZm9nRGVuc2l0eSk7CgogICAgICAgIC8vIDIuIENhbWVyYQogICAgICAgIGNvbnN0IGFzcGVjdCA9IF9jb25maWcuaW50ZXJuYWxXaWR0aCAvIF9jb25maWcuaW50ZXJuYWxIZWlnaHQ7Cl9jYW1lcmEgPSBuZXcgVEhSRUUuUGVyc3BlY3RpdmVDYW1lcmEoNjAsIGFzcGVjdCwgMC4xLCA1MDApOwpfY2FtZXJhLnBvc2l0aW9uLnNldCgwLCAxNCwgMjIpOwogICAgICAgIF9jYW1lcmEubG9va0F0KDAsIDAsIDApOwogICAgICAgIF9zY2VuZS5hZGQoX2NhbWVyYSk7IC8vIEVuc3VyZSBjYW1lcmEgaXMgaW4gc2NlbmUgZm9yIGNoaWxkcmVuIHRvIHJlbmRlcgoKICAgICAgICAvLyAzLiBSZW5kZXJlcgpfcmVuZGVyZXIgPSBuZXcgVEhSRUUuV2ViR0xSZW5kZXJlcih7IGFudGlhbGlhczogZmFsc2UgfSk7CiAgICAgICAgLy8gRXhwb3NlIHJlbmRlcmVyIGZvciBEZXZUb29scwogICAgICAgIGlmIChfZ2FtZU1hbmFnZXIpIF9nYW1lTWFuYWdlci5yZW5kZXJlciA9IF9yZW5kZXJlcjsgCiAgICAgICAgZWxzZSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UgPSB7IHJlbmRlcmVyOiBfcmVuZGVyZXIgfTsgLy8gVGVtcCBob29rCl9jb250YWluZXIuYXBwZW5kQ2hpbGQoX3JlbmRlcmVyLmRvbUVsZW1lbnQpOwoKICAgICAgICAvLyAtLS0gVmlkZW8gT3ZlcmxheSBFbmZvcmNlbWVudCAtLS0KLy8gLS0tIE92ZXJsYXkgVmlkZW8gTG9naWMgUmVtb3ZlZCAoU3dpdGNoZWQgdG8gR0lGKSAtLS0KICAgICAgICAvLyA1LiBFbnZpcm9ubWVudAogICAgICAgIGNyZWF0ZVBhcnRpY2xlcygpOwogICAgICAgIGNyZWF0ZUFyZW5hKCk7CgovLyA1LjUgR2FtZSBNYW5hZ2VyCl9nYW1lTWFuYWdlciA9IG5ldyB3aW5kb3cuZmx1eC5HYW1lTWFuYWdlcihfc2NlbmUsICd1aS1sYXllcicsIF9jYW1lcmEsIF9yZW5kZXJlcik7CiAgICAgICAgCiAgICAgICAgLy8gNS41LjEgQXVkaW8gTWFuYWdlcgogICAgICAgIF9hdWRpb01hbmFnZXIgPSBuZXcgd2luZG93LmZsdXguQXVkaW9NYW5hZ2VyKCk7CiAgICAgICAgX2dhbWVNYW5hZ2VyLmF1ZGlvTWFuYWdlciA9IF9hdWRpb01hbmFnZXI7CgogICAgICAgIC8vIDUuNiBDYW1lcmEgTWFuYWdlcgogICAgICAgIF9jYW1lcmFNYW5hZ2VyID0gbmV3IHdpbmRvdy5mbHV4LkNhbWVyYU1hbmFnZXIoX2NhbWVyYSwgX3NjZW5lKTsKICAgICAgICBfZ2FtZU1hbmFnZXIuY2FtZXJhTWFuYWdlciA9IF9jYW1lcmFNYW5hZ2VyOwoKICAgICAgICAvLyA1LjcgRGV2IFRvb2xzCmlmICh3aW5kb3cuZmx1eC5EZXZUb29scykgewogICAgICAgICAgICBuZXcgd2luZG93LmZsdXguRGV2VG9vbHMoX2dhbWVNYW5hZ2VyKTsKICAgICAgICB9Ci8vIDUuOCBXYXRlciBPdmVybGF5LCBMaWdodCBTaGFmdHMsIFN0YWRpdW0sIEdseXBocwogICAgICAgIF93YXRlck92ZXJsYXkgPSBuZXcgd2luZG93LmZsdXguV2F0ZXJPdmVybGF5KF9jYW1lcmEpOwogICAgICAgIF9saWdodFNoYWZ0cyA9IG5ldyB3aW5kb3cuZmx1eC5MaWdodFNoYWZ0cyhfc2NlbmUpOwogICAgICAgIF9zdGFkaXVtID0gbmV3IHdpbmRvdy5mbHV4LlN0YWRpdW0oX3NjZW5lKTsKICAgICAgICBfZ2x5cGhNYW5hZ2VyID0gbmV3IHdpbmRvdy5mbHV4LkdseXBoTWFuYWdlcihfc2NlbmUpOwogICAgICAgIAppZiAoX2dhbWVNYW5hZ2VyKSB7CiAgICAgICAgICAgIF9nYW1lTWFuYWdlci5nbHlwaE1hbmFnZXIgPSBfZ2x5cGhNYW5hZ2VyOwogICAgICAgICAgICBfZ2FtZU1hbmFnZXIud2F0ZXJPdmVybGF5ID0gX3dhdGVyT3ZlcmxheTsKICAgICAgICAgICAgX2dhbWVNYW5hZ2VyLmxpZ2h0U2hhZnRzID0gX2xpZ2h0U2hhZnRzOwogICAgICAgICAgICBfZ2FtZU1hbmFnZXIuc3RhZGl1bSA9IF9zdGFkaXVtOwogICAgICAgIH0KICAgICAgICAvLyA2LiBUZWFtcyBTZXR1cAogICAgICAgIF9ob21lVGVhbSA9IG5ldyB3aW5kb3cuZmx1eC5UZWFtKF9zY2VuZSwgJ2hvbWUnLCAxLCAweDAwYWFmZiwgdHJ1ZSk7CiAgICAgICAgX2F3YXlUZWFtID0gbmV3IHdpbmRvdy5mbHV4LlRlYW0oX3NjZW5lLCAnYXdheScsIC0xLCAweGZmNjY2NiwgZmFsc2UpOwoKICAgICAgICAvLyA3LiBCYWxsCiAgICAgICAgX2JhbGwgPSBuZXcgd2luZG93LmZsdXguQmFsbChfc2NlbmUpOwoKICAgICAgICAvLyBJTVBST1ZFRDogTGluayBiYWxsIHRvIGNhbWVyYSBmb3Igc21hcnQgZnJhbWluZwogICAgICAgIF9jYW1lcmFNYW5hZ2VyLnNldEJhbGwoX2JhbGwpOwoKICAgICAgICAvLyA4LiBUZWFtIFJvc3RlciBNb2RlbHMKICAgICAgICBjb25zdCByb2xlcyA9IFsnTEYnLCAnUkYnLCAnTUYnLCAnTEQnLCAnUkQnLCAnR0wnXTsKICAgICAgICBjb25zdCBob21lUm9zdGVyID0gewogICAgICAgICAgICBMRjogeyBuYW1lOiAnVGlkdXMnLCB1cmw6ICdodHRwczovL2Nkbi50aW55Z2xiLmNvbS9tb2RlbHMvZGE3ODhiZWYyNThjNGYwYjhkOWVmMWFjYzE5YzU1NjcuZ2xiJyB9LAogICAgICAgICAgICBSRjogeyBuYW1lOiAnV2Fra2EnLCB1cmw6ICdodHRwczovL2Nkbi50aW55Z2xiLmNvbS9tb2RlbHMvNTkxMTRjOTg5NTE2NDdjOWI4ZGE3NGIwYmQzNjM2Y2IuZ2xiJyB9LAogICAgICAgICAgICBNRjogeyBuYW1lOiAnTGV0dHknLCB1cmw6ICdodHRwczovL2Nkbi50aW55Z2xiLmNvbS9tb2RlbHMvNDNhY2UzNGM2ZmQ5NDIxNTk2N2U4NDJiZjkwOWRhNWUuZ2xiJyB9LAogICAgICAgICAgICBMRDogeyBuYW1lOiAnRGF0dG8nLCB1cmw6ICdodHRwczovL2Nkbi50aW55Z2xiLmNvbS9tb2RlbHMvZTZkNjdlY2IyZTRjNDcxNWJkNzNhNDA3OTVlMWQzZDUuZ2xiJyB9LAogICAgICAgICAgICBSRDogeyBuYW1lOiAnSmFzc3UnLCB1cmw6ICdodHRwczovL2Nkbi50aW55Z2xiLmNvbS9tb2RlbHMvODIxNjQ1OTU2NzM1NGU2Mzk1OGQ0MTA4ZDgyOGRlOTguZ2xiJyB9LAogICAgICAgICAgICBHTDogeyBuYW1lOiAnQm90dGEnLCB1cmw6ICdodHRwczovL2Nkbi50aW55Z2xiLmNvbS9tb2RlbHMvYWQxNTVlZmVkYzBkNDhmZGFkMDlkYTNlMWNhZTljOTcuZ2xiJyB9CiAgICAgICAgfTsKCiAgICAgICAgY29uc3QgYXBwbHlTdGF0cyA9IChwLCByb2xlLCBpc0hvbWUpID0+IHsKICAgICAgICAgICAgY29uc3QgdGVhbUxldmVsID0gaXNIb21lID8gMjUgOiAyMjsKICAgICAgICAgICAgd2luZG93LmZsdXguVGVhbS5nZW5lcmF0ZVN0YXRzKHAsIHJvbGUsIHRlYW1MZXZlbCwgaXNIb21lKTsKCiAgICAgICAgICAgIGlmIChwLmNoYXJhY3Rlck5hbWUuaW5jbHVkZXMoJ1RpZHVzJykpIHsKICAgICAgICAgICAgICAgIHAuc3RhdHMuU0ggKz0gNTsKICAgICAgICAgICAgICAgIHAuc3RhdHMuU1AgKz0gMzsKICAgICAgICAgICAgfSBlbHNlIGlmIChwLmNoYXJhY3Rlck5hbWUuaW5jbHVkZXMoJ1dha2thJykpIHsKICAgICAgICAgICAgICAgIHAuc3RhdHMuU0ggKz0gMzsKICAgICAgICAgICAgICAgIHAuc3RhdHMuRU4gKz0gNTsKICAgICAgICAgICAgfSBlbHNlIGlmIChwLmNoYXJhY3Rlck5hbWUuaW5jbHVkZXMoJ0Jyb3RoZXInKSkgewogICAgICAgICAgICAgICAgcC5zdGF0cy5TUCA9IDk5OwogICAgICAgICAgICB9CgogICAgICAgICAgICBwLl91cGRhdGVEZXJpdmVkU3RhdHMoKTsKICAgICAgICB9OwoKICAgICAgICBsZXQgaG9tZUxvYWRlZCA9IDA7CiAgICAgICAgY29uc3Qgcm9sZUdsdGZzID0ge307CgogICAgICAgIGNvbnN0IGZpbmFsaXplVGVhbXMgPSAoKSA9PiB7CiAgICAgICAgICAgIHJvbGVzLmZvckVhY2gocm9sZSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBnbHRmID0gcm9sZUdsdGZzW3JvbGVdIHx8IHJvbGVHbHRmcy5MRjsKCiAgICAgICAgICAgICAgICBjb25zdCBwID0gKHJvbGUgPT09ICdHTCcpCiAgICAgICAgICAgICAgICAgICAgPyBuZXcgd2luZG93LmZsdXguR29hbGllKF9zY2VuZSwgcm9sZSkKICAgICAgICAgICAgICAgICAgICA6IG5ldyB3aW5kb3cuZmx1eC5BSVBsYXllcihfc2NlbmUsIHJvbGUpOwoKICAgICAgICAgICAgICAgIGNvbnN0IGVudHJ5ID0gaG9tZVJvc3Rlcltyb2xlXTsKICAgICAgICAgICAgICAgIHAuY2hhcmFjdGVyTmFtZSA9IGVudHJ5ID8gYENQVSAke2VudHJ5Lm5hbWV9YCA6ICdDUFUnOwogICAgICAgICAgICAgICAgYXBwbHlTdGF0cyhwLCByb2xlLCBmYWxzZSk7CgogICAgICAgICAgICAgICAgaWYgKGdsdGYgJiYgZ2x0Zi5zY2VuZSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNsb25lID0gVEhSRUUuU2tlbGV0b25VdGlscy5jbG9uZShnbHRmLnNjZW5lKTsKICAgICAgICAgICAgICAgICAgICBwLnNldE1lc2goY2xvbmUsIGdsdGYuYW5pbWF0aW9ucyB8fCBbXSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignTWlzc2luZyBHTFRGIGZvciBhd2F5IHJvbGU6Jywgcm9sZSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2F3YXlUZWFtLmFkZFBsYXllcihwKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjb25zdCBhbGxQbGF5ZXJzID0gWy4uLl9ob21lVGVhbS5wbGF5ZXJzLCAuLi5fYXdheVRlYW0ucGxheWVyc107CiAgICAgICAgICAgIGFsbFBsYXllcnMuZm9yRWFjaChwID0+IHsKICAgICAgICAgICAgICAgIGlmIChwLmJhbGxSZWYgPT09IG51bGwpIHAuYmFsbFJlZiA9IF9iYWxsOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIF9ob21lVGVhbS5hY3RpdmVQbGF5ZXIgPSBfaG9tZVRlYW0ucGxheWVycy5maW5kKHAgPT4gcC5yb2xlID09PSAnTUYnKTsKCiAgICAgICAgICAgIGlmIChfaG9tZVRlYW0uYWN0aXZlUGxheWVyKSB7CiAgICAgICAgICAgICAgICBfaG9tZVRlYW0uYWN0aXZlUGxheWVyLnRlY2hzLnRhY2tsZSA9ICd2ZW5vbSc7CiAgICAgICAgICAgICAgICBfaG9tZVRlYW0uYWN0aXZlUGxheWVyLnRlY2hzLnNob290ID0gJ3NwaGVyZSc7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRXF1aXBwZWQgSG9tZSBNRiB3aXRoIFZlbm9tIFRhY2tsZSAmIFNwaGVyZSBTaG90Jyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IGF3YXlNRiA9IF9hd2F5VGVhbS5wbGF5ZXJzLmZpbmQocCA9PiBwLnJvbGUgPT09ICdNRicpOwogICAgICAgICAgICBpZiAoYXdheU1GKSB7CiAgICAgICAgICAgICAgICBhd2F5TUYudGVjaHMudGFja2xlID0gJ3dpdGhlcic7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2F3YXlUZWFtLnNldEZvcm1hdGlvbignQ291bnRlcicpOwoKICAgICAgICAgICAgY29uc3QgYXdheUdMID0gX2F3YXlUZWFtLnBsYXllcnMuZmluZChwID0+IHAucm9sZSA9PT0gJ0dMJyk7CiAgICAgICAgICAgIGlmIChhd2F5R0wpIHsKICAgICAgICAgICAgICAgIGF3YXlHTC50ZWNocy5hY3RpdmUgPSAnc3VwZXJfZ29hbGllJzsKICAgICAgICAgICAgICAgIGF3YXlHTC50ZWNocy5wYXNzaXZlID0gJ2dyaXBfZ2xvdmVzJzsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFcXVpcHBlZCBBd2F5IEdMIHdpdGggU3VwZXIgR29hbGllJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9ob21lVGVhbS5hc3NpZ25NYXJrcyhfYXdheVRlYW0pOwogICAgICAgICAgICBfYXdheVRlYW0uYXNzaWduTWFya3MoX2hvbWVUZWFtKTsKCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgaWYgKF9nYW1lTWFuYWdlcikgewogICAgICAgICAgICAgICAgX2dhbWVNYW5hZ2VyLnJlZ2lzdGVyVGVhbXMoX2hvbWVUZWFtLCBfYXdheVRlYW0sIF9iYWxsKTsKCiAgICAgICAgICAgICAgICBfbWVudU1hbmFnZXIgPSBuZXcgd2luZG93LmZsdXguTWVudU1hbmFnZXIoX2dhbWVNYW5hZ2VyKTsKICAgICAgICAgICAgICAgIF9tZW51TWFuYWdlci5zaG93KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKcm9sZXMuZm9yRWFjaChyb2xlID0+IHsKICAgICAgICAgICAgY29uc3QgZW50cnkgPSBob21lUm9zdGVyW3JvbGVdOwogICAgICAgICAgICBpZiAoIWVudHJ5KSByZXR1cm47CgogICAgICAgICAgICBjb25zdCBvbkNvbXBsZXRlID0gKCkgPT4gewogICAgICAgICAgICAgICAgaG9tZUxvYWRlZCsrOwogICAgICAgICAgICAgICAgaWYgKGhvbWVMb2FkZWQgPj0gcm9sZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgZmluYWxpemVUZWFtcygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgd2luZG93LmZsdXguQXNzZXRMb2FkZXIubG9hZE1vZGVsKGVudHJ5LnVybCwgKGdsdGYpID0+IHsKICAgICAgICAgICAgICAgIHJvbGVHbHRmc1tyb2xlXSA9IGdsdGY7CgogICAgICAgICAgICAgICAgY29uc3QgcCA9IChyb2xlID09PSAnR0wnKQogICAgICAgICAgICAgICAgICAgID8gbmV3IHdpbmRvdy5mbHV4LkdvYWxpZShfc2NlbmUsIHJvbGUpCiAgICAgICAgICAgICAgICAgICAgOiBuZXcgd2luZG93LmZsdXguQUlQbGF5ZXIoX3NjZW5lLCByb2xlKTsKCiAgICAgICAgICAgICAgICBwLmNoYXJhY3Rlck5hbWUgPSBlbnRyeS5uYW1lOwogICAgICAgICAgICAgICAgYXBwbHlTdGF0cyhwLCByb2xlLCB0cnVlKTsKCiAgICAgICAgICAgICAgICBjb25zdCBjbG9uZSA9IFRIUkVFLlNrZWxldG9uVXRpbHMuY2xvbmUoZ2x0Zi5zY2VuZSk7CiAgICAgICAgICAgICAgICBwLnNldE1lc2goY2xvbmUsIGdsdGYuYW5pbWF0aW9ucyk7CiAgICAgICAgICAgICAgICBfaG9tZVRlYW0uYWRkUGxheWVyKHApOwoKICAgICAgICAgICAgICAgIG9uQ29tcGxldGUoKTsKICAgICAgICAgICAgfSwgdW5kZWZpbmVkLCAoZXJyKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gbG9hZCBtb2RlbCcsIGVudHJ5Lm5hbWUsIGVudHJ5LnVybCwgZXJyKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRmFsbGJhY2sgTWVzaCAoUmVkIEJveCkKICAgICAgICAgICAgICAgIGNvbnN0IGZhbGxiYWNrR2VvID0gbmV3IFRIUkVFLkJveEdlb21ldHJ5KDEsIDIsIDEpOwogICAgICAgICAgICAgICAgY29uc3QgZmFsbGJhY2tNYXQgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyBjb2xvcjogMHhmZjAwMDAsIHdpcmVmcmFtZTogdHJ1ZSB9KTsKICAgICAgICAgICAgICAgIGNvbnN0IGZhbGxiYWNrTWVzaCA9IG5ldyBUSFJFRS5NZXNoKGZhbGxiYWNrR2VvLCBmYWxsYmFja01hdCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFN0b3JlIGR1bW15IGluIHJvbGVHbHRmcyBmb3IgYXdheSB0ZWFtIGNsb25pbmcKICAgICAgICAgICAgICAgIHJvbGVHbHRmc1tyb2xlXSA9IHsgc2NlbmU6IGZhbGxiYWNrTWVzaCwgYW5pbWF0aW9uczogW10gfTsKCiAgICAgICAgICAgICAgICBjb25zdCBwID0gKHJvbGUgPT09ICdHTCcpCiAgICAgICAgICAgICAgICAgICAgPyBuZXcgd2luZG93LmZsdXguR29hbGllKF9zY2VuZSwgcm9sZSkKICAgICAgICAgICAgICAgICAgICA6IG5ldyB3aW5kb3cuZmx1eC5BSVBsYXllcihfc2NlbmUsIHJvbGUpOwoKICAgICAgICAgICAgICAgIHAuY2hhcmFjdGVyTmFtZSA9IGVudHJ5Lm5hbWUgKyAiIChFcnJvcikiOwogICAgICAgICAgICAgICAgYXBwbHlTdGF0cyhwLCByb2xlLCB0cnVlKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcC5zZXRNZXNoKGZhbGxiYWNrTWVzaC5jbG9uZSgpLCBbXSk7CiAgICAgICAgICAgICAgICBfaG9tZVRlYW0uYWRkUGxheWVyKHApOwoKICAgICAgICAgICAgICAgIG9uQ29tcGxldGUoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vIDguIElucHV0CiAgICAgICAgc2V0dXBJbnB1dHMoKTsKCiAgICAgICAgLy8gOS4gTG9vcAogICAgICAgIF9jbG9jayA9IG5ldyBUSFJFRS5DbG9jaygpOwogICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKCiAgICAgICAgLy8gSGFuZGxlIHJlc2l6ZQogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBvblJlc2l6ZSk7CiAgICAgICAgb25SZXNpemUoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGVQYXJ0aWNsZXMoKSB7CiAgICAgICAgY29uc3QgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuQnVmZmVyR2VvbWV0cnkoKTsKICAgICAgICBjb25zdCB2ZXJ0aWNlcyA9IFtdOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNTAwOyBpKyspIHsKICAgICAgICAgICAgdmVydGljZXMucHVzaCgKICAgICAgICAgICAgICAgIChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDIwLAogICAgICAgICAgICAgICAgKE1hdGgucmFuZG9tKCkgLSAwLjUpICogMjAsCiAgICAgICAgICAgICAgICAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiAyMAogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBnZW9tZXRyeS5zZXRBdHRyaWJ1dGUoJ3Bvc2l0aW9uJywgbmV3IFRIUkVFLkZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUodmVydGljZXMsIDMpKTsKICAgICAgICBjb25zdCBtYXRlcmlhbCA9IG5ldyBUSFJFRS5Qb2ludHNNYXRlcmlhbCh7IGNvbG9yOiAweDg4Y2NmZiwgc2l6ZTogMC4wNSwgdHJhbnNwYXJlbnQ6IHRydWUsIG9wYWNpdHk6IDAuNiB9KTsKICAgICAgICBjb25zdCBwb2ludHMgPSBuZXcgVEhSRUUuUG9pbnRzKGdlb21ldHJ5LCBtYXRlcmlhbCk7CiAgICAgICAgX3NjZW5lLmFkZChwb2ludHMpOwogICAgfQoKZnVuY3Rpb24gY3JlYXRlQXJlbmEoKSB7CiAgICAgICAgY29uc3QgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuU3BoZXJlR2VvbWV0cnkoX2NvbmZpZy5hcmVuYVJhZGl1cywgMzIsIDMyKTsKICAgICAgICAKICAgICAgICBjb25zdCB0ZXhMb2FkZXIgPSBuZXcgVEhSRUUuVGV4dHVyZUxvYWRlcigpOwpjb25zdCBhcmVuYVRleCA9IHRleExvYWRlci5sb2FkKCdodHRwczovL2kucG9zdGltZy5jYy9XMUxzSDY4US9maWxlLTAwMDAwMDAwMjNlYzcxZjU5NjU5MzgyOWU4MTE4NzYwLSgxKS5wbmcnKTsKICAgICAgICBhcmVuYVRleC5tYWdGaWx0ZXIgPSBUSFJFRS5OZWFyZXN0RmlsdGVyOwogICAgICAgIGFyZW5hVGV4Lm1pbkZpbHRlciA9IFRIUkVFLk5lYXJlc3RGaWx0ZXI7CiAgICAgICAgYXJlbmFUZXgud3JhcFMgPSBUSFJFRS5SZXBlYXRXcmFwcGluZzsKICAgICAgICBhcmVuYVRleC53cmFwVCA9IFRIUkVFLlJlcGVhdFdyYXBwaW5nOwogICAgICAgIGFyZW5hVGV4LnJlcGVhdC5zZXQoNiwgNCk7Cgpjb25zdCBtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7CiAgICAgICAgICAgIG1hcDogYXJlbmFUZXgsCiAgICAgICAgICAgIGNvbG9yOiAweGZmZmZmZiwKICAgICAgICAgICAgd2lyZWZyYW1lOiBmYWxzZSwKICAgICAgICAgICAgdHJhbnNwYXJlbnQ6IHRydWUsCiAgICAgICAgICAgIG9wYWNpdHk6IDAuMCwgLy8gRGVmYXVsdCBpbnZpc2libGUgKDAuMCkgYXMgcmVxdWVzdGVkCiAgICAgICAgICAgIGJsZW5kaW5nOiBUSFJFRS5NdWx0aXBseUJsZW5kaW5nLAogICAgICAgICAgICBzaWRlOiBUSFJFRS5CYWNrU2lkZQogICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICBjb25zdCBhcmVuYSA9IG5ldyBUSFJFRS5NZXNoKGdlb21ldHJ5LCBtYXRlcmlhbCk7CiAgICAgICAgX3NjZW5lLmFkZChhcmVuYSk7CiAgICAgICAgd2luZG93LmZsdXguYXJlbmFNZXNoID0gYXJlbmE7CgovLyAtLS0gQXJlbmEgMiAoTm9ybWFsIEJsZW5kLCA1JSBPcGFjaXR5KSAtLS0KICAgICAgICBjb25zdCBtYXRlcmlhbDIgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoewogICAgICAgICAgICBtYXA6IGFyZW5hVGV4LAogICAgICAgICAgICBjb2xvcjogMHhmZmZmZmYsCiAgICAgICAgICAgIHdpcmVmcmFtZTogZmFsc2UsCiAgICAgICAgICAgIHRyYW5zcGFyZW50OiB0cnVlLAogICAgICAgICAgICBvcGFjaXR5OiAwLjA1LAogICAgICAgICAgICBibGVuZGluZzogVEhSRUUuTm9ybWFsQmxlbmRpbmcsCiAgICAgICAgICAgIHNpZGU6IFRIUkVFLkJhY2tTaWRlCiAgICAgICAgfSk7CiAgICAgICAgY29uc3QgYXJlbmEyID0gbmV3IFRIUkVFLk1lc2goZ2VvbWV0cnksIG1hdGVyaWFsMik7CiAgICAgICAgYXJlbmEyLnNjYWxlLnNldFNjYWxhcigwLjk5NSk7IC8vIFNsaWdodCBvZmZzZXQgdG8gcHJldmVudCB6LWZpZ2h0aW5nCiAgICAgICAgX3NjZW5lLmFkZChhcmVuYTIpOwogICAgICAgIHdpbmRvdy5mbHV4LmFyZW5hTWVzaDIgPSBhcmVuYTI7CgogICAgICAgIC8vIC0tLSBORVc6IEZGWCBHT0FMIE1PREVMUyAtLS0KICAgICAgICBjb25zdCBnb2FsVXJsID0gJ2h0dHBzOi8vY2RuLnRpbnlnbGIuY29tL21vZGVscy9hNTE2YmQ5MGZhN2M0ZGVkYjVkY2JmZGY4MDNmMTNkNS5nbGInOwogICAgICAgIApjb25zdCBvbkdvYWxMb2FkZWQgPSAobW9kZWwsIGlzRmFsbGJhY2spID0+IHsKICAgICAgICAgICAgY29uc3QgZ29hbEEgPSBtb2RlbDsKICAgICAgICAgICAgLy8gTW92ZWQgZG93biB+N2Z0ICgyLjJtKSBhcyByZXF1ZXN0ZWQKICAgICAgICAgICAgZ29hbEEucG9zaXRpb24uc2V0KDAsIC0yLjIsIC0zMik7IAogICAgICAgICAgICAKaWYgKCFpc0ZhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICBnb2FsQS5zY2FsZS5zZXRTY2FsYXIoMzYuMCk7IC8vIEluY3JlYXNlZCA1MCUgKHdhcyAyNC4wKQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIFNldHVwIEdvYWwgQQogICAgICAgICAgICBnb2FsQS50cmF2ZXJzZShjID0+IHsKICAgICAgICAgICAgICAgIGlmKGMuaXNNZXNoKSB7CiAgICAgICAgICAgICAgICAgICAgYy5mcnVzdHVtQ3VsbGVkID0gZmFsc2U7IC8vIENSSVRJQ0FMOiBQcmV2ZW50IGN1bGxpbmcKICAgICAgICAgICAgICAgICAgICBjLnJlbmRlck9yZGVyID0gMDsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBFbnN1cmUgbWF0ZXJpYWwgaXMgdmlzaWJsZQogICAgICAgICAgICAgICAgICAgIGlmIChjLm1hdGVyaWFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGMubWF0ZXJpYWwuY29sb3Iuc2V0SGV4KDB4ZmZmZmZmKTsgLy8gV2hpdGUgdG8gc2hvdyBvcmlnaW5hbCB0ZXh0dXJlL2NvbG9ycyAod2FzIGJsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgIGMubWF0ZXJpYWwudHJhbnNwYXJlbnQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgYy5tYXRlcmlhbC5vcGFjaXR5ID0gMS4wOwogICAgICAgICAgICAgICAgICAgICAgICBjLm1hdGVyaWFsLnNpZGUgPSBUSFJFRS5Eb3VibGVTaWRlOwogICAgICAgICAgICAgICAgICAgICAgICBjLm1hdGVyaWFsLmRlcHRoV3JpdGUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBjLm1hdGVyaWFsLmRlcHRoVGVzdCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgX3NjZW5lLmFkZChnb2FsQSk7CgogICAgICAgICAgICAvLyBTZXR1cCBHb2FsIEIKICAgICAgICAgICAgY29uc3QgZ29hbEIgPSBpc0ZhbGxiYWNrID8gZ29hbEEuY2xvbmUoKSA6IFRIUkVFLlNrZWxldG9uVXRpbHMuY2xvbmUoZ29hbEEpOwoKICAgICAgICAgICAgZ29hbEIucG9zaXRpb24uc2V0KDAsIC0yLjIsIDMyKTsgLy8gTW92ZWQgY2xvc2VyICh3YXMgNDUpIGFuZCBkb3duCiAgICAgICAgICAgIGdvYWxCLnJvdGF0aW9uLnkgPSBNYXRoLlBJOwogICAgICAgICAgICAvLyBFbnN1cmUgR29hbCBCIG1lc2hlcyBhcmUgYWxzbyBwZXJzaXN0ZW50CiAgICAgICAgICAgIGdvYWxCLnRyYXZlcnNlKGMgPT4gewogICAgICAgICAgICAgICAgaWYoYy5pc01lc2gpIGMuZnJ1c3R1bUN1bGxlZCA9IGZhbHNlOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIF9zY2VuZS5hZGQoZ29hbEIpOwogICAgICAgIH07CgogICAgICAgIHdpbmRvdy5mbHV4LkFzc2V0TG9hZGVyLmxvYWRNb2RlbChnb2FsVXJsLCAoZ2x0ZikgPT4gewogICAgICAgICAgICBvbkdvYWxMb2FkZWQoZ2x0Zi5zY2VuZSwgZmFsc2UpOwogICAgICAgIH0sIHVuZGVmaW5lZCwgKGVycikgPT4gewpjb25zb2xlLndhcm4oIkdvYWwgbW9kZWwgZmFpbGVkIHRvIGxvYWQuIFVzaW5nIGZhbGxiYWNrLiIsIGVycik7CmNvbnN0IGdlbyA9IG5ldyBUSFJFRS5Cb3hHZW9tZXRyeSg3NSwgNDUsIDEwKTsgLy8gRmFsbGJhY2sgbWFzc2l2ZSBib3ggKFNjYWxlZCAxLjV4KQogICAgICAgICAgICBjb25zdCBmYWxsYmFja01hdCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7IGNvbG9yOiAweGZmZmZmZiwgd2lyZWZyYW1lOiB0cnVlIH0pOwogICAgICAgICAgICBjb25zdCBmYWxsYmFjayA9IG5ldyBUSFJFRS5NZXNoKGdlbywgZmFsbGJhY2tNYXQpOwogICAgICAgICAgICBvbkdvYWxMb2FkZWQoZmFsbGJhY2ssIHRydWUpOwogICAgICAgIH0pOwoKICAgICAgICAvLyAtLS0gTkVXOiBNQVNTSVZFIEZJRUxEIE1BUktJTkdTIC0tLQogICAgICAgIGNyZWF0ZUZpZWxkTWFya2luZ3MoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGVGaWVsZE1hcmtpbmdzKCkgewogICAgICAgIGNvbnN0IHNpemUgPSAxMDI0OwogICAgICAgIGNvbnN0IGMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgICBjLndpZHRoID0gc2l6ZTsgYy5oZWlnaHQgPSBzaXplOwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjb25zdCBjeCA9IHNpemUvMjsgY29uc3QgY3kgPSBzaXplLzI7CgogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgc2l6ZSwgc2l6ZSk7CgogICAgICAgIC8vIEdsb3cgU2V0dGluZ3MKICAgICAgICBjdHguc2hhZG93Qmx1ciA9IDIwOwogICAgICAgIGN0eC5zaGFkb3dDb2xvciA9ICcjMDBmZmZmJzsKICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAncmdiYSgxMDAsIDI1NSwgMjU1LCAwLjkpJzsKICAgICAgICBjdHgubGluZVdpZHRoID0gNTsKICAgICAgICBjdHgubGluZUNhcCA9ICdyb3VuZCc7CgogICAgICAgIC8vIDEuIE1haW4gRmllbGQgQ2lyY2xlIChUaGUgU3BoZXJlIEVxdWF0b3IpCiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgIGN0eC5hcmMoY3gsIGN5LCA0NTAsIDAsIE1hdGguUEkqMik7CiAgICAgICAgY3R4LnN0cm9rZSgpOwoKICAgICAgICAvLyAyLiBJbm5lciBEZWNvcmF0aXZlIFJpbmcKICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgY3R4LmFyYyhjeCwgY3ksIDQyMCwgMCwgTWF0aC5QSSoyKTsKICAgICAgICBjdHgubGluZVdpZHRoID0gMjsKICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAncmdiYSgwLCAyMDAsIDI1NSwgMC41KSc7CiAgICAgICAgY3R4LnN0cm9rZSgpOwoKICAgICAgICAvLyAzLiBDZW50ZXIgQmxpdHpvZmYgWm9uZSAoQ29tcGxleCBTdGFyL1J1bmUpCiAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDQ7CiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC45KSc7CiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgIGN0eC5hcmMoY3gsIGN5LCA4MCwgMCwgTWF0aC5QSSoyKTsKICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgICAgCiAgICAgICAgLy8gSW5uZXIgU3RhciBQYXR0ZXJuCiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgIGZvcihsZXQgaT0wOyBpPDU7IGkrKykgewogICAgICAgICAgICBjb25zdCBhID0gKGkvNSkqTWF0aC5QSSoyIC0gTWF0aC5QSS8yOwogICAgICAgICAgICBjb25zdCB4ID0gY3ggKyBNYXRoLmNvcyhhKSo2MDsKICAgICAgICAgICAgY29uc3QgeSA9IGN5ICsgTWF0aC5zaW4oYSkqNjA7CiAgICAgICAgICAgIGlmKGk9PT0wKSBjdHgubW92ZVRvKHgseSk7IGVsc2UgY3R4LmxpbmVUbyh4LHkpOwogICAgICAgICAgICAvLyBJbm5lciBwb2ludAogICAgICAgICAgICBjb25zdCBhMiA9ICgoaSswLjUpLzUpKk1hdGguUEkqMiAtIE1hdGguUEkvMjsKICAgICAgICAgICAgY29uc3QgeDIgPSBjeCArIE1hdGguY29zKGEyKSoyNTsKICAgICAgICAgICAgY29uc3QgeTIgPSBjeSArIE1hdGguc2luKGEyKSoyNTsKICAgICAgICAgICAgY3R4LmxpbmVUbyh4Mix5Mik7CiAgICAgICAgfQogICAgICAgIGN0eC5jbG9zZVBhdGgoKTsKICAgICAgICBjdHguc3Ryb2tlKCk7CgogICAgICAgIC8vIDQuIE1pZGZpZWxkIExpbmUKICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgY3R4Lm1vdmVUbygwLCBjeSk7IGN0eC5saW5lVG8oc2l6ZSwgY3kpOwogICAgICAgIGN0eC5zdHJva2UoKTsKCiAgICAgICAgLy8gNS4gR29hbCBCb3hlcyAoVHJhcGV6b2lkcykKICAgICAgICBjb25zdCBkcmF3R29hbEJveCA9ICh5UG9zLCBkaXIpID0+IHsKY29uc3QgZHJhd0dvYWxCb3ggPSAoeVBvcywgZGlyKSA9PiB7CiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgY3R4Lm1vdmVUbyhjeCAtIDE1MCwgeVBvcyk7CiAgICAgICAgICAgIGN0eC5saW5lVG8oY3ggKyAxNTAsIHlQb3MpOwogICAgICAgICAgICBjdHgubGluZVRvKGN4ICsgMjI1LCB5UG9zICsgKGRpciAqIDEyMCkpOwogICAgICAgICAgICBjdHgubGluZVRvKGN4IC0gMjI1LCB5UG9zICsgKGRpciAqIDEyMCkpOwogICAgICAgICAgICBjdHguY2xvc2VQYXRoKCk7CiAgICAgICAgICAgIGN0eC5zdHJva2UoKTsKICAgICAgICB9OwogICAgICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgICAgfTsKICAgICAgICBkcmF3R29hbEJveCg1MCwgMSk7IC8vIFRvcCAoSG9tZSBzaWRlIGluIHRleHR1cmUgc3BhY2UpCiAgICAgICAgZHJhd0dvYWxCb3goc2l6ZS01MCwgLTEpOyAvLyBCb3R0b20KCiAgICAgICAgLy8gNi4gUnVuZXMgKFByb2NlZHVyYWwgVGV4dCBSaW5nKQogICAgICAgIGN0eC5mb250ID0gJ2JvbGQgMzJweCBtb25vc3BhY2UnOwogICAgICAgIGN0eC5maWxsU3R5bGUgPSAncmdiYSgwLCAyNTUsIDI1NSwgMC43KSc7CiAgICAgICAgY3R4LnRleHRBbGlnbiA9ICdjZW50ZXInOwogICAgICAgIGN0eC50ZXh0QmFzZWxpbmUgPSAnbWlkZGxlJzsKICAgICAgICAKICAgICAgICBjb25zdCBydW5lcyA9ICJCTElUWkJBTEwgU1BIRVJFIFBPT0wgWkFOQVJLQU5EIEFCWVNTIEVURVJOQUwgQ0FMTSAiOwogICAgICAgIGNvbnN0IHJ1bmVDb3VudCA9IDMyOwogICAgICAgIGZvcihsZXQgaT0wOyBpPHJ1bmVDb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IGFuZ2xlID0gKGkgLyBydW5lQ291bnQpICogTWF0aC5QSSAqIDI7CiAgICAgICAgICAgIGNvbnN0IHIgPSA0ODA7CiAgICAgICAgICAgIGNvbnN0IHggPSBjeCArIE1hdGguY29zKGFuZ2xlKSAqIHI7CiAgICAgICAgICAgIGNvbnN0IHkgPSBjeSArIE1hdGguc2luKGFuZ2xlKSAqIHI7CiAgICAgICAgICAgIAogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICBjdHgudHJhbnNsYXRlKHgsIHkpOwogICAgICAgICAgICBjdHgucm90YXRlKGFuZ2xlICsgTWF0aC5QSS8yKTsKICAgICAgICAgICAgLy8gVXNlIGEgY2hhciBmcm9tIHRoZSBzdHJpbmcgb3IgcmFuZG9tIHJ1bmUtbGlrZSBjaGFyCiAgICAgICAgICAgIGNvbnN0IGNoYXIgPSBydW5lc1tpICUgcnVuZXMubGVuZ3RoXTsKICAgICAgICAgICAgY3R4LmZpbGxUZXh0KGNoYXIsIDAsIDApOwogICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgdGV4ID0gbmV3IFRIUkVFLkNhbnZhc1RleHR1cmUoYyk7CiAgICAgICAgdGV4LmFuaXNvdHJvcHkgPSAxNjsKCiAgICAgICAgLy8gRmxvb3IgUGxhbmUgKERlZXApCiAgICAgICAgY29uc3QgZ2VvID0gbmV3IFRIUkVFLlBsYW5lR2VvbWV0cnkoNjQsIDY0KTsKICAgICAgICBjb25zdCBtYXQgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoewogICAgICAgICAgICBtYXA6IHRleCwKICAgICAgICAgICAgdHJhbnNwYXJlbnQ6IHRydWUsCiAgICAgICAgICAgIG9wYWNpdHk6IDAuOCwKICAgICAgICAgICAgc2lkZTogVEhSRUUuRG91YmxlU2lkZSwKICAgICAgICAgICAgZGVwdGhXcml0ZTogZmFsc2UsCiAgICAgICAgICAgIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nCiAgICAgICAgfSk7CgogICAgICAgIGNvbnN0IGZpZWxkID0gbmV3IFRIUkVFLk1lc2goZ2VvLCBtYXQpOwogICAgICAgIGZpZWxkLnJvdGF0aW9uLnggPSAtTWF0aC5QSSAvIDI7CiAgICAgICAgZmllbGQucG9zaXRpb24ueSA9IC04LjA7IC8vIFN1bmsgZGVlcCBpbnRvIHRoZSBzcGhlcmUKICAgICAgICBfc2NlbmUuYWRkKGZpZWxkKTsKCiAgICAgICAgLy8gRmxvYXRpbmcgSG9sb2dyYXBoaWMgUmluZ3MgKE1pZC1oZWlnaHQpCiAgICAgICAgY29uc3QgcmluZ0dlbyA9IG5ldyBUSFJFRS5Ub3J1c0dlb21ldHJ5KDIwLCAwLjEsIDE2LCAxMDApOwogICAgICAgIGNvbnN0IHJpbmdNYXQgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyBjb2xvcjogMHgwMGZmZmYsIHRyYW5zcGFyZW50OiB0cnVlLCBvcGFjaXR5OiAwLjMsIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nIH0pOwogICAgICAgIGNvbnN0IHJpbmcxID0gbmV3IFRIUkVFLk1lc2gocmluZ0dlbywgcmluZ01hdCk7CiAgICAgICAgcmluZzEucm90YXRpb24ueCA9IE1hdGguUEkgLyAyOwogICAgICAgIHJpbmcxLnBvc2l0aW9uLnkgPSAwOwogICAgICAgIF9zY2VuZS5hZGQocmluZzEpOwogICAgICAgIAogICAgICAgIGNvbnN0IHJpbmcyID0gbmV3IFRIUkVFLk1lc2gocmluZ0dlbywgcmluZ01hdCk7CiAgICAgICAgcmluZzIucm90YXRpb24ueCA9IE1hdGguUEkgLyAyOwogICAgICAgIHJpbmcyLnNjYWxlLnNldFNjYWxhcigxLjIpOwogICAgICAgIHJpbmcyLnBvc2l0aW9uLnkgPSA0LjA7CiAgICAgICAgX3NjZW5lLmFkZChyaW5nMik7CgogICAgICAgIC8vIEFuaW1hdGUgUmluZ3MKICAgICAgICBjb25zdCBhbmltYXRlID0gKCkgPT4gewogICAgICAgICAgICBpZihyaW5nMSkgewogICAgICAgICAgICAgICAgcmluZzEucm90YXRpb24ueiArPSAwLjAwMTsKICAgICAgICAgICAgICAgIHJpbmcxLnNjYWxlLnNldFNjYWxhcigxLjAgKyBNYXRoLnNpbihEYXRlLm5vdygpKjAuMDAwNSkqMC4wNSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYocmluZzIpIHsKICAgICAgICAgICAgICAgIHJpbmcyLnJvdGF0aW9uLnogLT0gMC4wMDE1OwogICAgICAgICAgICAgICAgcmluZzIucG9zaXRpb24ueSA9IDQuMCArIE1hdGguY29zKERhdGUubm93KCkqMC4wMDA3KSoxLjA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIH07CiAgICAgICAgYW5pbWF0ZSgpOwogICAgfQoKICAgIC8vIC0tLSBJTlBVVCBTWVNURU0gLS0tCiAgICBjb25zdCBfaW5wdXQgPSB7IHg6IDAsIHk6IDAgfTsKICAgIGNvbnN0IF9haW1JbnB1dCA9IHsgeDogMCwgeTogMCwgYWN0aXZlOiBmYWxzZSB9OyAvLyBORVc6IEFpbSBqb3lzdGljawogICAgY29uc3QgX2tleXMgPSB7IHc6IGZhbHNlLCBhOiBmYWxzZSwgczogZmFsc2UsIGQ6IGZhbHNlLCBBcnJvd1VwOiBmYWxzZSwgQXJyb3dMZWZ0OiBmYWxzZSwgQXJyb3dEb3duOiBmYWxzZSwgQXJyb3dSaWdodDogZmFsc2UgfTsKCiAgICBjb25zdCBfYWN0aW9uQnVmZmVyID0geyBhY3RpdmU6IGZhbHNlLCB0aW1lc3RhbXA6IDAsIGR1cmF0aW9uOiAzMDAgfTsKCiAgICBjb25zdCBfY2FtRndkID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgIGNvbnN0IF9jYW1SaWdodCA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfdXBBeGlzID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMSwgMCk7CgogICAgZnVuY3Rpb24gc2V0dXBJbnB1dHMoKSB7CiAgICAgICAgLy8gS2V5Ym9hcmQKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChlKSA9PiB7CiAgICAgICAgICAgIF9rZXlzW2Uua2V5XSA9IHRydWU7CiAgICAgICAgICAgIGlmIChlLmNvZGUgPT09ICdTcGFjZScgJiYgX2hvbWVUZWFtICYmIF9ob21lVGVhbS5hY3RpdmVQbGF5ZXIgJiYgX2JhbGwpIHsKICAgICAgICAgICAgICAgIF9ob21lVGVhbS5hY3RpdmVQbGF5ZXIudGhyb3dCYWxsKF9iYWxsKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBORVc6IFRhY2tsZSBvbiBTaGlmdAogICAgICAgICAgICBpZiAoZS5jb2RlID09PSAnU2hpZnRMZWZ0JyB8fCBlLmNvZGUgPT09ICdTaGlmdFJpZ2h0JykgewogICAgICAgICAgICAgICAgaWYgKF9ob21lVGVhbSAmJiBfaG9tZVRlYW0uYWN0aXZlUGxheWVyKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IF9ob21lVGVhbS5hY3RpdmVQbGF5ZXI7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFwLmhhc0JhbGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcC5kYXNoKHAuaW5wdXRWZWN0b3IueCwgcC5pbnB1dFZlY3Rvci56KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdXBkYXRlSW5wdXRWZWN0b3IoKTsKICAgICAgICB9KTsKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCAoZSkgPT4geyBfa2V5c1tlLmtleV0gPSBmYWxzZTsgdXBkYXRlSW5wdXRWZWN0b3IoKTsgfSk7CgogICAgICAgIC8vIC0tLSBGTE9BVElORyBKT1lTVElDSyAoTW92ZW1lbnQpIC0tLQogICAgICAgIGNvbnN0IGhpdFpvbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnam95c3RpY2staGl0LXpvbmUnKTsKICAgICAgICBjb25zdCB2aXN1YWxzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pveXN0aWNrLXZpc3VhbC1jb250YWluZXInKTsKICAgICAgICBjb25zdCBiYXNlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pveXN0aWNrLWJhc2UnKTsKICAgICAgICBjb25zdCBrbm9iID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pveXN0aWNrLWtub2InKTsKCiAgICAgICAgbGV0IHN0YXJ0WCA9IDAsIHN0YXJ0WSA9IDA7CiAgICAgICAgbGV0IGRyYWdnaW5nID0gZmFsc2U7CiAgICAgICAgY29uc3QgbWF4RGlzdCA9IDQwOwoKICAgICAgICBjb25zdCBoYW5kbGVTdGFydCA9IChjbGllbnRYLCBjbGllbnRZKSA9PiB7CiAgICAgICAgICAgIGRyYWdnaW5nID0gdHJ1ZTsKICAgICAgICAgICAgc3RhcnRYID0gY2xpZW50WDsKICAgICAgICAgICAgc3RhcnRZID0gY2xpZW50WTsKCiAgICAgICAgICAgIHZpc3VhbHMuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgIHZpc3VhbHMuc3R5bGUubGVmdCA9IGAke2NsaWVudFh9cHhgOwogICAgICAgICAgICB2aXN1YWxzLnN0eWxlLnRvcCA9IGAke2NsaWVudFl9cHhgOwoKICAgICAgICAgICAga25vYi5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKC01MCUsIC01MCUpYDsKCiAgICAgICAgICAgIGNyZWF0ZVJpcHBsZShjbGllbnRYLCBjbGllbnRZKTsKCiAgICAgICAgICAgIF9pbnB1dC54ID0gMDsKICAgICAgICAgICAgX2lucHV0LnkgPSAwOwogICAgICAgICAgICB1cGRhdGVJbnB1dFZlY3RvcigpOwogICAgICAgIH07CgogICAgICAgIGNvbnN0IGhhbmRsZU1vdmUgPSAoY2xpZW50WCwgY2xpZW50WSkgPT4gewogICAgICAgICAgICBpZiAoIWRyYWdnaW5nKSByZXR1cm47CgogICAgICAgICAgICBsZXQgZHggPSBjbGllbnRYIC0gc3RhcnRYOwogICAgICAgICAgICBsZXQgZHkgPSBjbGllbnRZIC0gc3RhcnRZOwoKICAgICAgICAgICAgY29uc3QgZGlzdCA9IE1hdGguc3FydChkeCpkeCArIGR5KmR5KTsKCiAgICAgICAgICAgIGlmIChkaXN0ID4gbWF4RGlzdCkgewogICAgICAgICAgICAgICAgZHggPSAoZHggLyBkaXN0KSAqIG1heERpc3Q7CiAgICAgICAgICAgICAgICBkeSA9IChkeSAvIGRpc3QpICogbWF4RGlzdDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAga25vYi5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKGNhbGMoLTUwJSArICR7ZHh9cHgpLCBjYWxjKC01MCUgKyAke2R5fXB4KSlgOwoKICAgICAgICAgICAgX2lucHV0LnggPSAoZHggLyBtYXhEaXN0KSAqIF9zZXR0aW5ncy5qb3lzdGlja1NlbnNpdGl2aXR5OwogICAgICAgICAgICBfaW5wdXQueSA9IChkeSAvIG1heERpc3QpICogX3NldHRpbmdzLmpveXN0aWNrU2Vuc2l0aXZpdHk7CiAgICAgICAgICAgIHVwZGF0ZUlucHV0VmVjdG9yKCk7CiAgICAgICAgfTsKCiAgICAgICAgY29uc3QgaGFuZGxlRW5kID0gKCkgPT4gewogICAgICAgICAgICBpZiAoIWRyYWdnaW5nKSByZXR1cm47CiAgICAgICAgICAgIGRyYWdnaW5nID0gZmFsc2U7CgogICAgICAgICAgICB2aXN1YWxzLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgogICAgICAgICAgICBfaW5wdXQueCA9IDA7CiAgICAgICAgICAgIF9pbnB1dC55ID0gMDsKICAgICAgICAgICAgdXBkYXRlSW5wdXRWZWN0b3IoKTsKICAgICAgICB9OwoKICAgICAgICBpZiAoaGl0Wm9uZSkgewogICAgICAgICAgICBoaXRab25lLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCAoZSkgPT4gewogICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgaGFuZGxlU3RhcnQoZS50b3VjaGVzWzBdLmNsaWVudFgsIGUudG91Y2hlc1swXS5jbGllbnRZKTsKICAgICAgICAgICAgfSwgeyBwYXNzaXZlOiBmYWxzZSB9KTsKCiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCAoZSkgPT4gewogICAgICAgICAgICAgICAgaWYoZHJhZ2dpbmcpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZS5jYW5jZWxhYmxlKSBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgaGFuZGxlTW92ZShlLnRvdWNoZXNbMF0uY2xpZW50WCwgZS50b3VjaGVzWzBdLmNsaWVudFkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB7IHBhc3NpdmU6IGZhbHNlIH0pOwoKICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgaGFuZGxlRW5kKTsKCiAgICAgICAgICAgIGhpdFpvbmUuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgKGUpID0+IHsKICAgICAgICAgICAgICAgIGhhbmRsZVN0YXJ0KGUuY2xpZW50WCwgZS5jbGllbnRZKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCAoZSkgPT4gewogICAgICAgICAgICAgICAgaWYgKGRyYWdnaW5nKSBoYW5kbGVNb3ZlKGUuY2xpZW50WCwgZS5jbGllbnRZKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgaGFuZGxlRW5kKTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLSBORVc6IEFJTSBKT1lTVElDSyAoUmlnaHQgc2lkZSkgLS0tCiAgICAgICAgc2V0dXBBaW1Kb3lzdGljaygpOwoKICAgICAgICAvLyAtLS0gTkVXOiBUQUNLTEUgQlVUVE9OIC0tLQogICAgICAgIHNldHVwVGFja2xlQnV0dG9uKCk7CgogICAgICAgIC8vIFN3aXBlIERldGVjdGlvbgogICAgICAgIGxldCBzd2lwZVN0YXJ0ID0geyB4OiAwLCB5OiAwLCB0OiAwIH07CgogICAgICAgIGNvbnN0IG9uU3dpcGVTdGFydCA9ICh4LCB5KSA9PiB7CiAgICAgICAgICAgIHN3aXBlU3RhcnQueCA9IHg7CiAgICAgICAgICAgIHN3aXBlU3RhcnQueSA9IHk7CiAgICAgICAgICAgIHN3aXBlU3RhcnQudCA9IERhdGUubm93KCk7CiAgICAgICAgfTsKCiAgICAgICAgY29uc3Qgb25Td2lwZUVuZCA9ICh4LCB5KSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGR0ID0gRGF0ZS5ub3coKSAtIHN3aXBlU3RhcnQudDsKICAgICAgICAgICAgY29uc3QgZHggPSB4IC0gc3dpcGVTdGFydC54OwogICAgICAgICAgICBjb25zdCBkeSA9IHkgLSBzd2lwZVN0YXJ0Lnk7CiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLnNxcnQoZHgqZHggKyBkeSpkeSk7CgogICAgICAgICAgICBpZiAoZHQgPCAzMDAgJiYgZGlzdCA+IDMwKSB7CiAgICAgICAgICAgICAgICBpZiAoX2hvbWVUZWFtICYmIF9ob21lVGVhbS5hY3RpdmVQbGF5ZXIgJiYgX2NhbWVyYSkgewogICAgICAgICAgICAgICAgICAgIF9jYW1lcmEuZ2V0V29ybGREaXJlY3Rpb24oX2NhbUZ3ZCk7CiAgICAgICAgICAgICAgICAgICAgX2NhbUZ3ZC55ID0gMDsKICAgICAgICAgICAgICAgICAgICBpZiAoX2NhbUZ3ZC5sZW5ndGhTcSgpIDwgMC4wMDEpIF9jYW1Gd2Quc2V0KDAsIDAsIC0xKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIF9jYW1Gd2Qubm9ybWFsaXplKCk7CgogICAgICAgICAgICAgICAgICAgIF9jYW1SaWdodC5jcm9zc1ZlY3RvcnMoX2NhbUZ3ZCwgX3VwQXhpcykubm9ybWFsaXplKCk7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdvcmxkWCA9IChfY2FtUmlnaHQueCAqIGR4KSArIChfY2FtRndkLnggKiAtZHkpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdvcmxkWiA9IChfY2FtUmlnaHQueiAqIGR4KSArIChfY2FtRndkLnogKiAtZHkpOwoKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gX2hvbWVUZWFtLmFjdGl2ZVBsYXllcjsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHAuaXNUaHJvd2luZykgewogICAgICAgICAgICAgICAgICAgICAgICBwLnNldE92ZXJyaWRlQWltKHdvcmxkWCwgd29ybGRaKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIkFJTSEiLCBwLm1lc2gucG9zaXRpb24sICJkZWZhdWx0Iik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBwLmRhc2god29ybGRYLCB3b3JsZFopOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlUmlwcGxlKHgsIHkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgLy8gVG91Y2ggU3dpcGUgKGV4Y2x1ZGluZyBjb250cm9scykKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIChlKSA9PiB7CiAgICAgICAgICAgIGlmIChlLnRhcmdldC5jbG9zZXN0KCcjam95c3RpY2staGl0LXpvbmUnKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI2FjdGlvbi1idXR0b24nKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI3RhY2tsZS1idXR0b24nKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI2FpbS1qb3lzdGljay16b25lJykgfHwKICAgICAgICAgICAgICAgIGUudGFyZ2V0LmNsb3Nlc3QoJyNhdXRvLXRvZ2dsZScpIHx8CiAgICAgICAgICAgICAgICBlLnRhcmdldC5jbG9zZXN0KCcjc2V0dGluZ3MtYnV0dG9uJykpIHJldHVybjsKICAgICAgICAgICAgb25Td2lwZVN0YXJ0KGUudG91Y2hlc1swXS5jbGllbnRYLCBlLnRvdWNoZXNbMF0uY2xpZW50WSk7CiAgICAgICAgICAgIGNyZWF0ZVJpcHBsZShlLnRvdWNoZXNbMF0uY2xpZW50WCwgZS50b3VjaGVzWzBdLmNsaWVudFkpOwogICAgICAgIH0sIHsgcGFzc2l2ZTogZmFsc2UgfSk7CgogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIChlKSA9PiB7CiAgICAgICAgICAgIGlmIChlLnRhcmdldC5jbG9zZXN0KCcjam95c3RpY2staGl0LXpvbmUnKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI2FjdGlvbi1idXR0b24nKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI3RhY2tsZS1idXR0b24nKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI2FpbS1qb3lzdGljay16b25lJykgfHwKICAgICAgICAgICAgICAgIGUudGFyZ2V0LmNsb3Nlc3QoJyNhdXRvLXRvZ2dsZScpIHx8CiAgICAgICAgICAgICAgICBlLnRhcmdldC5jbG9zZXN0KCcjc2V0dGluZ3MtYnV0dG9uJykpIHJldHVybjsKICAgICAgICAgICAgb25Td2lwZUVuZChlLmNoYW5nZWRUb3VjaGVzWzBdLmNsaWVudFgsIGUuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vIE1vdXNlIFN3aXBlCiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIChlKSA9PiB7CiAgICAgICAgICAgIGlmIChlLnRhcmdldC5jbG9zZXN0KCcjam95c3RpY2staGl0LXpvbmUnKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI2FjdGlvbi1idXR0b24nKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI3RhY2tsZS1idXR0b24nKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI2FpbS1qb3lzdGljay16b25lJykgfHwKICAgICAgICAgICAgICAgIGUudGFyZ2V0LmNsb3Nlc3QoJyNhdXRvLXRvZ2dsZScpIHx8CiAgICAgICAgICAgICAgICBlLnRhcmdldC5jbG9zZXN0KCcjc2V0dGluZ3MtYnV0dG9uJykpIHJldHVybjsKICAgICAgICAgICAgb25Td2lwZVN0YXJ0KGUuY2xpZW50WCwgZS5jbGllbnRZKTsKICAgICAgICAgICAgY3JlYXRlUmlwcGxlKGUuY2xpZW50WCwgZS5jbGllbnRZKTsKICAgICAgICB9KTsKCiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCAoZSkgPT4gewogICAgICAgICAgICBpZiAoZS50YXJnZXQuY2xvc2VzdCgnI2pveXN0aWNrLWhpdC16b25lJykgfHwKICAgICAgICAgICAgICAgIGUudGFyZ2V0LmNsb3Nlc3QoJyNhY3Rpb24tYnV0dG9uJykgfHwKICAgICAgICAgICAgICAgIGUudGFyZ2V0LmNsb3Nlc3QoJyN0YWNrbGUtYnV0dG9uJykgfHwKICAgICAgICAgICAgICAgIGUudGFyZ2V0LmNsb3Nlc3QoJyNhaW0tam95c3RpY2stem9uZScpIHx8CiAgICAgICAgICAgICAgICBlLnRhcmdldC5jbG9zZXN0KCcjYXV0by10b2dnbGUnKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI3NldHRpbmdzLWJ1dHRvbicpKSByZXR1cm47CiAgICAgICAgICAgIG9uU3dpcGVFbmQoZS5jbGllbnRYLCBlLmNsaWVudFkpOwogICAgICAgIH0pOwoKICAgICAgICAvLyBBY3Rpb24gQnV0dG9uIChTaG9vdC9QYXNzKQogICAgICAgIGNvbnN0IGFjdGlvbkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY3Rpb24tYnV0dG9uJyk7CgogICAgICAgIGNvbnN0IHNldHVwQnV0dG9uID0gKGJ0bikgPT4gewogICAgICAgICAgICBpZiAoIWJ0bikgcmV0dXJuOwoKICAgICAgICAgICAgbGV0IGJ0blN0YXJ0WCA9IDA7CiAgICAgICAgICAgIGxldCBidG5TdGFydFkgPSAwOwogICAgICAgICAgICBsZXQgaXNEcmFnZ2luZyA9IGZhbHNlOwoKICAgICAgICAgICAgY29uc3QgYXR0ZW1wdEFjdGlvbiA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGlmICghX2hvbWVUZWFtIHx8ICFfaG9tZVRlYW0uYWN0aXZlUGxheWVyKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBjb25zdCBwID0gX2hvbWVUZWFtLmFjdGl2ZVBsYXllcjsKCiAgICAgICAgICAgICAgICBpZiAocC5oYXNCYWxsICYmICFwLmlzQ2hhcmdpbmcgJiYgIXAuaXNUaHJvd2luZyAmJiBwLnN0YXR1cy5uYXAgPD0gMCkgewogICAgICAgICAgICAgICAgICAgIHAuc3RhcnRDaGFyZ2UoKTsKICAgICAgICAgICAgICAgICAgICBidG4uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBjb25zdCBoYW5kbGVTdGFydCA9IChlKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoZS5jYW5jZWxhYmxlKSBlLnByZXZlbnREZWZhdWx0KCk7CgogICAgICAgICAgICAgICAgaWYgKF9nYW1lTWFuYWdlciAmJiBfZ2FtZU1hbmFnZXIudGVjaENvcHlTdGF0ZS5hY3RpdmUpIHsKICAgICAgICAgICAgICAgICAgICBfZ2FtZU1hbmFnZXIuYXR0ZW1wdFRlY2hDb3B5KCk7CiAgICAgICAgICAgICAgICAgICAgYnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gYnRuLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpLCAxMDApOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoX2dhbWVNYW5hZ2VyICYmIF9nYW1lTWFuYWdlci5pc0RlbW9Nb2RlKSByZXR1cm47CgogICAgICAgICAgICAgICAgY29uc3QgY2xpZW50WCA9IGUudG91Y2hlcyA/IGUudG91Y2hlc1swXS5jbGllbnRYIDogZS5jbGllbnRYOwogICAgICAgICAgICAgICAgY29uc3QgY2xpZW50WSA9IGUudG91Y2hlcyA/IGUudG91Y2hlc1swXS5jbGllbnRZIDogZS5jbGllbnRZOwogICAgICAgICAgICAgICAgYnRuU3RhcnRYID0gY2xpZW50WDsKICAgICAgICAgICAgICAgIGJ0blN0YXJ0WSA9IGNsaWVudFk7CiAgICAgICAgICAgICAgICBpc0RyYWdnaW5nID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICBfYWN0aW9uQnVmZmVyLmFjdGl2ZSA9IHRydWU7CiAgICAgICAgICAgICAgICBfYWN0aW9uQnVmZmVyLnRpbWVzdGFtcCA9IERhdGUubm93KCk7CgogICAgICAgICAgICAgICAgaWYgKGF0dGVtcHRBY3Rpb24oKSkgewogICAgICAgICAgICAgICAgICAgIF9hY3Rpb25CdWZmZXIuYWN0aXZlID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBjb25zdCBoYW5kbGVFbmQgPSAoZSkgPT4gewogICAgICAgICAgICAgICAgaWYgKGUuY2FuY2VsYWJsZSkgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgX2FjdGlvbkJ1ZmZlci5hY3RpdmUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGlzRHJhZ2dpbmcgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICBsZXQgZHggPSAwLCBkeSA9IDA7CgogICAgICAgICAgICAgICAgY29uc3QgY2xpZW50WCA9IGUuY2hhbmdlZFRvdWNoZXMgPyBlLmNoYW5nZWRUb3VjaGVzWzBdLmNsaWVudFggOiBlLmNsaWVudFg7CiAgICAgICAgICAgICAgICBjb25zdCBjbGllbnRZID0gZS5jaGFuZ2VkVG91Y2hlcyA/IGUuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WSA6IGUuY2xpZW50WTsKCiAgICAgICAgICAgICAgICBkeCA9IGNsaWVudFggLSBidG5TdGFydFg7CiAgICAgICAgICAgICAgICBkeSA9IGNsaWVudFkgLSBidG5TdGFydFk7CgogICAgICAgICAgICAgICAgaWYgKF9ob21lVGVhbSAmJiBfaG9tZVRlYW0uYWN0aXZlUGxheWVyKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IF9ob21lVGVhbS5hY3RpdmVQbGF5ZXI7CiAgICAgICAgICAgICAgICAgICAgaWYgKHAuaXNDaGFyZ2luZykgewogICAgICAgICAgICAgICAgICAgICAgICBwLnJlbGVhc2VDaGFyZ2UoZHgsIGR5KTsKICAgICAgICAgICAgICAgICAgICAgICAgYnRuLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgaGFuZGxlU3RhcnQsIHsgcGFzc2l2ZTogZmFsc2UgfSk7CiAgICAgICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBoYW5kbGVTdGFydCk7CiAgICAgICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIGhhbmRsZUVuZCk7CiAgICAgICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgaGFuZGxlRW5kKTsKICAgICAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbGVhdmUnLCBoYW5kbGVFbmQpOwogICAgICAgIH07CgogICAgICAgIHNldHVwQnV0dG9uKGFjdGlvbkJ0bik7CgogICAgICAgIC8vIEF1dG8gVG9nZ2xlCiAgICAgICAgY29uc3QgYXV0b0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhdXRvLXRvZ2dsZScpOwogICAgICAgIGlmIChhdXRvQnRuKSB7CiAgICAgICAgICAgIGNvbnN0IGhhbmRsZVRvZ2dsZSA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGlmIChfZ2FtZU1hbmFnZXIpIHsKICAgICAgICAgICAgICAgICAgICBfZ2FtZU1hbmFnZXIudG9nZ2xlRGVtb01vZGUoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoX2hvbWVUZWFtICYmIF9ob21lVGVhbS5hY3RpdmVQbGF5ZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2hvbWVUZWFtLmFjdGl2ZVBsYXllci5zZXRJbnB1dCgwLCAwKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBhdXRvQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlVG9nZ2xlKTsKICAgICAgICAgICAgYXV0b0J0bi5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgKGUpID0+IHsKICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIGhhbmRsZVRvZ2dsZSgpOwogICAgICAgICAgICB9LCB7IHBhc3NpdmU6IGZhbHNlIH0pOwogICAgICAgIH0KCiAgICAgICAgLy8gTkVXOiBTZXR0aW5ncyBCdXR0b24KICAgICAgICBzZXR1cFNldHRpbmdzQnV0dG9uKCk7CiAgICB9CgogICAgLy8gTkVXOiBBaW0gSm95c3RpY2sgU2V0dXAKICAgIGZ1bmN0aW9uIHNldHVwQWltSm95c3RpY2soKSB7CiAgICAgICAgY29uc3QgYWltWm9uZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhaW0tam95c3RpY2stem9uZScpOwogICAgICAgIGNvbnN0IGFpbVZpc3VhbHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWltLWpveXN0aWNrLXZpc3VhbCcpOwogICAgICAgIGNvbnN0IGFpbUtub2IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWltLWpveXN0aWNrLWtub2InKTsKCiAgICAgICAgaWYgKCFhaW1ab25lKSByZXR1cm47CgogICAgICAgIGxldCBhaW1TdGFydFggPSAwLCBhaW1TdGFydFkgPSAwOwogICAgICAgIGxldCBhaW1EcmFnZ2luZyA9IGZhbHNlOwogICAgICAgIGNvbnN0IGFpbU1heERpc3QgPSAzNTsKCiAgICAgICAgY29uc3QgaGFuZGxlQWltU3RhcnQgPSAoY2xpZW50WCwgY2xpZW50WSkgPT4gewogICAgICAgICAgICBhaW1EcmFnZ2luZyA9IHRydWU7CiAgICAgICAgICAgIGFpbVN0YXJ0WCA9IGNsaWVudFg7CiAgICAgICAgICAgIGFpbVN0YXJ0WSA9IGNsaWVudFk7CiAgICAgICAgICAgIF9haW1JbnB1dC5hY3RpdmUgPSB0cnVlOwoKICAgICAgICAgICAgaWYgKGFpbVZpc3VhbHMpIHsKICAgICAgICAgICAgICAgIGFpbVZpc3VhbHMuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgICAgICBhaW1WaXN1YWxzLnN0eWxlLmxlZnQgPSBgJHtjbGllbnRYfXB4YDsKICAgICAgICAgICAgICAgIGFpbVZpc3VhbHMuc3R5bGUudG9wID0gYCR7Y2xpZW50WX1weGA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGFpbUtub2IpIHsKICAgICAgICAgICAgICAgIGFpbUtub2Iuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSgtNTAlLCAtNTAlKWA7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBjb25zdCBoYW5kbGVBaW1Nb3ZlID0gKGNsaWVudFgsIGNsaWVudFkpID0+IHsKICAgICAgICAgICAgaWYgKCFhaW1EcmFnZ2luZykgcmV0dXJuOwoKICAgICAgICAgICAgbGV0IGR4ID0gY2xpZW50WCAtIGFpbVN0YXJ0WDsKICAgICAgICAgICAgbGV0IGR5ID0gY2xpZW50WSAtIGFpbVN0YXJ0WTsKCiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLnNxcnQoZHgqZHggKyBkeSpkeSk7CgogICAgICAgICAgICBpZiAoZGlzdCA+IGFpbU1heERpc3QpIHsKICAgICAgICAgICAgICAgIGR4ID0gKGR4IC8gZGlzdCkgKiBhaW1NYXhEaXN0OwogICAgICAgICAgICAgICAgZHkgPSAoZHkgLyBkaXN0KSAqIGFpbU1heERpc3Q7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChhaW1Lbm9iKSB7CiAgICAgICAgICAgICAgICBhaW1Lbm9iLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoY2FsYygtNTAlICsgJHtkeH1weCksIGNhbGMoLTUwJSArICR7ZHl9cHgpKWA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIE5vcm1hbGl6ZSBhbmQgdHJhbnNmb3JtIHRvIHdvcmxkIHNwYWNlCiAgICAgICAgICAgIF9haW1JbnB1dC54ID0gZHggLyBhaW1NYXhEaXN0OwogICAgICAgICAgICBfYWltSW5wdXQueSA9IGR5IC8gYWltTWF4RGlzdDsKCiAgICAgICAgICAgIC8vIEFwcGx5IGFpbSB0byBwbGF5ZXIgaWYgY2hhcmdpbmcKICAgICAgICAgICAgaWYgKF9ob21lVGVhbSAmJiBfaG9tZVRlYW0uYWN0aXZlUGxheWVyKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwID0gX2hvbWVUZWFtLmFjdGl2ZVBsYXllcjsKICAgICAgICAgICAgICAgIGlmIChwLmlzQ2hhcmdpbmcgfHwgcC5pc1Rocm93aW5nKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gVHJhbnNmb3JtIHNjcmVlbiBhaW0gdG8gd29ybGQgc3BhY2UKICAgICAgICAgICAgICAgICAgICBfY2FtZXJhLmdldFdvcmxkRGlyZWN0aW9uKF9jYW1Gd2QpOwogICAgICAgICAgICAgICAgICAgIF9jYW1Gd2QueSA9IDA7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9jYW1Gd2QubGVuZ3RoU3EoKSA8IDAuMDAxKSBfY2FtRndkLnNldCgwLCAwLCAtMSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBfY2FtRndkLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgICAgIF9jYW1SaWdodC5jcm9zc1ZlY3RvcnMoX2NhbUZ3ZCwgX3VwQXhpcykubm9ybWFsaXplKCk7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdvcmxkWCA9IChfY2FtUmlnaHQueCAqIF9haW1JbnB1dC54KSArIChfY2FtRndkLnggKiAtX2FpbUlucHV0LnkpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdvcmxkWiA9IChfY2FtUmlnaHQueiAqIF9haW1JbnB1dC54KSArIChfY2FtRndkLnogKiAtX2FpbUlucHV0LnkpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnMod29ybGRYKSA+IDAuMSB8fCBNYXRoLmFicyh3b3JsZFopID4gMC4xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHAuc2V0T3ZlcnJpZGVBaW0od29ybGRYLCB3b3JsZFopOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIGNvbnN0IGhhbmRsZUFpbUVuZCA9ICgpID0+IHsKICAgICAgICAgICAgaWYgKCFhaW1EcmFnZ2luZykgcmV0dXJuOwogICAgICAgICAgICBhaW1EcmFnZ2luZyA9IGZhbHNlOwogICAgICAgICAgICBfYWltSW5wdXQuYWN0aXZlID0gZmFsc2U7CiAgICAgICAgICAgIF9haW1JbnB1dC54ID0gMDsKICAgICAgICAgICAgX2FpbUlucHV0LnkgPSAwOwoKICAgICAgICAgICAgaWYgKGFpbVZpc3VhbHMpIHsKICAgICAgICAgICAgICAgIGFpbVZpc3VhbHMuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIGFpbVpvbmUuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIChlKSA9PiB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgaGFuZGxlQWltU3RhcnQoZS50b3VjaGVzWzBdLmNsaWVudFgsIGUudG91Y2hlc1swXS5jbGllbnRZKTsKICAgICAgICB9LCB7IHBhc3NpdmU6IGZhbHNlIH0pOwoKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgKGUpID0+IHsKICAgICAgICAgICAgaWYgKGFpbURyYWdnaW5nKSB7CiAgICAgICAgICAgICAgICBpZiAoZS5jYW5jZWxhYmxlKSBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICBoYW5kbGVBaW1Nb3ZlKGUudG91Y2hlc1swXS5jbGllbnRYLCBlLnRvdWNoZXNbMF0uY2xpZW50WSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7IHBhc3NpdmU6IGZhbHNlIH0pOwoKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCAoZSkgPT4gewogICAgICAgICAgICBpZiAoYWltRHJhZ2dpbmcpIHsKICAgICAgICAgICAgICAgIGhhbmRsZUFpbUVuZCgpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIC8vIE1vdXNlIHN1cHBvcnQgZm9yIGRlc2t0b3AgdGVzdGluZwogICAgICAgIGFpbVpvbmUuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgKGUpID0+IHsKICAgICAgICAgICAgaGFuZGxlQWltU3RhcnQoZS5jbGllbnRYLCBlLmNsaWVudFkpOwogICAgICAgIH0pOwogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCAoZSkgPT4gewogICAgICAgICAgICBpZiAoYWltRHJhZ2dpbmcpIGhhbmRsZUFpbU1vdmUoZS5jbGllbnRYLCBlLmNsaWVudFkpOwogICAgICAgIH0pOwogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgKGUpID0+IHsKICAgICAgICAgICAgaWYgKGFpbURyYWdnaW5nKSBoYW5kbGVBaW1FbmQoKTsKICAgICAgICB9KTsKICAgIH0KCiAgICAvLyBORVc6IFRhY2tsZSBCdXR0b24gU2V0dXAKICAgIGZ1bmN0aW9uIHNldHVwVGFja2xlQnV0dG9uKCkgewogICAgICAgIGNvbnN0IHRhY2tsZUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YWNrbGUtYnV0dG9uJyk7CiAgICAgICAgaWYgKCF0YWNrbGVCdG4pIHJldHVybjsKCiAgICAgICAgY29uc3QgaGFuZGxlVGFja2xlID0gKGUpID0+IHsKICAgICAgICAgICAgaWYgKGUuY2FuY2VsYWJsZSkgZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgaWYgKF9nYW1lTWFuYWdlciAmJiBfZ2FtZU1hbmFnZXIuaXNEZW1vTW9kZSkgcmV0dXJuOwoKICAgICAgICAgICAgaWYgKF9ob21lVGVhbSAmJiBfaG9tZVRlYW0uYWN0aXZlUGxheWVyKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwID0gX2hvbWVUZWFtLmFjdGl2ZVBsYXllcjsKCiAgICAgICAgICAgICAgICAvLyBJZiB3ZSBkb24ndCBoYXZlIHRoZSBiYWxsLCBkYXNoL3RhY2tsZQogICAgICAgICAgICAgICAgaWYgKCFwLmhhc0JhbGwpIHsKICAgICAgICAgICAgICAgICAgICAvLyBHZXQgY3VycmVudCBtb3ZlbWVudCBkaXJlY3Rpb24gb3IgZm9yd2FyZAogICAgICAgICAgICAgICAgICAgIGxldCBkYXNoWCA9IHAuaW5wdXRWZWN0b3IueDsKICAgICAgICAgICAgICAgICAgICBsZXQgZGFzaFogPSBwLmlucHV0VmVjdG9yLno7CgogICAgICAgICAgICAgICAgICAgIC8vIElmIG5vdCBtb3ZpbmcsIGRhc2ggZm9yd2FyZAogICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyhkYXNoWCkgPCAwLjEgJiYgTWF0aC5hYnMoZGFzaFopIDwgMC4xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZ3ZCA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIDEpLmFwcGx5UXVhdGVybmlvbihwLm1lc2gucXVhdGVybmlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhc2hYID0gZndkLng7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhc2haID0gZndkLno7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBwLmRhc2goZGFzaFgsIGRhc2haKTsKCiAgICAgICAgICAgICAgICAgICAgdGFja2xlQnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGFja2xlQnRuLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpLCAyMDApOwoKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJUQUNLTEUhIiwgcC5tZXNoLnBvc2l0aW9uLCAidGVjaCIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocC5pc0VuZ2FnZWQpIHsKICAgICAgICAgICAgICAgICAgICAvLyBCcmVhayB0YWNrbGUgaWYgZW5nYWdlZAogICAgICAgICAgICAgICAgICAgIHAuZGFzaChwLmlucHV0VmVjdG9yLngsIHAuaW5wdXRWZWN0b3Iueik7CiAgICAgICAgICAgICAgICAgICAgdGFja2xlQnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGFja2xlQnRuLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpLCAyMDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgdGFja2xlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBoYW5kbGVUYWNrbGUsIHsgcGFzc2l2ZTogZmFsc2UgfSk7CiAgICAgICAgdGFja2xlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGhhbmRsZVRhY2tsZSk7CiAgICB9CgogICAgLy8gTkVXOiBTZXR0aW5ncyBCdXR0b24gU2V0dXAKLy8gTkVXOiBTZXR0aW5ncyBCdXR0b24gU2V0dXAKICAgIGZ1bmN0aW9uIHNldHVwU2V0dGluZ3NCdXR0b24oKSB7CiAgICAgICAgY29uc3Qgc2V0dGluZ3NCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2V0dGluZ3MtYnV0dG9uJyk7CiAgICAgICAgY29uc3Qgc2V0dGluZ3NQYW5lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZXR0aW5ncy1wYW5lbCcpOwogICAgICAgIGNvbnN0IHNldHRpbmdzQ2xvc2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2V0dGluZ3MtY2xvc2UnKTsKCiAgICAgICAgaWYgKCFzZXR0aW5nc0J0biB8fCAhc2V0dGluZ3NQYW5lbCkgcmV0dXJuOwoKICAgICAgICBzZXR0aW5nc0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgc2V0dGluZ3NQYW5lbC5zdHlsZS5kaXNwbGF5ID0gc2V0dGluZ3NQYW5lbC5zdHlsZS5kaXNwbGF5ID09PSAnbm9uZScgPyAnYmxvY2snIDogJ25vbmUnOwogICAgICAgIH0pOwoKICAgICAgICBpZiAoc2V0dGluZ3NDbG9zZSkgewogICAgICAgICAgICBzZXR0aW5nc0Nsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICAgICAgc2V0dGluZ3NQYW5lbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIC8vIFNlbnNpdGl2aXR5IHNsaWRlcgogICAgICAgIGNvbnN0IHNlbnNpdGl2aXR5U2xpZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbnNpdGl2aXR5LXNsaWRlcicpOwogICAgICAgIGlmIChzZW5zaXRpdml0eVNsaWRlcikgewogICAgICAgICAgICBzZW5zaXRpdml0eVNsaWRlci52YWx1ZSA9IF9zZXR0aW5ncy5qb3lzdGlja1NlbnNpdGl2aXR5ICogMTAwOwogICAgICAgICAgICBzZW5zaXRpdml0eVNsaWRlci5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIChlKSA9PiB7CiAgICAgICAgICAgICAgICBfc2V0dGluZ3Muam95c3RpY2tTZW5zaXRpdml0eSA9IGUudGFyZ2V0LnZhbHVlIC8gMTAwOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIC8vIEFpbSBhc3Npc3QgdG9nZ2xlCiAgICAgICAgY29uc3QgYWltQXNzaXN0VG9nZ2xlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FpbS1hc3Npc3QtdG9nZ2xlJyk7CiAgICAgICAgaWYgKGFpbUFzc2lzdFRvZ2dsZSkgewogICAgICAgICAgICBhaW1Bc3Npc3RUb2dnbGUuY2hlY2tlZCA9IF9zZXR0aW5ncy5haW1Bc3Npc3Q7CiAgICAgICAgICAgIGFpbUFzc2lzdFRvZ2dsZS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4gewogICAgICAgICAgICAgICAgX3NldHRpbmdzLmFpbUFzc2lzdCA9IGUudGFyZ2V0LmNoZWNrZWQ7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgLy8gQ2FtZXJhIHNoYWtlIHRvZ2dsZQogICAgICAgIGNvbnN0IHNoYWtlVG9nZ2xlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NoYWtlLXRvZ2dsZScpOwogICAgICAgIGlmIChzaGFrZVRvZ2dsZSkgewogICAgICAgICAgICBzaGFrZVRvZ2dsZS5jaGVja2VkID0gX3NldHRpbmdzLmNhbWVyYVNoYWtlOwogICAgICAgICAgICBzaGFrZVRvZ2dsZS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4gewogICAgICAgICAgICAgICAgX3NldHRpbmdzLmNhbWVyYVNoYWtlID0gZS50YXJnZXQuY2hlY2tlZDsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICAvLyBWb2x1bWUgc2xpZGVyCiAgICAgICAgY29uc3Qgdm9sdW1lU2xpZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZvbHVtZS1zbGlkZXInKTsKICAgICAgICBpZiAodm9sdW1lU2xpZGVyICYmIF9hdWRpb01hbmFnZXIpIHsKICAgICAgICAgICAgdm9sdW1lU2xpZGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKGUpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHZvbCA9IGUudGFyZ2V0LnZhbHVlIC8gMTAwOwogICAgICAgICAgICAgICAgX2F1ZGlvTWFuYWdlci5zZXRWb2x1bWUodm9sKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICAvLyBFeGl0IHRvIE1lbnUKICAgICAgICBjb25zdCBleGl0QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4aXQtdG8tbWVudS1idG4nKTsKICAgICAgICBpZiAoZXhpdEJ0bikgewogICAgICAgICAgICBleGl0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKF9tZW51TWFuYWdlcikgewogICAgICAgICAgICAgICAgICAgIF9tZW51TWFuYWdlci5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9nYW1lTWFuYWdlcikgewogICAgICAgICAgICAgICAgICAgICAgICBfZ2FtZU1hbmFnZXIuc3RhdGUgPSAnbWVudSc7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN0b3AgcHJhY3RpY2UgaWYgcnVubmluZwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoX2dhbWVNYW5hZ2VyLnByYWN0aWNlTWFuYWdlcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2dhbWVNYW5hZ2VyLnByYWN0aWNlTWFuYWdlci5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVzZXQgY2FtZXJhIHRvIG1lbnUgb3JiaXQgaWYgbmVlZGVkCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfZ2FtZU1hbmFnZXIuY2FtZXJhTWFuYWdlcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gT3B0aW9uYWw6IFJlc2V0IGNhbWVyYSBwYXJhbWV0ZXJzCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NQYW5lbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gdXBkYXRlSW5wdXRWZWN0b3IoKSB7CiAgICAgICAgbGV0IHggPSBfaW5wdXQueCB8fCAwOwogICAgICAgIGxldCB6ID0gX2lucHV0LnkgfHwgMDsKCiAgICAgICAgaWYgKF9rZXlzWyd3J10gfHwgX2tleXNbJ0Fycm93VXAnXSkgeiAtPSAxOwogICAgICAgIGlmIChfa2V5c1sncyddIHx8IF9rZXlzWydBcnJvd0Rvd24nXSkgeiArPSAxOwogICAgICAgIGlmIChfa2V5c1snYSddIHx8IF9rZXlzWydBcnJvd0xlZnQnXSkgeCAtPSAxOwogICAgICAgIGlmIChfa2V5c1snZCddIHx8IF9rZXlzWydBcnJvd1JpZ2h0J10pIHggKz0gMTsKCiAgICAgICAgY29uc3QgbGVuU3EgPSB4KnggKyB6Kno7CiAgICAgICAgaWYgKGxlblNxID4gMSkgewogICAgICAgICAgICBjb25zdCBsZW4gPSBNYXRoLnNxcnQobGVuU3EpOwogICAgICAgICAgICB4IC89IGxlbjsKICAgICAgICAgICAgeiAvPSBsZW47CiAgICAgICAgfQoKICAgICAgICBpZiAoaXNOYU4oeCkpIHggPSAwOwogICAgICAgIGlmIChpc05hTih6KSkgeiA9IDA7CgogICAgICAgIGlmIChfY2FtZXJhKSB7CiAgICAgICAgICAgIF9jYW1lcmEuZ2V0V29ybGREaXJlY3Rpb24oX2NhbUZ3ZCk7CiAgICAgICAgICAgIF9jYW1Gd2QueSA9IDA7CgogICAgICAgICAgICBpZiAoX2NhbUZ3ZC5sZW5ndGhTcSgpIDwgMC4wMDEpIHsKICAgICAgICAgICAgICAgIF9jYW1Gd2Quc2V0KDAsIDAsIC0xKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIF9jYW1Gd2Qubm9ybWFsaXplKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9jYW1SaWdodC5jcm9zc1ZlY3RvcnMoX2NhbUZ3ZCwgX3VwQXhpcykubm9ybWFsaXplKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX2NhbUZ3ZC5zZXQoMCwgMCwgLTEpOwogICAgICAgICAgICBfY2FtUmlnaHQuc2V0KDEsIDAsIDApOwogICAgICAgIH0KCiAgICAgICAgbGV0IHdvcmxkWCA9IChfY2FtRndkLnggKiAteikgKyAoX2NhbVJpZ2h0LnggKiB4KTsKICAgICAgICBsZXQgd29ybGRaID0gKF9jYW1Gd2QueiAqIC16KSArIChfY2FtUmlnaHQueiAqIHgpOwoKICAgICAgICBpZiAoaXNOYU4od29ybGRYKSB8fCBpc05hTih3b3JsZFopKSB7CiAgICAgICAgICAgIHdvcmxkWCA9IDA7CiAgICAgICAgICAgIHdvcmxkWiA9IDA7CiAgICAgICAgfQoKICAgICAgICBpZiAoX2hvbWVUZWFtICYmIF9ob21lVGVhbS5hY3RpdmVQbGF5ZXIpIHsKICAgICAgICAgICAgaWYgKF9nYW1lTWFuYWdlciAmJiAhX2dhbWVNYW5hZ2VyLmlzRGVtb01vZGUpIHsKICAgICAgICAgICAgICAgIF9ob21lVGVhbS5hY3RpdmVQbGF5ZXIuc2V0SW5wdXQod29ybGRYLCB3b3JsZFopOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGNyZWF0ZVJpcHBsZSh4LCB5KSB7CiAgICAgICAgY29uc3QgcmlwcGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgcmlwcGxlLmNsYXNzTmFtZSA9ICd0b3VjaC1yaXBwbGUnOwogICAgICAgIHJpcHBsZS5zdHlsZS5sZWZ0ID0gYCR7eH1weGA7CiAgICAgICAgcmlwcGxlLnN0eWxlLnRvcCA9IGAke3l9cHhgOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1aS1sYXllcicpLmFwcGVuZENoaWxkKHJpcHBsZSk7CgogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICBpZiAocmlwcGxlLnBhcmVudE5vZGUpIHJpcHBsZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHJpcHBsZSk7CiAgICAgICAgfSwgNjAwKTsKICAgIH0KCmZ1bmN0aW9uIG9uUmVzaXplKCkgewogICAgICAgIGNvbnN0IHdpZHRoID0gd2luZG93LmlubmVyV2lkdGg7CiAgICAgICAgY29uc3QgaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0OwogICAgICAgIAogICAgICAgIGlmIChfY2FtZXJhKSB7CiAgICAgICAgICAgIF9jYW1lcmEuYXNwZWN0ID0gd2lkdGggLyBoZWlnaHQ7CiAgICAgICAgICAgIF9jYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBTdHJpY3RseSAwLjUwIGFzIHJlcXVlc3RlZAogICAgICAgIGNvbnN0IHJlc1NjYWxlID0gMC41MDsKICAgICAgICAKICAgICAgICBfY29uZmlnLmludGVybmFsV2lkdGggPSBNYXRoLmZsb29yKHdpZHRoICogcmVzU2NhbGUpOwogICAgICAgIF9jb25maWcuaW50ZXJuYWxIZWlnaHQgPSBNYXRoLmZsb29yKGhlaWdodCAqIHJlc1NjYWxlKTsKCiAgICAgICAgaWYgKF9yZW5kZXJlcikgewogICAgICAgICAgICBfcmVuZGVyZXIuc2V0U2l6ZShfY29uZmlnLmludGVybmFsV2lkdGgsIF9jb25maWcuaW50ZXJuYWxIZWlnaHQsIGZhbHNlKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CgogICAgICAgIGNvbnN0IHJhd0R0ID0gX2Nsb2NrLmdldERlbHRhKCk7CmNvbnN0IGR0ID0gcmF3RHQgKiAod2luZG93LmZsdXgudGltZVNjYWxlICE9PSB1bmRlZmluZWQgPyB3aW5kb3cuZmx1eC50aW1lU2NhbGUgOiAwLjgpOyAvLyBEZWZhdWx0IDgwJSBzcGVlZAoKICAgICAgICAvLyBJbXBhY3QgRnJhbWVzCiAgICAgICAgaWYgKF9nYW1lTWFuYWdlciAmJiBfZ2FtZU1hbmFnZXIuaW1wYWN0UGF1c2UgPiAwKSB7CiAgICAgICAgICAgIF9nYW1lTWFuYWdlci5pbXBhY3RQYXVzZSAtPSBkdDsKICAgICAgICAgICAgaWYgKF9yZW5kZXJlciAmJiBfc2NlbmUgJiYgX2NhbWVyYSkgewogICAgICAgICAgICAgICAgX3JlbmRlcmVyLnJlbmRlcihfc2NlbmUsIF9jYW1lcmEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHVwZGF0ZUlucHV0VmVjdG9yKCk7CgogICAgICAgIC8vIEFjdGlvbiBCdWZmZXIgUHJvY2Vzc2luZwogICAgICAgIGlmIChfYWN0aW9uQnVmZmVyLmFjdGl2ZSkgewogICAgICAgICAgICBpZiAoRGF0ZS5ub3coKSAtIF9hY3Rpb25CdWZmZXIudGltZXN0YW1wID4gX2FjdGlvbkJ1ZmZlci5kdXJhdGlvbikgewogICAgICAgICAgICAgICAgX2FjdGlvbkJ1ZmZlci5hY3RpdmUgPSBmYWxzZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChfaG9tZVRlYW0gJiYgX2hvbWVUZWFtLmFjdGl2ZVBsYXllcikgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBfaG9tZVRlYW0uYWN0aXZlUGxheWVyOwoKICAgICAgICAgICAgICAgICAgICBpZiAocC5oYXNCYWxsICYmICFwLmlzQ2hhcmdpbmcgJiYgIXAuaXNUaHJvd2luZyAmJiBwLnN0YXR1cy5uYXAgPD0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBwLnN0YXJ0Q2hhcmdlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY3Rpb24tYnV0dG9uJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChidG4pIGJ0bi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgX2FjdGlvbkJ1ZmZlci5hY3RpdmUgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIE1lbnUgU3RhdGUgSGFuZGxpbmcKICAgICAgICBpZiAoX2dhbWVNYW5hZ2VyICYmIF9nYW1lTWFuYWdlci5zdGF0ZSA9PT0gJ21lbnUnICYmIF9jYW1lcmEpIHsKICAgICAgICAgICAgY29uc3QgdGltZSA9IERhdGUubm93KCkgKiAwLjAwMDU7CiAgICAgICAgICAgIGNvbnN0IHJhZGl1cyA9IDUwOwogICAgICAgICAgICBfY2FtZXJhLnBvc2l0aW9uLnggPSBNYXRoLnNpbih0aW1lKSAqIHJhZGl1czsKICAgICAgICAgICAgX2NhbWVyYS5wb3NpdGlvbi56ID0gTWF0aC5jb3ModGltZSkgKiByYWRpdXM7CiAgICAgICAgICAgIF9jYW1lcmEucG9zaXRpb24ueSA9IDIwOwogICAgICAgICAgICBfY2FtZXJhLmxvb2tBdCgwLCAwLCAwKTsKCiAgICAgICAgICAgIGlmIChfcmVuZGVyZXIgJiYgX3NjZW5lKSB7CiAgICAgICAgICAgICAgICBfcmVuZGVyZXIucmVuZGVyKF9zY2VuZSwgX2NhbWVyYSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKF9nYW1lTWFuYWdlcikgX2dhbWVNYW5hZ2VyLnVwZGF0ZShkdCk7CgogICAgICAgIC8vIFVwZGF0ZSBFbnRpdGllcwogICAgICAgIGlmIChfaG9tZVRlYW0pIHsKICAgICAgICAgICAgX2hvbWVUZWFtLnVwZGF0ZShkdCk7CiAgICAgICAgICAgIF9ob21lVGVhbS5wbGF5ZXJzLmZvckVhY2gocCA9PiBjaGVja0JhbGxHcmFiKHApKTsKICAgICAgICB9CgogICAgICAgIGlmIChfYXdheVRlYW0pIHsKICAgICAgICAgICAgX2F3YXlUZWFtLnVwZGF0ZShkdCk7CiAgICAgICAgICAgIF9hd2F5VGVhbS5wbGF5ZXJzLmZvckVhY2gocCA9PiBjaGVja0JhbGxHcmFiKHApKTsKICAgICAgICB9CgogICAgICAgIGlmIChfYmFsbCkgewogICAgICAgICAgICBfYmFsbC51cGRhdGUoZHQpOwogICAgICAgIH0KCiAgICAgICAgLy8gVXBkYXRlIENhbWVyYQovLyBVcGRhdGUgQ2FtZXJhCiAgICAgICAgdXBkYXRlQ2FtZXJhTG9naWMoZHQpOwovLyBVcGRhdGUgVmlzdWFscwogICAgICAgIGlmIChfd2F0ZXJPdmVybGF5KSBfd2F0ZXJPdmVybGF5LnVwZGF0ZShkdCk7CiAgICAgICAgaWYgKF9saWdodFNoYWZ0cykgX2xpZ2h0U2hhZnRzLnVwZGF0ZShkdCk7CiAgICAgICAgaWYgKF9zdGFkaXVtKSBfc3RhZGl1bS51cGRhdGUoZHQpOwogICAgICAgIGlmIChfZ2x5cGhNYW5hZ2VyKSBfZ2x5cGhNYW5hZ2VyLnVwZGF0ZShkdCk7CgppZiAoX3JlbmRlcmVyICYmIF9zY2VuZSAmJiBfY2FtZXJhKSB7CiAgICAgICAgICAgIF9yZW5kZXJlci5yZW5kZXIoX3NjZW5lLCBfY2FtZXJhKTsKICAgICAgICB9CgogICAgICAgIC8vIFVJIFVwZGF0ZXMKICAgICAgICB1cGRhdGVVSSgpOwogICAgfQoKICAgIGZ1bmN0aW9uIHVwZGF0ZVVJKCkgewogICAgICAgIGlmICghX2hvbWVUZWFtIHx8ICFfaG9tZVRlYW0uYWN0aXZlUGxheWVyKSByZXR1cm47CgogICAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY3Rpb24tYnV0dG9uJyk7CiAgICAgICAgY29uc3QgbGJsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FjdGlvbi1sYWJlbCcpOwogICAgICAgIGNvbnN0IHRhY2tsZUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YWNrbGUtYnV0dG9uJyk7CiAgICAgICAgY29uc3QgcCA9IF9ob21lVGVhbS5hY3RpdmVQbGF5ZXI7CgogICAgICAgIGlmIChidG4gJiYgbGJsKSB7CiAgICAgICAgICAgIGNvbnN0IGJ0blRleHQgPSBidG4ucXVlcnlTZWxlY3RvcignLmJ0bi10ZXh0Jyk7CgogICAgICAgICAgICBpZiAocC5oYXNCYWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoYnRuVGV4dCAmJiBidG5UZXh0LmlubmVyVGV4dCAhPT0gIkFDVElPTiIpIHsKICAgICAgICAgICAgICAgICAgICBidG5UZXh0LmlubmVyVGV4dCA9ICJBQ1RJT04iOwogICAgICAgICAgICAgICAgICAgIGJ0bi5jbGFzc0xpc3QuYWRkKCdzaG9vdC1tb2RlJyk7CiAgICAgICAgICAgICAgICAgICAgbGJsLmlubmVyVGV4dCA9ICJPRkZFTlNFIjsKICAgICAgICAgICAgICAgICAgICBsYmwuY2xhc3NMaXN0LmFkZCgnc2hvb3QtbGFiZWwnKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCBpc0hpZ2hFbmVyZ3kgPSAocC5zdGF0cy5IUCAvIHAuc3RhdHMubWF4SFApID4gMC40OwogICAgICAgICAgICAgICAgaWYgKGlzSGlnaEVuZXJneSkgewogICAgICAgICAgICAgICAgICAgIGlmICghYnRuLmNsYXNzTGlzdC5jb250YWlucygnbGltaXQtcmVhZHknKSkgYnRuLmNsYXNzTGlzdC5hZGQoJ2xpbWl0LXJlYWR5Jyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChidG4uY2xhc3NMaXN0LmNvbnRhaW5zKCdsaW1pdC1yZWFkeScpKSBidG4uY2xhc3NMaXN0LnJlbW92ZSgnbGltaXQtcmVhZHknKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoYnRuVGV4dCAmJiBidG5UZXh0LmlubmVyVGV4dCAhPT0gIlNXSU0iKSB7CiAgICAgICAgICAgICAgICAgICAgYnRuVGV4dC5pbm5lclRleHQgPSAiU1dJTSI7CiAgICAgICAgICAgICAgICAgICAgYnRuLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob290LW1vZGUnKTsKICAgICAgICAgICAgICAgICAgICBidG4uY2xhc3NMaXN0LnJlbW92ZSgnbGltaXQtcmVhZHknKTsKICAgICAgICAgICAgICAgICAgICBsYmwuaW5uZXJUZXh0ID0gIk5PUk1BTCI7CiAgICAgICAgICAgICAgICAgICAgbGJsLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob290LWxhYmVsJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFVwZGF0ZSB0YWNrbGUgYnV0dG9uIHZpc2liaWxpdHkKICAgICAgICBpZiAodGFja2xlQnRuKSB7CiAgICAgICAgICAgIGlmICghcC5oYXNCYWxsIHx8IHAuaXNFbmdhZ2VkKSB7CiAgICAgICAgICAgICAgICB0YWNrbGVCdG4uc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0YWNrbGUgYnV0dG9uIHRleHQgYmFzZWQgb24gY29udGV4dAogICAgICAgICAgICAgICAgY29uc3QgdGFja2xlVGV4dCA9IHRhY2tsZUJ0bi5xdWVyeVNlbGVjdG9yKCcuYnRuLXRleHQnKTsKICAgICAgICAgICAgICAgIGlmICh0YWNrbGVUZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHAuaXNFbmdhZ2VkICYmIHAuaGFzQmFsbCkgewp0YWNrbGVUZXh0LmlubmVyVGV4dCA9ICdCUkVBSyc7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhY2tsZUJ0bi5jbGFzc0xpc3QuYWRkKCd1cmdlbnQnKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0YWNrbGVUZXh0LmlubmVyVGV4dCA9ICdUQUNLTEUnOwogICAgICAgICAgICAgICAgICAgICAgICB0YWNrbGVCdG4uY2xhc3NMaXN0LnJlbW92ZSgndXJnZW50Jyk7CiAgICAgICAgICAgICAgICAgICAgfQp9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0YWNrbGVCdG4uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gVXBkYXRlIGRpc3RhbmNlIHRvIGdvYWwgaW5kaWNhdG9yCiAgICAgICAgY29uc3QgZGlzdEluZGljYXRvciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnb2FsLWRpc3RhbmNlJyk7CiAgICAgICAgaWYgKGRpc3RJbmRpY2F0b3IgJiYgcC5tZXNoKSB7CiAgICAgICAgICAgIGNvbnN0IGdvYWxaID0gKHAudGVhbSAmJiBwLnRlYW0uc2lkZSA9PT0gMSkgPyAtMjggOiAyODsKICAgICAgICAgICAgY29uc3QgZGlzdCA9IE1hdGguYWJzKHAubWVzaC5wb3NpdGlvbi56IC0gZ29hbFopOwogICAgICAgICAgICBkaXN0SW5kaWNhdG9yLmlubmVyVGV4dCA9IGAke01hdGguZmxvb3IoZGlzdCl9bWA7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHVwZGF0ZUNhbWVyYUxvZ2ljKGR0KSB7CiAgICAgICAgaWYgKCFfY2FtZXJhTWFuYWdlciB8fCAhX2JhbGwpIHJldHVybjsKCiAgICAgICAgbGV0IHRhcmdldE1lc2ggPSBfYmFsbC5tZXNoOwogICAgICAgIGxldCB0YXJnZXRWZWwgPSBfYmFsbC52ZWxvY2l0eTsKICAgICAgICBsZXQgdGFyZ2V0SW5wdXQgPSBudWxsOwoKICAgICAgICBpZiAoX2JhbGwuaG9sZGVyICYmIF9iYWxsLmhvbGRlci5tZXNoKSB7CiAgICAgICAgICAgIHRhcmdldE1lc2ggPSBfYmFsbC5ob2xkZXIubWVzaDsKICAgICAgICAgICAgdGFyZ2V0VmVsID0gX2JhbGwuaG9sZGVyLnZlbG9jaXR5OwogICAgICAgICAgICBpZiAoX2JhbGwuaG9sZGVyLmlucHV0VmVjdG9yKSB7CiAgICAgICAgICAgICAgICB0YXJnZXRJbnB1dCA9IF9iYWxsLmhvbGRlci5pbnB1dFZlY3RvcjsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX2NhbWVyYU1hbmFnZXIuc2V0VGFyZ2V0KHRhcmdldE1lc2gsIHRhcmdldFZlbCwgdGFyZ2V0SW5wdXQpOwogICAgICAgIF9jYW1lcmFNYW5hZ2VyLnVwZGF0ZShkdCk7CiAgICB9CgpmdW5jdGlvbiBjaGVja0JhbGxHcmFiKGVudGl0eSkgewogICAgICAgIGlmICghZW50aXR5LmNhbkNhdGNoKSByZXR1cm47CiAgICAgICAgaWYgKF9iYWxsICYmICFfYmFsbC5pc0NhdGNoYWJsZSgpKSByZXR1cm47CiAgICAgICAgaWYgKGVudGl0eS5zdHVuVGltZXIgPiAwIHx8IChlbnRpdHkuc3RhdHVzICYmIGVudGl0eS5zdGF0dXMubmFwID4gMCkpIHJldHVybjsKICAgICAgICBpZiAoX2JhbGwuc3RhdGUgIT09ICdmcmVlJykgcmV0dXJuOwogICAgICAgIGlmICghX2JhbGwubWVzaCB8fCAhZW50aXR5Lm1lc2gpIHJldHVybjsKCiAgICAgICAgY29uc3QgYmFsbFBvcyA9IF9iYWxsLm1lc2gucG9zaXRpb247CiAgICAgICAgY29uc3QgZW50UG9zID0gZW50aXR5Lm1lc2gucG9zaXRpb247CgogICAgICAgIGNvbnN0IGR4ID0gYmFsbFBvcy54IC0gZW50UG9zLng7CiAgICAgICAgY29uc3QgZHogPSBiYWxsUG9zLnogLSBlbnRQb3MuejsKICAgICAgICBjb25zdCBkaXN0WFogPSBNYXRoLnNxcnQoZHgqZHggKyBkeipkeik7CiAgICAgICAgY29uc3QgZGlzdFkgPSBNYXRoLmFicyhiYWxsUG9zLnkgLSBlbnRQb3MueSk7CgogICAgICAgIGNvbnN0IHRvdWNoUmFkaXVzID0gMS4wOyAvLyBSZWR1Y2VkIGZyb20gMS41CiAgICAgICAgLy8gUmVkdWNlZCByYWRpaSB0byBwcmV2ZW50ICJJbnZpc2libGUgV2FsbCIgY2F0Y2ggc25hcHBpbmcKICAgICAgICBsZXQgbWFnbmV0UmFkaXVzID0gMS44OyAvLyBSZWR1Y2VkIGZyb20gMi41CiAgICAgICAgbGV0IGludGVyYWN0aW9uUmFkaXVzID0gMy41OyAvLyBSZWR1Y2VkIGZyb20gNC4wCiAgICAgICAgbGV0IGNhdGNoSGVpZ2h0ID0gMy4wOyAvLyBSZWR1Y2VkIGZyb20gMy41CgogICAgICAgIGlmIChlbnRpdHkuaXNEYXNoaW5nKSB7CiAgICAgICAgICAgIG1hZ25ldFJhZGl1cyA9IDMuMDsKICAgICAgICAgICAgaW50ZXJhY3Rpb25SYWRpdXMgPSA0LjU7CiAgICAgICAgICAgIGNhdGNoSGVpZ2h0ID0gNC41OwogICAgICAgIH0KCiAgICAgICAgaWYgKGRpc3RYWiA+IGludGVyYWN0aW9uUmFkaXVzIHx8IGRpc3RZID4gY2F0Y2hIZWlnaHQpIHJldHVybjsKCiAgICAgICAgY29uc3QgdG9CYWxsID0gYmFsbFBvcy5jbG9uZSgpLnN1YihlbnRQb3MpLm5vcm1hbGl6ZSgpOwogICAgICAgIGNvbnN0IHBsYXllckZvcndhcmQgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAxKS5hcHBseVF1YXRlcm5pb24oZW50aXR5Lm1lc2gucXVhdGVybmlvbikubm9ybWFsaXplKCk7CgogICAgICAgIGNvbnN0IGZhY2luZ0RvdCA9IHBsYXllckZvcndhcmQuZG90KHRvQmFsbCk7CgogICAgICAgIGNvbnN0IGNvbmVUaHJlc2hvbGQgPSAtMC4yOwogICAgICAgIGNvbnN0IGlzSW5Db25lID0gZmFjaW5nRG90ID4gY29uZVRocmVzaG9sZDsKICAgICAgICBjb25zdCBpc0luVG91Y2ggPSBkaXN0WFogPCB0b3VjaFJhZGl1czsKCiAgICAgICAgaWYgKGRpc3RYWiA8IGludGVyYWN0aW9uUmFkaXVzICYmICFpc0luQ29uZSkgewogICAgICAgICAgICBjb25zdCB0YXJnZXRBbmdsZSA9IE1hdGguYXRhbjIodG9CYWxsLngsIHRvQmFsbC56KTsKICAgICAgICAgICAgY29uc3QgcSA9IG5ldyBUSFJFRS5RdWF0ZXJuaW9uKCkuc2V0RnJvbUF4aXNBbmdsZShuZXcgVEhSRUUuVmVjdG9yMygwLDEsMCksIHRhcmdldEFuZ2xlKTsKICAgICAgICAgICAgZW50aXR5Lm1lc2gucXVhdGVybmlvbi5zbGVycChxLCAwLjEpOwogICAgICAgICAgICBpZiAoZW50aXR5LnN5bmNSb3RhdGlvbikgZW50aXR5LnN5bmNSb3RhdGlvbigpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzSW5Ub3VjaCB8fCAoZGlzdFhaIDwgbWFnbmV0UmFkaXVzICYmIGlzSW5Db25lKSkgewogICAgICAgICAgICAvLyBCTEFTVCBUSFJPVUdIIExPR0lDCiAgICAgICAgICAgIGNvbnN0IGJhbGxTcGVlZCA9IF9iYWxsLnZlbG9jaXR5Lmxlbmd0aCgpOwogICAgICAgICAgICBsZXQgY2F0Y2hDaGFuY2UgPSAxLjA7CgogICAgICAgICAgICAvLyBJZiBiYWxsIGlzIG1vdmluZyBmYXN0IChlLmcuID4gMjApLCBjaGVjayBDQQogICAgICAgICAgICBpZiAoYmFsbFNwZWVkID4gMjAuMCkgewogICAgICAgICAgICAgICAgY29uc3QgY2EgPSBlbnRpdHkuZ2V0U3RhdCgnQ0EnKTsKICAgICAgICAgICAgICAgIC8vIERpZmZpY3VsdHkgc2NhbGVzIHdpdGggc3BlZWQuIAogICAgICAgICAgICAgICAgY29uc3QgZGlmZmljdWx0eSA9IGJhbGxTcGVlZCAqIDEuMjsgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChkaWZmaWN1bHR5ID4gY2EpIHsKICAgICAgICAgICAgICAgICAgICBjYXRjaENoYW5jZSA9IDAuNCArIChjYSAvIGRpZmZpY3VsdHkpICogMC42OwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFBvaW50IEJsYW5rIFBlbmFsdHk6IEhhcmRlciB0byByZWFjdCBpZiBiYWxsIGlzIHJpZ2h0IG9uIHRvcCBvZiB5b3UgbW92aW5nIGZhc3QKICAgICAgICAgICAgICAgICAgICBpZiAoZGlzdFhaIDwgMS4yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoQ2hhbmNlICo9IDAuNjsgLy8gQmxhc3QgdGhyb3VnaCBsaWtlbHkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKGVudGl0eS5pc0Rhc2hpbmcpIGNhdGNoQ2hhbmNlICs9IDAuMjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChfYmFsbC5wb3dlclR5cGUgPT09ICdTSCcgJiYgX2JhbGwucG93ZXIgPiAxNS4wKSB7CiAgICAgICAgICAgICAgICAvLyBTaG90IHBvd2VyIGNoZWNrCiAgICAgICAgICAgICAgICBjb25zdCBjYSA9IGVudGl0eS5nZXRTdGF0KCdDQScpOwogICAgICAgICAgICAgICAgaWYgKF9iYWxsLnBvd2VyID4gY2EgKiAxLjIpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGFuY2UgPSBNYXRoLm1pbigwLjcsIChfYmFsbC5wb3dlciAtIGNhKSAqIDAuMDQpOwogICAgICAgICAgICAgICAgICAgIGNhdGNoQ2hhbmNlID0gMS4wIC0gY2hhbmNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBsZXQgZnVtYmxlID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChNYXRoLnJhbmRvbSgpID4gY2F0Y2hDaGFuY2UpIHsKICAgICAgICAgICAgICAgIGZ1bWJsZSA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmdW1ibGUpIHsKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgLy8gVmlzdWFsIGZlZWRiYWNrIGZvciBibGFzdCB0aHJvdWdoCiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dC5zcGF3bigiQkxBU1QgVEhST1VHSCEiLCBlbnRQb3MsICJkYW1hZ2UiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRGVmbGVjdCBzbGlnaHRseSBidXQga2VlcCBtb3ZpbmcgZmFzdCAoQmxhc3QgVGhyb3VnaCkKICAgICAgICAgICAgICAgIC8vIERvbid0IHN0b3AgaXQgY29tcGxldGVseSBsaWtlIGEgYmxvY2ssIGp1c3QgcGVydHVyYiBpdAogICAgICAgICAgICAgICAgX2JhbGwudmVsb2NpdHkubXVsdGlwbHlTY2FsYXIoMC44NSk7IAogICAgICAgICAgICAgICAgX2JhbGwudmVsb2NpdHkueCArPSAoTWF0aC5yYW5kb20oKS0wLjUpICogNS4wOwogICAgICAgICAgICAgICAgX2JhbGwudmVsb2NpdHkueSArPSAoTWF0aC5yYW5kb20oKSkgKiA1LjA7IC8vIFBvcCB1cAogICAgICAgICAgICAgICAgX2JhbGwudmVsb2NpdHkueiArPSAoTWF0aC5yYW5kb20oKS0wLjUpICogNS4wOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfYmFsbC5wb3dlciAqPSAwLjc7CgogICAgICAgICAgICAgICAgZW50aXR5LmNhbkNhdGNoID0gZmFsc2U7CiAgICAgICAgICAgICAgICAvLyBTdHVuIGJyaWVmbHkKICAgICAgICAgICAgICAgIGVudGl0eS5zdHVuVGltZXIgPSAwLjU7CiAgICAgICAgICAgICAgICBpZihlbnRpdHkucGxheSkgZW50aXR5LnBsYXkoJ3JlYWN0JywgMC4xKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7IGVudGl0eS5jYW5DYXRjaCA9IHRydWU7IH0sIDEwMDApOwoKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIF9iYWxsLm1hZ25ldGl6ZShlbnRpdHkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vIFN0YXJ0CiAgICBpbml0KCk7Cn0pKCk7Cg==","/main.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgLy8gTmFtZXNwYWNlCiAgICB3aW5kb3cuZmx1eCA9IHdpbmRvdy5mbHV4IHx8IHt9OwoKICAgIC8vIENvbmZpZwpjb25zdCBfY29uZmlnID0gewogICAgICAgIGludGVybmFsV2lkdGg6IDM2MCwKICAgICAgICBpbnRlcm5hbEhlaWdodDogNjQwLAogICAgICAgIGJnQ29sb3I6IDB4MDAxZTM2LAogICAgICAgIGZvZ0NvbG9yOiAweDAwMWUzNiwKICAgICAgICBmb2dEZW5zaXR5OiAwLjAwMDEsIC8vIERyYXN0aWNhbGx5IHJlZHVjZWQgdG8gZW5zdXJlIHZpc2liaWxpdHkKICAgICAgICBhcmVuYVJhZGl1czogMzIuMAogICAgfTsKCiAgICAvLyBHbG9iYWxzCiAgICBsZXQgX3NjZW5lLCBfY2FtZXJhLCBfcmVuZGVyZXIsIF9jbG9jazsKICAgIGxldCBfaG9tZVRlYW0sIF9hd2F5VGVhbTsKbGV0IF9iYWxsOwogICAgbGV0IF9nYW1lTWFuYWdlcjsKICAgIGxldCBfbWVudU1hbmFnZXI7CgpsZXQgX2NhbWVyYU1hbmFnZXI7CiAgICBsZXQgX3dhdGVyT3ZlcmxheTsKICAgIGxldCBfbGlnaHRTaGFmdHM7CiAgICBsZXQgX3N0YWRpdW07CiAgICBsZXQgX2dseXBoTWFuYWdlcjsKCiAgICAvLyBJTVBST1ZFRDogU2V0dGluZ3Mgb2JqZWN0CiAgICBjb25zdCBfc2V0dGluZ3MgPSB7CiAgICAgICAgam95c3RpY2tTZW5zaXRpdml0eTogMS4wLAogICAgICAgIGFpbUFzc2lzdDogdHJ1ZSwKICAgICAgICBjYW1lcmFTaGFrZTogdHJ1ZSwKICAgICAgICBoaXRTdG9wOiB0cnVlLAogICAgICAgIGludmVydENhbWVyYTogZmFsc2UsCiAgICAgICAgYXV0b1JlY2VudGVyOiB0cnVlCiAgICB9OwoKICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgX2NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYW1lLWNvbnRhaW5lcicpOwoKICAgICAgICAvLyAxLiBTY2VuZQogICAgICAgIF9zY2VuZSA9IG5ldyBUSFJFRS5TY2VuZSgpOwogICAgICAgIF9zY2VuZS5iYWNrZ3JvdW5kID0gbmV3IFRIUkVFLkNvbG9yKF9jb25maWcuYmdDb2xvcik7CiAgICAgICAgX3NjZW5lLmZvZyA9IG5ldyBUSFJFRS5Gb2dFeHAyKF9jb25maWcuZm9nQ29sb3IsIF9jb25maWcuZm9nRGVuc2l0eSk7CgogICAgICAgIC8vIDIuIENhbWVyYQogICAgICAgIGNvbnN0IGFzcGVjdCA9IF9jb25maWcuaW50ZXJuYWxXaWR0aCAvIF9jb25maWcuaW50ZXJuYWxIZWlnaHQ7Cl9jYW1lcmEgPSBuZXcgVEhSRUUuUGVyc3BlY3RpdmVDYW1lcmEoNjAsIGFzcGVjdCwgMC4xLCA1MDApOwpfY2FtZXJhLnBvc2l0aW9uLnNldCgwLCAxNCwgMjIpOwogICAgICAgIF9jYW1lcmEubG9va0F0KDAsIDAsIDApOwogICAgICAgIF9zY2VuZS5hZGQoX2NhbWVyYSk7IC8vIEVuc3VyZSBjYW1lcmEgaXMgaW4gc2NlbmUgZm9yIGNoaWxkcmVuIHRvIHJlbmRlcgoKICAgICAgICAvLyAzLiBSZW5kZXJlcgpfcmVuZGVyZXIgPSBuZXcgVEhSRUUuV2ViR0xSZW5kZXJlcih7IGFudGlhbGlhczogZmFsc2UgfSk7CiAgICAgICAgLy8gRXhwb3NlIHJlbmRlcmVyIGZvciBEZXZUb29scwogICAgICAgIGlmIChfZ2FtZU1hbmFnZXIpIF9nYW1lTWFuYWdlci5yZW5kZXJlciA9IF9yZW5kZXJlcjsgCiAgICAgICAgZWxzZSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UgPSB7IHJlbmRlcmVyOiBfcmVuZGVyZXIgfTsgLy8gVGVtcCBob29rCl9jb250YWluZXIuYXBwZW5kQ2hpbGQoX3JlbmRlcmVyLmRvbUVsZW1lbnQpOwoKICAgICAgICAvLyAtLS0gVmlkZW8gT3ZlcmxheSBFbmZvcmNlbWVudCAtLS0KLy8gLS0tIE92ZXJsYXkgVmlkZW8gTG9naWMgUmVtb3ZlZCAoU3dpdGNoZWQgdG8gR0lGKSAtLS0KICAgICAgICAvLyA1LiBFbnZpcm9ubWVudAogICAgICAgIGNyZWF0ZVBhcnRpY2xlcygpOwogICAgICAgIGNyZWF0ZUFyZW5hKCk7CgovLyA1LjUgR2FtZSBNYW5hZ2VyCl9nYW1lTWFuYWdlciA9IG5ldyB3aW5kb3cuZmx1eC5HYW1lTWFuYWdlcihfc2NlbmUsICd1aS1sYXllcicsIF9jYW1lcmEsIF9yZW5kZXJlcik7CiAgICAgICAgCiAgICAgICAgLy8gNS41LjEgQXVkaW8gTWFuYWdlcgogICAgICAgIF9hdWRpb01hbmFnZXIgPSBuZXcgd2luZG93LmZsdXguQXVkaW9NYW5hZ2VyKCk7CiAgICAgICAgX2dhbWVNYW5hZ2VyLmF1ZGlvTWFuYWdlciA9IF9hdWRpb01hbmFnZXI7CgogICAgICAgIC8vIDUuNiBDYW1lcmEgTWFuYWdlcgogICAgICAgIF9jYW1lcmFNYW5hZ2VyID0gbmV3IHdpbmRvdy5mbHV4LkNhbWVyYU1hbmFnZXIoX2NhbWVyYSwgX3NjZW5lKTsKICAgICAgICBfZ2FtZU1hbmFnZXIuY2FtZXJhTWFuYWdlciA9IF9jYW1lcmFNYW5hZ2VyOwoKICAgICAgICAvLyA1LjcgRGV2IFRvb2xzCmlmICh3aW5kb3cuZmx1eC5EZXZUb29scykgewogICAgICAgICAgICBuZXcgd2luZG93LmZsdXguRGV2VG9vbHMoX2dhbWVNYW5hZ2VyKTsKICAgICAgICB9Ci8vIDUuOCBXYXRlciBPdmVybGF5LCBMaWdodCBTaGFmdHMsIFN0YWRpdW0sIEdseXBocwogICAgICAgIF93YXRlck92ZXJsYXkgPSBuZXcgd2luZG93LmZsdXguV2F0ZXJPdmVybGF5KF9jYW1lcmEpOwogICAgICAgIF9saWdodFNoYWZ0cyA9IG5ldyB3aW5kb3cuZmx1eC5MaWdodFNoYWZ0cyhfc2NlbmUpOwogICAgICAgIF9zdGFkaXVtID0gbmV3IHdpbmRvdy5mbHV4LlN0YWRpdW0oX3NjZW5lKTsKICAgICAgICBfZ2x5cGhNYW5hZ2VyID0gbmV3IHdpbmRvdy5mbHV4LkdseXBoTWFuYWdlcihfc2NlbmUpOwogICAgICAgIAppZiAoX2dhbWVNYW5hZ2VyKSB7CiAgICAgICAgICAgIF9nYW1lTWFuYWdlci5nbHlwaE1hbmFnZXIgPSBfZ2x5cGhNYW5hZ2VyOwogICAgICAgICAgICBfZ2FtZU1hbmFnZXIud2F0ZXJPdmVybGF5ID0gX3dhdGVyT3ZlcmxheTsKICAgICAgICAgICAgX2dhbWVNYW5hZ2VyLmxpZ2h0U2hhZnRzID0gX2xpZ2h0U2hhZnRzOwogICAgICAgICAgICBfZ2FtZU1hbmFnZXIuc3RhZGl1bSA9IF9zdGFkaXVtOwogICAgICAgIH0KICAgICAgICAvLyA2LiBUZWFtcyBTZXR1cAogICAgICAgIF9ob21lVGVhbSA9IG5ldyB3aW5kb3cuZmx1eC5UZWFtKF9zY2VuZSwgJ2hvbWUnLCAxLCAweDAwYWFmZiwgdHJ1ZSk7CiAgICAgICAgX2F3YXlUZWFtID0gbmV3IHdpbmRvdy5mbHV4LlRlYW0oX3NjZW5lLCAnYXdheScsIC0xLCAweGZmNjY2NiwgZmFsc2UpOwoKICAgICAgICAvLyA3LiBCYWxsCiAgICAgICAgX2JhbGwgPSBuZXcgd2luZG93LmZsdXguQmFsbChfc2NlbmUpOwoKICAgICAgICAvLyBJTVBST1ZFRDogTGluayBiYWxsIHRvIGNhbWVyYSBmb3Igc21hcnQgZnJhbWluZwogICAgICAgIF9jYW1lcmFNYW5hZ2VyLnNldEJhbGwoX2JhbGwpOwoKICAgICAgICAvLyA4LiBUZWFtIFJvc3RlciBNb2RlbHMKICAgICAgICBjb25zdCByb2xlcyA9IFsnTEYnLCAnUkYnLCAnTUYnLCAnTEQnLCAnUkQnLCAnR0wnXTsKICAgICAgICBjb25zdCBob21lUm9zdGVyID0gewogICAgICAgICAgICBMRjogeyBuYW1lOiAnVGlkdXMnLCB1cmw6ICdodHRwczovL2Nkbi50aW55Z2xiLmNvbS9tb2RlbHMvZGE3ODhiZWYyNThjNGYwYjhkOWVmMWFjYzE5YzU1NjcuZ2xiJyB9LAogICAgICAgICAgICBSRjogeyBuYW1lOiAnV2Fra2EnLCB1cmw6ICdodHRwczovL2Nkbi50aW55Z2xiLmNvbS9tb2RlbHMvNTkxMTRjOTg5NTE2NDdjOWI4ZGE3NGIwYmQzNjM2Y2IuZ2xiJyB9LAogICAgICAgICAgICBNRjogeyBuYW1lOiAnTGV0dHknLCB1cmw6ICdodHRwczovL2Nkbi50aW55Z2xiLmNvbS9tb2RlbHMvNDNhY2UzNGM2ZmQ5NDIxNTk2N2U4NDJiZjkwOWRhNWUuZ2xiJyB9LAogICAgICAgICAgICBMRDogeyBuYW1lOiAnRGF0dG8nLCB1cmw6ICdodHRwczovL2Nkbi50aW55Z2xiLmNvbS9tb2RlbHMvZTZkNjdlY2IyZTRjNDcxNWJkNzNhNDA3OTVlMWQzZDUuZ2xiJyB9LAogICAgICAgICAgICBSRDogeyBuYW1lOiAnSmFzc3UnLCB1cmw6ICdodHRwczovL2Nkbi50aW55Z2xiLmNvbS9tb2RlbHMvODIxNjQ1OTU2NzM1NGU2Mzk1OGQ0MTA4ZDgyOGRlOTguZ2xiJyB9LAogICAgICAgICAgICBHTDogeyBuYW1lOiAnQm90dGEnLCB1cmw6ICdodHRwczovL2Nkbi50aW55Z2xiLmNvbS9tb2RlbHMvYWQxNTVlZmVkYzBkNDhmZGFkMDlkYTNlMWNhZTljOTcuZ2xiJyB9CiAgICAgICAgfTsKCiAgICAgICAgY29uc3QgYXBwbHlTdGF0cyA9IChwLCByb2xlLCBpc0hvbWUpID0+IHsKICAgICAgICAgICAgY29uc3QgdGVhbUxldmVsID0gaXNIb21lID8gMjUgOiAyMjsKICAgICAgICAgICAgd2luZG93LmZsdXguVGVhbS5nZW5lcmF0ZVN0YXRzKHAsIHJvbGUsIHRlYW1MZXZlbCwgaXNIb21lKTsKCiAgICAgICAgICAgIGlmIChwLmNoYXJhY3Rlck5hbWUuaW5jbHVkZXMoJ1RpZHVzJykpIHsKICAgICAgICAgICAgICAgIHAuc3RhdHMuU0ggKz0gNTsKICAgICAgICAgICAgICAgIHAuc3RhdHMuU1AgKz0gMzsKICAgICAgICAgICAgfSBlbHNlIGlmIChwLmNoYXJhY3Rlck5hbWUuaW5jbHVkZXMoJ1dha2thJykpIHsKICAgICAgICAgICAgICAgIHAuc3RhdHMuU0ggKz0gMzsKICAgICAgICAgICAgICAgIHAuc3RhdHMuRU4gKz0gNTsKICAgICAgICAgICAgfSBlbHNlIGlmIChwLmNoYXJhY3Rlck5hbWUuaW5jbHVkZXMoJ0Jyb3RoZXInKSkgewogICAgICAgICAgICAgICAgcC5zdGF0cy5TUCA9IDk5OwogICAgICAgICAgICB9CgogICAgICAgICAgICBwLl91cGRhdGVEZXJpdmVkU3RhdHMoKTsKICAgICAgICB9OwoKICAgICAgICBsZXQgaG9tZUxvYWRlZCA9IDA7CiAgICAgICAgY29uc3Qgcm9sZUdsdGZzID0ge307CgogICAgICAgIGNvbnN0IGZpbmFsaXplVGVhbXMgPSAoKSA9PiB7CiAgICAgICAgICAgIHJvbGVzLmZvckVhY2gocm9sZSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBnbHRmID0gcm9sZUdsdGZzW3JvbGVdIHx8IHJvbGVHbHRmcy5MRjsKCiAgICAgICAgICAgICAgICBjb25zdCBwID0gKHJvbGUgPT09ICdHTCcpCiAgICAgICAgICAgICAgICAgICAgPyBuZXcgd2luZG93LmZsdXguR29hbGllKF9zY2VuZSwgcm9sZSkKICAgICAgICAgICAgICAgICAgICA6IG5ldyB3aW5kb3cuZmx1eC5BSVBsYXllcihfc2NlbmUsIHJvbGUpOwoKICAgICAgICAgICAgICAgIGNvbnN0IGVudHJ5ID0gaG9tZVJvc3Rlcltyb2xlXTsKICAgICAgICAgICAgICAgIHAuY2hhcmFjdGVyTmFtZSA9IGVudHJ5ID8gYENQVSAke2VudHJ5Lm5hbWV9YCA6ICdDUFUnOwogICAgICAgICAgICAgICAgYXBwbHlTdGF0cyhwLCByb2xlLCBmYWxzZSk7CgogICAgICAgICAgICAgICAgaWYgKGdsdGYgJiYgZ2x0Zi5zY2VuZSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNsb25lID0gVEhSRUUuU2tlbGV0b25VdGlscy5jbG9uZShnbHRmLnNjZW5lKTsKICAgICAgICAgICAgICAgICAgICBwLnNldE1lc2goY2xvbmUsIGdsdGYuYW5pbWF0aW9ucyB8fCBbXSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignTWlzc2luZyBHTFRGIGZvciBhd2F5IHJvbGU6Jywgcm9sZSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2F3YXlUZWFtLmFkZFBsYXllcihwKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjb25zdCBhbGxQbGF5ZXJzID0gWy4uLl9ob21lVGVhbS5wbGF5ZXJzLCAuLi5fYXdheVRlYW0ucGxheWVyc107CiAgICAgICAgICAgIGFsbFBsYXllcnMuZm9yRWFjaChwID0+IHsKICAgICAgICAgICAgICAgIGlmIChwLmJhbGxSZWYgPT09IG51bGwpIHAuYmFsbFJlZiA9IF9iYWxsOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIF9ob21lVGVhbS5hY3RpdmVQbGF5ZXIgPSBfaG9tZVRlYW0ucGxheWVycy5maW5kKHAgPT4gcC5yb2xlID09PSAnTUYnKTsKCiAgICAgICAgICAgIGlmIChfaG9tZVRlYW0uYWN0aXZlUGxheWVyKSB7CiAgICAgICAgICAgICAgICBfaG9tZVRlYW0uYWN0aXZlUGxheWVyLnRlY2hzLnRhY2tsZSA9ICd2ZW5vbSc7CiAgICAgICAgICAgICAgICBfaG9tZVRlYW0uYWN0aXZlUGxheWVyLnRlY2hzLnNob290ID0gJ3NwaGVyZSc7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRXF1aXBwZWQgSG9tZSBNRiB3aXRoIFZlbm9tIFRhY2tsZSAmIFNwaGVyZSBTaG90Jyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IGF3YXlNRiA9IF9hd2F5VGVhbS5wbGF5ZXJzLmZpbmQocCA9PiBwLnJvbGUgPT09ICdNRicpOwogICAgICAgICAgICBpZiAoYXdheU1GKSB7CiAgICAgICAgICAgICAgICBhd2F5TUYudGVjaHMudGFja2xlID0gJ3dpdGhlcic7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2F3YXlUZWFtLnNldEZvcm1hdGlvbignQ291bnRlcicpOwoKICAgICAgICAgICAgY29uc3QgYXdheUdMID0gX2F3YXlUZWFtLnBsYXllcnMuZmluZChwID0+IHAucm9sZSA9PT0gJ0dMJyk7CiAgICAgICAgICAgIGlmIChhd2F5R0wpIHsKICAgICAgICAgICAgICAgIGF3YXlHTC50ZWNocy5hY3RpdmUgPSAnc3VwZXJfZ29hbGllJzsKICAgICAgICAgICAgICAgIGF3YXlHTC50ZWNocy5wYXNzaXZlID0gJ2dyaXBfZ2xvdmVzJzsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFcXVpcHBlZCBBd2F5IEdMIHdpdGggU3VwZXIgR29hbGllJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9ob21lVGVhbS5hc3NpZ25NYXJrcyhfYXdheVRlYW0pOwogICAgICAgICAgICBfYXdheVRlYW0uYXNzaWduTWFya3MoX2hvbWVUZWFtKTsKCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgaWYgKF9nYW1lTWFuYWdlcikgewogICAgICAgICAgICAgICAgX2dhbWVNYW5hZ2VyLnJlZ2lzdGVyVGVhbXMoX2hvbWVUZWFtLCBfYXdheVRlYW0sIF9iYWxsKTsKCiAgICAgICAgICAgICAgICBfbWVudU1hbmFnZXIgPSBuZXcgd2luZG93LmZsdXguTWVudU1hbmFnZXIoX2dhbWVNYW5hZ2VyKTsKICAgICAgICAgICAgICAgIF9tZW51TWFuYWdlci5zaG93KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKcm9sZXMuZm9yRWFjaChyb2xlID0+IHsKICAgICAgICAgICAgY29uc3QgZW50cnkgPSBob21lUm9zdGVyW3JvbGVdOwogICAgICAgICAgICBpZiAoIWVudHJ5KSByZXR1cm47CgogICAgICAgICAgICBjb25zdCBvbkNvbXBsZXRlID0gKCkgPT4gewogICAgICAgICAgICAgICAgaG9tZUxvYWRlZCsrOwogICAgICAgICAgICAgICAgaWYgKGhvbWVMb2FkZWQgPj0gcm9sZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgZmluYWxpemVUZWFtcygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgd2luZG93LmZsdXguQXNzZXRMb2FkZXIubG9hZE1vZGVsKGVudHJ5LnVybCwgKGdsdGYpID0+IHsKICAgICAgICAgICAgICAgIHJvbGVHbHRmc1tyb2xlXSA9IGdsdGY7CgogICAgICAgICAgICAgICAgY29uc3QgcCA9IChyb2xlID09PSAnR0wnKQogICAgICAgICAgICAgICAgICAgID8gbmV3IHdpbmRvdy5mbHV4LkdvYWxpZShfc2NlbmUsIHJvbGUpCiAgICAgICAgICAgICAgICAgICAgOiBuZXcgd2luZG93LmZsdXguQUlQbGF5ZXIoX3NjZW5lLCByb2xlKTsKCiAgICAgICAgICAgICAgICBwLmNoYXJhY3Rlck5hbWUgPSBlbnRyeS5uYW1lOwogICAgICAgICAgICAgICAgYXBwbHlTdGF0cyhwLCByb2xlLCB0cnVlKTsKCiAgICAgICAgICAgICAgICBjb25zdCBjbG9uZSA9IFRIUkVFLlNrZWxldG9uVXRpbHMuY2xvbmUoZ2x0Zi5zY2VuZSk7CiAgICAgICAgICAgICAgICBwLnNldE1lc2goY2xvbmUsIGdsdGYuYW5pbWF0aW9ucyk7CiAgICAgICAgICAgICAgICBfaG9tZVRlYW0uYWRkUGxheWVyKHApOwoKICAgICAgICAgICAgICAgIG9uQ29tcGxldGUoKTsKICAgICAgICAgICAgfSwgdW5kZWZpbmVkLCAoZXJyKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gbG9hZCBtb2RlbCcsIGVudHJ5Lm5hbWUsIGVudHJ5LnVybCwgZXJyKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRmFsbGJhY2sgTWVzaCAoUmVkIEJveCkKICAgICAgICAgICAgICAgIGNvbnN0IGZhbGxiYWNrR2VvID0gbmV3IFRIUkVFLkJveEdlb21ldHJ5KDEsIDIsIDEpOwogICAgICAgICAgICAgICAgY29uc3QgZmFsbGJhY2tNYXQgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyBjb2xvcjogMHhmZjAwMDAsIHdpcmVmcmFtZTogdHJ1ZSB9KTsKICAgICAgICAgICAgICAgIGNvbnN0IGZhbGxiYWNrTWVzaCA9IG5ldyBUSFJFRS5NZXNoKGZhbGxiYWNrR2VvLCBmYWxsYmFja01hdCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFN0b3JlIGR1bW15IGluIHJvbGVHbHRmcyBmb3IgYXdheSB0ZWFtIGNsb25pbmcKICAgICAgICAgICAgICAgIHJvbGVHbHRmc1tyb2xlXSA9IHsgc2NlbmU6IGZhbGxiYWNrTWVzaCwgYW5pbWF0aW9uczogW10gfTsKCiAgICAgICAgICAgICAgICBjb25zdCBwID0gKHJvbGUgPT09ICdHTCcpCiAgICAgICAgICAgICAgICAgICAgPyBuZXcgd2luZG93LmZsdXguR29hbGllKF9zY2VuZSwgcm9sZSkKICAgICAgICAgICAgICAgICAgICA6IG5ldyB3aW5kb3cuZmx1eC5BSVBsYXllcihfc2NlbmUsIHJvbGUpOwoKICAgICAgICAgICAgICAgIHAuY2hhcmFjdGVyTmFtZSA9IGVudHJ5Lm5hbWUgKyAiIChFcnJvcikiOwogICAgICAgICAgICAgICAgYXBwbHlTdGF0cyhwLCByb2xlLCB0cnVlKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcC5zZXRNZXNoKGZhbGxiYWNrTWVzaC5jbG9uZSgpLCBbXSk7CiAgICAgICAgICAgICAgICBfaG9tZVRlYW0uYWRkUGxheWVyKHApOwoKICAgICAgICAgICAgICAgIG9uQ29tcGxldGUoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vIDguIElucHV0CiAgICAgICAgc2V0dXBJbnB1dHMoKTsKCiAgICAgICAgLy8gOS4gTG9vcAogICAgICAgIF9jbG9jayA9IG5ldyBUSFJFRS5DbG9jaygpOwogICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKCiAgICAgICAgLy8gSGFuZGxlIHJlc2l6ZQogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBvblJlc2l6ZSk7CiAgICAgICAgb25SZXNpemUoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGVQYXJ0aWNsZXMoKSB7CiAgICAgICAgY29uc3QgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuQnVmZmVyR2VvbWV0cnkoKTsKICAgICAgICBjb25zdCB2ZXJ0aWNlcyA9IFtdOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNTAwOyBpKyspIHsKICAgICAgICAgICAgdmVydGljZXMucHVzaCgKICAgICAgICAgICAgICAgIChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDIwLAogICAgICAgICAgICAgICAgKE1hdGgucmFuZG9tKCkgLSAwLjUpICogMjAsCiAgICAgICAgICAgICAgICAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiAyMAogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBnZW9tZXRyeS5zZXRBdHRyaWJ1dGUoJ3Bvc2l0aW9uJywgbmV3IFRIUkVFLkZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUodmVydGljZXMsIDMpKTsKICAgICAgICBjb25zdCBtYXRlcmlhbCA9IG5ldyBUSFJFRS5Qb2ludHNNYXRlcmlhbCh7IGNvbG9yOiAweDg4Y2NmZiwgc2l6ZTogMC4wNSwgdHJhbnNwYXJlbnQ6IHRydWUsIG9wYWNpdHk6IDAuNiB9KTsKICAgICAgICBjb25zdCBwb2ludHMgPSBuZXcgVEhSRUUuUG9pbnRzKGdlb21ldHJ5LCBtYXRlcmlhbCk7CiAgICAgICAgX3NjZW5lLmFkZChwb2ludHMpOwogICAgfQoKZnVuY3Rpb24gY3JlYXRlQXJlbmEoKSB7CiAgICAgICAgY29uc3QgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuU3BoZXJlR2VvbWV0cnkoX2NvbmZpZy5hcmVuYVJhZGl1cywgMzIsIDMyKTsKICAgICAgICAKICAgICAgICBjb25zdCB0ZXhMb2FkZXIgPSBuZXcgVEhSRUUuVGV4dHVyZUxvYWRlcigpOwpjb25zdCBhcmVuYVRleCA9IHRleExvYWRlci5sb2FkKCdodHRwczovL2kucG9zdGltZy5jYy9XMUxzSDY4US9maWxlLTAwMDAwMDAwMjNlYzcxZjU5NjU5MzgyOWU4MTE4NzYwLSgxKS5wbmcnKTsKICAgICAgICBhcmVuYVRleC5tYWdGaWx0ZXIgPSBUSFJFRS5OZWFyZXN0RmlsdGVyOwogICAgICAgIGFyZW5hVGV4Lm1pbkZpbHRlciA9IFRIUkVFLk5lYXJlc3RGaWx0ZXI7CiAgICAgICAgYXJlbmFUZXgud3JhcFMgPSBUSFJFRS5SZXBlYXRXcmFwcGluZzsKICAgICAgICBhcmVuYVRleC53cmFwVCA9IFRIUkVFLlJlcGVhdFdyYXBwaW5nOwogICAgICAgIGFyZW5hVGV4LnJlcGVhdC5zZXQoNiwgNCk7Cgpjb25zdCBtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7CiAgICAgICAgICAgIG1hcDogYXJlbmFUZXgsCiAgICAgICAgICAgIGNvbG9yOiAweGZmZmZmZiwKICAgICAgICAgICAgd2lyZWZyYW1lOiBmYWxzZSwKICAgICAgICAgICAgdHJhbnNwYXJlbnQ6IHRydWUsCiAgICAgICAgICAgIG9wYWNpdHk6IDAuMCwgLy8gRGVmYXVsdCBpbnZpc2libGUgKDAuMCkgYXMgcmVxdWVzdGVkCiAgICAgICAgICAgIGJsZW5kaW5nOiBUSFJFRS5NdWx0aXBseUJsZW5kaW5nLAogICAgICAgICAgICBzaWRlOiBUSFJFRS5CYWNrU2lkZQogICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICBjb25zdCBhcmVuYSA9IG5ldyBUSFJFRS5NZXNoKGdlb21ldHJ5LCBtYXRlcmlhbCk7CiAgICAgICAgX3NjZW5lLmFkZChhcmVuYSk7CiAgICAgICAgd2luZG93LmZsdXguYXJlbmFNZXNoID0gYXJlbmE7CgovLyAtLS0gQXJlbmEgMiAoTm9ybWFsIEJsZW5kLCA1JSBPcGFjaXR5KSAtLS0KICAgICAgICBjb25zdCBtYXRlcmlhbDIgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoewogICAgICAgICAgICBtYXA6IGFyZW5hVGV4LAogICAgICAgICAgICBjb2xvcjogMHhmZmZmZmYsCiAgICAgICAgICAgIHdpcmVmcmFtZTogZmFsc2UsCiAgICAgICAgICAgIHRyYW5zcGFyZW50OiB0cnVlLAogICAgICAgICAgICBvcGFjaXR5OiAwLjA1LAogICAgICAgICAgICBibGVuZGluZzogVEhSRUUuTm9ybWFsQmxlbmRpbmcsCiAgICAgICAgICAgIHNpZGU6IFRIUkVFLkJhY2tTaWRlCiAgICAgICAgfSk7CiAgICAgICAgY29uc3QgYXJlbmEyID0gbmV3IFRIUkVFLk1lc2goZ2VvbWV0cnksIG1hdGVyaWFsMik7CiAgICAgICAgYXJlbmEyLnNjYWxlLnNldFNjYWxhcigwLjk5NSk7IC8vIFNsaWdodCBvZmZzZXQgdG8gcHJldmVudCB6LWZpZ2h0aW5nCiAgICAgICAgX3NjZW5lLmFkZChhcmVuYTIpOwogICAgICAgIHdpbmRvdy5mbHV4LmFyZW5hTWVzaDIgPSBhcmVuYTI7CgogICAgICAgIC8vIC0tLSBORVc6IEZGWCBHT0FMIE1PREVMUyAtLS0KICAgICAgICBjb25zdCBnb2FsVXJsID0gJ2h0dHBzOi8vY2RuLnRpbnlnbGIuY29tL21vZGVscy9hNTE2YmQ5MGZhN2M0ZGVkYjVkY2JmZGY4MDNmMTNkNS5nbGInOwogICAgICAgIApjb25zdCBvbkdvYWxMb2FkZWQgPSAobW9kZWwsIGlzRmFsbGJhY2spID0+IHsKICAgICAgICAgICAgY29uc3QgZ29hbEEgPSBtb2RlbDsKICAgICAgICAgICAgLy8gTW92ZWQgZG93biB+N2Z0ICgyLjJtKSBhcyByZXF1ZXN0ZWQKICAgICAgICAgICAgZ29hbEEucG9zaXRpb24uc2V0KDAsIC0yLjIsIC0zMik7IAogICAgICAgICAgICAKaWYgKCFpc0ZhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICBnb2FsQS5zY2FsZS5zZXRTY2FsYXIoMzYuMCk7IC8vIEluY3JlYXNlZCA1MCUgKHdhcyAyNC4wKQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIFNldHVwIEdvYWwgQQogICAgICAgICAgICBnb2FsQS50cmF2ZXJzZShjID0+IHsKICAgICAgICAgICAgICAgIGlmKGMuaXNNZXNoKSB7CiAgICAgICAgICAgICAgICAgICAgYy5mcnVzdHVtQ3VsbGVkID0gZmFsc2U7IC8vIENSSVRJQ0FMOiBQcmV2ZW50IGN1bGxpbmcKICAgICAgICAgICAgICAgICAgICBjLnJlbmRlck9yZGVyID0gMDsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBFbnN1cmUgbWF0ZXJpYWwgaXMgdmlzaWJsZQogICAgICAgICAgICAgICAgICAgIGlmIChjLm1hdGVyaWFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGMubWF0ZXJpYWwuY29sb3Iuc2V0SGV4KDB4ZmZmZmZmKTsgLy8gV2hpdGUgdG8gc2hvdyBvcmlnaW5hbCB0ZXh0dXJlL2NvbG9ycyAod2FzIGJsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgIGMubWF0ZXJpYWwudHJhbnNwYXJlbnQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgYy5tYXRlcmlhbC5vcGFjaXR5ID0gMS4wOwogICAgICAgICAgICAgICAgICAgICAgICBjLm1hdGVyaWFsLnNpZGUgPSBUSFJFRS5Eb3VibGVTaWRlOwogICAgICAgICAgICAgICAgICAgICAgICBjLm1hdGVyaWFsLmRlcHRoV3JpdGUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBjLm1hdGVyaWFsLmRlcHRoVGVzdCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgX3NjZW5lLmFkZChnb2FsQSk7CgogICAgICAgICAgICAvLyBTZXR1cCBHb2FsIEIKICAgICAgICAgICAgY29uc3QgZ29hbEIgPSBpc0ZhbGxiYWNrID8gZ29hbEEuY2xvbmUoKSA6IFRIUkVFLlNrZWxldG9uVXRpbHMuY2xvbmUoZ29hbEEpOwoKICAgICAgICAgICAgZ29hbEIucG9zaXRpb24uc2V0KDAsIC0yLjIsIDMyKTsgLy8gTW92ZWQgY2xvc2VyICh3YXMgNDUpIGFuZCBkb3duCiAgICAgICAgICAgIGdvYWxCLnJvdGF0aW9uLnkgPSBNYXRoLlBJOwogICAgICAgICAgICAvLyBFbnN1cmUgR29hbCBCIG1lc2hlcyBhcmUgYWxzbyBwZXJzaXN0ZW50CiAgICAgICAgICAgIGdvYWxCLnRyYXZlcnNlKGMgPT4gewogICAgICAgICAgICAgICAgaWYoYy5pc01lc2gpIGMuZnJ1c3R1bUN1bGxlZCA9IGZhbHNlOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIF9zY2VuZS5hZGQoZ29hbEIpOwogICAgICAgIH07CgogICAgICAgIHdpbmRvdy5mbHV4LkFzc2V0TG9hZGVyLmxvYWRNb2RlbChnb2FsVXJsLCAoZ2x0ZikgPT4gewogICAgICAgICAgICBvbkdvYWxMb2FkZWQoZ2x0Zi5zY2VuZSwgZmFsc2UpOwogICAgICAgIH0sIHVuZGVmaW5lZCwgKGVycikgPT4gewpjb25zb2xlLndhcm4oIkdvYWwgbW9kZWwgZmFpbGVkIHRvIGxvYWQuIFVzaW5nIGZhbGxiYWNrLiIsIGVycik7CmNvbnN0IGdlbyA9IG5ldyBUSFJFRS5Cb3hHZW9tZXRyeSg3NSwgNDUsIDEwKTsgLy8gRmFsbGJhY2sgbWFzc2l2ZSBib3ggKFNjYWxlZCAxLjV4KQogICAgICAgICAgICBjb25zdCBmYWxsYmFja01hdCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7IGNvbG9yOiAweGZmZmZmZiwgd2lyZWZyYW1lOiB0cnVlIH0pOwogICAgICAgICAgICBjb25zdCBmYWxsYmFjayA9IG5ldyBUSFJFRS5NZXNoKGdlbywgZmFsbGJhY2tNYXQpOwogICAgICAgICAgICBvbkdvYWxMb2FkZWQoZmFsbGJhY2ssIHRydWUpOwogICAgICAgIH0pOwoKICAgICAgICAvLyAtLS0gTkVXOiBNQVNTSVZFIEZJRUxEIE1BUktJTkdTIC0tLQogICAgICAgIGNyZWF0ZUZpZWxkTWFya2luZ3MoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGVGaWVsZE1hcmtpbmdzKCkgewogICAgICAgIGNvbnN0IHNpemUgPSAxMDI0OwogICAgICAgIGNvbnN0IGMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgICBjLndpZHRoID0gc2l6ZTsgYy5oZWlnaHQgPSBzaXplOwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjb25zdCBjeCA9IHNpemUvMjsgY29uc3QgY3kgPSBzaXplLzI7CgogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgc2l6ZSwgc2l6ZSk7CgogICAgICAgIC8vIEdsb3cgU2V0dGluZ3MKICAgICAgICBjdHguc2hhZG93Qmx1ciA9IDIwOwogICAgICAgIGN0eC5zaGFkb3dDb2xvciA9ICcjMDBmZmZmJzsKICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAncmdiYSgxMDAsIDI1NSwgMjU1LCAwLjkpJzsKICAgICAgICBjdHgubGluZVdpZHRoID0gNTsKICAgICAgICBjdHgubGluZUNhcCA9ICdyb3VuZCc7CgogICAgICAgIC8vIDEuIE1haW4gRmllbGQgQ2lyY2xlIChUaGUgU3BoZXJlIEVxdWF0b3IpCiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgIGN0eC5hcmMoY3gsIGN5LCA0NTAsIDAsIE1hdGguUEkqMik7CiAgICAgICAgY3R4LnN0cm9rZSgpOwoKICAgICAgICAvLyAyLiBJbm5lciBEZWNvcmF0aXZlIFJpbmcKICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgY3R4LmFyYyhjeCwgY3ksIDQyMCwgMCwgTWF0aC5QSSoyKTsKICAgICAgICBjdHgubGluZVdpZHRoID0gMjsKICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAncmdiYSgwLCAyMDAsIDI1NSwgMC41KSc7CiAgICAgICAgY3R4LnN0cm9rZSgpOwoKICAgICAgICAvLyAzLiBDZW50ZXIgQmxpdHpvZmYgWm9uZSAoQ29tcGxleCBTdGFyL1J1bmUpCiAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDQ7CiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC45KSc7CiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgIGN0eC5hcmMoY3gsIGN5LCA4MCwgMCwgTWF0aC5QSSoyKTsKICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgICAgCiAgICAgICAgLy8gSW5uZXIgU3RhciBQYXR0ZXJuCiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgIGZvcihsZXQgaT0wOyBpPDU7IGkrKykgewogICAgICAgICAgICBjb25zdCBhID0gKGkvNSkqTWF0aC5QSSoyIC0gTWF0aC5QSS8yOwogICAgICAgICAgICBjb25zdCB4ID0gY3ggKyBNYXRoLmNvcyhhKSo2MDsKICAgICAgICAgICAgY29uc3QgeSA9IGN5ICsgTWF0aC5zaW4oYSkqNjA7CiAgICAgICAgICAgIGlmKGk9PT0wKSBjdHgubW92ZVRvKHgseSk7IGVsc2UgY3R4LmxpbmVUbyh4LHkpOwogICAgICAgICAgICAvLyBJbm5lciBwb2ludAogICAgICAgICAgICBjb25zdCBhMiA9ICgoaSswLjUpLzUpKk1hdGguUEkqMiAtIE1hdGguUEkvMjsKICAgICAgICAgICAgY29uc3QgeDIgPSBjeCArIE1hdGguY29zKGEyKSoyNTsKICAgICAgICAgICAgY29uc3QgeTIgPSBjeSArIE1hdGguc2luKGEyKSoyNTsKICAgICAgICAgICAgY3R4LmxpbmVUbyh4Mix5Mik7CiAgICAgICAgfQogICAgICAgIGN0eC5jbG9zZVBhdGgoKTsKICAgICAgICBjdHguc3Ryb2tlKCk7CgogICAgICAgIC8vIDQuIE1pZGZpZWxkIExpbmUKICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgY3R4Lm1vdmVUbygwLCBjeSk7IGN0eC5saW5lVG8oc2l6ZSwgY3kpOwogICAgICAgIGN0eC5zdHJva2UoKTsKCiAgICAgICAgLy8gNS4gR29hbCBCb3hlcyAoVHJhcGV6b2lkcykKICAgICAgICBjb25zdCBkcmF3R29hbEJveCA9ICh5UG9zLCBkaXIpID0+IHsKY29uc3QgZHJhd0dvYWxCb3ggPSAoeVBvcywgZGlyKSA9PiB7CiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgY3R4Lm1vdmVUbyhjeCAtIDE1MCwgeVBvcyk7CiAgICAgICAgICAgIGN0eC5saW5lVG8oY3ggKyAxNTAsIHlQb3MpOwogICAgICAgICAgICBjdHgubGluZVRvKGN4ICsgMjI1LCB5UG9zICsgKGRpciAqIDEyMCkpOwogICAgICAgICAgICBjdHgubGluZVRvKGN4IC0gMjI1LCB5UG9zICsgKGRpciAqIDEyMCkpOwogICAgICAgICAgICBjdHguY2xvc2VQYXRoKCk7CiAgICAgICAgICAgIGN0eC5zdHJva2UoKTsKICAgICAgICB9OwogICAgICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgICAgfTsKICAgICAgICBkcmF3R29hbEJveCg1MCwgMSk7IC8vIFRvcCAoSG9tZSBzaWRlIGluIHRleHR1cmUgc3BhY2UpCiAgICAgICAgZHJhd0dvYWxCb3goc2l6ZS01MCwgLTEpOyAvLyBCb3R0b20KCiAgICAgICAgLy8gNi4gUnVuZXMgKFByb2NlZHVyYWwgVGV4dCBSaW5nKQogICAgICAgIGN0eC5mb250ID0gJ2JvbGQgMzJweCBtb25vc3BhY2UnOwogICAgICAgIGN0eC5maWxsU3R5bGUgPSAncmdiYSgwLCAyNTUsIDI1NSwgMC43KSc7CiAgICAgICAgY3R4LnRleHRBbGlnbiA9ICdjZW50ZXInOwogICAgICAgIGN0eC50ZXh0QmFzZWxpbmUgPSAnbWlkZGxlJzsKICAgICAgICAKICAgICAgICBjb25zdCBydW5lcyA9ICJCTElUWkJBTEwgU1BIRVJFIFBPT0wgWkFOQVJLQU5EIEFCWVNTIEVURVJOQUwgQ0FMTSAiOwogICAgICAgIGNvbnN0IHJ1bmVDb3VudCA9IDMyOwogICAgICAgIGZvcihsZXQgaT0wOyBpPHJ1bmVDb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IGFuZ2xlID0gKGkgLyBydW5lQ291bnQpICogTWF0aC5QSSAqIDI7CiAgICAgICAgICAgIGNvbnN0IHIgPSA0ODA7CiAgICAgICAgICAgIGNvbnN0IHggPSBjeCArIE1hdGguY29zKGFuZ2xlKSAqIHI7CiAgICAgICAgICAgIGNvbnN0IHkgPSBjeSArIE1hdGguc2luKGFuZ2xlKSAqIHI7CiAgICAgICAgICAgIAogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICBjdHgudHJhbnNsYXRlKHgsIHkpOwogICAgICAgICAgICBjdHgucm90YXRlKGFuZ2xlICsgTWF0aC5QSS8yKTsKICAgICAgICAgICAgLy8gVXNlIGEgY2hhciBmcm9tIHRoZSBzdHJpbmcgb3IgcmFuZG9tIHJ1bmUtbGlrZSBjaGFyCiAgICAgICAgICAgIGNvbnN0IGNoYXIgPSBydW5lc1tpICUgcnVuZXMubGVuZ3RoXTsKICAgICAgICAgICAgY3R4LmZpbGxUZXh0KGNoYXIsIDAsIDApOwogICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgdGV4ID0gbmV3IFRIUkVFLkNhbnZhc1RleHR1cmUoYyk7CiAgICAgICAgdGV4LmFuaXNvdHJvcHkgPSAxNjsKCiAgICAgICAgLy8gRmxvb3IgUGxhbmUgKERlZXApCiAgICAgICAgY29uc3QgZ2VvID0gbmV3IFRIUkVFLlBsYW5lR2VvbWV0cnkoNjQsIDY0KTsKICAgICAgICBjb25zdCBtYXQgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoewogICAgICAgICAgICBtYXA6IHRleCwKICAgICAgICAgICAgdHJhbnNwYXJlbnQ6IHRydWUsCiAgICAgICAgICAgIG9wYWNpdHk6IDAuOCwKICAgICAgICAgICAgc2lkZTogVEhSRUUuRG91YmxlU2lkZSwKICAgICAgICAgICAgZGVwdGhXcml0ZTogZmFsc2UsCiAgICAgICAgICAgIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nCiAgICAgICAgfSk7CgogICAgICAgIGNvbnN0IGZpZWxkID0gbmV3IFRIUkVFLk1lc2goZ2VvLCBtYXQpOwogICAgICAgIGZpZWxkLnJvdGF0aW9uLnggPSAtTWF0aC5QSSAvIDI7CiAgICAgICAgZmllbGQucG9zaXRpb24ueSA9IC04LjA7IC8vIFN1bmsgZGVlcCBpbnRvIHRoZSBzcGhlcmUKICAgICAgICBfc2NlbmUuYWRkKGZpZWxkKTsKCiAgICAgICAgLy8gRmxvYXRpbmcgSG9sb2dyYXBoaWMgUmluZ3MgKE1pZC1oZWlnaHQpCiAgICAgICAgY29uc3QgcmluZ0dlbyA9IG5ldyBUSFJFRS5Ub3J1c0dlb21ldHJ5KDIwLCAwLjEsIDE2LCAxMDApOwogICAgICAgIGNvbnN0IHJpbmdNYXQgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyBjb2xvcjogMHgwMGZmZmYsIHRyYW5zcGFyZW50OiB0cnVlLCBvcGFjaXR5OiAwLjMsIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nIH0pOwogICAgICAgIGNvbnN0IHJpbmcxID0gbmV3IFRIUkVFLk1lc2gocmluZ0dlbywgcmluZ01hdCk7CiAgICAgICAgcmluZzEucm90YXRpb24ueCA9IE1hdGguUEkgLyAyOwogICAgICAgIHJpbmcxLnBvc2l0aW9uLnkgPSAwOwogICAgICAgIF9zY2VuZS5hZGQocmluZzEpOwogICAgICAgIAogICAgICAgIGNvbnN0IHJpbmcyID0gbmV3IFRIUkVFLk1lc2gocmluZ0dlbywgcmluZ01hdCk7CiAgICAgICAgcmluZzIucm90YXRpb24ueCA9IE1hdGguUEkgLyAyOwogICAgICAgIHJpbmcyLnNjYWxlLnNldFNjYWxhcigxLjIpOwogICAgICAgIHJpbmcyLnBvc2l0aW9uLnkgPSA0LjA7CiAgICAgICAgX3NjZW5lLmFkZChyaW5nMik7CgogICAgICAgIC8vIEFuaW1hdGUgUmluZ3MKICAgICAgICBjb25zdCBhbmltYXRlID0gKCkgPT4gewogICAgICAgICAgICBpZihyaW5nMSkgewogICAgICAgICAgICAgICAgcmluZzEucm90YXRpb24ueiArPSAwLjAwMTsKICAgICAgICAgICAgICAgIHJpbmcxLnNjYWxlLnNldFNjYWxhcigxLjAgKyBNYXRoLnNpbihEYXRlLm5vdygpKjAuMDAwNSkqMC4wNSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYocmluZzIpIHsKICAgICAgICAgICAgICAgIHJpbmcyLnJvdGF0aW9uLnogLT0gMC4wMDE1OwogICAgICAgICAgICAgICAgcmluZzIucG9zaXRpb24ueSA9IDQuMCArIE1hdGguY29zKERhdGUubm93KCkqMC4wMDA3KSoxLjA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIH07CiAgICAgICAgYW5pbWF0ZSgpOwogICAgfQoKICAgIC8vIC0tLSBJTlBVVCBTWVNURU0gLS0tCiAgICBjb25zdCBfaW5wdXQgPSB7IHg6IDAsIHk6IDAgfTsKICAgIGNvbnN0IF9haW1JbnB1dCA9IHsgeDogMCwgeTogMCwgYWN0aXZlOiBmYWxzZSB9OyAvLyBORVc6IEFpbSBqb3lzdGljawogICAgY29uc3QgX2tleXMgPSB7IHc6IGZhbHNlLCBhOiBmYWxzZSwgczogZmFsc2UsIGQ6IGZhbHNlLCBBcnJvd1VwOiBmYWxzZSwgQXJyb3dMZWZ0OiBmYWxzZSwgQXJyb3dEb3duOiBmYWxzZSwgQXJyb3dSaWdodDogZmFsc2UgfTsKCiAgICBjb25zdCBfYWN0aW9uQnVmZmVyID0geyBhY3RpdmU6IGZhbHNlLCB0aW1lc3RhbXA6IDAsIGR1cmF0aW9uOiAzMDAgfTsKCiAgICBjb25zdCBfY2FtRndkID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgIGNvbnN0IF9jYW1SaWdodCA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfdXBBeGlzID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMSwgMCk7CgogICAgZnVuY3Rpb24gc2V0dXBJbnB1dHMoKSB7CiAgICAgICAgLy8gS2V5Ym9hcmQKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChlKSA9PiB7CiAgICAgICAgICAgIF9rZXlzW2Uua2V5XSA9IHRydWU7CiAgICAgICAgICAgIGlmIChlLmNvZGUgPT09ICdTcGFjZScgJiYgX2hvbWVUZWFtICYmIF9ob21lVGVhbS5hY3RpdmVQbGF5ZXIgJiYgX2JhbGwpIHsKICAgICAgICAgICAgICAgIF9ob21lVGVhbS5hY3RpdmVQbGF5ZXIudGhyb3dCYWxsKF9iYWxsKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBORVc6IFRhY2tsZSBvbiBTaGlmdAogICAgICAgICAgICBpZiAoZS5jb2RlID09PSAnU2hpZnRMZWZ0JyB8fCBlLmNvZGUgPT09ICdTaGlmdFJpZ2h0JykgewogICAgICAgICAgICAgICAgaWYgKF9ob21lVGVhbSAmJiBfaG9tZVRlYW0uYWN0aXZlUGxheWVyKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IF9ob21lVGVhbS5hY3RpdmVQbGF5ZXI7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFwLmhhc0JhbGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcC5kYXNoKHAuaW5wdXRWZWN0b3IueCwgcC5pbnB1dFZlY3Rvci56KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdXBkYXRlSW5wdXRWZWN0b3IoKTsKICAgICAgICB9KTsKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCAoZSkgPT4geyBfa2V5c1tlLmtleV0gPSBmYWxzZTsgdXBkYXRlSW5wdXRWZWN0b3IoKTsgfSk7CgogICAgICAgIC8vIC0tLSBGTE9BVElORyBKT1lTVElDSyAoTW92ZW1lbnQpIC0tLQogICAgICAgIGNvbnN0IGhpdFpvbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnam95c3RpY2staGl0LXpvbmUnKTsKICAgICAgICBjb25zdCB2aXN1YWxzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pveXN0aWNrLXZpc3VhbC1jb250YWluZXInKTsKICAgICAgICBjb25zdCBiYXNlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pveXN0aWNrLWJhc2UnKTsKICAgICAgICBjb25zdCBrbm9iID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pveXN0aWNrLWtub2InKTsKCiAgICAgICAgbGV0IHN0YXJ0WCA9IDAsIHN0YXJ0WSA9IDA7CiAgICAgICAgbGV0IGRyYWdnaW5nID0gZmFsc2U7CiAgICAgICAgY29uc3QgbWF4RGlzdCA9IDQwOwoKICAgICAgICBjb25zdCBoYW5kbGVTdGFydCA9IChjbGllbnRYLCBjbGllbnRZKSA9PiB7CiAgICAgICAgICAgIGRyYWdnaW5nID0gdHJ1ZTsKICAgICAgICAgICAgc3RhcnRYID0gY2xpZW50WDsKICAgICAgICAgICAgc3RhcnRZID0gY2xpZW50WTsKCiAgICAgICAgICAgIHZpc3VhbHMuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgIHZpc3VhbHMuc3R5bGUubGVmdCA9IGAke2NsaWVudFh9cHhgOwogICAgICAgICAgICB2aXN1YWxzLnN0eWxlLnRvcCA9IGAke2NsaWVudFl9cHhgOwoKICAgICAgICAgICAga25vYi5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKC01MCUsIC01MCUpYDsKCiAgICAgICAgICAgIGNyZWF0ZVJpcHBsZShjbGllbnRYLCBjbGllbnRZKTsKCiAgICAgICAgICAgIF9pbnB1dC54ID0gMDsKICAgICAgICAgICAgX2lucHV0LnkgPSAwOwogICAgICAgICAgICB1cGRhdGVJbnB1dFZlY3RvcigpOwogICAgICAgIH07CgogICAgICAgIGNvbnN0IGhhbmRsZU1vdmUgPSAoY2xpZW50WCwgY2xpZW50WSkgPT4gewogICAgICAgICAgICBpZiAoIWRyYWdnaW5nKSByZXR1cm47CgogICAgICAgICAgICBsZXQgZHggPSBjbGllbnRYIC0gc3RhcnRYOwogICAgICAgICAgICBsZXQgZHkgPSBjbGllbnRZIC0gc3RhcnRZOwoKICAgICAgICAgICAgY29uc3QgZGlzdCA9IE1hdGguc3FydChkeCpkeCArIGR5KmR5KTsKCiAgICAgICAgICAgIGlmIChkaXN0ID4gbWF4RGlzdCkgewogICAgICAgICAgICAgICAgZHggPSAoZHggLyBkaXN0KSAqIG1heERpc3Q7CiAgICAgICAgICAgICAgICBkeSA9IChkeSAvIGRpc3QpICogbWF4RGlzdDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAga25vYi5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKGNhbGMoLTUwJSArICR7ZHh9cHgpLCBjYWxjKC01MCUgKyAke2R5fXB4KSlgOwoKICAgICAgICAgICAgX2lucHV0LnggPSAoZHggLyBtYXhEaXN0KSAqIF9zZXR0aW5ncy5qb3lzdGlja1NlbnNpdGl2aXR5OwogICAgICAgICAgICBfaW5wdXQueSA9IChkeSAvIG1heERpc3QpICogX3NldHRpbmdzLmpveXN0aWNrU2Vuc2l0aXZpdHk7CiAgICAgICAgICAgIHVwZGF0ZUlucHV0VmVjdG9yKCk7CiAgICAgICAgfTsKCiAgICAgICAgY29uc3QgaGFuZGxlRW5kID0gKCkgPT4gewogICAgICAgICAgICBpZiAoIWRyYWdnaW5nKSByZXR1cm47CiAgICAgICAgICAgIGRyYWdnaW5nID0gZmFsc2U7CgogICAgICAgICAgICB2aXN1YWxzLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgogICAgICAgICAgICBfaW5wdXQueCA9IDA7CiAgICAgICAgICAgIF9pbnB1dC55ID0gMDsKICAgICAgICAgICAgdXBkYXRlSW5wdXRWZWN0b3IoKTsKICAgICAgICB9OwoKICAgICAgICBpZiAoaGl0Wm9uZSkgewogICAgICAgICAgICBoaXRab25lLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCAoZSkgPT4gewogICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgaGFuZGxlU3RhcnQoZS50b3VjaGVzWzBdLmNsaWVudFgsIGUudG91Y2hlc1swXS5jbGllbnRZKTsKICAgICAgICAgICAgfSwgeyBwYXNzaXZlOiBmYWxzZSB9KTsKCiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCAoZSkgPT4gewogICAgICAgICAgICAgICAgaWYoZHJhZ2dpbmcpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZS5jYW5jZWxhYmxlKSBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgaGFuZGxlTW92ZShlLnRvdWNoZXNbMF0uY2xpZW50WCwgZS50b3VjaGVzWzBdLmNsaWVudFkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB7IHBhc3NpdmU6IGZhbHNlIH0pOwoKICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgaGFuZGxlRW5kKTsKCiAgICAgICAgICAgIGhpdFpvbmUuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgKGUpID0+IHsKICAgICAgICAgICAgICAgIGhhbmRsZVN0YXJ0KGUuY2xpZW50WCwgZS5jbGllbnRZKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCAoZSkgPT4gewogICAgICAgICAgICAgICAgaWYgKGRyYWdnaW5nKSBoYW5kbGVNb3ZlKGUuY2xpZW50WCwgZS5jbGllbnRZKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgaGFuZGxlRW5kKTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLSBORVc6IEFJTSBKT1lTVElDSyAoUmlnaHQgc2lkZSkgLS0tCiAgICAgICAgc2V0dXBBaW1Kb3lzdGljaygpOwoKICAgICAgICAvLyAtLS0gTkVXOiBUQUNLTEUgQlVUVE9OIC0tLQogICAgICAgIHNldHVwVGFja2xlQnV0dG9uKCk7CgogICAgICAgIC8vIFN3aXBlIERldGVjdGlvbgogICAgICAgIGxldCBzd2lwZVN0YXJ0ID0geyB4OiAwLCB5OiAwLCB0OiAwIH07CgogICAgICAgIGNvbnN0IG9uU3dpcGVTdGFydCA9ICh4LCB5KSA9PiB7CiAgICAgICAgICAgIHN3aXBlU3RhcnQueCA9IHg7CiAgICAgICAgICAgIHN3aXBlU3RhcnQueSA9IHk7CiAgICAgICAgICAgIHN3aXBlU3RhcnQudCA9IERhdGUubm93KCk7CiAgICAgICAgfTsKCiAgICAgICAgY29uc3Qgb25Td2lwZUVuZCA9ICh4LCB5KSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGR0ID0gRGF0ZS5ub3coKSAtIHN3aXBlU3RhcnQudDsKICAgICAgICAgICAgY29uc3QgZHggPSB4IC0gc3dpcGVTdGFydC54OwogICAgICAgICAgICBjb25zdCBkeSA9IHkgLSBzd2lwZVN0YXJ0Lnk7CiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLnNxcnQoZHgqZHggKyBkeSpkeSk7CgogICAgICAgICAgICBpZiAoZHQgPCAzMDAgJiYgZGlzdCA+IDMwKSB7CiAgICAgICAgICAgICAgICBpZiAoX2hvbWVUZWFtICYmIF9ob21lVGVhbS5hY3RpdmVQbGF5ZXIgJiYgX2NhbWVyYSkgewogICAgICAgICAgICAgICAgICAgIF9jYW1lcmEuZ2V0V29ybGREaXJlY3Rpb24oX2NhbUZ3ZCk7CiAgICAgICAgICAgICAgICAgICAgX2NhbUZ3ZC55ID0gMDsKICAgICAgICAgICAgICAgICAgICBpZiAoX2NhbUZ3ZC5sZW5ndGhTcSgpIDwgMC4wMDEpIF9jYW1Gd2Quc2V0KDAsIDAsIC0xKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIF9jYW1Gd2Qubm9ybWFsaXplKCk7CgogICAgICAgICAgICAgICAgICAgIF9jYW1SaWdodC5jcm9zc1ZlY3RvcnMoX2NhbUZ3ZCwgX3VwQXhpcykubm9ybWFsaXplKCk7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdvcmxkWCA9IChfY2FtUmlnaHQueCAqIGR4KSArIChfY2FtRndkLnggKiAtZHkpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdvcmxkWiA9IChfY2FtUmlnaHQueiAqIGR4KSArIChfY2FtRndkLnogKiAtZHkpOwoKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gX2hvbWVUZWFtLmFjdGl2ZVBsYXllcjsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHAuaXNUaHJvd2luZykgewogICAgICAgICAgICAgICAgICAgICAgICBwLnNldE92ZXJyaWRlQWltKHdvcmxkWCwgd29ybGRaKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIkFJTSEiLCBwLm1lc2gucG9zaXRpb24sICJkZWZhdWx0Iik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBwLmRhc2god29ybGRYLCB3b3JsZFopOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlUmlwcGxlKHgsIHkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgLy8gVG91Y2ggU3dpcGUgKGV4Y2x1ZGluZyBjb250cm9scykKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIChlKSA9PiB7CiAgICAgICAgICAgIGlmIChlLnRhcmdldC5jbG9zZXN0KCcjam95c3RpY2staGl0LXpvbmUnKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI2FjdGlvbi1idXR0b24nKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI3RhY2tsZS1idXR0b24nKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI2FpbS1qb3lzdGljay16b25lJykgfHwKICAgICAgICAgICAgICAgIGUudGFyZ2V0LmNsb3Nlc3QoJyNhdXRvLXRvZ2dsZScpIHx8CiAgICAgICAgICAgICAgICBlLnRhcmdldC5jbG9zZXN0KCcjc2V0dGluZ3MtYnV0dG9uJykpIHJldHVybjsKICAgICAgICAgICAgb25Td2lwZVN0YXJ0KGUudG91Y2hlc1swXS5jbGllbnRYLCBlLnRvdWNoZXNbMF0uY2xpZW50WSk7CiAgICAgICAgICAgIGNyZWF0ZVJpcHBsZShlLnRvdWNoZXNbMF0uY2xpZW50WCwgZS50b3VjaGVzWzBdLmNsaWVudFkpOwogICAgICAgIH0sIHsgcGFzc2l2ZTogZmFsc2UgfSk7CgogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIChlKSA9PiB7CiAgICAgICAgICAgIGlmIChlLnRhcmdldC5jbG9zZXN0KCcjam95c3RpY2staGl0LXpvbmUnKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI2FjdGlvbi1idXR0b24nKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI3RhY2tsZS1idXR0b24nKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI2FpbS1qb3lzdGljay16b25lJykgfHwKICAgICAgICAgICAgICAgIGUudGFyZ2V0LmNsb3Nlc3QoJyNhdXRvLXRvZ2dsZScpIHx8CiAgICAgICAgICAgICAgICBlLnRhcmdldC5jbG9zZXN0KCcjc2V0dGluZ3MtYnV0dG9uJykpIHJldHVybjsKICAgICAgICAgICAgb25Td2lwZUVuZChlLmNoYW5nZWRUb3VjaGVzWzBdLmNsaWVudFgsIGUuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vIE1vdXNlIFN3aXBlCiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIChlKSA9PiB7CiAgICAgICAgICAgIGlmIChlLnRhcmdldC5jbG9zZXN0KCcjam95c3RpY2staGl0LXpvbmUnKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI2FjdGlvbi1idXR0b24nKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI3RhY2tsZS1idXR0b24nKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI2FpbS1qb3lzdGljay16b25lJykgfHwKICAgICAgICAgICAgICAgIGUudGFyZ2V0LmNsb3Nlc3QoJyNhdXRvLXRvZ2dsZScpIHx8CiAgICAgICAgICAgICAgICBlLnRhcmdldC5jbG9zZXN0KCcjc2V0dGluZ3MtYnV0dG9uJykpIHJldHVybjsKICAgICAgICAgICAgb25Td2lwZVN0YXJ0KGUuY2xpZW50WCwgZS5jbGllbnRZKTsKICAgICAgICAgICAgY3JlYXRlUmlwcGxlKGUuY2xpZW50WCwgZS5jbGllbnRZKTsKICAgICAgICB9KTsKCiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCAoZSkgPT4gewogICAgICAgICAgICBpZiAoZS50YXJnZXQuY2xvc2VzdCgnI2pveXN0aWNrLWhpdC16b25lJykgfHwKICAgICAgICAgICAgICAgIGUudGFyZ2V0LmNsb3Nlc3QoJyNhY3Rpb24tYnV0dG9uJykgfHwKICAgICAgICAgICAgICAgIGUudGFyZ2V0LmNsb3Nlc3QoJyN0YWNrbGUtYnV0dG9uJykgfHwKICAgICAgICAgICAgICAgIGUudGFyZ2V0LmNsb3Nlc3QoJyNhaW0tam95c3RpY2stem9uZScpIHx8CiAgICAgICAgICAgICAgICBlLnRhcmdldC5jbG9zZXN0KCcjYXV0by10b2dnbGUnKSB8fAogICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnI3NldHRpbmdzLWJ1dHRvbicpKSByZXR1cm47CiAgICAgICAgICAgIG9uU3dpcGVFbmQoZS5jbGllbnRYLCBlLmNsaWVudFkpOwogICAgICAgIH0pOwoKICAgICAgICAvLyBBY3Rpb24gQnV0dG9uIChTaG9vdC9QYXNzKQogICAgICAgIGNvbnN0IGFjdGlvbkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY3Rpb24tYnV0dG9uJyk7CgogICAgICAgIGNvbnN0IHNldHVwQnV0dG9uID0gKGJ0bikgPT4gewogICAgICAgICAgICBpZiAoIWJ0bikgcmV0dXJuOwoKICAgICAgICAgICAgbGV0IGJ0blN0YXJ0WCA9IDA7CiAgICAgICAgICAgIGxldCBidG5TdGFydFkgPSAwOwogICAgICAgICAgICBsZXQgaXNEcmFnZ2luZyA9IGZhbHNlOwoKICAgICAgICAgICAgY29uc3QgYXR0ZW1wdEFjdGlvbiA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGlmICghX2hvbWVUZWFtIHx8ICFfaG9tZVRlYW0uYWN0aXZlUGxheWVyKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBjb25zdCBwID0gX2hvbWVUZWFtLmFjdGl2ZVBsYXllcjsKCiAgICAgICAgICAgICAgICBpZiAocC5oYXNCYWxsICYmICFwLmlzQ2hhcmdpbmcgJiYgIXAuaXNUaHJvd2luZyAmJiBwLnN0YXR1cy5uYXAgPD0gMCkgewogICAgICAgICAgICAgICAgICAgIHAuc3RhcnRDaGFyZ2UoKTsKICAgICAgICAgICAgICAgICAgICBidG4uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBjb25zdCBoYW5kbGVTdGFydCA9IChlKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoZS5jYW5jZWxhYmxlKSBlLnByZXZlbnREZWZhdWx0KCk7CgogICAgICAgICAgICAgICAgaWYgKF9nYW1lTWFuYWdlciAmJiBfZ2FtZU1hbmFnZXIudGVjaENvcHlTdGF0ZS5hY3RpdmUpIHsKICAgICAgICAgICAgICAgICAgICBfZ2FtZU1hbmFnZXIuYXR0ZW1wdFRlY2hDb3B5KCk7CiAgICAgICAgICAgICAgICAgICAgYnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gYnRuLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpLCAxMDApOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoX2dhbWVNYW5hZ2VyICYmIF9nYW1lTWFuYWdlci5pc0RlbW9Nb2RlKSByZXR1cm47CgogICAgICAgICAgICAgICAgY29uc3QgY2xpZW50WCA9IGUudG91Y2hlcyA/IGUudG91Y2hlc1swXS5jbGllbnRYIDogZS5jbGllbnRYOwogICAgICAgICAgICAgICAgY29uc3QgY2xpZW50WSA9IGUudG91Y2hlcyA/IGUudG91Y2hlc1swXS5jbGllbnRZIDogZS5jbGllbnRZOwogICAgICAgICAgICAgICAgYnRuU3RhcnRYID0gY2xpZW50WDsKICAgICAgICAgICAgICAgIGJ0blN0YXJ0WSA9IGNsaWVudFk7CiAgICAgICAgICAgICAgICBpc0RyYWdnaW5nID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICBfYWN0aW9uQnVmZmVyLmFjdGl2ZSA9IHRydWU7CiAgICAgICAgICAgICAgICBfYWN0aW9uQnVmZmVyLnRpbWVzdGFtcCA9IERhdGUubm93KCk7CgogICAgICAgICAgICAgICAgaWYgKGF0dGVtcHRBY3Rpb24oKSkgewogICAgICAgICAgICAgICAgICAgIF9hY3Rpb25CdWZmZXIuYWN0aXZlID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBjb25zdCBoYW5kbGVFbmQgPSAoZSkgPT4gewogICAgICAgICAgICAgICAgaWYgKGUuY2FuY2VsYWJsZSkgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgX2FjdGlvbkJ1ZmZlci5hY3RpdmUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGlzRHJhZ2dpbmcgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICBsZXQgZHggPSAwLCBkeSA9IDA7CgogICAgICAgICAgICAgICAgY29uc3QgY2xpZW50WCA9IGUuY2hhbmdlZFRvdWNoZXMgPyBlLmNoYW5nZWRUb3VjaGVzWzBdLmNsaWVudFggOiBlLmNsaWVudFg7CiAgICAgICAgICAgICAgICBjb25zdCBjbGllbnRZID0gZS5jaGFuZ2VkVG91Y2hlcyA/IGUuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WSA6IGUuY2xpZW50WTsKCiAgICAgICAgICAgICAgICBkeCA9IGNsaWVudFggLSBidG5TdGFydFg7CiAgICAgICAgICAgICAgICBkeSA9IGNsaWVudFkgLSBidG5TdGFydFk7CgogICAgICAgICAgICAgICAgaWYgKF9ob21lVGVhbSAmJiBfaG9tZVRlYW0uYWN0aXZlUGxheWVyKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IF9ob21lVGVhbS5hY3RpdmVQbGF5ZXI7CiAgICAgICAgICAgICAgICAgICAgaWYgKHAuaXNDaGFyZ2luZykgewogICAgICAgICAgICAgICAgICAgICAgICBwLnJlbGVhc2VDaGFyZ2UoZHgsIGR5KTsKICAgICAgICAgICAgICAgICAgICAgICAgYnRuLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgaGFuZGxlU3RhcnQsIHsgcGFzc2l2ZTogZmFsc2UgfSk7CiAgICAgICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBoYW5kbGVTdGFydCk7CiAgICAgICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIGhhbmRsZUVuZCk7CiAgICAgICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgaGFuZGxlRW5kKTsKICAgICAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbGVhdmUnLCBoYW5kbGVFbmQpOwogICAgICAgIH07CgogICAgICAgIHNldHVwQnV0dG9uKGFjdGlvbkJ0bik7CgogICAgICAgIC8vIEF1dG8gVG9nZ2xlCiAgICAgICAgY29uc3QgYXV0b0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhdXRvLXRvZ2dsZScpOwogICAgICAgIGlmIChhdXRvQnRuKSB7CiAgICAgICAgICAgIGNvbnN0IGhhbmRsZVRvZ2dsZSA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGlmIChfZ2FtZU1hbmFnZXIpIHsKICAgICAgICAgICAgICAgICAgICBfZ2FtZU1hbmFnZXIudG9nZ2xlRGVtb01vZGUoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoX2hvbWVUZWFtICYmIF9ob21lVGVhbS5hY3RpdmVQbGF5ZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2hvbWVUZWFtLmFjdGl2ZVBsYXllci5zZXRJbnB1dCgwLCAwKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBhdXRvQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlVG9nZ2xlKTsKICAgICAgICAgICAgYXV0b0J0bi5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgKGUpID0+IHsKICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIGhhbmRsZVRvZ2dsZSgpOwogICAgICAgICAgICB9LCB7IHBhc3NpdmU6IGZhbHNlIH0pOwogICAgICAgIH0KCiAgICAgICAgLy8gTkVXOiBTZXR0aW5ncyBCdXR0b24KICAgICAgICBzZXR1cFNldHRpbmdzQnV0dG9uKCk7CiAgICB9CgogICAgLy8gTkVXOiBBaW0gSm95c3RpY2sgU2V0dXAKICAgIGZ1bmN0aW9uIHNldHVwQWltSm95c3RpY2soKSB7CiAgICAgICAgY29uc3QgYWltWm9uZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhaW0tam95c3RpY2stem9uZScpOwogICAgICAgIGNvbnN0IGFpbVZpc3VhbHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWltLWpveXN0aWNrLXZpc3VhbCcpOwogICAgICAgIGNvbnN0IGFpbUtub2IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWltLWpveXN0aWNrLWtub2InKTsKCiAgICAgICAgaWYgKCFhaW1ab25lKSByZXR1cm47CgogICAgICAgIGxldCBhaW1TdGFydFggPSAwLCBhaW1TdGFydFkgPSAwOwogICAgICAgIGxldCBhaW1EcmFnZ2luZyA9IGZhbHNlOwogICAgICAgIGNvbnN0IGFpbU1heERpc3QgPSAzNTsKCiAgICAgICAgY29uc3QgaGFuZGxlQWltU3RhcnQgPSAoY2xpZW50WCwgY2xpZW50WSkgPT4gewogICAgICAgICAgICBhaW1EcmFnZ2luZyA9IHRydWU7CiAgICAgICAgICAgIGFpbVN0YXJ0WCA9IGNsaWVudFg7CiAgICAgICAgICAgIGFpbVN0YXJ0WSA9IGNsaWVudFk7CiAgICAgICAgICAgIF9haW1JbnB1dC5hY3RpdmUgPSB0cnVlOwoKICAgICAgICAgICAgaWYgKGFpbVZpc3VhbHMpIHsKICAgICAgICAgICAgICAgIGFpbVZpc3VhbHMuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgICAgICBhaW1WaXN1YWxzLnN0eWxlLmxlZnQgPSBgJHtjbGllbnRYfXB4YDsKICAgICAgICAgICAgICAgIGFpbVZpc3VhbHMuc3R5bGUudG9wID0gYCR7Y2xpZW50WX1weGA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGFpbUtub2IpIHsKICAgICAgICAgICAgICAgIGFpbUtub2Iuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSgtNTAlLCAtNTAlKWA7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBjb25zdCBoYW5kbGVBaW1Nb3ZlID0gKGNsaWVudFgsIGNsaWVudFkpID0+IHsKICAgICAgICAgICAgaWYgKCFhaW1EcmFnZ2luZykgcmV0dXJuOwoKICAgICAgICAgICAgbGV0IGR4ID0gY2xpZW50WCAtIGFpbVN0YXJ0WDsKICAgICAgICAgICAgbGV0IGR5ID0gY2xpZW50WSAtIGFpbVN0YXJ0WTsKCiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLnNxcnQoZHgqZHggKyBkeSpkeSk7CgogICAgICAgICAgICBpZiAoZGlzdCA+IGFpbU1heERpc3QpIHsKICAgICAgICAgICAgICAgIGR4ID0gKGR4IC8gZGlzdCkgKiBhaW1NYXhEaXN0OwogICAgICAgICAgICAgICAgZHkgPSAoZHkgLyBkaXN0KSAqIGFpbU1heERpc3Q7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChhaW1Lbm9iKSB7CiAgICAgICAgICAgICAgICBhaW1Lbm9iLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoY2FsYygtNTAlICsgJHtkeH1weCksIGNhbGMoLTUwJSArICR7ZHl9cHgpKWA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIE5vcm1hbGl6ZSBhbmQgdHJhbnNmb3JtIHRvIHdvcmxkIHNwYWNlCiAgICAgICAgICAgIF9haW1JbnB1dC54ID0gZHggLyBhaW1NYXhEaXN0OwogICAgICAgICAgICBfYWltSW5wdXQueSA9IGR5IC8gYWltTWF4RGlzdDsKCiAgICAgICAgICAgIC8vIEFwcGx5IGFpbSB0byBwbGF5ZXIgaWYgY2hhcmdpbmcKICAgICAgICAgICAgaWYgKF9ob21lVGVhbSAmJiBfaG9tZVRlYW0uYWN0aXZlUGxheWVyKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwID0gX2hvbWVUZWFtLmFjdGl2ZVBsYXllcjsKICAgICAgICAgICAgICAgIGlmIChwLmlzQ2hhcmdpbmcgfHwgcC5pc1Rocm93aW5nKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gVHJhbnNmb3JtIHNjcmVlbiBhaW0gdG8gd29ybGQgc3BhY2UKICAgICAgICAgICAgICAgICAgICBfY2FtZXJhLmdldFdvcmxkRGlyZWN0aW9uKF9jYW1Gd2QpOwogICAgICAgICAgICAgICAgICAgIF9jYW1Gd2QueSA9IDA7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9jYW1Gd2QubGVuZ3RoU3EoKSA8IDAuMDAxKSBfY2FtRndkLnNldCgwLCAwLCAtMSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBfY2FtRndkLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgICAgIF9jYW1SaWdodC5jcm9zc1ZlY3RvcnMoX2NhbUZ3ZCwgX3VwQXhpcykubm9ybWFsaXplKCk7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdvcmxkWCA9IChfY2FtUmlnaHQueCAqIF9haW1JbnB1dC54KSArIChfY2FtRndkLnggKiAtX2FpbUlucHV0LnkpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdvcmxkWiA9IChfY2FtUmlnaHQueiAqIF9haW1JbnB1dC54KSArIChfY2FtRndkLnogKiAtX2FpbUlucHV0LnkpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnMod29ybGRYKSA+IDAuMSB8fCBNYXRoLmFicyh3b3JsZFopID4gMC4xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHAuc2V0T3ZlcnJpZGVBaW0od29ybGRYLCB3b3JsZFopOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIGNvbnN0IGhhbmRsZUFpbUVuZCA9ICgpID0+IHsKICAgICAgICAgICAgaWYgKCFhaW1EcmFnZ2luZykgcmV0dXJuOwogICAgICAgICAgICBhaW1EcmFnZ2luZyA9IGZhbHNlOwogICAgICAgICAgICBfYWltSW5wdXQuYWN0aXZlID0gZmFsc2U7CiAgICAgICAgICAgIF9haW1JbnB1dC54ID0gMDsKICAgICAgICAgICAgX2FpbUlucHV0LnkgPSAwOwoKICAgICAgICAgICAgaWYgKGFpbVZpc3VhbHMpIHsKICAgICAgICAgICAgICAgIGFpbVZpc3VhbHMuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIGFpbVpvbmUuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIChlKSA9PiB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgaGFuZGxlQWltU3RhcnQoZS50b3VjaGVzWzBdLmNsaWVudFgsIGUudG91Y2hlc1swXS5jbGllbnRZKTsKICAgICAgICB9LCB7IHBhc3NpdmU6IGZhbHNlIH0pOwoKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgKGUpID0+IHsKICAgICAgICAgICAgaWYgKGFpbURyYWdnaW5nKSB7CiAgICAgICAgICAgICAgICBpZiAoZS5jYW5jZWxhYmxlKSBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICBoYW5kbGVBaW1Nb3ZlKGUudG91Y2hlc1swXS5jbGllbnRYLCBlLnRvdWNoZXNbMF0uY2xpZW50WSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7IHBhc3NpdmU6IGZhbHNlIH0pOwoKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCAoZSkgPT4gewogICAgICAgICAgICBpZiAoYWltRHJhZ2dpbmcpIHsKICAgICAgICAgICAgICAgIGhhbmRsZUFpbUVuZCgpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIC8vIE1vdXNlIHN1cHBvcnQgZm9yIGRlc2t0b3AgdGVzdGluZwogICAgICAgIGFpbVpvbmUuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgKGUpID0+IHsKICAgICAgICAgICAgaGFuZGxlQWltU3RhcnQoZS5jbGllbnRYLCBlLmNsaWVudFkpOwogICAgICAgIH0pOwogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCAoZSkgPT4gewogICAgICAgICAgICBpZiAoYWltRHJhZ2dpbmcpIGhhbmRsZUFpbU1vdmUoZS5jbGllbnRYLCBlLmNsaWVudFkpOwogICAgICAgIH0pOwogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgKGUpID0+IHsKICAgICAgICAgICAgaWYgKGFpbURyYWdnaW5nKSBoYW5kbGVBaW1FbmQoKTsKICAgICAgICB9KTsKICAgIH0KCiAgICAvLyBORVc6IFRhY2tsZSBCdXR0b24gU2V0dXAKICAgIGZ1bmN0aW9uIHNldHVwVGFja2xlQnV0dG9uKCkgewogICAgICAgIGNvbnN0IHRhY2tsZUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YWNrbGUtYnV0dG9uJyk7CiAgICAgICAgaWYgKCF0YWNrbGVCdG4pIHJldHVybjsKCiAgICAgICAgY29uc3QgaGFuZGxlVGFja2xlID0gKGUpID0+IHsKICAgICAgICAgICAgaWYgKGUuY2FuY2VsYWJsZSkgZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgaWYgKF9nYW1lTWFuYWdlciAmJiBfZ2FtZU1hbmFnZXIuaXNEZW1vTW9kZSkgcmV0dXJuOwoKICAgICAgICAgICAgaWYgKF9ob21lVGVhbSAmJiBfaG9tZVRlYW0uYWN0aXZlUGxheWVyKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwID0gX2hvbWVUZWFtLmFjdGl2ZVBsYXllcjsKCiAgICAgICAgICAgICAgICAvLyBJZiB3ZSBkb24ndCBoYXZlIHRoZSBiYWxsLCBkYXNoL3RhY2tsZQogICAgICAgICAgICAgICAgaWYgKCFwLmhhc0JhbGwpIHsKICAgICAgICAgICAgICAgICAgICAvLyBHZXQgY3VycmVudCBtb3ZlbWVudCBkaXJlY3Rpb24gb3IgZm9yd2FyZAogICAgICAgICAgICAgICAgICAgIGxldCBkYXNoWCA9IHAuaW5wdXRWZWN0b3IueDsKICAgICAgICAgICAgICAgICAgICBsZXQgZGFzaFogPSBwLmlucHV0VmVjdG9yLno7CgogICAgICAgICAgICAgICAgICAgIC8vIElmIG5vdCBtb3ZpbmcsIGRhc2ggZm9yd2FyZAogICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyhkYXNoWCkgPCAwLjEgJiYgTWF0aC5hYnMoZGFzaFopIDwgMC4xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZ3ZCA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIDEpLmFwcGx5UXVhdGVybmlvbihwLm1lc2gucXVhdGVybmlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhc2hYID0gZndkLng7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhc2haID0gZndkLno7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBwLmRhc2goZGFzaFgsIGRhc2haKTsKCiAgICAgICAgICAgICAgICAgICAgdGFja2xlQnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGFja2xlQnRuLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpLCAyMDApOwoKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJUQUNLTEUhIiwgcC5tZXNoLnBvc2l0aW9uLCAidGVjaCIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocC5pc0VuZ2FnZWQpIHsKICAgICAgICAgICAgICAgICAgICAvLyBCcmVhayB0YWNrbGUgaWYgZW5nYWdlZAogICAgICAgICAgICAgICAgICAgIHAuZGFzaChwLmlucHV0VmVjdG9yLngsIHAuaW5wdXRWZWN0b3Iueik7CiAgICAgICAgICAgICAgICAgICAgdGFja2xlQnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGFja2xlQnRuLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpLCAyMDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgdGFja2xlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBoYW5kbGVUYWNrbGUsIHsgcGFzc2l2ZTogZmFsc2UgfSk7CiAgICAgICAgdGFja2xlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGhhbmRsZVRhY2tsZSk7CiAgICB9CgogICAgLy8gTkVXOiBTZXR0aW5ncyBCdXR0b24gU2V0dXAKLy8gTkVXOiBTZXR0aW5ncyBCdXR0b24gU2V0dXAKICAgIGZ1bmN0aW9uIHNldHVwU2V0dGluZ3NCdXR0b24oKSB7CiAgICAgICAgY29uc3Qgc2V0dGluZ3NCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2V0dGluZ3MtYnV0dG9uJyk7CiAgICAgICAgY29uc3Qgc2V0dGluZ3NQYW5lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZXR0aW5ncy1wYW5lbCcpOwogICAgICAgIGNvbnN0IHNldHRpbmdzQ2xvc2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2V0dGluZ3MtY2xvc2UnKTsKCiAgICAgICAgaWYgKCFzZXR0aW5nc0J0biB8fCAhc2V0dGluZ3NQYW5lbCkgcmV0dXJuOwoKICAgICAgICBzZXR0aW5nc0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgc2V0dGluZ3NQYW5lbC5zdHlsZS5kaXNwbGF5ID0gc2V0dGluZ3NQYW5lbC5zdHlsZS5kaXNwbGF5ID09PSAnbm9uZScgPyAnYmxvY2snIDogJ25vbmUnOwogICAgICAgIH0pOwoKICAgICAgICBpZiAoc2V0dGluZ3NDbG9zZSkgewogICAgICAgICAgICBzZXR0aW5nc0Nsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICAgICAgc2V0dGluZ3NQYW5lbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIC8vIFNlbnNpdGl2aXR5IHNsaWRlcgogICAgICAgIGNvbnN0IHNlbnNpdGl2aXR5U2xpZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbnNpdGl2aXR5LXNsaWRlcicpOwogICAgICAgIGlmIChzZW5zaXRpdml0eVNsaWRlcikgewogICAgICAgICAgICBzZW5zaXRpdml0eVNsaWRlci52YWx1ZSA9IF9zZXR0aW5ncy5qb3lzdGlja1NlbnNpdGl2aXR5ICogMTAwOwogICAgICAgICAgICBzZW5zaXRpdml0eVNsaWRlci5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIChlKSA9PiB7CiAgICAgICAgICAgICAgICBfc2V0dGluZ3Muam95c3RpY2tTZW5zaXRpdml0eSA9IGUudGFyZ2V0LnZhbHVlIC8gMTAwOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIC8vIEFpbSBhc3Npc3QgdG9nZ2xlCiAgICAgICAgY29uc3QgYWltQXNzaXN0VG9nZ2xlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FpbS1hc3Npc3QtdG9nZ2xlJyk7CiAgICAgICAgaWYgKGFpbUFzc2lzdFRvZ2dsZSkgewogICAgICAgICAgICBhaW1Bc3Npc3RUb2dnbGUuY2hlY2tlZCA9IF9zZXR0aW5ncy5haW1Bc3Npc3Q7CiAgICAgICAgICAgIGFpbUFzc2lzdFRvZ2dsZS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4gewogICAgICAgICAgICAgICAgX3NldHRpbmdzLmFpbUFzc2lzdCA9IGUudGFyZ2V0LmNoZWNrZWQ7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgLy8gQ2FtZXJhIHNoYWtlIHRvZ2dsZQogICAgICAgIGNvbnN0IHNoYWtlVG9nZ2xlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NoYWtlLXRvZ2dsZScpOwogICAgICAgIGlmIChzaGFrZVRvZ2dsZSkgewogICAgICAgICAgICBzaGFrZVRvZ2dsZS5jaGVja2VkID0gX3NldHRpbmdzLmNhbWVyYVNoYWtlOwogICAgICAgICAgICBzaGFrZVRvZ2dsZS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4gewogICAgICAgICAgICAgICAgX3NldHRpbmdzLmNhbWVyYVNoYWtlID0gZS50YXJnZXQuY2hlY2tlZDsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICAvLyBWb2x1bWUgc2xpZGVyCiAgICAgICAgY29uc3Qgdm9sdW1lU2xpZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZvbHVtZS1zbGlkZXInKTsKICAgICAgICBpZiAodm9sdW1lU2xpZGVyICYmIF9hdWRpb01hbmFnZXIpIHsKICAgICAgICAgICAgdm9sdW1lU2xpZGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKGUpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHZvbCA9IGUudGFyZ2V0LnZhbHVlIC8gMTAwOwogICAgICAgICAgICAgICAgX2F1ZGlvTWFuYWdlci5zZXRWb2x1bWUodm9sKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICAvLyBFeGl0IHRvIE1lbnUKICAgICAgICBjb25zdCBleGl0QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4aXQtdG8tbWVudS1idG4nKTsKICAgICAgICBpZiAoZXhpdEJ0bikgewogICAgICAgICAgICBleGl0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKF9tZW51TWFuYWdlcikgewogICAgICAgICAgICAgICAgICAgIF9tZW51TWFuYWdlci5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9nYW1lTWFuYWdlcikgewogICAgICAgICAgICAgICAgICAgICAgICBfZ2FtZU1hbmFnZXIuc3RhdGUgPSAnbWVudSc7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN0b3AgcHJhY3RpY2UgaWYgcnVubmluZwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoX2dhbWVNYW5hZ2VyLnByYWN0aWNlTWFuYWdlcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2dhbWVNYW5hZ2VyLnByYWN0aWNlTWFuYWdlci5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVzZXQgY2FtZXJhIHRvIG1lbnUgb3JiaXQgaWYgbmVlZGVkCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfZ2FtZU1hbmFnZXIuY2FtZXJhTWFuYWdlcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gT3B0aW9uYWw6IFJlc2V0IGNhbWVyYSBwYXJhbWV0ZXJzCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NQYW5lbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gdXBkYXRlSW5wdXRWZWN0b3IoKSB7CiAgICAgICAgbGV0IHggPSBfaW5wdXQueCB8fCAwOwogICAgICAgIGxldCB6ID0gX2lucHV0LnkgfHwgMDsKCiAgICAgICAgaWYgKF9rZXlzWyd3J10gfHwgX2tleXNbJ0Fycm93VXAnXSkgeiAtPSAxOwogICAgICAgIGlmIChfa2V5c1sncyddIHx8IF9rZXlzWydBcnJvd0Rvd24nXSkgeiArPSAxOwogICAgICAgIGlmIChfa2V5c1snYSddIHx8IF9rZXlzWydBcnJvd0xlZnQnXSkgeCAtPSAxOwogICAgICAgIGlmIChfa2V5c1snZCddIHx8IF9rZXlzWydBcnJvd1JpZ2h0J10pIHggKz0gMTsKCiAgICAgICAgY29uc3QgbGVuU3EgPSB4KnggKyB6Kno7CiAgICAgICAgaWYgKGxlblNxID4gMSkgewogICAgICAgICAgICBjb25zdCBsZW4gPSBNYXRoLnNxcnQobGVuU3EpOwogICAgICAgICAgICB4IC89IGxlbjsKICAgICAgICAgICAgeiAvPSBsZW47CiAgICAgICAgfQoKICAgICAgICBpZiAoaXNOYU4oeCkpIHggPSAwOwogICAgICAgIGlmIChpc05hTih6KSkgeiA9IDA7CgogICAgICAgIGlmIChfY2FtZXJhKSB7CiAgICAgICAgICAgIF9jYW1lcmEuZ2V0V29ybGREaXJlY3Rpb24oX2NhbUZ3ZCk7CiAgICAgICAgICAgIF9jYW1Gd2QueSA9IDA7CgogICAgICAgICAgICBpZiAoX2NhbUZ3ZC5sZW5ndGhTcSgpIDwgMC4wMDEpIHsKICAgICAgICAgICAgICAgIF9jYW1Gd2Quc2V0KDAsIDAsIC0xKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIF9jYW1Gd2Qubm9ybWFsaXplKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9jYW1SaWdodC5jcm9zc1ZlY3RvcnMoX2NhbUZ3ZCwgX3VwQXhpcykubm9ybWFsaXplKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX2NhbUZ3ZC5zZXQoMCwgMCwgLTEpOwogICAgICAgICAgICBfY2FtUmlnaHQuc2V0KDEsIDAsIDApOwogICAgICAgIH0KCiAgICAgICAgbGV0IHdvcmxkWCA9IChfY2FtRndkLnggKiAteikgKyAoX2NhbVJpZ2h0LnggKiB4KTsKICAgICAgICBsZXQgd29ybGRaID0gKF9jYW1Gd2QueiAqIC16KSArIChfY2FtUmlnaHQueiAqIHgpOwoKICAgICAgICBpZiAoaXNOYU4od29ybGRYKSB8fCBpc05hTih3b3JsZFopKSB7CiAgICAgICAgICAgIHdvcmxkWCA9IDA7CiAgICAgICAgICAgIHdvcmxkWiA9IDA7CiAgICAgICAgfQoKICAgICAgICBpZiAoX2hvbWVUZWFtICYmIF9ob21lVGVhbS5hY3RpdmVQbGF5ZXIpIHsKICAgICAgICAgICAgaWYgKF9nYW1lTWFuYWdlciAmJiAhX2dhbWVNYW5hZ2VyLmlzRGVtb01vZGUpIHsKICAgICAgICAgICAgICAgIF9ob21lVGVhbS5hY3RpdmVQbGF5ZXIuc2V0SW5wdXQod29ybGRYLCB3b3JsZFopOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGNyZWF0ZVJpcHBsZSh4LCB5KSB7CiAgICAgICAgY29uc3QgcmlwcGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgcmlwcGxlLmNsYXNzTmFtZSA9ICd0b3VjaC1yaXBwbGUnOwogICAgICAgIHJpcHBsZS5zdHlsZS5sZWZ0ID0gYCR7eH1weGA7CiAgICAgICAgcmlwcGxlLnN0eWxlLnRvcCA9IGAke3l9cHhgOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1aS1sYXllcicpLmFwcGVuZENoaWxkKHJpcHBsZSk7CgogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICBpZiAocmlwcGxlLnBhcmVudE5vZGUpIHJpcHBsZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHJpcHBsZSk7CiAgICAgICAgfSwgNjAwKTsKICAgIH0KCmZ1bmN0aW9uIG9uUmVzaXplKCkgewogICAgICAgIGNvbnN0IHdpZHRoID0gd2luZG93LmlubmVyV2lkdGg7CiAgICAgICAgY29uc3QgaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0OwogICAgICAgIAogICAgICAgIGlmIChfY2FtZXJhKSB7CiAgICAgICAgICAgIF9jYW1lcmEuYXNwZWN0ID0gd2lkdGggLyBoZWlnaHQ7CiAgICAgICAgICAgIF9jYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBTdHJpY3RseSAwLjUwIGFzIHJlcXVlc3RlZAogICAgICAgIGNvbnN0IHJlc1NjYWxlID0gMC41MDsKICAgICAgICAKICAgICAgICBfY29uZmlnLmludGVybmFsV2lkdGggPSBNYXRoLmZsb29yKHdpZHRoICogcmVzU2NhbGUpOwogICAgICAgIF9jb25maWcuaW50ZXJuYWxIZWlnaHQgPSBNYXRoLmZsb29yKGhlaWdodCAqIHJlc1NjYWxlKTsKCiAgICAgICAgaWYgKF9yZW5kZXJlcikgewogICAgICAgICAgICBfcmVuZGVyZXIuc2V0U2l6ZShfY29uZmlnLmludGVybmFsV2lkdGgsIF9jb25maWcuaW50ZXJuYWxIZWlnaHQsIGZhbHNlKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CgogICAgICAgIGNvbnN0IHJhd0R0ID0gX2Nsb2NrLmdldERlbHRhKCk7CmNvbnN0IGR0ID0gcmF3RHQgKiAod2luZG93LmZsdXgudGltZVNjYWxlICE9PSB1bmRlZmluZWQgPyB3aW5kb3cuZmx1eC50aW1lU2NhbGUgOiAwLjgpOyAvLyBEZWZhdWx0IDgwJSBzcGVlZAoKICAgICAgICAvLyBJbXBhY3QgRnJhbWVzCiAgICAgICAgaWYgKF9nYW1lTWFuYWdlciAmJiBfZ2FtZU1hbmFnZXIuaW1wYWN0UGF1c2UgPiAwKSB7CiAgICAgICAgICAgIF9nYW1lTWFuYWdlci5pbXBhY3RQYXVzZSAtPSBkdDsKICAgICAgICAgICAgaWYgKF9yZW5kZXJlciAmJiBfc2NlbmUgJiYgX2NhbWVyYSkgewogICAgICAgICAgICAgICAgX3JlbmRlcmVyLnJlbmRlcihfc2NlbmUsIF9jYW1lcmEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHVwZGF0ZUlucHV0VmVjdG9yKCk7CgogICAgICAgIC8vIEFjdGlvbiBCdWZmZXIgUHJvY2Vzc2luZwogICAgICAgIGlmIChfYWN0aW9uQnVmZmVyLmFjdGl2ZSkgewogICAgICAgICAgICBpZiAoRGF0ZS5ub3coKSAtIF9hY3Rpb25CdWZmZXIudGltZXN0YW1wID4gX2FjdGlvbkJ1ZmZlci5kdXJhdGlvbikgewogICAgICAgICAgICAgICAgX2FjdGlvbkJ1ZmZlci5hY3RpdmUgPSBmYWxzZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChfaG9tZVRlYW0gJiYgX2hvbWVUZWFtLmFjdGl2ZVBsYXllcikgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBfaG9tZVRlYW0uYWN0aXZlUGxheWVyOwoKICAgICAgICAgICAgICAgICAgICBpZiAocC5oYXNCYWxsICYmICFwLmlzQ2hhcmdpbmcgJiYgIXAuaXNUaHJvd2luZyAmJiBwLnN0YXR1cy5uYXAgPD0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBwLnN0YXJ0Q2hhcmdlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY3Rpb24tYnV0dG9uJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChidG4pIGJ0bi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgX2FjdGlvbkJ1ZmZlci5hY3RpdmUgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIE1lbnUgU3RhdGUgSGFuZGxpbmcKICAgICAgICBpZiAoX2dhbWVNYW5hZ2VyICYmIF9nYW1lTWFuYWdlci5zdGF0ZSA9PT0gJ21lbnUnICYmIF9jYW1lcmEpIHsKICAgICAgICAgICAgY29uc3QgdGltZSA9IERhdGUubm93KCkgKiAwLjAwMDU7CiAgICAgICAgICAgIGNvbnN0IHJhZGl1cyA9IDUwOwogICAgICAgICAgICBfY2FtZXJhLnBvc2l0aW9uLnggPSBNYXRoLnNpbih0aW1lKSAqIHJhZGl1czsKICAgICAgICAgICAgX2NhbWVyYS5wb3NpdGlvbi56ID0gTWF0aC5jb3ModGltZSkgKiByYWRpdXM7CiAgICAgICAgICAgIF9jYW1lcmEucG9zaXRpb24ueSA9IDIwOwogICAgICAgICAgICBfY2FtZXJhLmxvb2tBdCgwLCAwLCAwKTsKCiAgICAgICAgICAgIGlmIChfcmVuZGVyZXIgJiYgX3NjZW5lKSB7CiAgICAgICAgICAgICAgICBfcmVuZGVyZXIucmVuZGVyKF9zY2VuZSwgX2NhbWVyYSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKF9nYW1lTWFuYWdlcikgX2dhbWVNYW5hZ2VyLnVwZGF0ZShkdCk7CgogICAgICAgIC8vIFVwZGF0ZSBFbnRpdGllcwogICAgICAgIGlmIChfaG9tZVRlYW0pIHsKICAgICAgICAgICAgX2hvbWVUZWFtLnVwZGF0ZShkdCk7CiAgICAgICAgICAgIF9ob21lVGVhbS5wbGF5ZXJzLmZvckVhY2gocCA9PiBjaGVja0JhbGxHcmFiKHApKTsKICAgICAgICB9CgogICAgICAgIGlmIChfYXdheVRlYW0pIHsKICAgICAgICAgICAgX2F3YXlUZWFtLnVwZGF0ZShkdCk7CiAgICAgICAgICAgIF9hd2F5VGVhbS5wbGF5ZXJzLmZvckVhY2gocCA9PiBjaGVja0JhbGxHcmFiKHApKTsKICAgICAgICB9CgogICAgICAgIGlmIChfYmFsbCkgewogICAgICAgICAgICBfYmFsbC51cGRhdGUoZHQpOwogICAgICAgIH0KCiAgICAgICAgLy8gVXBkYXRlIENhbWVyYQovLyBVcGRhdGUgQ2FtZXJhCiAgICAgICAgdXBkYXRlQ2FtZXJhTG9naWMoZHQpOwovLyBVcGRhdGUgVmlzdWFscwogICAgICAgIGlmIChfd2F0ZXJPdmVybGF5KSBfd2F0ZXJPdmVybGF5LnVwZGF0ZShkdCk7CiAgICAgICAgaWYgKF9saWdodFNoYWZ0cykgX2xpZ2h0U2hhZnRzLnVwZGF0ZShkdCk7CiAgICAgICAgaWYgKF9zdGFkaXVtKSBfc3RhZGl1bS51cGRhdGUoZHQpOwogICAgICAgIGlmIChfZ2x5cGhNYW5hZ2VyKSBfZ2x5cGhNYW5hZ2VyLnVwZGF0ZShkdCk7CgppZiAoX3JlbmRlcmVyICYmIF9zY2VuZSAmJiBfY2FtZXJhKSB7CiAgICAgICAgICAgIF9yZW5kZXJlci5yZW5kZXIoX3NjZW5lLCBfY2FtZXJhKTsKICAgICAgICB9CgogICAgICAgIC8vIFVJIFVwZGF0ZXMKICAgICAgICB1cGRhdGVVSSgpOwogICAgfQoKICAgIGZ1bmN0aW9uIHVwZGF0ZVVJKCkgewogICAgICAgIGlmICghX2hvbWVUZWFtIHx8ICFfaG9tZVRlYW0uYWN0aXZlUGxheWVyKSByZXR1cm47CgogICAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY3Rpb24tYnV0dG9uJyk7CiAgICAgICAgY29uc3QgbGJsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FjdGlvbi1sYWJlbCcpOwogICAgICAgIGNvbnN0IHRhY2tsZUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YWNrbGUtYnV0dG9uJyk7CiAgICAgICAgY29uc3QgcCA9IF9ob21lVGVhbS5hY3RpdmVQbGF5ZXI7CgogICAgICAgIGlmIChidG4gJiYgbGJsKSB7CiAgICAgICAgICAgIGNvbnN0IGJ0blRleHQgPSBidG4ucXVlcnlTZWxlY3RvcignLmJ0bi10ZXh0Jyk7CgogICAgICAgICAgICBpZiAocC5oYXNCYWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoYnRuVGV4dCAmJiBidG5UZXh0LmlubmVyVGV4dCAhPT0gIkFDVElPTiIpIHsKICAgICAgICAgICAgICAgICAgICBidG5UZXh0LmlubmVyVGV4dCA9ICJBQ1RJT04iOwogICAgICAgICAgICAgICAgICAgIGJ0bi5jbGFzc0xpc3QuYWRkKCdzaG9vdC1tb2RlJyk7CiAgICAgICAgICAgICAgICAgICAgbGJsLmlubmVyVGV4dCA9ICJPRkZFTlNFIjsKICAgICAgICAgICAgICAgICAgICBsYmwuY2xhc3NMaXN0LmFkZCgnc2hvb3QtbGFiZWwnKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCBpc0hpZ2hFbmVyZ3kgPSAocC5zdGF0cy5IUCAvIHAuc3RhdHMubWF4SFApID4gMC40OwogICAgICAgICAgICAgICAgaWYgKGlzSGlnaEVuZXJneSkgewogICAgICAgICAgICAgICAgICAgIGlmICghYnRuLmNsYXNzTGlzdC5jb250YWlucygnbGltaXQtcmVhZHknKSkgYnRuLmNsYXNzTGlzdC5hZGQoJ2xpbWl0LXJlYWR5Jyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChidG4uY2xhc3NMaXN0LmNvbnRhaW5zKCdsaW1pdC1yZWFkeScpKSBidG4uY2xhc3NMaXN0LnJlbW92ZSgnbGltaXQtcmVhZHknKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoYnRuVGV4dCAmJiBidG5UZXh0LmlubmVyVGV4dCAhPT0gIlNXSU0iKSB7CiAgICAgICAgICAgICAgICAgICAgYnRuVGV4dC5pbm5lclRleHQgPSAiU1dJTSI7CiAgICAgICAgICAgICAgICAgICAgYnRuLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob290LW1vZGUnKTsKICAgICAgICAgICAgICAgICAgICBidG4uY2xhc3NMaXN0LnJlbW92ZSgnbGltaXQtcmVhZHknKTsKICAgICAgICAgICAgICAgICAgICBsYmwuaW5uZXJUZXh0ID0gIk5PUk1BTCI7CiAgICAgICAgICAgICAgICAgICAgbGJsLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob290LWxhYmVsJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFVwZGF0ZSB0YWNrbGUgYnV0dG9uIHZpc2liaWxpdHkKICAgICAgICBpZiAodGFja2xlQnRuKSB7CiAgICAgICAgICAgIGlmICghcC5oYXNCYWxsIHx8IHAuaXNFbmdhZ2VkKSB7CiAgICAgICAgICAgICAgICB0YWNrbGVCdG4uc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0YWNrbGUgYnV0dG9uIHRleHQgYmFzZWQgb24gY29udGV4dAogICAgICAgICAgICAgICAgY29uc3QgdGFja2xlVGV4dCA9IHRhY2tsZUJ0bi5xdWVyeVNlbGVjdG9yKCcuYnRuLXRleHQnKTsKICAgICAgICAgICAgICAgIGlmICh0YWNrbGVUZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHAuaXNFbmdhZ2VkICYmIHAuaGFzQmFsbCkgewp0YWNrbGVUZXh0LmlubmVyVGV4dCA9ICdCUkVBSyc7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhY2tsZUJ0bi5jbGFzc0xpc3QuYWRkKCd1cmdlbnQnKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0YWNrbGVUZXh0LmlubmVyVGV4dCA9ICdUQUNLTEUnOwogICAgICAgICAgICAgICAgICAgICAgICB0YWNrbGVCdG4uY2xhc3NMaXN0LnJlbW92ZSgndXJnZW50Jyk7CiAgICAgICAgICAgICAgICAgICAgfQp9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0YWNrbGVCdG4uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gVXBkYXRlIGRpc3RhbmNlIHRvIGdvYWwgaW5kaWNhdG9yCiAgICAgICAgY29uc3QgZGlzdEluZGljYXRvciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnb2FsLWRpc3RhbmNlJyk7CiAgICAgICAgaWYgKGRpc3RJbmRpY2F0b3IgJiYgcC5tZXNoKSB7CiAgICAgICAgICAgIGNvbnN0IGdvYWxaID0gKHAudGVhbSAmJiBwLnRlYW0uc2lkZSA9PT0gMSkgPyAtMjggOiAyODsKICAgICAgICAgICAgY29uc3QgZGlzdCA9IE1hdGguYWJzKHAubWVzaC5wb3NpdGlvbi56IC0gZ29hbFopOwogICAgICAgICAgICBkaXN0SW5kaWNhdG9yLmlubmVyVGV4dCA9IGAke01hdGguZmxvb3IoZGlzdCl9bWA7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHVwZGF0ZUNhbWVyYUxvZ2ljKGR0KSB7CiAgICAgICAgaWYgKCFfY2FtZXJhTWFuYWdlciB8fCAhX2JhbGwpIHJldHVybjsKCiAgICAgICAgbGV0IHRhcmdldE1lc2ggPSBfYmFsbC5tZXNoOwogICAgICAgIGxldCB0YXJnZXRWZWwgPSBfYmFsbC52ZWxvY2l0eTsKICAgICAgICBsZXQgdGFyZ2V0SW5wdXQgPSBudWxsOwoKICAgICAgICBpZiAoX2JhbGwuaG9sZGVyICYmIF9iYWxsLmhvbGRlci5tZXNoKSB7CiAgICAgICAgICAgIHRhcmdldE1lc2ggPSBfYmFsbC5ob2xkZXIubWVzaDsKICAgICAgICAgICAgdGFyZ2V0VmVsID0gX2JhbGwuaG9sZGVyLnZlbG9jaXR5OwogICAgICAgICAgICBpZiAoX2JhbGwuaG9sZGVyLmlucHV0VmVjdG9yKSB7CiAgICAgICAgICAgICAgICB0YXJnZXRJbnB1dCA9IF9iYWxsLmhvbGRlci5pbnB1dFZlY3RvcjsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX2NhbWVyYU1hbmFnZXIuc2V0VGFyZ2V0KHRhcmdldE1lc2gsIHRhcmdldFZlbCwgdGFyZ2V0SW5wdXQpOwogICAgICAgIF9jYW1lcmFNYW5hZ2VyLnVwZGF0ZShkdCk7CiAgICB9CgpmdW5jdGlvbiBjaGVja0JhbGxHcmFiKGVudGl0eSkgewogICAgICAgIGlmICghZW50aXR5LmNhbkNhdGNoKSByZXR1cm47CiAgICAgICAgaWYgKF9iYWxsICYmICFfYmFsbC5pc0NhdGNoYWJsZSgpKSByZXR1cm47CiAgICAgICAgaWYgKGVudGl0eS5zdHVuVGltZXIgPiAwIHx8IChlbnRpdHkuc3RhdHVzICYmIGVudGl0eS5zdGF0dXMubmFwID4gMCkpIHJldHVybjsKICAgICAgICBpZiAoX2JhbGwuc3RhdGUgIT09ICdmcmVlJykgcmV0dXJuOwogICAgICAgIGlmICghX2JhbGwubWVzaCB8fCAhZW50aXR5Lm1lc2gpIHJldHVybjsKCiAgICAgICAgY29uc3QgYmFsbFBvcyA9IF9iYWxsLm1lc2gucG9zaXRpb247CiAgICAgICAgY29uc3QgZW50UG9zID0gZW50aXR5Lm1lc2gucG9zaXRpb247CgogICAgICAgIGNvbnN0IGR4ID0gYmFsbFBvcy54IC0gZW50UG9zLng7CiAgICAgICAgY29uc3QgZHogPSBiYWxsUG9zLnogLSBlbnRQb3MuejsKICAgICAgICBjb25zdCBkaXN0WFogPSBNYXRoLnNxcnQoZHgqZHggKyBkeipkeik7CiAgICAgICAgY29uc3QgZGlzdFkgPSBNYXRoLmFicyhiYWxsUG9zLnkgLSBlbnRQb3MueSk7CgogICAgICAgIGNvbnN0IHRvdWNoUmFkaXVzID0gMS4wOyAvLyBSZWR1Y2VkIGZyb20gMS41CiAgICAgICAgLy8gUmVkdWNlZCByYWRpaSB0byBwcmV2ZW50ICJJbnZpc2libGUgV2FsbCIgY2F0Y2ggc25hcHBpbmcKICAgICAgICBsZXQgbWFnbmV0UmFkaXVzID0gMS44OyAvLyBSZWR1Y2VkIGZyb20gMi41CiAgICAgICAgbGV0IGludGVyYWN0aW9uUmFkaXVzID0gMy41OyAvLyBSZWR1Y2VkIGZyb20gNC4wCiAgICAgICAgbGV0IGNhdGNoSGVpZ2h0ID0gMy4wOyAvLyBSZWR1Y2VkIGZyb20gMy41CgogICAgICAgIGlmIChlbnRpdHkuaXNEYXNoaW5nKSB7CiAgICAgICAgICAgIG1hZ25ldFJhZGl1cyA9IDMuMDsKICAgICAgICAgICAgaW50ZXJhY3Rpb25SYWRpdXMgPSA0LjU7CiAgICAgICAgICAgIGNhdGNoSGVpZ2h0ID0gNC41OwogICAgICAgIH0KCiAgICAgICAgaWYgKGRpc3RYWiA+IGludGVyYWN0aW9uUmFkaXVzIHx8IGRpc3RZID4gY2F0Y2hIZWlnaHQpIHJldHVybjsKCiAgICAgICAgY29uc3QgdG9CYWxsID0gYmFsbFBvcy5jbG9uZSgpLnN1YihlbnRQb3MpLm5vcm1hbGl6ZSgpOwogICAgICAgIGNvbnN0IHBsYXllckZvcndhcmQgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAxKS5hcHBseVF1YXRlcm5pb24oZW50aXR5Lm1lc2gucXVhdGVybmlvbikubm9ybWFsaXplKCk7CgogICAgICAgIGNvbnN0IGZhY2luZ0RvdCA9IHBsYXllckZvcndhcmQuZG90KHRvQmFsbCk7CgogICAgICAgIGNvbnN0IGNvbmVUaHJlc2hvbGQgPSAtMC4yOwogICAgICAgIGNvbnN0IGlzSW5Db25lID0gZmFjaW5nRG90ID4gY29uZVRocmVzaG9sZDsKICAgICAgICBjb25zdCBpc0luVG91Y2ggPSBkaXN0WFogPCB0b3VjaFJhZGl1czsKCiAgICAgICAgaWYgKGRpc3RYWiA8IGludGVyYWN0aW9uUmFkaXVzICYmICFpc0luQ29uZSkgewogICAgICAgICAgICBjb25zdCB0YXJnZXRBbmdsZSA9IE1hdGguYXRhbjIodG9CYWxsLngsIHRvQmFsbC56KTsKICAgICAgICAgICAgY29uc3QgcSA9IG5ldyBUSFJFRS5RdWF0ZXJuaW9uKCkuc2V0RnJvbUF4aXNBbmdsZShuZXcgVEhSRUUuVmVjdG9yMygwLDEsMCksIHRhcmdldEFuZ2xlKTsKICAgICAgICAgICAgZW50aXR5Lm1lc2gucXVhdGVybmlvbi5zbGVycChxLCAwLjEpOwogICAgICAgICAgICBpZiAoZW50aXR5LnN5bmNSb3RhdGlvbikgZW50aXR5LnN5bmNSb3RhdGlvbigpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzSW5Ub3VjaCB8fCAoZGlzdFhaIDwgbWFnbmV0UmFkaXVzICYmIGlzSW5Db25lKSkgewogICAgICAgICAgICAvLyBCTEFTVCBUSFJPVUdIIExPR0lDCiAgICAgICAgICAgIGNvbnN0IGJhbGxTcGVlZCA9IF9iYWxsLnZlbG9jaXR5Lmxlbmd0aCgpOwogICAgICAgICAgICBsZXQgY2F0Y2hDaGFuY2UgPSAxLjA7CgogICAgICAgICAgICAvLyBJZiBiYWxsIGlzIG1vdmluZyBmYXN0IChlLmcuID4gMjApLCBjaGVjayBDQQogICAgICAgICAgICBpZiAoYmFsbFNwZWVkID4gMjAuMCkgewogICAgICAgICAgICAgICAgY29uc3QgY2EgPSBlbnRpdHkuZ2V0U3RhdCgnQ0EnKTsKICAgICAgICAgICAgICAgIC8vIERpZmZpY3VsdHkgc2NhbGVzIHdpdGggc3BlZWQuIAogICAgICAgICAgICAgICAgY29uc3QgZGlmZmljdWx0eSA9IGJhbGxTcGVlZCAqIDEuMjsgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChkaWZmaWN1bHR5ID4gY2EpIHsKICAgICAgICAgICAgICAgICAgICBjYXRjaENoYW5jZSA9IDAuNCArIChjYSAvIGRpZmZpY3VsdHkpICogMC42OwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFBvaW50IEJsYW5rIFBlbmFsdHk6IEhhcmRlciB0byByZWFjdCBpZiBiYWxsIGlzIHJpZ2h0IG9uIHRvcCBvZiB5b3UgbW92aW5nIGZhc3QKICAgICAgICAgICAgICAgICAgICBpZiAoZGlzdFhaIDwgMS4yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoQ2hhbmNlICo9IDAuNjsgLy8gQmxhc3QgdGhyb3VnaCBsaWtlbHkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKGVudGl0eS5pc0Rhc2hpbmcpIGNhdGNoQ2hhbmNlICs9IDAuMjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChfYmFsbC5wb3dlclR5cGUgPT09ICdTSCcgJiYgX2JhbGwucG93ZXIgPiAxNS4wKSB7CiAgICAgICAgICAgICAgICAvLyBTaG90IHBvd2VyIGNoZWNrCiAgICAgICAgICAgICAgICBjb25zdCBjYSA9IGVudGl0eS5nZXRTdGF0KCdDQScpOwogICAgICAgICAgICAgICAgaWYgKF9iYWxsLnBvd2VyID4gY2EgKiAxLjIpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGFuY2UgPSBNYXRoLm1pbigwLjcsIChfYmFsbC5wb3dlciAtIGNhKSAqIDAuMDQpOwogICAgICAgICAgICAgICAgICAgIGNhdGNoQ2hhbmNlID0gMS4wIC0gY2hhbmNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBsZXQgZnVtYmxlID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChNYXRoLnJhbmRvbSgpID4gY2F0Y2hDaGFuY2UpIHsKICAgICAgICAgICAgICAgIGZ1bWJsZSA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmdW1ibGUpIHsKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgLy8gVmlzdWFsIGZlZWRiYWNrIGZvciBibGFzdCB0aHJvdWdoCiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dC5zcGF3bigiQkxBU1QgVEhST1VHSCEiLCBlbnRQb3MsICJkYW1hZ2UiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRGVmbGVjdCBzbGlnaHRseSBidXQga2VlcCBtb3ZpbmcgZmFzdCAoQmxhc3QgVGhyb3VnaCkKICAgICAgICAgICAgICAgIC8vIERvbid0IHN0b3AgaXQgY29tcGxldGVseSBsaWtlIGEgYmxvY2ssIGp1c3QgcGVydHVyYiBpdAogICAgICAgICAgICAgICAgX2JhbGwudmVsb2NpdHkubXVsdGlwbHlTY2FsYXIoMC44NSk7IAogICAgICAgICAgICAgICAgX2JhbGwudmVsb2NpdHkueCArPSAoTWF0aC5yYW5kb20oKS0wLjUpICogNS4wOwogICAgICAgICAgICAgICAgX2JhbGwudmVsb2NpdHkueSArPSAoTWF0aC5yYW5kb20oKSkgKiA1LjA7IC8vIFBvcCB1cAogICAgICAgICAgICAgICAgX2JhbGwudmVsb2NpdHkueiArPSAoTWF0aC5yYW5kb20oKS0wLjUpICogNS4wOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfYmFsbC5wb3dlciAqPSAwLjc7CgogICAgICAgICAgICAgICAgZW50aXR5LmNhbkNhdGNoID0gZmFsc2U7CiAgICAgICAgICAgICAgICAvLyBTdHVuIGJyaWVmbHkKICAgICAgICAgICAgICAgIGVudGl0eS5zdHVuVGltZXIgPSAwLjU7CiAgICAgICAgICAgICAgICBpZihlbnRpdHkucGxheSkgZW50aXR5LnBsYXkoJ3JlYWN0JywgMC4xKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7IGVudGl0eS5jYW5DYXRjaCA9IHRydWU7IH0sIDEwMDApOwoKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIF9iYWxsLm1hZ25ldGl6ZShlbnRpdHkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vIFN0YXJ0CiAgICBpbml0KCk7Cn0pKCk7Cg==","Ball.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICAvLyBSZXVzYWJsZSBtYXRoIHZlY3RvcnMgdG8gYXZvaWQgR0MKY29uc3QgX2JWZWMgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgY29uc3QgX2F4aXNZID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMSwgMCk7CiAgICBjb25zdCBfdGVtcFZlYyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfbWFnbnVzVmVjID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKCi8vIFBoeXNpY3MgQ29uZmlndXJhdGlvbiAoRXhwb3NlZCBmb3IgRGV2VG9vbHMpCndpbmRvdy5mbHV4LkJhbGxDb25maWcgPSB7CiAgICAgICAgV0FURVJfRFJBRzogMC4xLCAgICAgIC8vIExvdyBkcmFnIGZvciBkaXN0YW5jZQogICAgICAgIFNQSU5fRFJBRzogMC4xNSwgICAgICAvLyBSZWR1Y2VkIGZyb20gMC4zIHNvIGN1cnZlcyBsYXN0IGxvbmdlcgogICAgICAgIE1BR05VU19DT0VGRjogMC44LCAgICAvLyBJbmNyZWFzZWQgZnJvbSAwLjUgZm9yIHB1bmNoaWVyIGN1cnZlcwpCT1VOREFSWV9SQURJVVM6IDMzLjAsIC8vIFNsaWdodGx5IGxhcmdlciB0aGFuIHZpc3VhbCBhcmVuYSAoMzIpIHRvIHByZXZlbnQgZWFybHkgY2xpcHBpbmcKICAgICAgICBCT1VOREFSWV9IRUlHSFQ6IDE1LjAsIC8vIFZlcnRpY2FsIExpbWl0ICgrLy0gWSkKICAgICAgICBHUkFWSVRZX1NQUklORzogMS4wLCAgIC8vIFJlZHVjZWQgZnJvbSA1LjAgKEdlbnRsZSBkZXB0aCBjb3JyZWN0aW9uKQogICAgICAgIEdSQVZJVFlfREFNUDogMS41CiAgICB9OwoKICAgIAogICAgY29uc3QgQyA9IHdpbmRvdy5mbHV4LkJhbGxDb25maWc7IC8vIExvY2FsIGFsaWFzIGZvciBicmV2aXR5CiAgICAvLyAtLS0gVFJBSUwgUkVOREVSRVIgLS0tCiAgICBjbGFzcyBUcmFpbFJlbmRlcmVyIHsKICAgICAgICBjb25zdHJ1Y3RvcihzY2VuZSkgewogICAgICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7CiAgICAgICAgICAgIHRoaXMuc2VnbWVudHMgPSAyNTsKdGhpcy5wb2ludHMgPSBbXTsKdGhpcy53aWR0aCA9IDAuMzg7IC8vIFNjYWxlZCB0byBtYXRjaCBzbWFsbGVyIGJhbGwgKDE1JSByZWR1Y3Rpb24pCiAgICAgICAgICAgIC8vIEdlb21ldHJ5CiAgICAgICAgICAgIGNvbnN0IGdlb21ldHJ5ID0gbmV3IFRIUkVFLkJ1ZmZlckdlb21ldHJ5KCk7CiAgICAgICAgICAgIGNvbnN0IHBvc0RhdGEgPSBuZXcgRmxvYXQzMkFycmF5KHRoaXMuc2VnbWVudHMgKiAyICogMyk7CiAgICAgICAgICAgIGdlb21ldHJ5LnNldEF0dHJpYnV0ZSgncG9zaXRpb24nLCBuZXcgVEhSRUUuQnVmZmVyQXR0cmlidXRlKHBvc0RhdGEsIDMpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEluZGljZXMKICAgICAgICAgICAgY29uc3QgaW5kaWNlcyA9IFtdOwogICAgICAgICAgICBmb3IgKGxldCBpPTA7IGk8dGhpcy5zZWdtZW50cy0xOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGJhc2UgPSBpKjI7CiAgICAgICAgICAgICAgICBpbmRpY2VzLnB1c2goYmFzZSwgYmFzZSsxLCBiYXNlKzIpOwogICAgICAgICAgICAgICAgaW5kaWNlcy5wdXNoKGJhc2UrMSwgYmFzZSszLCBiYXNlKzIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGdlb21ldHJ5LnNldEluZGV4KGluZGljZXMpOwogICAgICAgICAgICAKdGhpcy5tYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7CiAgICAgICAgICAgICAgICBjb2xvcjogMHgwMGFhZmYsCiAgICAgICAgICAgICAgICBzaWRlOiBUSFJFRS5Eb3VibGVTaWRlLAogICAgICAgICAgICAgICAgdHJhbnNwYXJlbnQ6IHRydWUsCiAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLjUsCiAgICAgICAgICAgICAgICBibGVuZGluZzogVEhSRUUuQWRkaXRpdmVCbGVuZGluZywKICAgICAgICAgICAgICAgIGRlcHRoV3JpdGU6IGZhbHNlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5tZXNoID0gbmV3IFRIUkVFLk1lc2goZ2VvbWV0cnksIHRoaXMubWF0ZXJpYWwpOwogICAgICAgICAgICB0aGlzLm1lc2guZnJ1c3R1bUN1bGxlZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLnNjZW5lLmFkZCh0aGlzLm1lc2gpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gSW5pdCBwb2ludHMKICAgICAgICAgICAgZm9yKGxldCBpPTA7IGk8dGhpcy5zZWdtZW50czsgaSsrKSB0aGlzLnBvaW50cy5wdXNoKG5ldyBUSFJFRS5WZWN0b3IzKCkpOwogICAgICAgICAgICB0aGlzLmFjdGl2ZSA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXNldChwb3MpIHsKICAgICAgICAgICAgZm9yKGxldCBpPTA7IGk8dGhpcy5zZWdtZW50czsgaSsrKSB0aGlzLnBvaW50c1tpXS5jb3B5KHBvcyk7CiAgICAgICAgICAgIHRoaXMudXBkYXRlR2VvbWV0cnkoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgc2V0Q29sb3IoaGV4KSB7CiAgICAgICAgICAgIHRoaXMubWF0ZXJpYWwuY29sb3Iuc2V0SGV4KGhleCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHVwZGF0ZShjdXJyZW50UG9zKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5hY3RpdmUpIHsKICAgICAgICAgICAgICAgIHRoaXMucmVzZXQoY3VycmVudFBvcyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFNoaWZ0IHBvaW50cwogICAgICAgICAgICBmb3IgKGxldCBpID0gdGhpcy5zZWdtZW50cyAtIDE7IGkgPiAwOyBpLS0pIHsKICAgICAgICAgICAgICAgIHRoaXMucG9pbnRzW2ldLmNvcHkodGhpcy5wb2ludHNbaS0xXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5wb2ludHNbMF0uY29weShjdXJyZW50UG9zKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHRoaXMudXBkYXRlR2VvbWV0cnkoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdXBkYXRlR2VvbWV0cnkoKSB7CiAgICAgICAgICAgIGNvbnN0IHBvc2l0aW9ucyA9IHRoaXMubWVzaC5nZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uLmFycmF5OwogICAgICAgICAgICBjb25zdCBjYW0gPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UgPyB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhIDogbnVsbDsKICAgICAgICAgICAgaWYgKCFjYW0pIHJldHVybjsKICAgICAgICAgICAgY29uc3QgY2FtUG9zID0gY2FtLnBvc2l0aW9uOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgdGVtcERpciA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICAgICAgICAgIGNvbnN0IHRlbXBUb0NhbSA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICAgICAgICAgIGNvbnN0IHRlbXBSaWdodCA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CgogICAgICAgICAgICBmb3IgKGxldCBpPTA7IGk8dGhpcy5zZWdtZW50czsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwID0gdGhpcy5wb2ludHNbaV07CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFRhcGVyIHdpZHRoCiAgICAgICAgICAgICAgICBjb25zdCB3ID0gdGhpcy53aWR0aCAqICgxIC0gKGkgLyB0aGlzLnNlZ21lbnRzKSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBkaXJlY3Rpb24KICAgICAgICAgICAgICAgIGlmIChpIDwgdGhpcy5zZWdtZW50cyAtIDEpIHsKICAgICAgICAgICAgICAgICAgICB0ZW1wRGlyLnN1YlZlY3RvcnModGhpcy5wb2ludHNbaV0sIHRoaXMucG9pbnRzW2krMV0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0ZW1wRGlyLnN1YlZlY3RvcnModGhpcy5wb2ludHNbaS0xXSwgdGhpcy5wb2ludHNbaV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAodGVtcERpci5sZW5ndGhTcSgpIDwgMC4wMDAxKSB0ZW1wRGlyLnNldCgwLCAxLCAwKTsKICAgICAgICAgICAgICAgIHRlbXBEaXIubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRlbXBUb0NhbS5zdWJWZWN0b3JzKGNhbVBvcywgcCkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICB0ZW1wUmlnaHQuY3Jvc3NWZWN0b3JzKHRlbXBEaXIsIHRlbXBUb0NhbSkubm9ybWFsaXplKCkubXVsdGlwbHlTY2FsYXIodyk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFZlcnQgMQogICAgICAgICAgICAgICAgcG9zaXRpb25zW2kqNiArIDBdID0gcC54IC0gdGVtcFJpZ2h0Lng7CiAgICAgICAgICAgICAgICBwb3NpdGlvbnNbaSo2ICsgMV0gPSBwLnkgLSB0ZW1wUmlnaHQueTsKICAgICAgICAgICAgICAgIHBvc2l0aW9uc1tpKjYgKyAyXSA9IHAueiAtIHRlbXBSaWdodC56OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBWZXJ0IDIKICAgICAgICAgICAgICAgIHBvc2l0aW9uc1tpKjYgKyAzXSA9IHAueCArIHRlbXBSaWdodC54OwogICAgICAgICAgICAgICAgcG9zaXRpb25zW2kqNiArIDRdID0gcC55ICsgdGVtcFJpZ2h0Lnk7CiAgICAgICAgICAgICAgICBwb3NpdGlvbnNbaSo2ICsgNV0gPSBwLnogKyB0ZW1wUmlnaHQuejsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLm1lc2guZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbi5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgICAgfQogICAgfQoKY2xhc3MgQmFsbCB7CgogICAgICAgIGNvbnN0cnVjdG9yKHNjZW5lKSB7CiAgICAgICAgICAgIHRoaXMuc2NlbmUgPSBzY2VuZTsKICAgICAgICAgICAgdGhpcy5tZXNoID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5ob2xkZXIgPSBudWxsOyAKICAgICAgICAgICAgdGhpcy5sYXN0SG9sZGVyID0gbnVsbDsgLy8gVHJhY2sgd2hvIHRocmV3IGl0IGxhc3QgKGZvciBFWFAvQXNzaXN0cykKICAgICAgICAgICAgCiAgICAgICAgICAgIHRoaXMudmVsb2NpdHkgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAwKTsKICAgICAgICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAwKTsKICAgICAgICAgICAgdGhpcy5zdGF0ZSA9ICdmcmVlJzsgLy8gJ2ZyZWUnLCAnaGVsZCcsICdtYWduZXRpemVkJwogICAgICAgICAgICB0aGlzLmlzSW52aXNpYmxlID0gZmFsc2U7CgogICAgICAgICAgICAvLyBDb250aW51b3VzIFN0YXRzCiAgICAgICAgICAgIHRoaXMucG93ZXIgPSAwOyAgICAgIC8vIEN1cnJlbnQgUEEgb3IgU0ggdmFsdWUKICAgICAgICAgICAgdGhpcy5wb3dlclR5cGUgPSAnbm9uZSc7IC8vICdQQScgb3IgJ1NIJwogICAgICAgICAgICB0aGlzLmRlY2F5UmF0ZSA9IDMuMDsgLy8gU3RhdCBwb2ludHMgbG9zdCBwZXIgc2Vjb25kIChXYXRlciByZXNpc3RhbmNlKQogICAgICAgICAgICB0aGlzLmNhdGNoR3JhY2VQZXJpb2QgPSAwOyAvLyBUaW1lIGJlZm9yZSBiYWxsIGNhbiBiZSBjYXVnaHQgYWdhaW4KCiAgICAgICAgICAgIC8vIE1hZ25ldCBTeXN0ZW0KICAgICAgICAgICAgdGhpcy5tYWduZXRUYXJnZXQgPSBudWxsOwogICAgICAgICAgICB0aGlzLm1hZ25ldFRpbWVyID0gMDsKICAgICAgICAgICAgdGhpcy5tYWduZXREdXJhdGlvbiA9IDAuMjsgCiAgICAgICAgICAgIHRoaXMubWFnbmV0U3RhcnRQb3MgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgICAgICAgICB0aGlzLm1hZ25ldFN0YXJ0VmVsID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKCiAgICAgICAgICAgIC8vIFZpc3VhbHMgKFNxdWFzaCAmIFN0cmV0Y2gpCiAgICAgICAgICAgIHRoaXMuYWNjdW11bGF0ZWRSb3RhdGlvbiA9IG5ldyBUSFJFRS5RdWF0ZXJuaW9uKCk7CiAgICAgICAgICAgIHRoaXMuZGVmb3JtTm9kZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuc3Bpbk5vZGUgPSBudWxsOwogICAgICAgICAgICB0aGlzLm1vZGVsID0gbnVsbDsKCnRoaXMuaW5pdE1lc2goKTsKICAgICAgICAgICAgdGhpcy50cmFpbCA9IG5ldyBUcmFpbFJlbmRlcmVyKHNjZW5lKTsKICAgICAgICAgICAgdGhpcy5fYnViYmxlVGltZXIgPSAwOwp9CmluaXRNZXNoKCkgewogICAgICAgICAgICAvLyBIaWVyYXJjaHk6IE1lc2ggKFBvcykgLT4gRGVmb3JtIChTcXVhc2gvU3RyZXRjaCkgLT4gU3BpbiAoUm90YXRpb24pIC0+IE1vZGVsCiAgICAgICAgICAgIHRoaXMubWVzaCA9IG5ldyBUSFJFRS5Hcm91cCgpOwogICAgICAgICAgICB0aGlzLnNjZW5lLmFkZCh0aGlzLm1lc2gpOwoKICAgICAgICAgICAgdGhpcy5kZWZvcm1Ob2RlID0gbmV3IFRIUkVFLkdyb3VwKCk7CiAgICAgICAgICAgIHRoaXMuZGVmb3JtTm9kZS5wb3NpdGlvbi55ID0gLTEuNDsgLy8gVmlzdWFsIG9mZnNldDogTG93ZXJlZCBzaWduaWZpY2FudGx5IHBlciByZXF1ZXN0ICh3YXMgLTAuOSkKICAgICAgICAgICAgdGhpcy5tZXNoLmFkZCh0aGlzLmRlZm9ybU5vZGUpOyAvLyBGaXg6IEFkZCBkZWZvcm1Ob2RlIHRvIG1lc2gKCiAgICAgICAgICAgIHRoaXMuc3Bpbk5vZGUgPSBuZXcgVEhSRUUuR3JvdXAoKTsKICAgICAgICAgICAgdGhpcy5kZWZvcm1Ob2RlLmFkZCh0aGlzLnNwaW5Ob2RlKTsKCiAgICAgICAgICAgIC8vIFByb2NlZHVyYWwgUGxhY2Vob2xkZXIgVGV4dHVyZSAoQmxpdHpiYWxsLWlzaCkKICAgICAgICAgICAgY29uc3QgcGxhY2Vob2xkZXJUZXggPSAoKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgYyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICAgICAgICAgICAgYy53aWR0aCA9IDEyODsgYy5oZWlnaHQgPSA2NDsKICAgICAgICAgICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnI2VlZWVlZSc7CiAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QoMCwwLDEyOCw2NCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEJsdWUgYnVtcHMvZGV0YWlscwogICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjMDA4OGZmJzsKICAgICAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpPDY7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgICAgICAgICBjdHguYXJjKGkqMjUsIDMyLCAxMCwgMCwgTWF0aC5QSSoyKTsKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjMDA0NDg4JzsKICAgICAgICAgICAgICAgIGN0eC5maWxsUmVjdCgwLCAyOCwgMTI4LCA4KTsgLy8gU3RyaXBlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICAgICAgICAgICAgfSkoKTsKCiAgICAgICAgICAgIC8vIFBsYWNlaG9sZGVyIFZpc3VhbCAoSW1tZWRpYXRlIGZlZWRiYWNrLCBwZXJzaXN0cyB1bnRpbCB2YWxpZCBtb2RlbCBsb2FkcykKLy8gUGxhY2Vob2xkZXIgVmlzdWFsIChJbW1lZGlhdGUgZmVlZGJhY2ssIHBlcnNpc3RzIHVudGlsIHZhbGlkIG1vZGVsIGxvYWRzKQovLyBQbGFjZWhvbGRlciBWaXN1YWwgKEltbWVkaWF0ZSBmZWVkYmFjaywgcGVyc2lzdHMgdW50aWwgdmFsaWQgbW9kZWwgbG9hZHMpCmNvbnN0IGdlb21ldHJ5ID0gbmV3IFRIUkVFLlNwaGVyZUdlb21ldHJ5KDAuMywgMTYsIDE2KTsgLy8gU2NhbGVkIGRvd24gfjE1JQogICAgICAgICAgICBjb25zdCBtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7CiAgICAgICAgICAgICAgICBtYXA6IHBsYWNlaG9sZGVyVGV4LAogICAgICAgICAgICAgICAgY29sb3I6IDB4ZmZmZmZmLCAKICAgICAgICAgICAgICAgIHdpcmVmcmFtZTogZmFsc2UsIC8vIFNvbGlkCiAgICAgICAgICAgICAgICB0cmFuc3BhcmVudDogZmFsc2UsCiAgICAgICAgICAgICAgICBvcGFjaXR5OiAxLjAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMucGxhY2Vob2xkZXIgPSBuZXcgVEhSRUUuTWVzaChnZW9tZXRyeSwgbWF0ZXJpYWwpOwoKICAgICAgICAgICAgLy8gTG9hZCBHTEIgTW9kZWwKICAgICAgICAgICAgY29uc3QgdXJsID0gJ2h0dHBzOi8vY2RuLnRpbnlnbGIuY29tL21vZGVscy81MjFhZTg3ODhlNTg0ZTM3OGE3OWQ5NzMyYTA3NTM1Ni5nbGInOwogICAgICAgICAgICAKICAgICAgICAgICAgd2luZG93LmZsdXguQXNzZXRMb2FkZXIubG9hZE1vZGVsKHVybCwgKGdsdGYpID0+IHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJERUJVRzogQmFsbCBHTEIgbG9hZGVkLiIsIGdsdGYpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBtb2RlbCA9IGdsdGYuc2NlbmU7CgogICAgICAgICAgICAgICAgLy8gMS4gUmVzZXQgcm9vdCB0cmFuc2Zvcm1zCiAgICAgICAgICAgICAgICBtb2RlbC5wb3NpdGlvbi5zZXQoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICBtb2RlbC5yb3RhdGlvbi5zZXQoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICBtb2RlbC5zY2FsZS5zZXQoMSwgMSwgMSk7CiAgICAgICAgICAgICAgICBtb2RlbC51cGRhdGVNYXRyaXhXb3JsZCh0cnVlKTsKCiAgICAgICAgICAgICAgICAvLyAyLiBIYXJkZW4gTWF0ZXJpYWxzICYgVmlzaWJpbGl0eQogICAgICAgICAgICAgICAgbW9kZWwudHJhdmVyc2UoKG5vZGUpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5pc01lc2gpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5jYXN0U2hhZG93ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUucmVjZWl2ZVNoYWRvdyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICBub2RlLmZydXN0dW1DdWxsZWQgPSBmYWxzZTsgLy8gQ1JJVElDQUw6IFByZXZlbnQgY3VsbGluZyBpZiBib3VuZHMgYXJlIG9mZgogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUubWF0ZXJpYWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1hdHMgPSBBcnJheS5pc0FycmF5KG5vZGUubWF0ZXJpYWwpID8gbm9kZS5tYXRlcmlhbCA6IFtub2RlLm1hdGVyaWFsXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdHMuZm9yRWFjaChtID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLmNvbG9yLnNldEhleCgweGZmZmZmZik7IC8vIEZvcmNlIHdoaXRlIGJhc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLnNpZGUgPSBUSFJFRS5Eb3VibGVTaWRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0udHJhbnNwYXJlbnQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLm9wYWNpdHkgPSAxLjA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbS5hbHBoYVRlc3QgPSAwOyAvLyBDUklUSUNBTDogRGlzYWJsZSBhbHBoYSB0ZXN0IHRvIHByZXZlbnQgY3VsbGluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0uZGVwdGhXcml0ZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbS5kZXB0aFRlc3QgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAvLyAzLiBDb21wdXRlIEJvdW5kaW5nIEJveAogICAgICAgICAgICAgICAgY29uc3QgYm94ID0gbmV3IFRIUkVFLkJveDMoKS5zZXRGcm9tT2JqZWN0KG1vZGVsKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNpemUgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgICAgICAgICAgICAgYm94LmdldFNpemUoc2l6ZSk7CiAgICAgICAgICAgICAgICBjb25zdCBjZW50ZXIgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgICAgICAgICAgICAgYm94LmdldENlbnRlcihjZW50ZXIpOwoKICAgICAgICAgICAgICAgIC8vIDQuIFZhbGlkYXRpb24KICAgICAgICAgICAgICAgIGNvbnN0IG1heERpbSA9IE1hdGgubWF4KHNpemUueCwgc2l6ZS55LCBzaXplLnopOwogICAgICAgICAgICAgICAgaWYgKG1heERpbSA8PSAwLjAwMSB8fCAhaXNGaW5pdGUobWF4RGltKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiQmFsbCBtb2RlbCBoYXMgaW52YWxpZCBkaW1lbnNpb25zLiBLZWVwaW5nIHBsYWNlaG9sZGVyLiIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsgCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gNS4gQ2FsY3VsYXRlIFNjYWxlCi8vIDUuIENhbGN1bGF0ZSBTY2FsZQpjb25zdCB0YXJnZXREaWFtZXRlciA9IDAuNzI7IC8vIFJlZHVjZWQgc2NhbGUgYnkgfjE1JSAod2FzIDAuODUpCiAgICAgICAgICAgICAgICBjb25zdCBzY2FsZUZhY3RvciA9IHRhcmdldERpYW1ldGVyIC8gbWF4RGltOwoKICAgICAgICAgICAgICAgIC8vIDYuIEFwcGx5IFRyYW5zZm9ybXMKICAgICAgICAgICAgICAgIG1vZGVsLnNjYWxlLnNldFNjYWxhcihzY2FsZUZhY3Rvcik7CiAgICAgICAgICAgICAgICBtb2RlbC5wb3NpdGlvbi5jb3B5KGNlbnRlcikubXVsdGlwbHlTY2FsYXIoLXNjYWxlRmFjdG9yKTsKCiAgICAgICAgICAgICAgICAvLyA3LiBTd2FwIFBsYWNlaG9sZGVyCiAgICAgICAgICAgICAgICBpZiAodGhpcy5wbGFjZWhvbGRlcikgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc3Bpbk5vZGUucmVtb3ZlKHRoaXMucGxhY2Vob2xkZXIpOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnBsYWNlaG9sZGVyLmdlb21ldHJ5KSB0aGlzLnBsYWNlaG9sZGVyLmdlb21ldHJ5LmRpc3Bvc2UoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsID0gbW9kZWw7CiAgICAgICAgICAgICAgICB0aGlzLnNwaW5Ob2RlLmFkZCh0aGlzLm1vZGVsKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBCbGl0emJhbGwgbW9kZWwgYXR0YWNoZWQuIFNjYWxlOiAke3NjYWxlRmFjdG9yLnRvRml4ZWQoNCl9YCk7CgogICAgICAgICAgICB9LCB1bmRlZmluZWQsIChlcnIpID0+IHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkZhaWxlZCB0byBsb2FkIEJsaXR6YmFsbCBtb2RlbDoiLCBlcnIpOwogICAgICAgICAgICAgICAgLy8gRmFsbGJhY2s6IEtlZXAgcGxhY2Vob2xkZXIgYnV0IHRpbnQgaXQgcmVkIHRvIGluZGljYXRlIGVycm9yCiAgICAgICAgICAgICAgICBpZiAodGhpcy5wbGFjZWhvbGRlcikgewogICAgICAgICAgICAgICAgICAgIHRoaXMucGxhY2Vob2xkZXIubWF0ZXJpYWwuY29sb3Iuc2V0SGV4KDB4ZmZhYWFhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKdXBkYXRlKGR0KSB7CiAgICAgICAgICAgIGlmICghdGhpcy5tZXNoKSByZXR1cm47CgogICAgICAgICAgICAvLyBTYWZldHk6IFJlc2V0IGlmIHBvc2l0aW9uIGNvcnJ1cHRlZAogICAgICAgICAgICBpZiAoaXNOYU4odGhpcy5tZXNoLnBvc2l0aW9uLngpIHx8IGlzTmFOKHRoaXMubWVzaC5wb3NpdGlvbi55KSB8fCBpc05hTih0aGlzLm1lc2gucG9zaXRpb24ueikpIHsKICAgICAgICAgICAgICAgIHRoaXMucmVzZXQoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gU2FmZXR5OiBGaXggIlVucGlja2FibGUgQmFsbCIgQnVnCiAgICAgICAgICAgIC8vIElmIHN0YXRlIGlzICdoZWxkJyBvciAnbWFnbmV0aXplZCcgYnV0IHRoZSBhY3RvciBpcyBtaXNzaW5nL2ludmFsaWQsIGZvcmNlIGRyb3AgdG8gJ2ZyZWUnLgogICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSA9PT0gJ2hlbGQnICYmICghdGhpcy5ob2xkZXIgfHwgIXRoaXMuaG9sZGVyLm1lc2gpKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSA9PT0gJ21hZ25ldGl6ZWQnICYmICghdGhpcy5tYWduZXRUYXJnZXQgfHwgIXRoaXMubWFnbmV0VGFyZ2V0Lm1lc2gpKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3AoKTsKICAgICAgICAgICAgfQppZiAodGhpcy50cmFpbCkgewogICAgICAgICAgICAgICAgLy8gVHJhaWwgaXMgYWN0aXZlIGlmIGJhbGwgaXMgbW92aW5nIGZhc3QgYW5kIGZyZWUKICAgICAgICAgICAgICAgIGNvbnN0IHNwZWVkID0gdGhpcy52ZWxvY2l0eS5sZW5ndGgoKTsKICAgICAgICAgICAgICAgIHRoaXMudHJhaWwuYWN0aXZlID0gKHRoaXMuc3RhdGUgPT09ICdmcmVlJyAmJiBzcGVlZCA+IDIuMCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEZpeDogT2Zmc2V0IHRyYWlsIHRvIG1hdGNoIHZpc3VhbCBtb2RlbCBwb3NpdGlvbiAoZGVmb3JtTm9kZSBvZmZzZXQpCiAgICAgICAgICAgICAgICBfYlZlYy5jb3B5KHRoaXMubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZWZvcm1Ob2RlKSBfYlZlYy55ICs9IHRoaXMuZGVmb3JtTm9kZS5wb3NpdGlvbi55OwoKICAgICAgICAgICAgICAgIHRoaXMudHJhaWwudXBkYXRlKF9iVmVjKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUgPT09ICdoZWxkJyAmJiB0aGlzLmhvbGRlciAmJiB0aGlzLmhvbGRlci5tZXNoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUhlbGQoZHQpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuc3RhdGUgPT09ICdtYWduZXRpemVkJykgewogICAgICAgICAgICAgICAgdGhpcy51cGRhdGVNYWduZXRpemVkKGR0KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlRnJlZShkdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh0aGlzLmNhdGNoR3JhY2VQZXJpb2QgPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNhdGNoR3JhY2VQZXJpb2QgLT0gZHQ7CiAgICAgICAgICAgIH0KCnRoaXMudXBkYXRlVmlzdWFscyhkdCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTYWZldHk6IEVuc3VyZSB2aXNpYmlsaXR5IGlmIG5vdCBleHBsaWNpdGx5IGludmlzaWJsZQovLyBTYWZldHk6IEVuc3VyZSB2aXNpYmlsaXR5IGlmIG5vdCBleHBsaWNpdGx5IGludmlzaWJsZQogICAgICAgICAgICBpZiAodGhpcy5tZXNoICYmICF0aGlzLmlzSW52aXNpYmxlKSB7CiAgICAgICAgICAgICAgICB0aGlzLm1lc2gudmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgICAgICAvLyBGb3JjZSBtb2RlbCB2aXNpYmlsaXR5IGlmIHByZXNlbnQgKHNvbWV0aW1lcyBHTFRGIGxvYWRlciBoaWRlcyBpdCkKICAgICAgICAgICAgICAgIGlmICh0aGlzLm1vZGVsKSB0aGlzLm1vZGVsLnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKbWFnbmV0aXplKHRhcmdldCkgewogICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSA9PT0gJ21hZ25ldGl6ZWQnIHx8IHRoaXMuc3RhdGUgPT09ICdoZWxkJykgcmV0dXJuOwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5zdGF0ZSA9ICdtYWduZXRpemVkJzsKICAgICAgICAgICAgdGhpcy5tYWduZXRUYXJnZXQgPSB0YXJnZXQ7CiAgICAgICAgICAgIHRoaXMuaG9sZGVyID0gdGFyZ2V0OyAvLyBMb2dpY2FsIHBvc3Nlc3Npb24gc28gQUkgcmVhY3RzCiAgICAgICAgICAgIHRoaXMubWFnbmV0VGltZXIgPSAwOwogICAgICAgICAgICB0aGlzLm1hZ25ldFN0YXJ0UG9zLmNvcHkodGhpcy5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgdGhpcy5tYWduZXRTdGFydFZlbC5jb3B5KHRoaXMudmVsb2NpdHkpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRHluYW1pYyBEdXJhdGlvbiBiYXNlZCBvbiBkaXN0YW5jZSAoU21vb3RoZXIgZm9yIGxvbmcgcmFuZ2UsIHNuYXBweSBmb3IgY2xvc2UpCiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSB0aGlzLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyh0YXJnZXQubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgIHRoaXMubWFnbmV0RHVyYXRpb24gPSBNYXRoLm1heCgwLjE1LCBNYXRoLm1pbigwLjQsIGRpc3QgLyAxNS4wKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBLaWxsIHBoeXNpY3MKICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS5zZXQoMCwgMCwgMCk7CiAgICAgICAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnNldCgwLCAwLCAwKTsKCiAgICAgICAgICAgIC8vIE5vdGlmeSBwbGF5ZXIgaW1tZWRpYXRlbHkgc28gdGhleSBzdG9wIGNoYXNpbmcgYW5kIHBsYXkgYW5pbWF0aW9uCiAgICAgICAgICAgIGlmICh0YXJnZXQucmVjZWl2ZUJhbGwpIHsKICAgICAgICAgICAgICAgIHRhcmdldC5yZWNlaXZlQmFsbCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLnJldmVhbCgpOwogICAgICAgIH0KCnVwZGF0ZU1hZ25ldGl6ZWQoZHQpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLm1hZ25ldFRhcmdldCB8fCAhdGhpcy5tYWduZXRUYXJnZXQubWVzaCkgewogICAgICAgICAgICAgICAgdGhpcy5kcm9wKCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMubWFnbmV0VGltZXIgKz0gZHQ7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBOb3JtYWxpemVkIFRpbWUKICAgICAgICAgICAgbGV0IHQgPSB0aGlzLm1hZ25ldFRpbWVyIC8gdGhpcy5tYWduZXREdXJhdGlvbjsKICAgICAgICAgICAgaWYgKHQgPiAxLjApIHQgPSAxLjA7CgogICAgICAgICAgICAvLyBUYXJnZXQgIlZpcnR1YWwgSGFuZCIgUG9zaXRpb24gKEZyb250IG9mIENoZXN0KQogICAgICAgICAgICBjb25zdCBob2xkZXJQb3MgPSB0aGlzLm1hZ25ldFRhcmdldC5tZXNoLnBvc2l0aW9uOwogICAgICAgICAgICBjb25zdCBob2xkZXJRdWF0ID0gdGhpcy5tYWduZXRUYXJnZXQubWVzaC5xdWF0ZXJuaW9uOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gT2Zmc2V0OiBGb3J3YXJkIDAuNiwgVXAgMS4wIChDaGVzdCBoZWlnaHQpCiAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IF9iVmVjLnNldCgwLCAxLjAsIDAuNikuYXBwbHlRdWF0ZXJuaW9uKGhvbGRlclF1YXQpOwogICAgICAgICAgICBjb25zdCB0YXJnZXRQb3MgPSBvZmZzZXQuYWRkKGhvbGRlclBvcyk7CgogICAgICAgICAgICAvLyAtLS0gUVVBRFJBVElDIEJFWklFUiBDVVJWRSAtLS0KICAgICAgICAgICAgLy8gUDAgPSBTdGFydCwgUDIgPSBUYXJnZXQKICAgICAgICAgICAgLy8gUDEgPSBDb250cm9sIFBvaW50IChQcm9qZWN0ZWQgYWxvbmcgaW5pdGlhbCB2ZWxvY2l0eSB0byBwcmVzZXJ2ZSBtb21lbnR1bSBmZWVsKQogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgcDAgPSB0aGlzLm1hZ25ldFN0YXJ0UG9zOwogICAgICAgICAgICBjb25zdCBwMiA9IHRhcmdldFBvczsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBQMSAoQ29udHJvbCBQb2ludCkKICAgICAgICAgICAgLy8gUHJvamVjdCBmb3J3YXJkIGZyb20gUDAgYWxvbmcgc3RhcnQgdmVsb2NpdHkgdmVjdG9yCiAgICAgICAgICAgIC8vIERpc3RhbmNlIG9mIHByb2plY3Rpb24gPSA0MCUgb2YgdG90YWwgZGlzdGFuY2UgdG8gdGFyZ2V0CiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBwMC5kaXN0YW5jZVRvKHAyKTsKICAgICAgICAgICAgY29uc3QgcDEgPSBfdGVtcFZlYy5jb3B5KHAwKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IHZlbExlbiA9IHRoaXMubWFnbmV0U3RhcnRWZWwubGVuZ3RoU3EoKTsKICAgICAgICAgICAgaWYgKHZlbExlbiA+IDEuMCkgewogICAgICAgICAgICAgICAgLy8gVXNlIHZlbG9jaXR5IHRhbmdlbnQKICAgICAgICAgICAgICAgIGNvbnN0IGRpciA9IHRoaXMubWFnbmV0U3RhcnRWZWwuY2xvbmUoKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgIHAxLmFkZChkaXIubXVsdGlwbHlTY2FsYXIoZGlzdCAqIDAuNCkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gTm8gdmVsb2NpdHkgKHN0YXRpb25hcnkgYmFsbCksIGFyYyB1cHdhcmRzIHNsaWdodGx5CiAgICAgICAgICAgICAgICBwMS5sZXJwKHAyLCAwLjUpOwogICAgICAgICAgICAgICAgcDEueSArPSAxLjU7IAogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBCZXppZXI6IEIodCkgPSAoMS10KV4yICogUDAgKyAyKDEtdCl0ICogUDEgKyB0XjIgKiBQMgogICAgICAgICAgICBjb25zdCBvbmVNaW51c1QgPSAxLjAgLSB0OwogICAgICAgICAgICBjb25zdCB3MCA9IG9uZU1pbnVzVCAqIG9uZU1pbnVzVDsKICAgICAgICAgICAgY29uc3QgdzEgPSAyLjAgKiBvbmVNaW51c1QgKiB0OwogICAgICAgICAgICBjb25zdCB3MiA9IHQgKiB0OwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5tZXNoLnBvc2l0aW9uLnggPSAodzAgKiBwMC54KSArICh3MSAqIHAxLngpICsgKHcyICogcDIueCk7CiAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi55ID0gKHcwICogcDAueSkgKyAodzEgKiBwMS55KSArICh3MiAqIHAyLnkpOwogICAgICAgICAgICB0aGlzLm1lc2gucG9zaXRpb24ueiA9ICh3MCAqIHAwLnopICsgKHcxICogcDEueikgKyAodzIgKiBwMi56KTsKCiAgICAgICAgICAgIC8vIEZpbmlzaAogICAgICAgICAgICBpZiAodCA+PSAxLjApIHsKICAgICAgICAgICAgICAgIHRoaXMuZ3JhYih0aGlzLm1hZ25ldFRhcmdldCk7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgp1cGRhdGVIZWxkKGR0KSB7CiAgICAgICAgICAgIC8vIEFUVEFDSEVEIFNUQVRFIChWaXJ0dWFsIEF0dGFjaG1lbnQpCiAgICAgICAgICAgIGlmICghdGhpcy5ob2xkZXIgfHwgIXRoaXMuaG9sZGVyLm1lc2gpIHsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcCgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLnZlbG9jaXR5LnNldCgwLCAwLCAwKTsKICAgICAgICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuc2V0KDAsIDAsIDApOwoKICAgICAgICAgICAgLy8gMS4gVHJ5IHRvIHVzZSBIYW5kIEJvbmUgaWYgYXZhaWxhYmxlIChSZWFsaXNtKQogICAgICAgICAgICBpZiAodGhpcy5ob2xkZXIuaGFuZEJvbmUpIHsKICAgICAgICAgICAgICAgIC8vIEdldCB3b3JsZCBwb3NpdGlvbiBvZiB0aGUgaGFuZCBib25lCiAgICAgICAgICAgICAgICB0aGlzLmhvbGRlci5oYW5kQm9uZS5nZXRXb3JsZFBvc2l0aW9uKHRoaXMubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEFkanVzdCBzbGlnaHRseSB0byBzaXQgSU4gdGhlIGhhbmQgcmF0aGVyIHRoYW4gT04gdGhlIHdyaXN0CiAgICAgICAgICAgICAgICAvLyBXZSBjYW4ndCBlYXNpbHkga25vdyAiZm9yd2FyZCIgZm9yIHRoZSBib25lIHdpdGhvdXQgbW9yZSBpbmZvLCAKICAgICAgICAgICAgICAgIC8vIGJ1dCB1c3VhbGx5IEdMVEYgYm9uZXMgYXJlIG9yaWVudGVkLiBGb3Igbm93LCBleGFjdCBib25lIHBvcyBpcyBiZXR0ZXIgdGhhbiBjaGVzdC4KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIDIuIEZhbGxiYWNrOiBDYWxjdWxhdGUgIkNhcnJ5aW5nIiBQb3NpdGlvbiAoUmlnaHQgSGFuZCBTaWRlKQogICAgICAgICAgICAgICAgLy8gUmVsYXRpdmUgdG8gcGxheWVyOiBVcCAwLjggKFdhaXN0L0NoZXN0KSwgUmlnaHQgMC40LCBGb3J3YXJkIDAuNQogICAgICAgICAgICAgICAgY29uc3QgaG9sZGVyUG9zID0gdGhpcy5ob2xkZXIubWVzaC5wb3NpdGlvbjsKICAgICAgICAgICAgICAgIGNvbnN0IGhvbGRlclF1YXQgPSB0aGlzLmhvbGRlci5tZXNoLnF1YXRlcm5pb247CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFJldXNlIF9iVmVjCiAgICAgICAgICAgICAgICAvLyBPZmZzZXQ6IHg9MC4zNSAoUmlnaHQpLCB5PTAuOSAoTG93ZXIgQ2hlc3QpLCB6PTAuNSAoRm9yd2FyZCkKICAgICAgICAgICAgICAgIF9iVmVjLnNldCgwLjM1LCAwLjksIDAuNSkuYXBwbHlRdWF0ZXJuaW9uKGhvbGRlclF1YXQpOwogICAgICAgICAgICAgICAgdGhpcy5tZXNoLnBvc2l0aW9uLmNvcHkoaG9sZGVyUG9zKS5hZGQoX2JWZWMpOwogICAgICAgICAgICB9CgovLyBWaXN1YWwgRmxhaXI6IFNwaW4gdGhlIGJhbGwgc2xvd2x5CiAgICAgICAgICAgIGNvbnN0IHJvdFggPSBuZXcgVEhSRUUuUXVhdGVybmlvbigpLnNldEZyb21BeGlzQW5nbGUobmV3IFRIUkVFLlZlY3RvcjMoMSwwLDApLCAyICogZHQpOwogICAgICAgICAgICBjb25zdCByb3RZID0gbmV3IFRIUkVFLlF1YXRlcm5pb24oKS5zZXRGcm9tQXhpc0FuZ2xlKG5ldyBUSFJFRS5WZWN0b3IzKDAsMSwwKSwgNSAqIGR0KTsKICAgICAgICAgICAgdGhpcy5hY2N1bXVsYXRlZFJvdGF0aW9uLm11bHRpcGx5KHJvdFgpLm11bHRpcGx5KHJvdFkpOwogICAgICAgIH0KCnVwZGF0ZUZyZWUoZHQpIHsKICAgICAgICAgICAgLy8gUEhZU0lDUyBTVEFURQogICAgICAgICAgICBjb25zdCBDID0gd2luZG93LmZsdXguQmFsbENvbmZpZzsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIDEuIE1hZ251cyBFZmZlY3QgKEN1cnZlKQogICAgICAgICAgICAvLyBGb3JjZSA9IFNwaW4geCBWZWxvY2l0eQogICAgICAgICAgICBpZiAodGhpcy5hbmd1bGFyVmVsb2NpdHkubGVuZ3RoU3EoKSA+IDAuMSAmJiB0aGlzLnZlbG9jaXR5Lmxlbmd0aFNxKCkgPiAwLjUpIHsKICAgICAgICAgICAgICAgIF9tYWdudXNWZWMuY29weSh0aGlzLmFuZ3VsYXJWZWxvY2l0eSkuY3Jvc3ModGhpcy52ZWxvY2l0eSkubXVsdGlwbHlTY2FsYXIoQy5NQUdOVVNfQ09FRkYgKiBkdCk7CiAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5LmFkZChfbWFnbnVzVmVjKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRGVjYXkgU3BpbgogICAgICAgICAgICAgICAgY29uc3Qgc3BpbkRyYWcgPSBNYXRoLm1heCgwLCAxIC0gKEMuU1BJTl9EUkFHICogZHQpKTsKICAgICAgICAgICAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5Lm11bHRpcGx5U2NhbGFyKHNwaW5EcmFnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMi4gVmVydGljYWwgUmVzdG9yaW5nIEZvcmNlIChQbGF5YWJsZSBEZXB0aCBDb25zdHJhaW50KQogICAgICAgICAgICAvLyBLZWVwcyBiYWxsIG5lYXIgWT0wIHRvIHByZXZlbnQgaXQgZ2V0dGluZyBsb3N0IGFib3ZlL2JlbG93IHBsYXllcnMKICAgICAgICAgICAgY29uc3QgeVBvcyA9IHRoaXMubWVzaC5wb3NpdGlvbi55OwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS55IC09IHlQb3MgKiBDLkdSQVZJVFlfU1BSSU5HICogZHQ7CiAgICAgICAgICAgIHRoaXMudmVsb2NpdHkueSAqPSBNYXRoLm1heCgwLCAxIC0gKEMuR1JBVklUWV9EQU1QICogZHQpKTsKCiAgICAgICAgICAgIC8vIDMuIE1vdmUKICAgICAgICAgICAgX3RlbXBWZWMuY29weSh0aGlzLnZlbG9jaXR5KS5tdWx0aXBseVNjYWxhcihkdCk7CiAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi5hZGQoX3RlbXBWZWMpOwoKICAgICAgICAgICAgLy8gMy4gRHJhZyAoUGh5c2ljYWwgV2F0ZXIgcmVzaXN0YW5jZSBvbiBWZWxvY2l0eSkKICAgICAgICAgICAgLy8gU2VwYXJhdGUgZnJvbSBTdGF0IERlY2F5LiBUaGlzIHN0b3BzIHRoZSBiYWxsIHBoeXNpY2FsbHkuCiAgICAgICAgICAgIGNvbnN0IGRyYWdGYWN0b3IgPSBNYXRoLm1heCgwLCAxIC0gKEMuV0FURVJfRFJBRyAqIGR0KSk7CiAgICAgICAgICAgIHRoaXMudmVsb2NpdHkubXVsdGlwbHlTY2FsYXIoZHJhZ0ZhY3Rvcik7CgogICAgICAgICAgICAvLyA0LiBTdGF0IERlY2F5IChUaGUgIkVuZXJneSIgb2YgdGhlIHBhc3Mvc2hvdCkKICAgICAgICAgICAgaWYgKHRoaXMucG93ZXIgPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLnBvd2VyIC09IHRoaXMuZGVjYXlSYXRlICogZHQ7CmlmICh0aGlzLnBvd2VyIDwgMCkgdGhpcy5wb3dlciA9IDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEJ1YmJsZSBUcmFpbCAoSGlnaCBTcGVlZCkKLy8gQnViYmxlIFRyYWlsIChIaWdoIFNwZWVkKQovLyBCdWJibGUgVHJhaWwgKER5bmFtaWMpCiAgICAgICAgICAgIGNvbnN0IHNwZWVkU3EgPSB0aGlzLnZlbG9jaXR5Lmxlbmd0aFNxKCk7CiAgICAgICAgICAgIGlmIChzcGVlZFNxID4gMi4wICYmIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSAmJiB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UucGFydGljbGVNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9idWJibGVUaW1lciAtPSBkdDsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9idWJibGVUaW1lciA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcG0gPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UucGFydGljbGVNYW5hZ2VyOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IHRoaXMudmVsb2NpdHkuY2xvbmUoKS5ub3JtYWxpemUoKS5tdWx0aXBseVNjYWxhcigtMC44KTsgCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gMS4gU3RhbmRhcmQgQnViYmxlIChCYXNlIFRyYWlsKSAtIEFsd2F5cyBzcGF3biBmb3Igdm9sdW1lCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RkUG9zID0gdGhpcy5tZXNoLnBvc2l0aW9uLmNsb25lKCkuYWRkKG9mZnNldCkuYWRkKG5ldyBUSFJFRS5WZWN0b3IzKChNYXRoLnJhbmRvbSgpLTAuNSkqMC4zLCAoTWF0aC5yYW5kb20oKS0wLjUpKjAuMywgKE1hdGgucmFuZG9tKCktMC41KSowLjMpKTsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kZWZvcm1Ob2RlKSBzdGRQb3MueSArPSB0aGlzLmRlZm9ybU5vZGUucG9zaXRpb24ueTsKICAgICAgICAgICAgICAgICAgICBwbS5zcGF3bignYnViYmxlJywgc3RkUG9zLCB7IHNjYWxlOiAwLjE1ICsgTWF0aC5yYW5kb20oKSAqIDAuMiB9KTsKCiAgICAgICAgICAgICAgICAgICAgLy8gMi4gTWljcm8gQnViYmxlcyAoQ2F2aXRhdGlvbiAvIFNwZWVkKSAtIEFkZCBvbiB0b3AKICAgICAgICAgICAgICAgICAgICBpZiAoc3BlZWRTcSA+IDUwLjApIHsgLy8gU3BlZWQgPiB+NwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb3VudCA9IE1hdGgubWluKDQsIE1hdGguZmxvb3Ioc3BlZWRTcSAvIDYwKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpPGNvdW50OyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGppdHRlciA9IG5ldyBUSFJFRS5WZWN0b3IzKChNYXRoLnJhbmRvbSgpLTAuNSkqMC40LCAoTWF0aC5yYW5kb20oKS0wLjUpKjAuNCwgKE1hdGgucmFuZG9tKCktMC41KSowLjQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3Bhd25Qb3MgPSB0aGlzLm1lc2gucG9zaXRpb24uY2xvbmUoKS5hZGQob2Zmc2V0KS5hZGQoaml0dGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRlZm9ybU5vZGUpIHNwYXduUG9zLnkgKz0gdGhpcy5kZWZvcm1Ob2RlLnBvc2l0aW9uLnk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBtLnNwYXduKCdidWJibGVfbWljcm8nLCBzcGF3blBvcywgeyBzY2FsZTogMC4wNSArIE1hdGgucmFuZG9tKCkgKiAwLjEgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYnViYmxlVGltZXIgPSAwLjAyOyAvLyBGYXN0IHVwZGF0ZQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE9jY2FzaW9uYWwgbWljcm8gYnViYmxlIGF0IGxvdyBzcGVlZCBmb3IgZGV0YWlsCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLnJhbmRvbSgpID4gMC41KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgaml0dGVyID0gbmV3IFRIUkVFLlZlY3RvcjMoKE1hdGgucmFuZG9tKCktMC41KSowLjIsIChNYXRoLnJhbmRvbSgpLTAuNSkqMC4yLCAoTWF0aC5yYW5kb20oKS0wLjUpKjAuMik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3Bhd25Qb3MgPSB0aGlzLm1lc2gucG9zaXRpb24uY2xvbmUoKS5hZGQob2Zmc2V0KS5hZGQoaml0dGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kZWZvcm1Ob2RlKSBzcGF3blBvcy55ICs9IHRoaXMuZGVmb3JtTm9kZS5wb3NpdGlvbi55OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBtLnNwYXduKCdidWJibGVfbWljcm8nLCBzcGF3blBvcywgeyBzY2FsZTogMC4wNCArIE1hdGgucmFuZG9tKCkgKiAwLjA2IH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2J1YmJsZVRpbWVyID0gMC4wNTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KLy8gQ29udGludWVkIGxvZ2ljLi4uCiAgICAgICAgICAgIC8vIDUuIEJvdW5kYXJ5IExvZ2ljIChTb2Z0IFdhbGxzIGZvciBDdXJ2ZXMpCi8vIDUuIEJvdW5kYXJ5IExvZ2ljIChTb2Z0IFdhbGxzIGZvciBDdXJ2ZXMpCiAgICAgICAgICAgIC8vIFdlIHVzZSBhICJTb2Z0IFdhbGwiIGFwcHJvYWNoIHRvIHByZXZlbnQgc2hhcnAgVi1ib3VuY2VzLgogICAgICAgICAgICAvLyBBIHJlcHVsc2l2ZSBmb3JjZSBjdXJ2ZXMgdGhlIGJhbGwgYXdheSBiZWZvcmUgaW1wYWN0LCBhbmQgaW1wYWN0IHJlc3VsdHMgaW4gYSBzbGlkZS9zb2Z0IGJvdW5jZS4KICAgICAgICAgICAgY29uc3QgcG9zID0gdGhpcy5tZXNoLnBvc2l0aW9uOwogICAgICAgICAgICBjb25zdCBkaXN0WFogPSBNYXRoLnNxcnQocG9zLnggKiBwb3MueCArIHBvcy56ICogcG9zLnopOwogICAgICAgICAgICBjb25zdCBib3VuZGFyeVJhZGl1cyA9IEMuQk9VTkRBUllfUkFESVVTOwoKICAgICAgICAgICAgY29uc3Qgc29mdEJ1ZmZlciA9IDMuMDsgLy8gUmVkdWNlZCBmcm9tIDUuMCB0byBwcmV2ZW50IGVhcmx5IHJlcHVsc2lvbgogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQS4gU29mdCBSZXB1bHNpb24gKENyZWF0ZXMgY3VydmVkIHRyYWplY3RvcnkgbmVhciB3YWxsKQogICAgICAgICAgICBpZiAoZGlzdFhaID4gYm91bmRhcnlSYWRpdXMgLSBzb2Z0QnVmZmVyKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvbiA9IGRpc3RYWiAtIChib3VuZGFyeVJhZGl1cyAtIHNvZnRCdWZmZXIpOwogICAgICAgICAgICAgICAgY29uc3QgcmF0aW8gPSBwZW5ldHJhdGlvbiAvIHNvZnRCdWZmZXI7IC8vIDAgdG8gMQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBGb3JjZSB2ZWN0b3IgdG93YXJkcyBjZW50ZXIKICAgICAgICAgICAgICAgIGNvbnN0IHB1c2hEaXIgPSBuZXcgVEhSRUUuVmVjdG9yMygtcG9zLngsIDAsIC1wb3Mueikubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICAvLyBFeHBvbmVudGlhbCBmb3JjZSB0byBzdGVlciBpdCBzbW9vdGhseQogICAgICAgICAgICAgICAgLy8gUmVkdWNlZCBmb3JjZSBmcm9tIDYwLjAgdG8gMjAuMCB0byBwcmV2ZW50ICJnaG9zdCB3YWxsIiBib3VuY2VzCiAgICAgICAgICAgICAgICBjb25zdCBmb3JjZSA9IHB1c2hEaXIubXVsdGlwbHlTY2FsYXIocmF0aW8gKiByYXRpbyAqIDIwLjAgKiBkdCk7IAogICAgICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS5hZGQoZm9yY2UpOwp9CgogICAgICAgICAgICAvLyBCLiBIYXJkIENsYW1wIChJZiBpdCBzdGlsbCBoaXRzKQogICAgICAgICAgICBpZiAoZGlzdFhaID4gYm91bmRhcnlSYWRpdXMpIHsKICAgICAgICAgICAgICAgIC8vIE5vcm1hbCBwb2ludGluZyBJTldBUkQKICAgICAgICAgICAgICAgIGNvbnN0IG5vcm1hbCA9IG5ldyBUSFJFRS5WZWN0b3IzKC1wb3MueCwgMCwgLXBvcy56KS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gQ2xhbXAgUG9zaXRpb24KICAgICAgICAgICAgICAgIGNvbnN0IG92ZXJsYXAgPSBkaXN0WFogLSBib3VuZGFyeVJhZGl1czsKICAgICAgICAgICAgICAgIHBvcy5hZGQobm9ybWFsLmNsb25lKCkubXVsdGlwbHlTY2FsYXIob3ZlcmxhcCkpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBWZWxvY2l0eSBIYW5kbGluZzogU29mdCBCb3VuY2UgLyBTbGlkZQogICAgICAgICAgICAgICAgY29uc3QgdkRvdE4gPSB0aGlzLnZlbG9jaXR5LmRvdChub3JtYWwpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBPbmx5IGFkanVzdCBpZiBtb3ZpbmcgT1VUV0FSRFMgKGFnYWluc3Qgbm9ybWFsKQogICAgICAgICAgICAgICAgaWYgKHZEb3ROIDwgMCkgewogICAgICAgICAgICAgICAgICAgIC8vIFJlZHVjZSBub3JtYWwgY29tcG9uZW50IHNpZ25pZmljYW50bHkgKFNsaWRlIGJlaGF2aW9yKQogICAgICAgICAgICAgICAgICAgIC8vIEVsYXN0aWNpdHkgMC4zID0gRHVsbCB0aHVkL3NsaWRlLCBub3QgYSBzaGFycCBwaW5nCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZWxhc3RpY2l0eSA9IDAuMzsgCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gVl9uZXcgPSBWIC0gKDEgKyBlKSAqIChWLk4pICogTgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGltcHVsc2UgPSBub3JtYWwubXVsdGlwbHlTY2FsYXIoLXZEb3ROICogKDEuMCArIGVsYXN0aWNpdHkpKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5LmFkZChpbXB1bHNlKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBGcmljdGlvbiBvbiB3YWxsIGNvbnRhY3QKICAgICAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5Lm11bHRpcGx5U2NhbGFyKDAuOTUpOyAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRmxvb3IvQ2VpbGluZyBCb3VuY2UKICAgICAgICAgICAgaWYgKE1hdGguYWJzKHBvcy55KSA+IEMuQk9VTkRBUllfSEVJR0hUKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzaWduID0gTWF0aC5zaWduKHBvcy55KTsKICAgICAgICAgICAgICAgIHBvcy55ID0gQy5CT1VOREFSWV9IRUlHSFQgKiBzaWduOwogICAgICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS55ICo9IC0wLjQ7IC8vIFNvZnRlciB2ZXJ0aWNhbCBib3VuY2UKICAgICAgICAgICAgfQovLyBJZiBzcGlubmluZyBzaWduaWZpY2FudGx5LCB1c2UgdGhhdCBheGlzCiAgICAgICAgICAgIGNvbnN0IHNwaW5TcGVlZCA9IHRoaXMuYW5ndWxhclZlbG9jaXR5Lmxlbmd0aCgpOwogICAgICAgICAgICBpZiAoc3BpblNwZWVkID4gMC41KSB7CiAgICAgICAgICAgICAgICBjb25zdCBheGlzID0gX3RlbXBWZWMuY29weSh0aGlzLmFuZ3VsYXJWZWxvY2l0eSkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICBjb25zdCBxID0gbmV3IFRIUkVFLlF1YXRlcm5pb24oKS5zZXRGcm9tQXhpc0FuZ2xlKGF4aXMsIHNwaW5TcGVlZCAqIGR0KTsKICAgICAgICAgICAgICAgIHRoaXMuYWNjdW11bGF0ZWRSb3RhdGlvbi5wcmVtdWx0aXBseShxKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEZhbGxiYWNrOiBSb2xsIGJhc2VkIG9uIHZlbG9jaXR5IChWaXN1YWwgZmFrZSBmb3Igbm9uLXNwaW5uaW5nIGJhbGwpCiAgICAgICAgICAgICAgICBjb25zdCBzcGVlZCA9IHRoaXMudmVsb2NpdHkubGVuZ3RoKCk7CiAgICAgICAgICAgICAgICBpZiAoc3BlZWQgPiAwLjEpIHsKICAgICAgICAgICAgICAgICAgICBfdGVtcFZlYy5jb3B5KHRoaXMudmVsb2NpdHkpLmNyb3NzKF9heGlzWSkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKF90ZW1wVmVjLmxlbmd0aFNxKCkgPiAwLjAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHEgPSBuZXcgVEhSRUUuUXVhdGVybmlvbigpLnNldEZyb21BeGlzQW5nbGUoX3RlbXBWZWMsIHNwZWVkICogZHQpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFjY3VtdWxhdGVkUm90YXRpb24ucHJlbXVsdGlwbHkocSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9Cn0KCmdyYWIocGxheWVyKSB7CiAgICAgICAgICAgIHRoaXMucmV2ZWFsKCk7IAogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQW5ub3VuY2VtZW50OiBQb3NzZXNzaW9uIChpZiB0YWtpbmcgZnJvbSBmcmVlIHN0YXRlKQogICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSA9PT0gJ2ZyZWUnKSB7CiAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSAmJiB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2Uuc2hvd0Fubm91bmNlbWVudCkgewogICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2Uuc2hvd0Fubm91bmNlbWVudCgiUE9TU0VTU0lPTiIsICJub3JtYWwiKTsKICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIENoZWNrIFR1cm5vdmVyIChQb3NzZXNzaW9uIENoYW5nZSkKICAgICAgICAgICAgY29uc3QgcHJldmlvdXNUZWFtID0gdGhpcy5ob2xkZXIgPyB0aGlzLmhvbGRlci50ZWFtIDogKHRoaXMubGFzdEhvbGRlciA/IHRoaXMubGFzdEhvbGRlci50ZWFtIDogbnVsbCk7CiAgICAgICAgICAgIGlmIChwcmV2aW91c1RlYW0gJiYgcHJldmlvdXNUZWFtICE9PSBwbGF5ZXIudGVhbSkgewogICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UgJiYgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJUVVJOT1ZFUiIsIHBsYXllci5tZXNoLnBvc2l0aW9uLCAidGVjaCIpOwogICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gSWYgc29tZW9uZSBlbHNlIGhlbGQgaXQsIHRoZXkgbG9zZSBpdAogICAgICAgICAgICBpZiAodGhpcy5ob2xkZXIgJiYgdGhpcy5ob2xkZXIgIT09IHBsYXllcikgewogICAgICAgICAgICAgICAgdGhpcy5ob2xkZXIubG9zZUJhbGwoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5ob2xkZXIgPSBwbGF5ZXI7CiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSAnaGVsZCc7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBOT1RFOiBXZSBkbyBOT1QgcGFyZW50IHRoZSBtZXNoIHRvIHRoZSBwbGF5ZXIgYW55bW9yZS4KICAgICAgICAgICAgLy8gVGhpcyBwcmV2ZW50cyB0aGUgYmFsbCBmcm9tIGZseWluZyBhcm91bmQgZHVlIHRvIHN3aW0gYW5pbWF0aW9ucy4KICAgICAgICAgICAgLy8gSW5zdGVhZCwgd2UgdXBkYXRlIGl0cyBwb3NpdGlvbiBtYW51YWxseSBpbiB1cGRhdGVIZWxkKCkuCiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBOb3RpZnkgcGxheWVyCiAgICAgICAgICAgIGlmIChwbGF5ZXIucmVjZWl2ZUJhbGwpIHsKICAgICAgICAgICAgICAgIHBsYXllci5yZWNlaXZlQmFsbCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zb2xlLmxvZygiQmFsbCBncmFiYmVkIGJ5ICIgKyBwbGF5ZXIucm9sZSk7CiAgICAgICAgfQoKICAgICAgICBkcm9wKCkgewogICAgICAgICAgICB0aGlzLnJldmVhbCgpOyAvLyBFbnN1cmUgdmlzaWJsZQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gTm8gbmVlZCB0byBkZXRhY2ggZnJvbSBzY2VuZSBncmFwaCBzaW5jZSB3ZSBhcmVuJ3QgcGFyZW50aW5nIHRvIHBsYXllciBhbnltb3JlLgogICAgICAgICAgICAvLyBKdXN0IGNsZWFyIGhvbGRlci4KCiAgICAgICAgICAgIGlmICh0aGlzLmhvbGRlcikgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuaG9sZGVyLmxvc2VCYWxsKSB0aGlzLmhvbGRlci5sb3NlQmFsbCgpOwogICAgICAgICAgICAgICAgdGhpcy5ob2xkZXIgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICB0aGlzLnN0YXRlID0gJ2ZyZWUnOwogICAgICAgIH0KLy8gU2hvb3QvUGFzcwovLyBTaG9vdC9QYXNzCiAgICAgICAgc2hvb3QoZGlyZWN0aW9uVmVjdG9yLCBmb3JjZSwgdHlwZSA9ICdTSCcsIHRlY2huaXF1ZSA9IG51bGwsIHNwaW5WZWN0b3IgPSBudWxsKSB7CiAgICAgICAgICAgIHRoaXMubGFzdEhvbGRlciA9IHRoaXMuaG9sZGVyOyAvLyBSZWNvcmQgZm9yIEVYUCBhdHRyaWJ1dGlvbgogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRnVtYmxlIERldGVjdGlvbiAoVHlwZSAnbm9uZScgaXMgdXNlZCBieSBQbGF5ZXIuZnVtYmxlKQogICAgICAgICAgICBpZiAodHlwZSA9PT0gJ25vbmUnKSB7CiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlICYmIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5zaG93QW5ub3VuY2VtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLnNob3dBbm5vdW5jZW1lbnQoIkZVTUJMRSEiLCAic2xhbSIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmRyb3AoKTsgLy8gRGV0YWNoIGZpcnN0CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTZXQgR3JhY2UgUGVyaW9kIHRvIHByZXZlbnQgaW5zdGFudCBpbnRlcmNlcHRpb25zL2NhdGNoZXMKICAgICAgICAgICAgLy8gMC4ycyBhbGxvd3MgYmFsbCB0byBjbGVhciB0aGUgdGhyb3dlcidzIGltbWVkaWF0ZSB2aWNpbml0eQogICAgICAgICAgICB0aGlzLmNhdGNoR3JhY2VQZXJpb2QgPSAwLjI7CgogICAgICAgICAgICAvLyBQaHlzaWNhbCBWZWxvY2l0eSAoVmlzdWFsIHNwZWVkKQovLyBQaHlzaWNhbCBWZWxvY2l0eSAoVmlzdWFsIHNwZWVkKQogICAgICAgICAgICAvLyBXZSBtYXAgZm9yY2UgKHN0YXQpIHRvIHBoeXNpY2FsIHNwZWVkLCBidXQgY2xhbXAgaXQgcmVhc29uYWJsZQogICAgICAgICAgICAvLyBJbmNyZWFzZWQgY2FwIHRvIDQwLjAgdG8gYWxsb3cgZm9yIHN0cm9uZyBwYXNzZXMgYW5kIGNsZWFycwogICAgICAgICAgICBjb25zdCBzcGVlZCA9IE1hdGgubWluKGZvcmNlLCA0MC4wKTsKICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS5jb3B5KGRpcmVjdGlvblZlY3Rvcikubm9ybWFsaXplKCkubXVsdGlwbHlTY2FsYXIoc3BlZWQpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQXBwbHkgU3BpbiBpZiBwcm92aWRlZAogICAgICAgICAgICBpZiAoc3BpblZlY3RvcikgewogICAgICAgICAgICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuY29weShzcGluVmVjdG9yKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnNldCgwLCAwLCAwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU3RhdCBQb3dlciAoR2FtZSBMb2dpYykKICAgICAgICAgICAgdGhpcy5wb3dlciA9IGZvcmNlOwogICAgICAgICAgICB0aGlzLnBvd2VyVHlwZSA9IHR5cGU7CiAgICAgICAgICAgIHRoaXMudGVjaG5pcXVlID0gdGVjaG5pcXVlOyAKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFVwZGF0ZSBUcmFpbCBDb2xvcgogICAgICAgICAgICBpZiAodGhpcy50cmFpbCkgewogICAgICAgICAgICAgICAgbGV0IGNvbG9yID0gMHgwMGFhZmY7IC8vIERlZmF1bHQgQmx1ZSAoUGFzcykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKHRlY2huaXF1ZSkgewogICAgICAgICAgICAgICAgICAgIGlmICh0ZWNobmlxdWUudHlwZSA9PT0gJ3Zlbm9tJykgY29sb3IgPSAweGFhMDBmZjsgLy8gUHVycGxlCiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodGVjaG5pcXVlLnR5cGUgPT09ICd3aXRoZXInKSBjb2xvciA9IDB4ODg4ODg4OyAvLyBHcmV5CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodGVjaG5pcXVlLnR5cGUgPT09ICduYXAnKSBjb2xvciA9IDB4MDAwMDg4OyAvLyBEYXJrIEJsdWUKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0ZWNobmlxdWUudHlwZSA9PT0gJ3NwaGVyZScpIGNvbG9yID0gMHgwMGZmZmY7IC8vIEN5YW4KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0ZWNobmlxdWUudHlwZSA9PT0gJ2plY2h0JykgY29sb3IgPSAweGZmMDAwMDsgLy8gUmVkCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdTSCcpIHsKICAgICAgICAgICAgICAgICAgICBjb2xvciA9IDB4ZmY0NDAwOyAvLyBPcmFuZ2UvUmVkCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRoaXMudHJhaWwuc2V0Q29sb3IoY29sb3IpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBIYW5kbGUgSW52aXNpYmxlIFNob3QKICAgICAgICAgICAgaWYgKHRlY2huaXF1ZSAmJiB0ZWNobmlxdWUudHlwZSA9PT0gJ2ludmlzaWJsZScpIHsKICAgICAgICAgICAgICAgIHRoaXMuaXNJbnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgaWYgKHRoaXMubWVzaCkgdGhpcy5tZXNoLnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJJbnZpc2libGUgU2hvdCEiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgY29uc29sZS5sb2coYEJhbGwgJHt0eXBlfSB3aXRoIFBvd2VyOiAke3RoaXMucG93ZXIudG9GaXhlZCgxKX0gU3BpbjogJHt0aGlzLmFuZ3VsYXJWZWxvY2l0eS5sZW5ndGgoKS50b0ZpeGVkKDEpfWApOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVmlzdWFsIEZlZWRiYWNrIGZvciBDdXJ2ZQogICAgICAgICAgICBpZiAodGhpcy5hbmd1bGFyVmVsb2NpdHkubGVuZ3RoKCkgPiAxNS4wICYmIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSAmJiB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJDVVJWRSEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJ0ZWNoIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldmVhbCgpIHsKCiAgICAgICAgICAgIHRoaXMuaXNJbnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHRoaXMubWVzaCkgdGhpcy5tZXNoLnZpc2libGUgPSB0cnVlOwogICAgICAgIH0KICAgICAgICAKcmVzZXQoKSB7CiAgICAgICAgICAgIHRoaXMucmV2ZWFsKCk7CiAgICAgICAgICAgIHRoaXMuZHJvcCgpOwogICAgICAgICAgICB0aGlzLm1lc2gucG9zaXRpb24uc2V0KDAsIDAsIDApOwogICAgICAgICAgICB0aGlzLnZlbG9jaXR5LnNldCgwLCAwLCAwKTsKICAgICAgICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuc2V0KDAsIDAsIDApOwogICAgICAgICAgICB0aGlzLmNhdGNoR3JhY2VQZXJpb2QgPSAwOwogICAgICAgICAgICB0aGlzLnBvd2VyID0gMDsKICAgICAgICB9CmlzQ2F0Y2hhYmxlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jYXRjaEdyYWNlUGVyaW9kIDw9IDA7CiAgICAgICAgfQoKICAgICAgICB1cGRhdGVWaXN1YWxzKGR0KSB7CiAgICAgICAgICAgIGlmICghdGhpcy5kZWZvcm1Ob2RlIHx8ICF0aGlzLnNwaW5Ob2RlKSByZXR1cm47CgogICAgICAgICAgICAvLyAxLiBTcXVhc2ggJiBTdHJldGNoIGJhc2VkIG9uIHZlbG9jaXR5Ci8vIDEuIFNxdWFzaCAmIFN0cmV0Y2ggYmFzZWQgb24gdmVsb2NpdHkKICAgICAgICAgICAgY29uc3Qgc3BlZWQgPSB0aGlzLnZlbG9jaXR5Lmxlbmd0aCgpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gT25seSBhcHBseSBzdHJldGNoIGlmIG1vdmluZyBmYXN0IGVub3VnaAogICAgICAgICAgICBpZiAoc3BlZWQgPiAxLjAgJiYgdGhpcy5zdGF0ZSA9PT0gJ2ZyZWUnKSB7CiAgICAgICAgICAgICAgICAvLyBPcmllbnQgZGVmb3JtTm9kZSB0byB2ZWxvY2l0eSBkaXJlY3Rpb24KICAgICAgICAgICAgICAgIGNvbnN0IGRpciA9IHRoaXMudmVsb2NpdHkuY2xvbmUoKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgIC8vIERlZmF1bHQgZm9yd2FyZCBpcyBaICgwLDAsMSkKICAgICAgICAgICAgICAgIHRoaXMuZGVmb3JtTm9kZS5xdWF0ZXJuaW9uLnNldEZyb21Vbml0VmVjdG9ycyhuZXcgVEhSRUUuVmVjdG9yMygwLDAsMSksIGRpcik7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBzdHJldGNoIGZhY3RvcgogICAgICAgICAgICAgICAgLy8gTWF4IHN0cmV0Y2ggYXQgc3BlZWQgNDAgKGFwcHJveCBtYXggc2hvdCBwb3dlcikKICAgICAgICAgICAgICAgIGNvbnN0IGZhY3RvciA9IE1hdGgubWluKHNwZWVkIC8gNDAuMCwgMS4wKTsgCiAgICAgICAgICAgICAgICBjb25zdCBzdHJldGNoID0gMS4wICsgKGZhY3RvciAqIDAuOCk7IC8vIEluY3JlYXNlZCBzdHJldGNoIG1heCB0byAxLjh4CiAgICAgICAgICAgICAgICBjb25zdCBzcXVhc2ggPSAxLjAgLyBNYXRoLnNxcnQoc3RyZXRjaCk7IC8vIE1haW50YWluIHZvbHVtZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0aGlzLmRlZm9ybU5vZGUuc2NhbGUuc2V0KHNxdWFzaCwgc3F1YXNoLCBzdHJldGNoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIFJlc2V0IGRlZm9ybWF0aW9uCiAgICAgICAgICAgICAgICB0aGlzLmRlZm9ybU5vZGUucXVhdGVybmlvbi5pZGVudGl0eSgpOwogICAgICAgICAgICAgICAgdGhpcy5kZWZvcm1Ob2RlLnNjYWxlLnNldCgxLCAxLCAxKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMi4gQXBwbHkgQWNjdW11bGF0ZWQgU3BpbgogICAgICAgICAgICAvLyBTaW5jZSBkZWZvcm1Ob2RlIG1pZ2h0IGJlIHJvdGF0ZWQsIHdlIG5lZWQgdG8gYXBwbHkgc3BpbiBpbiB0aGUgY29ycmVjdCBzcGFjZS4KICAgICAgICAgICAgLy8gc3Bpbk5vZGUgcm90YXRpb24gPSBkZWZvcm1Ob2RlX2ludmVyc2UgKiBhY2N1bXVsYXRlZFJvdGF0aW9uCmNvbnN0IGludkRlZm9ybSA9IHRoaXMuZGVmb3JtTm9kZS5xdWF0ZXJuaW9uLmNsb25lKCkuaW52ZXJ0KCk7CiAgICAgICAgICAgIHRoaXMuc3Bpbk5vZGUucXVhdGVybmlvbi5jb3B5KGludkRlZm9ybS5tdWx0aXBseSh0aGlzLmFjY3VtdWxhdGVkUm90YXRpb24pKTsKICAgICAgICB9CiAgICB9CgogICAgd2luZG93LmZsdXguQmFsbCA9IEJhbGw7Cn0pKCk7","./Ball.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICAvLyBSZXVzYWJsZSBtYXRoIHZlY3RvcnMgdG8gYXZvaWQgR0MKY29uc3QgX2JWZWMgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgY29uc3QgX2F4aXNZID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMSwgMCk7CiAgICBjb25zdCBfdGVtcFZlYyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfbWFnbnVzVmVjID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKCi8vIFBoeXNpY3MgQ29uZmlndXJhdGlvbiAoRXhwb3NlZCBmb3IgRGV2VG9vbHMpCndpbmRvdy5mbHV4LkJhbGxDb25maWcgPSB7CiAgICAgICAgV0FURVJfRFJBRzogMC4xLCAgICAgIC8vIExvdyBkcmFnIGZvciBkaXN0YW5jZQogICAgICAgIFNQSU5fRFJBRzogMC4xNSwgICAgICAvLyBSZWR1Y2VkIGZyb20gMC4zIHNvIGN1cnZlcyBsYXN0IGxvbmdlcgogICAgICAgIE1BR05VU19DT0VGRjogMC44LCAgICAvLyBJbmNyZWFzZWQgZnJvbSAwLjUgZm9yIHB1bmNoaWVyIGN1cnZlcwpCT1VOREFSWV9SQURJVVM6IDMzLjAsIC8vIFNsaWdodGx5IGxhcmdlciB0aGFuIHZpc3VhbCBhcmVuYSAoMzIpIHRvIHByZXZlbnQgZWFybHkgY2xpcHBpbmcKICAgICAgICBCT1VOREFSWV9IRUlHSFQ6IDE1LjAsIC8vIFZlcnRpY2FsIExpbWl0ICgrLy0gWSkKICAgICAgICBHUkFWSVRZX1NQUklORzogMS4wLCAgIC8vIFJlZHVjZWQgZnJvbSA1LjAgKEdlbnRsZSBkZXB0aCBjb3JyZWN0aW9uKQogICAgICAgIEdSQVZJVFlfREFNUDogMS41CiAgICB9OwoKICAgIAogICAgY29uc3QgQyA9IHdpbmRvdy5mbHV4LkJhbGxDb25maWc7IC8vIExvY2FsIGFsaWFzIGZvciBicmV2aXR5CiAgICAvLyAtLS0gVFJBSUwgUkVOREVSRVIgLS0tCiAgICBjbGFzcyBUcmFpbFJlbmRlcmVyIHsKICAgICAgICBjb25zdHJ1Y3RvcihzY2VuZSkgewogICAgICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7CiAgICAgICAgICAgIHRoaXMuc2VnbWVudHMgPSAyNTsKdGhpcy5wb2ludHMgPSBbXTsKdGhpcy53aWR0aCA9IDAuMzg7IC8vIFNjYWxlZCB0byBtYXRjaCBzbWFsbGVyIGJhbGwgKDE1JSByZWR1Y3Rpb24pCiAgICAgICAgICAgIC8vIEdlb21ldHJ5CiAgICAgICAgICAgIGNvbnN0IGdlb21ldHJ5ID0gbmV3IFRIUkVFLkJ1ZmZlckdlb21ldHJ5KCk7CiAgICAgICAgICAgIGNvbnN0IHBvc0RhdGEgPSBuZXcgRmxvYXQzMkFycmF5KHRoaXMuc2VnbWVudHMgKiAyICogMyk7CiAgICAgICAgICAgIGdlb21ldHJ5LnNldEF0dHJpYnV0ZSgncG9zaXRpb24nLCBuZXcgVEhSRUUuQnVmZmVyQXR0cmlidXRlKHBvc0RhdGEsIDMpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEluZGljZXMKICAgICAgICAgICAgY29uc3QgaW5kaWNlcyA9IFtdOwogICAgICAgICAgICBmb3IgKGxldCBpPTA7IGk8dGhpcy5zZWdtZW50cy0xOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGJhc2UgPSBpKjI7CiAgICAgICAgICAgICAgICBpbmRpY2VzLnB1c2goYmFzZSwgYmFzZSsxLCBiYXNlKzIpOwogICAgICAgICAgICAgICAgaW5kaWNlcy5wdXNoKGJhc2UrMSwgYmFzZSszLCBiYXNlKzIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGdlb21ldHJ5LnNldEluZGV4KGluZGljZXMpOwogICAgICAgICAgICAKdGhpcy5tYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7CiAgICAgICAgICAgICAgICBjb2xvcjogMHgwMGFhZmYsCiAgICAgICAgICAgICAgICBzaWRlOiBUSFJFRS5Eb3VibGVTaWRlLAogICAgICAgICAgICAgICAgdHJhbnNwYXJlbnQ6IHRydWUsCiAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLjUsCiAgICAgICAgICAgICAgICBibGVuZGluZzogVEhSRUUuQWRkaXRpdmVCbGVuZGluZywKICAgICAgICAgICAgICAgIGRlcHRoV3JpdGU6IGZhbHNlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5tZXNoID0gbmV3IFRIUkVFLk1lc2goZ2VvbWV0cnksIHRoaXMubWF0ZXJpYWwpOwogICAgICAgICAgICB0aGlzLm1lc2guZnJ1c3R1bUN1bGxlZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLnNjZW5lLmFkZCh0aGlzLm1lc2gpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gSW5pdCBwb2ludHMKICAgICAgICAgICAgZm9yKGxldCBpPTA7IGk8dGhpcy5zZWdtZW50czsgaSsrKSB0aGlzLnBvaW50cy5wdXNoKG5ldyBUSFJFRS5WZWN0b3IzKCkpOwogICAgICAgICAgICB0aGlzLmFjdGl2ZSA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXNldChwb3MpIHsKICAgICAgICAgICAgZm9yKGxldCBpPTA7IGk8dGhpcy5zZWdtZW50czsgaSsrKSB0aGlzLnBvaW50c1tpXS5jb3B5KHBvcyk7CiAgICAgICAgICAgIHRoaXMudXBkYXRlR2VvbWV0cnkoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgc2V0Q29sb3IoaGV4KSB7CiAgICAgICAgICAgIHRoaXMubWF0ZXJpYWwuY29sb3Iuc2V0SGV4KGhleCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHVwZGF0ZShjdXJyZW50UG9zKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5hY3RpdmUpIHsKICAgICAgICAgICAgICAgIHRoaXMucmVzZXQoY3VycmVudFBvcyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFNoaWZ0IHBvaW50cwogICAgICAgICAgICBmb3IgKGxldCBpID0gdGhpcy5zZWdtZW50cyAtIDE7IGkgPiAwOyBpLS0pIHsKICAgICAgICAgICAgICAgIHRoaXMucG9pbnRzW2ldLmNvcHkodGhpcy5wb2ludHNbaS0xXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5wb2ludHNbMF0uY29weShjdXJyZW50UG9zKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHRoaXMudXBkYXRlR2VvbWV0cnkoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdXBkYXRlR2VvbWV0cnkoKSB7CiAgICAgICAgICAgIGNvbnN0IHBvc2l0aW9ucyA9IHRoaXMubWVzaC5nZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uLmFycmF5OwogICAgICAgICAgICBjb25zdCBjYW0gPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UgPyB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhIDogbnVsbDsKICAgICAgICAgICAgaWYgKCFjYW0pIHJldHVybjsKICAgICAgICAgICAgY29uc3QgY2FtUG9zID0gY2FtLnBvc2l0aW9uOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgdGVtcERpciA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICAgICAgICAgIGNvbnN0IHRlbXBUb0NhbSA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICAgICAgICAgIGNvbnN0IHRlbXBSaWdodCA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CgogICAgICAgICAgICBmb3IgKGxldCBpPTA7IGk8dGhpcy5zZWdtZW50czsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwID0gdGhpcy5wb2ludHNbaV07CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFRhcGVyIHdpZHRoCiAgICAgICAgICAgICAgICBjb25zdCB3ID0gdGhpcy53aWR0aCAqICgxIC0gKGkgLyB0aGlzLnNlZ21lbnRzKSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBkaXJlY3Rpb24KICAgICAgICAgICAgICAgIGlmIChpIDwgdGhpcy5zZWdtZW50cyAtIDEpIHsKICAgICAgICAgICAgICAgICAgICB0ZW1wRGlyLnN1YlZlY3RvcnModGhpcy5wb2ludHNbaV0sIHRoaXMucG9pbnRzW2krMV0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0ZW1wRGlyLnN1YlZlY3RvcnModGhpcy5wb2ludHNbaS0xXSwgdGhpcy5wb2ludHNbaV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAodGVtcERpci5sZW5ndGhTcSgpIDwgMC4wMDAxKSB0ZW1wRGlyLnNldCgwLCAxLCAwKTsKICAgICAgICAgICAgICAgIHRlbXBEaXIubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRlbXBUb0NhbS5zdWJWZWN0b3JzKGNhbVBvcywgcCkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICB0ZW1wUmlnaHQuY3Jvc3NWZWN0b3JzKHRlbXBEaXIsIHRlbXBUb0NhbSkubm9ybWFsaXplKCkubXVsdGlwbHlTY2FsYXIodyk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFZlcnQgMQogICAgICAgICAgICAgICAgcG9zaXRpb25zW2kqNiArIDBdID0gcC54IC0gdGVtcFJpZ2h0Lng7CiAgICAgICAgICAgICAgICBwb3NpdGlvbnNbaSo2ICsgMV0gPSBwLnkgLSB0ZW1wUmlnaHQueTsKICAgICAgICAgICAgICAgIHBvc2l0aW9uc1tpKjYgKyAyXSA9IHAueiAtIHRlbXBSaWdodC56OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBWZXJ0IDIKICAgICAgICAgICAgICAgIHBvc2l0aW9uc1tpKjYgKyAzXSA9IHAueCArIHRlbXBSaWdodC54OwogICAgICAgICAgICAgICAgcG9zaXRpb25zW2kqNiArIDRdID0gcC55ICsgdGVtcFJpZ2h0Lnk7CiAgICAgICAgICAgICAgICBwb3NpdGlvbnNbaSo2ICsgNV0gPSBwLnogKyB0ZW1wUmlnaHQuejsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLm1lc2guZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbi5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgICAgfQogICAgfQoKY2xhc3MgQmFsbCB7CgogICAgICAgIGNvbnN0cnVjdG9yKHNjZW5lKSB7CiAgICAgICAgICAgIHRoaXMuc2NlbmUgPSBzY2VuZTsKICAgICAgICAgICAgdGhpcy5tZXNoID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5ob2xkZXIgPSBudWxsOyAKICAgICAgICAgICAgdGhpcy5sYXN0SG9sZGVyID0gbnVsbDsgLy8gVHJhY2sgd2hvIHRocmV3IGl0IGxhc3QgKGZvciBFWFAvQXNzaXN0cykKICAgICAgICAgICAgCiAgICAgICAgICAgIHRoaXMudmVsb2NpdHkgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAwKTsKICAgICAgICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAwKTsKICAgICAgICAgICAgdGhpcy5zdGF0ZSA9ICdmcmVlJzsgLy8gJ2ZyZWUnLCAnaGVsZCcsICdtYWduZXRpemVkJwogICAgICAgICAgICB0aGlzLmlzSW52aXNpYmxlID0gZmFsc2U7CgogICAgICAgICAgICAvLyBDb250aW51b3VzIFN0YXRzCiAgICAgICAgICAgIHRoaXMucG93ZXIgPSAwOyAgICAgIC8vIEN1cnJlbnQgUEEgb3IgU0ggdmFsdWUKICAgICAgICAgICAgdGhpcy5wb3dlclR5cGUgPSAnbm9uZSc7IC8vICdQQScgb3IgJ1NIJwogICAgICAgICAgICB0aGlzLmRlY2F5UmF0ZSA9IDMuMDsgLy8gU3RhdCBwb2ludHMgbG9zdCBwZXIgc2Vjb25kIChXYXRlciByZXNpc3RhbmNlKQogICAgICAgICAgICB0aGlzLmNhdGNoR3JhY2VQZXJpb2QgPSAwOyAvLyBUaW1lIGJlZm9yZSBiYWxsIGNhbiBiZSBjYXVnaHQgYWdhaW4KCiAgICAgICAgICAgIC8vIE1hZ25ldCBTeXN0ZW0KICAgICAgICAgICAgdGhpcy5tYWduZXRUYXJnZXQgPSBudWxsOwogICAgICAgICAgICB0aGlzLm1hZ25ldFRpbWVyID0gMDsKICAgICAgICAgICAgdGhpcy5tYWduZXREdXJhdGlvbiA9IDAuMjsgCiAgICAgICAgICAgIHRoaXMubWFnbmV0U3RhcnRQb3MgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgICAgICAgICB0aGlzLm1hZ25ldFN0YXJ0VmVsID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKCiAgICAgICAgICAgIC8vIFZpc3VhbHMgKFNxdWFzaCAmIFN0cmV0Y2gpCiAgICAgICAgICAgIHRoaXMuYWNjdW11bGF0ZWRSb3RhdGlvbiA9IG5ldyBUSFJFRS5RdWF0ZXJuaW9uKCk7CiAgICAgICAgICAgIHRoaXMuZGVmb3JtTm9kZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuc3Bpbk5vZGUgPSBudWxsOwogICAgICAgICAgICB0aGlzLm1vZGVsID0gbnVsbDsKCnRoaXMuaW5pdE1lc2goKTsKICAgICAgICAgICAgdGhpcy50cmFpbCA9IG5ldyBUcmFpbFJlbmRlcmVyKHNjZW5lKTsKICAgICAgICAgICAgdGhpcy5fYnViYmxlVGltZXIgPSAwOwp9CmluaXRNZXNoKCkgewogICAgICAgICAgICAvLyBIaWVyYXJjaHk6IE1lc2ggKFBvcykgLT4gRGVmb3JtIChTcXVhc2gvU3RyZXRjaCkgLT4gU3BpbiAoUm90YXRpb24pIC0+IE1vZGVsCiAgICAgICAgICAgIHRoaXMubWVzaCA9IG5ldyBUSFJFRS5Hcm91cCgpOwogICAgICAgICAgICB0aGlzLnNjZW5lLmFkZCh0aGlzLm1lc2gpOwoKICAgICAgICAgICAgdGhpcy5kZWZvcm1Ob2RlID0gbmV3IFRIUkVFLkdyb3VwKCk7CiAgICAgICAgICAgIHRoaXMuZGVmb3JtTm9kZS5wb3NpdGlvbi55ID0gLTEuNDsgLy8gVmlzdWFsIG9mZnNldDogTG93ZXJlZCBzaWduaWZpY2FudGx5IHBlciByZXF1ZXN0ICh3YXMgLTAuOSkKICAgICAgICAgICAgdGhpcy5tZXNoLmFkZCh0aGlzLmRlZm9ybU5vZGUpOyAvLyBGaXg6IEFkZCBkZWZvcm1Ob2RlIHRvIG1lc2gKCiAgICAgICAgICAgIHRoaXMuc3Bpbk5vZGUgPSBuZXcgVEhSRUUuR3JvdXAoKTsKICAgICAgICAgICAgdGhpcy5kZWZvcm1Ob2RlLmFkZCh0aGlzLnNwaW5Ob2RlKTsKCiAgICAgICAgICAgIC8vIFByb2NlZHVyYWwgUGxhY2Vob2xkZXIgVGV4dHVyZSAoQmxpdHpiYWxsLWlzaCkKICAgICAgICAgICAgY29uc3QgcGxhY2Vob2xkZXJUZXggPSAoKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgYyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICAgICAgICAgICAgYy53aWR0aCA9IDEyODsgYy5oZWlnaHQgPSA2NDsKICAgICAgICAgICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnI2VlZWVlZSc7CiAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QoMCwwLDEyOCw2NCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEJsdWUgYnVtcHMvZGV0YWlscwogICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjMDA4OGZmJzsKICAgICAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpPDY7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgICAgICAgICBjdHguYXJjKGkqMjUsIDMyLCAxMCwgMCwgTWF0aC5QSSoyKTsKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjMDA0NDg4JzsKICAgICAgICAgICAgICAgIGN0eC5maWxsUmVjdCgwLCAyOCwgMTI4LCA4KTsgLy8gU3RyaXBlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICAgICAgICAgICAgfSkoKTsKCiAgICAgICAgICAgIC8vIFBsYWNlaG9sZGVyIFZpc3VhbCAoSW1tZWRpYXRlIGZlZWRiYWNrLCBwZXJzaXN0cyB1bnRpbCB2YWxpZCBtb2RlbCBsb2FkcykKLy8gUGxhY2Vob2xkZXIgVmlzdWFsIChJbW1lZGlhdGUgZmVlZGJhY2ssIHBlcnNpc3RzIHVudGlsIHZhbGlkIG1vZGVsIGxvYWRzKQovLyBQbGFjZWhvbGRlciBWaXN1YWwgKEltbWVkaWF0ZSBmZWVkYmFjaywgcGVyc2lzdHMgdW50aWwgdmFsaWQgbW9kZWwgbG9hZHMpCmNvbnN0IGdlb21ldHJ5ID0gbmV3IFRIUkVFLlNwaGVyZUdlb21ldHJ5KDAuMywgMTYsIDE2KTsgLy8gU2NhbGVkIGRvd24gfjE1JQogICAgICAgICAgICBjb25zdCBtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7CiAgICAgICAgICAgICAgICBtYXA6IHBsYWNlaG9sZGVyVGV4LAogICAgICAgICAgICAgICAgY29sb3I6IDB4ZmZmZmZmLCAKICAgICAgICAgICAgICAgIHdpcmVmcmFtZTogZmFsc2UsIC8vIFNvbGlkCiAgICAgICAgICAgICAgICB0cmFuc3BhcmVudDogZmFsc2UsCiAgICAgICAgICAgICAgICBvcGFjaXR5OiAxLjAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMucGxhY2Vob2xkZXIgPSBuZXcgVEhSRUUuTWVzaChnZW9tZXRyeSwgbWF0ZXJpYWwpOwoKICAgICAgICAgICAgLy8gTG9hZCBHTEIgTW9kZWwKICAgICAgICAgICAgY29uc3QgdXJsID0gJ2h0dHBzOi8vY2RuLnRpbnlnbGIuY29tL21vZGVscy81MjFhZTg3ODhlNTg0ZTM3OGE3OWQ5NzMyYTA3NTM1Ni5nbGInOwogICAgICAgICAgICAKICAgICAgICAgICAgd2luZG93LmZsdXguQXNzZXRMb2FkZXIubG9hZE1vZGVsKHVybCwgKGdsdGYpID0+IHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJERUJVRzogQmFsbCBHTEIgbG9hZGVkLiIsIGdsdGYpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBtb2RlbCA9IGdsdGYuc2NlbmU7CgogICAgICAgICAgICAgICAgLy8gMS4gUmVzZXQgcm9vdCB0cmFuc2Zvcm1zCiAgICAgICAgICAgICAgICBtb2RlbC5wb3NpdGlvbi5zZXQoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICBtb2RlbC5yb3RhdGlvbi5zZXQoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICBtb2RlbC5zY2FsZS5zZXQoMSwgMSwgMSk7CiAgICAgICAgICAgICAgICBtb2RlbC51cGRhdGVNYXRyaXhXb3JsZCh0cnVlKTsKCiAgICAgICAgICAgICAgICAvLyAyLiBIYXJkZW4gTWF0ZXJpYWxzICYgVmlzaWJpbGl0eQogICAgICAgICAgICAgICAgbW9kZWwudHJhdmVyc2UoKG5vZGUpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5pc01lc2gpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5jYXN0U2hhZG93ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUucmVjZWl2ZVNoYWRvdyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICBub2RlLmZydXN0dW1DdWxsZWQgPSBmYWxzZTsgLy8gQ1JJVElDQUw6IFByZXZlbnQgY3VsbGluZyBpZiBib3VuZHMgYXJlIG9mZgogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUubWF0ZXJpYWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1hdHMgPSBBcnJheS5pc0FycmF5KG5vZGUubWF0ZXJpYWwpID8gbm9kZS5tYXRlcmlhbCA6IFtub2RlLm1hdGVyaWFsXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdHMuZm9yRWFjaChtID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLmNvbG9yLnNldEhleCgweGZmZmZmZik7IC8vIEZvcmNlIHdoaXRlIGJhc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLnNpZGUgPSBUSFJFRS5Eb3VibGVTaWRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0udHJhbnNwYXJlbnQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLm9wYWNpdHkgPSAxLjA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbS5hbHBoYVRlc3QgPSAwOyAvLyBDUklUSUNBTDogRGlzYWJsZSBhbHBoYSB0ZXN0IHRvIHByZXZlbnQgY3VsbGluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0uZGVwdGhXcml0ZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbS5kZXB0aFRlc3QgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAvLyAzLiBDb21wdXRlIEJvdW5kaW5nIEJveAogICAgICAgICAgICAgICAgY29uc3QgYm94ID0gbmV3IFRIUkVFLkJveDMoKS5zZXRGcm9tT2JqZWN0KG1vZGVsKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNpemUgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgICAgICAgICAgICAgYm94LmdldFNpemUoc2l6ZSk7CiAgICAgICAgICAgICAgICBjb25zdCBjZW50ZXIgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgICAgICAgICAgICAgYm94LmdldENlbnRlcihjZW50ZXIpOwoKICAgICAgICAgICAgICAgIC8vIDQuIFZhbGlkYXRpb24KICAgICAgICAgICAgICAgIGNvbnN0IG1heERpbSA9IE1hdGgubWF4KHNpemUueCwgc2l6ZS55LCBzaXplLnopOwogICAgICAgICAgICAgICAgaWYgKG1heERpbSA8PSAwLjAwMSB8fCAhaXNGaW5pdGUobWF4RGltKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiQmFsbCBtb2RlbCBoYXMgaW52YWxpZCBkaW1lbnNpb25zLiBLZWVwaW5nIHBsYWNlaG9sZGVyLiIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsgCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gNS4gQ2FsY3VsYXRlIFNjYWxlCi8vIDUuIENhbGN1bGF0ZSBTY2FsZQpjb25zdCB0YXJnZXREaWFtZXRlciA9IDAuNzI7IC8vIFJlZHVjZWQgc2NhbGUgYnkgfjE1JSAod2FzIDAuODUpCiAgICAgICAgICAgICAgICBjb25zdCBzY2FsZUZhY3RvciA9IHRhcmdldERpYW1ldGVyIC8gbWF4RGltOwoKICAgICAgICAgICAgICAgIC8vIDYuIEFwcGx5IFRyYW5zZm9ybXMKICAgICAgICAgICAgICAgIG1vZGVsLnNjYWxlLnNldFNjYWxhcihzY2FsZUZhY3Rvcik7CiAgICAgICAgICAgICAgICBtb2RlbC5wb3NpdGlvbi5jb3B5KGNlbnRlcikubXVsdGlwbHlTY2FsYXIoLXNjYWxlRmFjdG9yKTsKCiAgICAgICAgICAgICAgICAvLyA3LiBTd2FwIFBsYWNlaG9sZGVyCiAgICAgICAgICAgICAgICBpZiAodGhpcy5wbGFjZWhvbGRlcikgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc3Bpbk5vZGUucmVtb3ZlKHRoaXMucGxhY2Vob2xkZXIpOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnBsYWNlaG9sZGVyLmdlb21ldHJ5KSB0aGlzLnBsYWNlaG9sZGVyLmdlb21ldHJ5LmRpc3Bvc2UoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsID0gbW9kZWw7CiAgICAgICAgICAgICAgICB0aGlzLnNwaW5Ob2RlLmFkZCh0aGlzLm1vZGVsKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBCbGl0emJhbGwgbW9kZWwgYXR0YWNoZWQuIFNjYWxlOiAke3NjYWxlRmFjdG9yLnRvRml4ZWQoNCl9YCk7CgogICAgICAgICAgICB9LCB1bmRlZmluZWQsIChlcnIpID0+IHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkZhaWxlZCB0byBsb2FkIEJsaXR6YmFsbCBtb2RlbDoiLCBlcnIpOwogICAgICAgICAgICAgICAgLy8gRmFsbGJhY2s6IEtlZXAgcGxhY2Vob2xkZXIgYnV0IHRpbnQgaXQgcmVkIHRvIGluZGljYXRlIGVycm9yCiAgICAgICAgICAgICAgICBpZiAodGhpcy5wbGFjZWhvbGRlcikgewogICAgICAgICAgICAgICAgICAgIHRoaXMucGxhY2Vob2xkZXIubWF0ZXJpYWwuY29sb3Iuc2V0SGV4KDB4ZmZhYWFhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKdXBkYXRlKGR0KSB7CiAgICAgICAgICAgIGlmICghdGhpcy5tZXNoKSByZXR1cm47CgogICAgICAgICAgICAvLyBTYWZldHk6IFJlc2V0IGlmIHBvc2l0aW9uIGNvcnJ1cHRlZAogICAgICAgICAgICBpZiAoaXNOYU4odGhpcy5tZXNoLnBvc2l0aW9uLngpIHx8IGlzTmFOKHRoaXMubWVzaC5wb3NpdGlvbi55KSB8fCBpc05hTih0aGlzLm1lc2gucG9zaXRpb24ueikpIHsKICAgICAgICAgICAgICAgIHRoaXMucmVzZXQoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gU2FmZXR5OiBGaXggIlVucGlja2FibGUgQmFsbCIgQnVnCiAgICAgICAgICAgIC8vIElmIHN0YXRlIGlzICdoZWxkJyBvciAnbWFnbmV0aXplZCcgYnV0IHRoZSBhY3RvciBpcyBtaXNzaW5nL2ludmFsaWQsIGZvcmNlIGRyb3AgdG8gJ2ZyZWUnLgogICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSA9PT0gJ2hlbGQnICYmICghdGhpcy5ob2xkZXIgfHwgIXRoaXMuaG9sZGVyLm1lc2gpKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSA9PT0gJ21hZ25ldGl6ZWQnICYmICghdGhpcy5tYWduZXRUYXJnZXQgfHwgIXRoaXMubWFnbmV0VGFyZ2V0Lm1lc2gpKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3AoKTsKICAgICAgICAgICAgfQppZiAodGhpcy50cmFpbCkgewogICAgICAgICAgICAgICAgLy8gVHJhaWwgaXMgYWN0aXZlIGlmIGJhbGwgaXMgbW92aW5nIGZhc3QgYW5kIGZyZWUKICAgICAgICAgICAgICAgIGNvbnN0IHNwZWVkID0gdGhpcy52ZWxvY2l0eS5sZW5ndGgoKTsKICAgICAgICAgICAgICAgIHRoaXMudHJhaWwuYWN0aXZlID0gKHRoaXMuc3RhdGUgPT09ICdmcmVlJyAmJiBzcGVlZCA+IDIuMCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEZpeDogT2Zmc2V0IHRyYWlsIHRvIG1hdGNoIHZpc3VhbCBtb2RlbCBwb3NpdGlvbiAoZGVmb3JtTm9kZSBvZmZzZXQpCiAgICAgICAgICAgICAgICBfYlZlYy5jb3B5KHRoaXMubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZWZvcm1Ob2RlKSBfYlZlYy55ICs9IHRoaXMuZGVmb3JtTm9kZS5wb3NpdGlvbi55OwoKICAgICAgICAgICAgICAgIHRoaXMudHJhaWwudXBkYXRlKF9iVmVjKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUgPT09ICdoZWxkJyAmJiB0aGlzLmhvbGRlciAmJiB0aGlzLmhvbGRlci5tZXNoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUhlbGQoZHQpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuc3RhdGUgPT09ICdtYWduZXRpemVkJykgewogICAgICAgICAgICAgICAgdGhpcy51cGRhdGVNYWduZXRpemVkKGR0KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlRnJlZShkdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh0aGlzLmNhdGNoR3JhY2VQZXJpb2QgPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNhdGNoR3JhY2VQZXJpb2QgLT0gZHQ7CiAgICAgICAgICAgIH0KCnRoaXMudXBkYXRlVmlzdWFscyhkdCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTYWZldHk6IEVuc3VyZSB2aXNpYmlsaXR5IGlmIG5vdCBleHBsaWNpdGx5IGludmlzaWJsZQovLyBTYWZldHk6IEVuc3VyZSB2aXNpYmlsaXR5IGlmIG5vdCBleHBsaWNpdGx5IGludmlzaWJsZQogICAgICAgICAgICBpZiAodGhpcy5tZXNoICYmICF0aGlzLmlzSW52aXNpYmxlKSB7CiAgICAgICAgICAgICAgICB0aGlzLm1lc2gudmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgICAgICAvLyBGb3JjZSBtb2RlbCB2aXNpYmlsaXR5IGlmIHByZXNlbnQgKHNvbWV0aW1lcyBHTFRGIGxvYWRlciBoaWRlcyBpdCkKICAgICAgICAgICAgICAgIGlmICh0aGlzLm1vZGVsKSB0aGlzLm1vZGVsLnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKbWFnbmV0aXplKHRhcmdldCkgewogICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSA9PT0gJ21hZ25ldGl6ZWQnIHx8IHRoaXMuc3RhdGUgPT09ICdoZWxkJykgcmV0dXJuOwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5zdGF0ZSA9ICdtYWduZXRpemVkJzsKICAgICAgICAgICAgdGhpcy5tYWduZXRUYXJnZXQgPSB0YXJnZXQ7CiAgICAgICAgICAgIHRoaXMuaG9sZGVyID0gdGFyZ2V0OyAvLyBMb2dpY2FsIHBvc3Nlc3Npb24gc28gQUkgcmVhY3RzCiAgICAgICAgICAgIHRoaXMubWFnbmV0VGltZXIgPSAwOwogICAgICAgICAgICB0aGlzLm1hZ25ldFN0YXJ0UG9zLmNvcHkodGhpcy5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgdGhpcy5tYWduZXRTdGFydFZlbC5jb3B5KHRoaXMudmVsb2NpdHkpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRHluYW1pYyBEdXJhdGlvbiBiYXNlZCBvbiBkaXN0YW5jZSAoU21vb3RoZXIgZm9yIGxvbmcgcmFuZ2UsIHNuYXBweSBmb3IgY2xvc2UpCiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSB0aGlzLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyh0YXJnZXQubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgIHRoaXMubWFnbmV0RHVyYXRpb24gPSBNYXRoLm1heCgwLjE1LCBNYXRoLm1pbigwLjQsIGRpc3QgLyAxNS4wKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBLaWxsIHBoeXNpY3MKICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS5zZXQoMCwgMCwgMCk7CiAgICAgICAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnNldCgwLCAwLCAwKTsKCiAgICAgICAgICAgIC8vIE5vdGlmeSBwbGF5ZXIgaW1tZWRpYXRlbHkgc28gdGhleSBzdG9wIGNoYXNpbmcgYW5kIHBsYXkgYW5pbWF0aW9uCiAgICAgICAgICAgIGlmICh0YXJnZXQucmVjZWl2ZUJhbGwpIHsKICAgICAgICAgICAgICAgIHRhcmdldC5yZWNlaXZlQmFsbCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLnJldmVhbCgpOwogICAgICAgIH0KCnVwZGF0ZU1hZ25ldGl6ZWQoZHQpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLm1hZ25ldFRhcmdldCB8fCAhdGhpcy5tYWduZXRUYXJnZXQubWVzaCkgewogICAgICAgICAgICAgICAgdGhpcy5kcm9wKCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMubWFnbmV0VGltZXIgKz0gZHQ7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBOb3JtYWxpemVkIFRpbWUKICAgICAgICAgICAgbGV0IHQgPSB0aGlzLm1hZ25ldFRpbWVyIC8gdGhpcy5tYWduZXREdXJhdGlvbjsKICAgICAgICAgICAgaWYgKHQgPiAxLjApIHQgPSAxLjA7CgogICAgICAgICAgICAvLyBUYXJnZXQgIlZpcnR1YWwgSGFuZCIgUG9zaXRpb24gKEZyb250IG9mIENoZXN0KQogICAgICAgICAgICBjb25zdCBob2xkZXJQb3MgPSB0aGlzLm1hZ25ldFRhcmdldC5tZXNoLnBvc2l0aW9uOwogICAgICAgICAgICBjb25zdCBob2xkZXJRdWF0ID0gdGhpcy5tYWduZXRUYXJnZXQubWVzaC5xdWF0ZXJuaW9uOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gT2Zmc2V0OiBGb3J3YXJkIDAuNiwgVXAgMS4wIChDaGVzdCBoZWlnaHQpCiAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IF9iVmVjLnNldCgwLCAxLjAsIDAuNikuYXBwbHlRdWF0ZXJuaW9uKGhvbGRlclF1YXQpOwogICAgICAgICAgICBjb25zdCB0YXJnZXRQb3MgPSBvZmZzZXQuYWRkKGhvbGRlclBvcyk7CgogICAgICAgICAgICAvLyAtLS0gUVVBRFJBVElDIEJFWklFUiBDVVJWRSAtLS0KICAgICAgICAgICAgLy8gUDAgPSBTdGFydCwgUDIgPSBUYXJnZXQKICAgICAgICAgICAgLy8gUDEgPSBDb250cm9sIFBvaW50IChQcm9qZWN0ZWQgYWxvbmcgaW5pdGlhbCB2ZWxvY2l0eSB0byBwcmVzZXJ2ZSBtb21lbnR1bSBmZWVsKQogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgcDAgPSB0aGlzLm1hZ25ldFN0YXJ0UG9zOwogICAgICAgICAgICBjb25zdCBwMiA9IHRhcmdldFBvczsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBQMSAoQ29udHJvbCBQb2ludCkKICAgICAgICAgICAgLy8gUHJvamVjdCBmb3J3YXJkIGZyb20gUDAgYWxvbmcgc3RhcnQgdmVsb2NpdHkgdmVjdG9yCiAgICAgICAgICAgIC8vIERpc3RhbmNlIG9mIHByb2plY3Rpb24gPSA0MCUgb2YgdG90YWwgZGlzdGFuY2UgdG8gdGFyZ2V0CiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBwMC5kaXN0YW5jZVRvKHAyKTsKICAgICAgICAgICAgY29uc3QgcDEgPSBfdGVtcFZlYy5jb3B5KHAwKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IHZlbExlbiA9IHRoaXMubWFnbmV0U3RhcnRWZWwubGVuZ3RoU3EoKTsKICAgICAgICAgICAgaWYgKHZlbExlbiA+IDEuMCkgewogICAgICAgICAgICAgICAgLy8gVXNlIHZlbG9jaXR5IHRhbmdlbnQKICAgICAgICAgICAgICAgIGNvbnN0IGRpciA9IHRoaXMubWFnbmV0U3RhcnRWZWwuY2xvbmUoKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgIHAxLmFkZChkaXIubXVsdGlwbHlTY2FsYXIoZGlzdCAqIDAuNCkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gTm8gdmVsb2NpdHkgKHN0YXRpb25hcnkgYmFsbCksIGFyYyB1cHdhcmRzIHNsaWdodGx5CiAgICAgICAgICAgICAgICBwMS5sZXJwKHAyLCAwLjUpOwogICAgICAgICAgICAgICAgcDEueSArPSAxLjU7IAogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBCZXppZXI6IEIodCkgPSAoMS10KV4yICogUDAgKyAyKDEtdCl0ICogUDEgKyB0XjIgKiBQMgogICAgICAgICAgICBjb25zdCBvbmVNaW51c1QgPSAxLjAgLSB0OwogICAgICAgICAgICBjb25zdCB3MCA9IG9uZU1pbnVzVCAqIG9uZU1pbnVzVDsKICAgICAgICAgICAgY29uc3QgdzEgPSAyLjAgKiBvbmVNaW51c1QgKiB0OwogICAgICAgICAgICBjb25zdCB3MiA9IHQgKiB0OwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5tZXNoLnBvc2l0aW9uLnggPSAodzAgKiBwMC54KSArICh3MSAqIHAxLngpICsgKHcyICogcDIueCk7CiAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi55ID0gKHcwICogcDAueSkgKyAodzEgKiBwMS55KSArICh3MiAqIHAyLnkpOwogICAgICAgICAgICB0aGlzLm1lc2gucG9zaXRpb24ueiA9ICh3MCAqIHAwLnopICsgKHcxICogcDEueikgKyAodzIgKiBwMi56KTsKCiAgICAgICAgICAgIC8vIEZpbmlzaAogICAgICAgICAgICBpZiAodCA+PSAxLjApIHsKICAgICAgICAgICAgICAgIHRoaXMuZ3JhYih0aGlzLm1hZ25ldFRhcmdldCk7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgp1cGRhdGVIZWxkKGR0KSB7CiAgICAgICAgICAgIC8vIEFUVEFDSEVEIFNUQVRFIChWaXJ0dWFsIEF0dGFjaG1lbnQpCiAgICAgICAgICAgIGlmICghdGhpcy5ob2xkZXIgfHwgIXRoaXMuaG9sZGVyLm1lc2gpIHsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcCgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLnZlbG9jaXR5LnNldCgwLCAwLCAwKTsKICAgICAgICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuc2V0KDAsIDAsIDApOwoKICAgICAgICAgICAgLy8gMS4gVHJ5IHRvIHVzZSBIYW5kIEJvbmUgaWYgYXZhaWxhYmxlIChSZWFsaXNtKQogICAgICAgICAgICBpZiAodGhpcy5ob2xkZXIuaGFuZEJvbmUpIHsKICAgICAgICAgICAgICAgIC8vIEdldCB3b3JsZCBwb3NpdGlvbiBvZiB0aGUgaGFuZCBib25lCiAgICAgICAgICAgICAgICB0aGlzLmhvbGRlci5oYW5kQm9uZS5nZXRXb3JsZFBvc2l0aW9uKHRoaXMubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEFkanVzdCBzbGlnaHRseSB0byBzaXQgSU4gdGhlIGhhbmQgcmF0aGVyIHRoYW4gT04gdGhlIHdyaXN0CiAgICAgICAgICAgICAgICAvLyBXZSBjYW4ndCBlYXNpbHkga25vdyAiZm9yd2FyZCIgZm9yIHRoZSBib25lIHdpdGhvdXQgbW9yZSBpbmZvLCAKICAgICAgICAgICAgICAgIC8vIGJ1dCB1c3VhbGx5IEdMVEYgYm9uZXMgYXJlIG9yaWVudGVkLiBGb3Igbm93LCBleGFjdCBib25lIHBvcyBpcyBiZXR0ZXIgdGhhbiBjaGVzdC4KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIDIuIEZhbGxiYWNrOiBDYWxjdWxhdGUgIkNhcnJ5aW5nIiBQb3NpdGlvbiAoUmlnaHQgSGFuZCBTaWRlKQogICAgICAgICAgICAgICAgLy8gUmVsYXRpdmUgdG8gcGxheWVyOiBVcCAwLjggKFdhaXN0L0NoZXN0KSwgUmlnaHQgMC40LCBGb3J3YXJkIDAuNQogICAgICAgICAgICAgICAgY29uc3QgaG9sZGVyUG9zID0gdGhpcy5ob2xkZXIubWVzaC5wb3NpdGlvbjsKICAgICAgICAgICAgICAgIGNvbnN0IGhvbGRlclF1YXQgPSB0aGlzLmhvbGRlci5tZXNoLnF1YXRlcm5pb247CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFJldXNlIF9iVmVjCiAgICAgICAgICAgICAgICAvLyBPZmZzZXQ6IHg9MC4zNSAoUmlnaHQpLCB5PTAuOSAoTG93ZXIgQ2hlc3QpLCB6PTAuNSAoRm9yd2FyZCkKICAgICAgICAgICAgICAgIF9iVmVjLnNldCgwLjM1LCAwLjksIDAuNSkuYXBwbHlRdWF0ZXJuaW9uKGhvbGRlclF1YXQpOwogICAgICAgICAgICAgICAgdGhpcy5tZXNoLnBvc2l0aW9uLmNvcHkoaG9sZGVyUG9zKS5hZGQoX2JWZWMpOwogICAgICAgICAgICB9CgovLyBWaXN1YWwgRmxhaXI6IFNwaW4gdGhlIGJhbGwgc2xvd2x5CiAgICAgICAgICAgIGNvbnN0IHJvdFggPSBuZXcgVEhSRUUuUXVhdGVybmlvbigpLnNldEZyb21BeGlzQW5nbGUobmV3IFRIUkVFLlZlY3RvcjMoMSwwLDApLCAyICogZHQpOwogICAgICAgICAgICBjb25zdCByb3RZID0gbmV3IFRIUkVFLlF1YXRlcm5pb24oKS5zZXRGcm9tQXhpc0FuZ2xlKG5ldyBUSFJFRS5WZWN0b3IzKDAsMSwwKSwgNSAqIGR0KTsKICAgICAgICAgICAgdGhpcy5hY2N1bXVsYXRlZFJvdGF0aW9uLm11bHRpcGx5KHJvdFgpLm11bHRpcGx5KHJvdFkpOwogICAgICAgIH0KCnVwZGF0ZUZyZWUoZHQpIHsKICAgICAgICAgICAgLy8gUEhZU0lDUyBTVEFURQogICAgICAgICAgICBjb25zdCBDID0gd2luZG93LmZsdXguQmFsbENvbmZpZzsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIDEuIE1hZ251cyBFZmZlY3QgKEN1cnZlKQogICAgICAgICAgICAvLyBGb3JjZSA9IFNwaW4geCBWZWxvY2l0eQogICAgICAgICAgICBpZiAodGhpcy5hbmd1bGFyVmVsb2NpdHkubGVuZ3RoU3EoKSA+IDAuMSAmJiB0aGlzLnZlbG9jaXR5Lmxlbmd0aFNxKCkgPiAwLjUpIHsKICAgICAgICAgICAgICAgIF9tYWdudXNWZWMuY29weSh0aGlzLmFuZ3VsYXJWZWxvY2l0eSkuY3Jvc3ModGhpcy52ZWxvY2l0eSkubXVsdGlwbHlTY2FsYXIoQy5NQUdOVVNfQ09FRkYgKiBkdCk7CiAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5LmFkZChfbWFnbnVzVmVjKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRGVjYXkgU3BpbgogICAgICAgICAgICAgICAgY29uc3Qgc3BpbkRyYWcgPSBNYXRoLm1heCgwLCAxIC0gKEMuU1BJTl9EUkFHICogZHQpKTsKICAgICAgICAgICAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5Lm11bHRpcGx5U2NhbGFyKHNwaW5EcmFnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMi4gVmVydGljYWwgUmVzdG9yaW5nIEZvcmNlIChQbGF5YWJsZSBEZXB0aCBDb25zdHJhaW50KQogICAgICAgICAgICAvLyBLZWVwcyBiYWxsIG5lYXIgWT0wIHRvIHByZXZlbnQgaXQgZ2V0dGluZyBsb3N0IGFib3ZlL2JlbG93IHBsYXllcnMKICAgICAgICAgICAgY29uc3QgeVBvcyA9IHRoaXMubWVzaC5wb3NpdGlvbi55OwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS55IC09IHlQb3MgKiBDLkdSQVZJVFlfU1BSSU5HICogZHQ7CiAgICAgICAgICAgIHRoaXMudmVsb2NpdHkueSAqPSBNYXRoLm1heCgwLCAxIC0gKEMuR1JBVklUWV9EQU1QICogZHQpKTsKCiAgICAgICAgICAgIC8vIDMuIE1vdmUKICAgICAgICAgICAgX3RlbXBWZWMuY29weSh0aGlzLnZlbG9jaXR5KS5tdWx0aXBseVNjYWxhcihkdCk7CiAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi5hZGQoX3RlbXBWZWMpOwoKICAgICAgICAgICAgLy8gMy4gRHJhZyAoUGh5c2ljYWwgV2F0ZXIgcmVzaXN0YW5jZSBvbiBWZWxvY2l0eSkKICAgICAgICAgICAgLy8gU2VwYXJhdGUgZnJvbSBTdGF0IERlY2F5LiBUaGlzIHN0b3BzIHRoZSBiYWxsIHBoeXNpY2FsbHkuCiAgICAgICAgICAgIGNvbnN0IGRyYWdGYWN0b3IgPSBNYXRoLm1heCgwLCAxIC0gKEMuV0FURVJfRFJBRyAqIGR0KSk7CiAgICAgICAgICAgIHRoaXMudmVsb2NpdHkubXVsdGlwbHlTY2FsYXIoZHJhZ0ZhY3Rvcik7CgogICAgICAgICAgICAvLyA0LiBTdGF0IERlY2F5IChUaGUgIkVuZXJneSIgb2YgdGhlIHBhc3Mvc2hvdCkKICAgICAgICAgICAgaWYgKHRoaXMucG93ZXIgPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLnBvd2VyIC09IHRoaXMuZGVjYXlSYXRlICogZHQ7CmlmICh0aGlzLnBvd2VyIDwgMCkgdGhpcy5wb3dlciA9IDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEJ1YmJsZSBUcmFpbCAoSGlnaCBTcGVlZCkKLy8gQnViYmxlIFRyYWlsIChIaWdoIFNwZWVkKQovLyBCdWJibGUgVHJhaWwgKER5bmFtaWMpCiAgICAgICAgICAgIGNvbnN0IHNwZWVkU3EgPSB0aGlzLnZlbG9jaXR5Lmxlbmd0aFNxKCk7CiAgICAgICAgICAgIGlmIChzcGVlZFNxID4gMi4wICYmIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSAmJiB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UucGFydGljbGVNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9idWJibGVUaW1lciAtPSBkdDsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9idWJibGVUaW1lciA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcG0gPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UucGFydGljbGVNYW5hZ2VyOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IHRoaXMudmVsb2NpdHkuY2xvbmUoKS5ub3JtYWxpemUoKS5tdWx0aXBseVNjYWxhcigtMC44KTsgCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gMS4gU3RhbmRhcmQgQnViYmxlIChCYXNlIFRyYWlsKSAtIEFsd2F5cyBzcGF3biBmb3Igdm9sdW1lCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RkUG9zID0gdGhpcy5tZXNoLnBvc2l0aW9uLmNsb25lKCkuYWRkKG9mZnNldCkuYWRkKG5ldyBUSFJFRS5WZWN0b3IzKChNYXRoLnJhbmRvbSgpLTAuNSkqMC4zLCAoTWF0aC5yYW5kb20oKS0wLjUpKjAuMywgKE1hdGgucmFuZG9tKCktMC41KSowLjMpKTsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kZWZvcm1Ob2RlKSBzdGRQb3MueSArPSB0aGlzLmRlZm9ybU5vZGUucG9zaXRpb24ueTsKICAgICAgICAgICAgICAgICAgICBwbS5zcGF3bignYnViYmxlJywgc3RkUG9zLCB7IHNjYWxlOiAwLjE1ICsgTWF0aC5yYW5kb20oKSAqIDAuMiB9KTsKCiAgICAgICAgICAgICAgICAgICAgLy8gMi4gTWljcm8gQnViYmxlcyAoQ2F2aXRhdGlvbiAvIFNwZWVkKSAtIEFkZCBvbiB0b3AKICAgICAgICAgICAgICAgICAgICBpZiAoc3BlZWRTcSA+IDUwLjApIHsgLy8gU3BlZWQgPiB+NwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb3VudCA9IE1hdGgubWluKDQsIE1hdGguZmxvb3Ioc3BlZWRTcSAvIDYwKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpPGNvdW50OyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGppdHRlciA9IG5ldyBUSFJFRS5WZWN0b3IzKChNYXRoLnJhbmRvbSgpLTAuNSkqMC40LCAoTWF0aC5yYW5kb20oKS0wLjUpKjAuNCwgKE1hdGgucmFuZG9tKCktMC41KSowLjQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3Bhd25Qb3MgPSB0aGlzLm1lc2gucG9zaXRpb24uY2xvbmUoKS5hZGQob2Zmc2V0KS5hZGQoaml0dGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRlZm9ybU5vZGUpIHNwYXduUG9zLnkgKz0gdGhpcy5kZWZvcm1Ob2RlLnBvc2l0aW9uLnk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBtLnNwYXduKCdidWJibGVfbWljcm8nLCBzcGF3blBvcywgeyBzY2FsZTogMC4wNSArIE1hdGgucmFuZG9tKCkgKiAwLjEgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYnViYmxlVGltZXIgPSAwLjAyOyAvLyBGYXN0IHVwZGF0ZQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE9jY2FzaW9uYWwgbWljcm8gYnViYmxlIGF0IGxvdyBzcGVlZCBmb3IgZGV0YWlsCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLnJhbmRvbSgpID4gMC41KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgaml0dGVyID0gbmV3IFRIUkVFLlZlY3RvcjMoKE1hdGgucmFuZG9tKCktMC41KSowLjIsIChNYXRoLnJhbmRvbSgpLTAuNSkqMC4yLCAoTWF0aC5yYW5kb20oKS0wLjUpKjAuMik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3Bhd25Qb3MgPSB0aGlzLm1lc2gucG9zaXRpb24uY2xvbmUoKS5hZGQob2Zmc2V0KS5hZGQoaml0dGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kZWZvcm1Ob2RlKSBzcGF3blBvcy55ICs9IHRoaXMuZGVmb3JtTm9kZS5wb3NpdGlvbi55OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBtLnNwYXduKCdidWJibGVfbWljcm8nLCBzcGF3blBvcywgeyBzY2FsZTogMC4wNCArIE1hdGgucmFuZG9tKCkgKiAwLjA2IH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2J1YmJsZVRpbWVyID0gMC4wNTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KLy8gQ29udGludWVkIGxvZ2ljLi4uCiAgICAgICAgICAgIC8vIDUuIEJvdW5kYXJ5IExvZ2ljIChTb2Z0IFdhbGxzIGZvciBDdXJ2ZXMpCi8vIDUuIEJvdW5kYXJ5IExvZ2ljIChTb2Z0IFdhbGxzIGZvciBDdXJ2ZXMpCiAgICAgICAgICAgIC8vIFdlIHVzZSBhICJTb2Z0IFdhbGwiIGFwcHJvYWNoIHRvIHByZXZlbnQgc2hhcnAgVi1ib3VuY2VzLgogICAgICAgICAgICAvLyBBIHJlcHVsc2l2ZSBmb3JjZSBjdXJ2ZXMgdGhlIGJhbGwgYXdheSBiZWZvcmUgaW1wYWN0LCBhbmQgaW1wYWN0IHJlc3VsdHMgaW4gYSBzbGlkZS9zb2Z0IGJvdW5jZS4KICAgICAgICAgICAgY29uc3QgcG9zID0gdGhpcy5tZXNoLnBvc2l0aW9uOwogICAgICAgICAgICBjb25zdCBkaXN0WFogPSBNYXRoLnNxcnQocG9zLnggKiBwb3MueCArIHBvcy56ICogcG9zLnopOwogICAgICAgICAgICBjb25zdCBib3VuZGFyeVJhZGl1cyA9IEMuQk9VTkRBUllfUkFESVVTOwoKICAgICAgICAgICAgY29uc3Qgc29mdEJ1ZmZlciA9IDMuMDsgLy8gUmVkdWNlZCBmcm9tIDUuMCB0byBwcmV2ZW50IGVhcmx5IHJlcHVsc2lvbgogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQS4gU29mdCBSZXB1bHNpb24gKENyZWF0ZXMgY3VydmVkIHRyYWplY3RvcnkgbmVhciB3YWxsKQogICAgICAgICAgICBpZiAoZGlzdFhaID4gYm91bmRhcnlSYWRpdXMgLSBzb2Z0QnVmZmVyKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvbiA9IGRpc3RYWiAtIChib3VuZGFyeVJhZGl1cyAtIHNvZnRCdWZmZXIpOwogICAgICAgICAgICAgICAgY29uc3QgcmF0aW8gPSBwZW5ldHJhdGlvbiAvIHNvZnRCdWZmZXI7IC8vIDAgdG8gMQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBGb3JjZSB2ZWN0b3IgdG93YXJkcyBjZW50ZXIKICAgICAgICAgICAgICAgIGNvbnN0IHB1c2hEaXIgPSBuZXcgVEhSRUUuVmVjdG9yMygtcG9zLngsIDAsIC1wb3Mueikubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICAvLyBFeHBvbmVudGlhbCBmb3JjZSB0byBzdGVlciBpdCBzbW9vdGhseQogICAgICAgICAgICAgICAgLy8gUmVkdWNlZCBmb3JjZSBmcm9tIDYwLjAgdG8gMjAuMCB0byBwcmV2ZW50ICJnaG9zdCB3YWxsIiBib3VuY2VzCiAgICAgICAgICAgICAgICBjb25zdCBmb3JjZSA9IHB1c2hEaXIubXVsdGlwbHlTY2FsYXIocmF0aW8gKiByYXRpbyAqIDIwLjAgKiBkdCk7IAogICAgICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS5hZGQoZm9yY2UpOwp9CgogICAgICAgICAgICAvLyBCLiBIYXJkIENsYW1wIChJZiBpdCBzdGlsbCBoaXRzKQogICAgICAgICAgICBpZiAoZGlzdFhaID4gYm91bmRhcnlSYWRpdXMpIHsKICAgICAgICAgICAgICAgIC8vIE5vcm1hbCBwb2ludGluZyBJTldBUkQKICAgICAgICAgICAgICAgIGNvbnN0IG5vcm1hbCA9IG5ldyBUSFJFRS5WZWN0b3IzKC1wb3MueCwgMCwgLXBvcy56KS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gQ2xhbXAgUG9zaXRpb24KICAgICAgICAgICAgICAgIGNvbnN0IG92ZXJsYXAgPSBkaXN0WFogLSBib3VuZGFyeVJhZGl1czsKICAgICAgICAgICAgICAgIHBvcy5hZGQobm9ybWFsLmNsb25lKCkubXVsdGlwbHlTY2FsYXIob3ZlcmxhcCkpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBWZWxvY2l0eSBIYW5kbGluZzogU29mdCBCb3VuY2UgLyBTbGlkZQogICAgICAgICAgICAgICAgY29uc3QgdkRvdE4gPSB0aGlzLnZlbG9jaXR5LmRvdChub3JtYWwpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBPbmx5IGFkanVzdCBpZiBtb3ZpbmcgT1VUV0FSRFMgKGFnYWluc3Qgbm9ybWFsKQogICAgICAgICAgICAgICAgaWYgKHZEb3ROIDwgMCkgewogICAgICAgICAgICAgICAgICAgIC8vIFJlZHVjZSBub3JtYWwgY29tcG9uZW50IHNpZ25pZmljYW50bHkgKFNsaWRlIGJlaGF2aW9yKQogICAgICAgICAgICAgICAgICAgIC8vIEVsYXN0aWNpdHkgMC4zID0gRHVsbCB0aHVkL3NsaWRlLCBub3QgYSBzaGFycCBwaW5nCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZWxhc3RpY2l0eSA9IDAuMzsgCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gVl9uZXcgPSBWIC0gKDEgKyBlKSAqIChWLk4pICogTgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGltcHVsc2UgPSBub3JtYWwubXVsdGlwbHlTY2FsYXIoLXZEb3ROICogKDEuMCArIGVsYXN0aWNpdHkpKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5LmFkZChpbXB1bHNlKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBGcmljdGlvbiBvbiB3YWxsIGNvbnRhY3QKICAgICAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5Lm11bHRpcGx5U2NhbGFyKDAuOTUpOyAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRmxvb3IvQ2VpbGluZyBCb3VuY2UKICAgICAgICAgICAgaWYgKE1hdGguYWJzKHBvcy55KSA+IEMuQk9VTkRBUllfSEVJR0hUKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzaWduID0gTWF0aC5zaWduKHBvcy55KTsKICAgICAgICAgICAgICAgIHBvcy55ID0gQy5CT1VOREFSWV9IRUlHSFQgKiBzaWduOwogICAgICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS55ICo9IC0wLjQ7IC8vIFNvZnRlciB2ZXJ0aWNhbCBib3VuY2UKICAgICAgICAgICAgfQovLyBJZiBzcGlubmluZyBzaWduaWZpY2FudGx5LCB1c2UgdGhhdCBheGlzCiAgICAgICAgICAgIGNvbnN0IHNwaW5TcGVlZCA9IHRoaXMuYW5ndWxhclZlbG9jaXR5Lmxlbmd0aCgpOwogICAgICAgICAgICBpZiAoc3BpblNwZWVkID4gMC41KSB7CiAgICAgICAgICAgICAgICBjb25zdCBheGlzID0gX3RlbXBWZWMuY29weSh0aGlzLmFuZ3VsYXJWZWxvY2l0eSkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICBjb25zdCBxID0gbmV3IFRIUkVFLlF1YXRlcm5pb24oKS5zZXRGcm9tQXhpc0FuZ2xlKGF4aXMsIHNwaW5TcGVlZCAqIGR0KTsKICAgICAgICAgICAgICAgIHRoaXMuYWNjdW11bGF0ZWRSb3RhdGlvbi5wcmVtdWx0aXBseShxKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEZhbGxiYWNrOiBSb2xsIGJhc2VkIG9uIHZlbG9jaXR5IChWaXN1YWwgZmFrZSBmb3Igbm9uLXNwaW5uaW5nIGJhbGwpCiAgICAgICAgICAgICAgICBjb25zdCBzcGVlZCA9IHRoaXMudmVsb2NpdHkubGVuZ3RoKCk7CiAgICAgICAgICAgICAgICBpZiAoc3BlZWQgPiAwLjEpIHsKICAgICAgICAgICAgICAgICAgICBfdGVtcFZlYy5jb3B5KHRoaXMudmVsb2NpdHkpLmNyb3NzKF9heGlzWSkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKF90ZW1wVmVjLmxlbmd0aFNxKCkgPiAwLjAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHEgPSBuZXcgVEhSRUUuUXVhdGVybmlvbigpLnNldEZyb21BeGlzQW5nbGUoX3RlbXBWZWMsIHNwZWVkICogZHQpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFjY3VtdWxhdGVkUm90YXRpb24ucHJlbXVsdGlwbHkocSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9Cn0KCmdyYWIocGxheWVyKSB7CiAgICAgICAgICAgIHRoaXMucmV2ZWFsKCk7IAogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQW5ub3VuY2VtZW50OiBQb3NzZXNzaW9uIChpZiB0YWtpbmcgZnJvbSBmcmVlIHN0YXRlKQogICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSA9PT0gJ2ZyZWUnKSB7CiAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSAmJiB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2Uuc2hvd0Fubm91bmNlbWVudCkgewogICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2Uuc2hvd0Fubm91bmNlbWVudCgiUE9TU0VTU0lPTiIsICJub3JtYWwiKTsKICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIENoZWNrIFR1cm5vdmVyIChQb3NzZXNzaW9uIENoYW5nZSkKICAgICAgICAgICAgY29uc3QgcHJldmlvdXNUZWFtID0gdGhpcy5ob2xkZXIgPyB0aGlzLmhvbGRlci50ZWFtIDogKHRoaXMubGFzdEhvbGRlciA/IHRoaXMubGFzdEhvbGRlci50ZWFtIDogbnVsbCk7CiAgICAgICAgICAgIGlmIChwcmV2aW91c1RlYW0gJiYgcHJldmlvdXNUZWFtICE9PSBwbGF5ZXIudGVhbSkgewogICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UgJiYgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJUVVJOT1ZFUiIsIHBsYXllci5tZXNoLnBvc2l0aW9uLCAidGVjaCIpOwogICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gSWYgc29tZW9uZSBlbHNlIGhlbGQgaXQsIHRoZXkgbG9zZSBpdAogICAgICAgICAgICBpZiAodGhpcy5ob2xkZXIgJiYgdGhpcy5ob2xkZXIgIT09IHBsYXllcikgewogICAgICAgICAgICAgICAgdGhpcy5ob2xkZXIubG9zZUJhbGwoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5ob2xkZXIgPSBwbGF5ZXI7CiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSAnaGVsZCc7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBOT1RFOiBXZSBkbyBOT1QgcGFyZW50IHRoZSBtZXNoIHRvIHRoZSBwbGF5ZXIgYW55bW9yZS4KICAgICAgICAgICAgLy8gVGhpcyBwcmV2ZW50cyB0aGUgYmFsbCBmcm9tIGZseWluZyBhcm91bmQgZHVlIHRvIHN3aW0gYW5pbWF0aW9ucy4KICAgICAgICAgICAgLy8gSW5zdGVhZCwgd2UgdXBkYXRlIGl0cyBwb3NpdGlvbiBtYW51YWxseSBpbiB1cGRhdGVIZWxkKCkuCiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBOb3RpZnkgcGxheWVyCiAgICAgICAgICAgIGlmIChwbGF5ZXIucmVjZWl2ZUJhbGwpIHsKICAgICAgICAgICAgICAgIHBsYXllci5yZWNlaXZlQmFsbCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zb2xlLmxvZygiQmFsbCBncmFiYmVkIGJ5ICIgKyBwbGF5ZXIucm9sZSk7CiAgICAgICAgfQoKICAgICAgICBkcm9wKCkgewogICAgICAgICAgICB0aGlzLnJldmVhbCgpOyAvLyBFbnN1cmUgdmlzaWJsZQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gTm8gbmVlZCB0byBkZXRhY2ggZnJvbSBzY2VuZSBncmFwaCBzaW5jZSB3ZSBhcmVuJ3QgcGFyZW50aW5nIHRvIHBsYXllciBhbnltb3JlLgogICAgICAgICAgICAvLyBKdXN0IGNsZWFyIGhvbGRlci4KCiAgICAgICAgICAgIGlmICh0aGlzLmhvbGRlcikgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuaG9sZGVyLmxvc2VCYWxsKSB0aGlzLmhvbGRlci5sb3NlQmFsbCgpOwogICAgICAgICAgICAgICAgdGhpcy5ob2xkZXIgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICB0aGlzLnN0YXRlID0gJ2ZyZWUnOwogICAgICAgIH0KLy8gU2hvb3QvUGFzcwovLyBTaG9vdC9QYXNzCiAgICAgICAgc2hvb3QoZGlyZWN0aW9uVmVjdG9yLCBmb3JjZSwgdHlwZSA9ICdTSCcsIHRlY2huaXF1ZSA9IG51bGwsIHNwaW5WZWN0b3IgPSBudWxsKSB7CiAgICAgICAgICAgIHRoaXMubGFzdEhvbGRlciA9IHRoaXMuaG9sZGVyOyAvLyBSZWNvcmQgZm9yIEVYUCBhdHRyaWJ1dGlvbgogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRnVtYmxlIERldGVjdGlvbiAoVHlwZSAnbm9uZScgaXMgdXNlZCBieSBQbGF5ZXIuZnVtYmxlKQogICAgICAgICAgICBpZiAodHlwZSA9PT0gJ25vbmUnKSB7CiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlICYmIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5zaG93QW5ub3VuY2VtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLnNob3dBbm5vdW5jZW1lbnQoIkZVTUJMRSEiLCAic2xhbSIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmRyb3AoKTsgLy8gRGV0YWNoIGZpcnN0CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTZXQgR3JhY2UgUGVyaW9kIHRvIHByZXZlbnQgaW5zdGFudCBpbnRlcmNlcHRpb25zL2NhdGNoZXMKICAgICAgICAgICAgLy8gMC4ycyBhbGxvd3MgYmFsbCB0byBjbGVhciB0aGUgdGhyb3dlcidzIGltbWVkaWF0ZSB2aWNpbml0eQogICAgICAgICAgICB0aGlzLmNhdGNoR3JhY2VQZXJpb2QgPSAwLjI7CgogICAgICAgICAgICAvLyBQaHlzaWNhbCBWZWxvY2l0eSAoVmlzdWFsIHNwZWVkKQovLyBQaHlzaWNhbCBWZWxvY2l0eSAoVmlzdWFsIHNwZWVkKQogICAgICAgICAgICAvLyBXZSBtYXAgZm9yY2UgKHN0YXQpIHRvIHBoeXNpY2FsIHNwZWVkLCBidXQgY2xhbXAgaXQgcmVhc29uYWJsZQogICAgICAgICAgICAvLyBJbmNyZWFzZWQgY2FwIHRvIDQwLjAgdG8gYWxsb3cgZm9yIHN0cm9uZyBwYXNzZXMgYW5kIGNsZWFycwogICAgICAgICAgICBjb25zdCBzcGVlZCA9IE1hdGgubWluKGZvcmNlLCA0MC4wKTsKICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS5jb3B5KGRpcmVjdGlvblZlY3Rvcikubm9ybWFsaXplKCkubXVsdGlwbHlTY2FsYXIoc3BlZWQpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQXBwbHkgU3BpbiBpZiBwcm92aWRlZAogICAgICAgICAgICBpZiAoc3BpblZlY3RvcikgewogICAgICAgICAgICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuY29weShzcGluVmVjdG9yKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnNldCgwLCAwLCAwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU3RhdCBQb3dlciAoR2FtZSBMb2dpYykKICAgICAgICAgICAgdGhpcy5wb3dlciA9IGZvcmNlOwogICAgICAgICAgICB0aGlzLnBvd2VyVHlwZSA9IHR5cGU7CiAgICAgICAgICAgIHRoaXMudGVjaG5pcXVlID0gdGVjaG5pcXVlOyAKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFVwZGF0ZSBUcmFpbCBDb2xvcgogICAgICAgICAgICBpZiAodGhpcy50cmFpbCkgewogICAgICAgICAgICAgICAgbGV0IGNvbG9yID0gMHgwMGFhZmY7IC8vIERlZmF1bHQgQmx1ZSAoUGFzcykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKHRlY2huaXF1ZSkgewogICAgICAgICAgICAgICAgICAgIGlmICh0ZWNobmlxdWUudHlwZSA9PT0gJ3Zlbm9tJykgY29sb3IgPSAweGFhMDBmZjsgLy8gUHVycGxlCiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodGVjaG5pcXVlLnR5cGUgPT09ICd3aXRoZXInKSBjb2xvciA9IDB4ODg4ODg4OyAvLyBHcmV5CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodGVjaG5pcXVlLnR5cGUgPT09ICduYXAnKSBjb2xvciA9IDB4MDAwMDg4OyAvLyBEYXJrIEJsdWUKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0ZWNobmlxdWUudHlwZSA9PT0gJ3NwaGVyZScpIGNvbG9yID0gMHgwMGZmZmY7IC8vIEN5YW4KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0ZWNobmlxdWUudHlwZSA9PT0gJ2plY2h0JykgY29sb3IgPSAweGZmMDAwMDsgLy8gUmVkCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdTSCcpIHsKICAgICAgICAgICAgICAgICAgICBjb2xvciA9IDB4ZmY0NDAwOyAvLyBPcmFuZ2UvUmVkCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRoaXMudHJhaWwuc2V0Q29sb3IoY29sb3IpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBIYW5kbGUgSW52aXNpYmxlIFNob3QKICAgICAgICAgICAgaWYgKHRlY2huaXF1ZSAmJiB0ZWNobmlxdWUudHlwZSA9PT0gJ2ludmlzaWJsZScpIHsKICAgICAgICAgICAgICAgIHRoaXMuaXNJbnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgaWYgKHRoaXMubWVzaCkgdGhpcy5tZXNoLnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJJbnZpc2libGUgU2hvdCEiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgY29uc29sZS5sb2coYEJhbGwgJHt0eXBlfSB3aXRoIFBvd2VyOiAke3RoaXMucG93ZXIudG9GaXhlZCgxKX0gU3BpbjogJHt0aGlzLmFuZ3VsYXJWZWxvY2l0eS5sZW5ndGgoKS50b0ZpeGVkKDEpfWApOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVmlzdWFsIEZlZWRiYWNrIGZvciBDdXJ2ZQogICAgICAgICAgICBpZiAodGhpcy5hbmd1bGFyVmVsb2NpdHkubGVuZ3RoKCkgPiAxNS4wICYmIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSAmJiB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJDVVJWRSEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJ0ZWNoIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldmVhbCgpIHsKCiAgICAgICAgICAgIHRoaXMuaXNJbnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHRoaXMubWVzaCkgdGhpcy5tZXNoLnZpc2libGUgPSB0cnVlOwogICAgICAgIH0KICAgICAgICAKcmVzZXQoKSB7CiAgICAgICAgICAgIHRoaXMucmV2ZWFsKCk7CiAgICAgICAgICAgIHRoaXMuZHJvcCgpOwogICAgICAgICAgICB0aGlzLm1lc2gucG9zaXRpb24uc2V0KDAsIDAsIDApOwogICAgICAgICAgICB0aGlzLnZlbG9jaXR5LnNldCgwLCAwLCAwKTsKICAgICAgICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuc2V0KDAsIDAsIDApOwogICAgICAgICAgICB0aGlzLmNhdGNoR3JhY2VQZXJpb2QgPSAwOwogICAgICAgICAgICB0aGlzLnBvd2VyID0gMDsKICAgICAgICB9CmlzQ2F0Y2hhYmxlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jYXRjaEdyYWNlUGVyaW9kIDw9IDA7CiAgICAgICAgfQoKICAgICAgICB1cGRhdGVWaXN1YWxzKGR0KSB7CiAgICAgICAgICAgIGlmICghdGhpcy5kZWZvcm1Ob2RlIHx8ICF0aGlzLnNwaW5Ob2RlKSByZXR1cm47CgogICAgICAgICAgICAvLyAxLiBTcXVhc2ggJiBTdHJldGNoIGJhc2VkIG9uIHZlbG9jaXR5Ci8vIDEuIFNxdWFzaCAmIFN0cmV0Y2ggYmFzZWQgb24gdmVsb2NpdHkKICAgICAgICAgICAgY29uc3Qgc3BlZWQgPSB0aGlzLnZlbG9jaXR5Lmxlbmd0aCgpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gT25seSBhcHBseSBzdHJldGNoIGlmIG1vdmluZyBmYXN0IGVub3VnaAogICAgICAgICAgICBpZiAoc3BlZWQgPiAxLjAgJiYgdGhpcy5zdGF0ZSA9PT0gJ2ZyZWUnKSB7CiAgICAgICAgICAgICAgICAvLyBPcmllbnQgZGVmb3JtTm9kZSB0byB2ZWxvY2l0eSBkaXJlY3Rpb24KICAgICAgICAgICAgICAgIGNvbnN0IGRpciA9IHRoaXMudmVsb2NpdHkuY2xvbmUoKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgIC8vIERlZmF1bHQgZm9yd2FyZCBpcyBaICgwLDAsMSkKICAgICAgICAgICAgICAgIHRoaXMuZGVmb3JtTm9kZS5xdWF0ZXJuaW9uLnNldEZyb21Vbml0VmVjdG9ycyhuZXcgVEhSRUUuVmVjdG9yMygwLDAsMSksIGRpcik7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBzdHJldGNoIGZhY3RvcgogICAgICAgICAgICAgICAgLy8gTWF4IHN0cmV0Y2ggYXQgc3BlZWQgNDAgKGFwcHJveCBtYXggc2hvdCBwb3dlcikKICAgICAgICAgICAgICAgIGNvbnN0IGZhY3RvciA9IE1hdGgubWluKHNwZWVkIC8gNDAuMCwgMS4wKTsgCiAgICAgICAgICAgICAgICBjb25zdCBzdHJldGNoID0gMS4wICsgKGZhY3RvciAqIDAuOCk7IC8vIEluY3JlYXNlZCBzdHJldGNoIG1heCB0byAxLjh4CiAgICAgICAgICAgICAgICBjb25zdCBzcXVhc2ggPSAxLjAgLyBNYXRoLnNxcnQoc3RyZXRjaCk7IC8vIE1haW50YWluIHZvbHVtZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0aGlzLmRlZm9ybU5vZGUuc2NhbGUuc2V0KHNxdWFzaCwgc3F1YXNoLCBzdHJldGNoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIFJlc2V0IGRlZm9ybWF0aW9uCiAgICAgICAgICAgICAgICB0aGlzLmRlZm9ybU5vZGUucXVhdGVybmlvbi5pZGVudGl0eSgpOwogICAgICAgICAgICAgICAgdGhpcy5kZWZvcm1Ob2RlLnNjYWxlLnNldCgxLCAxLCAxKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMi4gQXBwbHkgQWNjdW11bGF0ZWQgU3BpbgogICAgICAgICAgICAvLyBTaW5jZSBkZWZvcm1Ob2RlIG1pZ2h0IGJlIHJvdGF0ZWQsIHdlIG5lZWQgdG8gYXBwbHkgc3BpbiBpbiB0aGUgY29ycmVjdCBzcGFjZS4KICAgICAgICAgICAgLy8gc3Bpbk5vZGUgcm90YXRpb24gPSBkZWZvcm1Ob2RlX2ludmVyc2UgKiBhY2N1bXVsYXRlZFJvdGF0aW9uCmNvbnN0IGludkRlZm9ybSA9IHRoaXMuZGVmb3JtTm9kZS5xdWF0ZXJuaW9uLmNsb25lKCkuaW52ZXJ0KCk7CiAgICAgICAgICAgIHRoaXMuc3Bpbk5vZGUucXVhdGVybmlvbi5jb3B5KGludkRlZm9ybS5tdWx0aXBseSh0aGlzLmFjY3VtdWxhdGVkUm90YXRpb24pKTsKICAgICAgICB9CiAgICB9CgogICAgd2luZG93LmZsdXguQmFsbCA9IEJhbGw7Cn0pKCk7","/Ball.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICAvLyBSZXVzYWJsZSBtYXRoIHZlY3RvcnMgdG8gYXZvaWQgR0MKY29uc3QgX2JWZWMgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgY29uc3QgX2F4aXNZID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMSwgMCk7CiAgICBjb25zdCBfdGVtcFZlYyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfbWFnbnVzVmVjID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKCi8vIFBoeXNpY3MgQ29uZmlndXJhdGlvbiAoRXhwb3NlZCBmb3IgRGV2VG9vbHMpCndpbmRvdy5mbHV4LkJhbGxDb25maWcgPSB7CiAgICAgICAgV0FURVJfRFJBRzogMC4xLCAgICAgIC8vIExvdyBkcmFnIGZvciBkaXN0YW5jZQogICAgICAgIFNQSU5fRFJBRzogMC4xNSwgICAgICAvLyBSZWR1Y2VkIGZyb20gMC4zIHNvIGN1cnZlcyBsYXN0IGxvbmdlcgogICAgICAgIE1BR05VU19DT0VGRjogMC44LCAgICAvLyBJbmNyZWFzZWQgZnJvbSAwLjUgZm9yIHB1bmNoaWVyIGN1cnZlcwpCT1VOREFSWV9SQURJVVM6IDMzLjAsIC8vIFNsaWdodGx5IGxhcmdlciB0aGFuIHZpc3VhbCBhcmVuYSAoMzIpIHRvIHByZXZlbnQgZWFybHkgY2xpcHBpbmcKICAgICAgICBCT1VOREFSWV9IRUlHSFQ6IDE1LjAsIC8vIFZlcnRpY2FsIExpbWl0ICgrLy0gWSkKICAgICAgICBHUkFWSVRZX1NQUklORzogMS4wLCAgIC8vIFJlZHVjZWQgZnJvbSA1LjAgKEdlbnRsZSBkZXB0aCBjb3JyZWN0aW9uKQogICAgICAgIEdSQVZJVFlfREFNUDogMS41CiAgICB9OwoKICAgIAogICAgY29uc3QgQyA9IHdpbmRvdy5mbHV4LkJhbGxDb25maWc7IC8vIExvY2FsIGFsaWFzIGZvciBicmV2aXR5CiAgICAvLyAtLS0gVFJBSUwgUkVOREVSRVIgLS0tCiAgICBjbGFzcyBUcmFpbFJlbmRlcmVyIHsKICAgICAgICBjb25zdHJ1Y3RvcihzY2VuZSkgewogICAgICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7CiAgICAgICAgICAgIHRoaXMuc2VnbWVudHMgPSAyNTsKdGhpcy5wb2ludHMgPSBbXTsKdGhpcy53aWR0aCA9IDAuMzg7IC8vIFNjYWxlZCB0byBtYXRjaCBzbWFsbGVyIGJhbGwgKDE1JSByZWR1Y3Rpb24pCiAgICAgICAgICAgIC8vIEdlb21ldHJ5CiAgICAgICAgICAgIGNvbnN0IGdlb21ldHJ5ID0gbmV3IFRIUkVFLkJ1ZmZlckdlb21ldHJ5KCk7CiAgICAgICAgICAgIGNvbnN0IHBvc0RhdGEgPSBuZXcgRmxvYXQzMkFycmF5KHRoaXMuc2VnbWVudHMgKiAyICogMyk7CiAgICAgICAgICAgIGdlb21ldHJ5LnNldEF0dHJpYnV0ZSgncG9zaXRpb24nLCBuZXcgVEhSRUUuQnVmZmVyQXR0cmlidXRlKHBvc0RhdGEsIDMpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEluZGljZXMKICAgICAgICAgICAgY29uc3QgaW5kaWNlcyA9IFtdOwogICAgICAgICAgICBmb3IgKGxldCBpPTA7IGk8dGhpcy5zZWdtZW50cy0xOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGJhc2UgPSBpKjI7CiAgICAgICAgICAgICAgICBpbmRpY2VzLnB1c2goYmFzZSwgYmFzZSsxLCBiYXNlKzIpOwogICAgICAgICAgICAgICAgaW5kaWNlcy5wdXNoKGJhc2UrMSwgYmFzZSszLCBiYXNlKzIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGdlb21ldHJ5LnNldEluZGV4KGluZGljZXMpOwogICAgICAgICAgICAKdGhpcy5tYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7CiAgICAgICAgICAgICAgICBjb2xvcjogMHgwMGFhZmYsCiAgICAgICAgICAgICAgICBzaWRlOiBUSFJFRS5Eb3VibGVTaWRlLAogICAgICAgICAgICAgICAgdHJhbnNwYXJlbnQ6IHRydWUsCiAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLjUsCiAgICAgICAgICAgICAgICBibGVuZGluZzogVEhSRUUuQWRkaXRpdmVCbGVuZGluZywKICAgICAgICAgICAgICAgIGRlcHRoV3JpdGU6IGZhbHNlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5tZXNoID0gbmV3IFRIUkVFLk1lc2goZ2VvbWV0cnksIHRoaXMubWF0ZXJpYWwpOwogICAgICAgICAgICB0aGlzLm1lc2guZnJ1c3R1bUN1bGxlZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLnNjZW5lLmFkZCh0aGlzLm1lc2gpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gSW5pdCBwb2ludHMKICAgICAgICAgICAgZm9yKGxldCBpPTA7IGk8dGhpcy5zZWdtZW50czsgaSsrKSB0aGlzLnBvaW50cy5wdXNoKG5ldyBUSFJFRS5WZWN0b3IzKCkpOwogICAgICAgICAgICB0aGlzLmFjdGl2ZSA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXNldChwb3MpIHsKICAgICAgICAgICAgZm9yKGxldCBpPTA7IGk8dGhpcy5zZWdtZW50czsgaSsrKSB0aGlzLnBvaW50c1tpXS5jb3B5KHBvcyk7CiAgICAgICAgICAgIHRoaXMudXBkYXRlR2VvbWV0cnkoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgc2V0Q29sb3IoaGV4KSB7CiAgICAgICAgICAgIHRoaXMubWF0ZXJpYWwuY29sb3Iuc2V0SGV4KGhleCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHVwZGF0ZShjdXJyZW50UG9zKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5hY3RpdmUpIHsKICAgICAgICAgICAgICAgIHRoaXMucmVzZXQoY3VycmVudFBvcyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFNoaWZ0IHBvaW50cwogICAgICAgICAgICBmb3IgKGxldCBpID0gdGhpcy5zZWdtZW50cyAtIDE7IGkgPiAwOyBpLS0pIHsKICAgICAgICAgICAgICAgIHRoaXMucG9pbnRzW2ldLmNvcHkodGhpcy5wb2ludHNbaS0xXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5wb2ludHNbMF0uY29weShjdXJyZW50UG9zKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHRoaXMudXBkYXRlR2VvbWV0cnkoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdXBkYXRlR2VvbWV0cnkoKSB7CiAgICAgICAgICAgIGNvbnN0IHBvc2l0aW9ucyA9IHRoaXMubWVzaC5nZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uLmFycmF5OwogICAgICAgICAgICBjb25zdCBjYW0gPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UgPyB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhIDogbnVsbDsKICAgICAgICAgICAgaWYgKCFjYW0pIHJldHVybjsKICAgICAgICAgICAgY29uc3QgY2FtUG9zID0gY2FtLnBvc2l0aW9uOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgdGVtcERpciA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICAgICAgICAgIGNvbnN0IHRlbXBUb0NhbSA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICAgICAgICAgIGNvbnN0IHRlbXBSaWdodCA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CgogICAgICAgICAgICBmb3IgKGxldCBpPTA7IGk8dGhpcy5zZWdtZW50czsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwID0gdGhpcy5wb2ludHNbaV07CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFRhcGVyIHdpZHRoCiAgICAgICAgICAgICAgICBjb25zdCB3ID0gdGhpcy53aWR0aCAqICgxIC0gKGkgLyB0aGlzLnNlZ21lbnRzKSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBkaXJlY3Rpb24KICAgICAgICAgICAgICAgIGlmIChpIDwgdGhpcy5zZWdtZW50cyAtIDEpIHsKICAgICAgICAgICAgICAgICAgICB0ZW1wRGlyLnN1YlZlY3RvcnModGhpcy5wb2ludHNbaV0sIHRoaXMucG9pbnRzW2krMV0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0ZW1wRGlyLnN1YlZlY3RvcnModGhpcy5wb2ludHNbaS0xXSwgdGhpcy5wb2ludHNbaV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAodGVtcERpci5sZW5ndGhTcSgpIDwgMC4wMDAxKSB0ZW1wRGlyLnNldCgwLCAxLCAwKTsKICAgICAgICAgICAgICAgIHRlbXBEaXIubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRlbXBUb0NhbS5zdWJWZWN0b3JzKGNhbVBvcywgcCkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICB0ZW1wUmlnaHQuY3Jvc3NWZWN0b3JzKHRlbXBEaXIsIHRlbXBUb0NhbSkubm9ybWFsaXplKCkubXVsdGlwbHlTY2FsYXIodyk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFZlcnQgMQogICAgICAgICAgICAgICAgcG9zaXRpb25zW2kqNiArIDBdID0gcC54IC0gdGVtcFJpZ2h0Lng7CiAgICAgICAgICAgICAgICBwb3NpdGlvbnNbaSo2ICsgMV0gPSBwLnkgLSB0ZW1wUmlnaHQueTsKICAgICAgICAgICAgICAgIHBvc2l0aW9uc1tpKjYgKyAyXSA9IHAueiAtIHRlbXBSaWdodC56OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBWZXJ0IDIKICAgICAgICAgICAgICAgIHBvc2l0aW9uc1tpKjYgKyAzXSA9IHAueCArIHRlbXBSaWdodC54OwogICAgICAgICAgICAgICAgcG9zaXRpb25zW2kqNiArIDRdID0gcC55ICsgdGVtcFJpZ2h0Lnk7CiAgICAgICAgICAgICAgICBwb3NpdGlvbnNbaSo2ICsgNV0gPSBwLnogKyB0ZW1wUmlnaHQuejsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLm1lc2guZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbi5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgICAgfQogICAgfQoKY2xhc3MgQmFsbCB7CgogICAgICAgIGNvbnN0cnVjdG9yKHNjZW5lKSB7CiAgICAgICAgICAgIHRoaXMuc2NlbmUgPSBzY2VuZTsKICAgICAgICAgICAgdGhpcy5tZXNoID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5ob2xkZXIgPSBudWxsOyAKICAgICAgICAgICAgdGhpcy5sYXN0SG9sZGVyID0gbnVsbDsgLy8gVHJhY2sgd2hvIHRocmV3IGl0IGxhc3QgKGZvciBFWFAvQXNzaXN0cykKICAgICAgICAgICAgCiAgICAgICAgICAgIHRoaXMudmVsb2NpdHkgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAwKTsKICAgICAgICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAwKTsKICAgICAgICAgICAgdGhpcy5zdGF0ZSA9ICdmcmVlJzsgLy8gJ2ZyZWUnLCAnaGVsZCcsICdtYWduZXRpemVkJwogICAgICAgICAgICB0aGlzLmlzSW52aXNpYmxlID0gZmFsc2U7CgogICAgICAgICAgICAvLyBDb250aW51b3VzIFN0YXRzCiAgICAgICAgICAgIHRoaXMucG93ZXIgPSAwOyAgICAgIC8vIEN1cnJlbnQgUEEgb3IgU0ggdmFsdWUKICAgICAgICAgICAgdGhpcy5wb3dlclR5cGUgPSAnbm9uZSc7IC8vICdQQScgb3IgJ1NIJwogICAgICAgICAgICB0aGlzLmRlY2F5UmF0ZSA9IDMuMDsgLy8gU3RhdCBwb2ludHMgbG9zdCBwZXIgc2Vjb25kIChXYXRlciByZXNpc3RhbmNlKQogICAgICAgICAgICB0aGlzLmNhdGNoR3JhY2VQZXJpb2QgPSAwOyAvLyBUaW1lIGJlZm9yZSBiYWxsIGNhbiBiZSBjYXVnaHQgYWdhaW4KCiAgICAgICAgICAgIC8vIE1hZ25ldCBTeXN0ZW0KICAgICAgICAgICAgdGhpcy5tYWduZXRUYXJnZXQgPSBudWxsOwogICAgICAgICAgICB0aGlzLm1hZ25ldFRpbWVyID0gMDsKICAgICAgICAgICAgdGhpcy5tYWduZXREdXJhdGlvbiA9IDAuMjsgCiAgICAgICAgICAgIHRoaXMubWFnbmV0U3RhcnRQb3MgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgICAgICAgICB0aGlzLm1hZ25ldFN0YXJ0VmVsID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKCiAgICAgICAgICAgIC8vIFZpc3VhbHMgKFNxdWFzaCAmIFN0cmV0Y2gpCiAgICAgICAgICAgIHRoaXMuYWNjdW11bGF0ZWRSb3RhdGlvbiA9IG5ldyBUSFJFRS5RdWF0ZXJuaW9uKCk7CiAgICAgICAgICAgIHRoaXMuZGVmb3JtTm9kZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuc3Bpbk5vZGUgPSBudWxsOwogICAgICAgICAgICB0aGlzLm1vZGVsID0gbnVsbDsKCnRoaXMuaW5pdE1lc2goKTsKICAgICAgICAgICAgdGhpcy50cmFpbCA9IG5ldyBUcmFpbFJlbmRlcmVyKHNjZW5lKTsKICAgICAgICAgICAgdGhpcy5fYnViYmxlVGltZXIgPSAwOwp9CmluaXRNZXNoKCkgewogICAgICAgICAgICAvLyBIaWVyYXJjaHk6IE1lc2ggKFBvcykgLT4gRGVmb3JtIChTcXVhc2gvU3RyZXRjaCkgLT4gU3BpbiAoUm90YXRpb24pIC0+IE1vZGVsCiAgICAgICAgICAgIHRoaXMubWVzaCA9IG5ldyBUSFJFRS5Hcm91cCgpOwogICAgICAgICAgICB0aGlzLnNjZW5lLmFkZCh0aGlzLm1lc2gpOwoKICAgICAgICAgICAgdGhpcy5kZWZvcm1Ob2RlID0gbmV3IFRIUkVFLkdyb3VwKCk7CiAgICAgICAgICAgIHRoaXMuZGVmb3JtTm9kZS5wb3NpdGlvbi55ID0gLTEuNDsgLy8gVmlzdWFsIG9mZnNldDogTG93ZXJlZCBzaWduaWZpY2FudGx5IHBlciByZXF1ZXN0ICh3YXMgLTAuOSkKICAgICAgICAgICAgdGhpcy5tZXNoLmFkZCh0aGlzLmRlZm9ybU5vZGUpOyAvLyBGaXg6IEFkZCBkZWZvcm1Ob2RlIHRvIG1lc2gKCiAgICAgICAgICAgIHRoaXMuc3Bpbk5vZGUgPSBuZXcgVEhSRUUuR3JvdXAoKTsKICAgICAgICAgICAgdGhpcy5kZWZvcm1Ob2RlLmFkZCh0aGlzLnNwaW5Ob2RlKTsKCiAgICAgICAgICAgIC8vIFByb2NlZHVyYWwgUGxhY2Vob2xkZXIgVGV4dHVyZSAoQmxpdHpiYWxsLWlzaCkKICAgICAgICAgICAgY29uc3QgcGxhY2Vob2xkZXJUZXggPSAoKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgYyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICAgICAgICAgICAgYy53aWR0aCA9IDEyODsgYy5oZWlnaHQgPSA2NDsKICAgICAgICAgICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnI2VlZWVlZSc7CiAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QoMCwwLDEyOCw2NCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEJsdWUgYnVtcHMvZGV0YWlscwogICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjMDA4OGZmJzsKICAgICAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpPDY7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgICAgICAgICBjdHguYXJjKGkqMjUsIDMyLCAxMCwgMCwgTWF0aC5QSSoyKTsKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjMDA0NDg4JzsKICAgICAgICAgICAgICAgIGN0eC5maWxsUmVjdCgwLCAyOCwgMTI4LCA4KTsgLy8gU3RyaXBlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICAgICAgICAgICAgfSkoKTsKCiAgICAgICAgICAgIC8vIFBsYWNlaG9sZGVyIFZpc3VhbCAoSW1tZWRpYXRlIGZlZWRiYWNrLCBwZXJzaXN0cyB1bnRpbCB2YWxpZCBtb2RlbCBsb2FkcykKLy8gUGxhY2Vob2xkZXIgVmlzdWFsIChJbW1lZGlhdGUgZmVlZGJhY2ssIHBlcnNpc3RzIHVudGlsIHZhbGlkIG1vZGVsIGxvYWRzKQovLyBQbGFjZWhvbGRlciBWaXN1YWwgKEltbWVkaWF0ZSBmZWVkYmFjaywgcGVyc2lzdHMgdW50aWwgdmFsaWQgbW9kZWwgbG9hZHMpCmNvbnN0IGdlb21ldHJ5ID0gbmV3IFRIUkVFLlNwaGVyZUdlb21ldHJ5KDAuMywgMTYsIDE2KTsgLy8gU2NhbGVkIGRvd24gfjE1JQogICAgICAgICAgICBjb25zdCBtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7CiAgICAgICAgICAgICAgICBtYXA6IHBsYWNlaG9sZGVyVGV4LAogICAgICAgICAgICAgICAgY29sb3I6IDB4ZmZmZmZmLCAKICAgICAgICAgICAgICAgIHdpcmVmcmFtZTogZmFsc2UsIC8vIFNvbGlkCiAgICAgICAgICAgICAgICB0cmFuc3BhcmVudDogZmFsc2UsCiAgICAgICAgICAgICAgICBvcGFjaXR5OiAxLjAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMucGxhY2Vob2xkZXIgPSBuZXcgVEhSRUUuTWVzaChnZW9tZXRyeSwgbWF0ZXJpYWwpOwoKICAgICAgICAgICAgLy8gTG9hZCBHTEIgTW9kZWwKICAgICAgICAgICAgY29uc3QgdXJsID0gJ2h0dHBzOi8vY2RuLnRpbnlnbGIuY29tL21vZGVscy81MjFhZTg3ODhlNTg0ZTM3OGE3OWQ5NzMyYTA3NTM1Ni5nbGInOwogICAgICAgICAgICAKICAgICAgICAgICAgd2luZG93LmZsdXguQXNzZXRMb2FkZXIubG9hZE1vZGVsKHVybCwgKGdsdGYpID0+IHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJERUJVRzogQmFsbCBHTEIgbG9hZGVkLiIsIGdsdGYpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBtb2RlbCA9IGdsdGYuc2NlbmU7CgogICAgICAgICAgICAgICAgLy8gMS4gUmVzZXQgcm9vdCB0cmFuc2Zvcm1zCiAgICAgICAgICAgICAgICBtb2RlbC5wb3NpdGlvbi5zZXQoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICBtb2RlbC5yb3RhdGlvbi5zZXQoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICBtb2RlbC5zY2FsZS5zZXQoMSwgMSwgMSk7CiAgICAgICAgICAgICAgICBtb2RlbC51cGRhdGVNYXRyaXhXb3JsZCh0cnVlKTsKCiAgICAgICAgICAgICAgICAvLyAyLiBIYXJkZW4gTWF0ZXJpYWxzICYgVmlzaWJpbGl0eQogICAgICAgICAgICAgICAgbW9kZWwudHJhdmVyc2UoKG5vZGUpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5pc01lc2gpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5jYXN0U2hhZG93ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUucmVjZWl2ZVNoYWRvdyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICBub2RlLmZydXN0dW1DdWxsZWQgPSBmYWxzZTsgLy8gQ1JJVElDQUw6IFByZXZlbnQgY3VsbGluZyBpZiBib3VuZHMgYXJlIG9mZgogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUubWF0ZXJpYWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1hdHMgPSBBcnJheS5pc0FycmF5KG5vZGUubWF0ZXJpYWwpID8gbm9kZS5tYXRlcmlhbCA6IFtub2RlLm1hdGVyaWFsXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdHMuZm9yRWFjaChtID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLmNvbG9yLnNldEhleCgweGZmZmZmZik7IC8vIEZvcmNlIHdoaXRlIGJhc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLnNpZGUgPSBUSFJFRS5Eb3VibGVTaWRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0udHJhbnNwYXJlbnQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLm9wYWNpdHkgPSAxLjA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbS5hbHBoYVRlc3QgPSAwOyAvLyBDUklUSUNBTDogRGlzYWJsZSBhbHBoYSB0ZXN0IHRvIHByZXZlbnQgY3VsbGluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0uZGVwdGhXcml0ZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbS5kZXB0aFRlc3QgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAvLyAzLiBDb21wdXRlIEJvdW5kaW5nIEJveAogICAgICAgICAgICAgICAgY29uc3QgYm94ID0gbmV3IFRIUkVFLkJveDMoKS5zZXRGcm9tT2JqZWN0KG1vZGVsKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNpemUgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgICAgICAgICAgICAgYm94LmdldFNpemUoc2l6ZSk7CiAgICAgICAgICAgICAgICBjb25zdCBjZW50ZXIgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgICAgICAgICAgICAgYm94LmdldENlbnRlcihjZW50ZXIpOwoKICAgICAgICAgICAgICAgIC8vIDQuIFZhbGlkYXRpb24KICAgICAgICAgICAgICAgIGNvbnN0IG1heERpbSA9IE1hdGgubWF4KHNpemUueCwgc2l6ZS55LCBzaXplLnopOwogICAgICAgICAgICAgICAgaWYgKG1heERpbSA8PSAwLjAwMSB8fCAhaXNGaW5pdGUobWF4RGltKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiQmFsbCBtb2RlbCBoYXMgaW52YWxpZCBkaW1lbnNpb25zLiBLZWVwaW5nIHBsYWNlaG9sZGVyLiIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsgCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gNS4gQ2FsY3VsYXRlIFNjYWxlCi8vIDUuIENhbGN1bGF0ZSBTY2FsZQpjb25zdCB0YXJnZXREaWFtZXRlciA9IDAuNzI7IC8vIFJlZHVjZWQgc2NhbGUgYnkgfjE1JSAod2FzIDAuODUpCiAgICAgICAgICAgICAgICBjb25zdCBzY2FsZUZhY3RvciA9IHRhcmdldERpYW1ldGVyIC8gbWF4RGltOwoKICAgICAgICAgICAgICAgIC8vIDYuIEFwcGx5IFRyYW5zZm9ybXMKICAgICAgICAgICAgICAgIG1vZGVsLnNjYWxlLnNldFNjYWxhcihzY2FsZUZhY3Rvcik7CiAgICAgICAgICAgICAgICBtb2RlbC5wb3NpdGlvbi5jb3B5KGNlbnRlcikubXVsdGlwbHlTY2FsYXIoLXNjYWxlRmFjdG9yKTsKCiAgICAgICAgICAgICAgICAvLyA3LiBTd2FwIFBsYWNlaG9sZGVyCiAgICAgICAgICAgICAgICBpZiAodGhpcy5wbGFjZWhvbGRlcikgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc3Bpbk5vZGUucmVtb3ZlKHRoaXMucGxhY2Vob2xkZXIpOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnBsYWNlaG9sZGVyLmdlb21ldHJ5KSB0aGlzLnBsYWNlaG9sZGVyLmdlb21ldHJ5LmRpc3Bvc2UoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsID0gbW9kZWw7CiAgICAgICAgICAgICAgICB0aGlzLnNwaW5Ob2RlLmFkZCh0aGlzLm1vZGVsKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBCbGl0emJhbGwgbW9kZWwgYXR0YWNoZWQuIFNjYWxlOiAke3NjYWxlRmFjdG9yLnRvRml4ZWQoNCl9YCk7CgogICAgICAgICAgICB9LCB1bmRlZmluZWQsIChlcnIpID0+IHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkZhaWxlZCB0byBsb2FkIEJsaXR6YmFsbCBtb2RlbDoiLCBlcnIpOwogICAgICAgICAgICAgICAgLy8gRmFsbGJhY2s6IEtlZXAgcGxhY2Vob2xkZXIgYnV0IHRpbnQgaXQgcmVkIHRvIGluZGljYXRlIGVycm9yCiAgICAgICAgICAgICAgICBpZiAodGhpcy5wbGFjZWhvbGRlcikgewogICAgICAgICAgICAgICAgICAgIHRoaXMucGxhY2Vob2xkZXIubWF0ZXJpYWwuY29sb3Iuc2V0SGV4KDB4ZmZhYWFhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKdXBkYXRlKGR0KSB7CiAgICAgICAgICAgIGlmICghdGhpcy5tZXNoKSByZXR1cm47CgogICAgICAgICAgICAvLyBTYWZldHk6IFJlc2V0IGlmIHBvc2l0aW9uIGNvcnJ1cHRlZAogICAgICAgICAgICBpZiAoaXNOYU4odGhpcy5tZXNoLnBvc2l0aW9uLngpIHx8IGlzTmFOKHRoaXMubWVzaC5wb3NpdGlvbi55KSB8fCBpc05hTih0aGlzLm1lc2gucG9zaXRpb24ueikpIHsKICAgICAgICAgICAgICAgIHRoaXMucmVzZXQoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gU2FmZXR5OiBGaXggIlVucGlja2FibGUgQmFsbCIgQnVnCiAgICAgICAgICAgIC8vIElmIHN0YXRlIGlzICdoZWxkJyBvciAnbWFnbmV0aXplZCcgYnV0IHRoZSBhY3RvciBpcyBtaXNzaW5nL2ludmFsaWQsIGZvcmNlIGRyb3AgdG8gJ2ZyZWUnLgogICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSA9PT0gJ2hlbGQnICYmICghdGhpcy5ob2xkZXIgfHwgIXRoaXMuaG9sZGVyLm1lc2gpKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSA9PT0gJ21hZ25ldGl6ZWQnICYmICghdGhpcy5tYWduZXRUYXJnZXQgfHwgIXRoaXMubWFnbmV0VGFyZ2V0Lm1lc2gpKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3AoKTsKICAgICAgICAgICAgfQppZiAodGhpcy50cmFpbCkgewogICAgICAgICAgICAgICAgLy8gVHJhaWwgaXMgYWN0aXZlIGlmIGJhbGwgaXMgbW92aW5nIGZhc3QgYW5kIGZyZWUKICAgICAgICAgICAgICAgIGNvbnN0IHNwZWVkID0gdGhpcy52ZWxvY2l0eS5sZW5ndGgoKTsKICAgICAgICAgICAgICAgIHRoaXMudHJhaWwuYWN0aXZlID0gKHRoaXMuc3RhdGUgPT09ICdmcmVlJyAmJiBzcGVlZCA+IDIuMCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEZpeDogT2Zmc2V0IHRyYWlsIHRvIG1hdGNoIHZpc3VhbCBtb2RlbCBwb3NpdGlvbiAoZGVmb3JtTm9kZSBvZmZzZXQpCiAgICAgICAgICAgICAgICBfYlZlYy5jb3B5KHRoaXMubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZWZvcm1Ob2RlKSBfYlZlYy55ICs9IHRoaXMuZGVmb3JtTm9kZS5wb3NpdGlvbi55OwoKICAgICAgICAgICAgICAgIHRoaXMudHJhaWwudXBkYXRlKF9iVmVjKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUgPT09ICdoZWxkJyAmJiB0aGlzLmhvbGRlciAmJiB0aGlzLmhvbGRlci5tZXNoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUhlbGQoZHQpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuc3RhdGUgPT09ICdtYWduZXRpemVkJykgewogICAgICAgICAgICAgICAgdGhpcy51cGRhdGVNYWduZXRpemVkKGR0KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlRnJlZShkdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh0aGlzLmNhdGNoR3JhY2VQZXJpb2QgPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNhdGNoR3JhY2VQZXJpb2QgLT0gZHQ7CiAgICAgICAgICAgIH0KCnRoaXMudXBkYXRlVmlzdWFscyhkdCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTYWZldHk6IEVuc3VyZSB2aXNpYmlsaXR5IGlmIG5vdCBleHBsaWNpdGx5IGludmlzaWJsZQovLyBTYWZldHk6IEVuc3VyZSB2aXNpYmlsaXR5IGlmIG5vdCBleHBsaWNpdGx5IGludmlzaWJsZQogICAgICAgICAgICBpZiAodGhpcy5tZXNoICYmICF0aGlzLmlzSW52aXNpYmxlKSB7CiAgICAgICAgICAgICAgICB0aGlzLm1lc2gudmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgICAgICAvLyBGb3JjZSBtb2RlbCB2aXNpYmlsaXR5IGlmIHByZXNlbnQgKHNvbWV0aW1lcyBHTFRGIGxvYWRlciBoaWRlcyBpdCkKICAgICAgICAgICAgICAgIGlmICh0aGlzLm1vZGVsKSB0aGlzLm1vZGVsLnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKbWFnbmV0aXplKHRhcmdldCkgewogICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSA9PT0gJ21hZ25ldGl6ZWQnIHx8IHRoaXMuc3RhdGUgPT09ICdoZWxkJykgcmV0dXJuOwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5zdGF0ZSA9ICdtYWduZXRpemVkJzsKICAgICAgICAgICAgdGhpcy5tYWduZXRUYXJnZXQgPSB0YXJnZXQ7CiAgICAgICAgICAgIHRoaXMuaG9sZGVyID0gdGFyZ2V0OyAvLyBMb2dpY2FsIHBvc3Nlc3Npb24gc28gQUkgcmVhY3RzCiAgICAgICAgICAgIHRoaXMubWFnbmV0VGltZXIgPSAwOwogICAgICAgICAgICB0aGlzLm1hZ25ldFN0YXJ0UG9zLmNvcHkodGhpcy5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgdGhpcy5tYWduZXRTdGFydFZlbC5jb3B5KHRoaXMudmVsb2NpdHkpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRHluYW1pYyBEdXJhdGlvbiBiYXNlZCBvbiBkaXN0YW5jZSAoU21vb3RoZXIgZm9yIGxvbmcgcmFuZ2UsIHNuYXBweSBmb3IgY2xvc2UpCiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSB0aGlzLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyh0YXJnZXQubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgIHRoaXMubWFnbmV0RHVyYXRpb24gPSBNYXRoLm1heCgwLjE1LCBNYXRoLm1pbigwLjQsIGRpc3QgLyAxNS4wKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBLaWxsIHBoeXNpY3MKICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS5zZXQoMCwgMCwgMCk7CiAgICAgICAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnNldCgwLCAwLCAwKTsKCiAgICAgICAgICAgIC8vIE5vdGlmeSBwbGF5ZXIgaW1tZWRpYXRlbHkgc28gdGhleSBzdG9wIGNoYXNpbmcgYW5kIHBsYXkgYW5pbWF0aW9uCiAgICAgICAgICAgIGlmICh0YXJnZXQucmVjZWl2ZUJhbGwpIHsKICAgICAgICAgICAgICAgIHRhcmdldC5yZWNlaXZlQmFsbCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLnJldmVhbCgpOwogICAgICAgIH0KCnVwZGF0ZU1hZ25ldGl6ZWQoZHQpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLm1hZ25ldFRhcmdldCB8fCAhdGhpcy5tYWduZXRUYXJnZXQubWVzaCkgewogICAgICAgICAgICAgICAgdGhpcy5kcm9wKCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMubWFnbmV0VGltZXIgKz0gZHQ7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBOb3JtYWxpemVkIFRpbWUKICAgICAgICAgICAgbGV0IHQgPSB0aGlzLm1hZ25ldFRpbWVyIC8gdGhpcy5tYWduZXREdXJhdGlvbjsKICAgICAgICAgICAgaWYgKHQgPiAxLjApIHQgPSAxLjA7CgogICAgICAgICAgICAvLyBUYXJnZXQgIlZpcnR1YWwgSGFuZCIgUG9zaXRpb24gKEZyb250IG9mIENoZXN0KQogICAgICAgICAgICBjb25zdCBob2xkZXJQb3MgPSB0aGlzLm1hZ25ldFRhcmdldC5tZXNoLnBvc2l0aW9uOwogICAgICAgICAgICBjb25zdCBob2xkZXJRdWF0ID0gdGhpcy5tYWduZXRUYXJnZXQubWVzaC5xdWF0ZXJuaW9uOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gT2Zmc2V0OiBGb3J3YXJkIDAuNiwgVXAgMS4wIChDaGVzdCBoZWlnaHQpCiAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IF9iVmVjLnNldCgwLCAxLjAsIDAuNikuYXBwbHlRdWF0ZXJuaW9uKGhvbGRlclF1YXQpOwogICAgICAgICAgICBjb25zdCB0YXJnZXRQb3MgPSBvZmZzZXQuYWRkKGhvbGRlclBvcyk7CgogICAgICAgICAgICAvLyAtLS0gUVVBRFJBVElDIEJFWklFUiBDVVJWRSAtLS0KICAgICAgICAgICAgLy8gUDAgPSBTdGFydCwgUDIgPSBUYXJnZXQKICAgICAgICAgICAgLy8gUDEgPSBDb250cm9sIFBvaW50IChQcm9qZWN0ZWQgYWxvbmcgaW5pdGlhbCB2ZWxvY2l0eSB0byBwcmVzZXJ2ZSBtb21lbnR1bSBmZWVsKQogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgcDAgPSB0aGlzLm1hZ25ldFN0YXJ0UG9zOwogICAgICAgICAgICBjb25zdCBwMiA9IHRhcmdldFBvczsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBQMSAoQ29udHJvbCBQb2ludCkKICAgICAgICAgICAgLy8gUHJvamVjdCBmb3J3YXJkIGZyb20gUDAgYWxvbmcgc3RhcnQgdmVsb2NpdHkgdmVjdG9yCiAgICAgICAgICAgIC8vIERpc3RhbmNlIG9mIHByb2plY3Rpb24gPSA0MCUgb2YgdG90YWwgZGlzdGFuY2UgdG8gdGFyZ2V0CiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBwMC5kaXN0YW5jZVRvKHAyKTsKICAgICAgICAgICAgY29uc3QgcDEgPSBfdGVtcFZlYy5jb3B5KHAwKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IHZlbExlbiA9IHRoaXMubWFnbmV0U3RhcnRWZWwubGVuZ3RoU3EoKTsKICAgICAgICAgICAgaWYgKHZlbExlbiA+IDEuMCkgewogICAgICAgICAgICAgICAgLy8gVXNlIHZlbG9jaXR5IHRhbmdlbnQKICAgICAgICAgICAgICAgIGNvbnN0IGRpciA9IHRoaXMubWFnbmV0U3RhcnRWZWwuY2xvbmUoKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgIHAxLmFkZChkaXIubXVsdGlwbHlTY2FsYXIoZGlzdCAqIDAuNCkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gTm8gdmVsb2NpdHkgKHN0YXRpb25hcnkgYmFsbCksIGFyYyB1cHdhcmRzIHNsaWdodGx5CiAgICAgICAgICAgICAgICBwMS5sZXJwKHAyLCAwLjUpOwogICAgICAgICAgICAgICAgcDEueSArPSAxLjU7IAogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBCZXppZXI6IEIodCkgPSAoMS10KV4yICogUDAgKyAyKDEtdCl0ICogUDEgKyB0XjIgKiBQMgogICAgICAgICAgICBjb25zdCBvbmVNaW51c1QgPSAxLjAgLSB0OwogICAgICAgICAgICBjb25zdCB3MCA9IG9uZU1pbnVzVCAqIG9uZU1pbnVzVDsKICAgICAgICAgICAgY29uc3QgdzEgPSAyLjAgKiBvbmVNaW51c1QgKiB0OwogICAgICAgICAgICBjb25zdCB3MiA9IHQgKiB0OwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5tZXNoLnBvc2l0aW9uLnggPSAodzAgKiBwMC54KSArICh3MSAqIHAxLngpICsgKHcyICogcDIueCk7CiAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi55ID0gKHcwICogcDAueSkgKyAodzEgKiBwMS55KSArICh3MiAqIHAyLnkpOwogICAgICAgICAgICB0aGlzLm1lc2gucG9zaXRpb24ueiA9ICh3MCAqIHAwLnopICsgKHcxICogcDEueikgKyAodzIgKiBwMi56KTsKCiAgICAgICAgICAgIC8vIEZpbmlzaAogICAgICAgICAgICBpZiAodCA+PSAxLjApIHsKICAgICAgICAgICAgICAgIHRoaXMuZ3JhYih0aGlzLm1hZ25ldFRhcmdldCk7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgp1cGRhdGVIZWxkKGR0KSB7CiAgICAgICAgICAgIC8vIEFUVEFDSEVEIFNUQVRFIChWaXJ0dWFsIEF0dGFjaG1lbnQpCiAgICAgICAgICAgIGlmICghdGhpcy5ob2xkZXIgfHwgIXRoaXMuaG9sZGVyLm1lc2gpIHsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcCgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLnZlbG9jaXR5LnNldCgwLCAwLCAwKTsKICAgICAgICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuc2V0KDAsIDAsIDApOwoKICAgICAgICAgICAgLy8gMS4gVHJ5IHRvIHVzZSBIYW5kIEJvbmUgaWYgYXZhaWxhYmxlIChSZWFsaXNtKQogICAgICAgICAgICBpZiAodGhpcy5ob2xkZXIuaGFuZEJvbmUpIHsKICAgICAgICAgICAgICAgIC8vIEdldCB3b3JsZCBwb3NpdGlvbiBvZiB0aGUgaGFuZCBib25lCiAgICAgICAgICAgICAgICB0aGlzLmhvbGRlci5oYW5kQm9uZS5nZXRXb3JsZFBvc2l0aW9uKHRoaXMubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEFkanVzdCBzbGlnaHRseSB0byBzaXQgSU4gdGhlIGhhbmQgcmF0aGVyIHRoYW4gT04gdGhlIHdyaXN0CiAgICAgICAgICAgICAgICAvLyBXZSBjYW4ndCBlYXNpbHkga25vdyAiZm9yd2FyZCIgZm9yIHRoZSBib25lIHdpdGhvdXQgbW9yZSBpbmZvLCAKICAgICAgICAgICAgICAgIC8vIGJ1dCB1c3VhbGx5IEdMVEYgYm9uZXMgYXJlIG9yaWVudGVkLiBGb3Igbm93LCBleGFjdCBib25lIHBvcyBpcyBiZXR0ZXIgdGhhbiBjaGVzdC4KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIDIuIEZhbGxiYWNrOiBDYWxjdWxhdGUgIkNhcnJ5aW5nIiBQb3NpdGlvbiAoUmlnaHQgSGFuZCBTaWRlKQogICAgICAgICAgICAgICAgLy8gUmVsYXRpdmUgdG8gcGxheWVyOiBVcCAwLjggKFdhaXN0L0NoZXN0KSwgUmlnaHQgMC40LCBGb3J3YXJkIDAuNQogICAgICAgICAgICAgICAgY29uc3QgaG9sZGVyUG9zID0gdGhpcy5ob2xkZXIubWVzaC5wb3NpdGlvbjsKICAgICAgICAgICAgICAgIGNvbnN0IGhvbGRlclF1YXQgPSB0aGlzLmhvbGRlci5tZXNoLnF1YXRlcm5pb247CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFJldXNlIF9iVmVjCiAgICAgICAgICAgICAgICAvLyBPZmZzZXQ6IHg9MC4zNSAoUmlnaHQpLCB5PTAuOSAoTG93ZXIgQ2hlc3QpLCB6PTAuNSAoRm9yd2FyZCkKICAgICAgICAgICAgICAgIF9iVmVjLnNldCgwLjM1LCAwLjksIDAuNSkuYXBwbHlRdWF0ZXJuaW9uKGhvbGRlclF1YXQpOwogICAgICAgICAgICAgICAgdGhpcy5tZXNoLnBvc2l0aW9uLmNvcHkoaG9sZGVyUG9zKS5hZGQoX2JWZWMpOwogICAgICAgICAgICB9CgovLyBWaXN1YWwgRmxhaXI6IFNwaW4gdGhlIGJhbGwgc2xvd2x5CiAgICAgICAgICAgIGNvbnN0IHJvdFggPSBuZXcgVEhSRUUuUXVhdGVybmlvbigpLnNldEZyb21BeGlzQW5nbGUobmV3IFRIUkVFLlZlY3RvcjMoMSwwLDApLCAyICogZHQpOwogICAgICAgICAgICBjb25zdCByb3RZID0gbmV3IFRIUkVFLlF1YXRlcm5pb24oKS5zZXRGcm9tQXhpc0FuZ2xlKG5ldyBUSFJFRS5WZWN0b3IzKDAsMSwwKSwgNSAqIGR0KTsKICAgICAgICAgICAgdGhpcy5hY2N1bXVsYXRlZFJvdGF0aW9uLm11bHRpcGx5KHJvdFgpLm11bHRpcGx5KHJvdFkpOwogICAgICAgIH0KCnVwZGF0ZUZyZWUoZHQpIHsKICAgICAgICAgICAgLy8gUEhZU0lDUyBTVEFURQogICAgICAgICAgICBjb25zdCBDID0gd2luZG93LmZsdXguQmFsbENvbmZpZzsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIDEuIE1hZ251cyBFZmZlY3QgKEN1cnZlKQogICAgICAgICAgICAvLyBGb3JjZSA9IFNwaW4geCBWZWxvY2l0eQogICAgICAgICAgICBpZiAodGhpcy5hbmd1bGFyVmVsb2NpdHkubGVuZ3RoU3EoKSA+IDAuMSAmJiB0aGlzLnZlbG9jaXR5Lmxlbmd0aFNxKCkgPiAwLjUpIHsKICAgICAgICAgICAgICAgIF9tYWdudXNWZWMuY29weSh0aGlzLmFuZ3VsYXJWZWxvY2l0eSkuY3Jvc3ModGhpcy52ZWxvY2l0eSkubXVsdGlwbHlTY2FsYXIoQy5NQUdOVVNfQ09FRkYgKiBkdCk7CiAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5LmFkZChfbWFnbnVzVmVjKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRGVjYXkgU3BpbgogICAgICAgICAgICAgICAgY29uc3Qgc3BpbkRyYWcgPSBNYXRoLm1heCgwLCAxIC0gKEMuU1BJTl9EUkFHICogZHQpKTsKICAgICAgICAgICAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5Lm11bHRpcGx5U2NhbGFyKHNwaW5EcmFnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMi4gVmVydGljYWwgUmVzdG9yaW5nIEZvcmNlIChQbGF5YWJsZSBEZXB0aCBDb25zdHJhaW50KQogICAgICAgICAgICAvLyBLZWVwcyBiYWxsIG5lYXIgWT0wIHRvIHByZXZlbnQgaXQgZ2V0dGluZyBsb3N0IGFib3ZlL2JlbG93IHBsYXllcnMKICAgICAgICAgICAgY29uc3QgeVBvcyA9IHRoaXMubWVzaC5wb3NpdGlvbi55OwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS55IC09IHlQb3MgKiBDLkdSQVZJVFlfU1BSSU5HICogZHQ7CiAgICAgICAgICAgIHRoaXMudmVsb2NpdHkueSAqPSBNYXRoLm1heCgwLCAxIC0gKEMuR1JBVklUWV9EQU1QICogZHQpKTsKCiAgICAgICAgICAgIC8vIDMuIE1vdmUKICAgICAgICAgICAgX3RlbXBWZWMuY29weSh0aGlzLnZlbG9jaXR5KS5tdWx0aXBseVNjYWxhcihkdCk7CiAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi5hZGQoX3RlbXBWZWMpOwoKICAgICAgICAgICAgLy8gMy4gRHJhZyAoUGh5c2ljYWwgV2F0ZXIgcmVzaXN0YW5jZSBvbiBWZWxvY2l0eSkKICAgICAgICAgICAgLy8gU2VwYXJhdGUgZnJvbSBTdGF0IERlY2F5LiBUaGlzIHN0b3BzIHRoZSBiYWxsIHBoeXNpY2FsbHkuCiAgICAgICAgICAgIGNvbnN0IGRyYWdGYWN0b3IgPSBNYXRoLm1heCgwLCAxIC0gKEMuV0FURVJfRFJBRyAqIGR0KSk7CiAgICAgICAgICAgIHRoaXMudmVsb2NpdHkubXVsdGlwbHlTY2FsYXIoZHJhZ0ZhY3Rvcik7CgogICAgICAgICAgICAvLyA0LiBTdGF0IERlY2F5IChUaGUgIkVuZXJneSIgb2YgdGhlIHBhc3Mvc2hvdCkKICAgICAgICAgICAgaWYgKHRoaXMucG93ZXIgPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLnBvd2VyIC09IHRoaXMuZGVjYXlSYXRlICogZHQ7CmlmICh0aGlzLnBvd2VyIDwgMCkgdGhpcy5wb3dlciA9IDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEJ1YmJsZSBUcmFpbCAoSGlnaCBTcGVlZCkKLy8gQnViYmxlIFRyYWlsIChIaWdoIFNwZWVkKQovLyBCdWJibGUgVHJhaWwgKER5bmFtaWMpCiAgICAgICAgICAgIGNvbnN0IHNwZWVkU3EgPSB0aGlzLnZlbG9jaXR5Lmxlbmd0aFNxKCk7CiAgICAgICAgICAgIGlmIChzcGVlZFNxID4gMi4wICYmIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSAmJiB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UucGFydGljbGVNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9idWJibGVUaW1lciAtPSBkdDsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9idWJibGVUaW1lciA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcG0gPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UucGFydGljbGVNYW5hZ2VyOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IHRoaXMudmVsb2NpdHkuY2xvbmUoKS5ub3JtYWxpemUoKS5tdWx0aXBseVNjYWxhcigtMC44KTsgCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gMS4gU3RhbmRhcmQgQnViYmxlIChCYXNlIFRyYWlsKSAtIEFsd2F5cyBzcGF3biBmb3Igdm9sdW1lCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RkUG9zID0gdGhpcy5tZXNoLnBvc2l0aW9uLmNsb25lKCkuYWRkKG9mZnNldCkuYWRkKG5ldyBUSFJFRS5WZWN0b3IzKChNYXRoLnJhbmRvbSgpLTAuNSkqMC4zLCAoTWF0aC5yYW5kb20oKS0wLjUpKjAuMywgKE1hdGgucmFuZG9tKCktMC41KSowLjMpKTsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kZWZvcm1Ob2RlKSBzdGRQb3MueSArPSB0aGlzLmRlZm9ybU5vZGUucG9zaXRpb24ueTsKICAgICAgICAgICAgICAgICAgICBwbS5zcGF3bignYnViYmxlJywgc3RkUG9zLCB7IHNjYWxlOiAwLjE1ICsgTWF0aC5yYW5kb20oKSAqIDAuMiB9KTsKCiAgICAgICAgICAgICAgICAgICAgLy8gMi4gTWljcm8gQnViYmxlcyAoQ2F2aXRhdGlvbiAvIFNwZWVkKSAtIEFkZCBvbiB0b3AKICAgICAgICAgICAgICAgICAgICBpZiAoc3BlZWRTcSA+IDUwLjApIHsgLy8gU3BlZWQgPiB+NwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb3VudCA9IE1hdGgubWluKDQsIE1hdGguZmxvb3Ioc3BlZWRTcSAvIDYwKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpPGNvdW50OyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGppdHRlciA9IG5ldyBUSFJFRS5WZWN0b3IzKChNYXRoLnJhbmRvbSgpLTAuNSkqMC40LCAoTWF0aC5yYW5kb20oKS0wLjUpKjAuNCwgKE1hdGgucmFuZG9tKCktMC41KSowLjQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3Bhd25Qb3MgPSB0aGlzLm1lc2gucG9zaXRpb24uY2xvbmUoKS5hZGQob2Zmc2V0KS5hZGQoaml0dGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRlZm9ybU5vZGUpIHNwYXduUG9zLnkgKz0gdGhpcy5kZWZvcm1Ob2RlLnBvc2l0aW9uLnk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBtLnNwYXduKCdidWJibGVfbWljcm8nLCBzcGF3blBvcywgeyBzY2FsZTogMC4wNSArIE1hdGgucmFuZG9tKCkgKiAwLjEgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYnViYmxlVGltZXIgPSAwLjAyOyAvLyBGYXN0IHVwZGF0ZQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE9jY2FzaW9uYWwgbWljcm8gYnViYmxlIGF0IGxvdyBzcGVlZCBmb3IgZGV0YWlsCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLnJhbmRvbSgpID4gMC41KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgaml0dGVyID0gbmV3IFRIUkVFLlZlY3RvcjMoKE1hdGgucmFuZG9tKCktMC41KSowLjIsIChNYXRoLnJhbmRvbSgpLTAuNSkqMC4yLCAoTWF0aC5yYW5kb20oKS0wLjUpKjAuMik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3Bhd25Qb3MgPSB0aGlzLm1lc2gucG9zaXRpb24uY2xvbmUoKS5hZGQob2Zmc2V0KS5hZGQoaml0dGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kZWZvcm1Ob2RlKSBzcGF3blBvcy55ICs9IHRoaXMuZGVmb3JtTm9kZS5wb3NpdGlvbi55OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBtLnNwYXduKCdidWJibGVfbWljcm8nLCBzcGF3blBvcywgeyBzY2FsZTogMC4wNCArIE1hdGgucmFuZG9tKCkgKiAwLjA2IH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2J1YmJsZVRpbWVyID0gMC4wNTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KLy8gQ29udGludWVkIGxvZ2ljLi4uCiAgICAgICAgICAgIC8vIDUuIEJvdW5kYXJ5IExvZ2ljIChTb2Z0IFdhbGxzIGZvciBDdXJ2ZXMpCi8vIDUuIEJvdW5kYXJ5IExvZ2ljIChTb2Z0IFdhbGxzIGZvciBDdXJ2ZXMpCiAgICAgICAgICAgIC8vIFdlIHVzZSBhICJTb2Z0IFdhbGwiIGFwcHJvYWNoIHRvIHByZXZlbnQgc2hhcnAgVi1ib3VuY2VzLgogICAgICAgICAgICAvLyBBIHJlcHVsc2l2ZSBmb3JjZSBjdXJ2ZXMgdGhlIGJhbGwgYXdheSBiZWZvcmUgaW1wYWN0LCBhbmQgaW1wYWN0IHJlc3VsdHMgaW4gYSBzbGlkZS9zb2Z0IGJvdW5jZS4KICAgICAgICAgICAgY29uc3QgcG9zID0gdGhpcy5tZXNoLnBvc2l0aW9uOwogICAgICAgICAgICBjb25zdCBkaXN0WFogPSBNYXRoLnNxcnQocG9zLnggKiBwb3MueCArIHBvcy56ICogcG9zLnopOwogICAgICAgICAgICBjb25zdCBib3VuZGFyeVJhZGl1cyA9IEMuQk9VTkRBUllfUkFESVVTOwoKICAgICAgICAgICAgY29uc3Qgc29mdEJ1ZmZlciA9IDMuMDsgLy8gUmVkdWNlZCBmcm9tIDUuMCB0byBwcmV2ZW50IGVhcmx5IHJlcHVsc2lvbgogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQS4gU29mdCBSZXB1bHNpb24gKENyZWF0ZXMgY3VydmVkIHRyYWplY3RvcnkgbmVhciB3YWxsKQogICAgICAgICAgICBpZiAoZGlzdFhaID4gYm91bmRhcnlSYWRpdXMgLSBzb2Z0QnVmZmVyKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvbiA9IGRpc3RYWiAtIChib3VuZGFyeVJhZGl1cyAtIHNvZnRCdWZmZXIpOwogICAgICAgICAgICAgICAgY29uc3QgcmF0aW8gPSBwZW5ldHJhdGlvbiAvIHNvZnRCdWZmZXI7IC8vIDAgdG8gMQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBGb3JjZSB2ZWN0b3IgdG93YXJkcyBjZW50ZXIKICAgICAgICAgICAgICAgIGNvbnN0IHB1c2hEaXIgPSBuZXcgVEhSRUUuVmVjdG9yMygtcG9zLngsIDAsIC1wb3Mueikubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICAvLyBFeHBvbmVudGlhbCBmb3JjZSB0byBzdGVlciBpdCBzbW9vdGhseQogICAgICAgICAgICAgICAgLy8gUmVkdWNlZCBmb3JjZSBmcm9tIDYwLjAgdG8gMjAuMCB0byBwcmV2ZW50ICJnaG9zdCB3YWxsIiBib3VuY2VzCiAgICAgICAgICAgICAgICBjb25zdCBmb3JjZSA9IHB1c2hEaXIubXVsdGlwbHlTY2FsYXIocmF0aW8gKiByYXRpbyAqIDIwLjAgKiBkdCk7IAogICAgICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS5hZGQoZm9yY2UpOwp9CgogICAgICAgICAgICAvLyBCLiBIYXJkIENsYW1wIChJZiBpdCBzdGlsbCBoaXRzKQogICAgICAgICAgICBpZiAoZGlzdFhaID4gYm91bmRhcnlSYWRpdXMpIHsKICAgICAgICAgICAgICAgIC8vIE5vcm1hbCBwb2ludGluZyBJTldBUkQKICAgICAgICAgICAgICAgIGNvbnN0IG5vcm1hbCA9IG5ldyBUSFJFRS5WZWN0b3IzKC1wb3MueCwgMCwgLXBvcy56KS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gQ2xhbXAgUG9zaXRpb24KICAgICAgICAgICAgICAgIGNvbnN0IG92ZXJsYXAgPSBkaXN0WFogLSBib3VuZGFyeVJhZGl1czsKICAgICAgICAgICAgICAgIHBvcy5hZGQobm9ybWFsLmNsb25lKCkubXVsdGlwbHlTY2FsYXIob3ZlcmxhcCkpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBWZWxvY2l0eSBIYW5kbGluZzogU29mdCBCb3VuY2UgLyBTbGlkZQogICAgICAgICAgICAgICAgY29uc3QgdkRvdE4gPSB0aGlzLnZlbG9jaXR5LmRvdChub3JtYWwpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBPbmx5IGFkanVzdCBpZiBtb3ZpbmcgT1VUV0FSRFMgKGFnYWluc3Qgbm9ybWFsKQogICAgICAgICAgICAgICAgaWYgKHZEb3ROIDwgMCkgewogICAgICAgICAgICAgICAgICAgIC8vIFJlZHVjZSBub3JtYWwgY29tcG9uZW50IHNpZ25pZmljYW50bHkgKFNsaWRlIGJlaGF2aW9yKQogICAgICAgICAgICAgICAgICAgIC8vIEVsYXN0aWNpdHkgMC4zID0gRHVsbCB0aHVkL3NsaWRlLCBub3QgYSBzaGFycCBwaW5nCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZWxhc3RpY2l0eSA9IDAuMzsgCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gVl9uZXcgPSBWIC0gKDEgKyBlKSAqIChWLk4pICogTgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGltcHVsc2UgPSBub3JtYWwubXVsdGlwbHlTY2FsYXIoLXZEb3ROICogKDEuMCArIGVsYXN0aWNpdHkpKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5LmFkZChpbXB1bHNlKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBGcmljdGlvbiBvbiB3YWxsIGNvbnRhY3QKICAgICAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5Lm11bHRpcGx5U2NhbGFyKDAuOTUpOyAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRmxvb3IvQ2VpbGluZyBCb3VuY2UKICAgICAgICAgICAgaWYgKE1hdGguYWJzKHBvcy55KSA+IEMuQk9VTkRBUllfSEVJR0hUKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzaWduID0gTWF0aC5zaWduKHBvcy55KTsKICAgICAgICAgICAgICAgIHBvcy55ID0gQy5CT1VOREFSWV9IRUlHSFQgKiBzaWduOwogICAgICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS55ICo9IC0wLjQ7IC8vIFNvZnRlciB2ZXJ0aWNhbCBib3VuY2UKICAgICAgICAgICAgfQovLyBJZiBzcGlubmluZyBzaWduaWZpY2FudGx5LCB1c2UgdGhhdCBheGlzCiAgICAgICAgICAgIGNvbnN0IHNwaW5TcGVlZCA9IHRoaXMuYW5ndWxhclZlbG9jaXR5Lmxlbmd0aCgpOwogICAgICAgICAgICBpZiAoc3BpblNwZWVkID4gMC41KSB7CiAgICAgICAgICAgICAgICBjb25zdCBheGlzID0gX3RlbXBWZWMuY29weSh0aGlzLmFuZ3VsYXJWZWxvY2l0eSkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICBjb25zdCBxID0gbmV3IFRIUkVFLlF1YXRlcm5pb24oKS5zZXRGcm9tQXhpc0FuZ2xlKGF4aXMsIHNwaW5TcGVlZCAqIGR0KTsKICAgICAgICAgICAgICAgIHRoaXMuYWNjdW11bGF0ZWRSb3RhdGlvbi5wcmVtdWx0aXBseShxKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEZhbGxiYWNrOiBSb2xsIGJhc2VkIG9uIHZlbG9jaXR5IChWaXN1YWwgZmFrZSBmb3Igbm9uLXNwaW5uaW5nIGJhbGwpCiAgICAgICAgICAgICAgICBjb25zdCBzcGVlZCA9IHRoaXMudmVsb2NpdHkubGVuZ3RoKCk7CiAgICAgICAgICAgICAgICBpZiAoc3BlZWQgPiAwLjEpIHsKICAgICAgICAgICAgICAgICAgICBfdGVtcFZlYy5jb3B5KHRoaXMudmVsb2NpdHkpLmNyb3NzKF9heGlzWSkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKF90ZW1wVmVjLmxlbmd0aFNxKCkgPiAwLjAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHEgPSBuZXcgVEhSRUUuUXVhdGVybmlvbigpLnNldEZyb21BeGlzQW5nbGUoX3RlbXBWZWMsIHNwZWVkICogZHQpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFjY3VtdWxhdGVkUm90YXRpb24ucHJlbXVsdGlwbHkocSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9Cn0KCmdyYWIocGxheWVyKSB7CiAgICAgICAgICAgIHRoaXMucmV2ZWFsKCk7IAogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQW5ub3VuY2VtZW50OiBQb3NzZXNzaW9uIChpZiB0YWtpbmcgZnJvbSBmcmVlIHN0YXRlKQogICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSA9PT0gJ2ZyZWUnKSB7CiAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSAmJiB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2Uuc2hvd0Fubm91bmNlbWVudCkgewogICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2Uuc2hvd0Fubm91bmNlbWVudCgiUE9TU0VTU0lPTiIsICJub3JtYWwiKTsKICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIENoZWNrIFR1cm5vdmVyIChQb3NzZXNzaW9uIENoYW5nZSkKICAgICAgICAgICAgY29uc3QgcHJldmlvdXNUZWFtID0gdGhpcy5ob2xkZXIgPyB0aGlzLmhvbGRlci50ZWFtIDogKHRoaXMubGFzdEhvbGRlciA/IHRoaXMubGFzdEhvbGRlci50ZWFtIDogbnVsbCk7CiAgICAgICAgICAgIGlmIChwcmV2aW91c1RlYW0gJiYgcHJldmlvdXNUZWFtICE9PSBwbGF5ZXIudGVhbSkgewogICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UgJiYgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJUVVJOT1ZFUiIsIHBsYXllci5tZXNoLnBvc2l0aW9uLCAidGVjaCIpOwogICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gSWYgc29tZW9uZSBlbHNlIGhlbGQgaXQsIHRoZXkgbG9zZSBpdAogICAgICAgICAgICBpZiAodGhpcy5ob2xkZXIgJiYgdGhpcy5ob2xkZXIgIT09IHBsYXllcikgewogICAgICAgICAgICAgICAgdGhpcy5ob2xkZXIubG9zZUJhbGwoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5ob2xkZXIgPSBwbGF5ZXI7CiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSAnaGVsZCc7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBOT1RFOiBXZSBkbyBOT1QgcGFyZW50IHRoZSBtZXNoIHRvIHRoZSBwbGF5ZXIgYW55bW9yZS4KICAgICAgICAgICAgLy8gVGhpcyBwcmV2ZW50cyB0aGUgYmFsbCBmcm9tIGZseWluZyBhcm91bmQgZHVlIHRvIHN3aW0gYW5pbWF0aW9ucy4KICAgICAgICAgICAgLy8gSW5zdGVhZCwgd2UgdXBkYXRlIGl0cyBwb3NpdGlvbiBtYW51YWxseSBpbiB1cGRhdGVIZWxkKCkuCiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBOb3RpZnkgcGxheWVyCiAgICAgICAgICAgIGlmIChwbGF5ZXIucmVjZWl2ZUJhbGwpIHsKICAgICAgICAgICAgICAgIHBsYXllci5yZWNlaXZlQmFsbCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zb2xlLmxvZygiQmFsbCBncmFiYmVkIGJ5ICIgKyBwbGF5ZXIucm9sZSk7CiAgICAgICAgfQoKICAgICAgICBkcm9wKCkgewogICAgICAgICAgICB0aGlzLnJldmVhbCgpOyAvLyBFbnN1cmUgdmlzaWJsZQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gTm8gbmVlZCB0byBkZXRhY2ggZnJvbSBzY2VuZSBncmFwaCBzaW5jZSB3ZSBhcmVuJ3QgcGFyZW50aW5nIHRvIHBsYXllciBhbnltb3JlLgogICAgICAgICAgICAvLyBKdXN0IGNsZWFyIGhvbGRlci4KCiAgICAgICAgICAgIGlmICh0aGlzLmhvbGRlcikgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuaG9sZGVyLmxvc2VCYWxsKSB0aGlzLmhvbGRlci5sb3NlQmFsbCgpOwogICAgICAgICAgICAgICAgdGhpcy5ob2xkZXIgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICB0aGlzLnN0YXRlID0gJ2ZyZWUnOwogICAgICAgIH0KLy8gU2hvb3QvUGFzcwovLyBTaG9vdC9QYXNzCiAgICAgICAgc2hvb3QoZGlyZWN0aW9uVmVjdG9yLCBmb3JjZSwgdHlwZSA9ICdTSCcsIHRlY2huaXF1ZSA9IG51bGwsIHNwaW5WZWN0b3IgPSBudWxsKSB7CiAgICAgICAgICAgIHRoaXMubGFzdEhvbGRlciA9IHRoaXMuaG9sZGVyOyAvLyBSZWNvcmQgZm9yIEVYUCBhdHRyaWJ1dGlvbgogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRnVtYmxlIERldGVjdGlvbiAoVHlwZSAnbm9uZScgaXMgdXNlZCBieSBQbGF5ZXIuZnVtYmxlKQogICAgICAgICAgICBpZiAodHlwZSA9PT0gJ25vbmUnKSB7CiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlICYmIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5zaG93QW5ub3VuY2VtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLnNob3dBbm5vdW5jZW1lbnQoIkZVTUJMRSEiLCAic2xhbSIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmRyb3AoKTsgLy8gRGV0YWNoIGZpcnN0CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTZXQgR3JhY2UgUGVyaW9kIHRvIHByZXZlbnQgaW5zdGFudCBpbnRlcmNlcHRpb25zL2NhdGNoZXMKICAgICAgICAgICAgLy8gMC4ycyBhbGxvd3MgYmFsbCB0byBjbGVhciB0aGUgdGhyb3dlcidzIGltbWVkaWF0ZSB2aWNpbml0eQogICAgICAgICAgICB0aGlzLmNhdGNoR3JhY2VQZXJpb2QgPSAwLjI7CgogICAgICAgICAgICAvLyBQaHlzaWNhbCBWZWxvY2l0eSAoVmlzdWFsIHNwZWVkKQovLyBQaHlzaWNhbCBWZWxvY2l0eSAoVmlzdWFsIHNwZWVkKQogICAgICAgICAgICAvLyBXZSBtYXAgZm9yY2UgKHN0YXQpIHRvIHBoeXNpY2FsIHNwZWVkLCBidXQgY2xhbXAgaXQgcmVhc29uYWJsZQogICAgICAgICAgICAvLyBJbmNyZWFzZWQgY2FwIHRvIDQwLjAgdG8gYWxsb3cgZm9yIHN0cm9uZyBwYXNzZXMgYW5kIGNsZWFycwogICAgICAgICAgICBjb25zdCBzcGVlZCA9IE1hdGgubWluKGZvcmNlLCA0MC4wKTsKICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS5jb3B5KGRpcmVjdGlvblZlY3Rvcikubm9ybWFsaXplKCkubXVsdGlwbHlTY2FsYXIoc3BlZWQpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQXBwbHkgU3BpbiBpZiBwcm92aWRlZAogICAgICAgICAgICBpZiAoc3BpblZlY3RvcikgewogICAgICAgICAgICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuY29weShzcGluVmVjdG9yKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnNldCgwLCAwLCAwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU3RhdCBQb3dlciAoR2FtZSBMb2dpYykKICAgICAgICAgICAgdGhpcy5wb3dlciA9IGZvcmNlOwogICAgICAgICAgICB0aGlzLnBvd2VyVHlwZSA9IHR5cGU7CiAgICAgICAgICAgIHRoaXMudGVjaG5pcXVlID0gdGVjaG5pcXVlOyAKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFVwZGF0ZSBUcmFpbCBDb2xvcgogICAgICAgICAgICBpZiAodGhpcy50cmFpbCkgewogICAgICAgICAgICAgICAgbGV0IGNvbG9yID0gMHgwMGFhZmY7IC8vIERlZmF1bHQgQmx1ZSAoUGFzcykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKHRlY2huaXF1ZSkgewogICAgICAgICAgICAgICAgICAgIGlmICh0ZWNobmlxdWUudHlwZSA9PT0gJ3Zlbm9tJykgY29sb3IgPSAweGFhMDBmZjsgLy8gUHVycGxlCiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodGVjaG5pcXVlLnR5cGUgPT09ICd3aXRoZXInKSBjb2xvciA9IDB4ODg4ODg4OyAvLyBHcmV5CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodGVjaG5pcXVlLnR5cGUgPT09ICduYXAnKSBjb2xvciA9IDB4MDAwMDg4OyAvLyBEYXJrIEJsdWUKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0ZWNobmlxdWUudHlwZSA9PT0gJ3NwaGVyZScpIGNvbG9yID0gMHgwMGZmZmY7IC8vIEN5YW4KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0ZWNobmlxdWUudHlwZSA9PT0gJ2plY2h0JykgY29sb3IgPSAweGZmMDAwMDsgLy8gUmVkCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdTSCcpIHsKICAgICAgICAgICAgICAgICAgICBjb2xvciA9IDB4ZmY0NDAwOyAvLyBPcmFuZ2UvUmVkCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRoaXMudHJhaWwuc2V0Q29sb3IoY29sb3IpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBIYW5kbGUgSW52aXNpYmxlIFNob3QKICAgICAgICAgICAgaWYgKHRlY2huaXF1ZSAmJiB0ZWNobmlxdWUudHlwZSA9PT0gJ2ludmlzaWJsZScpIHsKICAgICAgICAgICAgICAgIHRoaXMuaXNJbnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgaWYgKHRoaXMubWVzaCkgdGhpcy5tZXNoLnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJJbnZpc2libGUgU2hvdCEiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgY29uc29sZS5sb2coYEJhbGwgJHt0eXBlfSB3aXRoIFBvd2VyOiAke3RoaXMucG93ZXIudG9GaXhlZCgxKX0gU3BpbjogJHt0aGlzLmFuZ3VsYXJWZWxvY2l0eS5sZW5ndGgoKS50b0ZpeGVkKDEpfWApOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVmlzdWFsIEZlZWRiYWNrIGZvciBDdXJ2ZQogICAgICAgICAgICBpZiAodGhpcy5hbmd1bGFyVmVsb2NpdHkubGVuZ3RoKCkgPiAxNS4wICYmIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSAmJiB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJDVVJWRSEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJ0ZWNoIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldmVhbCgpIHsKCiAgICAgICAgICAgIHRoaXMuaXNJbnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHRoaXMubWVzaCkgdGhpcy5tZXNoLnZpc2libGUgPSB0cnVlOwogICAgICAgIH0KICAgICAgICAKcmVzZXQoKSB7CiAgICAgICAgICAgIHRoaXMucmV2ZWFsKCk7CiAgICAgICAgICAgIHRoaXMuZHJvcCgpOwogICAgICAgICAgICB0aGlzLm1lc2gucG9zaXRpb24uc2V0KDAsIDAsIDApOwogICAgICAgICAgICB0aGlzLnZlbG9jaXR5LnNldCgwLCAwLCAwKTsKICAgICAgICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuc2V0KDAsIDAsIDApOwogICAgICAgICAgICB0aGlzLmNhdGNoR3JhY2VQZXJpb2QgPSAwOwogICAgICAgICAgICB0aGlzLnBvd2VyID0gMDsKICAgICAgICB9CmlzQ2F0Y2hhYmxlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jYXRjaEdyYWNlUGVyaW9kIDw9IDA7CiAgICAgICAgfQoKICAgICAgICB1cGRhdGVWaXN1YWxzKGR0KSB7CiAgICAgICAgICAgIGlmICghdGhpcy5kZWZvcm1Ob2RlIHx8ICF0aGlzLnNwaW5Ob2RlKSByZXR1cm47CgogICAgICAgICAgICAvLyAxLiBTcXVhc2ggJiBTdHJldGNoIGJhc2VkIG9uIHZlbG9jaXR5Ci8vIDEuIFNxdWFzaCAmIFN0cmV0Y2ggYmFzZWQgb24gdmVsb2NpdHkKICAgICAgICAgICAgY29uc3Qgc3BlZWQgPSB0aGlzLnZlbG9jaXR5Lmxlbmd0aCgpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gT25seSBhcHBseSBzdHJldGNoIGlmIG1vdmluZyBmYXN0IGVub3VnaAogICAgICAgICAgICBpZiAoc3BlZWQgPiAxLjAgJiYgdGhpcy5zdGF0ZSA9PT0gJ2ZyZWUnKSB7CiAgICAgICAgICAgICAgICAvLyBPcmllbnQgZGVmb3JtTm9kZSB0byB2ZWxvY2l0eSBkaXJlY3Rpb24KICAgICAgICAgICAgICAgIGNvbnN0IGRpciA9IHRoaXMudmVsb2NpdHkuY2xvbmUoKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgIC8vIERlZmF1bHQgZm9yd2FyZCBpcyBaICgwLDAsMSkKICAgICAgICAgICAgICAgIHRoaXMuZGVmb3JtTm9kZS5xdWF0ZXJuaW9uLnNldEZyb21Vbml0VmVjdG9ycyhuZXcgVEhSRUUuVmVjdG9yMygwLDAsMSksIGRpcik7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBzdHJldGNoIGZhY3RvcgogICAgICAgICAgICAgICAgLy8gTWF4IHN0cmV0Y2ggYXQgc3BlZWQgNDAgKGFwcHJveCBtYXggc2hvdCBwb3dlcikKICAgICAgICAgICAgICAgIGNvbnN0IGZhY3RvciA9IE1hdGgubWluKHNwZWVkIC8gNDAuMCwgMS4wKTsgCiAgICAgICAgICAgICAgICBjb25zdCBzdHJldGNoID0gMS4wICsgKGZhY3RvciAqIDAuOCk7IC8vIEluY3JlYXNlZCBzdHJldGNoIG1heCB0byAxLjh4CiAgICAgICAgICAgICAgICBjb25zdCBzcXVhc2ggPSAxLjAgLyBNYXRoLnNxcnQoc3RyZXRjaCk7IC8vIE1haW50YWluIHZvbHVtZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0aGlzLmRlZm9ybU5vZGUuc2NhbGUuc2V0KHNxdWFzaCwgc3F1YXNoLCBzdHJldGNoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIFJlc2V0IGRlZm9ybWF0aW9uCiAgICAgICAgICAgICAgICB0aGlzLmRlZm9ybU5vZGUucXVhdGVybmlvbi5pZGVudGl0eSgpOwogICAgICAgICAgICAgICAgdGhpcy5kZWZvcm1Ob2RlLnNjYWxlLnNldCgxLCAxLCAxKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMi4gQXBwbHkgQWNjdW11bGF0ZWQgU3BpbgogICAgICAgICAgICAvLyBTaW5jZSBkZWZvcm1Ob2RlIG1pZ2h0IGJlIHJvdGF0ZWQsIHdlIG5lZWQgdG8gYXBwbHkgc3BpbiBpbiB0aGUgY29ycmVjdCBzcGFjZS4KICAgICAgICAgICAgLy8gc3Bpbk5vZGUgcm90YXRpb24gPSBkZWZvcm1Ob2RlX2ludmVyc2UgKiBhY2N1bXVsYXRlZFJvdGF0aW9uCmNvbnN0IGludkRlZm9ybSA9IHRoaXMuZGVmb3JtTm9kZS5xdWF0ZXJuaW9uLmNsb25lKCkuaW52ZXJ0KCk7CiAgICAgICAgICAgIHRoaXMuc3Bpbk5vZGUucXVhdGVybmlvbi5jb3B5KGludkRlZm9ybS5tdWx0aXBseSh0aGlzLmFjY3VtdWxhdGVkUm90YXRpb24pKTsKICAgICAgICB9CiAgICB9CgogICAgd2luZG93LmZsdXguQmFsbCA9IEJhbGw7Cn0pKCk7","GameManager.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCi8vIFNwYXJrIFRleHR1cmUgKFByb2NlZHVyYWwgQnVyc3QpCiAgICBjb25zdCBfc3BhcmtUZXh0dXJlID0gKCgpID0+IHsKICAgICAgICBjb25zdCBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgYy53aWR0aCA9IDY0OyBjLmhlaWdodCA9IDY0OwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjdHguY2xlYXJSZWN0KDAsMCw2NCw2NCk7CiAgICAgICAgCiAgICAgICAgLy8gQnVyc3Qgc2hhcGUKICAgICAgICBjb25zdCBjeCA9IDMyLCBjeSA9IDMyOwogICAgICAgIGNvbnN0IHNwaWtlcyA9IDg7CiAgICAgICAgY29uc3Qgb3V0ZXIgPSAzMDsKICAgICAgICBjb25zdCBpbm5lciA9IDEwOwogICAgICAgIAogICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICBmb3IobGV0IGk9MDsgaTxzcGlrZXMqMjsgaSsrKXsKICAgICAgICAgICAgY29uc3QgciA9IChpJTI9PT0wKT8gb3V0ZXIgOiBpbm5lcjsKICAgICAgICAgICAgY29uc3QgYSA9IChNYXRoLlBJKmkpL3NwaWtlczsKICAgICAgICAgICAgY3R4LmxpbmVUbyhjeCArIE1hdGguY29zKGEpKnIsIGN5ICsgTWF0aC5zaW4oYSkqcik7CiAgICAgICAgfQogICAgICAgIGN0eC5jbG9zZVBhdGgoKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gJyNmZmNjMDAnOwogICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgCiAgICAgICAgLy8gV2hpdGUgQ29yZQogICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICBjdHguYXJjKGN4LCBjeSwgOCwgMCwgTWF0aC5QSSoyKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gJyNmZmZmZmYnOwogICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIG5ldyBUSFJFRS5DYW52YXNUZXh0dXJlKGMpOwogICAgfSkoKTsKCiAgICBjb25zdCBfc3BhcmtNYXRlcmlhbCA9IG5ldyBUSFJFRS5TcHJpdGVNYXRlcmlhbCh7IAogICAgICAgIG1hcDogX3NwYXJrVGV4dHVyZSwgCiAgICAgICAgdHJhbnNwYXJlbnQ6IHRydWUsIAogICAgICAgIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nLAogICAgICAgIGRlcHRoV3JpdGU6IGZhbHNlCiAgICB9KTsKCiAgICBjbGFzcyBHYW1lTWFuYWdlciB7CgogICAgICAgIApjb25zdHJ1Y3RvcihzY2VuZSwgdWlMYXllcklkLCBjYW1lcmEsIHJlbmRlcmVyKSB7CndpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSA9IHRoaXM7CiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIgPSByZW5kZXJlcjsgLy8gU3RvcmUgcmVuZGVyZXIKICAgICAgICAgICAgdGhpcy5zY2VuZSA9IHNjZW5lOwogICAgICAgICAgICB0aGlzLmNhbWVyYSA9IGNhbWVyYTsKICAgICAgICAgICAgdGhpcy51aUxheWVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodWlMYXllcklkKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHRoaXMuc2NvcmUgPSB7IGhvbWU6IDAsIGF3YXk6IDAgfTsKICAgICAgICAgICAgdGhpcy50aW1lID0gMDsKICAgICAgICAgICAgdGhpcy5oYWxmID0gMTsKICAgICAgICAgICAgdGhpcy5oYWxmRHVyYXRpb24gPSAzMDA7IC8vIDUgbWludXRlcyAoc2Vjb25kcykKICAgICAgICAgICAgdGhpcy5pc092ZXJ0aW1lID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuaXNEZW1vTW9kZSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmdhbWVNb2RlID0gJ25vcm1hbCc7IC8vICdub3JtYWwnIG9yICdwcmFjdGljZScKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEltcGFjdCBGcmFtZXMKICAgICAgICAgICAgdGhpcy5pbXBhY3RQYXVzZSA9IDA7CiAgICAgICAgICAgIAogICAgICAgICAgICB0aGlzLnN0YXRlID0gJ21lbnUnOyAvLyBTdGFydCBpbiBtZW51CnRoaXMudGVhbXMgPSB7CiAgICAgICAgICAgICAgICBob21lOiBudWxsLAogICAgICAgICAgICAgICAgYXdheTogbnVsbAogICAgICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5lbnRpdGllcyA9IHsKICAgICAgICAgICAgICAgIGJhbGw6IG51bGwKICAgICAgICAgICAgfTsKCnRoaXMudWkgPSB7CiAgICAgICAgICAgICAgICBzY29yZVBsYXllcjogbnVsbCwKICAgICAgICAgICAgICAgIHNjb3JlQ3B1OiBudWxsLAogICAgICAgICAgICAgICAgdGltZXI6IG51bGwsCiAgICAgICAgICAgICAgICBoYWxmOiBudWxsLAogICAgICAgICAgICAgICAgYW5ub3VuY2VtZW50OiBudWxsLAogICAgICAgICAgICAgICAgLy8gUGxheWVyIFN0YXR1cyBQYW5lbAogICAgICAgICAgICAgICAgc3RhdHVzUGFuZWw6IHsKICAgICAgICAgICAgICAgICAgICBjb250YWluZXI6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgbmFtZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICBocEJhcjogbnVsbCwKICAgICAgICAgICAgICAgICAgICBocFRleHQ6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgZXhwQmFyOiBudWxsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBUZWNoY29weSBTdGF0ZQogICAgICAgICAgICB0aGlzLnRlY2hDb3B5U3RhdGUgPSB7CiAgICAgICAgICAgICAgICBhY3RpdmU6IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDAsCiAgICAgICAgICAgICAgICB0ZWNoOiBudWxsLAogICAgICAgICAgICAgICAgbGVhcm5lcnM6IFtdCiAgICAgICAgICAgIH07Cgp0aGlzLm1pbmlNYXAgPSBuZXcgd2luZG93LmZsdXguTWluaU1hcCgpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gSW5pdGlhbGl6ZSBGbG9hdGluZyBUZXh0Ci8vIEluaXRpYWxpemUgRmxvYXRpbmcgVGV4dAogICAgICAgICAgICB0aGlzLmZsb2F0aW5nVGV4dCA9IG5ldyB3aW5kb3cuZmx1eC5GbG9hdGluZ1RleHRNYW5hZ2VyKHNjZW5lLCB1aUxheWVySWQsIGNhbWVyYSk7CiAgICAgICAgICAgIAovLyBJbml0aWFsaXplIFBhcnRpY2xlIE1hbmFnZXIgKFN0YXR1cyBFZmZlY3RzKQogICAgICAgICAgICB0aGlzLnBhcnRpY2xlTWFuYWdlciA9IG5ldyB3aW5kb3cuZmx1eC5QYXJ0aWNsZU1hbmFnZXIoc2NlbmUpOwp0aGlzLmdseXBoTWFuYWdlciA9IG51bGw7IC8vIEluamVjdGVkIGJ5IG1haW4uanMKICAgICAgICAgICAgdGhpcy5faW5pdFBhcnRpY2xlcygpOyAvLyAzRCBTcGFyayBTeXN0ZW0gKExlZ2FjeS9JbXBhY3QpCgp0aGlzLmRlYnVnVmlzdWFsaXplciA9IG5ldyB3aW5kb3cuZmx1eC5EZWJ1Z1Zpc3VhbGl6ZXIoc2NlbmUpOwogICAgICAgICAgICB0aGlzLnByYWN0aWNlTWFuYWdlciA9IG5ldyB3aW5kb3cuZmx1eC5QcmFjdGljZU1hbmFnZXIodGhpcyk7IC8vIEluaXRpYWxpemUgUHJhY3RpY2UgTWFuYWdlcgogICAgICAgICAgICB0aGlzLl9pbmplY3RTdHlsZXMoKTsKICAgICAgICAgICAgdGhpcy5faW5pdFVJKCk7CiAgICAgICAgfQoKICAgICAgICBfaW5qZWN0U3R5bGVzKCkgewogICAgICAgICAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZsdXgtZHluYW1pYy1zdHlsZXMnKSkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBzdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7CiAgICAgICAgICAgIHN0eWxlLmlkID0gJ2ZsdXgtZHluYW1pYy1zdHlsZXMnOwpzdHlsZS50ZXh0Q29udGVudCA9IGAKICAgICAgICAgICAgICAgIEBrZXlmcmFtZXMgdGV4dFNsYW0gewogICAgICAgICAgICAgICAgICAgIDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSkgc2NhbGUoNCk7IG9wYWNpdHk6IDA7IGxldHRlci1zcGFjaW5nOiA1MHB4OyB9CiAgICAgICAgICAgICAgICAgICAgMTAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSkgc2NhbGUoMSk7IG9wYWNpdHk6IDE7IGxldHRlci1zcGFjaW5nOiA1cHg7IH0KICAgICAgICAgICAgICAgICAgICAxNSUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKSBzY2FsZSgxLjEpOyB9CiAgICAgICAgICAgICAgICAgICAgMjAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSkgc2NhbGUoMSk7IH0KICAgICAgICAgICAgICAgICAgICA4MCUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKSBzY2FsZSgxKTsgb3BhY2l0eTogMTsgZmlsdGVyOiBibHVyKDBweCk7IH0KICAgICAgICAgICAgICAgICAgICAxMDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSkgc2NhbGUoMS41KTsgb3BhY2l0eTogMDsgZmlsdGVyOiBibHVyKDEwcHgpOyB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC5hbm5vdW5jZW1lbnQtc2xhbSB7CiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICAgICAgICAgICAgICAgIHRvcDogNDUlOyBsZWZ0OiA1MCU7CiAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSk7CiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgICAgICAgICAgICAgICAgIGZvbnQtZmFtaWx5OiAnSW1wYWN0Jywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgICAgICAgICBmb250LXNpemU6IDk2cHg7CiAgICAgICAgICAgICAgICAgICAgZm9udC1zdHlsZTogaXRhbGljOwogICAgICAgICAgICAgICAgICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KHRvIGJvdHRvbSwgI2ZmZmZmZiAwJSwgI2ZmZGQwMCA0NSUsICNmZjg4MDAgMTAwJSk7CiAgICAgICAgICAgICAgICAgICAgLXdlYmtpdC1iYWNrZ3JvdW5kLWNsaXA6IHRleHQ7CiAgICAgICAgICAgICAgICAgICAgLXdlYmtpdC10ZXh0LWZpbGwtY29sb3I6IHRyYW5zcGFyZW50OwogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogZHJvcC1zaGFkb3coMCAwIDEwcHggcmdiYSgwLDAsMCwxKSkgZHJvcC1zaGFkb3coMCAwIDMwcHggcmdiYSgyNTUsIDEwMCwgMCwgMC42KSk7CiAgICAgICAgICAgICAgICAgICAgei1pbmRleDogMjAwMDsKICAgICAgICAgICAgICAgICAgICBhbmltYXRpb246IHRleHRTbGFtIDEuOHMgY3ViaWMtYmV6aWVyKDAuMSwgMC44LCAwLjEsIDEpIGZvcndhcmRzOwogICAgICAgICAgICAgICAgICAgIHBvaW50ZXItZXZlbnRzOiBub25lOwogICAgICAgICAgICAgICAgICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLm1vZGFsLW92ZXJsYXkgewogICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiAwOyBsZWZ0OiAwOyB3aWR0aDogMTAwJTsgaGVpZ2h0OiAxMDAlOwogICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6IHJhZGlhbC1ncmFkaWVudChjaXJjbGUgYXQgY2VudGVyLCByZ2JhKDEwLCAyNSwgNjAsIDAuOTUpIDAlLCByZ2JhKDAsIDAsIDAsIDAuOTgpIDEwMCUpOwogICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7IGp1c3RpZnktY29udGVudDogY2VudGVyOyBhbGlnbi1pdGVtczogY2VudGVyOyBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICAgICAgICAgICAgICAgIHotaW5kZXg6IDE5MDA7CiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMDsgcG9pbnRlci1ldmVudHM6IG5vbmU7IHRyYW5zaXRpb246IG9wYWNpdHkgMC44czsKICAgICAgICAgICAgICAgICAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoOHB4KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC5tb2RhbC1vdmVybGF5LmFjdGl2ZSB7IG9wYWNpdHk6IDE7IHBvaW50ZXItZXZlbnRzOiBhdXRvOyB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC5tb2RhbC10aXRsZSB7CiAgICAgICAgICAgICAgICAgICAgZm9udC1mYW1pbHk6ICdHYXJhbW9uZCcsIHNlcmlmOwogICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogNTJweDsgY29sb3I6ICNmZmY7CiAgICAgICAgICAgICAgICAgICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsKICAgICAgICAgICAgICAgICAgICB0ZXh0LXNoYWRvdzogMCAwIDIwcHggIzAwYWFmZiwgMCAwIDQwcHggIzAwNDRhYTsKICAgICAgICAgICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAzMHB4OwogICAgICAgICAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDJweCBzb2xpZCAjMDBhYWZmOwogICAgICAgICAgICAgICAgICAgIHBhZGRpbmctYm90dG9tOiAxMHB4OwogICAgICAgICAgICAgICAgICAgIHdpZHRoOiA4MCU7IHRleHQtYWxpZ246IGNlbnRlcjsKICAgICAgICAgICAgICAgICAgICBsZXR0ZXItc3BhY2luZzogNXB4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAubW9kYWwtc2NvcmUtY29udGFpbmVyIHsKICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBnYXA6IDQwcHg7CiAgICAgICAgICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogNDBweDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC5tb2RhbC1zY29yZSB7CiAgICAgICAgICAgICAgICAgICAgZm9udC1mYW1pbHk6ICdJbXBhY3QnLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogODBweDsgY29sb3I6ICNmZmQ3MDA7CiAgICAgICAgICAgICAgICAgICAgbGV0dGVyLXNwYWNpbmc6IDVweDsKICAgICAgICAgICAgICAgICAgICB0ZXh0LXNoYWRvdzogMCAwIDIwcHggI2I4ODYwYjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC5tb2RhbC12cyB7CiAgICAgICAgICAgICAgICAgICAgZm9udC1mYW1pbHk6ICdDb3VyaWVyIE5ldycsIG1vbm9zcGFjZTsKICAgICAgICAgICAgICAgICAgICBmb250LXNpemU6IDI0cHg7IGNvbG9yOiAjMDBhYWZmOyBvcGFjaXR5OiAwLjc7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLmZsYXNoLW92ZXJsYXkgewogICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiAwOyBsZWZ0OiAwOyB3aWR0aDogMTAwJTsgaGVpZ2h0OiAxMDAlOwogICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6IHdoaXRlOwogICAgICAgICAgICAgICAgICAgIHotaW5kZXg6IDIxMDA7CiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMDsgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbjogb3BhY2l0eSAwLjFzIGVhc2Utb3V0OwogICAgICAgICAgICAgICAgICAgIG1peC1ibGVuZC1tb2RlOiBvdmVybGF5OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIEBrZXlmcmFtZXMgY2xhc2hQb3AgewogICAgICAgICAgICAgICAgICAgIDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSkgc2NhbGUoMC41KTsgb3BhY2l0eTogMTsgfQogICAgICAgICAgICAgICAgICAgIDUwJSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpIHNjYWxlKDEuNSk7IG9wYWNpdHk6IDAuODsgfQogICAgICAgICAgICAgICAgICAgIDEwMCUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKSBzY2FsZSgyLjApOyBvcGFjaXR5OiAwOyB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLmNsYXNoLXNwYXJrIHsKICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDYwcHg7IGhlaWdodDogNjBweDsKICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiByYWRpYWwtZ3JhZGllbnQoY2lyY2xlLCAjZmZmZmZmIDAlLCAjZmZmZjAwIDQwJSwgdHJhbnNwYXJlbnQgNzAlKTsKICAgICAgICAgICAgICAgICAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICAgICAgICAgICAgICAgICAgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgICAgICAgICAgICAgICAgICAgei1pbmRleDogMTUwMDsKICAgICAgICAgICAgICAgICAgICBtaXgtYmxlbmQtbW9kZTogc2NyZWVuOwogICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogY2xhc2hQb3AgMC4zcyBlYXNlLW91dCBmb3J3YXJkczsKICAgICAgICAgICAgICAgICAgICBib3gtc2hhZG93OiAwIDAgMjBweCAjZmZhYTAwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBgOwogICAgICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHN0eWxlKTsKICAgICAgICB9CgogICAgICAgIHJlZ2lzdGVyVGVhbXMoaG9tZVRlYW0sIGF3YXlUZWFtLCBiYWxsKSB7CiAgICAgICAgICAgIHRoaXMudGVhbXMuaG9tZSA9IGhvbWVUZWFtOwogICAgICAgICAgICB0aGlzLnRlYW1zLmF3YXkgPSBhd2F5VGVhbTsKdGhpcy5lbnRpdGllcy5iYWxsID0gYmFsbDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEluaXRpYWxpemUgTWluaU1hcAogICAgICAgICAgICBpZiAodGhpcy5taW5pTWFwKSB7CiAgICAgICAgICAgICAgICB0aGlzLm1pbmlNYXAuaW5pdChob21lVGVhbSwgYXdheVRlYW0sIGJhbGwpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKX2luaXRVSSgpIHsKICAgICAgICAgICAgLy8gQmluZCB0byBleGlzdGluZyBIVE1MIGVsZW1lbnRzCiAgICAgICAgICAgIHRoaXMudWkuc2NvcmVQbGF5ZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NvcmUtcGxheWVyJyk7CiAgICAgICAgICAgIHRoaXMudWkuc2NvcmVDcHUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NvcmUtY3B1Jyk7CiAgICAgICAgICAgIHRoaXMudWkudGltZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGltZXItZGlzcGxheScpOwogICAgICAgICAgICB0aGlzLnVpLmhhbGYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGFsZi1pbmRpY2F0b3InKTsKICAgICAgICAgICAgdGhpcy51aS5hbm5vdW5jZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5ub3VuY2VtZW50Jyk7CiAgICAgICAgICAgIAogICAgICAgICAgICB0aGlzLnVpLnRlY2hGbGFzaCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0ZWNoLWZsYXNoLW92ZXJsYXknKTsKICAgICAgICAgICAgaWYgKHRoaXMudWkudGVjaEZsYXNoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnVpLnRlY2hTdWIgPSB0aGlzLnVpLnRlY2hGbGFzaC5xdWVyeVNlbGVjdG9yKCcudGVjaC1zdWItdGV4dCcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMudWkudGVjaFRpbWVyRmlsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50ZWNoLXRpbWVyLWZpbGwnKTsKCiAgICAgICAgICAgIC8vIEJpbmQgUGxheWVyIFN0YXR1cyBQYW5lbAogICAgICAgICAgICB0aGlzLnVpLnN0YXR1c1BhbmVsLmNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwbGF5ZXItc3RhdHVzLXBhbmVsJyk7CiAgICAgICAgICAgIHRoaXMudWkuc3RhdHVzUGFuZWwubmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwbGF5ZXItc3RhdHVzLXBhbmVsIC5jaGFyLW5hbWUnKTsKICAgICAgICAgICAgdGhpcy51aS5zdGF0dXNQYW5lbC5ocEJhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwbGF5ZXItc3RhdHVzLXBhbmVsIC5ocC1iYXItZmlsbCcpOwogICAgICAgICAgICB0aGlzLnVpLnN0YXR1c1BhbmVsLmhwVGV4dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwbGF5ZXItc3RhdHVzLXBhbmVsIC5ocC12YWx1ZScpOwogICAgICAgICAgICB0aGlzLnVpLnN0YXR1c1BhbmVsLmV4cEJhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwbGF5ZXItc3RhdHVzLXBhbmVsIC50ZWNoLWJhci1maWxsJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBDcmVhdGUgTW9kYWwgT3ZlcmxheQogICAgICAgICAgICB0aGlzLnVpLm1vZGFsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIHRoaXMudWkubW9kYWwuY2xhc3NOYW1lID0gJ21vZGFsLW92ZXJsYXknOwogICAgICAgICAgICB0aGlzLnVpLm1vZGFsLmlubmVySFRNTCA9IGAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1vZGFsLXRpdGxlIj5IQUxGIFRJTUU8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1vZGFsLXNjb3JlLWNvbnRhaW5lciI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibW9kYWwtc2NvcmUiIGlkPSJtb2RhbC1zY29yZS1ob21lIj4wPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibW9kYWwtdnMiPi08L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtb2RhbC1zY29yZSIgaWQ9Im1vZGFsLXNjb3JlLWF3YXkiPjA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBpZD0ibW9kYWwtbXNnIiBzdHlsZT0iY29sb3I6ICMwMGFhZmY7IGZvbnQtc2l6ZTogMTRweDsgbGV0dGVyLXNwYWNpbmc6IDJweDsiPlBSRVBBUklORyAyTkQgSEFMRi4uLjwvZGl2PgogICAgICAgICAgICBgOwogICAgICAgICAgICB0aGlzLnVpTGF5ZXIuYXBwZW5kQ2hpbGQodGhpcy51aS5tb2RhbCk7CgogICAgICAgICAgICAvLyBDcmVhdGUgRmxhc2ggT3ZlcmxheQogICAgICAgICAgICB0aGlzLnVpLmZsYXNoID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIHRoaXMudWkuZmxhc2guY2xhc3NOYW1lID0gJ2ZsYXNoLW92ZXJsYXknOwogICAgICAgICAgICB0aGlzLnVpTGF5ZXIuYXBwZW5kQ2hpbGQodGhpcy51aS5mbGFzaCk7CgogICAgICAgICAgICAvLyBJbml0aWFsIFN0YXRlCiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVNjb3JlVUkoKTsKICAgICAgICAgICAgaWYgKHRoaXMudWkudGltZXIpIHRoaXMudWkudGltZXIuaW5uZXJUZXh0ID0gIjAwOjAwIjsKICAgICAgICB9CiAgICAgICAgX3VwZGF0ZVNjb3JlVUkoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnVpLnNjb3JlUGxheWVyKSB0aGlzLnVpLnNjb3JlUGxheWVyLmlubmVyVGV4dCA9IHRoaXMuc2NvcmUuaG9tZTsKICAgICAgICAgICAgaWYgKHRoaXMudWkuc2NvcmVDcHUpIHRoaXMudWkuc2NvcmVDcHUuaW5uZXJUZXh0ID0gdGhpcy5zY29yZS5hd2F5OwogICAgICAgIH0KCnVwZGF0ZVByYWN0aWNlKGR0KSB7CiAgICAgICAgICAgIC8vIERlbGVnYXRlIGxvZ2ljIHRvIFByYWN0aWNlTWFuYWdlcgogICAgICAgICAgICBpZiAodGhpcy5wcmFjdGljZU1hbmFnZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMucHJhY3RpY2VNYW5hZ2VyLnVwZGF0ZShkdCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHVwZGF0ZShkdCkgewogICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSA9PT0gJ21lbnUnKSB7CiAgICAgICAgICAgICAgICAvLyBNZW51IEJhY2tncm91bmQgTG9naWMgKENhbWVyYSBPcmJpdCkKICAgICAgICAgICAgICAgIGlmICh0aGlzLmNhbWVyYU1hbmFnZXIpIHsKICAgICAgICAgICAgICAgICAgICAvLyBTbG93IG9yYml0IGFyb3VuZCBjZW50ZXIKICAgICAgICAgICAgICAgICAgICBjb25zdCB0aW1lID0gRGF0ZS5ub3coKSAqIDAuMDAwMTsKICAgICAgICAgICAgICAgICAgICBjb25zdCByYWRpdXMgPSA0MDsKICAgICAgICAgICAgICAgICAgICBjb25zdCB4ID0gTWF0aC5zaW4odGltZSkgKiByYWRpdXM7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgeiA9IE1hdGguY29zKHRpbWUpICogcmFkaXVzOwogICAgICAgICAgICAgICAgICAgIC8vIE5vdGU6IENhbWVyYU1hbmFnZXIgdXBkYXRlIGlzIHNraXBwZWQgaW4gbWFpbi5qcyBpZiBzdGF0ZSBpcyBtZW51CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlID09PSAnYWN0aXZlJykgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZU1vZGUgPT09ICdwcmFjdGljZScpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVByYWN0aWNlKGR0KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50aW1lICs9IGR0OwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVRpbWVyKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2hlY2tIYWxmVGltZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuX2NoZWNrR29hbHMoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKHRoaXMubWluaU1hcCkgdGhpcy5taW5pTWFwLnVwZGF0ZSgpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuZmxvYXRpbmdUZXh0KSB0aGlzLmZsb2F0aW5nVGV4dC51cGRhdGUoZHQpOwppZiAodGhpcy5wYXJ0aWNsZU1hbmFnZXIpIHRoaXMucGFydGljbGVNYW5hZ2VyLnVwZGF0ZShkdCk7CiAgICAgICAgICAgICAgICAvLyBHbHlwaE1hbmFnZXIgdXBkYXRlZCBieSBtYWluLmpzCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBUZWNoY29weSBXaW5kb3cKICAgICAgICAgICAgICAgIGlmICh0aGlzLnRlY2hDb3B5U3RhdGUuYWN0aXZlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50ZWNoQ29weVN0YXRlLnRpbWVyIC09IGR0OwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBVSSBCYXIKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy51aS50ZWNoVGltZXJGaWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBjdCA9IE1hdGgubWF4KDAsICh0aGlzLnRlY2hDb3B5U3RhdGUudGltZXIgLyB0aGlzLnRlY2hDb3B5U3RhdGUubWF4VGltZSkgKiAxMDApOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLnRlY2hUaW1lckZpbGwuc3R5bGUud2lkdGggPSBgJHtwY3R9JWA7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAvLyBDb2xvciBzaGlmdCBiYXNlZCBvbiB1cmdlbmN5CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwY3QgPCAzMCkgdGhpcy51aS50ZWNoVGltZXJGaWxsLnN0eWxlLmJhY2tncm91bmQgPSAnI2ZmMDAwMCc7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgdGhpcy51aS50ZWNoVGltZXJGaWxsLnN0eWxlLmJhY2tncm91bmQgPSAnbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjZmZmZmZmLCAjMDBmZmZmKSc7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50ZWNoQ29weVN0YXRlLnRpbWVyIDw9IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbmRUZWNoQ29weVdpbmRvdyhmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVQYXJ0aWNsZXMoZHQpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuZGVidWdWaXN1YWxpemVyKSB0aGlzLmRlYnVnVmlzdWFsaXplci51cGRhdGUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAgICAgCgoKX3VwZGF0ZVRpbWVyKCkgewogICAgICAgICAgICBpZiAoIXRoaXMudWkudGltZXIpIHJldHVybjsKICAgICAgICAgICAgLy8gQ2xhbXAgdG8gaGFsZiBkdXJhdGlvbiBmb3IgZGlzcGxheSBpZiB3ZSBnbyBzbGlnaHRseSBvdmVyIGJlZm9yZSB0aWNrCiAgICAgICAgICAgIGNvbnN0IHQgPSBNYXRoLm1pbih0aGlzLnRpbWUsIHRoaXMuaGFsZkR1cmF0aW9uKTsKICAgICAgICAgICAgY29uc3QgbWludXRlcyA9IE1hdGguZmxvb3IodCAvIDYwKTsKICAgICAgICAgICAgY29uc3Qgc2Vjb25kcyA9IE1hdGguZmxvb3IodCAlIDYwKTsKICAgICAgICAgICAgdGhpcy51aS50aW1lci5pbm5lclRleHQgPSBgJHttaW51dGVzLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX06JHtzZWNvbmRzLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX1gOwogICAgICAgIH0KICAgICAgICBfY2hlY2tIYWxmVGltZSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMudGltZSA+PSB0aGlzLmhhbGZEdXJhdGlvbikgewogICAgICAgICAgICAgICAgdGhpcy5lbmRIYWxmKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgplbmRIYWxmKCkgewogICAgICAgICAgICB0aGlzLnN0YXRlID0gJ2hhbGZ0aW1lJzsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh0aGlzLmhhbGYgPT09IDEpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3Nob3dNb2RhbCgiSEFMRiBUSU1FIiwgIlBSRVBBUklORyAyTkQgSEFMRi4uLiIpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faGlkZU1vZGFsKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGFydFNlY29uZEhhbGYoKTsKICAgICAgICAgICAgICAgIH0sIDQwMDApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gRW5kIG9mIDJuZCBIYWxmIG9yIE92ZXJ0aW1lIFBlcmlvZAogICAgICAgICAgICAgICAgaWYgKHRoaXMuc2NvcmUuaG9tZSA9PT0gdGhpcy5zY29yZS5hd2F5KSB7CiAgICAgICAgICAgICAgICAgICAgLy8gVElFRCAtIEdvIHRvIE92ZXJ0aW1lIChHb2xkZW4gR29hbCkKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zaG93TW9kYWwoIk9WRVJUSU1FIiwgIkdPTERFTiBHT0FMIFJVTEUgQUNUSVZFIik7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2hpZGVNb2RhbCgpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0T3ZlcnRpbWUoKTsKICAgICAgICAgICAgICAgICAgICB9LCA0MDAwKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gV2lubmVyIGRlY2lkZWQKICAgICAgICAgICAgICAgICAgICB0aGlzLmVuZEdhbWUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgc3RhcnRTZWNvbmRIYWxmKCkgewogICAgICAgICAgICB0aGlzLmhhbGYgPSAyOwogICAgICAgICAgICB0aGlzLnRpbWUgPSAwOwogICAgICAgICAgICB0aGlzLnVpLmhhbGYuaW5uZXJUZXh0ID0gIjJuZCBIQUxGIjsKICAgICAgICAgICAgdGhpcy5yZXNldFJvdW5kKG51bGwpOyAvLyBOZXV0cmFsIEJsaXR6LW9mZiBmb3IgMm5kIGhhbGYgc3RhcnQKICAgICAgICB9CgogICAgICAgIHN0YXJ0T3ZlcnRpbWUoKSB7CiAgICAgICAgICAgIHRoaXMuaGFsZisrOwogICAgICAgICAgICB0aGlzLnRpbWUgPSAwOwogICAgICAgICAgICB0aGlzLmlzT3ZlcnRpbWUgPSB0cnVlOwogICAgICAgICAgICB0aGlzLnVpLmhhbGYuaW5uZXJUZXh0ID0gIk9WRVJUSU1FIjsKICAgICAgICAgICAgdGhpcy5yZXNldFJvdW5kKG51bGwpOyAvLyBOZXV0cmFsIEJsaXR6LW9mZgogICAgICAgIH0KCiAgICAgICAgZW5kR2FtZSgpIHsKICAgICAgICAgICAgdGhpcy5zdGF0ZSA9ICdnYW1lb3Zlcic7CiAgICAgICAgICAgIGxldCBtc2cgPSAiRFJBVyI7CiAgICAgICAgICAgIGlmICh0aGlzLnNjb3JlLmhvbWUgPiB0aGlzLnNjb3JlLmF3YXkpIG1zZyA9ICJWSUNUT1JZIjsKICAgICAgICAgICAgaWYgKHRoaXMuc2NvcmUuYXdheSA+IHRoaXMuc2NvcmUuaG9tZSkgbXNnID0gIkRFRkVBVCI7CiAgICAgICAgICAgIAp0aGlzLl9zaG93TW9kYWwobXNnLCAiUFJFU1MgUkVGUkVTSCBUTyBQTEFZIEFHQUlOIik7CiAgICAgICAgICAgIC8vIFN0b3AgTXVzaWMgb24gR2FtZSBPdmVyCiAgICAgICAgICAgIGlmICh0aGlzLmF1ZGlvTWFuYWdlcikgewogICAgICAgICAgICAgICAgdGhpcy5hdWRpb01hbmFnZXIuc3RvcEJHTSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIE5vIHJlc2V0LCBqdXN0IHN0b3AuCiAgICAgICAgfQoKICAgICAgICBfc2hvd01vZGFsKHRpdGxlLCBzdWJ0ZXh0KSB7CiAgICAgICAgICAgIGlmICghdGhpcy51aS5tb2RhbCkgcmV0dXJuOwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy51aS5tb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWwtdGl0bGUnKS5pbm5lclRleHQgPSB0aXRsZTsKICAgICAgICAgICAgdGhpcy51aS5tb2RhbC5xdWVyeVNlbGVjdG9yKCcjbW9kYWwtc2NvcmUtaG9tZScpLmlubmVyVGV4dCA9IHRoaXMuc2NvcmUuaG9tZTsKICAgICAgICAgICAgdGhpcy51aS5tb2RhbC5xdWVyeVNlbGVjdG9yKCcjbW9kYWwtc2NvcmUtYXdheScpLmlubmVyVGV4dCA9IHRoaXMuc2NvcmUuYXdheTsKICAgICAgICAgICAgdGhpcy51aS5tb2RhbC5xdWVyeVNlbGVjdG9yKCcjbW9kYWwtbXNnJykuaW5uZXJUZXh0ID0gc3VidGV4dDsKICAgICAgICAgICAgCiAgICAgICAgICAgIHRoaXMudWkubW9kYWwuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBIaWRlIEhVRCBlbGVtZW50cwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaHVkLXRvcCcpLnN0eWxlLm9wYWNpdHkgPSAnMCc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwbGF5ZXItc3RhdHVzLXBhbmVsJykuc3R5bGUub3BhY2l0eSA9ICcwJzsKICAgICAgICB9CgogICAgICAgIF9oaWRlTW9kYWwoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy51aS5tb2RhbCkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLnVpLm1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU2hvdyBIVUQgZWxlbWVudHMKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2h1ZC10b3AnKS5zdHlsZS5vcGFjaXR5ID0gJzEnOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxheWVyLXN0YXR1cy1wYW5lbCcpLnN0eWxlLm9wYWNpdHkgPSAnMSc7CiAgICAgICAgfQoKX2NoZWNrR29hbHMoKSB7CiAgICAgICAgICAgIGNvbnN0IGJhbGwgPSB0aGlzLmVudGl0aWVzLmJhbGw7CiAgICAgICAgICAgIGlmICghYmFsbCB8fCAhYmFsbC5tZXNoKSByZXR1cm47CgogICAgICAgICAgICBjb25zdCBwb3MgPSBiYWxsLm1lc2gucG9zaXRpb247CgogICAgICAgICAgICAvLyBQcmVjaXNlIEdvYWwgRGV0ZWN0aW9uCiAgICAgICAgICAgIC8vIFZpc3VhbCBHb2FsIGlzIGF0IFogPSArLy0gMjguCiAgICAgICAgICAgIC8vIFdlIGRlZmluZSBhICJHb2FsIE1vdXRoIiBib3ggbWF0Y2hpbmcgR29hbGllLmpzIChXaWR0aCAxNCwgSGVpZ2h0IDgpLgovLyBXZSBkZWZpbmUgYSAiR29hbCBNb3V0aCIgYm94IG1hdGNoaW5nIHRoZSB2aXN1YWwgbmV0LgogICAgICAgICAgICAvLyBBcmVuYSBSYWRpdXMgaXMgMzIuIEdvYWwgaXMgcm91Z2hseSAyMm0gd2lkZSwgMThtIGhpZ2guCmNvbnN0IGhhbGZXaWR0aCA9IDE2LjU7IC8vIEluY3JlYXNlZCA1MCUgKHdhcyAxMS4wKQoKICAgICAgICAgICAgY29uc3QgaGFsZkhlaWdodCA9IDEzLjU7IC8vIEluY3JlYXNlZCA1MCUgKHdhcyA5LjApCiAgICAgICAgICAgIGNvbnN0IGdvYWxZT2Zmc2V0ID0gLTIuMjsgLy8gTW92ZWQgZG93biB0byBtYXRjaCB2aXN1YWwgbW9kZWwKICAgICAgICAgICAgY29uc3QgdHJpZ2dlclogPSAyOC4wOyAvLyBUcmlnZ2VyIGF0IHRoZSBhcmVuYSBlZGdlCiAgICAgICAgICAgIGlmIChNYXRoLmFicyhwb3MueikgPiB0cmlnZ2VyWikgewogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBQUkVWRU5UIE9XTiBHT0FMIEJZIENBUlJJRVIgKFVzZXIgUmVxdWVzdCkKICAgICAgICAgICAgICAgIC8vIElmIHRoZSBiYWxsIGlzIGhlbGQgYnkgdGhlIHRlYW0gZGVmZW5kaW5nIHRoaXMgZ29hbCwgZG8gbm90IGNvdW50IGl0LgogICAgICAgICAgICAgICAgaWYgKGJhbGwuaG9sZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gSG9tZSAoU2lkZSAxKSBkZWZlbmRzICtaLiBJZiBwb3MueiA+IDAgKEhvbWUgR29hbCkgYW5kIGhvbGRlciBpcyBIb21lLCBpZ25vcmUuCiAgICAgICAgICAgICAgICAgICAgaWYgKHBvcy56ID4gMCAmJiBiYWxsLmhvbGRlci50ZWFtLnNpZGUgPT09IDEpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAvLyBBd2F5IChTaWRlIC0xKSBkZWZlbmRzIC1aLiBJZiBwb3MueiA8IDAgKEF3YXkgR29hbCkgYW5kIGhvbGRlciBpcyBBd2F5LCBpZ25vcmUuCiAgICAgICAgICAgICAgICAgICAgaWYgKHBvcy56IDwgMCAmJiBiYWxsLmhvbGRlci50ZWFtLnNpZGUgPT09IC0xKSByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gMi4gQ2hlY2sgRnJhbWUgKE11c3QgYmUgd2l0aGluIHdpZHRoL2hlaWdodCkKLy8gMi4gQ2hlY2sgRnJhbWUgKE11c3QgYmUgd2l0aGluIHdpZHRoL2hlaWdodCwgYWNjb3VudGluZyBmb3IgWSBvZmZzZXQpCiAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnMocG9zLngpIDw9IGhhbGZXaWR0aCAmJiBNYXRoLmFicyhwb3MueSAtIGdvYWxZT2Zmc2V0KSA8PSBoYWxmSGVpZ2h0KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBvcy56IDwgMCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdvYWxTY29yZWQoJ2hvbWUnKTsgLy8gSG9tZSBhdHRhY2tzIC1aCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nb2FsU2NvcmVkKCdhd2F5Jyk7IC8vIEF3YXkgYXR0YWNrcyArWgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCmdvYWxTY29yZWQoc2NvcmVyKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSAnYWN0aXZlJykgcmV0dXJuOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gSU1QQUNUIEZSQU1FOiBHT0FMCnRoaXMudHJpZ2dlckltcGFjdCgwLjQsICdzaGF0dGVyJyk7IC8vIE1hc3NpdmUgZnJlZXplIGZvciBnb2FsCiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSAnYWN0aXZlJykgcmV0dXJuOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRVhQIFJFV0FSRDogR29hbAogICAgICAgICAgICAvLyBGaW5kIHdobyBzY29yZWQgKExhc3QgaG9sZGVyIG9mIGJhbGwpCiAgICAgICAgICAgIGNvbnN0IGJhbGwgPSB0aGlzLmVudGl0aWVzLmJhbGw7CiAgICAgICAgICAgIGlmIChiYWxsICYmIGJhbGwubGFzdEhvbGRlciAmJiBiYWxsLmxhc3RIb2xkZXIudGVhbS5pZCA9PT0gc2NvcmVyKSB7CiAgICAgICAgICAgICAgICBiYWxsLmxhc3RIb2xkZXIuZ2FpbkV4cCgxMCk7CiAgICAgICAgICAgICAgICAvLyBPcHRpb25hbDogQXNzaXN0IGxvZ2ljIGNvdWxkIGdvIGhlcmUgKHRyYWNrIGxhc3RIb2xkZXIubGFzdFBhc3Nlcj8pCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSAnZ29hbCc7CiAgICAgICAgICAgIHRoaXMuc2NvcmVbc2NvcmVyXSsrOwogICAgICAgICAgICB0aGlzLl91cGRhdGVTY29yZVVJKCk7CiAgICAgICAgICAgIAovLyAxLiBWSVNDRVJBTCBTSEFLRSAmIFBBUlRJQ0xFUwogICAgICAgICAgICBpZiAodGhpcy5jYW1lcmFNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNhbWVyYU1hbmFnZXIuYWRkU2hha2UoMi4wKTsgLy8gSGVhdnkgc2hha2UKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5wYXJ0aWNsZU1hbmFnZXIgJiYgdGhpcy5lbnRpdGllcy5iYWxsICYmIHRoaXMuZW50aXRpZXMuYmFsbC5tZXNoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBnb2FsUG9zID0gdGhpcy5lbnRpdGllcy5iYWxsLm1lc2gucG9zaXRpb24uY2xvbmUoKTsKICAgICAgICAgICAgICAgIC8vIE1hc3NpdmUgR29hbCBFeHBsb3Npb24KICAgICAgICAgICAgICAgIHRoaXMucGFydGljbGVNYW5hZ2VyLnNwYXduKCdzaG9ja3dhdmUnLCBnb2FsUG9zLCB7IHNjYWxlOiAxNS4wLCBsaWZlOiAwLjggfSk7CiAgICAgICAgICAgICAgICB0aGlzLnBhcnRpY2xlTWFuYWdlci5zcGF3bignZmxhc2gnLCBnb2FsUG9zLCB7IHNjYWxlOiAxMC4wIH0pOwogICAgICAgICAgICAgICAgZm9yKGxldCBpPTA7IGk8MzA7IGkrKykgewogICAgICAgICAgICAgICAgICAgIHRoaXMucGFydGljbGVNYW5hZ2VyLnNwYXduKCdkZWJyaXMnLCBnb2FsUG9zLCB7IHNjYWxlOiAwLjggfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gMi4gU0NSRUVOIEZMQVNICiAgICAgICAgICAgIGlmICh0aGlzLnVpLmZsYXNoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnVpLmZsYXNoLnN0eWxlLm9wYWNpdHkgPSAnMC44JzsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4geyB0aGlzLnVpLmZsYXNoLnN0eWxlLm9wYWNpdHkgPSAnMCc7IH0sIDEwMCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDMuIEdPTERFTiBHT0FMIENIRUNLCiAgICAgICAgICAgIGlmICh0aGlzLmlzT3ZlcnRpbWUpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2hvd0Fubm91bmNlbWVudCgiR09MREVOIEdPQUwhIiwgJ3NsYW0nKTsKICAgICAgICAgICAgICAgIC8vIEVuZCBnYW1lIGFmdGVyIHNob3J0IGRlbGF5CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmVuZEdhbWUoKTsKICAgICAgICAgICAgICAgIH0sIDMwMDApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyA0LiBTTEFNIEFOTk9VTkNFTUVOVCAoTm9ybWFsKQogICAgICAgICAgICB0aGlzLnNob3dBbm5vdW5jZW1lbnQoIkdPQUwhIiwgJ3NsYW0nKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFJlc2V0IHNlcXVlbmNlCiAgICAgICAgICAgIC8vIFNjb3JlZC11cG9uIHRlYW0gZ2V0cyBiYWxsCiAgICAgICAgICAgIGNvbnN0IGxvc2VyID0gc2NvcmVyID09PSAnaG9tZScgPyAnYXdheScgOiAnaG9tZSc7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBGQVNURVIgRkxPVzogUmVkdWNlZCBkZWxheSBmcm9tIDMwMDBtcyB0byAxMjAwbXMKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLnJlc2V0Um91bmQobG9zZXIpOwogICAgICAgICAgICB9LCAyMDAwKTsgLy8gU2xpZ2h0bHkgbG9uZ2VyIHRvIGFwcHJlY2lhdGUgdGhlICJHT0FMIiBzbGFtCiAgICAgICAgfQoKc2hvd0Fubm91bmNlbWVudCh0ZXh0LCB0eXBlID0gJ25vcm1hbCcsIGR1cmF0aW9uID0gMjAwMCkgewogICAgICAgICAgICBjb25zdCBlbCA9IHRoaXMudWkuYW5ub3VuY2VtZW50OwogICAgICAgICAgICBpZiAoIWVsKSByZXR1cm47CgogICAgICAgICAgICAvLyBDbGVhciBwcmV2aW91cyB0aW1lb3V0CiAgICAgICAgICAgIGlmICh0aGlzLl9hbm5vdW5jZVRpbWVvdXQpIHsKICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLl9hbm5vdW5jZVRpbWVvdXQpOwogICAgICAgICAgICAgICAgdGhpcy5fYW5ub3VuY2VUaW1lb3V0ID0gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gUmVzZXQgQW5pbWF0aW9uIGJ5IGNsb25pbmcKICAgICAgICAgICAgY29uc3QgbmV3RWwgPSBlbC5jbG9uZU5vZGUodHJ1ZSk7CiAgICAgICAgICAgIGVsLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKG5ld0VsLCBlbCk7CiAgICAgICAgICAgIHRoaXMudWkuYW5ub3VuY2VtZW50ID0gbmV3RWw7CgogICAgICAgICAgICBuZXdFbC5pbm5lclRleHQgPSB0ZXh0OwogICAgICAgICAgICBuZXdFbC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEFwcGx5IENsYXNzIGJhc2VkIG9uIHR5cGUKICAgICAgICAgICAgbmV3RWwuY2xhc3NOYW1lID0gJyc7IC8vIFJlc2V0IGNsYXNzZXMKICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdzbGFtJykgewogICAgICAgICAgICAgICAgbmV3RWwuY2xhc3NMaXN0LmFkZCgnYW5ub3VuY2VtZW50LXNsYW0nKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIERlZmF1bHQgc3R5bGUKICAgICAgICAgICAgICAgIG5ld0VsLnN0eWxlLmFuaW1hdGlvbiA9ICdub25lJzsKICAgICAgICAgICAgICAgIG5ld0VsLm9mZnNldEhlaWdodDsgLyogdHJpZ2dlciByZWZsb3cgKi8KICAgICAgICAgICAgICAgIG5ld0VsLnN0eWxlLmFuaW1hdGlvbiA9ICdhbm5vdW5jZVNsaWRlIDAuNXMgY3ViaWMtYmV6aWVyKDAuMTc1LCAwLjg4NSwgMC4zMiwgMS4yNzUpJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQXV0by1oaWRlCiAgICAgICAgICAgIGlmIChkdXJhdGlvbiA+IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuX2Fubm91bmNlVGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHRoaXMuaGlkZUFubm91bmNlbWVudCgpOwogICAgICAgICAgICAgICAgfSwgZHVyYXRpb24pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBoaWRlQW5ub3VuY2VtZW50KCkgewogICAgICAgICAgICBpZiAodGhpcy51aS5hbm5vdW5jZW1lbnQpIHsKICAgICAgICAgICAgICAgIHRoaXMudWkuYW5ub3VuY2VtZW50LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgIH0KICAgICAgICB9CgpyZXNldFJvdW5kKHBvc3Nlc3Npb25UZWFtSWQpIHsKICAgICAgICAgICAgdGhpcy5zdGF0ZSA9ICdyZXNldCc7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBSZXNldCBCYWxsCiAgICAgICAgICAgIGlmICh0aGlzLmVudGl0aWVzLmJhbGwpIHRoaXMuZW50aXRpZXMuYmFsbC5yZXNldCgpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gUmVzZXQgVGVhbXMKICAgICAgICAgICAgaWYgKHRoaXMudGVhbXMuaG9tZSkgdGhpcy50ZWFtcy5ob21lLnJlc2V0UG9zaXRpb25zKCk7CiAgICAgICAgICAgIGlmICh0aGlzLnRlYW1zLmF3YXkpIHRoaXMudGVhbXMuYXdheS5yZXNldFBvc2l0aW9ucygpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQ2xlYXIgYmFsbCBob2xkZXIKICAgICAgICAgICAgaWYgKHRoaXMuZW50aXRpZXMuYmFsbCkgdGhpcy5lbnRpdGllcy5iYWxsLmRyb3AoKTsKCiAgICAgICAgICAgIC8vIENSSVRJQ0FMOiBTbmFwIGNhbWVyYSB0byBwcmV2ZW50IGRpc29yaWVudGF0aW9uCiAgICAgICAgICAgIGlmICh0aGlzLmNhbWVyYU1hbmFnZXIpIHsKICAgICAgICAgICAgICAgIC8vIEZvcmNlIHVwZGF0ZSB0YXJnZXQgZmlyc3QgKHVzdWFsbHkgYmFsbCkKICAgICAgICAgICAgICAgIGlmICh0aGlzLmVudGl0aWVzLmJhbGwgJiYgdGhpcy5lbnRpdGllcy5iYWxsLm1lc2gpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbWVyYU1hbmFnZXIuc2V0VGFyZ2V0KHRoaXMuZW50aXRpZXMuYmFsbC5tZXNoLCB0aGlzLmVudGl0aWVzLmJhbGwudmVsb2NpdHkpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuY2FtZXJhTWFuYWdlci5zbmFwVG9UYXJnZXQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRkFTVEVSIEZMT1c6IFJlZHVjZWQgZGVsYXkgZnJvbSAyMDAwbXMgdG8gMTAwbXMKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0S2lja29mZihwb3NzZXNzaW9uVGVhbUlkKTsKfSwgMTAwKTsKICAgICAgICB9CgogICAgICAgIHN0YXJ0S2lja29mZihwb3NzZXNzaW9uVGVhbUlkKSB7CiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSAna2lja29mZic7CiAgICAgICAgICAgIHRoaXMuc2hvd0Fubm91bmNlbWVudCgiQkxJVFogT0ZGISIsICdzbGFtJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBJZiBhIHRlYW0gaGFzIHBvc3Nlc3Npb24gKGFmdGVyIGdvYWwpLCBnaXZlIHRvIE1GCiAgICAgICAgICAgIGlmIChwb3NzZXNzaW9uVGVhbUlkKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0ZWFtID0gdGhpcy50ZWFtc1twb3NzZXNzaW9uVGVhbUlkXTsKICAgICAgICAgICAgICAgIGlmICh0ZWFtKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWYgPSB0ZWFtLnBsYXllcnMuZmluZChwID0+IHAucm9sZSA9PT0gJ01GJyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG1mICYmIHRoaXMuZW50aXRpZXMuYmFsbCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVudGl0aWVzLmJhbGwuZ3JhYihtZik7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAvLyBDUklUSUNBTDogU25hcCBjYW1lcmEgdG8gbmV3IGhvbGRlciB0byBwcmV2ZW50IHN3aW5nL2Rpc29yaWVudGF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNhbWVyYU1hbmFnZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FtZXJhTWFuYWdlci5zZXRUYXJnZXQobWYubWVzaCwgbWYudmVsb2NpdHkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYW1lcmFNYW5hZ2VyLnNuYXBUb1RhcmdldCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gTmV1dHJhbCBraWNrb2ZmIC0gZW5zdXJlIGNhbWVyYSBpcyBzbmFwcGVkIHRvIGNlbnRlciBiYWxsCiAgICAgICAgICAgICAgICBpZiAodGhpcy5jYW1lcmFNYW5hZ2VyICYmIHRoaXMuZW50aXRpZXMuYmFsbCAmJiB0aGlzLmVudGl0aWVzLmJhbGwubWVzaCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY2FtZXJhTWFuYWdlci5zZXRUYXJnZXQodGhpcy5lbnRpdGllcy5iYWxsLm1lc2gsIHRoaXMuZW50aXRpZXMuYmFsbC52ZWxvY2l0eSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYW1lcmFNYW5hZ2VyLnNuYXBUb1RhcmdldCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBGQVNURVIgRkxPVzogUmVkdWNlZCBkZWxheSBmcm9tIDEwMDBtcyB0byA4MDBtcwogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuaGlkZUFubm91bmNlbWVudCgpOwogICAgICAgICAgICAgICAgdGhpcy5zdGF0ZSA9ICdhY3RpdmUnOwogICAgICAgICAgICB9LCA4MDApOwogICAgICAgIH0KICAgICAgICAKLy8gSW5pdGlhbCBzdGFydAogICAgICAgIHN0YXJ0TWF0Y2gobW9kZSA9ICdub3JtYWwnKSB7CiAgICAgICAgICAgIHRoaXMuZ2FtZU1vZGUgPSBtb2RlOwogICAgICAgICAgICBjb25zb2xlLmxvZygiU3RhcnRpbmcgTWF0Y2ggaW4gbW9kZToiLCBtb2RlKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFN0YXJ0IE11c2ljCiAgICAgICAgICAgIGlmICh0aGlzLmF1ZGlvTWFuYWdlcikgewogICAgICAgICAgICAgICAgdGhpcy5hdWRpb01hbmFnZXIucGxheUJHTSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBSZXNldCBTY29yZQp0aGlzLnNjb3JlLmhvbWUgPSAwOwogICAgICAgICAgICB0aGlzLnNjb3JlLmF3YXkgPSAwOwogICAgICAgICAgICB0aGlzLl91cGRhdGVTY29yZVVJKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBSZXNldCBUaW1lCiAgICAgICAgICAgIHRoaXMudGltZSA9IDA7CiAgICAgICAgICAgIHRoaXMuaGFsZiA9IDE7CiAgICAgICAgICAgIGlmICh0aGlzLnVpLmhhbGYpIHRoaXMudWkuaGFsZi5pbm5lclRleHQgPSAiMXN0IjsKICAgICAgICAgICAgCmlmIChtb2RlID09PSAncHJhY3RpY2UnKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy51aS5oYWxmKSB0aGlzLnVpLmhhbGYuaW5uZXJUZXh0ID0gIlBSQUMiOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBTdGFydCBQcmFjdGljZSBNYW5hZ2VyCiAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmFjdGljZU1hbmFnZXIpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnByYWN0aWNlTWFuYWdlci5zdGFydCgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIEluIHByYWN0aWNlLCBlbnN1cmUgQUkgaXMgZW5hYmxlZCBmb3Igc3BhcnJpbmcKICAgICAgICAgICAgICAgIGlmICh0aGlzLnRlYW1zLmF3YXkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRlYW1zLmF3YXkuYWlFbmFibGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKCiAgICAgICAgICAgICAgICAvLyBFbnN1cmUgUHJhY3RpY2UgTWFuYWdlciBpcyBzdG9wcGVkIGlmIG5vcm1hbCBnYW1lCiAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmFjdGljZU1hbmFnZXIpIHRoaXMucHJhY3RpY2VNYW5hZ2VyLnN0b3AoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gU2FmZXR5OiBFbnN1cmUgYWxsIHBsYXllcnMgYXJlIHZpc2libGUgKGluIGNhc2UgUHJhY3RpY2UgaGlkIHRoZW0pCiAgICAgICAgICAgICAgICAvLyBBbmQgRk9SQ0UgQUkgRU5BQkxFRCAoRml4IGZvciAiWm9tYmllcyIgaWYgY29taW5nIGZyb20gUHJhY3RpY2UgTW9kZSkKICAgICAgICAgICAgICAgIGlmICh0aGlzLnRlYW1zLmF3YXkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRlYW1zLmF3YXkucGxheWVycy5mb3JFYWNoKHAgPT4geyBpZihwLm1lc2gpIHAubWVzaC52aXNpYmxlID0gdHJ1ZTsgfSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50ZWFtcy5hd2F5LmFpRW5hYmxlZCA9IHRydWU7IAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMudGVhbXMuaG9tZSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMudGVhbXMuaG9tZS5wbGF5ZXJzLmZvckVhY2gocCA9PiB7IGlmKHAubWVzaCkgcC5tZXNoLnZpc2libGUgPSB0cnVlOyB9KTsKICAgICAgICAgICAgICAgIH0KCnRoaXMucmVzZXRSb3VuZCgpOwogICAgICAgICAgICB9Cn0KCnNldE1lbnVNb2RlKGlzQWN0aXZlKSB7CiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSBpc0FjdGl2ZSA/ICdtZW51JyA6ICdhY3RpdmUnOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGlzQWN0aXZlICYmIHRoaXMuYXVkaW9NYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICB0aGlzLmF1ZGlvTWFuYWdlci5zdG9wQkdNKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEhpZGUgSFVEIGluIG1lbnUKICAgICAgICAgICAgY29uc3QgaHVkVG9wID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2h1ZC10b3AnKTsKICAgICAgICAgICAgY29uc3Qgc3RhdHVzUGFuZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxheWVyLXN0YXR1cy1wYW5lbCcpOwogICAgICAgICAgICBjb25zdCBjb250cm9scyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY3Rpb24tY29udGFpbmVyJyk7CiAgICAgICAgICAgIGNvbnN0IGpveXN0aWNrID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pveXN0aWNrLWhpdC16b25lJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBkaXNwbGF5ID0gaXNBY3RpdmUgPyAnbm9uZScgOiAnZmxleCc7IC8vIG9yIGJsb2NrL2V0YwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGh1ZFRvcCkgaHVkVG9wLnN0eWxlLmRpc3BsYXkgPSBkaXNwbGF5OwogICAgICAgICAgICBpZiAoc3RhdHVzUGFuZWwpIHN0YXR1c1BhbmVsLnN0eWxlLmRpc3BsYXkgPSBpc0FjdGl2ZSA/ICdub25lJyA6ICdibG9jayc7IC8vIFN0YXR1cyBwYW5lbCBoYXMgc3BlY2lmaWMgbG9naWMKICAgICAgICAgICAgaWYgKGNvbnRyb2xzKSBjb250cm9scy5zdHlsZS5kaXNwbGF5ID0gaXNBY3RpdmUgPyAnbm9uZScgOiAnZmxleCc7CiAgICAgICAgICAgIGlmIChqb3lzdGljaykgam95c3RpY2suc3R5bGUuZGlzcGxheSA9IGlzQWN0aXZlID8gJ25vbmUnIDogJ2Jsb2NrJzsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIElmIGVudGVyaW5nIG1lbnUsIHJlc2V0IGNhbWVyYSB0byBhIG5pY2UgYW5nbGU/CiAgICAgICAgICAgIC8vIEhhbmRsZWQgYnkgdXBkYXRlIGxvb3AKICAgICAgICB9CnRvZ2dsZURlbW9Nb2RlKCkgewogICAgICAgICAgICB0aGlzLmlzRGVtb01vZGUgPSAhdGhpcy5pc0RlbW9Nb2RlOwogICAgICAgICAgICBjb25zb2xlLmxvZygiRGVtbyBNb2RlOiIsIHRoaXMuaXNEZW1vTW9kZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBVcGRhdGUgVUkgQnV0dG9uCiAgICAgICAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhdXRvLXRvZ2dsZScpOwogICAgICAgICAgICBpZiAoYnRuKSB7CiAgICAgICAgICAgICAgICBidG4uaW5uZXJUZXh0ID0gdGhpcy5pc0RlbW9Nb2RlID8gIkFVVE8gUElMT1QiIDogIk1BTlVBTCI7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0RlbW9Nb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgYnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBidG4uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEFubm91bmNlbWVudAogICAgICAgICAgICBjb25zdCB0ZXh0ID0gdGhpcy5pc0RlbW9Nb2RlID8gIkFVVE8gUElMT1QiIDogIk1BTlVBTCI7CiAgICAgICAgICAgIHRoaXMuc2hvd0Fubm91bmNlbWVudCh0ZXh0KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFZpc3VhbCBGbGFpcjogU3Bhd24gdGV4dCBhYm92ZSBhY3RpdmUgcGxheWVyCiAgICAgICAgICAgIGlmICh0aGlzLmlzRGVtb01vZGUgJiYgdGhpcy5mbG9hdGluZ1RleHQgJiYgdGhpcy50ZWFtcy5ob21lICYmIHRoaXMudGVhbXMuaG9tZS5hY3RpdmVQbGF5ZXIgJiYgdGhpcy50ZWFtcy5ob21lLmFjdGl2ZVBsYXllci5tZXNoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmZsb2F0aW5nVGV4dC5zcGF3bigiQUkgRU5HQUdFRCIsIHRoaXMudGVhbXMuaG9tZS5hY3RpdmVQbGF5ZXIubWVzaC5wb3NpdGlvbiwgImdvYWwiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQXV0by1oaWRlIGFubm91bmNlbWVudApzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnVpLmFubm91bmNlbWVudCAmJiB0aGlzLnVpLmFubm91bmNlbWVudC5pbm5lclRleHQgPT09IHRleHQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmhpZGVBbm5vdW5jZW1lbnQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0gVEVDSENPUFkgU1lTVEVNIC0tLQoKICAgICAgICB0cmlnZ2VyVGVjaEV2ZW50KHNvdXJjZVBsYXllciwgdGVjaE5hbWUpIHsKICAgICAgICAgICAgaWYgKCFzb3VyY2VQbGF5ZXIgfHwgIXNvdXJjZVBsYXllci50ZWFtKSByZXR1cm47CgogICAgICAgICAgICAvLyBGaW5kIG9wcG9zaW5nIHRlYW0KICAgICAgICAgICAgY29uc3Qgb3BwVGVhbUlkID0gc291cmNlUGxheWVyLnRlYW0uaWQgPT09ICdob21lJyA/ICdhd2F5JyA6ICdob21lJzsKICAgICAgICAgICAgY29uc3Qgb3BwVGVhbSA9IHRoaXMudGVhbXNbb3BwVGVhbUlkXTsKICAgICAgICAgICAgaWYgKCFvcHBUZWFtKSByZXR1cm47CgogICAgICAgICAgICAvLyBGaW5kIHdobyBpcyBtYXJraW5nIHRoaXMgc291cmNlCiAgICAgICAgICAgIGNvbnN0IGxlYXJuZXJzID0gb3BwVGVhbS5wbGF5ZXJzLmZpbHRlcihwID0+IHAubWFya2luZyA9PT0gc291cmNlUGxheWVyKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChsZWFybmVycy5sZW5ndGggPT09IDApIHJldHVybjsKCiAgICAgICAgICAgIC8vIE9ubHkgc2hvdyBVSSBpZiB0aGUgbGVhcm5pbmcgdGVhbSBpcyBIdW1hbiAoSG9tZSkKICAgICAgICAgICAgLy8gKE9yIGlmIHdlIGFyZSBpbiBEZW1vIG1vZGUgYW5kIHdhbnQgdG8gc2VlIGl0IGhhcHBlbiBmb3IgSG9tZSB0ZWFtKQogICAgICAgICAgICBpZiAob3BwVGVhbS5pc0h1bWFuKSB7CiAgICAgICAgICAgICAgICAvLyBGaWx0ZXIgb3V0IHRob3NlIHdobyBhbHJlYWR5IGtub3cgaXQKICAgICAgICAgICAgICAgIGNvbnN0IHZhbGlkTGVhcm5lcnMgPSBsZWFybmVycy5maWx0ZXIocCA9PiAhcC5sZWFybmVkVGVjaHMuaW5jbHVkZXModGVjaE5hbWUpKTsKICAgICAgICAgICAgICAgIGlmICh2YWxpZExlYXJuZXJzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0VGVjaENvcHlXaW5kb3codGVjaE5hbWUsIHZhbGlkTGVhcm5lcnMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKc3RhcnRUZWNoQ29weVdpbmRvdyh0ZWNoTmFtZSwgbGVhcm5lcnMpIHsKICAgICAgICAgICAgdGhpcy50ZWNoQ29weVN0YXRlLmFjdGl2ZSA9IHRydWU7CiAgICAgICAgICAgIHRoaXMudGVjaENvcHlTdGF0ZS5tYXhUaW1lID0gMC42OyAvLyAwLjZzIHdpbmRvdwogICAgICAgICAgICB0aGlzLnRlY2hDb3B5U3RhdGUudGltZXIgPSB0aGlzLnRlY2hDb3B5U3RhdGUubWF4VGltZTsKICAgICAgICAgICAgdGhpcy50ZWNoQ29weVN0YXRlLnRlY2ggPSB0ZWNoTmFtZTsKICAgICAgICAgICAgdGhpcy50ZWNoQ29weVN0YXRlLmxlYXJuZXJzID0gbGVhcm5lcnM7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTaG93IFVJCiAgICAgICAgICAgIGlmICh0aGlzLnVpLnRlY2hGbGFzaCkgewogICAgICAgICAgICAgICAgdGhpcy51aS50ZWNoRmxhc2guc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgICAgICAgICAgICAgIHRoaXMudWkudGVjaEZsYXNoLnN0eWxlLmJhY2tncm91bmQgPSAiIjsgLy8gUmVzZXQgYmFja2dyb3VuZAogICAgICAgICAgICAgICAgdGhpcy51aS50ZWNoRmxhc2gucXVlcnlTZWxlY3RvcignLnRlY2gtdGV4dCcpLmlubmVyVGV4dCA9ICJURUNIQ09QWSEiOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAodGhpcy51aS50ZWNoU3ViKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy51aS50ZWNoU3ViLmlubmVyVGV4dCA9IHRlY2hOYW1lLnJlcGxhY2UoJ18nLCAnICcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBSZXNldCBiYXIKICAgICAgICAgICAgICAgIGlmICh0aGlzLnVpLnRlY2hUaW1lckZpbGwpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLnRlY2hUaW1lckZpbGwuc3R5bGUud2lkdGggPSAnMTAwJSc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgphdHRlbXB0VGVjaENvcHkoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy50ZWNoQ29weVN0YXRlLmFjdGl2ZSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU3VjY2VzcyEKICAgICAgICAgICAgY29uc3QgdGVjaCA9IHRoaXMudGVjaENvcHlTdGF0ZS50ZWNoOwogICAgICAgICAgICBjb25zdCBsZWFybmVycyA9IHRoaXMudGVjaENvcHlTdGF0ZS5sZWFybmVyczsKICAgICAgICAgICAgCiAgICAgICAgICAgIGxlYXJuZXJzLmZvckVhY2gocCA9PiB7CiAgICAgICAgICAgICAgICAvLyBEb3VibGUgY2hlY2sgdG8gcHJldmVudCBkdXBsaWNhdGVzCiAgICAgICAgICAgICAgICBpZiAoIXAubGVhcm5lZFRlY2hzLmluY2x1ZGVzKHRlY2gpKSB7CiAgICAgICAgICAgICAgICAgICAgcC5sZWFybmVkVGVjaHMucHVzaCh0ZWNoKTsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgJHtwLnJvbGV9IGxlYXJuZWQgJHt0ZWNofSFgKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyAxLiBGbG9hdGluZyBUZXh0CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZmxvYXRpbmdUZXh0ICYmIHAubWVzaCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZsb2F0aW5nVGV4dC5zcGF3bihgTEVBUk5FRCFgLCBwLm1lc2gucG9zaXRpb24sICJ0ZWNoIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIDIuIFBhcnRpY2xlIEVmZmVjdCAoU3BpcmFsKQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnBhcnRpY2xlTWFuYWdlciAmJiBwLm1lc2gpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3Bhd24gbXVsdGlwbGUgcGFydGljbGVzIGZvciBhIHN3aXJsIGVmZmVjdAogICAgICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTwxMDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcnRpY2xlTWFuYWdlci5zcGF3bignbGVhcm5lZCcsIHAubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBpICogNTApOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHRoaXMuZW5kVGVjaENvcHlXaW5kb3codHJ1ZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCmVuZFRlY2hDb3B5V2luZG93KHN1Y2Nlc3MpIHsKICAgICAgICAgICAgdGhpcy50ZWNoQ29weVN0YXRlLmFjdGl2ZSA9IGZhbHNlOwogICAgICAgICAgICBpZiAodGhpcy51aS50ZWNoRmxhc2gpIHsKICAgICAgICAgICAgICAgIGlmIChzdWNjZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy51aS50ZWNoRmxhc2gucXVlcnlTZWxlY3RvcignLnRlY2gtdGV4dCcpLmlubmVyVGV4dCA9ICJTVUNDRVNTISI7CiAgICAgICAgICAgICAgICAgICAgLy8gRmxhc2ggc3VjY2VzcyBjb2xvciAoV2hpdGUgZmxhc2gpCiAgICAgICAgICAgICAgICAgICAgdGhpcy51aS50ZWNoRmxhc2guc3R5bGUuYmFja2dyb3VuZCA9ICJyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuOCkiOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEhpZGUgYWZ0ZXIgc2hvcnQgZGVsYXkgdG8gc2hvdyB0aGUgc3VjY2VzcyBmbGFzaAogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4geyAKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS50ZWNoRmxhc2guc3R5bGUuZGlzcGxheSA9ICdub25lJzsgCiAgICAgICAgICAgICAgICAgICAgfSwgMzAwKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gRmFpbGVkIC8gTWlzc2VkCiAgICAgICAgICAgICAgICAgICAgdGhpcy51aS50ZWNoRmxhc2guc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KX3VwZGF0ZVBsYXllclN0YXR1c1VJKCkgewogICAgICAgICAgICBpZiAoIXRoaXMudGVhbXMuaG9tZSB8fCAhdGhpcy50ZWFtcy5ob21lLmFjdGl2ZVBsYXllcikgcmV0dXJuOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgcCA9IHRoaXMudGVhbXMuaG9tZS5hY3RpdmVQbGF5ZXI7CiAgICAgICAgICAgIGNvbnN0IHVpID0gdGhpcy51aS5zdGF0dXNQYW5lbDsKICAgICAgICAgICAgCi8vIFVJIFVwZGF0ZXMgKEFjdGlvbiBCdXR0b24gQ29udGV4dCkKICAgICAgICAgICAgICAgIHVpLmNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gTmFtZSAmIExldmVsCiAgICAgICAgICAgICAgICBpZiAodWkubmFtZSkgdWkubmFtZS5pbm5lclRleHQgPSBgJHtwLmNoYXJhY3Rlck5hbWUgfHwgcC5yb2xlfSBMViR7cC5sZXZlbH1gOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBIUAogICAgICAgICAgICAgICAgaWYgKHVpLmhwQmFyKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaHBQY3QgPSBNYXRoLm1heCgwLCBNYXRoLm1pbigxMDAsIChwLnN0YXRzLkhQIC8gcC5zdGF0cy5tYXhIUCkgKiAxMDApKTsKICAgICAgICAgICAgICAgICAgICB1aS5ocEJhci5zdHlsZS53aWR0aCA9IGAke2hwUGN0fSVgOwogICAgICAgICAgICAgICAgICAgIC8vIENvbG9yIHNoaWZ0CiAgICAgICAgICAgICAgICAgICAgaWYgKGhwUGN0IDwgMjUpIHVpLmhwQmFyLnN0eWxlLmJhY2tncm91bmQgPSAnbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjZmYwMDAwLCAjZmY0NDQ0KSc7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoaHBQY3QgPCA1MCkgdWkuaHBCYXIuc3R5bGUuYmFja2dyb3VuZCA9ICdsaW5lYXItZ3JhZGllbnQoOTBkZWcsICNmZmZmMDAsICNmZmZmODgpJzsKICAgICAgICAgICAgICAgICAgICBlbHNlIHVpLmhwQmFyLnN0eWxlLmJhY2tncm91bmQgPSAnbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjMDBmZjAwLCAjY2NmZmNjKSc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodWkuaHBUZXh0KSB1aS5ocFRleHQuaW5uZXJUZXh0ID0gYCR7TWF0aC5mbG9vcihwLnN0YXRzLkhQKX0vJHtwLnN0YXRzLm1heEhQfWA7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEVYUAogICAgICAgICAgICAgICAgaWYgKHVpLmV4cEJhcikgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4cFBjdCA9IE1hdGgubWF4KDAsIE1hdGgubWluKDEwMCwgKHAuZXhwIC8gcC5uZXh0TGV2ZWxFeHApICogMTAwKSk7CiAgICAgICAgICAgICAgICAgICAgdWkuZXhwQmFyLnN0eWxlLndpZHRoID0gYCR7ZXhwUGN0fSVgOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9Cl9pbml0UGFydGljbGVzKCkgewogICAgICAgICAgICB0aGlzLnNwYXJrUG9vbCA9IFtdOwogICAgICAgICAgICB0aGlzLmFjdGl2ZVNwYXJrcyA9IFtdOwogICAgICAgICAgICBjb25zdCBwb29sU2l6ZSA9IDQwOyAvLyBTdWZmaWNpZW50IGZvciBjb250aW51b3VzIGdyaW5kaW5nCiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBvb2xTaXplOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNwcml0ZSA9IG5ldyBUSFJFRS5TcHJpdGUoX3NwYXJrTWF0ZXJpYWwuY2xvbmUoKSk7CiAgICAgICAgICAgICAgICBzcHJpdGUudmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5zY2VuZS5hZGQoc3ByaXRlKTsKICAgICAgICAgICAgICAgIHRoaXMuc3BhcmtQb29sLnB1c2goc3ByaXRlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgc3Bhd25DbGFzaChwb3MsIGludGVuc2l0eSA9IDEuMCkgewogICAgICAgICAgICAvLyBGaW5kIGZyZWUgc3BhcmsKICAgICAgICAgICAgY29uc3Qgc3BhcmsgPSB0aGlzLnNwYXJrUG9vbC5maW5kKHMgPT4gIXMudmlzaWJsZSk7CiAgICAgICAgICAgIGlmICghc3BhcmspIHJldHVybjsgLy8gUG9vbCBleGhhdXN0ZWQKICAgICAgICAgICAgCiAgICAgICAgICAgIHNwYXJrLnBvc2l0aW9uLmNvcHkocG9zKTsKICAgICAgICAgICAgc3BhcmsudmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBSYW5kb21pemUgcm90YXRpb24KICAgICAgICAgICAgc3BhcmsubWF0ZXJpYWwucm90YXRpb24gPSBNYXRoLnJhbmRvbSgpICogTWF0aC5QSTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEluaXRpYWxpemUgQWN0aXZlIFN0YXRlCiAgICAgICAgICAgIHRoaXMuYWN0aXZlU3BhcmtzLnB1c2goewogICAgICAgICAgICAgICAgbWVzaDogc3BhcmssCiAgICAgICAgICAgICAgICBhZ2U6IDAsCiAgICAgICAgICAgICAgICBsaWZlOiAwLjE1ICsgTWF0aC5yYW5kb20oKSAqIDAuMTUsIC8vIEZhc3QsIHB1bmNoeSBzcGFya3MKICAgICAgICAgICAgICAgIG1heFNjYWxlOiAyLjUgKiBpbnRlbnNpdHksCiAgICAgICAgICAgICAgICB2ZWxvY2l0eTogbmV3IFRIUkVFLlZlY3RvcjMoCiAgICAgICAgICAgICAgICAgICAgKE1hdGgucmFuZG9tKCktMC41KSo4LCAKICAgICAgICAgICAgICAgICAgICAoTWF0aC5yYW5kb20oKS0wLjUpKjgsIAogICAgICAgICAgICAgICAgICAgIChNYXRoLnJhbmRvbSgpLTAuNSkqOAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIF91cGRhdGVQYXJ0aWNsZXMoZHQpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IHRoaXMuYWN0aXZlU3BhcmtzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwID0gdGhpcy5hY3RpdmVTcGFya3NbaV07CiAgICAgICAgICAgICAgICBwLmFnZSArPSBkdDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKHAuYWdlID49IHAubGlmZSkgewogICAgICAgICAgICAgICAgICAgIHAubWVzaC52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVTcGFya3Muc3BsaWNlKGksIDEpOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCB0ID0gcC5hZ2UgLyBwLmxpZmU7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEV4cGFuZAogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFNjYWxlID0gMC41ICsgKHAubWF4U2NhbGUgLSAwLjUpICogdDsKICAgICAgICAgICAgICAgIHAubWVzaC5zY2FsZS5zZXRTY2FsYXIoY3VycmVudFNjYWxlKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRmFkZSBvdXQKICAgICAgICAgICAgICAgIHAubWVzaC5tYXRlcmlhbC5vcGFjaXR5ID0gMS4wIC0gKHQgKiB0KTsgLy8gUXVhZHJhdGljIGZhZGUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gTW92ZQogICAgICAgICAgICAgICAgcC5tZXNoLnBvc2l0aW9uLmFkZFNjYWxlZFZlY3RvcihwLnZlbG9jaXR5LCBkdCk7CiAgICAgICAgICAgICAgICBwLm1lc2gubWF0ZXJpYWwucm90YXRpb24gKz0gMTAuMCAqIGR0OwogICAgICAgICAgICB9CiAgICAgICAgfQoKLy8gSGVscGVyIGZvciBpbXBhY3QgZnJhbWVzCgp0cmlnZ2VySW1wYWN0KGR1cmF0aW9uLCB0eXBlID0gJ2RlZmF1bHQnKSB7CiAgICAgICAgICAgIHRoaXMuaW1wYWN0UGF1c2UgPSBkdXJhdGlvbjsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYW1lLWNvbnRhaW5lcicpOwogICAgICAgICAgICBpZiAoIWNvbnRhaW5lcikgcmV0dXJuOwoKICAgICAgICAgICAgLy8gUmVzZXQgY2xhc3NlcyB0byBlbnN1cmUgYW5pbWF0aW9uIHJlc3RhcnRzCiAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdpbXBhY3QtZngnLCAnaW1wYWN0LWhlYXZ5JywgJ2ltcGFjdC1zaGF0dGVyJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBGb3JjZSByZWZsb3cKICAgICAgICAgICAgdm9pZCBjb250YWluZXIub2Zmc2V0V2lkdGg7CgogICAgICAgICAgICBsZXQgY2xhc3NOYW1lID0gJ2ltcGFjdC1meCc7CiAgICAgICAgICAgIGlmICh0eXBlID09PSAnaGVhdnknKSBjbGFzc05hbWUgPSAnaW1wYWN0LWhlYXZ5JzsKICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdzaGF0dGVyJykgY2xhc3NOYW1lID0gJ2ltcGFjdC1zaGF0dGVyJzsKCiAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKGNsYXNzTmFtZSk7CgogICAgICAgICAgICAvLyBBdXRvLXJlbW92ZSBjbGFzcyBhZnRlciBkdXJhdGlvbgogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKGNsYXNzTmFtZSk7CiAgICAgICAgICAgIH0sIGR1cmF0aW9uICogMTAwMCArIDEwMCk7CiAgICAgICAgfQogICAgfQoKICAgIHdpbmRvdy5mbHV4LkdhbWVNYW5hZ2VyID0gR2FtZU1hbmFnZXI7Cn0pKCk7","./GameManager.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCi8vIFNwYXJrIFRleHR1cmUgKFByb2NlZHVyYWwgQnVyc3QpCiAgICBjb25zdCBfc3BhcmtUZXh0dXJlID0gKCgpID0+IHsKICAgICAgICBjb25zdCBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgYy53aWR0aCA9IDY0OyBjLmhlaWdodCA9IDY0OwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjdHguY2xlYXJSZWN0KDAsMCw2NCw2NCk7CiAgICAgICAgCiAgICAgICAgLy8gQnVyc3Qgc2hhcGUKICAgICAgICBjb25zdCBjeCA9IDMyLCBjeSA9IDMyOwogICAgICAgIGNvbnN0IHNwaWtlcyA9IDg7CiAgICAgICAgY29uc3Qgb3V0ZXIgPSAzMDsKICAgICAgICBjb25zdCBpbm5lciA9IDEwOwogICAgICAgIAogICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICBmb3IobGV0IGk9MDsgaTxzcGlrZXMqMjsgaSsrKXsKICAgICAgICAgICAgY29uc3QgciA9IChpJTI9PT0wKT8gb3V0ZXIgOiBpbm5lcjsKICAgICAgICAgICAgY29uc3QgYSA9IChNYXRoLlBJKmkpL3NwaWtlczsKICAgICAgICAgICAgY3R4LmxpbmVUbyhjeCArIE1hdGguY29zKGEpKnIsIGN5ICsgTWF0aC5zaW4oYSkqcik7CiAgICAgICAgfQogICAgICAgIGN0eC5jbG9zZVBhdGgoKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gJyNmZmNjMDAnOwogICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgCiAgICAgICAgLy8gV2hpdGUgQ29yZQogICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICBjdHguYXJjKGN4LCBjeSwgOCwgMCwgTWF0aC5QSSoyKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gJyNmZmZmZmYnOwogICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIG5ldyBUSFJFRS5DYW52YXNUZXh0dXJlKGMpOwogICAgfSkoKTsKCiAgICBjb25zdCBfc3BhcmtNYXRlcmlhbCA9IG5ldyBUSFJFRS5TcHJpdGVNYXRlcmlhbCh7IAogICAgICAgIG1hcDogX3NwYXJrVGV4dHVyZSwgCiAgICAgICAgdHJhbnNwYXJlbnQ6IHRydWUsIAogICAgICAgIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nLAogICAgICAgIGRlcHRoV3JpdGU6IGZhbHNlCiAgICB9KTsKCiAgICBjbGFzcyBHYW1lTWFuYWdlciB7CgogICAgICAgIApjb25zdHJ1Y3RvcihzY2VuZSwgdWlMYXllcklkLCBjYW1lcmEsIHJlbmRlcmVyKSB7CndpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSA9IHRoaXM7CiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIgPSByZW5kZXJlcjsgLy8gU3RvcmUgcmVuZGVyZXIKICAgICAgICAgICAgdGhpcy5zY2VuZSA9IHNjZW5lOwogICAgICAgICAgICB0aGlzLmNhbWVyYSA9IGNhbWVyYTsKICAgICAgICAgICAgdGhpcy51aUxheWVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodWlMYXllcklkKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHRoaXMuc2NvcmUgPSB7IGhvbWU6IDAsIGF3YXk6IDAgfTsKICAgICAgICAgICAgdGhpcy50aW1lID0gMDsKICAgICAgICAgICAgdGhpcy5oYWxmID0gMTsKICAgICAgICAgICAgdGhpcy5oYWxmRHVyYXRpb24gPSAzMDA7IC8vIDUgbWludXRlcyAoc2Vjb25kcykKICAgICAgICAgICAgdGhpcy5pc092ZXJ0aW1lID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuaXNEZW1vTW9kZSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmdhbWVNb2RlID0gJ25vcm1hbCc7IC8vICdub3JtYWwnIG9yICdwcmFjdGljZScKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEltcGFjdCBGcmFtZXMKICAgICAgICAgICAgdGhpcy5pbXBhY3RQYXVzZSA9IDA7CiAgICAgICAgICAgIAogICAgICAgICAgICB0aGlzLnN0YXRlID0gJ21lbnUnOyAvLyBTdGFydCBpbiBtZW51CnRoaXMudGVhbXMgPSB7CiAgICAgICAgICAgICAgICBob21lOiBudWxsLAogICAgICAgICAgICAgICAgYXdheTogbnVsbAogICAgICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5lbnRpdGllcyA9IHsKICAgICAgICAgICAgICAgIGJhbGw6IG51bGwKICAgICAgICAgICAgfTsKCnRoaXMudWkgPSB7CiAgICAgICAgICAgICAgICBzY29yZVBsYXllcjogbnVsbCwKICAgICAgICAgICAgICAgIHNjb3JlQ3B1OiBudWxsLAogICAgICAgICAgICAgICAgdGltZXI6IG51bGwsCiAgICAgICAgICAgICAgICBoYWxmOiBudWxsLAogICAgICAgICAgICAgICAgYW5ub3VuY2VtZW50OiBudWxsLAogICAgICAgICAgICAgICAgLy8gUGxheWVyIFN0YXR1cyBQYW5lbAogICAgICAgICAgICAgICAgc3RhdHVzUGFuZWw6IHsKICAgICAgICAgICAgICAgICAgICBjb250YWluZXI6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgbmFtZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICBocEJhcjogbnVsbCwKICAgICAgICAgICAgICAgICAgICBocFRleHQ6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgZXhwQmFyOiBudWxsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBUZWNoY29weSBTdGF0ZQogICAgICAgICAgICB0aGlzLnRlY2hDb3B5U3RhdGUgPSB7CiAgICAgICAgICAgICAgICBhY3RpdmU6IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDAsCiAgICAgICAgICAgICAgICB0ZWNoOiBudWxsLAogICAgICAgICAgICAgICAgbGVhcm5lcnM6IFtdCiAgICAgICAgICAgIH07Cgp0aGlzLm1pbmlNYXAgPSBuZXcgd2luZG93LmZsdXguTWluaU1hcCgpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gSW5pdGlhbGl6ZSBGbG9hdGluZyBUZXh0Ci8vIEluaXRpYWxpemUgRmxvYXRpbmcgVGV4dAogICAgICAgICAgICB0aGlzLmZsb2F0aW5nVGV4dCA9IG5ldyB3aW5kb3cuZmx1eC5GbG9hdGluZ1RleHRNYW5hZ2VyKHNjZW5lLCB1aUxheWVySWQsIGNhbWVyYSk7CiAgICAgICAgICAgIAovLyBJbml0aWFsaXplIFBhcnRpY2xlIE1hbmFnZXIgKFN0YXR1cyBFZmZlY3RzKQogICAgICAgICAgICB0aGlzLnBhcnRpY2xlTWFuYWdlciA9IG5ldyB3aW5kb3cuZmx1eC5QYXJ0aWNsZU1hbmFnZXIoc2NlbmUpOwp0aGlzLmdseXBoTWFuYWdlciA9IG51bGw7IC8vIEluamVjdGVkIGJ5IG1haW4uanMKICAgICAgICAgICAgdGhpcy5faW5pdFBhcnRpY2xlcygpOyAvLyAzRCBTcGFyayBTeXN0ZW0gKExlZ2FjeS9JbXBhY3QpCgp0aGlzLmRlYnVnVmlzdWFsaXplciA9IG5ldyB3aW5kb3cuZmx1eC5EZWJ1Z1Zpc3VhbGl6ZXIoc2NlbmUpOwogICAgICAgICAgICB0aGlzLnByYWN0aWNlTWFuYWdlciA9IG5ldyB3aW5kb3cuZmx1eC5QcmFjdGljZU1hbmFnZXIodGhpcyk7IC8vIEluaXRpYWxpemUgUHJhY3RpY2UgTWFuYWdlcgogICAgICAgICAgICB0aGlzLl9pbmplY3RTdHlsZXMoKTsKICAgICAgICAgICAgdGhpcy5faW5pdFVJKCk7CiAgICAgICAgfQoKICAgICAgICBfaW5qZWN0U3R5bGVzKCkgewogICAgICAgICAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZsdXgtZHluYW1pYy1zdHlsZXMnKSkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBzdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7CiAgICAgICAgICAgIHN0eWxlLmlkID0gJ2ZsdXgtZHluYW1pYy1zdHlsZXMnOwpzdHlsZS50ZXh0Q29udGVudCA9IGAKICAgICAgICAgICAgICAgIEBrZXlmcmFtZXMgdGV4dFNsYW0gewogICAgICAgICAgICAgICAgICAgIDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSkgc2NhbGUoNCk7IG9wYWNpdHk6IDA7IGxldHRlci1zcGFjaW5nOiA1MHB4OyB9CiAgICAgICAgICAgICAgICAgICAgMTAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSkgc2NhbGUoMSk7IG9wYWNpdHk6IDE7IGxldHRlci1zcGFjaW5nOiA1cHg7IH0KICAgICAgICAgICAgICAgICAgICAxNSUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKSBzY2FsZSgxLjEpOyB9CiAgICAgICAgICAgICAgICAgICAgMjAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSkgc2NhbGUoMSk7IH0KICAgICAgICAgICAgICAgICAgICA4MCUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKSBzY2FsZSgxKTsgb3BhY2l0eTogMTsgZmlsdGVyOiBibHVyKDBweCk7IH0KICAgICAgICAgICAgICAgICAgICAxMDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSkgc2NhbGUoMS41KTsgb3BhY2l0eTogMDsgZmlsdGVyOiBibHVyKDEwcHgpOyB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC5hbm5vdW5jZW1lbnQtc2xhbSB7CiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICAgICAgICAgICAgICAgIHRvcDogNDUlOyBsZWZ0OiA1MCU7CiAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSk7CiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgICAgICAgICAgICAgICAgIGZvbnQtZmFtaWx5OiAnSW1wYWN0Jywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgICAgICAgICBmb250LXNpemU6IDk2cHg7CiAgICAgICAgICAgICAgICAgICAgZm9udC1zdHlsZTogaXRhbGljOwogICAgICAgICAgICAgICAgICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KHRvIGJvdHRvbSwgI2ZmZmZmZiAwJSwgI2ZmZGQwMCA0NSUsICNmZjg4MDAgMTAwJSk7CiAgICAgICAgICAgICAgICAgICAgLXdlYmtpdC1iYWNrZ3JvdW5kLWNsaXA6IHRleHQ7CiAgICAgICAgICAgICAgICAgICAgLXdlYmtpdC10ZXh0LWZpbGwtY29sb3I6IHRyYW5zcGFyZW50OwogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogZHJvcC1zaGFkb3coMCAwIDEwcHggcmdiYSgwLDAsMCwxKSkgZHJvcC1zaGFkb3coMCAwIDMwcHggcmdiYSgyNTUsIDEwMCwgMCwgMC42KSk7CiAgICAgICAgICAgICAgICAgICAgei1pbmRleDogMjAwMDsKICAgICAgICAgICAgICAgICAgICBhbmltYXRpb246IHRleHRTbGFtIDEuOHMgY3ViaWMtYmV6aWVyKDAuMSwgMC44LCAwLjEsIDEpIGZvcndhcmRzOwogICAgICAgICAgICAgICAgICAgIHBvaW50ZXItZXZlbnRzOiBub25lOwogICAgICAgICAgICAgICAgICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLm1vZGFsLW92ZXJsYXkgewogICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiAwOyBsZWZ0OiAwOyB3aWR0aDogMTAwJTsgaGVpZ2h0OiAxMDAlOwogICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6IHJhZGlhbC1ncmFkaWVudChjaXJjbGUgYXQgY2VudGVyLCByZ2JhKDEwLCAyNSwgNjAsIDAuOTUpIDAlLCByZ2JhKDAsIDAsIDAsIDAuOTgpIDEwMCUpOwogICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7IGp1c3RpZnktY29udGVudDogY2VudGVyOyBhbGlnbi1pdGVtczogY2VudGVyOyBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICAgICAgICAgICAgICAgIHotaW5kZXg6IDE5MDA7CiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMDsgcG9pbnRlci1ldmVudHM6IG5vbmU7IHRyYW5zaXRpb246IG9wYWNpdHkgMC44czsKICAgICAgICAgICAgICAgICAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoOHB4KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC5tb2RhbC1vdmVybGF5LmFjdGl2ZSB7IG9wYWNpdHk6IDE7IHBvaW50ZXItZXZlbnRzOiBhdXRvOyB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC5tb2RhbC10aXRsZSB7CiAgICAgICAgICAgICAgICAgICAgZm9udC1mYW1pbHk6ICdHYXJhbW9uZCcsIHNlcmlmOwogICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogNTJweDsgY29sb3I6ICNmZmY7CiAgICAgICAgICAgICAgICAgICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsKICAgICAgICAgICAgICAgICAgICB0ZXh0LXNoYWRvdzogMCAwIDIwcHggIzAwYWFmZiwgMCAwIDQwcHggIzAwNDRhYTsKICAgICAgICAgICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAzMHB4OwogICAgICAgICAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDJweCBzb2xpZCAjMDBhYWZmOwogICAgICAgICAgICAgICAgICAgIHBhZGRpbmctYm90dG9tOiAxMHB4OwogICAgICAgICAgICAgICAgICAgIHdpZHRoOiA4MCU7IHRleHQtYWxpZ246IGNlbnRlcjsKICAgICAgICAgICAgICAgICAgICBsZXR0ZXItc3BhY2luZzogNXB4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAubW9kYWwtc2NvcmUtY29udGFpbmVyIHsKICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBnYXA6IDQwcHg7CiAgICAgICAgICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogNDBweDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC5tb2RhbC1zY29yZSB7CiAgICAgICAgICAgICAgICAgICAgZm9udC1mYW1pbHk6ICdJbXBhY3QnLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogODBweDsgY29sb3I6ICNmZmQ3MDA7CiAgICAgICAgICAgICAgICAgICAgbGV0dGVyLXNwYWNpbmc6IDVweDsKICAgICAgICAgICAgICAgICAgICB0ZXh0LXNoYWRvdzogMCAwIDIwcHggI2I4ODYwYjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC5tb2RhbC12cyB7CiAgICAgICAgICAgICAgICAgICAgZm9udC1mYW1pbHk6ICdDb3VyaWVyIE5ldycsIG1vbm9zcGFjZTsKICAgICAgICAgICAgICAgICAgICBmb250LXNpemU6IDI0cHg7IGNvbG9yOiAjMDBhYWZmOyBvcGFjaXR5OiAwLjc7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLmZsYXNoLW92ZXJsYXkgewogICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiAwOyBsZWZ0OiAwOyB3aWR0aDogMTAwJTsgaGVpZ2h0OiAxMDAlOwogICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6IHdoaXRlOwogICAgICAgICAgICAgICAgICAgIHotaW5kZXg6IDIxMDA7CiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMDsgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbjogb3BhY2l0eSAwLjFzIGVhc2Utb3V0OwogICAgICAgICAgICAgICAgICAgIG1peC1ibGVuZC1tb2RlOiBvdmVybGF5OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIEBrZXlmcmFtZXMgY2xhc2hQb3AgewogICAgICAgICAgICAgICAgICAgIDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSkgc2NhbGUoMC41KTsgb3BhY2l0eTogMTsgfQogICAgICAgICAgICAgICAgICAgIDUwJSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpIHNjYWxlKDEuNSk7IG9wYWNpdHk6IDAuODsgfQogICAgICAgICAgICAgICAgICAgIDEwMCUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKSBzY2FsZSgyLjApOyBvcGFjaXR5OiAwOyB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLmNsYXNoLXNwYXJrIHsKICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDYwcHg7IGhlaWdodDogNjBweDsKICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiByYWRpYWwtZ3JhZGllbnQoY2lyY2xlLCAjZmZmZmZmIDAlLCAjZmZmZjAwIDQwJSwgdHJhbnNwYXJlbnQgNzAlKTsKICAgICAgICAgICAgICAgICAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICAgICAgICAgICAgICAgICAgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgICAgICAgICAgICAgICAgICAgei1pbmRleDogMTUwMDsKICAgICAgICAgICAgICAgICAgICBtaXgtYmxlbmQtbW9kZTogc2NyZWVuOwogICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogY2xhc2hQb3AgMC4zcyBlYXNlLW91dCBmb3J3YXJkczsKICAgICAgICAgICAgICAgICAgICBib3gtc2hhZG93OiAwIDAgMjBweCAjZmZhYTAwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBgOwogICAgICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHN0eWxlKTsKICAgICAgICB9CgogICAgICAgIHJlZ2lzdGVyVGVhbXMoaG9tZVRlYW0sIGF3YXlUZWFtLCBiYWxsKSB7CiAgICAgICAgICAgIHRoaXMudGVhbXMuaG9tZSA9IGhvbWVUZWFtOwogICAgICAgICAgICB0aGlzLnRlYW1zLmF3YXkgPSBhd2F5VGVhbTsKdGhpcy5lbnRpdGllcy5iYWxsID0gYmFsbDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEluaXRpYWxpemUgTWluaU1hcAogICAgICAgICAgICBpZiAodGhpcy5taW5pTWFwKSB7CiAgICAgICAgICAgICAgICB0aGlzLm1pbmlNYXAuaW5pdChob21lVGVhbSwgYXdheVRlYW0sIGJhbGwpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKX2luaXRVSSgpIHsKICAgICAgICAgICAgLy8gQmluZCB0byBleGlzdGluZyBIVE1MIGVsZW1lbnRzCiAgICAgICAgICAgIHRoaXMudWkuc2NvcmVQbGF5ZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NvcmUtcGxheWVyJyk7CiAgICAgICAgICAgIHRoaXMudWkuc2NvcmVDcHUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NvcmUtY3B1Jyk7CiAgICAgICAgICAgIHRoaXMudWkudGltZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGltZXItZGlzcGxheScpOwogICAgICAgICAgICB0aGlzLnVpLmhhbGYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGFsZi1pbmRpY2F0b3InKTsKICAgICAgICAgICAgdGhpcy51aS5hbm5vdW5jZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5ub3VuY2VtZW50Jyk7CiAgICAgICAgICAgIAogICAgICAgICAgICB0aGlzLnVpLnRlY2hGbGFzaCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0ZWNoLWZsYXNoLW92ZXJsYXknKTsKICAgICAgICAgICAgaWYgKHRoaXMudWkudGVjaEZsYXNoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnVpLnRlY2hTdWIgPSB0aGlzLnVpLnRlY2hGbGFzaC5xdWVyeVNlbGVjdG9yKCcudGVjaC1zdWItdGV4dCcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMudWkudGVjaFRpbWVyRmlsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50ZWNoLXRpbWVyLWZpbGwnKTsKCiAgICAgICAgICAgIC8vIEJpbmQgUGxheWVyIFN0YXR1cyBQYW5lbAogICAgICAgICAgICB0aGlzLnVpLnN0YXR1c1BhbmVsLmNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwbGF5ZXItc3RhdHVzLXBhbmVsJyk7CiAgICAgICAgICAgIHRoaXMudWkuc3RhdHVzUGFuZWwubmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwbGF5ZXItc3RhdHVzLXBhbmVsIC5jaGFyLW5hbWUnKTsKICAgICAgICAgICAgdGhpcy51aS5zdGF0dXNQYW5lbC5ocEJhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwbGF5ZXItc3RhdHVzLXBhbmVsIC5ocC1iYXItZmlsbCcpOwogICAgICAgICAgICB0aGlzLnVpLnN0YXR1c1BhbmVsLmhwVGV4dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwbGF5ZXItc3RhdHVzLXBhbmVsIC5ocC12YWx1ZScpOwogICAgICAgICAgICB0aGlzLnVpLnN0YXR1c1BhbmVsLmV4cEJhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwbGF5ZXItc3RhdHVzLXBhbmVsIC50ZWNoLWJhci1maWxsJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBDcmVhdGUgTW9kYWwgT3ZlcmxheQogICAgICAgICAgICB0aGlzLnVpLm1vZGFsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIHRoaXMudWkubW9kYWwuY2xhc3NOYW1lID0gJ21vZGFsLW92ZXJsYXknOwogICAgICAgICAgICB0aGlzLnVpLm1vZGFsLmlubmVySFRNTCA9IGAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1vZGFsLXRpdGxlIj5IQUxGIFRJTUU8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1vZGFsLXNjb3JlLWNvbnRhaW5lciI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibW9kYWwtc2NvcmUiIGlkPSJtb2RhbC1zY29yZS1ob21lIj4wPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibW9kYWwtdnMiPi08L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtb2RhbC1zY29yZSIgaWQ9Im1vZGFsLXNjb3JlLWF3YXkiPjA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBpZD0ibW9kYWwtbXNnIiBzdHlsZT0iY29sb3I6ICMwMGFhZmY7IGZvbnQtc2l6ZTogMTRweDsgbGV0dGVyLXNwYWNpbmc6IDJweDsiPlBSRVBBUklORyAyTkQgSEFMRi4uLjwvZGl2PgogICAgICAgICAgICBgOwogICAgICAgICAgICB0aGlzLnVpTGF5ZXIuYXBwZW5kQ2hpbGQodGhpcy51aS5tb2RhbCk7CgogICAgICAgICAgICAvLyBDcmVhdGUgRmxhc2ggT3ZlcmxheQogICAgICAgICAgICB0aGlzLnVpLmZsYXNoID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIHRoaXMudWkuZmxhc2guY2xhc3NOYW1lID0gJ2ZsYXNoLW92ZXJsYXknOwogICAgICAgICAgICB0aGlzLnVpTGF5ZXIuYXBwZW5kQ2hpbGQodGhpcy51aS5mbGFzaCk7CgogICAgICAgICAgICAvLyBJbml0aWFsIFN0YXRlCiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVNjb3JlVUkoKTsKICAgICAgICAgICAgaWYgKHRoaXMudWkudGltZXIpIHRoaXMudWkudGltZXIuaW5uZXJUZXh0ID0gIjAwOjAwIjsKICAgICAgICB9CiAgICAgICAgX3VwZGF0ZVNjb3JlVUkoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnVpLnNjb3JlUGxheWVyKSB0aGlzLnVpLnNjb3JlUGxheWVyLmlubmVyVGV4dCA9IHRoaXMuc2NvcmUuaG9tZTsKICAgICAgICAgICAgaWYgKHRoaXMudWkuc2NvcmVDcHUpIHRoaXMudWkuc2NvcmVDcHUuaW5uZXJUZXh0ID0gdGhpcy5zY29yZS5hd2F5OwogICAgICAgIH0KCnVwZGF0ZVByYWN0aWNlKGR0KSB7CiAgICAgICAgICAgIC8vIERlbGVnYXRlIGxvZ2ljIHRvIFByYWN0aWNlTWFuYWdlcgogICAgICAgICAgICBpZiAodGhpcy5wcmFjdGljZU1hbmFnZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMucHJhY3RpY2VNYW5hZ2VyLnVwZGF0ZShkdCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHVwZGF0ZShkdCkgewogICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSA9PT0gJ21lbnUnKSB7CiAgICAgICAgICAgICAgICAvLyBNZW51IEJhY2tncm91bmQgTG9naWMgKENhbWVyYSBPcmJpdCkKICAgICAgICAgICAgICAgIGlmICh0aGlzLmNhbWVyYU1hbmFnZXIpIHsKICAgICAgICAgICAgICAgICAgICAvLyBTbG93IG9yYml0IGFyb3VuZCBjZW50ZXIKICAgICAgICAgICAgICAgICAgICBjb25zdCB0aW1lID0gRGF0ZS5ub3coKSAqIDAuMDAwMTsKICAgICAgICAgICAgICAgICAgICBjb25zdCByYWRpdXMgPSA0MDsKICAgICAgICAgICAgICAgICAgICBjb25zdCB4ID0gTWF0aC5zaW4odGltZSkgKiByYWRpdXM7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgeiA9IE1hdGguY29zKHRpbWUpICogcmFkaXVzOwogICAgICAgICAgICAgICAgICAgIC8vIE5vdGU6IENhbWVyYU1hbmFnZXIgdXBkYXRlIGlzIHNraXBwZWQgaW4gbWFpbi5qcyBpZiBzdGF0ZSBpcyBtZW51CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlID09PSAnYWN0aXZlJykgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZU1vZGUgPT09ICdwcmFjdGljZScpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVByYWN0aWNlKGR0KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50aW1lICs9IGR0OwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVRpbWVyKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2hlY2tIYWxmVGltZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuX2NoZWNrR29hbHMoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKHRoaXMubWluaU1hcCkgdGhpcy5taW5pTWFwLnVwZGF0ZSgpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuZmxvYXRpbmdUZXh0KSB0aGlzLmZsb2F0aW5nVGV4dC51cGRhdGUoZHQpOwppZiAodGhpcy5wYXJ0aWNsZU1hbmFnZXIpIHRoaXMucGFydGljbGVNYW5hZ2VyLnVwZGF0ZShkdCk7CiAgICAgICAgICAgICAgICAvLyBHbHlwaE1hbmFnZXIgdXBkYXRlZCBieSBtYWluLmpzCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBUZWNoY29weSBXaW5kb3cKICAgICAgICAgICAgICAgIGlmICh0aGlzLnRlY2hDb3B5U3RhdGUuYWN0aXZlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50ZWNoQ29weVN0YXRlLnRpbWVyIC09IGR0OwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBVSSBCYXIKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy51aS50ZWNoVGltZXJGaWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBjdCA9IE1hdGgubWF4KDAsICh0aGlzLnRlY2hDb3B5U3RhdGUudGltZXIgLyB0aGlzLnRlY2hDb3B5U3RhdGUubWF4VGltZSkgKiAxMDApOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLnRlY2hUaW1lckZpbGwuc3R5bGUud2lkdGggPSBgJHtwY3R9JWA7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAvLyBDb2xvciBzaGlmdCBiYXNlZCBvbiB1cmdlbmN5CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwY3QgPCAzMCkgdGhpcy51aS50ZWNoVGltZXJGaWxsLnN0eWxlLmJhY2tncm91bmQgPSAnI2ZmMDAwMCc7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgdGhpcy51aS50ZWNoVGltZXJGaWxsLnN0eWxlLmJhY2tncm91bmQgPSAnbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjZmZmZmZmLCAjMDBmZmZmKSc7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50ZWNoQ29weVN0YXRlLnRpbWVyIDw9IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbmRUZWNoQ29weVdpbmRvdyhmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVQYXJ0aWNsZXMoZHQpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuZGVidWdWaXN1YWxpemVyKSB0aGlzLmRlYnVnVmlzdWFsaXplci51cGRhdGUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAgICAgCgoKX3VwZGF0ZVRpbWVyKCkgewogICAgICAgICAgICBpZiAoIXRoaXMudWkudGltZXIpIHJldHVybjsKICAgICAgICAgICAgLy8gQ2xhbXAgdG8gaGFsZiBkdXJhdGlvbiBmb3IgZGlzcGxheSBpZiB3ZSBnbyBzbGlnaHRseSBvdmVyIGJlZm9yZSB0aWNrCiAgICAgICAgICAgIGNvbnN0IHQgPSBNYXRoLm1pbih0aGlzLnRpbWUsIHRoaXMuaGFsZkR1cmF0aW9uKTsKICAgICAgICAgICAgY29uc3QgbWludXRlcyA9IE1hdGguZmxvb3IodCAvIDYwKTsKICAgICAgICAgICAgY29uc3Qgc2Vjb25kcyA9IE1hdGguZmxvb3IodCAlIDYwKTsKICAgICAgICAgICAgdGhpcy51aS50aW1lci5pbm5lclRleHQgPSBgJHttaW51dGVzLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX06JHtzZWNvbmRzLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX1gOwogICAgICAgIH0KICAgICAgICBfY2hlY2tIYWxmVGltZSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMudGltZSA+PSB0aGlzLmhhbGZEdXJhdGlvbikgewogICAgICAgICAgICAgICAgdGhpcy5lbmRIYWxmKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgplbmRIYWxmKCkgewogICAgICAgICAgICB0aGlzLnN0YXRlID0gJ2hhbGZ0aW1lJzsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh0aGlzLmhhbGYgPT09IDEpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3Nob3dNb2RhbCgiSEFMRiBUSU1FIiwgIlBSRVBBUklORyAyTkQgSEFMRi4uLiIpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faGlkZU1vZGFsKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGFydFNlY29uZEhhbGYoKTsKICAgICAgICAgICAgICAgIH0sIDQwMDApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gRW5kIG9mIDJuZCBIYWxmIG9yIE92ZXJ0aW1lIFBlcmlvZAogICAgICAgICAgICAgICAgaWYgKHRoaXMuc2NvcmUuaG9tZSA9PT0gdGhpcy5zY29yZS5hd2F5KSB7CiAgICAgICAgICAgICAgICAgICAgLy8gVElFRCAtIEdvIHRvIE92ZXJ0aW1lIChHb2xkZW4gR29hbCkKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zaG93TW9kYWwoIk9WRVJUSU1FIiwgIkdPTERFTiBHT0FMIFJVTEUgQUNUSVZFIik7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2hpZGVNb2RhbCgpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0T3ZlcnRpbWUoKTsKICAgICAgICAgICAgICAgICAgICB9LCA0MDAwKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gV2lubmVyIGRlY2lkZWQKICAgICAgICAgICAgICAgICAgICB0aGlzLmVuZEdhbWUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgc3RhcnRTZWNvbmRIYWxmKCkgewogICAgICAgICAgICB0aGlzLmhhbGYgPSAyOwogICAgICAgICAgICB0aGlzLnRpbWUgPSAwOwogICAgICAgICAgICB0aGlzLnVpLmhhbGYuaW5uZXJUZXh0ID0gIjJuZCBIQUxGIjsKICAgICAgICAgICAgdGhpcy5yZXNldFJvdW5kKG51bGwpOyAvLyBOZXV0cmFsIEJsaXR6LW9mZiBmb3IgMm5kIGhhbGYgc3RhcnQKICAgICAgICB9CgogICAgICAgIHN0YXJ0T3ZlcnRpbWUoKSB7CiAgICAgICAgICAgIHRoaXMuaGFsZisrOwogICAgICAgICAgICB0aGlzLnRpbWUgPSAwOwogICAgICAgICAgICB0aGlzLmlzT3ZlcnRpbWUgPSB0cnVlOwogICAgICAgICAgICB0aGlzLnVpLmhhbGYuaW5uZXJUZXh0ID0gIk9WRVJUSU1FIjsKICAgICAgICAgICAgdGhpcy5yZXNldFJvdW5kKG51bGwpOyAvLyBOZXV0cmFsIEJsaXR6LW9mZgogICAgICAgIH0KCiAgICAgICAgZW5kR2FtZSgpIHsKICAgICAgICAgICAgdGhpcy5zdGF0ZSA9ICdnYW1lb3Zlcic7CiAgICAgICAgICAgIGxldCBtc2cgPSAiRFJBVyI7CiAgICAgICAgICAgIGlmICh0aGlzLnNjb3JlLmhvbWUgPiB0aGlzLnNjb3JlLmF3YXkpIG1zZyA9ICJWSUNUT1JZIjsKICAgICAgICAgICAgaWYgKHRoaXMuc2NvcmUuYXdheSA+IHRoaXMuc2NvcmUuaG9tZSkgbXNnID0gIkRFRkVBVCI7CiAgICAgICAgICAgIAp0aGlzLl9zaG93TW9kYWwobXNnLCAiUFJFU1MgUkVGUkVTSCBUTyBQTEFZIEFHQUlOIik7CiAgICAgICAgICAgIC8vIFN0b3AgTXVzaWMgb24gR2FtZSBPdmVyCiAgICAgICAgICAgIGlmICh0aGlzLmF1ZGlvTWFuYWdlcikgewogICAgICAgICAgICAgICAgdGhpcy5hdWRpb01hbmFnZXIuc3RvcEJHTSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIE5vIHJlc2V0LCBqdXN0IHN0b3AuCiAgICAgICAgfQoKICAgICAgICBfc2hvd01vZGFsKHRpdGxlLCBzdWJ0ZXh0KSB7CiAgICAgICAgICAgIGlmICghdGhpcy51aS5tb2RhbCkgcmV0dXJuOwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy51aS5tb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWwtdGl0bGUnKS5pbm5lclRleHQgPSB0aXRsZTsKICAgICAgICAgICAgdGhpcy51aS5tb2RhbC5xdWVyeVNlbGVjdG9yKCcjbW9kYWwtc2NvcmUtaG9tZScpLmlubmVyVGV4dCA9IHRoaXMuc2NvcmUuaG9tZTsKICAgICAgICAgICAgdGhpcy51aS5tb2RhbC5xdWVyeVNlbGVjdG9yKCcjbW9kYWwtc2NvcmUtYXdheScpLmlubmVyVGV4dCA9IHRoaXMuc2NvcmUuYXdheTsKICAgICAgICAgICAgdGhpcy51aS5tb2RhbC5xdWVyeVNlbGVjdG9yKCcjbW9kYWwtbXNnJykuaW5uZXJUZXh0ID0gc3VidGV4dDsKICAgICAgICAgICAgCiAgICAgICAgICAgIHRoaXMudWkubW9kYWwuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBIaWRlIEhVRCBlbGVtZW50cwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaHVkLXRvcCcpLnN0eWxlLm9wYWNpdHkgPSAnMCc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwbGF5ZXItc3RhdHVzLXBhbmVsJykuc3R5bGUub3BhY2l0eSA9ICcwJzsKICAgICAgICB9CgogICAgICAgIF9oaWRlTW9kYWwoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy51aS5tb2RhbCkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLnVpLm1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU2hvdyBIVUQgZWxlbWVudHMKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2h1ZC10b3AnKS5zdHlsZS5vcGFjaXR5ID0gJzEnOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxheWVyLXN0YXR1cy1wYW5lbCcpLnN0eWxlLm9wYWNpdHkgPSAnMSc7CiAgICAgICAgfQoKX2NoZWNrR29hbHMoKSB7CiAgICAgICAgICAgIGNvbnN0IGJhbGwgPSB0aGlzLmVudGl0aWVzLmJhbGw7CiAgICAgICAgICAgIGlmICghYmFsbCB8fCAhYmFsbC5tZXNoKSByZXR1cm47CgogICAgICAgICAgICBjb25zdCBwb3MgPSBiYWxsLm1lc2gucG9zaXRpb247CgogICAgICAgICAgICAvLyBQcmVjaXNlIEdvYWwgRGV0ZWN0aW9uCiAgICAgICAgICAgIC8vIFZpc3VhbCBHb2FsIGlzIGF0IFogPSArLy0gMjguCiAgICAgICAgICAgIC8vIFdlIGRlZmluZSBhICJHb2FsIE1vdXRoIiBib3ggbWF0Y2hpbmcgR29hbGllLmpzIChXaWR0aCAxNCwgSGVpZ2h0IDgpLgovLyBXZSBkZWZpbmUgYSAiR29hbCBNb3V0aCIgYm94IG1hdGNoaW5nIHRoZSB2aXN1YWwgbmV0LgogICAgICAgICAgICAvLyBBcmVuYSBSYWRpdXMgaXMgMzIuIEdvYWwgaXMgcm91Z2hseSAyMm0gd2lkZSwgMThtIGhpZ2guCmNvbnN0IGhhbGZXaWR0aCA9IDE2LjU7IC8vIEluY3JlYXNlZCA1MCUgKHdhcyAxMS4wKQoKICAgICAgICAgICAgY29uc3QgaGFsZkhlaWdodCA9IDEzLjU7IC8vIEluY3JlYXNlZCA1MCUgKHdhcyA5LjApCiAgICAgICAgICAgIGNvbnN0IGdvYWxZT2Zmc2V0ID0gLTIuMjsgLy8gTW92ZWQgZG93biB0byBtYXRjaCB2aXN1YWwgbW9kZWwKICAgICAgICAgICAgY29uc3QgdHJpZ2dlclogPSAyOC4wOyAvLyBUcmlnZ2VyIGF0IHRoZSBhcmVuYSBlZGdlCiAgICAgICAgICAgIGlmIChNYXRoLmFicyhwb3MueikgPiB0cmlnZ2VyWikgewogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBQUkVWRU5UIE9XTiBHT0FMIEJZIENBUlJJRVIgKFVzZXIgUmVxdWVzdCkKICAgICAgICAgICAgICAgIC8vIElmIHRoZSBiYWxsIGlzIGhlbGQgYnkgdGhlIHRlYW0gZGVmZW5kaW5nIHRoaXMgZ29hbCwgZG8gbm90IGNvdW50IGl0LgogICAgICAgICAgICAgICAgaWYgKGJhbGwuaG9sZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gSG9tZSAoU2lkZSAxKSBkZWZlbmRzICtaLiBJZiBwb3MueiA+IDAgKEhvbWUgR29hbCkgYW5kIGhvbGRlciBpcyBIb21lLCBpZ25vcmUuCiAgICAgICAgICAgICAgICAgICAgaWYgKHBvcy56ID4gMCAmJiBiYWxsLmhvbGRlci50ZWFtLnNpZGUgPT09IDEpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAvLyBBd2F5IChTaWRlIC0xKSBkZWZlbmRzIC1aLiBJZiBwb3MueiA8IDAgKEF3YXkgR29hbCkgYW5kIGhvbGRlciBpcyBBd2F5LCBpZ25vcmUuCiAgICAgICAgICAgICAgICAgICAgaWYgKHBvcy56IDwgMCAmJiBiYWxsLmhvbGRlci50ZWFtLnNpZGUgPT09IC0xKSByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gMi4gQ2hlY2sgRnJhbWUgKE11c3QgYmUgd2l0aGluIHdpZHRoL2hlaWdodCkKLy8gMi4gQ2hlY2sgRnJhbWUgKE11c3QgYmUgd2l0aGluIHdpZHRoL2hlaWdodCwgYWNjb3VudGluZyBmb3IgWSBvZmZzZXQpCiAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnMocG9zLngpIDw9IGhhbGZXaWR0aCAmJiBNYXRoLmFicyhwb3MueSAtIGdvYWxZT2Zmc2V0KSA8PSBoYWxmSGVpZ2h0KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBvcy56IDwgMCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdvYWxTY29yZWQoJ2hvbWUnKTsgLy8gSG9tZSBhdHRhY2tzIC1aCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nb2FsU2NvcmVkKCdhd2F5Jyk7IC8vIEF3YXkgYXR0YWNrcyArWgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCmdvYWxTY29yZWQoc2NvcmVyKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSAnYWN0aXZlJykgcmV0dXJuOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gSU1QQUNUIEZSQU1FOiBHT0FMCnRoaXMudHJpZ2dlckltcGFjdCgwLjQsICdzaGF0dGVyJyk7IC8vIE1hc3NpdmUgZnJlZXplIGZvciBnb2FsCiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSAnYWN0aXZlJykgcmV0dXJuOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRVhQIFJFV0FSRDogR29hbAogICAgICAgICAgICAvLyBGaW5kIHdobyBzY29yZWQgKExhc3QgaG9sZGVyIG9mIGJhbGwpCiAgICAgICAgICAgIGNvbnN0IGJhbGwgPSB0aGlzLmVudGl0aWVzLmJhbGw7CiAgICAgICAgICAgIGlmIChiYWxsICYmIGJhbGwubGFzdEhvbGRlciAmJiBiYWxsLmxhc3RIb2xkZXIudGVhbS5pZCA9PT0gc2NvcmVyKSB7CiAgICAgICAgICAgICAgICBiYWxsLmxhc3RIb2xkZXIuZ2FpbkV4cCgxMCk7CiAgICAgICAgICAgICAgICAvLyBPcHRpb25hbDogQXNzaXN0IGxvZ2ljIGNvdWxkIGdvIGhlcmUgKHRyYWNrIGxhc3RIb2xkZXIubGFzdFBhc3Nlcj8pCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSAnZ29hbCc7CiAgICAgICAgICAgIHRoaXMuc2NvcmVbc2NvcmVyXSsrOwogICAgICAgICAgICB0aGlzLl91cGRhdGVTY29yZVVJKCk7CiAgICAgICAgICAgIAovLyAxLiBWSVNDRVJBTCBTSEFLRSAmIFBBUlRJQ0xFUwogICAgICAgICAgICBpZiAodGhpcy5jYW1lcmFNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNhbWVyYU1hbmFnZXIuYWRkU2hha2UoMi4wKTsgLy8gSGVhdnkgc2hha2UKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5wYXJ0aWNsZU1hbmFnZXIgJiYgdGhpcy5lbnRpdGllcy5iYWxsICYmIHRoaXMuZW50aXRpZXMuYmFsbC5tZXNoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBnb2FsUG9zID0gdGhpcy5lbnRpdGllcy5iYWxsLm1lc2gucG9zaXRpb24uY2xvbmUoKTsKICAgICAgICAgICAgICAgIC8vIE1hc3NpdmUgR29hbCBFeHBsb3Npb24KICAgICAgICAgICAgICAgIHRoaXMucGFydGljbGVNYW5hZ2VyLnNwYXduKCdzaG9ja3dhdmUnLCBnb2FsUG9zLCB7IHNjYWxlOiAxNS4wLCBsaWZlOiAwLjggfSk7CiAgICAgICAgICAgICAgICB0aGlzLnBhcnRpY2xlTWFuYWdlci5zcGF3bignZmxhc2gnLCBnb2FsUG9zLCB7IHNjYWxlOiAxMC4wIH0pOwogICAgICAgICAgICAgICAgZm9yKGxldCBpPTA7IGk8MzA7IGkrKykgewogICAgICAgICAgICAgICAgICAgIHRoaXMucGFydGljbGVNYW5hZ2VyLnNwYXduKCdkZWJyaXMnLCBnb2FsUG9zLCB7IHNjYWxlOiAwLjggfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gMi4gU0NSRUVOIEZMQVNICiAgICAgICAgICAgIGlmICh0aGlzLnVpLmZsYXNoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnVpLmZsYXNoLnN0eWxlLm9wYWNpdHkgPSAnMC44JzsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4geyB0aGlzLnVpLmZsYXNoLnN0eWxlLm9wYWNpdHkgPSAnMCc7IH0sIDEwMCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDMuIEdPTERFTiBHT0FMIENIRUNLCiAgICAgICAgICAgIGlmICh0aGlzLmlzT3ZlcnRpbWUpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2hvd0Fubm91bmNlbWVudCgiR09MREVOIEdPQUwhIiwgJ3NsYW0nKTsKICAgICAgICAgICAgICAgIC8vIEVuZCBnYW1lIGFmdGVyIHNob3J0IGRlbGF5CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmVuZEdhbWUoKTsKICAgICAgICAgICAgICAgIH0sIDMwMDApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyA0LiBTTEFNIEFOTk9VTkNFTUVOVCAoTm9ybWFsKQogICAgICAgICAgICB0aGlzLnNob3dBbm5vdW5jZW1lbnQoIkdPQUwhIiwgJ3NsYW0nKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFJlc2V0IHNlcXVlbmNlCiAgICAgICAgICAgIC8vIFNjb3JlZC11cG9uIHRlYW0gZ2V0cyBiYWxsCiAgICAgICAgICAgIGNvbnN0IGxvc2VyID0gc2NvcmVyID09PSAnaG9tZScgPyAnYXdheScgOiAnaG9tZSc7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBGQVNURVIgRkxPVzogUmVkdWNlZCBkZWxheSBmcm9tIDMwMDBtcyB0byAxMjAwbXMKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLnJlc2V0Um91bmQobG9zZXIpOwogICAgICAgICAgICB9LCAyMDAwKTsgLy8gU2xpZ2h0bHkgbG9uZ2VyIHRvIGFwcHJlY2lhdGUgdGhlICJHT0FMIiBzbGFtCiAgICAgICAgfQoKc2hvd0Fubm91bmNlbWVudCh0ZXh0LCB0eXBlID0gJ25vcm1hbCcsIGR1cmF0aW9uID0gMjAwMCkgewogICAgICAgICAgICBjb25zdCBlbCA9IHRoaXMudWkuYW5ub3VuY2VtZW50OwogICAgICAgICAgICBpZiAoIWVsKSByZXR1cm47CgogICAgICAgICAgICAvLyBDbGVhciBwcmV2aW91cyB0aW1lb3V0CiAgICAgICAgICAgIGlmICh0aGlzLl9hbm5vdW5jZVRpbWVvdXQpIHsKICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLl9hbm5vdW5jZVRpbWVvdXQpOwogICAgICAgICAgICAgICAgdGhpcy5fYW5ub3VuY2VUaW1lb3V0ID0gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gUmVzZXQgQW5pbWF0aW9uIGJ5IGNsb25pbmcKICAgICAgICAgICAgY29uc3QgbmV3RWwgPSBlbC5jbG9uZU5vZGUodHJ1ZSk7CiAgICAgICAgICAgIGVsLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKG5ld0VsLCBlbCk7CiAgICAgICAgICAgIHRoaXMudWkuYW5ub3VuY2VtZW50ID0gbmV3RWw7CgogICAgICAgICAgICBuZXdFbC5pbm5lclRleHQgPSB0ZXh0OwogICAgICAgICAgICBuZXdFbC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEFwcGx5IENsYXNzIGJhc2VkIG9uIHR5cGUKICAgICAgICAgICAgbmV3RWwuY2xhc3NOYW1lID0gJyc7IC8vIFJlc2V0IGNsYXNzZXMKICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdzbGFtJykgewogICAgICAgICAgICAgICAgbmV3RWwuY2xhc3NMaXN0LmFkZCgnYW5ub3VuY2VtZW50LXNsYW0nKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIERlZmF1bHQgc3R5bGUKICAgICAgICAgICAgICAgIG5ld0VsLnN0eWxlLmFuaW1hdGlvbiA9ICdub25lJzsKICAgICAgICAgICAgICAgIG5ld0VsLm9mZnNldEhlaWdodDsgLyogdHJpZ2dlciByZWZsb3cgKi8KICAgICAgICAgICAgICAgIG5ld0VsLnN0eWxlLmFuaW1hdGlvbiA9ICdhbm5vdW5jZVNsaWRlIDAuNXMgY3ViaWMtYmV6aWVyKDAuMTc1LCAwLjg4NSwgMC4zMiwgMS4yNzUpJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQXV0by1oaWRlCiAgICAgICAgICAgIGlmIChkdXJhdGlvbiA+IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuX2Fubm91bmNlVGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHRoaXMuaGlkZUFubm91bmNlbWVudCgpOwogICAgICAgICAgICAgICAgfSwgZHVyYXRpb24pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBoaWRlQW5ub3VuY2VtZW50KCkgewogICAgICAgICAgICBpZiAodGhpcy51aS5hbm5vdW5jZW1lbnQpIHsKICAgICAgICAgICAgICAgIHRoaXMudWkuYW5ub3VuY2VtZW50LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgIH0KICAgICAgICB9CgpyZXNldFJvdW5kKHBvc3Nlc3Npb25UZWFtSWQpIHsKICAgICAgICAgICAgdGhpcy5zdGF0ZSA9ICdyZXNldCc7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBSZXNldCBCYWxsCiAgICAgICAgICAgIGlmICh0aGlzLmVudGl0aWVzLmJhbGwpIHRoaXMuZW50aXRpZXMuYmFsbC5yZXNldCgpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gUmVzZXQgVGVhbXMKICAgICAgICAgICAgaWYgKHRoaXMudGVhbXMuaG9tZSkgdGhpcy50ZWFtcy5ob21lLnJlc2V0UG9zaXRpb25zKCk7CiAgICAgICAgICAgIGlmICh0aGlzLnRlYW1zLmF3YXkpIHRoaXMudGVhbXMuYXdheS5yZXNldFBvc2l0aW9ucygpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQ2xlYXIgYmFsbCBob2xkZXIKICAgICAgICAgICAgaWYgKHRoaXMuZW50aXRpZXMuYmFsbCkgdGhpcy5lbnRpdGllcy5iYWxsLmRyb3AoKTsKCiAgICAgICAgICAgIC8vIENSSVRJQ0FMOiBTbmFwIGNhbWVyYSB0byBwcmV2ZW50IGRpc29yaWVudGF0aW9uCiAgICAgICAgICAgIGlmICh0aGlzLmNhbWVyYU1hbmFnZXIpIHsKICAgICAgICAgICAgICAgIC8vIEZvcmNlIHVwZGF0ZSB0YXJnZXQgZmlyc3QgKHVzdWFsbHkgYmFsbCkKICAgICAgICAgICAgICAgIGlmICh0aGlzLmVudGl0aWVzLmJhbGwgJiYgdGhpcy5lbnRpdGllcy5iYWxsLm1lc2gpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbWVyYU1hbmFnZXIuc2V0VGFyZ2V0KHRoaXMuZW50aXRpZXMuYmFsbC5tZXNoLCB0aGlzLmVudGl0aWVzLmJhbGwudmVsb2NpdHkpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuY2FtZXJhTWFuYWdlci5zbmFwVG9UYXJnZXQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRkFTVEVSIEZMT1c6IFJlZHVjZWQgZGVsYXkgZnJvbSAyMDAwbXMgdG8gMTAwbXMKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0S2lja29mZihwb3NzZXNzaW9uVGVhbUlkKTsKfSwgMTAwKTsKICAgICAgICB9CgogICAgICAgIHN0YXJ0S2lja29mZihwb3NzZXNzaW9uVGVhbUlkKSB7CiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSAna2lja29mZic7CiAgICAgICAgICAgIHRoaXMuc2hvd0Fubm91bmNlbWVudCgiQkxJVFogT0ZGISIsICdzbGFtJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBJZiBhIHRlYW0gaGFzIHBvc3Nlc3Npb24gKGFmdGVyIGdvYWwpLCBnaXZlIHRvIE1GCiAgICAgICAgICAgIGlmIChwb3NzZXNzaW9uVGVhbUlkKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0ZWFtID0gdGhpcy50ZWFtc1twb3NzZXNzaW9uVGVhbUlkXTsKICAgICAgICAgICAgICAgIGlmICh0ZWFtKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWYgPSB0ZWFtLnBsYXllcnMuZmluZChwID0+IHAucm9sZSA9PT0gJ01GJyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG1mICYmIHRoaXMuZW50aXRpZXMuYmFsbCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVudGl0aWVzLmJhbGwuZ3JhYihtZik7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAvLyBDUklUSUNBTDogU25hcCBjYW1lcmEgdG8gbmV3IGhvbGRlciB0byBwcmV2ZW50IHN3aW5nL2Rpc29yaWVudGF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNhbWVyYU1hbmFnZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FtZXJhTWFuYWdlci5zZXRUYXJnZXQobWYubWVzaCwgbWYudmVsb2NpdHkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYW1lcmFNYW5hZ2VyLnNuYXBUb1RhcmdldCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gTmV1dHJhbCBraWNrb2ZmIC0gZW5zdXJlIGNhbWVyYSBpcyBzbmFwcGVkIHRvIGNlbnRlciBiYWxsCiAgICAgICAgICAgICAgICBpZiAodGhpcy5jYW1lcmFNYW5hZ2VyICYmIHRoaXMuZW50aXRpZXMuYmFsbCAmJiB0aGlzLmVudGl0aWVzLmJhbGwubWVzaCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY2FtZXJhTWFuYWdlci5zZXRUYXJnZXQodGhpcy5lbnRpdGllcy5iYWxsLm1lc2gsIHRoaXMuZW50aXRpZXMuYmFsbC52ZWxvY2l0eSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYW1lcmFNYW5hZ2VyLnNuYXBUb1RhcmdldCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBGQVNURVIgRkxPVzogUmVkdWNlZCBkZWxheSBmcm9tIDEwMDBtcyB0byA4MDBtcwogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuaGlkZUFubm91bmNlbWVudCgpOwogICAgICAgICAgICAgICAgdGhpcy5zdGF0ZSA9ICdhY3RpdmUnOwogICAgICAgICAgICB9LCA4MDApOwogICAgICAgIH0KICAgICAgICAKLy8gSW5pdGlhbCBzdGFydAogICAgICAgIHN0YXJ0TWF0Y2gobW9kZSA9ICdub3JtYWwnKSB7CiAgICAgICAgICAgIHRoaXMuZ2FtZU1vZGUgPSBtb2RlOwogICAgICAgICAgICBjb25zb2xlLmxvZygiU3RhcnRpbmcgTWF0Y2ggaW4gbW9kZToiLCBtb2RlKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFN0YXJ0IE11c2ljCiAgICAgICAgICAgIGlmICh0aGlzLmF1ZGlvTWFuYWdlcikgewogICAgICAgICAgICAgICAgdGhpcy5hdWRpb01hbmFnZXIucGxheUJHTSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBSZXNldCBTY29yZQp0aGlzLnNjb3JlLmhvbWUgPSAwOwogICAgICAgICAgICB0aGlzLnNjb3JlLmF3YXkgPSAwOwogICAgICAgICAgICB0aGlzLl91cGRhdGVTY29yZVVJKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBSZXNldCBUaW1lCiAgICAgICAgICAgIHRoaXMudGltZSA9IDA7CiAgICAgICAgICAgIHRoaXMuaGFsZiA9IDE7CiAgICAgICAgICAgIGlmICh0aGlzLnVpLmhhbGYpIHRoaXMudWkuaGFsZi5pbm5lclRleHQgPSAiMXN0IjsKICAgICAgICAgICAgCmlmIChtb2RlID09PSAncHJhY3RpY2UnKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy51aS5oYWxmKSB0aGlzLnVpLmhhbGYuaW5uZXJUZXh0ID0gIlBSQUMiOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBTdGFydCBQcmFjdGljZSBNYW5hZ2VyCiAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmFjdGljZU1hbmFnZXIpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnByYWN0aWNlTWFuYWdlci5zdGFydCgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIEluIHByYWN0aWNlLCBlbnN1cmUgQUkgaXMgZW5hYmxlZCBmb3Igc3BhcnJpbmcKICAgICAgICAgICAgICAgIGlmICh0aGlzLnRlYW1zLmF3YXkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRlYW1zLmF3YXkuYWlFbmFibGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKCiAgICAgICAgICAgICAgICAvLyBFbnN1cmUgUHJhY3RpY2UgTWFuYWdlciBpcyBzdG9wcGVkIGlmIG5vcm1hbCBnYW1lCiAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmFjdGljZU1hbmFnZXIpIHRoaXMucHJhY3RpY2VNYW5hZ2VyLnN0b3AoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gU2FmZXR5OiBFbnN1cmUgYWxsIHBsYXllcnMgYXJlIHZpc2libGUgKGluIGNhc2UgUHJhY3RpY2UgaGlkIHRoZW0pCiAgICAgICAgICAgICAgICAvLyBBbmQgRk9SQ0UgQUkgRU5BQkxFRCAoRml4IGZvciAiWm9tYmllcyIgaWYgY29taW5nIGZyb20gUHJhY3RpY2UgTW9kZSkKICAgICAgICAgICAgICAgIGlmICh0aGlzLnRlYW1zLmF3YXkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRlYW1zLmF3YXkucGxheWVycy5mb3JFYWNoKHAgPT4geyBpZihwLm1lc2gpIHAubWVzaC52aXNpYmxlID0gdHJ1ZTsgfSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50ZWFtcy5hd2F5LmFpRW5hYmxlZCA9IHRydWU7IAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMudGVhbXMuaG9tZSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMudGVhbXMuaG9tZS5wbGF5ZXJzLmZvckVhY2gocCA9PiB7IGlmKHAubWVzaCkgcC5tZXNoLnZpc2libGUgPSB0cnVlOyB9KTsKICAgICAgICAgICAgICAgIH0KCnRoaXMucmVzZXRSb3VuZCgpOwogICAgICAgICAgICB9Cn0KCnNldE1lbnVNb2RlKGlzQWN0aXZlKSB7CiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSBpc0FjdGl2ZSA/ICdtZW51JyA6ICdhY3RpdmUnOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGlzQWN0aXZlICYmIHRoaXMuYXVkaW9NYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICB0aGlzLmF1ZGlvTWFuYWdlci5zdG9wQkdNKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEhpZGUgSFVEIGluIG1lbnUKICAgICAgICAgICAgY29uc3QgaHVkVG9wID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2h1ZC10b3AnKTsKICAgICAgICAgICAgY29uc3Qgc3RhdHVzUGFuZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxheWVyLXN0YXR1cy1wYW5lbCcpOwogICAgICAgICAgICBjb25zdCBjb250cm9scyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY3Rpb24tY29udGFpbmVyJyk7CiAgICAgICAgICAgIGNvbnN0IGpveXN0aWNrID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pveXN0aWNrLWhpdC16b25lJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBkaXNwbGF5ID0gaXNBY3RpdmUgPyAnbm9uZScgOiAnZmxleCc7IC8vIG9yIGJsb2NrL2V0YwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGh1ZFRvcCkgaHVkVG9wLnN0eWxlLmRpc3BsYXkgPSBkaXNwbGF5OwogICAgICAgICAgICBpZiAoc3RhdHVzUGFuZWwpIHN0YXR1c1BhbmVsLnN0eWxlLmRpc3BsYXkgPSBpc0FjdGl2ZSA/ICdub25lJyA6ICdibG9jayc7IC8vIFN0YXR1cyBwYW5lbCBoYXMgc3BlY2lmaWMgbG9naWMKICAgICAgICAgICAgaWYgKGNvbnRyb2xzKSBjb250cm9scy5zdHlsZS5kaXNwbGF5ID0gaXNBY3RpdmUgPyAnbm9uZScgOiAnZmxleCc7CiAgICAgICAgICAgIGlmIChqb3lzdGljaykgam95c3RpY2suc3R5bGUuZGlzcGxheSA9IGlzQWN0aXZlID8gJ25vbmUnIDogJ2Jsb2NrJzsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIElmIGVudGVyaW5nIG1lbnUsIHJlc2V0IGNhbWVyYSB0byBhIG5pY2UgYW5nbGU/CiAgICAgICAgICAgIC8vIEhhbmRsZWQgYnkgdXBkYXRlIGxvb3AKICAgICAgICB9CnRvZ2dsZURlbW9Nb2RlKCkgewogICAgICAgICAgICB0aGlzLmlzRGVtb01vZGUgPSAhdGhpcy5pc0RlbW9Nb2RlOwogICAgICAgICAgICBjb25zb2xlLmxvZygiRGVtbyBNb2RlOiIsIHRoaXMuaXNEZW1vTW9kZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBVcGRhdGUgVUkgQnV0dG9uCiAgICAgICAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhdXRvLXRvZ2dsZScpOwogICAgICAgICAgICBpZiAoYnRuKSB7CiAgICAgICAgICAgICAgICBidG4uaW5uZXJUZXh0ID0gdGhpcy5pc0RlbW9Nb2RlID8gIkFVVE8gUElMT1QiIDogIk1BTlVBTCI7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0RlbW9Nb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgYnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBidG4uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEFubm91bmNlbWVudAogICAgICAgICAgICBjb25zdCB0ZXh0ID0gdGhpcy5pc0RlbW9Nb2RlID8gIkFVVE8gUElMT1QiIDogIk1BTlVBTCI7CiAgICAgICAgICAgIHRoaXMuc2hvd0Fubm91bmNlbWVudCh0ZXh0KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFZpc3VhbCBGbGFpcjogU3Bhd24gdGV4dCBhYm92ZSBhY3RpdmUgcGxheWVyCiAgICAgICAgICAgIGlmICh0aGlzLmlzRGVtb01vZGUgJiYgdGhpcy5mbG9hdGluZ1RleHQgJiYgdGhpcy50ZWFtcy5ob21lICYmIHRoaXMudGVhbXMuaG9tZS5hY3RpdmVQbGF5ZXIgJiYgdGhpcy50ZWFtcy5ob21lLmFjdGl2ZVBsYXllci5tZXNoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmZsb2F0aW5nVGV4dC5zcGF3bigiQUkgRU5HQUdFRCIsIHRoaXMudGVhbXMuaG9tZS5hY3RpdmVQbGF5ZXIubWVzaC5wb3NpdGlvbiwgImdvYWwiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQXV0by1oaWRlIGFubm91bmNlbWVudApzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnVpLmFubm91bmNlbWVudCAmJiB0aGlzLnVpLmFubm91bmNlbWVudC5pbm5lclRleHQgPT09IHRleHQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmhpZGVBbm5vdW5jZW1lbnQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0gVEVDSENPUFkgU1lTVEVNIC0tLQoKICAgICAgICB0cmlnZ2VyVGVjaEV2ZW50KHNvdXJjZVBsYXllciwgdGVjaE5hbWUpIHsKICAgICAgICAgICAgaWYgKCFzb3VyY2VQbGF5ZXIgfHwgIXNvdXJjZVBsYXllci50ZWFtKSByZXR1cm47CgogICAgICAgICAgICAvLyBGaW5kIG9wcG9zaW5nIHRlYW0KICAgICAgICAgICAgY29uc3Qgb3BwVGVhbUlkID0gc291cmNlUGxheWVyLnRlYW0uaWQgPT09ICdob21lJyA/ICdhd2F5JyA6ICdob21lJzsKICAgICAgICAgICAgY29uc3Qgb3BwVGVhbSA9IHRoaXMudGVhbXNbb3BwVGVhbUlkXTsKICAgICAgICAgICAgaWYgKCFvcHBUZWFtKSByZXR1cm47CgogICAgICAgICAgICAvLyBGaW5kIHdobyBpcyBtYXJraW5nIHRoaXMgc291cmNlCiAgICAgICAgICAgIGNvbnN0IGxlYXJuZXJzID0gb3BwVGVhbS5wbGF5ZXJzLmZpbHRlcihwID0+IHAubWFya2luZyA9PT0gc291cmNlUGxheWVyKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChsZWFybmVycy5sZW5ndGggPT09IDApIHJldHVybjsKCiAgICAgICAgICAgIC8vIE9ubHkgc2hvdyBVSSBpZiB0aGUgbGVhcm5pbmcgdGVhbSBpcyBIdW1hbiAoSG9tZSkKICAgICAgICAgICAgLy8gKE9yIGlmIHdlIGFyZSBpbiBEZW1vIG1vZGUgYW5kIHdhbnQgdG8gc2VlIGl0IGhhcHBlbiBmb3IgSG9tZSB0ZWFtKQogICAgICAgICAgICBpZiAob3BwVGVhbS5pc0h1bWFuKSB7CiAgICAgICAgICAgICAgICAvLyBGaWx0ZXIgb3V0IHRob3NlIHdobyBhbHJlYWR5IGtub3cgaXQKICAgICAgICAgICAgICAgIGNvbnN0IHZhbGlkTGVhcm5lcnMgPSBsZWFybmVycy5maWx0ZXIocCA9PiAhcC5sZWFybmVkVGVjaHMuaW5jbHVkZXModGVjaE5hbWUpKTsKICAgICAgICAgICAgICAgIGlmICh2YWxpZExlYXJuZXJzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0VGVjaENvcHlXaW5kb3codGVjaE5hbWUsIHZhbGlkTGVhcm5lcnMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKc3RhcnRUZWNoQ29weVdpbmRvdyh0ZWNoTmFtZSwgbGVhcm5lcnMpIHsKICAgICAgICAgICAgdGhpcy50ZWNoQ29weVN0YXRlLmFjdGl2ZSA9IHRydWU7CiAgICAgICAgICAgIHRoaXMudGVjaENvcHlTdGF0ZS5tYXhUaW1lID0gMC42OyAvLyAwLjZzIHdpbmRvdwogICAgICAgICAgICB0aGlzLnRlY2hDb3B5U3RhdGUudGltZXIgPSB0aGlzLnRlY2hDb3B5U3RhdGUubWF4VGltZTsKICAgICAgICAgICAgdGhpcy50ZWNoQ29weVN0YXRlLnRlY2ggPSB0ZWNoTmFtZTsKICAgICAgICAgICAgdGhpcy50ZWNoQ29weVN0YXRlLmxlYXJuZXJzID0gbGVhcm5lcnM7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTaG93IFVJCiAgICAgICAgICAgIGlmICh0aGlzLnVpLnRlY2hGbGFzaCkgewogICAgICAgICAgICAgICAgdGhpcy51aS50ZWNoRmxhc2guc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgICAgICAgICAgICAgIHRoaXMudWkudGVjaEZsYXNoLnN0eWxlLmJhY2tncm91bmQgPSAiIjsgLy8gUmVzZXQgYmFja2dyb3VuZAogICAgICAgICAgICAgICAgdGhpcy51aS50ZWNoRmxhc2gucXVlcnlTZWxlY3RvcignLnRlY2gtdGV4dCcpLmlubmVyVGV4dCA9ICJURUNIQ09QWSEiOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAodGhpcy51aS50ZWNoU3ViKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy51aS50ZWNoU3ViLmlubmVyVGV4dCA9IHRlY2hOYW1lLnJlcGxhY2UoJ18nLCAnICcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBSZXNldCBiYXIKICAgICAgICAgICAgICAgIGlmICh0aGlzLnVpLnRlY2hUaW1lckZpbGwpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLnRlY2hUaW1lckZpbGwuc3R5bGUud2lkdGggPSAnMTAwJSc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgphdHRlbXB0VGVjaENvcHkoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy50ZWNoQ29weVN0YXRlLmFjdGl2ZSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU3VjY2VzcyEKICAgICAgICAgICAgY29uc3QgdGVjaCA9IHRoaXMudGVjaENvcHlTdGF0ZS50ZWNoOwogICAgICAgICAgICBjb25zdCBsZWFybmVycyA9IHRoaXMudGVjaENvcHlTdGF0ZS5sZWFybmVyczsKICAgICAgICAgICAgCiAgICAgICAgICAgIGxlYXJuZXJzLmZvckVhY2gocCA9PiB7CiAgICAgICAgICAgICAgICAvLyBEb3VibGUgY2hlY2sgdG8gcHJldmVudCBkdXBsaWNhdGVzCiAgICAgICAgICAgICAgICBpZiAoIXAubGVhcm5lZFRlY2hzLmluY2x1ZGVzKHRlY2gpKSB7CiAgICAgICAgICAgICAgICAgICAgcC5sZWFybmVkVGVjaHMucHVzaCh0ZWNoKTsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgJHtwLnJvbGV9IGxlYXJuZWQgJHt0ZWNofSFgKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyAxLiBGbG9hdGluZyBUZXh0CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZmxvYXRpbmdUZXh0ICYmIHAubWVzaCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZsb2F0aW5nVGV4dC5zcGF3bihgTEVBUk5FRCFgLCBwLm1lc2gucG9zaXRpb24sICJ0ZWNoIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIDIuIFBhcnRpY2xlIEVmZmVjdCAoU3BpcmFsKQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnBhcnRpY2xlTWFuYWdlciAmJiBwLm1lc2gpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3Bhd24gbXVsdGlwbGUgcGFydGljbGVzIGZvciBhIHN3aXJsIGVmZmVjdAogICAgICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTwxMDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcnRpY2xlTWFuYWdlci5zcGF3bignbGVhcm5lZCcsIHAubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBpICogNTApOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHRoaXMuZW5kVGVjaENvcHlXaW5kb3codHJ1ZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCmVuZFRlY2hDb3B5V2luZG93KHN1Y2Nlc3MpIHsKICAgICAgICAgICAgdGhpcy50ZWNoQ29weVN0YXRlLmFjdGl2ZSA9IGZhbHNlOwogICAgICAgICAgICBpZiAodGhpcy51aS50ZWNoRmxhc2gpIHsKICAgICAgICAgICAgICAgIGlmIChzdWNjZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy51aS50ZWNoRmxhc2gucXVlcnlTZWxlY3RvcignLnRlY2gtdGV4dCcpLmlubmVyVGV4dCA9ICJTVUNDRVNTISI7CiAgICAgICAgICAgICAgICAgICAgLy8gRmxhc2ggc3VjY2VzcyBjb2xvciAoV2hpdGUgZmxhc2gpCiAgICAgICAgICAgICAgICAgICAgdGhpcy51aS50ZWNoRmxhc2guc3R5bGUuYmFja2dyb3VuZCA9ICJyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuOCkiOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEhpZGUgYWZ0ZXIgc2hvcnQgZGVsYXkgdG8gc2hvdyB0aGUgc3VjY2VzcyBmbGFzaAogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4geyAKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS50ZWNoRmxhc2guc3R5bGUuZGlzcGxheSA9ICdub25lJzsgCiAgICAgICAgICAgICAgICAgICAgfSwgMzAwKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gRmFpbGVkIC8gTWlzc2VkCiAgICAgICAgICAgICAgICAgICAgdGhpcy51aS50ZWNoRmxhc2guc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KX3VwZGF0ZVBsYXllclN0YXR1c1VJKCkgewogICAgICAgICAgICBpZiAoIXRoaXMudGVhbXMuaG9tZSB8fCAhdGhpcy50ZWFtcy5ob21lLmFjdGl2ZVBsYXllcikgcmV0dXJuOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgcCA9IHRoaXMudGVhbXMuaG9tZS5hY3RpdmVQbGF5ZXI7CiAgICAgICAgICAgIGNvbnN0IHVpID0gdGhpcy51aS5zdGF0dXNQYW5lbDsKICAgICAgICAgICAgCi8vIFVJIFVwZGF0ZXMgKEFjdGlvbiBCdXR0b24gQ29udGV4dCkKICAgICAgICAgICAgICAgIHVpLmNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gTmFtZSAmIExldmVsCiAgICAgICAgICAgICAgICBpZiAodWkubmFtZSkgdWkubmFtZS5pbm5lclRleHQgPSBgJHtwLmNoYXJhY3Rlck5hbWUgfHwgcC5yb2xlfSBMViR7cC5sZXZlbH1gOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBIUAogICAgICAgICAgICAgICAgaWYgKHVpLmhwQmFyKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaHBQY3QgPSBNYXRoLm1heCgwLCBNYXRoLm1pbigxMDAsIChwLnN0YXRzLkhQIC8gcC5zdGF0cy5tYXhIUCkgKiAxMDApKTsKICAgICAgICAgICAgICAgICAgICB1aS5ocEJhci5zdHlsZS53aWR0aCA9IGAke2hwUGN0fSVgOwogICAgICAgICAgICAgICAgICAgIC8vIENvbG9yIHNoaWZ0CiAgICAgICAgICAgICAgICAgICAgaWYgKGhwUGN0IDwgMjUpIHVpLmhwQmFyLnN0eWxlLmJhY2tncm91bmQgPSAnbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjZmYwMDAwLCAjZmY0NDQ0KSc7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoaHBQY3QgPCA1MCkgdWkuaHBCYXIuc3R5bGUuYmFja2dyb3VuZCA9ICdsaW5lYXItZ3JhZGllbnQoOTBkZWcsICNmZmZmMDAsICNmZmZmODgpJzsKICAgICAgICAgICAgICAgICAgICBlbHNlIHVpLmhwQmFyLnN0eWxlLmJhY2tncm91bmQgPSAnbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjMDBmZjAwLCAjY2NmZmNjKSc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodWkuaHBUZXh0KSB1aS5ocFRleHQuaW5uZXJUZXh0ID0gYCR7TWF0aC5mbG9vcihwLnN0YXRzLkhQKX0vJHtwLnN0YXRzLm1heEhQfWA7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEVYUAogICAgICAgICAgICAgICAgaWYgKHVpLmV4cEJhcikgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4cFBjdCA9IE1hdGgubWF4KDAsIE1hdGgubWluKDEwMCwgKHAuZXhwIC8gcC5uZXh0TGV2ZWxFeHApICogMTAwKSk7CiAgICAgICAgICAgICAgICAgICAgdWkuZXhwQmFyLnN0eWxlLndpZHRoID0gYCR7ZXhwUGN0fSVgOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9Cl9pbml0UGFydGljbGVzKCkgewogICAgICAgICAgICB0aGlzLnNwYXJrUG9vbCA9IFtdOwogICAgICAgICAgICB0aGlzLmFjdGl2ZVNwYXJrcyA9IFtdOwogICAgICAgICAgICBjb25zdCBwb29sU2l6ZSA9IDQwOyAvLyBTdWZmaWNpZW50IGZvciBjb250aW51b3VzIGdyaW5kaW5nCiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBvb2xTaXplOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNwcml0ZSA9IG5ldyBUSFJFRS5TcHJpdGUoX3NwYXJrTWF0ZXJpYWwuY2xvbmUoKSk7CiAgICAgICAgICAgICAgICBzcHJpdGUudmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5zY2VuZS5hZGQoc3ByaXRlKTsKICAgICAgICAgICAgICAgIHRoaXMuc3BhcmtQb29sLnB1c2goc3ByaXRlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgc3Bhd25DbGFzaChwb3MsIGludGVuc2l0eSA9IDEuMCkgewogICAgICAgICAgICAvLyBGaW5kIGZyZWUgc3BhcmsKICAgICAgICAgICAgY29uc3Qgc3BhcmsgPSB0aGlzLnNwYXJrUG9vbC5maW5kKHMgPT4gIXMudmlzaWJsZSk7CiAgICAgICAgICAgIGlmICghc3BhcmspIHJldHVybjsgLy8gUG9vbCBleGhhdXN0ZWQKICAgICAgICAgICAgCiAgICAgICAgICAgIHNwYXJrLnBvc2l0aW9uLmNvcHkocG9zKTsKICAgICAgICAgICAgc3BhcmsudmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBSYW5kb21pemUgcm90YXRpb24KICAgICAgICAgICAgc3BhcmsubWF0ZXJpYWwucm90YXRpb24gPSBNYXRoLnJhbmRvbSgpICogTWF0aC5QSTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEluaXRpYWxpemUgQWN0aXZlIFN0YXRlCiAgICAgICAgICAgIHRoaXMuYWN0aXZlU3BhcmtzLnB1c2goewogICAgICAgICAgICAgICAgbWVzaDogc3BhcmssCiAgICAgICAgICAgICAgICBhZ2U6IDAsCiAgICAgICAgICAgICAgICBsaWZlOiAwLjE1ICsgTWF0aC5yYW5kb20oKSAqIDAuMTUsIC8vIEZhc3QsIHB1bmNoeSBzcGFya3MKICAgICAgICAgICAgICAgIG1heFNjYWxlOiAyLjUgKiBpbnRlbnNpdHksCiAgICAgICAgICAgICAgICB2ZWxvY2l0eTogbmV3IFRIUkVFLlZlY3RvcjMoCiAgICAgICAgICAgICAgICAgICAgKE1hdGgucmFuZG9tKCktMC41KSo4LCAKICAgICAgICAgICAgICAgICAgICAoTWF0aC5yYW5kb20oKS0wLjUpKjgsIAogICAgICAgICAgICAgICAgICAgIChNYXRoLnJhbmRvbSgpLTAuNSkqOAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIF91cGRhdGVQYXJ0aWNsZXMoZHQpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IHRoaXMuYWN0aXZlU3BhcmtzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwID0gdGhpcy5hY3RpdmVTcGFya3NbaV07CiAgICAgICAgICAgICAgICBwLmFnZSArPSBkdDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKHAuYWdlID49IHAubGlmZSkgewogICAgICAgICAgICAgICAgICAgIHAubWVzaC52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVTcGFya3Muc3BsaWNlKGksIDEpOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCB0ID0gcC5hZ2UgLyBwLmxpZmU7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEV4cGFuZAogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFNjYWxlID0gMC41ICsgKHAubWF4U2NhbGUgLSAwLjUpICogdDsKICAgICAgICAgICAgICAgIHAubWVzaC5zY2FsZS5zZXRTY2FsYXIoY3VycmVudFNjYWxlKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRmFkZSBvdXQKICAgICAgICAgICAgICAgIHAubWVzaC5tYXRlcmlhbC5vcGFjaXR5ID0gMS4wIC0gKHQgKiB0KTsgLy8gUXVhZHJhdGljIGZhZGUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gTW92ZQogICAgICAgICAgICAgICAgcC5tZXNoLnBvc2l0aW9uLmFkZFNjYWxlZFZlY3RvcihwLnZlbG9jaXR5LCBkdCk7CiAgICAgICAgICAgICAgICBwLm1lc2gubWF0ZXJpYWwucm90YXRpb24gKz0gMTAuMCAqIGR0OwogICAgICAgICAgICB9CiAgICAgICAgfQoKLy8gSGVscGVyIGZvciBpbXBhY3QgZnJhbWVzCgp0cmlnZ2VySW1wYWN0KGR1cmF0aW9uLCB0eXBlID0gJ2RlZmF1bHQnKSB7CiAgICAgICAgICAgIHRoaXMuaW1wYWN0UGF1c2UgPSBkdXJhdGlvbjsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYW1lLWNvbnRhaW5lcicpOwogICAgICAgICAgICBpZiAoIWNvbnRhaW5lcikgcmV0dXJuOwoKICAgICAgICAgICAgLy8gUmVzZXQgY2xhc3NlcyB0byBlbnN1cmUgYW5pbWF0aW9uIHJlc3RhcnRzCiAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdpbXBhY3QtZngnLCAnaW1wYWN0LWhlYXZ5JywgJ2ltcGFjdC1zaGF0dGVyJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBGb3JjZSByZWZsb3cKICAgICAgICAgICAgdm9pZCBjb250YWluZXIub2Zmc2V0V2lkdGg7CgogICAgICAgICAgICBsZXQgY2xhc3NOYW1lID0gJ2ltcGFjdC1meCc7CiAgICAgICAgICAgIGlmICh0eXBlID09PSAnaGVhdnknKSBjbGFzc05hbWUgPSAnaW1wYWN0LWhlYXZ5JzsKICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdzaGF0dGVyJykgY2xhc3NOYW1lID0gJ2ltcGFjdC1zaGF0dGVyJzsKCiAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKGNsYXNzTmFtZSk7CgogICAgICAgICAgICAvLyBBdXRvLXJlbW92ZSBjbGFzcyBhZnRlciBkdXJhdGlvbgogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKGNsYXNzTmFtZSk7CiAgICAgICAgICAgIH0sIGR1cmF0aW9uICogMTAwMCArIDEwMCk7CiAgICAgICAgfQogICAgfQoKICAgIHdpbmRvdy5mbHV4LkdhbWVNYW5hZ2VyID0gR2FtZU1hbmFnZXI7Cn0pKCk7","/GameManager.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCi8vIFNwYXJrIFRleHR1cmUgKFByb2NlZHVyYWwgQnVyc3QpCiAgICBjb25zdCBfc3BhcmtUZXh0dXJlID0gKCgpID0+IHsKICAgICAgICBjb25zdCBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgYy53aWR0aCA9IDY0OyBjLmhlaWdodCA9IDY0OwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjdHguY2xlYXJSZWN0KDAsMCw2NCw2NCk7CiAgICAgICAgCiAgICAgICAgLy8gQnVyc3Qgc2hhcGUKICAgICAgICBjb25zdCBjeCA9IDMyLCBjeSA9IDMyOwogICAgICAgIGNvbnN0IHNwaWtlcyA9IDg7CiAgICAgICAgY29uc3Qgb3V0ZXIgPSAzMDsKICAgICAgICBjb25zdCBpbm5lciA9IDEwOwogICAgICAgIAogICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICBmb3IobGV0IGk9MDsgaTxzcGlrZXMqMjsgaSsrKXsKICAgICAgICAgICAgY29uc3QgciA9IChpJTI9PT0wKT8gb3V0ZXIgOiBpbm5lcjsKICAgICAgICAgICAgY29uc3QgYSA9IChNYXRoLlBJKmkpL3NwaWtlczsKICAgICAgICAgICAgY3R4LmxpbmVUbyhjeCArIE1hdGguY29zKGEpKnIsIGN5ICsgTWF0aC5zaW4oYSkqcik7CiAgICAgICAgfQogICAgICAgIGN0eC5jbG9zZVBhdGgoKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gJyNmZmNjMDAnOwogICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgCiAgICAgICAgLy8gV2hpdGUgQ29yZQogICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICBjdHguYXJjKGN4LCBjeSwgOCwgMCwgTWF0aC5QSSoyKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gJyNmZmZmZmYnOwogICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIG5ldyBUSFJFRS5DYW52YXNUZXh0dXJlKGMpOwogICAgfSkoKTsKCiAgICBjb25zdCBfc3BhcmtNYXRlcmlhbCA9IG5ldyBUSFJFRS5TcHJpdGVNYXRlcmlhbCh7IAogICAgICAgIG1hcDogX3NwYXJrVGV4dHVyZSwgCiAgICAgICAgdHJhbnNwYXJlbnQ6IHRydWUsIAogICAgICAgIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nLAogICAgICAgIGRlcHRoV3JpdGU6IGZhbHNlCiAgICB9KTsKCiAgICBjbGFzcyBHYW1lTWFuYWdlciB7CgogICAgICAgIApjb25zdHJ1Y3RvcihzY2VuZSwgdWlMYXllcklkLCBjYW1lcmEsIHJlbmRlcmVyKSB7CndpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSA9IHRoaXM7CiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIgPSByZW5kZXJlcjsgLy8gU3RvcmUgcmVuZGVyZXIKICAgICAgICAgICAgdGhpcy5zY2VuZSA9IHNjZW5lOwogICAgICAgICAgICB0aGlzLmNhbWVyYSA9IGNhbWVyYTsKICAgICAgICAgICAgdGhpcy51aUxheWVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodWlMYXllcklkKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHRoaXMuc2NvcmUgPSB7IGhvbWU6IDAsIGF3YXk6IDAgfTsKICAgICAgICAgICAgdGhpcy50aW1lID0gMDsKICAgICAgICAgICAgdGhpcy5oYWxmID0gMTsKICAgICAgICAgICAgdGhpcy5oYWxmRHVyYXRpb24gPSAzMDA7IC8vIDUgbWludXRlcyAoc2Vjb25kcykKICAgICAgICAgICAgdGhpcy5pc092ZXJ0aW1lID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuaXNEZW1vTW9kZSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmdhbWVNb2RlID0gJ25vcm1hbCc7IC8vICdub3JtYWwnIG9yICdwcmFjdGljZScKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEltcGFjdCBGcmFtZXMKICAgICAgICAgICAgdGhpcy5pbXBhY3RQYXVzZSA9IDA7CiAgICAgICAgICAgIAogICAgICAgICAgICB0aGlzLnN0YXRlID0gJ21lbnUnOyAvLyBTdGFydCBpbiBtZW51CnRoaXMudGVhbXMgPSB7CiAgICAgICAgICAgICAgICBob21lOiBudWxsLAogICAgICAgICAgICAgICAgYXdheTogbnVsbAogICAgICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5lbnRpdGllcyA9IHsKICAgICAgICAgICAgICAgIGJhbGw6IG51bGwKICAgICAgICAgICAgfTsKCnRoaXMudWkgPSB7CiAgICAgICAgICAgICAgICBzY29yZVBsYXllcjogbnVsbCwKICAgICAgICAgICAgICAgIHNjb3JlQ3B1OiBudWxsLAogICAgICAgICAgICAgICAgdGltZXI6IG51bGwsCiAgICAgICAgICAgICAgICBoYWxmOiBudWxsLAogICAgICAgICAgICAgICAgYW5ub3VuY2VtZW50OiBudWxsLAogICAgICAgICAgICAgICAgLy8gUGxheWVyIFN0YXR1cyBQYW5lbAogICAgICAgICAgICAgICAgc3RhdHVzUGFuZWw6IHsKICAgICAgICAgICAgICAgICAgICBjb250YWluZXI6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgbmFtZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICBocEJhcjogbnVsbCwKICAgICAgICAgICAgICAgICAgICBocFRleHQ6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgZXhwQmFyOiBudWxsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBUZWNoY29weSBTdGF0ZQogICAgICAgICAgICB0aGlzLnRlY2hDb3B5U3RhdGUgPSB7CiAgICAgICAgICAgICAgICBhY3RpdmU6IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDAsCiAgICAgICAgICAgICAgICB0ZWNoOiBudWxsLAogICAgICAgICAgICAgICAgbGVhcm5lcnM6IFtdCiAgICAgICAgICAgIH07Cgp0aGlzLm1pbmlNYXAgPSBuZXcgd2luZG93LmZsdXguTWluaU1hcCgpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gSW5pdGlhbGl6ZSBGbG9hdGluZyBUZXh0Ci8vIEluaXRpYWxpemUgRmxvYXRpbmcgVGV4dAogICAgICAgICAgICB0aGlzLmZsb2F0aW5nVGV4dCA9IG5ldyB3aW5kb3cuZmx1eC5GbG9hdGluZ1RleHRNYW5hZ2VyKHNjZW5lLCB1aUxheWVySWQsIGNhbWVyYSk7CiAgICAgICAgICAgIAovLyBJbml0aWFsaXplIFBhcnRpY2xlIE1hbmFnZXIgKFN0YXR1cyBFZmZlY3RzKQogICAgICAgICAgICB0aGlzLnBhcnRpY2xlTWFuYWdlciA9IG5ldyB3aW5kb3cuZmx1eC5QYXJ0aWNsZU1hbmFnZXIoc2NlbmUpOwp0aGlzLmdseXBoTWFuYWdlciA9IG51bGw7IC8vIEluamVjdGVkIGJ5IG1haW4uanMKICAgICAgICAgICAgdGhpcy5faW5pdFBhcnRpY2xlcygpOyAvLyAzRCBTcGFyayBTeXN0ZW0gKExlZ2FjeS9JbXBhY3QpCgp0aGlzLmRlYnVnVmlzdWFsaXplciA9IG5ldyB3aW5kb3cuZmx1eC5EZWJ1Z1Zpc3VhbGl6ZXIoc2NlbmUpOwogICAgICAgICAgICB0aGlzLnByYWN0aWNlTWFuYWdlciA9IG5ldyB3aW5kb3cuZmx1eC5QcmFjdGljZU1hbmFnZXIodGhpcyk7IC8vIEluaXRpYWxpemUgUHJhY3RpY2UgTWFuYWdlcgogICAgICAgICAgICB0aGlzLl9pbmplY3RTdHlsZXMoKTsKICAgICAgICAgICAgdGhpcy5faW5pdFVJKCk7CiAgICAgICAgfQoKICAgICAgICBfaW5qZWN0U3R5bGVzKCkgewogICAgICAgICAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZsdXgtZHluYW1pYy1zdHlsZXMnKSkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBzdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7CiAgICAgICAgICAgIHN0eWxlLmlkID0gJ2ZsdXgtZHluYW1pYy1zdHlsZXMnOwpzdHlsZS50ZXh0Q29udGVudCA9IGAKICAgICAgICAgICAgICAgIEBrZXlmcmFtZXMgdGV4dFNsYW0gewogICAgICAgICAgICAgICAgICAgIDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSkgc2NhbGUoNCk7IG9wYWNpdHk6IDA7IGxldHRlci1zcGFjaW5nOiA1MHB4OyB9CiAgICAgICAgICAgICAgICAgICAgMTAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSkgc2NhbGUoMSk7IG9wYWNpdHk6IDE7IGxldHRlci1zcGFjaW5nOiA1cHg7IH0KICAgICAgICAgICAgICAgICAgICAxNSUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKSBzY2FsZSgxLjEpOyB9CiAgICAgICAgICAgICAgICAgICAgMjAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSkgc2NhbGUoMSk7IH0KICAgICAgICAgICAgICAgICAgICA4MCUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKSBzY2FsZSgxKTsgb3BhY2l0eTogMTsgZmlsdGVyOiBibHVyKDBweCk7IH0KICAgICAgICAgICAgICAgICAgICAxMDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSkgc2NhbGUoMS41KTsgb3BhY2l0eTogMDsgZmlsdGVyOiBibHVyKDEwcHgpOyB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC5hbm5vdW5jZW1lbnQtc2xhbSB7CiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICAgICAgICAgICAgICAgIHRvcDogNDUlOyBsZWZ0OiA1MCU7CiAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSk7CiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgICAgICAgICAgICAgICAgIGZvbnQtZmFtaWx5OiAnSW1wYWN0Jywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgICAgICAgICBmb250LXNpemU6IDk2cHg7CiAgICAgICAgICAgICAgICAgICAgZm9udC1zdHlsZTogaXRhbGljOwogICAgICAgICAgICAgICAgICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KHRvIGJvdHRvbSwgI2ZmZmZmZiAwJSwgI2ZmZGQwMCA0NSUsICNmZjg4MDAgMTAwJSk7CiAgICAgICAgICAgICAgICAgICAgLXdlYmtpdC1iYWNrZ3JvdW5kLWNsaXA6IHRleHQ7CiAgICAgICAgICAgICAgICAgICAgLXdlYmtpdC10ZXh0LWZpbGwtY29sb3I6IHRyYW5zcGFyZW50OwogICAgICAgICAgICAgICAgICAgIGZpbHRlcjogZHJvcC1zaGFkb3coMCAwIDEwcHggcmdiYSgwLDAsMCwxKSkgZHJvcC1zaGFkb3coMCAwIDMwcHggcmdiYSgyNTUsIDEwMCwgMCwgMC42KSk7CiAgICAgICAgICAgICAgICAgICAgei1pbmRleDogMjAwMDsKICAgICAgICAgICAgICAgICAgICBhbmltYXRpb246IHRleHRTbGFtIDEuOHMgY3ViaWMtYmV6aWVyKDAuMSwgMC44LCAwLjEsIDEpIGZvcndhcmRzOwogICAgICAgICAgICAgICAgICAgIHBvaW50ZXItZXZlbnRzOiBub25lOwogICAgICAgICAgICAgICAgICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLm1vZGFsLW92ZXJsYXkgewogICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiAwOyBsZWZ0OiAwOyB3aWR0aDogMTAwJTsgaGVpZ2h0OiAxMDAlOwogICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6IHJhZGlhbC1ncmFkaWVudChjaXJjbGUgYXQgY2VudGVyLCByZ2JhKDEwLCAyNSwgNjAsIDAuOTUpIDAlLCByZ2JhKDAsIDAsIDAsIDAuOTgpIDEwMCUpOwogICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7IGp1c3RpZnktY29udGVudDogY2VudGVyOyBhbGlnbi1pdGVtczogY2VudGVyOyBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICAgICAgICAgICAgICAgIHotaW5kZXg6IDE5MDA7CiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMDsgcG9pbnRlci1ldmVudHM6IG5vbmU7IHRyYW5zaXRpb246IG9wYWNpdHkgMC44czsKICAgICAgICAgICAgICAgICAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoOHB4KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC5tb2RhbC1vdmVybGF5LmFjdGl2ZSB7IG9wYWNpdHk6IDE7IHBvaW50ZXItZXZlbnRzOiBhdXRvOyB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC5tb2RhbC10aXRsZSB7CiAgICAgICAgICAgICAgICAgICAgZm9udC1mYW1pbHk6ICdHYXJhbW9uZCcsIHNlcmlmOwogICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogNTJweDsgY29sb3I6ICNmZmY7CiAgICAgICAgICAgICAgICAgICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsKICAgICAgICAgICAgICAgICAgICB0ZXh0LXNoYWRvdzogMCAwIDIwcHggIzAwYWFmZiwgMCAwIDQwcHggIzAwNDRhYTsKICAgICAgICAgICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAzMHB4OwogICAgICAgICAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDJweCBzb2xpZCAjMDBhYWZmOwogICAgICAgICAgICAgICAgICAgIHBhZGRpbmctYm90dG9tOiAxMHB4OwogICAgICAgICAgICAgICAgICAgIHdpZHRoOiA4MCU7IHRleHQtYWxpZ246IGNlbnRlcjsKICAgICAgICAgICAgICAgICAgICBsZXR0ZXItc3BhY2luZzogNXB4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAubW9kYWwtc2NvcmUtY29udGFpbmVyIHsKICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBnYXA6IDQwcHg7CiAgICAgICAgICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogNDBweDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC5tb2RhbC1zY29yZSB7CiAgICAgICAgICAgICAgICAgICAgZm9udC1mYW1pbHk6ICdJbXBhY3QnLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogODBweDsgY29sb3I6ICNmZmQ3MDA7CiAgICAgICAgICAgICAgICAgICAgbGV0dGVyLXNwYWNpbmc6IDVweDsKICAgICAgICAgICAgICAgICAgICB0ZXh0LXNoYWRvdzogMCAwIDIwcHggI2I4ODYwYjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC5tb2RhbC12cyB7CiAgICAgICAgICAgICAgICAgICAgZm9udC1mYW1pbHk6ICdDb3VyaWVyIE5ldycsIG1vbm9zcGFjZTsKICAgICAgICAgICAgICAgICAgICBmb250LXNpemU6IDI0cHg7IGNvbG9yOiAjMDBhYWZmOyBvcGFjaXR5OiAwLjc7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLmZsYXNoLW92ZXJsYXkgewogICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiAwOyBsZWZ0OiAwOyB3aWR0aDogMTAwJTsgaGVpZ2h0OiAxMDAlOwogICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6IHdoaXRlOwogICAgICAgICAgICAgICAgICAgIHotaW5kZXg6IDIxMDA7CiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMDsgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbjogb3BhY2l0eSAwLjFzIGVhc2Utb3V0OwogICAgICAgICAgICAgICAgICAgIG1peC1ibGVuZC1tb2RlOiBvdmVybGF5OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIEBrZXlmcmFtZXMgY2xhc2hQb3AgewogICAgICAgICAgICAgICAgICAgIDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSkgc2NhbGUoMC41KTsgb3BhY2l0eTogMTsgfQogICAgICAgICAgICAgICAgICAgIDUwJSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpIHNjYWxlKDEuNSk7IG9wYWNpdHk6IDAuODsgfQogICAgICAgICAgICAgICAgICAgIDEwMCUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKSBzY2FsZSgyLjApOyBvcGFjaXR5OiAwOyB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLmNsYXNoLXNwYXJrIHsKICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDYwcHg7IGhlaWdodDogNjBweDsKICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiByYWRpYWwtZ3JhZGllbnQoY2lyY2xlLCAjZmZmZmZmIDAlLCAjZmZmZjAwIDQwJSwgdHJhbnNwYXJlbnQgNzAlKTsKICAgICAgICAgICAgICAgICAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICAgICAgICAgICAgICAgICAgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgICAgICAgICAgICAgICAgICAgei1pbmRleDogMTUwMDsKICAgICAgICAgICAgICAgICAgICBtaXgtYmxlbmQtbW9kZTogc2NyZWVuOwogICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogY2xhc2hQb3AgMC4zcyBlYXNlLW91dCBmb3J3YXJkczsKICAgICAgICAgICAgICAgICAgICBib3gtc2hhZG93OiAwIDAgMjBweCAjZmZhYTAwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBgOwogICAgICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHN0eWxlKTsKICAgICAgICB9CgogICAgICAgIHJlZ2lzdGVyVGVhbXMoaG9tZVRlYW0sIGF3YXlUZWFtLCBiYWxsKSB7CiAgICAgICAgICAgIHRoaXMudGVhbXMuaG9tZSA9IGhvbWVUZWFtOwogICAgICAgICAgICB0aGlzLnRlYW1zLmF3YXkgPSBhd2F5VGVhbTsKdGhpcy5lbnRpdGllcy5iYWxsID0gYmFsbDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEluaXRpYWxpemUgTWluaU1hcAogICAgICAgICAgICBpZiAodGhpcy5taW5pTWFwKSB7CiAgICAgICAgICAgICAgICB0aGlzLm1pbmlNYXAuaW5pdChob21lVGVhbSwgYXdheVRlYW0sIGJhbGwpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKX2luaXRVSSgpIHsKICAgICAgICAgICAgLy8gQmluZCB0byBleGlzdGluZyBIVE1MIGVsZW1lbnRzCiAgICAgICAgICAgIHRoaXMudWkuc2NvcmVQbGF5ZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NvcmUtcGxheWVyJyk7CiAgICAgICAgICAgIHRoaXMudWkuc2NvcmVDcHUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NvcmUtY3B1Jyk7CiAgICAgICAgICAgIHRoaXMudWkudGltZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGltZXItZGlzcGxheScpOwogICAgICAgICAgICB0aGlzLnVpLmhhbGYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGFsZi1pbmRpY2F0b3InKTsKICAgICAgICAgICAgdGhpcy51aS5hbm5vdW5jZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5ub3VuY2VtZW50Jyk7CiAgICAgICAgICAgIAogICAgICAgICAgICB0aGlzLnVpLnRlY2hGbGFzaCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0ZWNoLWZsYXNoLW92ZXJsYXknKTsKICAgICAgICAgICAgaWYgKHRoaXMudWkudGVjaEZsYXNoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnVpLnRlY2hTdWIgPSB0aGlzLnVpLnRlY2hGbGFzaC5xdWVyeVNlbGVjdG9yKCcudGVjaC1zdWItdGV4dCcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMudWkudGVjaFRpbWVyRmlsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50ZWNoLXRpbWVyLWZpbGwnKTsKCiAgICAgICAgICAgIC8vIEJpbmQgUGxheWVyIFN0YXR1cyBQYW5lbAogICAgICAgICAgICB0aGlzLnVpLnN0YXR1c1BhbmVsLmNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwbGF5ZXItc3RhdHVzLXBhbmVsJyk7CiAgICAgICAgICAgIHRoaXMudWkuc3RhdHVzUGFuZWwubmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwbGF5ZXItc3RhdHVzLXBhbmVsIC5jaGFyLW5hbWUnKTsKICAgICAgICAgICAgdGhpcy51aS5zdGF0dXNQYW5lbC5ocEJhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwbGF5ZXItc3RhdHVzLXBhbmVsIC5ocC1iYXItZmlsbCcpOwogICAgICAgICAgICB0aGlzLnVpLnN0YXR1c1BhbmVsLmhwVGV4dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwbGF5ZXItc3RhdHVzLXBhbmVsIC5ocC12YWx1ZScpOwogICAgICAgICAgICB0aGlzLnVpLnN0YXR1c1BhbmVsLmV4cEJhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwbGF5ZXItc3RhdHVzLXBhbmVsIC50ZWNoLWJhci1maWxsJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBDcmVhdGUgTW9kYWwgT3ZlcmxheQogICAgICAgICAgICB0aGlzLnVpLm1vZGFsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIHRoaXMudWkubW9kYWwuY2xhc3NOYW1lID0gJ21vZGFsLW92ZXJsYXknOwogICAgICAgICAgICB0aGlzLnVpLm1vZGFsLmlubmVySFRNTCA9IGAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1vZGFsLXRpdGxlIj5IQUxGIFRJTUU8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1vZGFsLXNjb3JlLWNvbnRhaW5lciI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibW9kYWwtc2NvcmUiIGlkPSJtb2RhbC1zY29yZS1ob21lIj4wPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibW9kYWwtdnMiPi08L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtb2RhbC1zY29yZSIgaWQ9Im1vZGFsLXNjb3JlLWF3YXkiPjA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBpZD0ibW9kYWwtbXNnIiBzdHlsZT0iY29sb3I6ICMwMGFhZmY7IGZvbnQtc2l6ZTogMTRweDsgbGV0dGVyLXNwYWNpbmc6IDJweDsiPlBSRVBBUklORyAyTkQgSEFMRi4uLjwvZGl2PgogICAgICAgICAgICBgOwogICAgICAgICAgICB0aGlzLnVpTGF5ZXIuYXBwZW5kQ2hpbGQodGhpcy51aS5tb2RhbCk7CgogICAgICAgICAgICAvLyBDcmVhdGUgRmxhc2ggT3ZlcmxheQogICAgICAgICAgICB0aGlzLnVpLmZsYXNoID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIHRoaXMudWkuZmxhc2guY2xhc3NOYW1lID0gJ2ZsYXNoLW92ZXJsYXknOwogICAgICAgICAgICB0aGlzLnVpTGF5ZXIuYXBwZW5kQ2hpbGQodGhpcy51aS5mbGFzaCk7CgogICAgICAgICAgICAvLyBJbml0aWFsIFN0YXRlCiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVNjb3JlVUkoKTsKICAgICAgICAgICAgaWYgKHRoaXMudWkudGltZXIpIHRoaXMudWkudGltZXIuaW5uZXJUZXh0ID0gIjAwOjAwIjsKICAgICAgICB9CiAgICAgICAgX3VwZGF0ZVNjb3JlVUkoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnVpLnNjb3JlUGxheWVyKSB0aGlzLnVpLnNjb3JlUGxheWVyLmlubmVyVGV4dCA9IHRoaXMuc2NvcmUuaG9tZTsKICAgICAgICAgICAgaWYgKHRoaXMudWkuc2NvcmVDcHUpIHRoaXMudWkuc2NvcmVDcHUuaW5uZXJUZXh0ID0gdGhpcy5zY29yZS5hd2F5OwogICAgICAgIH0KCnVwZGF0ZVByYWN0aWNlKGR0KSB7CiAgICAgICAgICAgIC8vIERlbGVnYXRlIGxvZ2ljIHRvIFByYWN0aWNlTWFuYWdlcgogICAgICAgICAgICBpZiAodGhpcy5wcmFjdGljZU1hbmFnZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMucHJhY3RpY2VNYW5hZ2VyLnVwZGF0ZShkdCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHVwZGF0ZShkdCkgewogICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSA9PT0gJ21lbnUnKSB7CiAgICAgICAgICAgICAgICAvLyBNZW51IEJhY2tncm91bmQgTG9naWMgKENhbWVyYSBPcmJpdCkKICAgICAgICAgICAgICAgIGlmICh0aGlzLmNhbWVyYU1hbmFnZXIpIHsKICAgICAgICAgICAgICAgICAgICAvLyBTbG93IG9yYml0IGFyb3VuZCBjZW50ZXIKICAgICAgICAgICAgICAgICAgICBjb25zdCB0aW1lID0gRGF0ZS5ub3coKSAqIDAuMDAwMTsKICAgICAgICAgICAgICAgICAgICBjb25zdCByYWRpdXMgPSA0MDsKICAgICAgICAgICAgICAgICAgICBjb25zdCB4ID0gTWF0aC5zaW4odGltZSkgKiByYWRpdXM7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgeiA9IE1hdGguY29zKHRpbWUpICogcmFkaXVzOwogICAgICAgICAgICAgICAgICAgIC8vIE5vdGU6IENhbWVyYU1hbmFnZXIgdXBkYXRlIGlzIHNraXBwZWQgaW4gbWFpbi5qcyBpZiBzdGF0ZSBpcyBtZW51CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlID09PSAnYWN0aXZlJykgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZU1vZGUgPT09ICdwcmFjdGljZScpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVByYWN0aWNlKGR0KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50aW1lICs9IGR0OwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVRpbWVyKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2hlY2tIYWxmVGltZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuX2NoZWNrR29hbHMoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKHRoaXMubWluaU1hcCkgdGhpcy5taW5pTWFwLnVwZGF0ZSgpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuZmxvYXRpbmdUZXh0KSB0aGlzLmZsb2F0aW5nVGV4dC51cGRhdGUoZHQpOwppZiAodGhpcy5wYXJ0aWNsZU1hbmFnZXIpIHRoaXMucGFydGljbGVNYW5hZ2VyLnVwZGF0ZShkdCk7CiAgICAgICAgICAgICAgICAvLyBHbHlwaE1hbmFnZXIgdXBkYXRlZCBieSBtYWluLmpzCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBUZWNoY29weSBXaW5kb3cKICAgICAgICAgICAgICAgIGlmICh0aGlzLnRlY2hDb3B5U3RhdGUuYWN0aXZlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50ZWNoQ29weVN0YXRlLnRpbWVyIC09IGR0OwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBVSSBCYXIKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy51aS50ZWNoVGltZXJGaWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBjdCA9IE1hdGgubWF4KDAsICh0aGlzLnRlY2hDb3B5U3RhdGUudGltZXIgLyB0aGlzLnRlY2hDb3B5U3RhdGUubWF4VGltZSkgKiAxMDApOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLnRlY2hUaW1lckZpbGwuc3R5bGUud2lkdGggPSBgJHtwY3R9JWA7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAvLyBDb2xvciBzaGlmdCBiYXNlZCBvbiB1cmdlbmN5CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwY3QgPCAzMCkgdGhpcy51aS50ZWNoVGltZXJGaWxsLnN0eWxlLmJhY2tncm91bmQgPSAnI2ZmMDAwMCc7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgdGhpcy51aS50ZWNoVGltZXJGaWxsLnN0eWxlLmJhY2tncm91bmQgPSAnbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjZmZmZmZmLCAjMDBmZmZmKSc7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50ZWNoQ29weVN0YXRlLnRpbWVyIDw9IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbmRUZWNoQ29weVdpbmRvdyhmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVQYXJ0aWNsZXMoZHQpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuZGVidWdWaXN1YWxpemVyKSB0aGlzLmRlYnVnVmlzdWFsaXplci51cGRhdGUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAgICAgCgoKX3VwZGF0ZVRpbWVyKCkgewogICAgICAgICAgICBpZiAoIXRoaXMudWkudGltZXIpIHJldHVybjsKICAgICAgICAgICAgLy8gQ2xhbXAgdG8gaGFsZiBkdXJhdGlvbiBmb3IgZGlzcGxheSBpZiB3ZSBnbyBzbGlnaHRseSBvdmVyIGJlZm9yZSB0aWNrCiAgICAgICAgICAgIGNvbnN0IHQgPSBNYXRoLm1pbih0aGlzLnRpbWUsIHRoaXMuaGFsZkR1cmF0aW9uKTsKICAgICAgICAgICAgY29uc3QgbWludXRlcyA9IE1hdGguZmxvb3IodCAvIDYwKTsKICAgICAgICAgICAgY29uc3Qgc2Vjb25kcyA9IE1hdGguZmxvb3IodCAlIDYwKTsKICAgICAgICAgICAgdGhpcy51aS50aW1lci5pbm5lclRleHQgPSBgJHttaW51dGVzLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX06JHtzZWNvbmRzLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX1gOwogICAgICAgIH0KICAgICAgICBfY2hlY2tIYWxmVGltZSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMudGltZSA+PSB0aGlzLmhhbGZEdXJhdGlvbikgewogICAgICAgICAgICAgICAgdGhpcy5lbmRIYWxmKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgplbmRIYWxmKCkgewogICAgICAgICAgICB0aGlzLnN0YXRlID0gJ2hhbGZ0aW1lJzsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh0aGlzLmhhbGYgPT09IDEpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3Nob3dNb2RhbCgiSEFMRiBUSU1FIiwgIlBSRVBBUklORyAyTkQgSEFMRi4uLiIpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faGlkZU1vZGFsKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGFydFNlY29uZEhhbGYoKTsKICAgICAgICAgICAgICAgIH0sIDQwMDApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gRW5kIG9mIDJuZCBIYWxmIG9yIE92ZXJ0aW1lIFBlcmlvZAogICAgICAgICAgICAgICAgaWYgKHRoaXMuc2NvcmUuaG9tZSA9PT0gdGhpcy5zY29yZS5hd2F5KSB7CiAgICAgICAgICAgICAgICAgICAgLy8gVElFRCAtIEdvIHRvIE92ZXJ0aW1lIChHb2xkZW4gR29hbCkKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zaG93TW9kYWwoIk9WRVJUSU1FIiwgIkdPTERFTiBHT0FMIFJVTEUgQUNUSVZFIik7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2hpZGVNb2RhbCgpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0T3ZlcnRpbWUoKTsKICAgICAgICAgICAgICAgICAgICB9LCA0MDAwKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gV2lubmVyIGRlY2lkZWQKICAgICAgICAgICAgICAgICAgICB0aGlzLmVuZEdhbWUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgc3RhcnRTZWNvbmRIYWxmKCkgewogICAgICAgICAgICB0aGlzLmhhbGYgPSAyOwogICAgICAgICAgICB0aGlzLnRpbWUgPSAwOwogICAgICAgICAgICB0aGlzLnVpLmhhbGYuaW5uZXJUZXh0ID0gIjJuZCBIQUxGIjsKICAgICAgICAgICAgdGhpcy5yZXNldFJvdW5kKG51bGwpOyAvLyBOZXV0cmFsIEJsaXR6LW9mZiBmb3IgMm5kIGhhbGYgc3RhcnQKICAgICAgICB9CgogICAgICAgIHN0YXJ0T3ZlcnRpbWUoKSB7CiAgICAgICAgICAgIHRoaXMuaGFsZisrOwogICAgICAgICAgICB0aGlzLnRpbWUgPSAwOwogICAgICAgICAgICB0aGlzLmlzT3ZlcnRpbWUgPSB0cnVlOwogICAgICAgICAgICB0aGlzLnVpLmhhbGYuaW5uZXJUZXh0ID0gIk9WRVJUSU1FIjsKICAgICAgICAgICAgdGhpcy5yZXNldFJvdW5kKG51bGwpOyAvLyBOZXV0cmFsIEJsaXR6LW9mZgogICAgICAgIH0KCiAgICAgICAgZW5kR2FtZSgpIHsKICAgICAgICAgICAgdGhpcy5zdGF0ZSA9ICdnYW1lb3Zlcic7CiAgICAgICAgICAgIGxldCBtc2cgPSAiRFJBVyI7CiAgICAgICAgICAgIGlmICh0aGlzLnNjb3JlLmhvbWUgPiB0aGlzLnNjb3JlLmF3YXkpIG1zZyA9ICJWSUNUT1JZIjsKICAgICAgICAgICAgaWYgKHRoaXMuc2NvcmUuYXdheSA+IHRoaXMuc2NvcmUuaG9tZSkgbXNnID0gIkRFRkVBVCI7CiAgICAgICAgICAgIAp0aGlzLl9zaG93TW9kYWwobXNnLCAiUFJFU1MgUkVGUkVTSCBUTyBQTEFZIEFHQUlOIik7CiAgICAgICAgICAgIC8vIFN0b3AgTXVzaWMgb24gR2FtZSBPdmVyCiAgICAgICAgICAgIGlmICh0aGlzLmF1ZGlvTWFuYWdlcikgewogICAgICAgICAgICAgICAgdGhpcy5hdWRpb01hbmFnZXIuc3RvcEJHTSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIE5vIHJlc2V0LCBqdXN0IHN0b3AuCiAgICAgICAgfQoKICAgICAgICBfc2hvd01vZGFsKHRpdGxlLCBzdWJ0ZXh0KSB7CiAgICAgICAgICAgIGlmICghdGhpcy51aS5tb2RhbCkgcmV0dXJuOwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy51aS5tb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWwtdGl0bGUnKS5pbm5lclRleHQgPSB0aXRsZTsKICAgICAgICAgICAgdGhpcy51aS5tb2RhbC5xdWVyeVNlbGVjdG9yKCcjbW9kYWwtc2NvcmUtaG9tZScpLmlubmVyVGV4dCA9IHRoaXMuc2NvcmUuaG9tZTsKICAgICAgICAgICAgdGhpcy51aS5tb2RhbC5xdWVyeVNlbGVjdG9yKCcjbW9kYWwtc2NvcmUtYXdheScpLmlubmVyVGV4dCA9IHRoaXMuc2NvcmUuYXdheTsKICAgICAgICAgICAgdGhpcy51aS5tb2RhbC5xdWVyeVNlbGVjdG9yKCcjbW9kYWwtbXNnJykuaW5uZXJUZXh0ID0gc3VidGV4dDsKICAgICAgICAgICAgCiAgICAgICAgICAgIHRoaXMudWkubW9kYWwuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBIaWRlIEhVRCBlbGVtZW50cwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaHVkLXRvcCcpLnN0eWxlLm9wYWNpdHkgPSAnMCc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwbGF5ZXItc3RhdHVzLXBhbmVsJykuc3R5bGUub3BhY2l0eSA9ICcwJzsKICAgICAgICB9CgogICAgICAgIF9oaWRlTW9kYWwoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy51aS5tb2RhbCkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLnVpLm1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU2hvdyBIVUQgZWxlbWVudHMKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2h1ZC10b3AnKS5zdHlsZS5vcGFjaXR5ID0gJzEnOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxheWVyLXN0YXR1cy1wYW5lbCcpLnN0eWxlLm9wYWNpdHkgPSAnMSc7CiAgICAgICAgfQoKX2NoZWNrR29hbHMoKSB7CiAgICAgICAgICAgIGNvbnN0IGJhbGwgPSB0aGlzLmVudGl0aWVzLmJhbGw7CiAgICAgICAgICAgIGlmICghYmFsbCB8fCAhYmFsbC5tZXNoKSByZXR1cm47CgogICAgICAgICAgICBjb25zdCBwb3MgPSBiYWxsLm1lc2gucG9zaXRpb247CgogICAgICAgICAgICAvLyBQcmVjaXNlIEdvYWwgRGV0ZWN0aW9uCiAgICAgICAgICAgIC8vIFZpc3VhbCBHb2FsIGlzIGF0IFogPSArLy0gMjguCiAgICAgICAgICAgIC8vIFdlIGRlZmluZSBhICJHb2FsIE1vdXRoIiBib3ggbWF0Y2hpbmcgR29hbGllLmpzIChXaWR0aCAxNCwgSGVpZ2h0IDgpLgovLyBXZSBkZWZpbmUgYSAiR29hbCBNb3V0aCIgYm94IG1hdGNoaW5nIHRoZSB2aXN1YWwgbmV0LgogICAgICAgICAgICAvLyBBcmVuYSBSYWRpdXMgaXMgMzIuIEdvYWwgaXMgcm91Z2hseSAyMm0gd2lkZSwgMThtIGhpZ2guCmNvbnN0IGhhbGZXaWR0aCA9IDE2LjU7IC8vIEluY3JlYXNlZCA1MCUgKHdhcyAxMS4wKQoKICAgICAgICAgICAgY29uc3QgaGFsZkhlaWdodCA9IDEzLjU7IC8vIEluY3JlYXNlZCA1MCUgKHdhcyA5LjApCiAgICAgICAgICAgIGNvbnN0IGdvYWxZT2Zmc2V0ID0gLTIuMjsgLy8gTW92ZWQgZG93biB0byBtYXRjaCB2aXN1YWwgbW9kZWwKICAgICAgICAgICAgY29uc3QgdHJpZ2dlclogPSAyOC4wOyAvLyBUcmlnZ2VyIGF0IHRoZSBhcmVuYSBlZGdlCiAgICAgICAgICAgIGlmIChNYXRoLmFicyhwb3MueikgPiB0cmlnZ2VyWikgewogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBQUkVWRU5UIE9XTiBHT0FMIEJZIENBUlJJRVIgKFVzZXIgUmVxdWVzdCkKICAgICAgICAgICAgICAgIC8vIElmIHRoZSBiYWxsIGlzIGhlbGQgYnkgdGhlIHRlYW0gZGVmZW5kaW5nIHRoaXMgZ29hbCwgZG8gbm90IGNvdW50IGl0LgogICAgICAgICAgICAgICAgaWYgKGJhbGwuaG9sZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gSG9tZSAoU2lkZSAxKSBkZWZlbmRzICtaLiBJZiBwb3MueiA+IDAgKEhvbWUgR29hbCkgYW5kIGhvbGRlciBpcyBIb21lLCBpZ25vcmUuCiAgICAgICAgICAgICAgICAgICAgaWYgKHBvcy56ID4gMCAmJiBiYWxsLmhvbGRlci50ZWFtLnNpZGUgPT09IDEpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAvLyBBd2F5IChTaWRlIC0xKSBkZWZlbmRzIC1aLiBJZiBwb3MueiA8IDAgKEF3YXkgR29hbCkgYW5kIGhvbGRlciBpcyBBd2F5LCBpZ25vcmUuCiAgICAgICAgICAgICAgICAgICAgaWYgKHBvcy56IDwgMCAmJiBiYWxsLmhvbGRlci50ZWFtLnNpZGUgPT09IC0xKSByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gMi4gQ2hlY2sgRnJhbWUgKE11c3QgYmUgd2l0aGluIHdpZHRoL2hlaWdodCkKLy8gMi4gQ2hlY2sgRnJhbWUgKE11c3QgYmUgd2l0aGluIHdpZHRoL2hlaWdodCwgYWNjb3VudGluZyBmb3IgWSBvZmZzZXQpCiAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnMocG9zLngpIDw9IGhhbGZXaWR0aCAmJiBNYXRoLmFicyhwb3MueSAtIGdvYWxZT2Zmc2V0KSA8PSBoYWxmSGVpZ2h0KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBvcy56IDwgMCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdvYWxTY29yZWQoJ2hvbWUnKTsgLy8gSG9tZSBhdHRhY2tzIC1aCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nb2FsU2NvcmVkKCdhd2F5Jyk7IC8vIEF3YXkgYXR0YWNrcyArWgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCmdvYWxTY29yZWQoc2NvcmVyKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSAnYWN0aXZlJykgcmV0dXJuOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gSU1QQUNUIEZSQU1FOiBHT0FMCnRoaXMudHJpZ2dlckltcGFjdCgwLjQsICdzaGF0dGVyJyk7IC8vIE1hc3NpdmUgZnJlZXplIGZvciBnb2FsCiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSAnYWN0aXZlJykgcmV0dXJuOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRVhQIFJFV0FSRDogR29hbAogICAgICAgICAgICAvLyBGaW5kIHdobyBzY29yZWQgKExhc3QgaG9sZGVyIG9mIGJhbGwpCiAgICAgICAgICAgIGNvbnN0IGJhbGwgPSB0aGlzLmVudGl0aWVzLmJhbGw7CiAgICAgICAgICAgIGlmIChiYWxsICYmIGJhbGwubGFzdEhvbGRlciAmJiBiYWxsLmxhc3RIb2xkZXIudGVhbS5pZCA9PT0gc2NvcmVyKSB7CiAgICAgICAgICAgICAgICBiYWxsLmxhc3RIb2xkZXIuZ2FpbkV4cCgxMCk7CiAgICAgICAgICAgICAgICAvLyBPcHRpb25hbDogQXNzaXN0IGxvZ2ljIGNvdWxkIGdvIGhlcmUgKHRyYWNrIGxhc3RIb2xkZXIubGFzdFBhc3Nlcj8pCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSAnZ29hbCc7CiAgICAgICAgICAgIHRoaXMuc2NvcmVbc2NvcmVyXSsrOwogICAgICAgICAgICB0aGlzLl91cGRhdGVTY29yZVVJKCk7CiAgICAgICAgICAgIAovLyAxLiBWSVNDRVJBTCBTSEFLRSAmIFBBUlRJQ0xFUwogICAgICAgICAgICBpZiAodGhpcy5jYW1lcmFNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNhbWVyYU1hbmFnZXIuYWRkU2hha2UoMi4wKTsgLy8gSGVhdnkgc2hha2UKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5wYXJ0aWNsZU1hbmFnZXIgJiYgdGhpcy5lbnRpdGllcy5iYWxsICYmIHRoaXMuZW50aXRpZXMuYmFsbC5tZXNoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBnb2FsUG9zID0gdGhpcy5lbnRpdGllcy5iYWxsLm1lc2gucG9zaXRpb24uY2xvbmUoKTsKICAgICAgICAgICAgICAgIC8vIE1hc3NpdmUgR29hbCBFeHBsb3Npb24KICAgICAgICAgICAgICAgIHRoaXMucGFydGljbGVNYW5hZ2VyLnNwYXduKCdzaG9ja3dhdmUnLCBnb2FsUG9zLCB7IHNjYWxlOiAxNS4wLCBsaWZlOiAwLjggfSk7CiAgICAgICAgICAgICAgICB0aGlzLnBhcnRpY2xlTWFuYWdlci5zcGF3bignZmxhc2gnLCBnb2FsUG9zLCB7IHNjYWxlOiAxMC4wIH0pOwogICAgICAgICAgICAgICAgZm9yKGxldCBpPTA7IGk8MzA7IGkrKykgewogICAgICAgICAgICAgICAgICAgIHRoaXMucGFydGljbGVNYW5hZ2VyLnNwYXduKCdkZWJyaXMnLCBnb2FsUG9zLCB7IHNjYWxlOiAwLjggfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gMi4gU0NSRUVOIEZMQVNICiAgICAgICAgICAgIGlmICh0aGlzLnVpLmZsYXNoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnVpLmZsYXNoLnN0eWxlLm9wYWNpdHkgPSAnMC44JzsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4geyB0aGlzLnVpLmZsYXNoLnN0eWxlLm9wYWNpdHkgPSAnMCc7IH0sIDEwMCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDMuIEdPTERFTiBHT0FMIENIRUNLCiAgICAgICAgICAgIGlmICh0aGlzLmlzT3ZlcnRpbWUpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2hvd0Fubm91bmNlbWVudCgiR09MREVOIEdPQUwhIiwgJ3NsYW0nKTsKICAgICAgICAgICAgICAgIC8vIEVuZCBnYW1lIGFmdGVyIHNob3J0IGRlbGF5CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmVuZEdhbWUoKTsKICAgICAgICAgICAgICAgIH0sIDMwMDApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyA0LiBTTEFNIEFOTk9VTkNFTUVOVCAoTm9ybWFsKQogICAgICAgICAgICB0aGlzLnNob3dBbm5vdW5jZW1lbnQoIkdPQUwhIiwgJ3NsYW0nKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFJlc2V0IHNlcXVlbmNlCiAgICAgICAgICAgIC8vIFNjb3JlZC11cG9uIHRlYW0gZ2V0cyBiYWxsCiAgICAgICAgICAgIGNvbnN0IGxvc2VyID0gc2NvcmVyID09PSAnaG9tZScgPyAnYXdheScgOiAnaG9tZSc7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBGQVNURVIgRkxPVzogUmVkdWNlZCBkZWxheSBmcm9tIDMwMDBtcyB0byAxMjAwbXMKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLnJlc2V0Um91bmQobG9zZXIpOwogICAgICAgICAgICB9LCAyMDAwKTsgLy8gU2xpZ2h0bHkgbG9uZ2VyIHRvIGFwcHJlY2lhdGUgdGhlICJHT0FMIiBzbGFtCiAgICAgICAgfQoKc2hvd0Fubm91bmNlbWVudCh0ZXh0LCB0eXBlID0gJ25vcm1hbCcsIGR1cmF0aW9uID0gMjAwMCkgewogICAgICAgICAgICBjb25zdCBlbCA9IHRoaXMudWkuYW5ub3VuY2VtZW50OwogICAgICAgICAgICBpZiAoIWVsKSByZXR1cm47CgogICAgICAgICAgICAvLyBDbGVhciBwcmV2aW91cyB0aW1lb3V0CiAgICAgICAgICAgIGlmICh0aGlzLl9hbm5vdW5jZVRpbWVvdXQpIHsKICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLl9hbm5vdW5jZVRpbWVvdXQpOwogICAgICAgICAgICAgICAgdGhpcy5fYW5ub3VuY2VUaW1lb3V0ID0gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gUmVzZXQgQW5pbWF0aW9uIGJ5IGNsb25pbmcKICAgICAgICAgICAgY29uc3QgbmV3RWwgPSBlbC5jbG9uZU5vZGUodHJ1ZSk7CiAgICAgICAgICAgIGVsLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKG5ld0VsLCBlbCk7CiAgICAgICAgICAgIHRoaXMudWkuYW5ub3VuY2VtZW50ID0gbmV3RWw7CgogICAgICAgICAgICBuZXdFbC5pbm5lclRleHQgPSB0ZXh0OwogICAgICAgICAgICBuZXdFbC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEFwcGx5IENsYXNzIGJhc2VkIG9uIHR5cGUKICAgICAgICAgICAgbmV3RWwuY2xhc3NOYW1lID0gJyc7IC8vIFJlc2V0IGNsYXNzZXMKICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdzbGFtJykgewogICAgICAgICAgICAgICAgbmV3RWwuY2xhc3NMaXN0LmFkZCgnYW5ub3VuY2VtZW50LXNsYW0nKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIERlZmF1bHQgc3R5bGUKICAgICAgICAgICAgICAgIG5ld0VsLnN0eWxlLmFuaW1hdGlvbiA9ICdub25lJzsKICAgICAgICAgICAgICAgIG5ld0VsLm9mZnNldEhlaWdodDsgLyogdHJpZ2dlciByZWZsb3cgKi8KICAgICAgICAgICAgICAgIG5ld0VsLnN0eWxlLmFuaW1hdGlvbiA9ICdhbm5vdW5jZVNsaWRlIDAuNXMgY3ViaWMtYmV6aWVyKDAuMTc1LCAwLjg4NSwgMC4zMiwgMS4yNzUpJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQXV0by1oaWRlCiAgICAgICAgICAgIGlmIChkdXJhdGlvbiA+IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuX2Fubm91bmNlVGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHRoaXMuaGlkZUFubm91bmNlbWVudCgpOwogICAgICAgICAgICAgICAgfSwgZHVyYXRpb24pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBoaWRlQW5ub3VuY2VtZW50KCkgewogICAgICAgICAgICBpZiAodGhpcy51aS5hbm5vdW5jZW1lbnQpIHsKICAgICAgICAgICAgICAgIHRoaXMudWkuYW5ub3VuY2VtZW50LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgIH0KICAgICAgICB9CgpyZXNldFJvdW5kKHBvc3Nlc3Npb25UZWFtSWQpIHsKICAgICAgICAgICAgdGhpcy5zdGF0ZSA9ICdyZXNldCc7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBSZXNldCBCYWxsCiAgICAgICAgICAgIGlmICh0aGlzLmVudGl0aWVzLmJhbGwpIHRoaXMuZW50aXRpZXMuYmFsbC5yZXNldCgpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gUmVzZXQgVGVhbXMKICAgICAgICAgICAgaWYgKHRoaXMudGVhbXMuaG9tZSkgdGhpcy50ZWFtcy5ob21lLnJlc2V0UG9zaXRpb25zKCk7CiAgICAgICAgICAgIGlmICh0aGlzLnRlYW1zLmF3YXkpIHRoaXMudGVhbXMuYXdheS5yZXNldFBvc2l0aW9ucygpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQ2xlYXIgYmFsbCBob2xkZXIKICAgICAgICAgICAgaWYgKHRoaXMuZW50aXRpZXMuYmFsbCkgdGhpcy5lbnRpdGllcy5iYWxsLmRyb3AoKTsKCiAgICAgICAgICAgIC8vIENSSVRJQ0FMOiBTbmFwIGNhbWVyYSB0byBwcmV2ZW50IGRpc29yaWVudGF0aW9uCiAgICAgICAgICAgIGlmICh0aGlzLmNhbWVyYU1hbmFnZXIpIHsKICAgICAgICAgICAgICAgIC8vIEZvcmNlIHVwZGF0ZSB0YXJnZXQgZmlyc3QgKHVzdWFsbHkgYmFsbCkKICAgICAgICAgICAgICAgIGlmICh0aGlzLmVudGl0aWVzLmJhbGwgJiYgdGhpcy5lbnRpdGllcy5iYWxsLm1lc2gpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbWVyYU1hbmFnZXIuc2V0VGFyZ2V0KHRoaXMuZW50aXRpZXMuYmFsbC5tZXNoLCB0aGlzLmVudGl0aWVzLmJhbGwudmVsb2NpdHkpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuY2FtZXJhTWFuYWdlci5zbmFwVG9UYXJnZXQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRkFTVEVSIEZMT1c6IFJlZHVjZWQgZGVsYXkgZnJvbSAyMDAwbXMgdG8gMTAwbXMKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0S2lja29mZihwb3NzZXNzaW9uVGVhbUlkKTsKfSwgMTAwKTsKICAgICAgICB9CgogICAgICAgIHN0YXJ0S2lja29mZihwb3NzZXNzaW9uVGVhbUlkKSB7CiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSAna2lja29mZic7CiAgICAgICAgICAgIHRoaXMuc2hvd0Fubm91bmNlbWVudCgiQkxJVFogT0ZGISIsICdzbGFtJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBJZiBhIHRlYW0gaGFzIHBvc3Nlc3Npb24gKGFmdGVyIGdvYWwpLCBnaXZlIHRvIE1GCiAgICAgICAgICAgIGlmIChwb3NzZXNzaW9uVGVhbUlkKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0ZWFtID0gdGhpcy50ZWFtc1twb3NzZXNzaW9uVGVhbUlkXTsKICAgICAgICAgICAgICAgIGlmICh0ZWFtKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWYgPSB0ZWFtLnBsYXllcnMuZmluZChwID0+IHAucm9sZSA9PT0gJ01GJyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG1mICYmIHRoaXMuZW50aXRpZXMuYmFsbCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVudGl0aWVzLmJhbGwuZ3JhYihtZik7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAvLyBDUklUSUNBTDogU25hcCBjYW1lcmEgdG8gbmV3IGhvbGRlciB0byBwcmV2ZW50IHN3aW5nL2Rpc29yaWVudGF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNhbWVyYU1hbmFnZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FtZXJhTWFuYWdlci5zZXRUYXJnZXQobWYubWVzaCwgbWYudmVsb2NpdHkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYW1lcmFNYW5hZ2VyLnNuYXBUb1RhcmdldCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gTmV1dHJhbCBraWNrb2ZmIC0gZW5zdXJlIGNhbWVyYSBpcyBzbmFwcGVkIHRvIGNlbnRlciBiYWxsCiAgICAgICAgICAgICAgICBpZiAodGhpcy5jYW1lcmFNYW5hZ2VyICYmIHRoaXMuZW50aXRpZXMuYmFsbCAmJiB0aGlzLmVudGl0aWVzLmJhbGwubWVzaCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY2FtZXJhTWFuYWdlci5zZXRUYXJnZXQodGhpcy5lbnRpdGllcy5iYWxsLm1lc2gsIHRoaXMuZW50aXRpZXMuYmFsbC52ZWxvY2l0eSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYW1lcmFNYW5hZ2VyLnNuYXBUb1RhcmdldCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBGQVNURVIgRkxPVzogUmVkdWNlZCBkZWxheSBmcm9tIDEwMDBtcyB0byA4MDBtcwogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuaGlkZUFubm91bmNlbWVudCgpOwogICAgICAgICAgICAgICAgdGhpcy5zdGF0ZSA9ICdhY3RpdmUnOwogICAgICAgICAgICB9LCA4MDApOwogICAgICAgIH0KICAgICAgICAKLy8gSW5pdGlhbCBzdGFydAogICAgICAgIHN0YXJ0TWF0Y2gobW9kZSA9ICdub3JtYWwnKSB7CiAgICAgICAgICAgIHRoaXMuZ2FtZU1vZGUgPSBtb2RlOwogICAgICAgICAgICBjb25zb2xlLmxvZygiU3RhcnRpbmcgTWF0Y2ggaW4gbW9kZToiLCBtb2RlKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFN0YXJ0IE11c2ljCiAgICAgICAgICAgIGlmICh0aGlzLmF1ZGlvTWFuYWdlcikgewogICAgICAgICAgICAgICAgdGhpcy5hdWRpb01hbmFnZXIucGxheUJHTSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBSZXNldCBTY29yZQp0aGlzLnNjb3JlLmhvbWUgPSAwOwogICAgICAgICAgICB0aGlzLnNjb3JlLmF3YXkgPSAwOwogICAgICAgICAgICB0aGlzLl91cGRhdGVTY29yZVVJKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBSZXNldCBUaW1lCiAgICAgICAgICAgIHRoaXMudGltZSA9IDA7CiAgICAgICAgICAgIHRoaXMuaGFsZiA9IDE7CiAgICAgICAgICAgIGlmICh0aGlzLnVpLmhhbGYpIHRoaXMudWkuaGFsZi5pbm5lclRleHQgPSAiMXN0IjsKICAgICAgICAgICAgCmlmIChtb2RlID09PSAncHJhY3RpY2UnKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy51aS5oYWxmKSB0aGlzLnVpLmhhbGYuaW5uZXJUZXh0ID0gIlBSQUMiOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBTdGFydCBQcmFjdGljZSBNYW5hZ2VyCiAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmFjdGljZU1hbmFnZXIpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnByYWN0aWNlTWFuYWdlci5zdGFydCgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIEluIHByYWN0aWNlLCBlbnN1cmUgQUkgaXMgZW5hYmxlZCBmb3Igc3BhcnJpbmcKICAgICAgICAgICAgICAgIGlmICh0aGlzLnRlYW1zLmF3YXkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRlYW1zLmF3YXkuYWlFbmFibGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKCiAgICAgICAgICAgICAgICAvLyBFbnN1cmUgUHJhY3RpY2UgTWFuYWdlciBpcyBzdG9wcGVkIGlmIG5vcm1hbCBnYW1lCiAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmFjdGljZU1hbmFnZXIpIHRoaXMucHJhY3RpY2VNYW5hZ2VyLnN0b3AoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gU2FmZXR5OiBFbnN1cmUgYWxsIHBsYXllcnMgYXJlIHZpc2libGUgKGluIGNhc2UgUHJhY3RpY2UgaGlkIHRoZW0pCiAgICAgICAgICAgICAgICAvLyBBbmQgRk9SQ0UgQUkgRU5BQkxFRCAoRml4IGZvciAiWm9tYmllcyIgaWYgY29taW5nIGZyb20gUHJhY3RpY2UgTW9kZSkKICAgICAgICAgICAgICAgIGlmICh0aGlzLnRlYW1zLmF3YXkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRlYW1zLmF3YXkucGxheWVycy5mb3JFYWNoKHAgPT4geyBpZihwLm1lc2gpIHAubWVzaC52aXNpYmxlID0gdHJ1ZTsgfSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50ZWFtcy5hd2F5LmFpRW5hYmxlZCA9IHRydWU7IAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMudGVhbXMuaG9tZSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMudGVhbXMuaG9tZS5wbGF5ZXJzLmZvckVhY2gocCA9PiB7IGlmKHAubWVzaCkgcC5tZXNoLnZpc2libGUgPSB0cnVlOyB9KTsKICAgICAgICAgICAgICAgIH0KCnRoaXMucmVzZXRSb3VuZCgpOwogICAgICAgICAgICB9Cn0KCnNldE1lbnVNb2RlKGlzQWN0aXZlKSB7CiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSBpc0FjdGl2ZSA/ICdtZW51JyA6ICdhY3RpdmUnOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGlzQWN0aXZlICYmIHRoaXMuYXVkaW9NYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICB0aGlzLmF1ZGlvTWFuYWdlci5zdG9wQkdNKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEhpZGUgSFVEIGluIG1lbnUKICAgICAgICAgICAgY29uc3QgaHVkVG9wID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2h1ZC10b3AnKTsKICAgICAgICAgICAgY29uc3Qgc3RhdHVzUGFuZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxheWVyLXN0YXR1cy1wYW5lbCcpOwogICAgICAgICAgICBjb25zdCBjb250cm9scyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY3Rpb24tY29udGFpbmVyJyk7CiAgICAgICAgICAgIGNvbnN0IGpveXN0aWNrID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pveXN0aWNrLWhpdC16b25lJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBkaXNwbGF5ID0gaXNBY3RpdmUgPyAnbm9uZScgOiAnZmxleCc7IC8vIG9yIGJsb2NrL2V0YwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGh1ZFRvcCkgaHVkVG9wLnN0eWxlLmRpc3BsYXkgPSBkaXNwbGF5OwogICAgICAgICAgICBpZiAoc3RhdHVzUGFuZWwpIHN0YXR1c1BhbmVsLnN0eWxlLmRpc3BsYXkgPSBpc0FjdGl2ZSA/ICdub25lJyA6ICdibG9jayc7IC8vIFN0YXR1cyBwYW5lbCBoYXMgc3BlY2lmaWMgbG9naWMKICAgICAgICAgICAgaWYgKGNvbnRyb2xzKSBjb250cm9scy5zdHlsZS5kaXNwbGF5ID0gaXNBY3RpdmUgPyAnbm9uZScgOiAnZmxleCc7CiAgICAgICAgICAgIGlmIChqb3lzdGljaykgam95c3RpY2suc3R5bGUuZGlzcGxheSA9IGlzQWN0aXZlID8gJ25vbmUnIDogJ2Jsb2NrJzsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIElmIGVudGVyaW5nIG1lbnUsIHJlc2V0IGNhbWVyYSB0byBhIG5pY2UgYW5nbGU/CiAgICAgICAgICAgIC8vIEhhbmRsZWQgYnkgdXBkYXRlIGxvb3AKICAgICAgICB9CnRvZ2dsZURlbW9Nb2RlKCkgewogICAgICAgICAgICB0aGlzLmlzRGVtb01vZGUgPSAhdGhpcy5pc0RlbW9Nb2RlOwogICAgICAgICAgICBjb25zb2xlLmxvZygiRGVtbyBNb2RlOiIsIHRoaXMuaXNEZW1vTW9kZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBVcGRhdGUgVUkgQnV0dG9uCiAgICAgICAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhdXRvLXRvZ2dsZScpOwogICAgICAgICAgICBpZiAoYnRuKSB7CiAgICAgICAgICAgICAgICBidG4uaW5uZXJUZXh0ID0gdGhpcy5pc0RlbW9Nb2RlID8gIkFVVE8gUElMT1QiIDogIk1BTlVBTCI7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0RlbW9Nb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgYnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBidG4uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEFubm91bmNlbWVudAogICAgICAgICAgICBjb25zdCB0ZXh0ID0gdGhpcy5pc0RlbW9Nb2RlID8gIkFVVE8gUElMT1QiIDogIk1BTlVBTCI7CiAgICAgICAgICAgIHRoaXMuc2hvd0Fubm91bmNlbWVudCh0ZXh0KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFZpc3VhbCBGbGFpcjogU3Bhd24gdGV4dCBhYm92ZSBhY3RpdmUgcGxheWVyCiAgICAgICAgICAgIGlmICh0aGlzLmlzRGVtb01vZGUgJiYgdGhpcy5mbG9hdGluZ1RleHQgJiYgdGhpcy50ZWFtcy5ob21lICYmIHRoaXMudGVhbXMuaG9tZS5hY3RpdmVQbGF5ZXIgJiYgdGhpcy50ZWFtcy5ob21lLmFjdGl2ZVBsYXllci5tZXNoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmZsb2F0aW5nVGV4dC5zcGF3bigiQUkgRU5HQUdFRCIsIHRoaXMudGVhbXMuaG9tZS5hY3RpdmVQbGF5ZXIubWVzaC5wb3NpdGlvbiwgImdvYWwiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQXV0by1oaWRlIGFubm91bmNlbWVudApzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnVpLmFubm91bmNlbWVudCAmJiB0aGlzLnVpLmFubm91bmNlbWVudC5pbm5lclRleHQgPT09IHRleHQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmhpZGVBbm5vdW5jZW1lbnQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0gVEVDSENPUFkgU1lTVEVNIC0tLQoKICAgICAgICB0cmlnZ2VyVGVjaEV2ZW50KHNvdXJjZVBsYXllciwgdGVjaE5hbWUpIHsKICAgICAgICAgICAgaWYgKCFzb3VyY2VQbGF5ZXIgfHwgIXNvdXJjZVBsYXllci50ZWFtKSByZXR1cm47CgogICAgICAgICAgICAvLyBGaW5kIG9wcG9zaW5nIHRlYW0KICAgICAgICAgICAgY29uc3Qgb3BwVGVhbUlkID0gc291cmNlUGxheWVyLnRlYW0uaWQgPT09ICdob21lJyA/ICdhd2F5JyA6ICdob21lJzsKICAgICAgICAgICAgY29uc3Qgb3BwVGVhbSA9IHRoaXMudGVhbXNbb3BwVGVhbUlkXTsKICAgICAgICAgICAgaWYgKCFvcHBUZWFtKSByZXR1cm47CgogICAgICAgICAgICAvLyBGaW5kIHdobyBpcyBtYXJraW5nIHRoaXMgc291cmNlCiAgICAgICAgICAgIGNvbnN0IGxlYXJuZXJzID0gb3BwVGVhbS5wbGF5ZXJzLmZpbHRlcihwID0+IHAubWFya2luZyA9PT0gc291cmNlUGxheWVyKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChsZWFybmVycy5sZW5ndGggPT09IDApIHJldHVybjsKCiAgICAgICAgICAgIC8vIE9ubHkgc2hvdyBVSSBpZiB0aGUgbGVhcm5pbmcgdGVhbSBpcyBIdW1hbiAoSG9tZSkKICAgICAgICAgICAgLy8gKE9yIGlmIHdlIGFyZSBpbiBEZW1vIG1vZGUgYW5kIHdhbnQgdG8gc2VlIGl0IGhhcHBlbiBmb3IgSG9tZSB0ZWFtKQogICAgICAgICAgICBpZiAob3BwVGVhbS5pc0h1bWFuKSB7CiAgICAgICAgICAgICAgICAvLyBGaWx0ZXIgb3V0IHRob3NlIHdobyBhbHJlYWR5IGtub3cgaXQKICAgICAgICAgICAgICAgIGNvbnN0IHZhbGlkTGVhcm5lcnMgPSBsZWFybmVycy5maWx0ZXIocCA9PiAhcC5sZWFybmVkVGVjaHMuaW5jbHVkZXModGVjaE5hbWUpKTsKICAgICAgICAgICAgICAgIGlmICh2YWxpZExlYXJuZXJzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0VGVjaENvcHlXaW5kb3codGVjaE5hbWUsIHZhbGlkTGVhcm5lcnMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKc3RhcnRUZWNoQ29weVdpbmRvdyh0ZWNoTmFtZSwgbGVhcm5lcnMpIHsKICAgICAgICAgICAgdGhpcy50ZWNoQ29weVN0YXRlLmFjdGl2ZSA9IHRydWU7CiAgICAgICAgICAgIHRoaXMudGVjaENvcHlTdGF0ZS5tYXhUaW1lID0gMC42OyAvLyAwLjZzIHdpbmRvdwogICAgICAgICAgICB0aGlzLnRlY2hDb3B5U3RhdGUudGltZXIgPSB0aGlzLnRlY2hDb3B5U3RhdGUubWF4VGltZTsKICAgICAgICAgICAgdGhpcy50ZWNoQ29weVN0YXRlLnRlY2ggPSB0ZWNoTmFtZTsKICAgICAgICAgICAgdGhpcy50ZWNoQ29weVN0YXRlLmxlYXJuZXJzID0gbGVhcm5lcnM7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTaG93IFVJCiAgICAgICAgICAgIGlmICh0aGlzLnVpLnRlY2hGbGFzaCkgewogICAgICAgICAgICAgICAgdGhpcy51aS50ZWNoRmxhc2guc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgICAgICAgICAgICAgIHRoaXMudWkudGVjaEZsYXNoLnN0eWxlLmJhY2tncm91bmQgPSAiIjsgLy8gUmVzZXQgYmFja2dyb3VuZAogICAgICAgICAgICAgICAgdGhpcy51aS50ZWNoRmxhc2gucXVlcnlTZWxlY3RvcignLnRlY2gtdGV4dCcpLmlubmVyVGV4dCA9ICJURUNIQ09QWSEiOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAodGhpcy51aS50ZWNoU3ViKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy51aS50ZWNoU3ViLmlubmVyVGV4dCA9IHRlY2hOYW1lLnJlcGxhY2UoJ18nLCAnICcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBSZXNldCBiYXIKICAgICAgICAgICAgICAgIGlmICh0aGlzLnVpLnRlY2hUaW1lckZpbGwpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLnRlY2hUaW1lckZpbGwuc3R5bGUud2lkdGggPSAnMTAwJSc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgphdHRlbXB0VGVjaENvcHkoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy50ZWNoQ29weVN0YXRlLmFjdGl2ZSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU3VjY2VzcyEKICAgICAgICAgICAgY29uc3QgdGVjaCA9IHRoaXMudGVjaENvcHlTdGF0ZS50ZWNoOwogICAgICAgICAgICBjb25zdCBsZWFybmVycyA9IHRoaXMudGVjaENvcHlTdGF0ZS5sZWFybmVyczsKICAgICAgICAgICAgCiAgICAgICAgICAgIGxlYXJuZXJzLmZvckVhY2gocCA9PiB7CiAgICAgICAgICAgICAgICAvLyBEb3VibGUgY2hlY2sgdG8gcHJldmVudCBkdXBsaWNhdGVzCiAgICAgICAgICAgICAgICBpZiAoIXAubGVhcm5lZFRlY2hzLmluY2x1ZGVzKHRlY2gpKSB7CiAgICAgICAgICAgICAgICAgICAgcC5sZWFybmVkVGVjaHMucHVzaCh0ZWNoKTsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgJHtwLnJvbGV9IGxlYXJuZWQgJHt0ZWNofSFgKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyAxLiBGbG9hdGluZyBUZXh0CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZmxvYXRpbmdUZXh0ICYmIHAubWVzaCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZsb2F0aW5nVGV4dC5zcGF3bihgTEVBUk5FRCFgLCBwLm1lc2gucG9zaXRpb24sICJ0ZWNoIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIDIuIFBhcnRpY2xlIEVmZmVjdCAoU3BpcmFsKQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnBhcnRpY2xlTWFuYWdlciAmJiBwLm1lc2gpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3Bhd24gbXVsdGlwbGUgcGFydGljbGVzIGZvciBhIHN3aXJsIGVmZmVjdAogICAgICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTwxMDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcnRpY2xlTWFuYWdlci5zcGF3bignbGVhcm5lZCcsIHAubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBpICogNTApOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHRoaXMuZW5kVGVjaENvcHlXaW5kb3codHJ1ZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCmVuZFRlY2hDb3B5V2luZG93KHN1Y2Nlc3MpIHsKICAgICAgICAgICAgdGhpcy50ZWNoQ29weVN0YXRlLmFjdGl2ZSA9IGZhbHNlOwogICAgICAgICAgICBpZiAodGhpcy51aS50ZWNoRmxhc2gpIHsKICAgICAgICAgICAgICAgIGlmIChzdWNjZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy51aS50ZWNoRmxhc2gucXVlcnlTZWxlY3RvcignLnRlY2gtdGV4dCcpLmlubmVyVGV4dCA9ICJTVUNDRVNTISI7CiAgICAgICAgICAgICAgICAgICAgLy8gRmxhc2ggc3VjY2VzcyBjb2xvciAoV2hpdGUgZmxhc2gpCiAgICAgICAgICAgICAgICAgICAgdGhpcy51aS50ZWNoRmxhc2guc3R5bGUuYmFja2dyb3VuZCA9ICJyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuOCkiOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEhpZGUgYWZ0ZXIgc2hvcnQgZGVsYXkgdG8gc2hvdyB0aGUgc3VjY2VzcyBmbGFzaAogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4geyAKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS50ZWNoRmxhc2guc3R5bGUuZGlzcGxheSA9ICdub25lJzsgCiAgICAgICAgICAgICAgICAgICAgfSwgMzAwKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gRmFpbGVkIC8gTWlzc2VkCiAgICAgICAgICAgICAgICAgICAgdGhpcy51aS50ZWNoRmxhc2guc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KX3VwZGF0ZVBsYXllclN0YXR1c1VJKCkgewogICAgICAgICAgICBpZiAoIXRoaXMudGVhbXMuaG9tZSB8fCAhdGhpcy50ZWFtcy5ob21lLmFjdGl2ZVBsYXllcikgcmV0dXJuOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgcCA9IHRoaXMudGVhbXMuaG9tZS5hY3RpdmVQbGF5ZXI7CiAgICAgICAgICAgIGNvbnN0IHVpID0gdGhpcy51aS5zdGF0dXNQYW5lbDsKICAgICAgICAgICAgCi8vIFVJIFVwZGF0ZXMgKEFjdGlvbiBCdXR0b24gQ29udGV4dCkKICAgICAgICAgICAgICAgIHVpLmNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gTmFtZSAmIExldmVsCiAgICAgICAgICAgICAgICBpZiAodWkubmFtZSkgdWkubmFtZS5pbm5lclRleHQgPSBgJHtwLmNoYXJhY3Rlck5hbWUgfHwgcC5yb2xlfSBMViR7cC5sZXZlbH1gOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBIUAogICAgICAgICAgICAgICAgaWYgKHVpLmhwQmFyKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaHBQY3QgPSBNYXRoLm1heCgwLCBNYXRoLm1pbigxMDAsIChwLnN0YXRzLkhQIC8gcC5zdGF0cy5tYXhIUCkgKiAxMDApKTsKICAgICAgICAgICAgICAgICAgICB1aS5ocEJhci5zdHlsZS53aWR0aCA9IGAke2hwUGN0fSVgOwogICAgICAgICAgICAgICAgICAgIC8vIENvbG9yIHNoaWZ0CiAgICAgICAgICAgICAgICAgICAgaWYgKGhwUGN0IDwgMjUpIHVpLmhwQmFyLnN0eWxlLmJhY2tncm91bmQgPSAnbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjZmYwMDAwLCAjZmY0NDQ0KSc7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoaHBQY3QgPCA1MCkgdWkuaHBCYXIuc3R5bGUuYmFja2dyb3VuZCA9ICdsaW5lYXItZ3JhZGllbnQoOTBkZWcsICNmZmZmMDAsICNmZmZmODgpJzsKICAgICAgICAgICAgICAgICAgICBlbHNlIHVpLmhwQmFyLnN0eWxlLmJhY2tncm91bmQgPSAnbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjMDBmZjAwLCAjY2NmZmNjKSc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodWkuaHBUZXh0KSB1aS5ocFRleHQuaW5uZXJUZXh0ID0gYCR7TWF0aC5mbG9vcihwLnN0YXRzLkhQKX0vJHtwLnN0YXRzLm1heEhQfWA7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEVYUAogICAgICAgICAgICAgICAgaWYgKHVpLmV4cEJhcikgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4cFBjdCA9IE1hdGgubWF4KDAsIE1hdGgubWluKDEwMCwgKHAuZXhwIC8gcC5uZXh0TGV2ZWxFeHApICogMTAwKSk7CiAgICAgICAgICAgICAgICAgICAgdWkuZXhwQmFyLnN0eWxlLndpZHRoID0gYCR7ZXhwUGN0fSVgOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9Cl9pbml0UGFydGljbGVzKCkgewogICAgICAgICAgICB0aGlzLnNwYXJrUG9vbCA9IFtdOwogICAgICAgICAgICB0aGlzLmFjdGl2ZVNwYXJrcyA9IFtdOwogICAgICAgICAgICBjb25zdCBwb29sU2l6ZSA9IDQwOyAvLyBTdWZmaWNpZW50IGZvciBjb250aW51b3VzIGdyaW5kaW5nCiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBvb2xTaXplOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNwcml0ZSA9IG5ldyBUSFJFRS5TcHJpdGUoX3NwYXJrTWF0ZXJpYWwuY2xvbmUoKSk7CiAgICAgICAgICAgICAgICBzcHJpdGUudmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5zY2VuZS5hZGQoc3ByaXRlKTsKICAgICAgICAgICAgICAgIHRoaXMuc3BhcmtQb29sLnB1c2goc3ByaXRlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgc3Bhd25DbGFzaChwb3MsIGludGVuc2l0eSA9IDEuMCkgewogICAgICAgICAgICAvLyBGaW5kIGZyZWUgc3BhcmsKICAgICAgICAgICAgY29uc3Qgc3BhcmsgPSB0aGlzLnNwYXJrUG9vbC5maW5kKHMgPT4gIXMudmlzaWJsZSk7CiAgICAgICAgICAgIGlmICghc3BhcmspIHJldHVybjsgLy8gUG9vbCBleGhhdXN0ZWQKICAgICAgICAgICAgCiAgICAgICAgICAgIHNwYXJrLnBvc2l0aW9uLmNvcHkocG9zKTsKICAgICAgICAgICAgc3BhcmsudmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBSYW5kb21pemUgcm90YXRpb24KICAgICAgICAgICAgc3BhcmsubWF0ZXJpYWwucm90YXRpb24gPSBNYXRoLnJhbmRvbSgpICogTWF0aC5QSTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEluaXRpYWxpemUgQWN0aXZlIFN0YXRlCiAgICAgICAgICAgIHRoaXMuYWN0aXZlU3BhcmtzLnB1c2goewogICAgICAgICAgICAgICAgbWVzaDogc3BhcmssCiAgICAgICAgICAgICAgICBhZ2U6IDAsCiAgICAgICAgICAgICAgICBsaWZlOiAwLjE1ICsgTWF0aC5yYW5kb20oKSAqIDAuMTUsIC8vIEZhc3QsIHB1bmNoeSBzcGFya3MKICAgICAgICAgICAgICAgIG1heFNjYWxlOiAyLjUgKiBpbnRlbnNpdHksCiAgICAgICAgICAgICAgICB2ZWxvY2l0eTogbmV3IFRIUkVFLlZlY3RvcjMoCiAgICAgICAgICAgICAgICAgICAgKE1hdGgucmFuZG9tKCktMC41KSo4LCAKICAgICAgICAgICAgICAgICAgICAoTWF0aC5yYW5kb20oKS0wLjUpKjgsIAogICAgICAgICAgICAgICAgICAgIChNYXRoLnJhbmRvbSgpLTAuNSkqOAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIF91cGRhdGVQYXJ0aWNsZXMoZHQpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IHRoaXMuYWN0aXZlU3BhcmtzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwID0gdGhpcy5hY3RpdmVTcGFya3NbaV07CiAgICAgICAgICAgICAgICBwLmFnZSArPSBkdDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKHAuYWdlID49IHAubGlmZSkgewogICAgICAgICAgICAgICAgICAgIHAubWVzaC52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVTcGFya3Muc3BsaWNlKGksIDEpOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCB0ID0gcC5hZ2UgLyBwLmxpZmU7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEV4cGFuZAogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFNjYWxlID0gMC41ICsgKHAubWF4U2NhbGUgLSAwLjUpICogdDsKICAgICAgICAgICAgICAgIHAubWVzaC5zY2FsZS5zZXRTY2FsYXIoY3VycmVudFNjYWxlKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRmFkZSBvdXQKICAgICAgICAgICAgICAgIHAubWVzaC5tYXRlcmlhbC5vcGFjaXR5ID0gMS4wIC0gKHQgKiB0KTsgLy8gUXVhZHJhdGljIGZhZGUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gTW92ZQogICAgICAgICAgICAgICAgcC5tZXNoLnBvc2l0aW9uLmFkZFNjYWxlZFZlY3RvcihwLnZlbG9jaXR5LCBkdCk7CiAgICAgICAgICAgICAgICBwLm1lc2gubWF0ZXJpYWwucm90YXRpb24gKz0gMTAuMCAqIGR0OwogICAgICAgICAgICB9CiAgICAgICAgfQoKLy8gSGVscGVyIGZvciBpbXBhY3QgZnJhbWVzCgp0cmlnZ2VySW1wYWN0KGR1cmF0aW9uLCB0eXBlID0gJ2RlZmF1bHQnKSB7CiAgICAgICAgICAgIHRoaXMuaW1wYWN0UGF1c2UgPSBkdXJhdGlvbjsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYW1lLWNvbnRhaW5lcicpOwogICAgICAgICAgICBpZiAoIWNvbnRhaW5lcikgcmV0dXJuOwoKICAgICAgICAgICAgLy8gUmVzZXQgY2xhc3NlcyB0byBlbnN1cmUgYW5pbWF0aW9uIHJlc3RhcnRzCiAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdpbXBhY3QtZngnLCAnaW1wYWN0LWhlYXZ5JywgJ2ltcGFjdC1zaGF0dGVyJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBGb3JjZSByZWZsb3cKICAgICAgICAgICAgdm9pZCBjb250YWluZXIub2Zmc2V0V2lkdGg7CgogICAgICAgICAgICBsZXQgY2xhc3NOYW1lID0gJ2ltcGFjdC1meCc7CiAgICAgICAgICAgIGlmICh0eXBlID09PSAnaGVhdnknKSBjbGFzc05hbWUgPSAnaW1wYWN0LWhlYXZ5JzsKICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdzaGF0dGVyJykgY2xhc3NOYW1lID0gJ2ltcGFjdC1zaGF0dGVyJzsKCiAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKGNsYXNzTmFtZSk7CgogICAgICAgICAgICAvLyBBdXRvLXJlbW92ZSBjbGFzcyBhZnRlciBkdXJhdGlvbgogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKGNsYXNzTmFtZSk7CiAgICAgICAgICAgIH0sIGR1cmF0aW9uICogMTAwMCArIDEwMCk7CiAgICAgICAgfQogICAgfQoKICAgIHdpbmRvdy5mbHV4LkdhbWVNYW5hZ2VyID0gR2FtZU1hbmFnZXI7Cn0pKCk7","AIPlayer.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCi8vIFJldXNhYmxlIHZlY3RvcnMKICAgIGNvbnN0IF9haVZlYyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfdGFyZ2V0UG9zID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgIGNvbnN0IF9zY2FuRGlyID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgIGNvbnN0IF9zY2FuVG9PcHAgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwoKY2xhc3MgQUlQbGF5ZXIgZXh0ZW5kcyB3aW5kb3cuZmx1eC5QbGF5ZXIgewogICAgICAgIGNvbnN0cnVjdG9yKHNjZW5lLCByb2xlKSB7CiAgICAgICAgICAgIHN1cGVyKHNjZW5lLCByb2xlKTsKICAgICAgICAgICAgdGhpcy5iYWxsUmVmID0gbnVsbDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFN0YXRzIGFyZSBtYW5hZ2VkIGJ5IFRlYW0vTWFpbiBvciBkZWZhdWx0IFBsYXllciB2YWx1ZXMuCiAgICAgICAgICAgIC8vIE5vIGNvbnN0cnVjdG9yIG92ZXJyaWRlcyB0byBlbnN1cmUgZmFpciBzY2FsaW5nIGFuZCBkZW1vIGNvbnNpc3RlbmN5LgogICAgICAgICAgICB0aGlzLl91cGRhdGVEZXJpdmVkU3RhdHMoKTsKCiAgICAgICAgICAgIC8vIFN0YXRlIE1hY2hpbmUKICAgICAgICAgICAgdGhpcy5haVN0YXRlID0gJ0lETEUnOwogICAgICAgICAgICB0aGlzLmRlY2lzaW9uVGltZXIgPSAwOwogICAgICAgICAgICB0aGlzLmRlY2lzaW9uSW50ZXJ2YWwgPSAwLjE7IC8vIElNUFJPVkVEOiBGYXN0ZXIgZGVjaXNpb25zICh3YXMgMC4yKQoKICAgICAgICAgICAgLy8gLS0tIFBFUkNFUFRJT04gU1lTVEVNIChSZWFjdGlvbiBUaW1lKSAtLS0KICAgICAgICAgICAgLy8gVGhlIEFJIHRyYWNrcyBhICJnaG9zdCIgdGFyZ2V0IHRoYXQgbGFncyBiZWhpbmQgcmVhbGl0eS4KICAgICAgICAgICAgLy8gVGhpcyBhbGxvd3MgaHVtYW4gcGxheWVycyB0byBqdWtlL2Zha2Ugb3V0IHRoZSBBSS4KICAgICAgICAgICAgdGhpcy5wZXJjZWl2ZWRUYXJnZXRQb3MgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgICAgICAgICB0aGlzLnJlYWN0aW9uU3BlZWQgPSA4LjA7IC8vIElNUFJPVkVEOiBGYXN0ZXIgcmVhY3Rpb24gKHdhcyA1LjApCgogICAgICAgICAgICAvLyBJTVBST1ZFRDogQmV0dGVyIGFudGljaXBhdGlvbgogICAgICAgICAgICB0aGlzLmFudGljaXBhdGlvblRpbWUgPSAwLjQ7IC8vIExlYWQgdGFyZ2V0IGJ5IHRoaXMgbWFueSBzZWNvbmRzCiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBSb2xlIENvbmZpZwogICAgICAgICAgICB0aGlzLmlzRm9yd2FyZCA9IFsnTEYnLCAnUkYnXS5pbmNsdWRlcyhyb2xlKTsKICAgICAgICAgICAgdGhpcy5pc01pZGZpZWxkZXIgPSByb2xlID09PSAnTUYnOwogICAgICAgICAgICB0aGlzLmlzRGVmZW5kZXIgPSBbJ0xEJywgJ1JEJ10uaW5jbHVkZXMocm9sZSk7CgogICAgICAgICAgICAvLyBBc3NpZ24gZGVmYXVsdCB0ZWNobmlxdWVzIHNvIEFJIGlzIGEgdGhyZWF0CiAgICAgICAgICAgIHRoaXMuX2Fzc2lnbkRlZmF1bHRUZWNocygpOwogICAgICAgIH0KCiAgICAgICAgX2Fzc2lnbkRlZmF1bHRUZWNocygpIHsKICAgICAgICAgICAgLy8gUmFuZG9tbHkgYXNzaWduIHRlY2hzIGJhc2VkIG9uIHJvbGUKY29uc3QgdGFja2xlVGVjaHMgPSBbJ3Zlbm9tJywgJ3dpdGhlcicsICdkcmFpbiddOwogICAgICAgICAgICBjb25zdCBzaG9vdFRlY2hzID0gWyd2ZW5vbScsICdzcGhlcmUnLCAnaW52aXNpYmxlJ107CiAgICAgICAgICAgIGNvbnN0IHBhc3NUZWNocyA9IFsndmVub20nLCAnd2l0aGVyJywgJ25hcCddOwogICAgICAgICAgICBjb25zdCBwYXNzaXZlVGVjaHMgPSBbJ2JyYXdsZXInLCAnZWxpdGVfZGVmZW5zZSddOwoKICAgICAgICAgICAgLy8gSGVscGVyIHRvIHBpY2sgcmFuZG9tCiAgICAgICAgICAgIGNvbnN0IHBpY2sgPSAoYXJyKSA9PiBhcnJbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogYXJyLmxlbmd0aCldOwogICAgICAgICAgICBjb25zdCBjaGFuY2UgPSAocHJvYikgPT4gTWF0aC5yYW5kb20oKSA8IHByb2I7CgppZiAodGhpcy5pc0RlZmVuZGVyKSB7CiAgICAgICAgICAgICAgICAvLyBEZWZlbmRlcnMgbG92ZSBzdGF0dXMgdGFja2xlcyBhbmQgcGFzc2l2ZXMKICAgICAgICAgICAgICAgIGlmIChjaGFuY2UoMC44KSkgdGhpcy50ZWNocy50YWNrbGUgPSBwaWNrKHRhY2tsZVRlY2hzKTsKICAgICAgICAgICAgICAgIGlmIChjaGFuY2UoMC4zKSkgdGhpcy50ZWNocy5wYXNzID0gcGljayhwYXNzVGVjaHMpOwogICAgICAgICAgICAgICAgaWYgKGNoYW5jZSgwLjUpKSB0aGlzLnRlY2hzLnBhc3NpdmUgPSBwaWNrKHBhc3NpdmVUZWNocyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5pc01pZGZpZWxkZXIpIHsKICAgICAgICAgICAgICAgIC8vIE1pZGZpZWxkZXJzIGFyZSBiYWxhbmNlZAogICAgICAgICAgICAgICAgaWYgKGNoYW5jZSgwLjYpKSB0aGlzLnRlY2hzLnRhY2tsZSA9IHBpY2sodGFja2xlVGVjaHMpOwogICAgICAgICAgICAgICAgaWYgKGNoYW5jZSgwLjYpKSB0aGlzLnRlY2hzLnBhc3MgPSBwaWNrKHBhc3NUZWNocyk7CiAgICAgICAgICAgICAgICBpZiAoY2hhbmNlKDAuMykpIHRoaXMudGVjaHMuc2hvb3QgPSBwaWNrKHNob290VGVjaHMpOwogICAgICAgICAgICAgICAgaWYgKGNoYW5jZSgwLjMpKSB0aGlzLnRlY2hzLnBhc3NpdmUgPSBwaWNrKHBhc3NpdmVUZWNocyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5pc0ZvcndhcmQpIHsKICAgICAgICAgICAgICAgIC8vIEZvcndhcmRzIGZvY3VzIG9uIHNob290aW5nCiAgICAgICAgICAgICAgICBpZiAoY2hhbmNlKDAuOSkpIHRoaXMudGVjaHMuc2hvb3QgPSBwaWNrKHNob290VGVjaHMpOwogICAgICAgICAgICAgICAgaWYgKGNoYW5jZSgwLjQpKSB0aGlzLnRlY2hzLnRhY2tsZSA9IHBpY2sodGFja2xlVGVjaHMpOyAvLyBGcm9udGxpbmUgcHJlc3N1cmUKICAgICAgICAgICAgICAgIGlmIChjaGFuY2UoMC4yKSkgdGhpcy50ZWNocy5wYXNzaXZlID0gcGljayhwYXNzaXZlVGVjaHMpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKdXBkYXRlKGR0KSB7CiAgICAgICAgICAgIC8vIFNhZmV0eTogQXV0by1saW5rIGJhbGwgaWYgbWlzc2luZyAoU2VsZi1oZWFsaW5nKQogICAgICAgICAgICBpZiAoIXRoaXMuYmFsbFJlZiAmJiB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UgJiYgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmVudGl0aWVzKSB7CiAgICAgICAgICAgICAgICB0aGlzLmJhbGxSZWYgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZW50aXRpZXMuYmFsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMC4gQ2hlY2sgaWYgQUkgbG9naWMgc2hvdWxkIHJ1bgogICAgICAgICAgICBjb25zdCBnYW1lID0gd2luZG93LmZsdXguZ2FtZUluc3RhbmNlOwogICAgICAgICAgICBjb25zdCBpc0RlbW8gPSBnYW1lICYmIGdhbWUuaXNEZW1vTW9kZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENoZWNrIGluY2FwYWNpdGF0aW9uIChTdHVuIG9yIE5hcCkKICAgICAgICAgICAgY29uc3QgaXNJbmNhcGFjaXRhdGVkID0gKHRoaXMuc3R1blRpbWVyID4gMCkgfHwgKHRoaXMuc3RhdHVzLm5hcCA+IDApOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQUkgcnVucyBpZjoKICAgICAgICAgICAgLy8gMS4gSXQncyBhbiBBSSB0ZWFtIChub3QgaHVtYW4pCiAgICAgICAgICAgIC8vIDIuIEl0J3MgYSBIdW1hbiB0ZWFtIEJVVCBEZW1vIE1vZGUgaXMgT04KICAgICAgICAgICAgLy8gMy4gSXQncyBhIEh1bWFuIHRlYW0sIERlbW8gaXMgT0ZGLCBidXQgdGhpcyBwbGF5ZXIgaXMgTk9UIHRoZSBhY3RpdmUgY29udHJvbGxlZCBwbGF5ZXIKICAgICAgICAgICAgY29uc3QgaXNIdW1hblRlYW0gPSB0aGlzLnRlYW0gJiYgdGhpcy50ZWFtLmlzSHVtYW47CiAgICAgICAgICAgIGNvbnN0IGlzQWN0aXZlUGxheWVyID0gdGhpcy50ZWFtICYmICh0aGlzLnRlYW0uYWN0aXZlUGxheWVyID09PSB0aGlzKTsKICAgICAgICAgICAgY29uc3Qgc2hvdWxkUnVuQUkgPSAoIWlzSHVtYW5UZWFtIHx8IGlzRGVtbyB8fCAoaXNIdW1hblRlYW0gJiYgIWlzQWN0aXZlUGxheWVyKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBNYXN0ZXIgQUkgU3dpdGNoIGZvciB0aGUgdGVhbQogICAgICAgICAgICBjb25zdCBpc1RlYW1BSUVuYWJsZWQgPSB0aGlzLnRlYW0gPyB0aGlzLnRlYW0uYWlFbmFibGVkIDogdHJ1ZTsKCiAgICAgICAgICAgIGlmIChpc0luY2FwYWNpdGF0ZWQpIHsKICAgICAgICAgICAgICAgIC8vIElmIHN0dW5uZWQvc2xlZXBpbmcsIGRvIG5vdGhpbmcuCiAgICAgICAgICAgICAgICB0aGlzLnNldElucHV0KDAsIDApOwogICAgICAgICAgICB9IGVsc2UgaWYgKHNob3VsZFJ1bkFJICYmIGlzVGVhbUFJRW5hYmxlZCkgewogICAgICAgICAgICAgICAgLy8gLS0tIElNUFJPVkVEIFBFUkNFUFRJT04gVVBEQVRFIC0tLQogICAgICAgICAgICAgICAgLy8gVXBkYXRlIHBlcmNlaXZlZCBwb3NpdGlvbiB0b3dhcmRzIHJlYWwgdGFyZ2V0IChCYWxsIG9yIEJhbGwgSG9sZGVyKQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYmFsbFJlZiAmJiB0aGlzLmJhbGxSZWYubWVzaCkgewogICAgICAgICAgICAgICAgICAgIGxldCByZWFsVGFyZ2V0ID0gdGhpcy5iYWxsUmVmLm1lc2gucG9zaXRpb24uY2xvbmUoKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgYmFsbCBpcyBoZWxkLCB0cmFjayB0aGUgaG9sZGVyIHdpdGggYW50aWNpcGF0aW9uCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYmFsbFJlZi5ob2xkZXIgJiYgdGhpcy5iYWxsUmVmLmhvbGRlci5tZXNoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWxUYXJnZXQgPSB0aGlzLmJhbGxSZWYuaG9sZGVyLm1lc2gucG9zaXRpb24uY2xvbmUoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElNUFJPVkVEOiBMZWFkIHRoZSB0YXJnZXQgYmFzZWQgb24gdGhlaXIgdmVsb2NpdHkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYmFsbFJlZi5ob2xkZXIudmVsb2NpdHkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWxUYXJnZXQuYWRkU2NhbGVkVmVjdG9yKHRoaXMuYmFsbFJlZi5ob2xkZXIudmVsb2NpdHksIHRoaXMuYW50aWNpcGF0aW9uVGltZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYmFsbFJlZi52ZWxvY2l0eSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBGb3IgbG9vc2UgYmFsbCwgYW50aWNpcGF0ZSBiYXNlZCBvbiBiYWxsIHZlbG9jaXR5CiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWxUYXJnZXQuYWRkU2NhbGVkVmVjdG9yKHRoaXMuYmFsbFJlZi52ZWxvY2l0eSwgdGhpcy5hbnRpY2lwYXRpb25UaW1lICogMC41KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIExlcnAgcGVyY2VwdGlvbiB0b3dhcmRzIGFudGljaXBhdGVkIHJlYWxpdHkKICAgICAgICAgICAgICAgICAgICBjb25zdCBhbHBoYSA9IE1hdGgubWluKDEuMCwgZHQgKiB0aGlzLnJlYWN0aW9uU3BlZWQpOwogICAgICAgICAgICAgICAgICAgIHRoaXMucGVyY2VpdmVkVGFyZ2V0UG9zLmxlcnAocmVhbFRhcmdldCwgYWxwaGEpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIDEuIERlY2lzaW9uIE1ha2luZwogICAgICAgICAgICAgICAgdGhpcy5kZWNpc2lvblRpbWVyICs9IGR0OwogICAgICAgICAgICAgICAgaWYgKHRoaXMuZGVjaXNpb25UaW1lciA+IHRoaXMuZGVjaXNpb25JbnRlcnZhbCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuZGVjaXNpb25UaW1lciA9IDA7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZXZhbHVhdGVTdGF0ZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIDIuIEV4ZWN1dGUgU3RhdGUgKFNldHMgaW5wdXRWZWN0b3IpCiAgICAgICAgICAgICAgICB0aGlzLl9leGVjdXRlU3RhdGUoZHQpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyAzLiBJbnRlcmNlcHRpb24gTG9naWMKICAgICAgICAgICAgICAgIHRoaXMuX2FwcGx5SW50ZXJjZXB0aW9uUHJlc3N1cmUoZHQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gSGVyZSBpZjoKICAgICAgICAgICAgICAgIC8vIDEuIENvbnRyb2xsZWQgYnkgSHVtYW4gKHNob3VsZFJ1bkFJID09IGZhbHNlKQogICAgICAgICAgICAgICAgLy8gMi4gQUkgTG9naWMgaXMgRGlzYWJsZWQgKGlzVGVhbUFJRW5hYmxlZCA9PSBmYWxzZSkKCiAgICAgICAgICAgICAgICAvLyBJZiBBSSBpcyBkaXNhYmxlZCwgd2UgbXVzdCBzdG9wIHRoZSBib3QgVU5MRVNTIGl0IGlzIGJlaW5nIGRyaXZlbiBieSBodW1hbiBpbnB1dC4KICAgICAgICAgICAgICAgIC8vIEh1bWFuIGlucHV0IGRyaXZlcyB0aGUgcGxheWVyIGlmOiBpc0h1bWFuVGVhbSBBTkQgaXNBY3RpdmVQbGF5ZXIgQU5EICFpc0RlbW8KICAgICAgICAgICAgICAgIGNvbnN0IGlzRHJpdmVuQnlIdW1hbiA9IGlzSHVtYW5UZWFtICYmIGlzQWN0aXZlUGxheWVyICYmICFpc0RlbW87CgogICAgICAgICAgICAgICAgaWYgKCFpc1RlYW1BSUVuYWJsZWQgJiYgIWlzRHJpdmVuQnlIdW1hbikgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0SW5wdXQoMCwgMCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gV2Ugc3RpbGwgYXBwbHkgcGFzc2l2ZSBpbnRlcmNlcHRpb24gaWYgaW4gdGhlIHdheS4KICAgICAgICAgICAgICAgIHRoaXMuX2FwcGx5SW50ZXJjZXB0aW9uUHJlc3N1cmUoZHQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyA0LiBCYXNlIFVwZGF0ZQogICAgICAgICAgICBzdXBlci51cGRhdGUoZHQpOwogICAgICAgIH0KCl9ldmFsdWF0ZVN0YXRlKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuYmFsbFJlZikgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBiYWxsID0gdGhpcy5iYWxsUmVmOwoKICAgICAgICAgICAgLy8gMS4gSSBoYXZlIHRoZSBiYWxsCiAgICAgICAgICAgIGlmICh0aGlzLmhhc0JhbGwpIHsKICAgICAgICAgICAgICAgIHRoaXMuYWlTdGF0ZSA9ICdBVFRBQ0tfQ0FSUlknOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAyLiBMb29zZSBCYWxsIExvZ2ljIChBbnRpLUZsb2NraW5nKQogICAgICAgICAgICBpZiAoIWJhbGwuaG9sZGVyKSB7CiAgICAgICAgICAgICAgICAvLyBEZWZhdWx0OiBSZXR1cm4gdG8gZm9ybWF0aW9uLiBPbmx5IGNoYXNlIGlmIHdlIGFyZSB0aGUgYmVzdCBjYW5kaWRhdGUuCiAgICAgICAgICAgICAgICB0aGlzLmFpU3RhdGUgPSAnUkVUVVJOX0hPTUUnOwoKLy8gSHlzdGVyZXNpczogSWYgSSB3YXMgYWxyZWFkeSBjaGFzaW5nLCBJJ20gZWZmZWN0aXZlbHkgImNsb3NlciIgdG8gcHJldmVudCBqaXR0ZXJ5IHN3aXRjaGluZwogICAgICAgICAgICAgICAgLy8gVGhpcyBwcmV2ZW50cyB0d28gcGxheWVycyBmcm9tIHN3YXBwaW5nIHJvbGVzIHJhcGlkbHkgd2hlbiBlcXVpZGlzdGFudC4KICAgICAgICAgICAgICAgIGNvbnN0IGJpYXMgPSAodGhpcy5haVN0YXRlID09PSAnQ0hBU0UnKSA/IDAuOCA6IDEuMDsKICAgICAgICAgICAgICAgIGNvbnN0IG15RGlzdCA9IHRoaXMubWVzaC5wb3NpdGlvbi5kaXN0YW5jZVRvKGJhbGwubWVzaC5wb3NpdGlvbikgKiBiaWFzOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsZXQgaXNDbG9zZXN0ID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICBpZiAodGhpcy50ZWFtICYmIHRoaXMudGVhbS5wbGF5ZXJzKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBwIG9mIHRoaXMudGVhbS5wbGF5ZXJzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwID09PSB0aGlzKSBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFwLm1lc2gpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWdub3JlIEdvYWxpZSAoR29hbGllIGhhbmRsZXMgdGhlaXIgb3duIGFyZWE7IGZpZWxkIHBsYXllcnMgc2hvdWxkbid0IHJlbHkgb24gdGhlbSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHAucm9sZSA9PT0gJ0dMJykgY29udGludWU7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmUgaW5jYXBhY2l0YXRlZCB0ZWFtbWF0ZXMKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHAuc3RhdHVzICYmIHAuc3RhdHVzLm5hcCA+IDApIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHRlYW1tYXRlIGRpc3RhbmNlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vdGU6IFdlIGRvbid0IGFwcGx5IGJpYXMgdG8gb3RoZXJzLCBlZmZlY3RpdmVseSBtYWtpbmcgIm1lIiBzdGlja2llciBpZiBJJ20gYWxyZWFkeSBjaGFzaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBEaXN0ID0gcC5tZXNoLnBvc2l0aW9uLmRpc3RhbmNlVG8oYmFsbC5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIGEgdGVhbW1hdGUgaXMgY2xvc2VyLCB5aWVsZCB0byB0aGVtCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwRGlzdCA8IG15RGlzdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNDbG9zZXN0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KfQoKICAgICAgICAgICAgICAgIGlmIChpc0Nsb3Nlc3QpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFpU3RhdGUgPSAnQ0hBU0UnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAzLiBUZWFtbWF0ZSBoYXMgYmFsbAogICAgICAgICAgICBpZiAoYmFsbC5ob2xkZXIudGVhbSA9PT0gdGhpcy50ZWFtKSB7CiAgICAgICAgICAgICAgICB0aGlzLmFpU3RhdGUgPSAnU1VQUE9SVCc7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDQuIE9wcG9uZW50IGhhcyBiYWxsCiAgICAgICAgICAgIGlmIChiYWxsLmhvbGRlci50ZWFtICE9PSB0aGlzLnRlYW0pIHsKICAgICAgICAgICAgICAgIHRoaXMuYWlTdGF0ZSA9ICdERUZFTkQnOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBfZXhlY3V0ZVN0YXRlKGR0KSB7CiAgICAgICAgICAgIGlmICghdGhpcy5iYWxsUmVmKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNldElucHV0KDAsIDApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzd2l0Y2ggKHRoaXMuYWlTdGF0ZSkgewogICAgICAgICAgICAgICAgY2FzZSAnQVRUQUNLX0NBUlJZJzogdGhpcy5fc3RhdGVBdHRhY2tDYXJyeShkdCk7IGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnU1VQUE9SVCc6IHRoaXMuX3N0YXRlU3VwcG9ydChkdCk7IGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnREVGRU5EJzogdGhpcy5fc3RhdGVEZWZlbmQoZHQpOyBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0NIQVNFJzogdGhpcy5fc3RhdGVDaGFzZShkdCk7IGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnUkVUVVJOX0hPTUUnOiAKICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHRoaXMuX3N0YXRlUmV0dXJuSG9tZShkdCk7IGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0gU1RBVEVTIC0tLQoKX3N0YXRlQXR0YWNrQ2FycnkoZHQpIHsKICAgICAgICAgICAgLy8gRHJpdmUgdG8gZ29hbAogICAgICAgICAgICAvLyBIb21lIChTaWRlIDEpIGF0dGFja3MgLVouIEF3YXkgKFNpZGUgLTEpIGF0dGFja3MgK1ouCiAgICAgICAgICAgIGNvbnN0IGF0dGFja0RpciA9ICh0aGlzLnRlYW0uc2lkZSA9PT0gMSkgPyAtMSA6IDE7CiAgICAgICAgICAgIGNvbnN0IGdvYWxaID0gMjggKiBhdHRhY2tEaXI7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBUYXJnZXQ6IEdvYWwgKGJ1dCByZXNwZWN0IGNyZWFzZSkKICAgICAgICAgICAgX3RhcmdldFBvcy5zZXQoMCwgMCwgZ29hbFopOwogICAgICAgICAgICB0aGlzLl9hdm9pZEdvYWxDcmVhc2UoX3RhcmdldFBvcyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBNb3ZlCiAgICAgICAgICAgIHRoaXMuX21vdmVUbyhfdGFyZ2V0UG9zKTsKCiAgICAgICAgICAgIC8vIERlY2lzaW9uOiBTaG9vdCBvciBQYXNzPwogICAgICAgICAgICBjb25zdCBkaXN0VG9Hb2FsID0gTWF0aC5hYnModGhpcy5tZXNoLnBvc2l0aW9uLnogLSBnb2FsWik7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAxLiBTaG9vdCBpZiBjbG9zZSBhbmQgY2xlYXIKICAgICAgICAgICAgaWYgKGRpc3RUb0dvYWwgPCAyMC4wICYmICF0aGlzLmlzVGhyb3dpbmcpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3NtYXJ0VGhyb3codGhpcy5iYWxsUmVmLCAnU0gnKTsgCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIDIuIFBhc3MgTG9naWMKICAgICAgICAgICAgLy8gQ2hlY2sgcGFzcyBpZjogU3Vycm91bmRlZCwgTG93IEVOLCBvciBQbGF5bWFrZXIgKE1pZGZpZWxkZXIpIHNlZXMgb3Bwb3J0dW5pdHkKICAgICAgICAgICAgY29uc3QgaXNTdXJyb3VuZGVkID0gdGhpcy5faXNTdXJyb3VuZGVkKCk7CiAgICAgICAgICAgIGNvbnN0IGxvd0VOID0gdGhpcy5jdXJyZW50RU4gPCAxMDsKICAgICAgICAgICAgY29uc3QgaXNQbGF5bWFrZXIgPSB0aGlzLmlzTWlkZmllbGRlcjsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICgoaXNTdXJyb3VuZGVkIHx8IGxvd0VOIHx8IGlzUGxheW1ha2VyKSAmJiAhdGhpcy5pc1Rocm93aW5nKSB7CiAgICAgICAgICAgICAgICBjb25zdCBiZXN0TWF0ZSA9IHRoaXMuX2ZpbmRCZXN0UGFzc1RhcmdldCgpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoYmVzdE1hdGUpIHsKICAgICAgICAgICAgICAgICAgICAvLyBFdmFsdWF0ZSBpZiBwYXNzIGlzIHdvcnRoIGl0CiAgICAgICAgICAgICAgICAgICAgLy8gSWYgUGxheW1ha2VyLCBwYXNzIGlmIG1hdGUgaXMgY2xvc2VyIHRvIGdvYWwKICAgICAgICAgICAgICAgICAgICAvLyBJZiBQYW5pYyAoU3Vycm91bmRlZC9Mb3dFTiksIHBhc3MgdG8gYW55b25lIG9wZW4KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsZXQgc2hvdWxkUGFzcyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIChpc1N1cnJvdW5kZWQgfHwgbG93RU4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2hvdWxkUGFzcyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc1BsYXltYWtlcikgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBteURpc3QgPSBNYXRoLmFicyh0aGlzLm1lc2gucG9zaXRpb24ueiAtIGdvYWxaKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbWF0ZURpc3QgPSBNYXRoLmFicyhiZXN0TWF0ZS5tZXNoLnBvc2l0aW9uLnogLSBnb2FsWik7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXRlRGlzdCA8IG15RGlzdCAtIDUuMCkgc2hvdWxkUGFzcyA9IHRydWU7IC8vIE1hdGUgaXMgNW0gY2xvc2VyCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIChzaG91bGRQYXNzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZhY2UgdGFyZ2V0CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5sb29rQXQoYmVzdE1hdGUubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEV4ZWN1dGUgUGFzcwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zbWFydFRocm93KHRoaXMuYmFsbFJlZiwgJ1BBJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIDMuIFBhbmljIENsZWFyIChJZiBzdXJyb3VuZGVkIGFuZCBubyBwYXNzKQogICAgICAgICAgICBpZiAoaXNTdXJyb3VuZGVkICYmICF0aGlzLmlzVGhyb3dpbmcpIHsKICAgICAgICAgICAgICAgIC8vIEp1c3Qgc2hvb3QvY2xlYXIKICAgICAgICAgICAgICAgIHRoaXMuX3NtYXJ0VGhyb3codGhpcy5iYWxsUmVmLCAnU0gnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX2lzU3Vycm91bmRlZCgpIHsKICAgICAgICAgICAgLy8gU2ltcGxlIGNoZWNrOiBjb3VudCBlbmVtaWVzIG5lYXJieQogICAgICAgICAgICBsZXQgY291bnQgPSAwOwogICAgICAgICAgICBjb25zdCBnYW1lID0gd2luZG93LmZsdXguZ2FtZUluc3RhbmNlOwogICAgICAgICAgICBpZiAoIWdhbWUpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgY29uc3Qgb3BwVGVhbSA9ICh0aGlzLnRlYW0uaWQgPT09ICdob21lJykgPyBnYW1lLnRlYW1zLmF3YXkgOiBnYW1lLnRlYW1zLmhvbWU7CiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IobGV0IHAgb2Ygb3BwVGVhbS5wbGF5ZXJzKSB7CiAgICAgICAgICAgICAgICBpZiAocC5tZXNoICYmIHAubWVzaC5wb3NpdGlvbi5kaXN0YW5jZVRvKHRoaXMubWVzaC5wb3NpdGlvbikgPCA0LjApIHsKICAgICAgICAgICAgICAgICAgICBjb3VudCsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBjb3VudCA+PSAyOwogICAgICAgIH0KCiAgICAgICAgX3NtYXJ0VGhyb3coYmFsbCwgZm9yY2VkVHlwZSA9IG51bGwpIHsKICAgICAgICAgICAgLy8gV3JhcHBlciBhcm91bmQgdGhyb3dCYWxsIHRvIG1hbmFnZSBIUCBhbmQgVGVjaHMKICAgICAgICAgICAgLy8gMS4gRGV0ZXJtaW5lIGludGVuZGVkIGFjdGlvbiB0eXBlCiAgICAgICAgICAgIGxldCB0eXBlID0gZm9yY2VkVHlwZTsKICAgICAgICAgICAgaWYgKCF0eXBlKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkaXIgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAxKS5hcHBseVF1YXRlcm5pb24odGhpcy5tZXNoLnF1YXRlcm5pb24pOwogICAgICAgICAgICAgICAgY29uc3QgYXR0YWNrRGlyID0gKHRoaXMudGVhbSAmJiB0aGlzLnRlYW0uc2lkZSA9PT0gMSkgPyAtMSA6IDE7CiAgICAgICAgICAgICAgICBjb25zdCBpc0FpbWluZ0dvYWwgPSAoZGlyLnogKiBhdHRhY2tEaXIgPiAwLjUpOwogICAgICAgICAgICAgICAgdHlwZSA9IGlzQWltaW5nR29hbCA/ICdTSCcgOiAnUEEnOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAyLiBHZXQgVGVjaAogICAgICAgICAgICBjb25zdCB0ZWNoTmFtZSA9ICh0eXBlID09PSAnU0gnKSA/IHRoaXMudGVjaHMuc2hvb3QgOiB0aGlzLnRlY2hzLnBhc3M7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAzLiBFc3RpbWF0ZSBDb3N0CiAgICAgICAgICAgIGxldCBiYXNlQ29zdCA9ICh0eXBlID09PSAnU0gnKSA/IDIwIDogMTA7CiAgICAgICAgICAgIGxldCB0ZWNoQ29zdCA9IDA7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAodGVjaE5hbWUpIHsKICAgICAgICAgICAgICAgIC8vIFJvdWdoIGVzdGltYXRlcyBiYXNlZCBvbiBQbGF5ZXIuanMKICAgICAgICAgICAgICAgIGlmICh0ZWNoTmFtZS5pbmNsdWRlcygnbmFwJykpIHRlY2hDb3N0ID0gMzA7CiAgICAgICAgICAgICAgICBlbHNlIGlmICh0ZWNoTmFtZS5pbmNsdWRlcygnc3BoZXJlJykgfHwgdGVjaE5hbWUuaW5jbHVkZXMoJ2ludmlzaWJsZScpKSB0ZWNoQ29zdCA9IDI1OwogICAgICAgICAgICAgICAgZWxzZSB0ZWNoQ29zdCA9IDIwOyAvLyBWZW5vbS9XaXRoZXIKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgdG90YWxDb3N0ID0gYmFzZUNvc3QgKyB0ZWNoQ29zdDsKCiAgICAgICAgICAgIC8vIDQuIERlY2lzaW9uCiAgICAgICAgICAgIC8vIElmIHdlIGhhdmUgYSB0ZWNoIGJ1dCBub3QgZW5vdWdoIEhQIGZvciBpdCwgQlVUIGVub3VnaCBIUCBmb3Igbm9ybWFsLi4uCiAgICAgICAgICAgIC8vIERpc2FibGUgdGVjaCB0ZW1wb3JhcmlseSB0byBhdm9pZCAiVGlyZWQiIHBlbmFsdHkgKDAuNXggc3RhdHMpCiAgICAgICAgICAgIGxldCB0ZW1wVGVjaCA9IG51bGw7CiAgICAgICAgICAgIGlmICh0ZWNoTmFtZSAmJiB0aGlzLnN0YXRzLkhQIDwgdG90YWxDb3N0ICYmIHRoaXMuc3RhdHMuSFAgPj0gYmFzZUNvc3QpIHsKICAgICAgICAgICAgICAgIC8vIFVuZXF1aXAKICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAnU0gnKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcFRlY2ggPSB0aGlzLnRlY2hzLnNob290OwogICAgICAgICAgICAgICAgICAgIHRoaXMudGVjaHMuc2hvb3QgPSBudWxsOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0ZW1wVGVjaCA9IHRoaXMudGVjaHMucGFzczsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRlY2hzLnBhc3MgPSBudWxsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBFeGVjdXRlCiAgICAgICAgICAgIHRoaXMudGhyb3dCYWxsKGJhbGwsIHR5cGUpOwoKICAgICAgICAgICAgLy8gUmVzdG9yZQogICAgICAgICAgICBpZiAodGVtcFRlY2gpIHsKICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAnU0gnKSB0aGlzLnRlY2hzLnNob290ID0gdGVtcFRlY2g7CiAgICAgICAgICAgICAgICBlbHNlIHRoaXMudGVjaHMucGFzcyA9IHRlbXBUZWNoOwogICAgICAgICAgICB9CiAgICAgICAgfQoKX3N0YXRlQ2hhc2UoZHQpIHsKICAgICAgICAgICAgLy8gSW50ZXJjZXB0aW9uOiBDaGFzZSB0aGUgUEVSQ0VJVkVEIHBvc2l0aW9uLCBub3QgdGhlIHJlYWwgb25lLgogICAgICAgICAgICAvLyBUaGlzIGFsbG93cyBqdWtlcyB0byB3b3JrIGJlY2F1c2UgdGhlIEFJIGlzIGNoYXNpbmcgd2hlcmUgeW91IFdFUkUuCiAgICAgICAgICAgIF90YXJnZXRQb3MuY29weSh0aGlzLnBlcmNlaXZlZFRhcmdldFBvcyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBJZiBiYWxsIGhhcyB2ZWxvY2l0eSwgbGVhZCBpdCBzbGlnaHRseSBiYXNlZCBvbiBwZXJjZXB0aW9uCiAgICAgICAgICAgIGNvbnN0IGJhbGwgPSB0aGlzLmJhbGxSZWY7CiAgICAgICAgICAgIGlmIChiYWxsLnZlbG9jaXR5Lmxlbmd0aFNxKCkgPiAxLjApIHsKICAgICAgICAgICAgICAgIF90YXJnZXRQb3MuYWRkU2NhbGVkVmVjdG9yKGJhbGwudmVsb2NpdHksIDAuMyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHRoaXMuX2F2b2lkR29hbENyZWFzZShfdGFyZ2V0UG9zKTsKICAgICAgICAgICAgdGhpcy5fbW92ZVRvKF90YXJnZXRQb3MpOwogICAgICAgIH0KCl9zdGF0ZVJldHVybkhvbWUoZHQpIHsKICAgICAgICAgICAgLy8gUmV0dXJuIHRvIGZvcm1hdGlvbiBwb3NpdGlvbgogICAgICAgICAgICBfdGFyZ2V0UG9zLmNvcHkodGhpcy5ob21lUG9zaXRpb24pOwogICAgICAgICAgICB0aGlzLl9hdm9pZEdvYWxDcmVhc2UoX3RhcmdldFBvcyk7CiAgICAgICAgICAgIHRoaXMuX21vdmVUbyhfdGFyZ2V0UG9zKTsKICAgICAgICB9Cgpfc3RhdGVTdXBwb3J0KGR0KSB7CiAgICAgICAgICAgIC8vIE9GRkVOU0UgKFRlYW1tYXRlIGhhcyBiYWxsKQogICAgICAgICAgICAvLyBHb2FsOiBGaW5kIG9wZW4gc3BhY2UgdG8gcmVjZWl2ZSBhIHBhc3MKICAgICAgICAgICAgY29uc3QgYmFsbFBvcyA9IHRoaXMuYmFsbFJlZi5tZXNoLnBvc2l0aW9uOwogICAgICAgICAgICBjb25zdCBhdHRhY2tEaXIgPSAodGhpcy50ZWFtLnNpZGUgPT09IDEpID8gLTEgOiAxOwogICAgICAgICAgICBjb25zdCBnb2FsWiA9ICh0aGlzLnRlYW0uc2lkZSA9PT0gMSkgPyAtMjggOiAyODsKCiAgICAgICAgICAgIC8vIDEuIERldGVybWluZSAiSWRlYWwiIFN1cHBvcnQgUG9zaXRpb24KICAgICAgICAgICAgLy8gU3RhcnQgd2l0aCBmb3JtYXRpb24gaG9tZQogICAgICAgICAgICBfdGFyZ2V0UG9zLmNvcHkodGhpcy5ob21lUG9zaXRpb24pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gMi4gRHluYW1pYyBBZGp1c3RtZW50CiAgICAgICAgICAgIGlmICh0aGlzLmlzRm9yd2FyZCkgewogICAgICAgICAgICAgICAgLy8gRm9yd2FyZHM6IE1ha2UgcnVucyB0b3dhcmRzIHRoZSBnb2FsL2JveAogICAgICAgICAgICAgICAgLy8gSWYgYmFsbCBpcyBkZWVwLCBjdXQgdG8gY2VudGVyLiBJZiBiYWxsIGlzIGJhY2ssIHB1c2ggbGluZS4KICAgICAgICAgICAgICAgIF90YXJnZXRQb3MueiA9IGJhbGxQb3MueiArIChhdHRhY2tEaXIgKiAxMC4wKTsgLy8gU3RheSBhaGVhZCBvZiBiYWxsCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFppZy16YWcgcnVuIHBhdHRlcm4gYmFzZWQgb24gdGltZSB0byBsb29rICJhbGl2ZSIKICAgICAgICAgICAgICAgIGNvbnN0IHRpbWUgPSBEYXRlLm5vdygpICogMC4wMDE7CiAgICAgICAgICAgICAgICBfdGFyZ2V0UG9zLnggKz0gTWF0aC5zaW4odGltZSArIHRoaXMubWVzaC5pZCkgKiA1LjA7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmlzTWlkZmllbGRlcikgewogICAgICAgICAgICAgICAgLy8gTWlkZmllbGRlcnM6IEZpbmQgcG9ja2V0IGJldHdlZW4gYmFsbCBhbmQgZ29hbAogICAgICAgICAgICAgICAgX3RhcmdldFBvcy5sZXJwVmVjdG9ycyhiYWxsUG9zLCBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCBnb2FsWiksIDAuNCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFN0YXkgd2lkZSBpZiBiYWxsIGlzIGNlbnRyYWwsIGNvbWUgY2VudHJhbCBpZiBiYWxsIGlzIHdpZGUKICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyhiYWxsUG9zLngpIDwgNSkgX3RhcmdldFBvcy54ID0gKHRoaXMuaG9tZVBvc2l0aW9uLnggPiAwID8gMTAgOiAtMTApOwogICAgICAgICAgICAgICAgZWxzZSBfdGFyZ2V0UG9zLnggPSAwOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gRGVmZW5kZXJzOiBTdXBwb3J0IGZyb20gYmVoaW5kIChzYWZldHkgdmFsdmUpCiAgICAgICAgICAgICAgICBfdGFyZ2V0UG9zLnogPSBiYWxsUG9zLnogLSAoYXR0YWNrRGlyICogOC4wKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMy4gQXZvaWQgRGVmZW5kZXJzIChSYXljYXN0LWlzaCBjaGVjaykKICAgICAgICAgICAgLy8gSWYgYSBkZWZlbmRlciBpcyBuZWFyIG15IHRhcmdldCwgc2hpZnQgYXdheQogICAgICAgICAgICBjb25zdCBnYW1lID0gd2luZG93LmZsdXguZ2FtZUluc3RhbmNlOwogICAgICAgICAgICBpZiAoZ2FtZSkgewogICAgICAgICAgICAgICAgY29uc3Qgb3BwVGVhbSA9ICh0aGlzLnRlYW0uaWQgPT09ICdob21lJykgPyBnYW1lLnRlYW1zLmF3YXkgOiBnYW1lLnRlYW1zLmhvbWU7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG9wcCBvZiBvcHBUZWFtLnBsYXllcnMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAob3BwLm1lc2ggJiYgb3BwLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyhfdGFyZ2V0UG9zKSA8IDQuMCkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBEZWZlbmRlciBpcyBjbG9nZ2luZyBteSBzcG90LiBTaGlmdCBhd2F5IGZyb20gdGhlbS4KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmxlZURpciA9IF90YXJnZXRQb3MuY2xvbmUoKS5zdWIob3BwLm1lc2gucG9zaXRpb24pLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBfdGFyZ2V0UG9zLmFkZChmbGVlRGlyLm11bHRpcGx5U2NhbGFyKDUuMCkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gNC4gQ2xhbXAgdG8gQXJlbmEKLy8gNC4gQ2xhbXAgdG8gQXJlbmEgKEtlZXAgcGxheWVycyBpbiBib3VuZHMsIGFuZCBvdXQgb2YgZ29hbCBuZXRzKQovLyA0LiBDbGFtcCB0byBBcmVuYSAmIENyZWFzZQogICAgICAgICAgICB0aGlzLl9hdm9pZEdvYWxDcmVhc2UoX3RhcmdldFBvcyk7CgogICAgICAgICAgICB0aGlzLl9tb3ZlVG8oX3RhcmdldFBvcyk7CiAgICAgICAgfQoKX3N0YXRlRGVmZW5kKGR0KSB7CiAgICAgICAgICAgIC8vIERFRkVOU0UgKE9wcG9uZW50IGhhcyBiYWxsKQogICAgICAgICAgICAvLyBVc2UgUGVyY2VpdmVkIFBvc2l0aW9uIGZvciBkaXN0YW5jZSBjaGVja3MgYW5kIG1vdmVtZW50CiAgICAgICAgICAgIGNvbnN0IHRhcmdldFBvcyA9IHRoaXMucGVyY2VpdmVkVGFyZ2V0UG9zOwogICAgICAgICAgICBjb25zdCBkaXN0VG9CYWxsID0gdGhpcy5tZXNoLnBvc2l0aW9uLmRpc3RhbmNlVG8odGFyZ2V0UG9zKTsKICAgICAgICAgICAgCi8vIDEuIERldGVybWluZSBQcmVzcyBSYW5nZQogICAgICAgICAgICAvLyBCYXNlIHJhbmdlCiAgICAgICAgICAgIGxldCBwcmVzc1JhbmdlID0gdGhpcy5pc0RlZmVuZGVyID8gMTUuMCA6IDEyLjA7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBBZ2dyZXNzaXZlIFRlY2ggVXNhZ2UKICAgICAgICAgICAgaWYgKHRoaXMudGVjaHMudGFja2xlICYmIHRoaXMuc3RhdHMuSFAgPiAyMCkgewogICAgICAgICAgICAgICAgcHJlc3NSYW5nZSArPSA1LjA7IAogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAtLS0gQU5USS1TV0FSTSBMT0dJQyAmIEFHR1JFU1NJT04gLS0tCiAgICAgICAgICAgIC8vIE9ubHkgdGhlIGNsb3Nlc3QgZGVmZW5kZXIgc2hvdWxkIGhhcmQtcHJlc3MgZnJvbSBkaXN0YW5jZS4KICAgICAgICAgICAgLy8gT3RoZXJzIHNob3VsZCBzdGljayB0byB0aGVpciB6b25lcy9tYXJrcyB1bmxlc3MgdGhlIGJhbGwgZW50ZXJzIHRoZWlyIHBlcnNvbmFsIHNwYWNlLgogICAgICAgICAgICBsZXQgYW1JQ2xvc2VzdCA9IHRydWU7CiAgICAgICAgICAgIGNvbnN0IG15RGlzdFNxID0gZGlzdFRvQmFsbCAqIGRpc3RUb0JhbGw7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAodGhpcy50ZWFtICYmIHRoaXMudGVhbS5wbGF5ZXJzKSB7CiAgICAgICAgICAgICAgICBmb3IoY29uc3QgbWF0ZSBvZiB0aGlzLnRlYW0ucGxheWVycykgewogICAgICAgICAgICAgICAgICAgIGlmIChtYXRlID09PSB0aGlzIHx8ICFtYXRlLm1lc2gpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIC8vIElnbm9yZSBHb2FsaWUgYW5kIGluY2FwYWNpdGF0ZWQgdGVhbW1hdGVzCiAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGUucm9sZSA9PT0gJ0dMJyB8fCBtYXRlLnN0YXR1cy5uYXAgPiAwIHx8IG1hdGUuc3R1blRpbWVyID4gMCkgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gVXNlIHJlYWwgcG9zaXRpb25zIGZvciB0ZWFtbWF0ZSBjb21wYXJpc29uIChBSSBrbm93cyB3aGVyZSB0ZWFtbWF0ZXMgYXJlKQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRTcSA9IG1hdGUubWVzaC5wb3NpdGlvbi5kaXN0YW5jZVRvU3F1YXJlZCh0YXJnZXRQb3MpOwogICAgICAgICAgICAgICAgICAgIGlmIChkU3EgPCBteURpc3RTcSkgewogICAgICAgICAgICAgICAgICAgICAgICBhbUlDbG9zZXN0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gWk9NQklFIEZJWDogSWYgSSBhbSB0aGUgY2xvc2VzdCwgSSBNVVNUIENIQVNFLgogICAgICAgICAgICAvLyBTZXQgcHJlc3NSYW5nZSB0byBlc3NlbnRpYWxseSBpbmZpbml0ZSBpZiBjbG9zZXN0LCBzbyB0aGV5IGRvbid0IGp1c3Qgc3RhbmQgdGhlcmUuCiAgICAgICAgICAgIGlmIChhbUlDbG9zZXN0KSB7CiAgICAgICAgICAgICAgICBwcmVzc1JhbmdlID0gNjAuMDsgLy8gRnVsbCBmaWVsZCBhZ2dyZXNzaW9uCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBJZiBub3QgY2xvc2VzdCwgcmV2ZXJ0IHRvIFpvbmUgRGVmZW5zZSByYW5nZSB0byBwcmV2ZW50IHN3YXJtaW5nCiAgICAgICAgICAgICAgICBwcmVzc1JhbmdlID0gOC4wOyAKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gSWYgYmFsbCBpcyBjbG9zZSBlbm91Z2ggKGJhc2VkIG9uIGNvbnRleHQpLCBQUkVTUyBJVAovLyBJZiBiYWxsIGlzIGNsb3NlIGVub3VnaCAoYmFzZWQgb24gY29udGV4dCksIFBSRVNTIElUCiAgICAgICAgICAgIGlmIChkaXN0VG9CYWxsIDwgcHJlc3NSYW5nZSkgewogICAgICAgICAgICAgICAgX3RhcmdldFBvcy5jb3B5KHRhcmdldFBvcyk7CiAgICAgICAgICAgICAgICB0aGlzLl9hdm9pZEdvYWxDcmVhc2UoX3RhcmdldFBvcyk7CiAgICAgICAgICAgICAgICB0aGlzLl9tb3ZlVG8oX3RhcmdldFBvcyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDIuIE1hcmsgTW9kZSAoTWFuLXRvLU1hbikKICAgICAgICAgICAgLy8gSWYgSSBoYXZlIGEgbWFyayBhc3NpZ25lZCwgc3RpY2sgdG8gdGhlbSB1bmxlc3MgcHJlc3NpbmcgYmFsbAogICAgICAgICAgICBpZiAodGhpcy5tYXJraW5nICYmIHRoaXMubWFya2luZy5tZXNoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBtYXJrUG9zID0gdGhpcy5tYXJraW5nLm1lc2gucG9zaXRpb247CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFBvc2l0aW9uOiBCZXR3ZWVuIG1hcmsgYW5kIG15IGdvYWwgKEdvYWwgU2lkZSkKICAgICAgICAgICAgICAgIGNvbnN0IG15R29hbFogPSAodGhpcy50ZWFtLnNpZGUgPT09IDEpID8gMjggOiAtMjg7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFZlY3RvciBmcm9tIE1hcmsgdG8gR29hbAogICAgICAgICAgICAgICAgY29uc3QgdG9Hb2FsID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgbXlHb2FsWiAtIG1hcmtQb3Mueik7CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0VG9Hb2FsID0gdG9Hb2FsLmxlbmd0aCgpOwogICAgICAgICAgICAgICAgdG9Hb2FsLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBTdGFuZCAzLjUgdW5pdHMgdG93YXJkcyBnb2FsIGZyb20gdGhlIG1hcmsgKEluY3JlYXNlZCBmcm9tIDIuMCB0byBnaXZlIGJyZWF0aGluZyByb29tKQogICAgICAgICAgICAgICAgX3RhcmdldFBvcy5jb3B5KG1hcmtQb3MpLmFkZFNjYWxlZFZlY3Rvcih0b0dvYWwsIDMuNSk7CiAgICAgICAgICAgICAgICAKdGhpcy5fYXZvaWRHb2FsQ3JlYXNlKF90YXJnZXRQb3MpOwogICAgICAgICAgICAgICAgdGhpcy5fbW92ZVRvKF90YXJnZXRQb3MpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAzLiBab25lIERlZmVuc2UgKEZvcm1hdGlvbiArIFNsaWRlKQogICAgICAgICAgICBfdGFyZ2V0UG9zLmNvcHkodGhpcy5ob21lUG9zaXRpb24pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU2xpZGUgbG9naWMgKFNoaWZ0IGZvcm1hdGlvbiB0b3dhcmRzIGJhbGwgc2lkZSkKICAgICAgICAgICAgX3RhcmdldFBvcy56ICs9IGJhbGxQb3MueiAqIDAuNjsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIERlZmVuZGVyIE92ZXJyaWRlOiBBbHdheXMgc3RheSBiZXR3ZWVuIGJhbGwgYW5kIGdvYWwKICAgICAgICAgICAgaWYgKHRoaXMuaXNEZWZlbmRlcikgewogICAgICAgICAgICAgICAgY29uc3QgbXlHb2FsWiA9ICh0aGlzLnRlYW0uc2lkZSA9PT0gMSkgPyAyOCA6IC0yODsKICAgICAgICAgICAgICAgIGNvbnN0IG1pZHBvaW50ID0gKGJhbGxQb3MueiArIG15R29hbFopICogMC41OwogICAgICAgICAgICAgICAgX3RhcmdldFBvcy56ID0gKF90YXJnZXRQb3MueiArIG1pZHBvaW50KSAqIDAuNTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQ2xhbXAKLy8gQ2xhbXAKICAgICAgICAgICAgX3RhcmdldFBvcy56ID0gTWF0aC5tYXgoLTI2LjAsIE1hdGgubWluKDI2LjAsIF90YXJnZXRQb3MueikpOwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5fYXZvaWRHb2FsQ3JlYXNlKF90YXJnZXRQb3MpOwogICAgICAgICAgICB0aGlzLl9tb3ZlVG8oX3RhcmdldFBvcyk7CiAgICAgICAgfQoKX2F2b2lkR29hbENyZWFzZSh0YXJnZXRQb3MpIHsKICAgICAgICAgICAgLy8gMS4gR29hbCBDcmVhc2UgQXZvaWRhbmNlIChSYWRpdXMgMTAgYXJvdW5kIGdvYWxzIGF0ICsvLSAyOCkKICAgICAgICAgICAgLy8gTWF0Y2hlcyBQbGF5ZXIuanMgX2FwcGx5R29hbENyZWFzZSBwaHlzaWNzIHRvIHByZXZlbnQgc3R1dHRlcmluZwogICAgICAgICAgICBjb25zdCBnb2FscyA9IFsKICAgICAgICAgICAgICAgIHsgeDogMCwgejogMjggfSwKICAgICAgICAgICAgICAgIHsgeDogMCwgejogLTI4IH0KICAgICAgICAgICAgXTsKICAgICAgICAgICAgY29uc3QgY3JlYXNlUmFkaXVzID0gMTAuNTsgLy8gU2xpZ2h0bHkgbGFyZ2VyIHRoYW4gcGh5c2ljcyAoMTAuMCkgZm9yIGJ1ZmZlcgoKICAgICAgICAgICAgZ29hbHMuZm9yRWFjaChnb2FsID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGR4ID0gdGFyZ2V0UG9zLnggLSBnb2FsLng7CiAgICAgICAgICAgICAgICBjb25zdCBkeiA9IHRhcmdldFBvcy56IC0gZ29hbC56OwogICAgICAgICAgICAgICAgY29uc3QgZGlzdFNxID0gZHgqZHggKyBkeipkejsKCiAgICAgICAgICAgICAgICBpZiAoZGlzdFNxIDwgY3JlYXNlUmFkaXVzICogY3JlYXNlUmFkaXVzKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gSW5zaWRlIGNyZWFzZSwgcHJvamVjdCB0byBlZGdlCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlzdCA9IE1hdGguc3FydChkaXN0U3EpOwogICAgICAgICAgICAgICAgICAgIGlmIChkaXN0ID4gMC4wMDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmF0aW8gPSBjcmVhc2VSYWRpdXMgLyBkaXN0OwogICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRQb3MueCA9IGdvYWwueCArIGR4ICogcmF0aW87CiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldFBvcy56ID0gZ29hbC56ICsgZHogKiByYXRpbzsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBFeGFjdCBjZW50ZXIsIHB1c2ggb3V0IHRvd2FyZHMgY2VudGVyIGZpZWxkCiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldFBvcy56ID0gZ29hbC56ICsgKGdvYWwueiA+IDAgPyAtY3JlYXNlUmFkaXVzIDogY3JlYXNlUmFkaXVzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gMi4gQXJlbmEgQm91bmRhcnkgQ2xhbXAgKFJhZGl1cyAzMikKICAgICAgICAgICAgY29uc3QgYXJlbmFSYWRpdXMgPSAzMS4wOyAvLyBLZWVwIHNsaWdodGx5IGluc2lkZSB2aXN1YWwvcGh5c2ljcyB3YWxsCiAgICAgICAgICAgIGNvbnN0IGRTcSA9IHRhcmdldFBvcy54KnRhcmdldFBvcy54ICsgdGFyZ2V0UG9zLnoqdGFyZ2V0UG9zLno7CiAgICAgICAgICAgIGlmIChkU3EgPiBhcmVuYVJhZGl1cyphcmVuYVJhZGl1cykgewogICAgICAgICAgICAgICAgY29uc3QgZCA9IE1hdGguc3FydChkU3EpOwogICAgICAgICAgICAgICAgY29uc3QgciA9IGFyZW5hUmFkaXVzIC8gZDsKICAgICAgICAgICAgICAgIHRhcmdldFBvcy54ICo9IHI7CiAgICAgICAgICAgICAgICB0YXJnZXRQb3MueiAqPSByOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBfZmluZEJlc3RQYXNzVGFyZ2V0KCkgewogICAgICAgICAgICBsZXQgYmVzdFRhcmdldCA9IG51bGw7CiAgICAgICAgICAgIGxldCBtYXhTY29yZSA9IC1JbmZpbml0eTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEF0dGFjayBkaXJlY3Rpb24gJiBHb2FsIFoKICAgICAgICAgICAgY29uc3QgYXR0YWNrRGlyID0gKHRoaXMudGVhbS5zaWRlID09PSAxKSA/IC0xIDogMTsgLy8gSG9tZSBhdHRhY2tzIC1aCiAgICAgICAgICAgIGNvbnN0IGdvYWxaID0gKHRoaXMudGVhbS5zaWRlID09PSAxKSA/IC0yOCA6IDI4OwoKICAgICAgICAgICAgZm9yIChjb25zdCBtYXRlIG9mIHRoaXMudGVhbS5wbGF5ZXJzKSB7CiAgICAgICAgICAgICAgICBpZiAobWF0ZSA9PT0gdGhpcykgY29udGludWU7CiAgICAgICAgICAgICAgICBpZiAoIW1hdGUubWVzaCkgY29udGludWU7CiAgICAgICAgICAgICAgICBpZiAobWF0ZS5zdGF0dXMubmFwID4gMCkgY29udGludWU7IC8vIERvbid0IHBhc3MgdG8gc2xlZXBlcnMKICAgICAgICAgICAgICAgIGlmIChtYXRlLnN0dW5UaW1lciA+IDApIGNvbnRpbnVlOyAgLy8gRG9uJ3QgcGFzcyB0byBzdHVubmVkIHBsYXllcnMKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgZGlzdCA9IHRoaXMubWVzaC5wb3NpdGlvbi5kaXN0YW5jZVRvKG1hdGUubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICBpZiAoZGlzdCA8IDQuMCkgY29udGludWU7ICAvLyBUb28gY2xvc2UgKFJlZHVjZWQgZm9yIHRpa2ktdGFrYSkKICAgICAgICAgICAgICAgIGlmIChkaXN0ID4gMzAuMCkgY29udGludWU7IC8vIFRvbyBmYXIgKEluY3JlYXNlZCByYW5nZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gMS4gUmF5Y2FzdCBDaGVjayAoSXMgdGhlIGxhbmUgY2xlYXI/KQogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzUGF0aEJsb2NrZWQobWF0ZS5tZXNoLnBvc2l0aW9uKSkgY29udGludWU7IAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyAyLiBDYWxjdWxhdGUgU3RyYXRlZ2ljIFNjb3JlCiAgICAgICAgICAgICAgICBsZXQgc2NvcmUgPSAwOwoKICAgICAgICAgICAgICAgIC8vIEEuIEZvcndhcmQgUHJvZ3Jlc3MgKFZlcnRpY2FsaXR5KQogICAgICAgICAgICAgICAgY29uc3QgbXlEaXN0VG9Hb2FsID0gTWF0aC5hYnModGhpcy5tZXNoLnBvc2l0aW9uLnogLSBnb2FsWik7CiAgICAgICAgICAgICAgICBjb25zdCBtYXRlRGlzdFRvR29hbCA9IE1hdGguYWJzKG1hdGUubWVzaC5wb3NpdGlvbi56IC0gZ29hbFopOwogICAgICAgICAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBteURpc3RUb0dvYWwgLSBtYXRlRGlzdFRvR29hbDsgLy8gUG9zaXRpdmUgaWYgbW92aW5nIGNsb3NlcgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzY29yZSArPSBwcm9ncmVzcyAqIDEuNTsgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEIuIEdvYWwgUHJveGltaXR5IChBYnNvbHV0ZSkKICAgICAgICAgICAgICAgIGlmIChtYXRlRGlzdFRvR29hbCA8IDE1LjApIHNjb3JlICs9IDEwLjA7CiAgICAgICAgICAgICAgICBpZiAobWF0ZURpc3RUb0dvYWwgPCA4LjApIHNjb3JlICs9IDE1LjA7CgogICAgICAgICAgICAgICAgLy8gQy4gT3Blbm5lc3MgKFNwYWNlIGFyb3VuZCByZWNlaXZlcikKICAgICAgICAgICAgICAgIGNvbnN0IG9wZW5uZXNzID0gdGhpcy5fY2FsY3VsYXRlT3Blbm5lc3MobWF0ZSk7CiAgICAgICAgICAgICAgICBzY29yZSArPSBvcGVubmVzcyAqIDMuMDsgLy8gSGlnaCB3ZWlnaHQgb24gc2FmZXR5CgogICAgICAgICAgICAgICAgLy8gRC4gUm9sZSBCaWFzIChGb3J3YXJkcyBhcmUgcHJpbWUgdGFyZ2V0cykKICAgICAgICAgICAgICAgIGlmIChtYXRlLmlzRm9yd2FyZCkgc2NvcmUgKz0gNS4wOwoKICAgICAgICAgICAgICAgIC8vIEUuIERpc3RhbmNlIFBlbmFsdHkgKExvbmcgcGFzc2VzIGFyZSByaXNreSkKICAgICAgICAgICAgICAgIHNjb3JlIC09IGRpc3QgKiAwLjU7CgogICAgICAgICAgICAgICAgaWYgKHNjb3JlID4gbWF4U2NvcmUpIHsKICAgICAgICAgICAgICAgICAgICBtYXhTY29yZSA9IHNjb3JlOwogICAgICAgICAgICAgICAgICAgIGJlc3RUYXJnZXQgPSBtYXRlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gYmVzdFRhcmdldDsKICAgICAgICB9CgogICAgICAgIF9jYWxjdWxhdGVPcGVubmVzcyhwbGF5ZXIpIHsKICAgICAgICAgICAgbGV0IG1pbkRlZkRpc3QgPSA5OTk7CiAgICAgICAgICAgIGNvbnN0IGdhbWUgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2U7CiAgICAgICAgICAgIGlmICghZ2FtZSkgcmV0dXJuIDA7CiAgICAgICAgICAgIGNvbnN0IG9wcFRlYW0gPSAodGhpcy50ZWFtLmlkID09PSAnaG9tZScpID8gZ2FtZS50ZWFtcy5hd2F5IDogZ2FtZS50ZWFtcy5ob21lOwoKICAgICAgICAgICAgZm9yIChjb25zdCBvcHAgb2Ygb3BwVGVhbS5wbGF5ZXJzKSB7CiAgICAgICAgICAgICAgICBpZiAoIW9wcC5tZXNoIHx8IG9wcC5zdGF0dXMubmFwID4gMCB8fCBvcHAuc3R1blRpbWVyID4gMCkgY29udGludWU7CiAgICAgICAgICAgICAgICBjb25zdCBkID0gcGxheWVyLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyhvcHAubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICBpZiAoZCA8IG1pbkRlZkRpc3QpIG1pbkRlZkRpc3QgPSBkOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBDbGFtcDogQW55dGhpbmcgYmV5b25kIDhtIGlzICJXaWRlIE9wZW4iCiAgICAgICAgICAgIHJldHVybiBNYXRoLm1pbihtaW5EZWZEaXN0LCA4LjApOwogICAgICAgIH0KCiAgICAgICAgX2lzUGF0aEJsb2NrZWQodGFyZ2V0UG9zKSB7CiAgICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy5tZXNoLnBvc2l0aW9uOwogICAgICAgICAgICBjb25zdCBlbmQgPSB0YXJnZXRQb3M7CiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBzdGFydC5kaXN0YW5jZVRvKGVuZCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBQcmVwYXJlIFJheSBEaXJlY3Rpb24KICAgICAgICAgICAgX3NjYW5EaXIuc3ViVmVjdG9ycyhlbmQsIHN0YXJ0KS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGdhbWUgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2U7CiAgICAgICAgICAgIGlmICghZ2FtZSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBjb25zdCBvcHBUZWFtID0gKHRoaXMudGVhbS5pZCA9PT0gJ2hvbWUnKSA/IGdhbWUudGVhbXMuYXdheSA6IGdhbWUudGVhbXMuaG9tZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEludGVyY2VwdGlvbiByYWRpdXMKICAgICAgICAgICAgY29uc3Qgc2FmZXR5UmFkaXVzID0gMi41OyAKCiAgICAgICAgICAgIGZvciAoY29uc3Qgb3BwIG9mIG9wcFRlYW0ucGxheWVycykgewogICAgICAgICAgICAgICAgaWYgKCFvcHAubWVzaCB8fCBvcHAuc3RhdHVzLm5hcCA+IDAgfHwgb3BwLnN0dW5UaW1lciA+IDApIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBWZWN0b3IgZnJvbSBzdGFydCB0byBvcHBvbmVudAogICAgICAgICAgICAgICAgX3NjYW5Ub09wcC5zdWJWZWN0b3JzKG9wcC5tZXNoLnBvc2l0aW9uLCBzdGFydCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFByb2plY3Qgb250byBwYXRoCiAgICAgICAgICAgICAgICBjb25zdCBwcm9qZWN0aW9uID0gX3NjYW5Ub09wcC5kb3QoX3NjYW5EaXIpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiBwcm9qZWN0aW9uIGlzIHdpdGhpbiB0aGUgc2VnbWVudAogICAgICAgICAgICAgICAgaWYgKHByb2plY3Rpb24gPiAwICYmIHByb2plY3Rpb24gPCBkaXN0KSB7CiAgICAgICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHBlcnBlbmRpY3VsYXIgZGlzdGFuY2Ugc3F1YXJlZAogICAgICAgICAgICAgICAgICAgIC8vIGRpc3RTcSA9IHx0b09wcHxeMiAtIHByb2plY3Rpb25eMgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBlcnBEaXN0U3EgPSBfc2NhblRvT3BwLmxlbmd0aFNxKCkgLSAocHJvamVjdGlvbiAqIHByb2plY3Rpb24pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIChwZXJwRGlzdFNxIDwgKHNhZmV0eVJhZGl1cyAqIHNhZmV0eVJhZGl1cykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7IC8vIEJsb2NrZWQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCl9tb3ZlVG8odGFyZ2V0KSB7CiAgICAgICAgICAgIF9haVZlYy5zdWJWZWN0b3JzKHRhcmdldCwgdGhpcy5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgX2FpVmVjLnkgPSAwOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgZGlzdFNxID0gX2FpVmVjLmxlbmd0aFNxKCk7CgogICAgICAgICAgICAvLyBEZWFkem9uZTogSWYgd2l0aGluIDEuMG0gKDEuMCBzcSksIHN0b3AuCiAgICAgICAgICAgIC8vIEluY3JlYXNlZCBmcm9tIDAuMSAoMC4zbSkgdG8gcHJldmVudCBtaWNyby1hZGp1c3RtZW50IHNwaW5uaW5nIGF0IGRlc3RpbmF0aW9uLgogICAgICAgICAgICAvLyBUaGlzIGlzIGNydWNpYWwgd2hlbiB0YXJnZXRzIGFyZSBkeW5hbWljIChlLmcuIHJlbGF0aXZlIHRvIGJhbGwgaG9sZGVyKS4KICAgICAgICAgICAgaWYgKGRpc3RTcSA+IDEuMCkgewogICAgICAgICAgICAgICAgX2FpVmVjLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgdGhpcy5zZXRJbnB1dChfYWlWZWMueCwgX2FpVmVjLnopOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5zZXRJbnB1dCgwLCAwKTsKICAgICAgICAgICAgICAgIC8vIEJyYWtpbmcgZnJpY3Rpb24gdG8gc3RvcCBkcmlmdCBpbW1lZGlhdGVseSB1cG9uIHJlYWNoaW5nIHRhcmdldAogICAgICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS5tdWx0aXBseVNjYWxhcigwLjgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKX2FwcGx5SW50ZXJjZXB0aW9uUHJlc3N1cmUoZHQpIHsKICAgICAgICAgICAgY29uc3QgYmFsbCA9IHRoaXMuYmFsbFJlZjsKICAgICAgICAgICAgaWYgKCFiYWxsIHx8ICFiYWxsLm1lc2gpIHJldHVybjsgLy8gU2FmZXR5IGNoZWNrCgogICAgICAgICAgICAvLyAxLiBCYXNpYyBFbGlnaWJpbGl0eSBDaGVja3MKICAgICAgICAgICAgLy8gTXVzdCBiZSBmcmVlIGFuZCBtb3ZpbmcKICAgICAgICAgICAgaWYgKGJhbGwuc3RhdGUgIT09ICdmcmVlJyB8fCBiYWxsLnZlbG9jaXR5Lmxlbmd0aFNxKCkgPCAxLjApIHJldHVybjsKICAgICAgICAgICAgLy8gQ2Fubm90IGludGVyY2VwdCBpbnZpc2libGUgYmFsbAogICAgICAgICAgICBpZiAoYmFsbC5pc0ludmlzaWJsZSkgcmV0dXJuOwogICAgICAgICAgICAvLyBTa2lwIGlmIHNsZWVwaW5nIG9yIHN0dW5uZWQKICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzLm5hcCA+IDAgfHwgdGhpcy5zdHVuVGltZXIgPiAwKSByZXR1cm47CgogICAgICAgICAgICAvLyAyLiBSYW5nZSBDYWxjdWxhdGlvbiAoVGhlICJGaWVsZCIgUmFkaXVzKQogICAgICAgICAgICBsZXQgcmFuZ2UgPSAyLjA7IC8vIFJlZHVjZWQgZnJvbSAzLjUgdG8gcHJldmVudCAiZm9yY2UgZmllbGQiIGZlZWxpbmcKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFBhc3NpdmUgVGVjaHM6IEJyYXdsZXIgLyBFbGl0ZSBEZWZlbnNlCiAgICAgICAgICAgIGlmICh0aGlzLnRlY2hzLnBhc3NpdmUgPT09ICdicmF3bGVyJyB8fCB0aGlzLnRlY2hzLnBhc3NpdmUgPT09ICdlbGl0ZV9kZWZlbnNlJykgewogICAgICAgICAgICAgICAgcmFuZ2UgKz0gMS41OyAvLyBSZWR1Y2VkIGJvb3N0CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSB0aGlzLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyhiYWxsLm1lc2gucG9zaXRpb24pOwogICAgICAgICAgICBpZiAoZGlzdCA+IHJhbmdlKSByZXR1cm47CgogICAgICAgICAgICAvLyAzLiBEaXJlY3Rpb25hbCBGYWN0b3IgKFRoZSAiQ29uZSIpCiAgICAgICAgICAgIC8vIFZlY3RvciBmcm9tIEJhbGwgdG8gRGVmZW5kZXIKICAgICAgICAgICAgX3NjYW5Ub09wcC5zdWJWZWN0b3JzKHRoaXMubWVzaC5wb3NpdGlvbiwgYmFsbC5tZXNoLnBvc2l0aW9uKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgY29uc3QgYmFsbERpciA9IGJhbGwudmVsb2NpdHkuY2xvbmUoKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgCi8vIERvdCBQcm9kdWN0OiAKICAgICAgICAgICAgLy8gMS4wID0gQmFsbCBoZWFkaW5nIHN0cmFpZ2h0IGZvciBkZWZlbmRlcgogICAgICAgICAgICAvLyAwLjAgPSBQYXNzaW5nIGJ5IHNpZGUgKFBlcnBlbmRpY3VsYXIpCiAgICAgICAgICAgIGNvbnN0IGhlYWRpbmdEb3QgPSBiYWxsRGlyLmRvdChfc2NhblRvT3BwKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIE9ubHkgYXBwbHkgZHJhZyBpZiBiYWxsIGlzIGFwcHJvYWNoaW5nIERJUkVDVExZIChTdHJpY3RlciBjb25lKQogICAgICAgICAgICAvLyBJbmNyZWFzZWQgdGhyZXNob2xkIGZyb20gMC4wIHRvIDAuNyAoTXVzdCBiZSB3aXRoaW4gfjQ1IGRlZ3JlZXMpCiAgICAgICAgICAgIGlmIChoZWFkaW5nRG90IDwgMC43KSByZXR1cm47CiAgICAgICAgICAgIC8vIDQuIENhbGN1bGF0ZSBQcmVzc3VyZSBJbnRlbnNpdHkKICAgICAgICAgICAgLy8gRGlzdGFuY2UgRmFjdG9yOiBDbG9zZXIgPSBTdHJvbmdlciAoTGluZWFyIGZhbGxvZmYpCiAgICAgICAgICAgIGNvbnN0IGRpc3RGYWN0b3IgPSBNYXRoLm1heCgwLCAxLjAgLSAoZGlzdCAvIHJhbmdlKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBBbmdsZSBGYWN0b3I6IERpcmVjdCBoaXQgPSAxLjAsIEdsYW5jaW5nID0gMC40CiAgICAgICAgICAgIGNvbnN0IGFuZ2xlRmFjdG9yID0gTWF0aC5tYXgoMC4zLCBoZWFkaW5nRG90KTsKCiAgICAgICAgICAgIC8vIEJMIFN0YXQKICAgICAgICAgICAgY29uc3QgYmwgPSB0aGlzLmdldFN0YXQoJ0JMJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBUb3RhbCBQcmVzc3VyZSAoUEEvU0ggZHJhaW4gcGVyIHNlY29uZCkKICAgICAgICAgICAgLy8gQmFzZSBtdWx0aXBsaWVyIGZvciBzdGF0cyAoUmVkdWNlZCBmcm9tIDYuMCB0byAzLjApCiAgICAgICAgICAgIGNvbnN0IHByZXNzdXJlTXVsdGlwbGllciA9IDMuMDsgCiAgICAgICAgICAgIGNvbnN0IHByZXNzdXJlID0gYmwgKiBkaXN0RmFjdG9yICogYW5nbGVGYWN0b3IgKiBwcmVzc3VyZU11bHRpcGxpZXIgKiBkdDsKCiAgICAgICAgICAgIC8vIDUuIEFwcGx5IHRvIEJhbGwgU3RhdHMgKFBBL1NIKQogICAgICAgICAgICBpZiAoYmFsbC5wb3dlciA+IDApIHsKICAgICAgICAgICAgICAgIGJhbGwucG93ZXIgLT0gcHJlc3N1cmU7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFZpc3VhbCBGZWVkYmFjayAoQWNjdW11bGF0b3IpCiAgICAgICAgICAgICAgICB0aGlzLl9hY2N1bXVsYXRlZEJsb2NrID0gKHRoaXMuX2FjY3VtdWxhdGVkQmxvY2sgfHwgMCkgKyBwcmVzc3VyZTsKICAgICAgICAgICAgICAgIC8vIFNob3cgZmxvYXRpbmcgdGV4dCBldmVyeSA1IHBvaW50cyBkcmFpbmVkCiAgICAgICAgICAgICAgICBpZiAodGhpcy5fYWNjdW11bGF0ZWRCbG9jayA+PSA1LjApIHsgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsID0gTWF0aC5mbG9vcih0aGlzLl9hY2N1bXVsYXRlZEJsb2NrKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9hY2N1bXVsYXRlZEJsb2NrIC09IHZhbDsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgeyAKICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNwYXduIG9uIGJhbGwsIGF0dGFjaCB0byBiYWxsCiAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKGAtJHt2YWx9YCwgYmFsbC5tZXNoLnBvc2l0aW9uLCAiYmxvY2siLCBiYWxsLm1lc2gpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKLy8gNi4gQXBwbHkgUGh5c2ljYWwgRHJhZyAtIFJFTU9WRUQKICAgICAgICAgICAgLy8gVGhlIGJhbGwgbm93IHBhc3NlcyB0aHJvdWdoIGRlZmVuZGVycyB3aXRob3V0IHNsb3dpbmcgZG93biBwaHlzaWNhbGx5LgogICAgICAgICAgICAvLyBPbmx5IHN0YXRzIChQb3dlcikgYXJlIGRyYWluZWQuCgogICAgICAgICAgICAvLyA3LiBWaXN1YWxzOiBUaGUgIlRldGhlciIgLyBJbnRlcmZlcmVuY2UgRmllbGQKICAgICAgICAgICAgLy8gU3Bhd24gc3BhcmtzIGJldHdlZW4gYmFsbCBhbmQgZGVmZW5kZXIgdG8gc2hvdyB0aGUgZmllbGQgZWZmZWN0CiAgICAgICAgICAgIGlmIChNYXRoLnJhbmRvbSgpIDwgKGRpc3RGYWN0b3IgKiAwLjgpKSB7IAogICAgICAgICAgICAgICAgY29uc3QgbWlkID0gdGhpcy5tZXNoLnBvc2l0aW9uLmNsb25lKCkubGVycChiYWxsLm1lc2gucG9zaXRpb24sIDAuNSArIChNYXRoLnJhbmRvbSgpLTAuNSkqMC4yKTsKICAgICAgICAgICAgICAgIC8vIEppdHRlcgogICAgICAgICAgICAgICAgbWlkLnggKz0gKE1hdGgucmFuZG9tKCktMC41KSAqIDAuNTsKICAgICAgICAgICAgICAgIG1pZC55ICs9IChNYXRoLnJhbmRvbSgpLTAuNSkgKiAwLjU7CiAgICAgICAgICAgICAgICBtaWQueiArPSAoTWF0aC5yYW5kb20oKS0wLjUpICogMC41OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLnNwYXduQ2xhc2gpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2Uuc3Bhd25DbGFzaChtaWQsIDAuNik7IC8vIFNwYXJrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDguIFNob3QgU3RvcCAvIEJsb2NrIExvZ2ljCiAgICAgICAgICAgIGlmIChiYWxsLnBvd2VyIDw9IDAgJiYgYmFsbC5wb3dlclR5cGUgPT09ICdTSCcpIHsKICAgICAgICAgICAgICAgIGJhbGwucG93ZXJUeXBlID0gJ25vbmUnOyAvLyBOZXV0cmFsaXplIHNob3QKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gTk8gREVGTEVDVElPTjogVGhlIGJhbGwgY29udGludWVzIG9uIGl0cyBwYXRoLgogICAgICAgICAgICAgICAgLy8gSXQgaXMgbm93IGEgImRlYWQgYmFsbCIgKG5vIHBvd2VyKSBidXQga2VlcHMgbW92aW5nLgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgeyAKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJCTE9DS0VEIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAiY29taWMtaW1wYWN0Iik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBObyBpbXBhY3QgZnJlZXplIHRvIGtlZXAgZmxvdyBzbW9vdGgKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gOS4gU3RhdHVzIFJpc2sgKFZlbm9tL05hcC9XaXRoZXIgb24gQmFsbCkKICAgICAgICAgICAgaWYgKGJhbGwudGVjaG5pcXVlICYmICF0aGlzLl90ZWNoQXBwbGllZCkgewogICAgICAgICAgICAgICAgdGhpcy5fdGVjaEFwcGxpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgY29uc3QgdGVjaCA9IGJhbGwudGVjaG5pcXVlOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAodGVjaC50eXBlID09PSAndmVub20nKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBseVN0YXR1cygndmVub20nLCAxNS4wKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGVjaC50eXBlID09PSAnbmFwJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwbHlTdGF0dXMoJ25hcCcsIDguMCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRlY2gudHlwZSA9PT0gJ3dpdGhlcicpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGx5U3RhdHVzKCd3aXRoZXInLCAxNS4wLCAnQkwnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7IHRoaXMuX3RlY2hBcHBsaWVkID0gZmFsc2U7IH0sIDIwMDApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHdpbmRvdy5mbHV4LkFJUGxheWVyID0gQUlQbGF5ZXI7Cn0pKCk7","./AIPlayer.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCi8vIFJldXNhYmxlIHZlY3RvcnMKICAgIGNvbnN0IF9haVZlYyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfdGFyZ2V0UG9zID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgIGNvbnN0IF9zY2FuRGlyID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgIGNvbnN0IF9zY2FuVG9PcHAgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwoKY2xhc3MgQUlQbGF5ZXIgZXh0ZW5kcyB3aW5kb3cuZmx1eC5QbGF5ZXIgewogICAgICAgIGNvbnN0cnVjdG9yKHNjZW5lLCByb2xlKSB7CiAgICAgICAgICAgIHN1cGVyKHNjZW5lLCByb2xlKTsKICAgICAgICAgICAgdGhpcy5iYWxsUmVmID0gbnVsbDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFN0YXRzIGFyZSBtYW5hZ2VkIGJ5IFRlYW0vTWFpbiBvciBkZWZhdWx0IFBsYXllciB2YWx1ZXMuCiAgICAgICAgICAgIC8vIE5vIGNvbnN0cnVjdG9yIG92ZXJyaWRlcyB0byBlbnN1cmUgZmFpciBzY2FsaW5nIGFuZCBkZW1vIGNvbnNpc3RlbmN5LgogICAgICAgICAgICB0aGlzLl91cGRhdGVEZXJpdmVkU3RhdHMoKTsKCiAgICAgICAgICAgIC8vIFN0YXRlIE1hY2hpbmUKICAgICAgICAgICAgdGhpcy5haVN0YXRlID0gJ0lETEUnOwogICAgICAgICAgICB0aGlzLmRlY2lzaW9uVGltZXIgPSAwOwogICAgICAgICAgICB0aGlzLmRlY2lzaW9uSW50ZXJ2YWwgPSAwLjE7IC8vIElNUFJPVkVEOiBGYXN0ZXIgZGVjaXNpb25zICh3YXMgMC4yKQoKICAgICAgICAgICAgLy8gLS0tIFBFUkNFUFRJT04gU1lTVEVNIChSZWFjdGlvbiBUaW1lKSAtLS0KICAgICAgICAgICAgLy8gVGhlIEFJIHRyYWNrcyBhICJnaG9zdCIgdGFyZ2V0IHRoYXQgbGFncyBiZWhpbmQgcmVhbGl0eS4KICAgICAgICAgICAgLy8gVGhpcyBhbGxvd3MgaHVtYW4gcGxheWVycyB0byBqdWtlL2Zha2Ugb3V0IHRoZSBBSS4KICAgICAgICAgICAgdGhpcy5wZXJjZWl2ZWRUYXJnZXRQb3MgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgICAgICAgICB0aGlzLnJlYWN0aW9uU3BlZWQgPSA4LjA7IC8vIElNUFJPVkVEOiBGYXN0ZXIgcmVhY3Rpb24gKHdhcyA1LjApCgogICAgICAgICAgICAvLyBJTVBST1ZFRDogQmV0dGVyIGFudGljaXBhdGlvbgogICAgICAgICAgICB0aGlzLmFudGljaXBhdGlvblRpbWUgPSAwLjQ7IC8vIExlYWQgdGFyZ2V0IGJ5IHRoaXMgbWFueSBzZWNvbmRzCiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBSb2xlIENvbmZpZwogICAgICAgICAgICB0aGlzLmlzRm9yd2FyZCA9IFsnTEYnLCAnUkYnXS5pbmNsdWRlcyhyb2xlKTsKICAgICAgICAgICAgdGhpcy5pc01pZGZpZWxkZXIgPSByb2xlID09PSAnTUYnOwogICAgICAgICAgICB0aGlzLmlzRGVmZW5kZXIgPSBbJ0xEJywgJ1JEJ10uaW5jbHVkZXMocm9sZSk7CgogICAgICAgICAgICAvLyBBc3NpZ24gZGVmYXVsdCB0ZWNobmlxdWVzIHNvIEFJIGlzIGEgdGhyZWF0CiAgICAgICAgICAgIHRoaXMuX2Fzc2lnbkRlZmF1bHRUZWNocygpOwogICAgICAgIH0KCiAgICAgICAgX2Fzc2lnbkRlZmF1bHRUZWNocygpIHsKICAgICAgICAgICAgLy8gUmFuZG9tbHkgYXNzaWduIHRlY2hzIGJhc2VkIG9uIHJvbGUKY29uc3QgdGFja2xlVGVjaHMgPSBbJ3Zlbm9tJywgJ3dpdGhlcicsICdkcmFpbiddOwogICAgICAgICAgICBjb25zdCBzaG9vdFRlY2hzID0gWyd2ZW5vbScsICdzcGhlcmUnLCAnaW52aXNpYmxlJ107CiAgICAgICAgICAgIGNvbnN0IHBhc3NUZWNocyA9IFsndmVub20nLCAnd2l0aGVyJywgJ25hcCddOwogICAgICAgICAgICBjb25zdCBwYXNzaXZlVGVjaHMgPSBbJ2JyYXdsZXInLCAnZWxpdGVfZGVmZW5zZSddOwoKICAgICAgICAgICAgLy8gSGVscGVyIHRvIHBpY2sgcmFuZG9tCiAgICAgICAgICAgIGNvbnN0IHBpY2sgPSAoYXJyKSA9PiBhcnJbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogYXJyLmxlbmd0aCldOwogICAgICAgICAgICBjb25zdCBjaGFuY2UgPSAocHJvYikgPT4gTWF0aC5yYW5kb20oKSA8IHByb2I7CgppZiAodGhpcy5pc0RlZmVuZGVyKSB7CiAgICAgICAgICAgICAgICAvLyBEZWZlbmRlcnMgbG92ZSBzdGF0dXMgdGFja2xlcyBhbmQgcGFzc2l2ZXMKICAgICAgICAgICAgICAgIGlmIChjaGFuY2UoMC44KSkgdGhpcy50ZWNocy50YWNrbGUgPSBwaWNrKHRhY2tsZVRlY2hzKTsKICAgICAgICAgICAgICAgIGlmIChjaGFuY2UoMC4zKSkgdGhpcy50ZWNocy5wYXNzID0gcGljayhwYXNzVGVjaHMpOwogICAgICAgICAgICAgICAgaWYgKGNoYW5jZSgwLjUpKSB0aGlzLnRlY2hzLnBhc3NpdmUgPSBwaWNrKHBhc3NpdmVUZWNocyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5pc01pZGZpZWxkZXIpIHsKICAgICAgICAgICAgICAgIC8vIE1pZGZpZWxkZXJzIGFyZSBiYWxhbmNlZAogICAgICAgICAgICAgICAgaWYgKGNoYW5jZSgwLjYpKSB0aGlzLnRlY2hzLnRhY2tsZSA9IHBpY2sodGFja2xlVGVjaHMpOwogICAgICAgICAgICAgICAgaWYgKGNoYW5jZSgwLjYpKSB0aGlzLnRlY2hzLnBhc3MgPSBwaWNrKHBhc3NUZWNocyk7CiAgICAgICAgICAgICAgICBpZiAoY2hhbmNlKDAuMykpIHRoaXMudGVjaHMuc2hvb3QgPSBwaWNrKHNob290VGVjaHMpOwogICAgICAgICAgICAgICAgaWYgKGNoYW5jZSgwLjMpKSB0aGlzLnRlY2hzLnBhc3NpdmUgPSBwaWNrKHBhc3NpdmVUZWNocyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5pc0ZvcndhcmQpIHsKICAgICAgICAgICAgICAgIC8vIEZvcndhcmRzIGZvY3VzIG9uIHNob290aW5nCiAgICAgICAgICAgICAgICBpZiAoY2hhbmNlKDAuOSkpIHRoaXMudGVjaHMuc2hvb3QgPSBwaWNrKHNob290VGVjaHMpOwogICAgICAgICAgICAgICAgaWYgKGNoYW5jZSgwLjQpKSB0aGlzLnRlY2hzLnRhY2tsZSA9IHBpY2sodGFja2xlVGVjaHMpOyAvLyBGcm9udGxpbmUgcHJlc3N1cmUKICAgICAgICAgICAgICAgIGlmIChjaGFuY2UoMC4yKSkgdGhpcy50ZWNocy5wYXNzaXZlID0gcGljayhwYXNzaXZlVGVjaHMpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKdXBkYXRlKGR0KSB7CiAgICAgICAgICAgIC8vIFNhZmV0eTogQXV0by1saW5rIGJhbGwgaWYgbWlzc2luZyAoU2VsZi1oZWFsaW5nKQogICAgICAgICAgICBpZiAoIXRoaXMuYmFsbFJlZiAmJiB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UgJiYgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmVudGl0aWVzKSB7CiAgICAgICAgICAgICAgICB0aGlzLmJhbGxSZWYgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZW50aXRpZXMuYmFsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMC4gQ2hlY2sgaWYgQUkgbG9naWMgc2hvdWxkIHJ1bgogICAgICAgICAgICBjb25zdCBnYW1lID0gd2luZG93LmZsdXguZ2FtZUluc3RhbmNlOwogICAgICAgICAgICBjb25zdCBpc0RlbW8gPSBnYW1lICYmIGdhbWUuaXNEZW1vTW9kZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENoZWNrIGluY2FwYWNpdGF0aW9uIChTdHVuIG9yIE5hcCkKICAgICAgICAgICAgY29uc3QgaXNJbmNhcGFjaXRhdGVkID0gKHRoaXMuc3R1blRpbWVyID4gMCkgfHwgKHRoaXMuc3RhdHVzLm5hcCA+IDApOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQUkgcnVucyBpZjoKICAgICAgICAgICAgLy8gMS4gSXQncyBhbiBBSSB0ZWFtIChub3QgaHVtYW4pCiAgICAgICAgICAgIC8vIDIuIEl0J3MgYSBIdW1hbiB0ZWFtIEJVVCBEZW1vIE1vZGUgaXMgT04KICAgICAgICAgICAgLy8gMy4gSXQncyBhIEh1bWFuIHRlYW0sIERlbW8gaXMgT0ZGLCBidXQgdGhpcyBwbGF5ZXIgaXMgTk9UIHRoZSBhY3RpdmUgY29udHJvbGxlZCBwbGF5ZXIKICAgICAgICAgICAgY29uc3QgaXNIdW1hblRlYW0gPSB0aGlzLnRlYW0gJiYgdGhpcy50ZWFtLmlzSHVtYW47CiAgICAgICAgICAgIGNvbnN0IGlzQWN0aXZlUGxheWVyID0gdGhpcy50ZWFtICYmICh0aGlzLnRlYW0uYWN0aXZlUGxheWVyID09PSB0aGlzKTsKICAgICAgICAgICAgY29uc3Qgc2hvdWxkUnVuQUkgPSAoIWlzSHVtYW5UZWFtIHx8IGlzRGVtbyB8fCAoaXNIdW1hblRlYW0gJiYgIWlzQWN0aXZlUGxheWVyKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBNYXN0ZXIgQUkgU3dpdGNoIGZvciB0aGUgdGVhbQogICAgICAgICAgICBjb25zdCBpc1RlYW1BSUVuYWJsZWQgPSB0aGlzLnRlYW0gPyB0aGlzLnRlYW0uYWlFbmFibGVkIDogdHJ1ZTsKCiAgICAgICAgICAgIGlmIChpc0luY2FwYWNpdGF0ZWQpIHsKICAgICAgICAgICAgICAgIC8vIElmIHN0dW5uZWQvc2xlZXBpbmcsIGRvIG5vdGhpbmcuCiAgICAgICAgICAgICAgICB0aGlzLnNldElucHV0KDAsIDApOwogICAgICAgICAgICB9IGVsc2UgaWYgKHNob3VsZFJ1bkFJICYmIGlzVGVhbUFJRW5hYmxlZCkgewogICAgICAgICAgICAgICAgLy8gLS0tIElNUFJPVkVEIFBFUkNFUFRJT04gVVBEQVRFIC0tLQogICAgICAgICAgICAgICAgLy8gVXBkYXRlIHBlcmNlaXZlZCBwb3NpdGlvbiB0b3dhcmRzIHJlYWwgdGFyZ2V0IChCYWxsIG9yIEJhbGwgSG9sZGVyKQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYmFsbFJlZiAmJiB0aGlzLmJhbGxSZWYubWVzaCkgewogICAgICAgICAgICAgICAgICAgIGxldCByZWFsVGFyZ2V0ID0gdGhpcy5iYWxsUmVmLm1lc2gucG9zaXRpb24uY2xvbmUoKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgYmFsbCBpcyBoZWxkLCB0cmFjayB0aGUgaG9sZGVyIHdpdGggYW50aWNpcGF0aW9uCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYmFsbFJlZi5ob2xkZXIgJiYgdGhpcy5iYWxsUmVmLmhvbGRlci5tZXNoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWxUYXJnZXQgPSB0aGlzLmJhbGxSZWYuaG9sZGVyLm1lc2gucG9zaXRpb24uY2xvbmUoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElNUFJPVkVEOiBMZWFkIHRoZSB0YXJnZXQgYmFzZWQgb24gdGhlaXIgdmVsb2NpdHkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYmFsbFJlZi5ob2xkZXIudmVsb2NpdHkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWxUYXJnZXQuYWRkU2NhbGVkVmVjdG9yKHRoaXMuYmFsbFJlZi5ob2xkZXIudmVsb2NpdHksIHRoaXMuYW50aWNpcGF0aW9uVGltZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYmFsbFJlZi52ZWxvY2l0eSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBGb3IgbG9vc2UgYmFsbCwgYW50aWNpcGF0ZSBiYXNlZCBvbiBiYWxsIHZlbG9jaXR5CiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWxUYXJnZXQuYWRkU2NhbGVkVmVjdG9yKHRoaXMuYmFsbFJlZi52ZWxvY2l0eSwgdGhpcy5hbnRpY2lwYXRpb25UaW1lICogMC41KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIExlcnAgcGVyY2VwdGlvbiB0b3dhcmRzIGFudGljaXBhdGVkIHJlYWxpdHkKICAgICAgICAgICAgICAgICAgICBjb25zdCBhbHBoYSA9IE1hdGgubWluKDEuMCwgZHQgKiB0aGlzLnJlYWN0aW9uU3BlZWQpOwogICAgICAgICAgICAgICAgICAgIHRoaXMucGVyY2VpdmVkVGFyZ2V0UG9zLmxlcnAocmVhbFRhcmdldCwgYWxwaGEpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIDEuIERlY2lzaW9uIE1ha2luZwogICAgICAgICAgICAgICAgdGhpcy5kZWNpc2lvblRpbWVyICs9IGR0OwogICAgICAgICAgICAgICAgaWYgKHRoaXMuZGVjaXNpb25UaW1lciA+IHRoaXMuZGVjaXNpb25JbnRlcnZhbCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuZGVjaXNpb25UaW1lciA9IDA7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZXZhbHVhdGVTdGF0ZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIDIuIEV4ZWN1dGUgU3RhdGUgKFNldHMgaW5wdXRWZWN0b3IpCiAgICAgICAgICAgICAgICB0aGlzLl9leGVjdXRlU3RhdGUoZHQpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyAzLiBJbnRlcmNlcHRpb24gTG9naWMKICAgICAgICAgICAgICAgIHRoaXMuX2FwcGx5SW50ZXJjZXB0aW9uUHJlc3N1cmUoZHQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gSGVyZSBpZjoKICAgICAgICAgICAgICAgIC8vIDEuIENvbnRyb2xsZWQgYnkgSHVtYW4gKHNob3VsZFJ1bkFJID09IGZhbHNlKQogICAgICAgICAgICAgICAgLy8gMi4gQUkgTG9naWMgaXMgRGlzYWJsZWQgKGlzVGVhbUFJRW5hYmxlZCA9PSBmYWxzZSkKCiAgICAgICAgICAgICAgICAvLyBJZiBBSSBpcyBkaXNhYmxlZCwgd2UgbXVzdCBzdG9wIHRoZSBib3QgVU5MRVNTIGl0IGlzIGJlaW5nIGRyaXZlbiBieSBodW1hbiBpbnB1dC4KICAgICAgICAgICAgICAgIC8vIEh1bWFuIGlucHV0IGRyaXZlcyB0aGUgcGxheWVyIGlmOiBpc0h1bWFuVGVhbSBBTkQgaXNBY3RpdmVQbGF5ZXIgQU5EICFpc0RlbW8KICAgICAgICAgICAgICAgIGNvbnN0IGlzRHJpdmVuQnlIdW1hbiA9IGlzSHVtYW5UZWFtICYmIGlzQWN0aXZlUGxheWVyICYmICFpc0RlbW87CgogICAgICAgICAgICAgICAgaWYgKCFpc1RlYW1BSUVuYWJsZWQgJiYgIWlzRHJpdmVuQnlIdW1hbikgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0SW5wdXQoMCwgMCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gV2Ugc3RpbGwgYXBwbHkgcGFzc2l2ZSBpbnRlcmNlcHRpb24gaWYgaW4gdGhlIHdheS4KICAgICAgICAgICAgICAgIHRoaXMuX2FwcGx5SW50ZXJjZXB0aW9uUHJlc3N1cmUoZHQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyA0LiBCYXNlIFVwZGF0ZQogICAgICAgICAgICBzdXBlci51cGRhdGUoZHQpOwogICAgICAgIH0KCl9ldmFsdWF0ZVN0YXRlKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuYmFsbFJlZikgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBiYWxsID0gdGhpcy5iYWxsUmVmOwoKICAgICAgICAgICAgLy8gMS4gSSBoYXZlIHRoZSBiYWxsCiAgICAgICAgICAgIGlmICh0aGlzLmhhc0JhbGwpIHsKICAgICAgICAgICAgICAgIHRoaXMuYWlTdGF0ZSA9ICdBVFRBQ0tfQ0FSUlknOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAyLiBMb29zZSBCYWxsIExvZ2ljIChBbnRpLUZsb2NraW5nKQogICAgICAgICAgICBpZiAoIWJhbGwuaG9sZGVyKSB7CiAgICAgICAgICAgICAgICAvLyBEZWZhdWx0OiBSZXR1cm4gdG8gZm9ybWF0aW9uLiBPbmx5IGNoYXNlIGlmIHdlIGFyZSB0aGUgYmVzdCBjYW5kaWRhdGUuCiAgICAgICAgICAgICAgICB0aGlzLmFpU3RhdGUgPSAnUkVUVVJOX0hPTUUnOwoKLy8gSHlzdGVyZXNpczogSWYgSSB3YXMgYWxyZWFkeSBjaGFzaW5nLCBJJ20gZWZmZWN0aXZlbHkgImNsb3NlciIgdG8gcHJldmVudCBqaXR0ZXJ5IHN3aXRjaGluZwogICAgICAgICAgICAgICAgLy8gVGhpcyBwcmV2ZW50cyB0d28gcGxheWVycyBmcm9tIHN3YXBwaW5nIHJvbGVzIHJhcGlkbHkgd2hlbiBlcXVpZGlzdGFudC4KICAgICAgICAgICAgICAgIGNvbnN0IGJpYXMgPSAodGhpcy5haVN0YXRlID09PSAnQ0hBU0UnKSA/IDAuOCA6IDEuMDsKICAgICAgICAgICAgICAgIGNvbnN0IG15RGlzdCA9IHRoaXMubWVzaC5wb3NpdGlvbi5kaXN0YW5jZVRvKGJhbGwubWVzaC5wb3NpdGlvbikgKiBiaWFzOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsZXQgaXNDbG9zZXN0ID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICBpZiAodGhpcy50ZWFtICYmIHRoaXMudGVhbS5wbGF5ZXJzKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBwIG9mIHRoaXMudGVhbS5wbGF5ZXJzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwID09PSB0aGlzKSBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFwLm1lc2gpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWdub3JlIEdvYWxpZSAoR29hbGllIGhhbmRsZXMgdGhlaXIgb3duIGFyZWE7IGZpZWxkIHBsYXllcnMgc2hvdWxkbid0IHJlbHkgb24gdGhlbSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHAucm9sZSA9PT0gJ0dMJykgY29udGludWU7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmUgaW5jYXBhY2l0YXRlZCB0ZWFtbWF0ZXMKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHAuc3RhdHVzICYmIHAuc3RhdHVzLm5hcCA+IDApIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHRlYW1tYXRlIGRpc3RhbmNlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vdGU6IFdlIGRvbid0IGFwcGx5IGJpYXMgdG8gb3RoZXJzLCBlZmZlY3RpdmVseSBtYWtpbmcgIm1lIiBzdGlja2llciBpZiBJJ20gYWxyZWFkeSBjaGFzaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBEaXN0ID0gcC5tZXNoLnBvc2l0aW9uLmRpc3RhbmNlVG8oYmFsbC5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIGEgdGVhbW1hdGUgaXMgY2xvc2VyLCB5aWVsZCB0byB0aGVtCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwRGlzdCA8IG15RGlzdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNDbG9zZXN0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KfQoKICAgICAgICAgICAgICAgIGlmIChpc0Nsb3Nlc3QpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFpU3RhdGUgPSAnQ0hBU0UnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAzLiBUZWFtbWF0ZSBoYXMgYmFsbAogICAgICAgICAgICBpZiAoYmFsbC5ob2xkZXIudGVhbSA9PT0gdGhpcy50ZWFtKSB7CiAgICAgICAgICAgICAgICB0aGlzLmFpU3RhdGUgPSAnU1VQUE9SVCc7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDQuIE9wcG9uZW50IGhhcyBiYWxsCiAgICAgICAgICAgIGlmIChiYWxsLmhvbGRlci50ZWFtICE9PSB0aGlzLnRlYW0pIHsKICAgICAgICAgICAgICAgIHRoaXMuYWlTdGF0ZSA9ICdERUZFTkQnOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBfZXhlY3V0ZVN0YXRlKGR0KSB7CiAgICAgICAgICAgIGlmICghdGhpcy5iYWxsUmVmKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNldElucHV0KDAsIDApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzd2l0Y2ggKHRoaXMuYWlTdGF0ZSkgewogICAgICAgICAgICAgICAgY2FzZSAnQVRUQUNLX0NBUlJZJzogdGhpcy5fc3RhdGVBdHRhY2tDYXJyeShkdCk7IGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnU1VQUE9SVCc6IHRoaXMuX3N0YXRlU3VwcG9ydChkdCk7IGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnREVGRU5EJzogdGhpcy5fc3RhdGVEZWZlbmQoZHQpOyBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0NIQVNFJzogdGhpcy5fc3RhdGVDaGFzZShkdCk7IGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnUkVUVVJOX0hPTUUnOiAKICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHRoaXMuX3N0YXRlUmV0dXJuSG9tZShkdCk7IGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0gU1RBVEVTIC0tLQoKX3N0YXRlQXR0YWNrQ2FycnkoZHQpIHsKICAgICAgICAgICAgLy8gRHJpdmUgdG8gZ29hbAogICAgICAgICAgICAvLyBIb21lIChTaWRlIDEpIGF0dGFja3MgLVouIEF3YXkgKFNpZGUgLTEpIGF0dGFja3MgK1ouCiAgICAgICAgICAgIGNvbnN0IGF0dGFja0RpciA9ICh0aGlzLnRlYW0uc2lkZSA9PT0gMSkgPyAtMSA6IDE7CiAgICAgICAgICAgIGNvbnN0IGdvYWxaID0gMjggKiBhdHRhY2tEaXI7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBUYXJnZXQ6IEdvYWwgKGJ1dCByZXNwZWN0IGNyZWFzZSkKICAgICAgICAgICAgX3RhcmdldFBvcy5zZXQoMCwgMCwgZ29hbFopOwogICAgICAgICAgICB0aGlzLl9hdm9pZEdvYWxDcmVhc2UoX3RhcmdldFBvcyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBNb3ZlCiAgICAgICAgICAgIHRoaXMuX21vdmVUbyhfdGFyZ2V0UG9zKTsKCiAgICAgICAgICAgIC8vIERlY2lzaW9uOiBTaG9vdCBvciBQYXNzPwogICAgICAgICAgICBjb25zdCBkaXN0VG9Hb2FsID0gTWF0aC5hYnModGhpcy5tZXNoLnBvc2l0aW9uLnogLSBnb2FsWik7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAxLiBTaG9vdCBpZiBjbG9zZSBhbmQgY2xlYXIKICAgICAgICAgICAgaWYgKGRpc3RUb0dvYWwgPCAyMC4wICYmICF0aGlzLmlzVGhyb3dpbmcpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3NtYXJ0VGhyb3codGhpcy5iYWxsUmVmLCAnU0gnKTsgCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIDIuIFBhc3MgTG9naWMKICAgICAgICAgICAgLy8gQ2hlY2sgcGFzcyBpZjogU3Vycm91bmRlZCwgTG93IEVOLCBvciBQbGF5bWFrZXIgKE1pZGZpZWxkZXIpIHNlZXMgb3Bwb3J0dW5pdHkKICAgICAgICAgICAgY29uc3QgaXNTdXJyb3VuZGVkID0gdGhpcy5faXNTdXJyb3VuZGVkKCk7CiAgICAgICAgICAgIGNvbnN0IGxvd0VOID0gdGhpcy5jdXJyZW50RU4gPCAxMDsKICAgICAgICAgICAgY29uc3QgaXNQbGF5bWFrZXIgPSB0aGlzLmlzTWlkZmllbGRlcjsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICgoaXNTdXJyb3VuZGVkIHx8IGxvd0VOIHx8IGlzUGxheW1ha2VyKSAmJiAhdGhpcy5pc1Rocm93aW5nKSB7CiAgICAgICAgICAgICAgICBjb25zdCBiZXN0TWF0ZSA9IHRoaXMuX2ZpbmRCZXN0UGFzc1RhcmdldCgpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoYmVzdE1hdGUpIHsKICAgICAgICAgICAgICAgICAgICAvLyBFdmFsdWF0ZSBpZiBwYXNzIGlzIHdvcnRoIGl0CiAgICAgICAgICAgICAgICAgICAgLy8gSWYgUGxheW1ha2VyLCBwYXNzIGlmIG1hdGUgaXMgY2xvc2VyIHRvIGdvYWwKICAgICAgICAgICAgICAgICAgICAvLyBJZiBQYW5pYyAoU3Vycm91bmRlZC9Mb3dFTiksIHBhc3MgdG8gYW55b25lIG9wZW4KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsZXQgc2hvdWxkUGFzcyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIChpc1N1cnJvdW5kZWQgfHwgbG93RU4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2hvdWxkUGFzcyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc1BsYXltYWtlcikgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBteURpc3QgPSBNYXRoLmFicyh0aGlzLm1lc2gucG9zaXRpb24ueiAtIGdvYWxaKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbWF0ZURpc3QgPSBNYXRoLmFicyhiZXN0TWF0ZS5tZXNoLnBvc2l0aW9uLnogLSBnb2FsWik7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXRlRGlzdCA8IG15RGlzdCAtIDUuMCkgc2hvdWxkUGFzcyA9IHRydWU7IC8vIE1hdGUgaXMgNW0gY2xvc2VyCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIChzaG91bGRQYXNzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZhY2UgdGFyZ2V0CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5sb29rQXQoYmVzdE1hdGUubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEV4ZWN1dGUgUGFzcwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zbWFydFRocm93KHRoaXMuYmFsbFJlZiwgJ1BBJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIDMuIFBhbmljIENsZWFyIChJZiBzdXJyb3VuZGVkIGFuZCBubyBwYXNzKQogICAgICAgICAgICBpZiAoaXNTdXJyb3VuZGVkICYmICF0aGlzLmlzVGhyb3dpbmcpIHsKICAgICAgICAgICAgICAgIC8vIEp1c3Qgc2hvb3QvY2xlYXIKICAgICAgICAgICAgICAgIHRoaXMuX3NtYXJ0VGhyb3codGhpcy5iYWxsUmVmLCAnU0gnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX2lzU3Vycm91bmRlZCgpIHsKICAgICAgICAgICAgLy8gU2ltcGxlIGNoZWNrOiBjb3VudCBlbmVtaWVzIG5lYXJieQogICAgICAgICAgICBsZXQgY291bnQgPSAwOwogICAgICAgICAgICBjb25zdCBnYW1lID0gd2luZG93LmZsdXguZ2FtZUluc3RhbmNlOwogICAgICAgICAgICBpZiAoIWdhbWUpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgY29uc3Qgb3BwVGVhbSA9ICh0aGlzLnRlYW0uaWQgPT09ICdob21lJykgPyBnYW1lLnRlYW1zLmF3YXkgOiBnYW1lLnRlYW1zLmhvbWU7CiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IobGV0IHAgb2Ygb3BwVGVhbS5wbGF5ZXJzKSB7CiAgICAgICAgICAgICAgICBpZiAocC5tZXNoICYmIHAubWVzaC5wb3NpdGlvbi5kaXN0YW5jZVRvKHRoaXMubWVzaC5wb3NpdGlvbikgPCA0LjApIHsKICAgICAgICAgICAgICAgICAgICBjb3VudCsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBjb3VudCA+PSAyOwogICAgICAgIH0KCiAgICAgICAgX3NtYXJ0VGhyb3coYmFsbCwgZm9yY2VkVHlwZSA9IG51bGwpIHsKICAgICAgICAgICAgLy8gV3JhcHBlciBhcm91bmQgdGhyb3dCYWxsIHRvIG1hbmFnZSBIUCBhbmQgVGVjaHMKICAgICAgICAgICAgLy8gMS4gRGV0ZXJtaW5lIGludGVuZGVkIGFjdGlvbiB0eXBlCiAgICAgICAgICAgIGxldCB0eXBlID0gZm9yY2VkVHlwZTsKICAgICAgICAgICAgaWYgKCF0eXBlKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkaXIgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAxKS5hcHBseVF1YXRlcm5pb24odGhpcy5tZXNoLnF1YXRlcm5pb24pOwogICAgICAgICAgICAgICAgY29uc3QgYXR0YWNrRGlyID0gKHRoaXMudGVhbSAmJiB0aGlzLnRlYW0uc2lkZSA9PT0gMSkgPyAtMSA6IDE7CiAgICAgICAgICAgICAgICBjb25zdCBpc0FpbWluZ0dvYWwgPSAoZGlyLnogKiBhdHRhY2tEaXIgPiAwLjUpOwogICAgICAgICAgICAgICAgdHlwZSA9IGlzQWltaW5nR29hbCA/ICdTSCcgOiAnUEEnOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAyLiBHZXQgVGVjaAogICAgICAgICAgICBjb25zdCB0ZWNoTmFtZSA9ICh0eXBlID09PSAnU0gnKSA/IHRoaXMudGVjaHMuc2hvb3QgOiB0aGlzLnRlY2hzLnBhc3M7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAzLiBFc3RpbWF0ZSBDb3N0CiAgICAgICAgICAgIGxldCBiYXNlQ29zdCA9ICh0eXBlID09PSAnU0gnKSA/IDIwIDogMTA7CiAgICAgICAgICAgIGxldCB0ZWNoQ29zdCA9IDA7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAodGVjaE5hbWUpIHsKICAgICAgICAgICAgICAgIC8vIFJvdWdoIGVzdGltYXRlcyBiYXNlZCBvbiBQbGF5ZXIuanMKICAgICAgICAgICAgICAgIGlmICh0ZWNoTmFtZS5pbmNsdWRlcygnbmFwJykpIHRlY2hDb3N0ID0gMzA7CiAgICAgICAgICAgICAgICBlbHNlIGlmICh0ZWNoTmFtZS5pbmNsdWRlcygnc3BoZXJlJykgfHwgdGVjaE5hbWUuaW5jbHVkZXMoJ2ludmlzaWJsZScpKSB0ZWNoQ29zdCA9IDI1OwogICAgICAgICAgICAgICAgZWxzZSB0ZWNoQ29zdCA9IDIwOyAvLyBWZW5vbS9XaXRoZXIKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgdG90YWxDb3N0ID0gYmFzZUNvc3QgKyB0ZWNoQ29zdDsKCiAgICAgICAgICAgIC8vIDQuIERlY2lzaW9uCiAgICAgICAgICAgIC8vIElmIHdlIGhhdmUgYSB0ZWNoIGJ1dCBub3QgZW5vdWdoIEhQIGZvciBpdCwgQlVUIGVub3VnaCBIUCBmb3Igbm9ybWFsLi4uCiAgICAgICAgICAgIC8vIERpc2FibGUgdGVjaCB0ZW1wb3JhcmlseSB0byBhdm9pZCAiVGlyZWQiIHBlbmFsdHkgKDAuNXggc3RhdHMpCiAgICAgICAgICAgIGxldCB0ZW1wVGVjaCA9IG51bGw7CiAgICAgICAgICAgIGlmICh0ZWNoTmFtZSAmJiB0aGlzLnN0YXRzLkhQIDwgdG90YWxDb3N0ICYmIHRoaXMuc3RhdHMuSFAgPj0gYmFzZUNvc3QpIHsKICAgICAgICAgICAgICAgIC8vIFVuZXF1aXAKICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAnU0gnKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcFRlY2ggPSB0aGlzLnRlY2hzLnNob290OwogICAgICAgICAgICAgICAgICAgIHRoaXMudGVjaHMuc2hvb3QgPSBudWxsOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0ZW1wVGVjaCA9IHRoaXMudGVjaHMucGFzczsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRlY2hzLnBhc3MgPSBudWxsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBFeGVjdXRlCiAgICAgICAgICAgIHRoaXMudGhyb3dCYWxsKGJhbGwsIHR5cGUpOwoKICAgICAgICAgICAgLy8gUmVzdG9yZQogICAgICAgICAgICBpZiAodGVtcFRlY2gpIHsKICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAnU0gnKSB0aGlzLnRlY2hzLnNob290ID0gdGVtcFRlY2g7CiAgICAgICAgICAgICAgICBlbHNlIHRoaXMudGVjaHMucGFzcyA9IHRlbXBUZWNoOwogICAgICAgICAgICB9CiAgICAgICAgfQoKX3N0YXRlQ2hhc2UoZHQpIHsKICAgICAgICAgICAgLy8gSW50ZXJjZXB0aW9uOiBDaGFzZSB0aGUgUEVSQ0VJVkVEIHBvc2l0aW9uLCBub3QgdGhlIHJlYWwgb25lLgogICAgICAgICAgICAvLyBUaGlzIGFsbG93cyBqdWtlcyB0byB3b3JrIGJlY2F1c2UgdGhlIEFJIGlzIGNoYXNpbmcgd2hlcmUgeW91IFdFUkUuCiAgICAgICAgICAgIF90YXJnZXRQb3MuY29weSh0aGlzLnBlcmNlaXZlZFRhcmdldFBvcyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBJZiBiYWxsIGhhcyB2ZWxvY2l0eSwgbGVhZCBpdCBzbGlnaHRseSBiYXNlZCBvbiBwZXJjZXB0aW9uCiAgICAgICAgICAgIGNvbnN0IGJhbGwgPSB0aGlzLmJhbGxSZWY7CiAgICAgICAgICAgIGlmIChiYWxsLnZlbG9jaXR5Lmxlbmd0aFNxKCkgPiAxLjApIHsKICAgICAgICAgICAgICAgIF90YXJnZXRQb3MuYWRkU2NhbGVkVmVjdG9yKGJhbGwudmVsb2NpdHksIDAuMyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHRoaXMuX2F2b2lkR29hbENyZWFzZShfdGFyZ2V0UG9zKTsKICAgICAgICAgICAgdGhpcy5fbW92ZVRvKF90YXJnZXRQb3MpOwogICAgICAgIH0KCl9zdGF0ZVJldHVybkhvbWUoZHQpIHsKICAgICAgICAgICAgLy8gUmV0dXJuIHRvIGZvcm1hdGlvbiBwb3NpdGlvbgogICAgICAgICAgICBfdGFyZ2V0UG9zLmNvcHkodGhpcy5ob21lUG9zaXRpb24pOwogICAgICAgICAgICB0aGlzLl9hdm9pZEdvYWxDcmVhc2UoX3RhcmdldFBvcyk7CiAgICAgICAgICAgIHRoaXMuX21vdmVUbyhfdGFyZ2V0UG9zKTsKICAgICAgICB9Cgpfc3RhdGVTdXBwb3J0KGR0KSB7CiAgICAgICAgICAgIC8vIE9GRkVOU0UgKFRlYW1tYXRlIGhhcyBiYWxsKQogICAgICAgICAgICAvLyBHb2FsOiBGaW5kIG9wZW4gc3BhY2UgdG8gcmVjZWl2ZSBhIHBhc3MKICAgICAgICAgICAgY29uc3QgYmFsbFBvcyA9IHRoaXMuYmFsbFJlZi5tZXNoLnBvc2l0aW9uOwogICAgICAgICAgICBjb25zdCBhdHRhY2tEaXIgPSAodGhpcy50ZWFtLnNpZGUgPT09IDEpID8gLTEgOiAxOwogICAgICAgICAgICBjb25zdCBnb2FsWiA9ICh0aGlzLnRlYW0uc2lkZSA9PT0gMSkgPyAtMjggOiAyODsKCiAgICAgICAgICAgIC8vIDEuIERldGVybWluZSAiSWRlYWwiIFN1cHBvcnQgUG9zaXRpb24KICAgICAgICAgICAgLy8gU3RhcnQgd2l0aCBmb3JtYXRpb24gaG9tZQogICAgICAgICAgICBfdGFyZ2V0UG9zLmNvcHkodGhpcy5ob21lUG9zaXRpb24pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gMi4gRHluYW1pYyBBZGp1c3RtZW50CiAgICAgICAgICAgIGlmICh0aGlzLmlzRm9yd2FyZCkgewogICAgICAgICAgICAgICAgLy8gRm9yd2FyZHM6IE1ha2UgcnVucyB0b3dhcmRzIHRoZSBnb2FsL2JveAogICAgICAgICAgICAgICAgLy8gSWYgYmFsbCBpcyBkZWVwLCBjdXQgdG8gY2VudGVyLiBJZiBiYWxsIGlzIGJhY2ssIHB1c2ggbGluZS4KICAgICAgICAgICAgICAgIF90YXJnZXRQb3MueiA9IGJhbGxQb3MueiArIChhdHRhY2tEaXIgKiAxMC4wKTsgLy8gU3RheSBhaGVhZCBvZiBiYWxsCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFppZy16YWcgcnVuIHBhdHRlcm4gYmFzZWQgb24gdGltZSB0byBsb29rICJhbGl2ZSIKICAgICAgICAgICAgICAgIGNvbnN0IHRpbWUgPSBEYXRlLm5vdygpICogMC4wMDE7CiAgICAgICAgICAgICAgICBfdGFyZ2V0UG9zLnggKz0gTWF0aC5zaW4odGltZSArIHRoaXMubWVzaC5pZCkgKiA1LjA7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmlzTWlkZmllbGRlcikgewogICAgICAgICAgICAgICAgLy8gTWlkZmllbGRlcnM6IEZpbmQgcG9ja2V0IGJldHdlZW4gYmFsbCBhbmQgZ29hbAogICAgICAgICAgICAgICAgX3RhcmdldFBvcy5sZXJwVmVjdG9ycyhiYWxsUG9zLCBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCBnb2FsWiksIDAuNCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFN0YXkgd2lkZSBpZiBiYWxsIGlzIGNlbnRyYWwsIGNvbWUgY2VudHJhbCBpZiBiYWxsIGlzIHdpZGUKICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyhiYWxsUG9zLngpIDwgNSkgX3RhcmdldFBvcy54ID0gKHRoaXMuaG9tZVBvc2l0aW9uLnggPiAwID8gMTAgOiAtMTApOwogICAgICAgICAgICAgICAgZWxzZSBfdGFyZ2V0UG9zLnggPSAwOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gRGVmZW5kZXJzOiBTdXBwb3J0IGZyb20gYmVoaW5kIChzYWZldHkgdmFsdmUpCiAgICAgICAgICAgICAgICBfdGFyZ2V0UG9zLnogPSBiYWxsUG9zLnogLSAoYXR0YWNrRGlyICogOC4wKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMy4gQXZvaWQgRGVmZW5kZXJzIChSYXljYXN0LWlzaCBjaGVjaykKICAgICAgICAgICAgLy8gSWYgYSBkZWZlbmRlciBpcyBuZWFyIG15IHRhcmdldCwgc2hpZnQgYXdheQogICAgICAgICAgICBjb25zdCBnYW1lID0gd2luZG93LmZsdXguZ2FtZUluc3RhbmNlOwogICAgICAgICAgICBpZiAoZ2FtZSkgewogICAgICAgICAgICAgICAgY29uc3Qgb3BwVGVhbSA9ICh0aGlzLnRlYW0uaWQgPT09ICdob21lJykgPyBnYW1lLnRlYW1zLmF3YXkgOiBnYW1lLnRlYW1zLmhvbWU7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG9wcCBvZiBvcHBUZWFtLnBsYXllcnMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAob3BwLm1lc2ggJiYgb3BwLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyhfdGFyZ2V0UG9zKSA8IDQuMCkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBEZWZlbmRlciBpcyBjbG9nZ2luZyBteSBzcG90LiBTaGlmdCBhd2F5IGZyb20gdGhlbS4KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmxlZURpciA9IF90YXJnZXRQb3MuY2xvbmUoKS5zdWIob3BwLm1lc2gucG9zaXRpb24pLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBfdGFyZ2V0UG9zLmFkZChmbGVlRGlyLm11bHRpcGx5U2NhbGFyKDUuMCkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gNC4gQ2xhbXAgdG8gQXJlbmEKLy8gNC4gQ2xhbXAgdG8gQXJlbmEgKEtlZXAgcGxheWVycyBpbiBib3VuZHMsIGFuZCBvdXQgb2YgZ29hbCBuZXRzKQovLyA0LiBDbGFtcCB0byBBcmVuYSAmIENyZWFzZQogICAgICAgICAgICB0aGlzLl9hdm9pZEdvYWxDcmVhc2UoX3RhcmdldFBvcyk7CgogICAgICAgICAgICB0aGlzLl9tb3ZlVG8oX3RhcmdldFBvcyk7CiAgICAgICAgfQoKX3N0YXRlRGVmZW5kKGR0KSB7CiAgICAgICAgICAgIC8vIERFRkVOU0UgKE9wcG9uZW50IGhhcyBiYWxsKQogICAgICAgICAgICAvLyBVc2UgUGVyY2VpdmVkIFBvc2l0aW9uIGZvciBkaXN0YW5jZSBjaGVja3MgYW5kIG1vdmVtZW50CiAgICAgICAgICAgIGNvbnN0IHRhcmdldFBvcyA9IHRoaXMucGVyY2VpdmVkVGFyZ2V0UG9zOwogICAgICAgICAgICBjb25zdCBkaXN0VG9CYWxsID0gdGhpcy5tZXNoLnBvc2l0aW9uLmRpc3RhbmNlVG8odGFyZ2V0UG9zKTsKICAgICAgICAgICAgCi8vIDEuIERldGVybWluZSBQcmVzcyBSYW5nZQogICAgICAgICAgICAvLyBCYXNlIHJhbmdlCiAgICAgICAgICAgIGxldCBwcmVzc1JhbmdlID0gdGhpcy5pc0RlZmVuZGVyID8gMTUuMCA6IDEyLjA7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBBZ2dyZXNzaXZlIFRlY2ggVXNhZ2UKICAgICAgICAgICAgaWYgKHRoaXMudGVjaHMudGFja2xlICYmIHRoaXMuc3RhdHMuSFAgPiAyMCkgewogICAgICAgICAgICAgICAgcHJlc3NSYW5nZSArPSA1LjA7IAogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAtLS0gQU5USS1TV0FSTSBMT0dJQyAmIEFHR1JFU1NJT04gLS0tCiAgICAgICAgICAgIC8vIE9ubHkgdGhlIGNsb3Nlc3QgZGVmZW5kZXIgc2hvdWxkIGhhcmQtcHJlc3MgZnJvbSBkaXN0YW5jZS4KICAgICAgICAgICAgLy8gT3RoZXJzIHNob3VsZCBzdGljayB0byB0aGVpciB6b25lcy9tYXJrcyB1bmxlc3MgdGhlIGJhbGwgZW50ZXJzIHRoZWlyIHBlcnNvbmFsIHNwYWNlLgogICAgICAgICAgICBsZXQgYW1JQ2xvc2VzdCA9IHRydWU7CiAgICAgICAgICAgIGNvbnN0IG15RGlzdFNxID0gZGlzdFRvQmFsbCAqIGRpc3RUb0JhbGw7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAodGhpcy50ZWFtICYmIHRoaXMudGVhbS5wbGF5ZXJzKSB7CiAgICAgICAgICAgICAgICBmb3IoY29uc3QgbWF0ZSBvZiB0aGlzLnRlYW0ucGxheWVycykgewogICAgICAgICAgICAgICAgICAgIGlmIChtYXRlID09PSB0aGlzIHx8ICFtYXRlLm1lc2gpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIC8vIElnbm9yZSBHb2FsaWUgYW5kIGluY2FwYWNpdGF0ZWQgdGVhbW1hdGVzCiAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGUucm9sZSA9PT0gJ0dMJyB8fCBtYXRlLnN0YXR1cy5uYXAgPiAwIHx8IG1hdGUuc3R1blRpbWVyID4gMCkgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gVXNlIHJlYWwgcG9zaXRpb25zIGZvciB0ZWFtbWF0ZSBjb21wYXJpc29uIChBSSBrbm93cyB3aGVyZSB0ZWFtbWF0ZXMgYXJlKQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRTcSA9IG1hdGUubWVzaC5wb3NpdGlvbi5kaXN0YW5jZVRvU3F1YXJlZCh0YXJnZXRQb3MpOwogICAgICAgICAgICAgICAgICAgIGlmIChkU3EgPCBteURpc3RTcSkgewogICAgICAgICAgICAgICAgICAgICAgICBhbUlDbG9zZXN0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gWk9NQklFIEZJWDogSWYgSSBhbSB0aGUgY2xvc2VzdCwgSSBNVVNUIENIQVNFLgogICAgICAgICAgICAvLyBTZXQgcHJlc3NSYW5nZSB0byBlc3NlbnRpYWxseSBpbmZpbml0ZSBpZiBjbG9zZXN0LCBzbyB0aGV5IGRvbid0IGp1c3Qgc3RhbmQgdGhlcmUuCiAgICAgICAgICAgIGlmIChhbUlDbG9zZXN0KSB7CiAgICAgICAgICAgICAgICBwcmVzc1JhbmdlID0gNjAuMDsgLy8gRnVsbCBmaWVsZCBhZ2dyZXNzaW9uCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBJZiBub3QgY2xvc2VzdCwgcmV2ZXJ0IHRvIFpvbmUgRGVmZW5zZSByYW5nZSB0byBwcmV2ZW50IHN3YXJtaW5nCiAgICAgICAgICAgICAgICBwcmVzc1JhbmdlID0gOC4wOyAKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gSWYgYmFsbCBpcyBjbG9zZSBlbm91Z2ggKGJhc2VkIG9uIGNvbnRleHQpLCBQUkVTUyBJVAovLyBJZiBiYWxsIGlzIGNsb3NlIGVub3VnaCAoYmFzZWQgb24gY29udGV4dCksIFBSRVNTIElUCiAgICAgICAgICAgIGlmIChkaXN0VG9CYWxsIDwgcHJlc3NSYW5nZSkgewogICAgICAgICAgICAgICAgX3RhcmdldFBvcy5jb3B5KHRhcmdldFBvcyk7CiAgICAgICAgICAgICAgICB0aGlzLl9hdm9pZEdvYWxDcmVhc2UoX3RhcmdldFBvcyk7CiAgICAgICAgICAgICAgICB0aGlzLl9tb3ZlVG8oX3RhcmdldFBvcyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDIuIE1hcmsgTW9kZSAoTWFuLXRvLU1hbikKICAgICAgICAgICAgLy8gSWYgSSBoYXZlIGEgbWFyayBhc3NpZ25lZCwgc3RpY2sgdG8gdGhlbSB1bmxlc3MgcHJlc3NpbmcgYmFsbAogICAgICAgICAgICBpZiAodGhpcy5tYXJraW5nICYmIHRoaXMubWFya2luZy5tZXNoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBtYXJrUG9zID0gdGhpcy5tYXJraW5nLm1lc2gucG9zaXRpb247CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFBvc2l0aW9uOiBCZXR3ZWVuIG1hcmsgYW5kIG15IGdvYWwgKEdvYWwgU2lkZSkKICAgICAgICAgICAgICAgIGNvbnN0IG15R29hbFogPSAodGhpcy50ZWFtLnNpZGUgPT09IDEpID8gMjggOiAtMjg7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFZlY3RvciBmcm9tIE1hcmsgdG8gR29hbAogICAgICAgICAgICAgICAgY29uc3QgdG9Hb2FsID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgbXlHb2FsWiAtIG1hcmtQb3Mueik7CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0VG9Hb2FsID0gdG9Hb2FsLmxlbmd0aCgpOwogICAgICAgICAgICAgICAgdG9Hb2FsLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBTdGFuZCAzLjUgdW5pdHMgdG93YXJkcyBnb2FsIGZyb20gdGhlIG1hcmsgKEluY3JlYXNlZCBmcm9tIDIuMCB0byBnaXZlIGJyZWF0aGluZyByb29tKQogICAgICAgICAgICAgICAgX3RhcmdldFBvcy5jb3B5KG1hcmtQb3MpLmFkZFNjYWxlZFZlY3Rvcih0b0dvYWwsIDMuNSk7CiAgICAgICAgICAgICAgICAKdGhpcy5fYXZvaWRHb2FsQ3JlYXNlKF90YXJnZXRQb3MpOwogICAgICAgICAgICAgICAgdGhpcy5fbW92ZVRvKF90YXJnZXRQb3MpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAzLiBab25lIERlZmVuc2UgKEZvcm1hdGlvbiArIFNsaWRlKQogICAgICAgICAgICBfdGFyZ2V0UG9zLmNvcHkodGhpcy5ob21lUG9zaXRpb24pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU2xpZGUgbG9naWMgKFNoaWZ0IGZvcm1hdGlvbiB0b3dhcmRzIGJhbGwgc2lkZSkKICAgICAgICAgICAgX3RhcmdldFBvcy56ICs9IGJhbGxQb3MueiAqIDAuNjsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIERlZmVuZGVyIE92ZXJyaWRlOiBBbHdheXMgc3RheSBiZXR3ZWVuIGJhbGwgYW5kIGdvYWwKICAgICAgICAgICAgaWYgKHRoaXMuaXNEZWZlbmRlcikgewogICAgICAgICAgICAgICAgY29uc3QgbXlHb2FsWiA9ICh0aGlzLnRlYW0uc2lkZSA9PT0gMSkgPyAyOCA6IC0yODsKICAgICAgICAgICAgICAgIGNvbnN0IG1pZHBvaW50ID0gKGJhbGxQb3MueiArIG15R29hbFopICogMC41OwogICAgICAgICAgICAgICAgX3RhcmdldFBvcy56ID0gKF90YXJnZXRQb3MueiArIG1pZHBvaW50KSAqIDAuNTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQ2xhbXAKLy8gQ2xhbXAKICAgICAgICAgICAgX3RhcmdldFBvcy56ID0gTWF0aC5tYXgoLTI2LjAsIE1hdGgubWluKDI2LjAsIF90YXJnZXRQb3MueikpOwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5fYXZvaWRHb2FsQ3JlYXNlKF90YXJnZXRQb3MpOwogICAgICAgICAgICB0aGlzLl9tb3ZlVG8oX3RhcmdldFBvcyk7CiAgICAgICAgfQoKX2F2b2lkR29hbENyZWFzZSh0YXJnZXRQb3MpIHsKICAgICAgICAgICAgLy8gMS4gR29hbCBDcmVhc2UgQXZvaWRhbmNlIChSYWRpdXMgMTAgYXJvdW5kIGdvYWxzIGF0ICsvLSAyOCkKICAgICAgICAgICAgLy8gTWF0Y2hlcyBQbGF5ZXIuanMgX2FwcGx5R29hbENyZWFzZSBwaHlzaWNzIHRvIHByZXZlbnQgc3R1dHRlcmluZwogICAgICAgICAgICBjb25zdCBnb2FscyA9IFsKICAgICAgICAgICAgICAgIHsgeDogMCwgejogMjggfSwKICAgICAgICAgICAgICAgIHsgeDogMCwgejogLTI4IH0KICAgICAgICAgICAgXTsKICAgICAgICAgICAgY29uc3QgY3JlYXNlUmFkaXVzID0gMTAuNTsgLy8gU2xpZ2h0bHkgbGFyZ2VyIHRoYW4gcGh5c2ljcyAoMTAuMCkgZm9yIGJ1ZmZlcgoKICAgICAgICAgICAgZ29hbHMuZm9yRWFjaChnb2FsID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGR4ID0gdGFyZ2V0UG9zLnggLSBnb2FsLng7CiAgICAgICAgICAgICAgICBjb25zdCBkeiA9IHRhcmdldFBvcy56IC0gZ29hbC56OwogICAgICAgICAgICAgICAgY29uc3QgZGlzdFNxID0gZHgqZHggKyBkeipkejsKCiAgICAgICAgICAgICAgICBpZiAoZGlzdFNxIDwgY3JlYXNlUmFkaXVzICogY3JlYXNlUmFkaXVzKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gSW5zaWRlIGNyZWFzZSwgcHJvamVjdCB0byBlZGdlCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlzdCA9IE1hdGguc3FydChkaXN0U3EpOwogICAgICAgICAgICAgICAgICAgIGlmIChkaXN0ID4gMC4wMDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmF0aW8gPSBjcmVhc2VSYWRpdXMgLyBkaXN0OwogICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRQb3MueCA9IGdvYWwueCArIGR4ICogcmF0aW87CiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldFBvcy56ID0gZ29hbC56ICsgZHogKiByYXRpbzsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBFeGFjdCBjZW50ZXIsIHB1c2ggb3V0IHRvd2FyZHMgY2VudGVyIGZpZWxkCiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldFBvcy56ID0gZ29hbC56ICsgKGdvYWwueiA+IDAgPyAtY3JlYXNlUmFkaXVzIDogY3JlYXNlUmFkaXVzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gMi4gQXJlbmEgQm91bmRhcnkgQ2xhbXAgKFJhZGl1cyAzMikKICAgICAgICAgICAgY29uc3QgYXJlbmFSYWRpdXMgPSAzMS4wOyAvLyBLZWVwIHNsaWdodGx5IGluc2lkZSB2aXN1YWwvcGh5c2ljcyB3YWxsCiAgICAgICAgICAgIGNvbnN0IGRTcSA9IHRhcmdldFBvcy54KnRhcmdldFBvcy54ICsgdGFyZ2V0UG9zLnoqdGFyZ2V0UG9zLno7CiAgICAgICAgICAgIGlmIChkU3EgPiBhcmVuYVJhZGl1cyphcmVuYVJhZGl1cykgewogICAgICAgICAgICAgICAgY29uc3QgZCA9IE1hdGguc3FydChkU3EpOwogICAgICAgICAgICAgICAgY29uc3QgciA9IGFyZW5hUmFkaXVzIC8gZDsKICAgICAgICAgICAgICAgIHRhcmdldFBvcy54ICo9IHI7CiAgICAgICAgICAgICAgICB0YXJnZXRQb3MueiAqPSByOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBfZmluZEJlc3RQYXNzVGFyZ2V0KCkgewogICAgICAgICAgICBsZXQgYmVzdFRhcmdldCA9IG51bGw7CiAgICAgICAgICAgIGxldCBtYXhTY29yZSA9IC1JbmZpbml0eTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEF0dGFjayBkaXJlY3Rpb24gJiBHb2FsIFoKICAgICAgICAgICAgY29uc3QgYXR0YWNrRGlyID0gKHRoaXMudGVhbS5zaWRlID09PSAxKSA/IC0xIDogMTsgLy8gSG9tZSBhdHRhY2tzIC1aCiAgICAgICAgICAgIGNvbnN0IGdvYWxaID0gKHRoaXMudGVhbS5zaWRlID09PSAxKSA/IC0yOCA6IDI4OwoKICAgICAgICAgICAgZm9yIChjb25zdCBtYXRlIG9mIHRoaXMudGVhbS5wbGF5ZXJzKSB7CiAgICAgICAgICAgICAgICBpZiAobWF0ZSA9PT0gdGhpcykgY29udGludWU7CiAgICAgICAgICAgICAgICBpZiAoIW1hdGUubWVzaCkgY29udGludWU7CiAgICAgICAgICAgICAgICBpZiAobWF0ZS5zdGF0dXMubmFwID4gMCkgY29udGludWU7IC8vIERvbid0IHBhc3MgdG8gc2xlZXBlcnMKICAgICAgICAgICAgICAgIGlmIChtYXRlLnN0dW5UaW1lciA+IDApIGNvbnRpbnVlOyAgLy8gRG9uJ3QgcGFzcyB0byBzdHVubmVkIHBsYXllcnMKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgZGlzdCA9IHRoaXMubWVzaC5wb3NpdGlvbi5kaXN0YW5jZVRvKG1hdGUubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICBpZiAoZGlzdCA8IDQuMCkgY29udGludWU7ICAvLyBUb28gY2xvc2UgKFJlZHVjZWQgZm9yIHRpa2ktdGFrYSkKICAgICAgICAgICAgICAgIGlmIChkaXN0ID4gMzAuMCkgY29udGludWU7IC8vIFRvbyBmYXIgKEluY3JlYXNlZCByYW5nZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gMS4gUmF5Y2FzdCBDaGVjayAoSXMgdGhlIGxhbmUgY2xlYXI/KQogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzUGF0aEJsb2NrZWQobWF0ZS5tZXNoLnBvc2l0aW9uKSkgY29udGludWU7IAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyAyLiBDYWxjdWxhdGUgU3RyYXRlZ2ljIFNjb3JlCiAgICAgICAgICAgICAgICBsZXQgc2NvcmUgPSAwOwoKICAgICAgICAgICAgICAgIC8vIEEuIEZvcndhcmQgUHJvZ3Jlc3MgKFZlcnRpY2FsaXR5KQogICAgICAgICAgICAgICAgY29uc3QgbXlEaXN0VG9Hb2FsID0gTWF0aC5hYnModGhpcy5tZXNoLnBvc2l0aW9uLnogLSBnb2FsWik7CiAgICAgICAgICAgICAgICBjb25zdCBtYXRlRGlzdFRvR29hbCA9IE1hdGguYWJzKG1hdGUubWVzaC5wb3NpdGlvbi56IC0gZ29hbFopOwogICAgICAgICAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBteURpc3RUb0dvYWwgLSBtYXRlRGlzdFRvR29hbDsgLy8gUG9zaXRpdmUgaWYgbW92aW5nIGNsb3NlcgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzY29yZSArPSBwcm9ncmVzcyAqIDEuNTsgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEIuIEdvYWwgUHJveGltaXR5IChBYnNvbHV0ZSkKICAgICAgICAgICAgICAgIGlmIChtYXRlRGlzdFRvR29hbCA8IDE1LjApIHNjb3JlICs9IDEwLjA7CiAgICAgICAgICAgICAgICBpZiAobWF0ZURpc3RUb0dvYWwgPCA4LjApIHNjb3JlICs9IDE1LjA7CgogICAgICAgICAgICAgICAgLy8gQy4gT3Blbm5lc3MgKFNwYWNlIGFyb3VuZCByZWNlaXZlcikKICAgICAgICAgICAgICAgIGNvbnN0IG9wZW5uZXNzID0gdGhpcy5fY2FsY3VsYXRlT3Blbm5lc3MobWF0ZSk7CiAgICAgICAgICAgICAgICBzY29yZSArPSBvcGVubmVzcyAqIDMuMDsgLy8gSGlnaCB3ZWlnaHQgb24gc2FmZXR5CgogICAgICAgICAgICAgICAgLy8gRC4gUm9sZSBCaWFzIChGb3J3YXJkcyBhcmUgcHJpbWUgdGFyZ2V0cykKICAgICAgICAgICAgICAgIGlmIChtYXRlLmlzRm9yd2FyZCkgc2NvcmUgKz0gNS4wOwoKICAgICAgICAgICAgICAgIC8vIEUuIERpc3RhbmNlIFBlbmFsdHkgKExvbmcgcGFzc2VzIGFyZSByaXNreSkKICAgICAgICAgICAgICAgIHNjb3JlIC09IGRpc3QgKiAwLjU7CgogICAgICAgICAgICAgICAgaWYgKHNjb3JlID4gbWF4U2NvcmUpIHsKICAgICAgICAgICAgICAgICAgICBtYXhTY29yZSA9IHNjb3JlOwogICAgICAgICAgICAgICAgICAgIGJlc3RUYXJnZXQgPSBtYXRlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gYmVzdFRhcmdldDsKICAgICAgICB9CgogICAgICAgIF9jYWxjdWxhdGVPcGVubmVzcyhwbGF5ZXIpIHsKICAgICAgICAgICAgbGV0IG1pbkRlZkRpc3QgPSA5OTk7CiAgICAgICAgICAgIGNvbnN0IGdhbWUgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2U7CiAgICAgICAgICAgIGlmICghZ2FtZSkgcmV0dXJuIDA7CiAgICAgICAgICAgIGNvbnN0IG9wcFRlYW0gPSAodGhpcy50ZWFtLmlkID09PSAnaG9tZScpID8gZ2FtZS50ZWFtcy5hd2F5IDogZ2FtZS50ZWFtcy5ob21lOwoKICAgICAgICAgICAgZm9yIChjb25zdCBvcHAgb2Ygb3BwVGVhbS5wbGF5ZXJzKSB7CiAgICAgICAgICAgICAgICBpZiAoIW9wcC5tZXNoIHx8IG9wcC5zdGF0dXMubmFwID4gMCB8fCBvcHAuc3R1blRpbWVyID4gMCkgY29udGludWU7CiAgICAgICAgICAgICAgICBjb25zdCBkID0gcGxheWVyLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyhvcHAubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICBpZiAoZCA8IG1pbkRlZkRpc3QpIG1pbkRlZkRpc3QgPSBkOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBDbGFtcDogQW55dGhpbmcgYmV5b25kIDhtIGlzICJXaWRlIE9wZW4iCiAgICAgICAgICAgIHJldHVybiBNYXRoLm1pbihtaW5EZWZEaXN0LCA4LjApOwogICAgICAgIH0KCiAgICAgICAgX2lzUGF0aEJsb2NrZWQodGFyZ2V0UG9zKSB7CiAgICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy5tZXNoLnBvc2l0aW9uOwogICAgICAgICAgICBjb25zdCBlbmQgPSB0YXJnZXRQb3M7CiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBzdGFydC5kaXN0YW5jZVRvKGVuZCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBQcmVwYXJlIFJheSBEaXJlY3Rpb24KICAgICAgICAgICAgX3NjYW5EaXIuc3ViVmVjdG9ycyhlbmQsIHN0YXJ0KS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGdhbWUgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2U7CiAgICAgICAgICAgIGlmICghZ2FtZSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBjb25zdCBvcHBUZWFtID0gKHRoaXMudGVhbS5pZCA9PT0gJ2hvbWUnKSA/IGdhbWUudGVhbXMuYXdheSA6IGdhbWUudGVhbXMuaG9tZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEludGVyY2VwdGlvbiByYWRpdXMKICAgICAgICAgICAgY29uc3Qgc2FmZXR5UmFkaXVzID0gMi41OyAKCiAgICAgICAgICAgIGZvciAoY29uc3Qgb3BwIG9mIG9wcFRlYW0ucGxheWVycykgewogICAgICAgICAgICAgICAgaWYgKCFvcHAubWVzaCB8fCBvcHAuc3RhdHVzLm5hcCA+IDAgfHwgb3BwLnN0dW5UaW1lciA+IDApIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBWZWN0b3IgZnJvbSBzdGFydCB0byBvcHBvbmVudAogICAgICAgICAgICAgICAgX3NjYW5Ub09wcC5zdWJWZWN0b3JzKG9wcC5tZXNoLnBvc2l0aW9uLCBzdGFydCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFByb2plY3Qgb250byBwYXRoCiAgICAgICAgICAgICAgICBjb25zdCBwcm9qZWN0aW9uID0gX3NjYW5Ub09wcC5kb3QoX3NjYW5EaXIpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiBwcm9qZWN0aW9uIGlzIHdpdGhpbiB0aGUgc2VnbWVudAogICAgICAgICAgICAgICAgaWYgKHByb2plY3Rpb24gPiAwICYmIHByb2plY3Rpb24gPCBkaXN0KSB7CiAgICAgICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHBlcnBlbmRpY3VsYXIgZGlzdGFuY2Ugc3F1YXJlZAogICAgICAgICAgICAgICAgICAgIC8vIGRpc3RTcSA9IHx0b09wcHxeMiAtIHByb2plY3Rpb25eMgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBlcnBEaXN0U3EgPSBfc2NhblRvT3BwLmxlbmd0aFNxKCkgLSAocHJvamVjdGlvbiAqIHByb2plY3Rpb24pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIChwZXJwRGlzdFNxIDwgKHNhZmV0eVJhZGl1cyAqIHNhZmV0eVJhZGl1cykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7IC8vIEJsb2NrZWQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCl9tb3ZlVG8odGFyZ2V0KSB7CiAgICAgICAgICAgIF9haVZlYy5zdWJWZWN0b3JzKHRhcmdldCwgdGhpcy5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgX2FpVmVjLnkgPSAwOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgZGlzdFNxID0gX2FpVmVjLmxlbmd0aFNxKCk7CgogICAgICAgICAgICAvLyBEZWFkem9uZTogSWYgd2l0aGluIDEuMG0gKDEuMCBzcSksIHN0b3AuCiAgICAgICAgICAgIC8vIEluY3JlYXNlZCBmcm9tIDAuMSAoMC4zbSkgdG8gcHJldmVudCBtaWNyby1hZGp1c3RtZW50IHNwaW5uaW5nIGF0IGRlc3RpbmF0aW9uLgogICAgICAgICAgICAvLyBUaGlzIGlzIGNydWNpYWwgd2hlbiB0YXJnZXRzIGFyZSBkeW5hbWljIChlLmcuIHJlbGF0aXZlIHRvIGJhbGwgaG9sZGVyKS4KICAgICAgICAgICAgaWYgKGRpc3RTcSA+IDEuMCkgewogICAgICAgICAgICAgICAgX2FpVmVjLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgdGhpcy5zZXRJbnB1dChfYWlWZWMueCwgX2FpVmVjLnopOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5zZXRJbnB1dCgwLCAwKTsKICAgICAgICAgICAgICAgIC8vIEJyYWtpbmcgZnJpY3Rpb24gdG8gc3RvcCBkcmlmdCBpbW1lZGlhdGVseSB1cG9uIHJlYWNoaW5nIHRhcmdldAogICAgICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS5tdWx0aXBseVNjYWxhcigwLjgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKX2FwcGx5SW50ZXJjZXB0aW9uUHJlc3N1cmUoZHQpIHsKICAgICAgICAgICAgY29uc3QgYmFsbCA9IHRoaXMuYmFsbFJlZjsKICAgICAgICAgICAgaWYgKCFiYWxsIHx8ICFiYWxsLm1lc2gpIHJldHVybjsgLy8gU2FmZXR5IGNoZWNrCgogICAgICAgICAgICAvLyAxLiBCYXNpYyBFbGlnaWJpbGl0eSBDaGVja3MKICAgICAgICAgICAgLy8gTXVzdCBiZSBmcmVlIGFuZCBtb3ZpbmcKICAgICAgICAgICAgaWYgKGJhbGwuc3RhdGUgIT09ICdmcmVlJyB8fCBiYWxsLnZlbG9jaXR5Lmxlbmd0aFNxKCkgPCAxLjApIHJldHVybjsKICAgICAgICAgICAgLy8gQ2Fubm90IGludGVyY2VwdCBpbnZpc2libGUgYmFsbAogICAgICAgICAgICBpZiAoYmFsbC5pc0ludmlzaWJsZSkgcmV0dXJuOwogICAgICAgICAgICAvLyBTa2lwIGlmIHNsZWVwaW5nIG9yIHN0dW5uZWQKICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzLm5hcCA+IDAgfHwgdGhpcy5zdHVuVGltZXIgPiAwKSByZXR1cm47CgogICAgICAgICAgICAvLyAyLiBSYW5nZSBDYWxjdWxhdGlvbiAoVGhlICJGaWVsZCIgUmFkaXVzKQogICAgICAgICAgICBsZXQgcmFuZ2UgPSAyLjA7IC8vIFJlZHVjZWQgZnJvbSAzLjUgdG8gcHJldmVudCAiZm9yY2UgZmllbGQiIGZlZWxpbmcKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFBhc3NpdmUgVGVjaHM6IEJyYXdsZXIgLyBFbGl0ZSBEZWZlbnNlCiAgICAgICAgICAgIGlmICh0aGlzLnRlY2hzLnBhc3NpdmUgPT09ICdicmF3bGVyJyB8fCB0aGlzLnRlY2hzLnBhc3NpdmUgPT09ICdlbGl0ZV9kZWZlbnNlJykgewogICAgICAgICAgICAgICAgcmFuZ2UgKz0gMS41OyAvLyBSZWR1Y2VkIGJvb3N0CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSB0aGlzLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyhiYWxsLm1lc2gucG9zaXRpb24pOwogICAgICAgICAgICBpZiAoZGlzdCA+IHJhbmdlKSByZXR1cm47CgogICAgICAgICAgICAvLyAzLiBEaXJlY3Rpb25hbCBGYWN0b3IgKFRoZSAiQ29uZSIpCiAgICAgICAgICAgIC8vIFZlY3RvciBmcm9tIEJhbGwgdG8gRGVmZW5kZXIKICAgICAgICAgICAgX3NjYW5Ub09wcC5zdWJWZWN0b3JzKHRoaXMubWVzaC5wb3NpdGlvbiwgYmFsbC5tZXNoLnBvc2l0aW9uKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgY29uc3QgYmFsbERpciA9IGJhbGwudmVsb2NpdHkuY2xvbmUoKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgCi8vIERvdCBQcm9kdWN0OiAKICAgICAgICAgICAgLy8gMS4wID0gQmFsbCBoZWFkaW5nIHN0cmFpZ2h0IGZvciBkZWZlbmRlcgogICAgICAgICAgICAvLyAwLjAgPSBQYXNzaW5nIGJ5IHNpZGUgKFBlcnBlbmRpY3VsYXIpCiAgICAgICAgICAgIGNvbnN0IGhlYWRpbmdEb3QgPSBiYWxsRGlyLmRvdChfc2NhblRvT3BwKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIE9ubHkgYXBwbHkgZHJhZyBpZiBiYWxsIGlzIGFwcHJvYWNoaW5nIERJUkVDVExZIChTdHJpY3RlciBjb25lKQogICAgICAgICAgICAvLyBJbmNyZWFzZWQgdGhyZXNob2xkIGZyb20gMC4wIHRvIDAuNyAoTXVzdCBiZSB3aXRoaW4gfjQ1IGRlZ3JlZXMpCiAgICAgICAgICAgIGlmIChoZWFkaW5nRG90IDwgMC43KSByZXR1cm47CiAgICAgICAgICAgIC8vIDQuIENhbGN1bGF0ZSBQcmVzc3VyZSBJbnRlbnNpdHkKICAgICAgICAgICAgLy8gRGlzdGFuY2UgRmFjdG9yOiBDbG9zZXIgPSBTdHJvbmdlciAoTGluZWFyIGZhbGxvZmYpCiAgICAgICAgICAgIGNvbnN0IGRpc3RGYWN0b3IgPSBNYXRoLm1heCgwLCAxLjAgLSAoZGlzdCAvIHJhbmdlKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBBbmdsZSBGYWN0b3I6IERpcmVjdCBoaXQgPSAxLjAsIEdsYW5jaW5nID0gMC40CiAgICAgICAgICAgIGNvbnN0IGFuZ2xlRmFjdG9yID0gTWF0aC5tYXgoMC4zLCBoZWFkaW5nRG90KTsKCiAgICAgICAgICAgIC8vIEJMIFN0YXQKICAgICAgICAgICAgY29uc3QgYmwgPSB0aGlzLmdldFN0YXQoJ0JMJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBUb3RhbCBQcmVzc3VyZSAoUEEvU0ggZHJhaW4gcGVyIHNlY29uZCkKICAgICAgICAgICAgLy8gQmFzZSBtdWx0aXBsaWVyIGZvciBzdGF0cyAoUmVkdWNlZCBmcm9tIDYuMCB0byAzLjApCiAgICAgICAgICAgIGNvbnN0IHByZXNzdXJlTXVsdGlwbGllciA9IDMuMDsgCiAgICAgICAgICAgIGNvbnN0IHByZXNzdXJlID0gYmwgKiBkaXN0RmFjdG9yICogYW5nbGVGYWN0b3IgKiBwcmVzc3VyZU11bHRpcGxpZXIgKiBkdDsKCiAgICAgICAgICAgIC8vIDUuIEFwcGx5IHRvIEJhbGwgU3RhdHMgKFBBL1NIKQogICAgICAgICAgICBpZiAoYmFsbC5wb3dlciA+IDApIHsKICAgICAgICAgICAgICAgIGJhbGwucG93ZXIgLT0gcHJlc3N1cmU7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFZpc3VhbCBGZWVkYmFjayAoQWNjdW11bGF0b3IpCiAgICAgICAgICAgICAgICB0aGlzLl9hY2N1bXVsYXRlZEJsb2NrID0gKHRoaXMuX2FjY3VtdWxhdGVkQmxvY2sgfHwgMCkgKyBwcmVzc3VyZTsKICAgICAgICAgICAgICAgIC8vIFNob3cgZmxvYXRpbmcgdGV4dCBldmVyeSA1IHBvaW50cyBkcmFpbmVkCiAgICAgICAgICAgICAgICBpZiAodGhpcy5fYWNjdW11bGF0ZWRCbG9jayA+PSA1LjApIHsgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsID0gTWF0aC5mbG9vcih0aGlzLl9hY2N1bXVsYXRlZEJsb2NrKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9hY2N1bXVsYXRlZEJsb2NrIC09IHZhbDsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgeyAKICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNwYXduIG9uIGJhbGwsIGF0dGFjaCB0byBiYWxsCiAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKGAtJHt2YWx9YCwgYmFsbC5tZXNoLnBvc2l0aW9uLCAiYmxvY2siLCBiYWxsLm1lc2gpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKLy8gNi4gQXBwbHkgUGh5c2ljYWwgRHJhZyAtIFJFTU9WRUQKICAgICAgICAgICAgLy8gVGhlIGJhbGwgbm93IHBhc3NlcyB0aHJvdWdoIGRlZmVuZGVycyB3aXRob3V0IHNsb3dpbmcgZG93biBwaHlzaWNhbGx5LgogICAgICAgICAgICAvLyBPbmx5IHN0YXRzIChQb3dlcikgYXJlIGRyYWluZWQuCgogICAgICAgICAgICAvLyA3LiBWaXN1YWxzOiBUaGUgIlRldGhlciIgLyBJbnRlcmZlcmVuY2UgRmllbGQKICAgICAgICAgICAgLy8gU3Bhd24gc3BhcmtzIGJldHdlZW4gYmFsbCBhbmQgZGVmZW5kZXIgdG8gc2hvdyB0aGUgZmllbGQgZWZmZWN0CiAgICAgICAgICAgIGlmIChNYXRoLnJhbmRvbSgpIDwgKGRpc3RGYWN0b3IgKiAwLjgpKSB7IAogICAgICAgICAgICAgICAgY29uc3QgbWlkID0gdGhpcy5tZXNoLnBvc2l0aW9uLmNsb25lKCkubGVycChiYWxsLm1lc2gucG9zaXRpb24sIDAuNSArIChNYXRoLnJhbmRvbSgpLTAuNSkqMC4yKTsKICAgICAgICAgICAgICAgIC8vIEppdHRlcgogICAgICAgICAgICAgICAgbWlkLnggKz0gKE1hdGgucmFuZG9tKCktMC41KSAqIDAuNTsKICAgICAgICAgICAgICAgIG1pZC55ICs9IChNYXRoLnJhbmRvbSgpLTAuNSkgKiAwLjU7CiAgICAgICAgICAgICAgICBtaWQueiArPSAoTWF0aC5yYW5kb20oKS0wLjUpICogMC41OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLnNwYXduQ2xhc2gpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2Uuc3Bhd25DbGFzaChtaWQsIDAuNik7IC8vIFNwYXJrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDguIFNob3QgU3RvcCAvIEJsb2NrIExvZ2ljCiAgICAgICAgICAgIGlmIChiYWxsLnBvd2VyIDw9IDAgJiYgYmFsbC5wb3dlclR5cGUgPT09ICdTSCcpIHsKICAgICAgICAgICAgICAgIGJhbGwucG93ZXJUeXBlID0gJ25vbmUnOyAvLyBOZXV0cmFsaXplIHNob3QKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gTk8gREVGTEVDVElPTjogVGhlIGJhbGwgY29udGludWVzIG9uIGl0cyBwYXRoLgogICAgICAgICAgICAgICAgLy8gSXQgaXMgbm93IGEgImRlYWQgYmFsbCIgKG5vIHBvd2VyKSBidXQga2VlcHMgbW92aW5nLgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgeyAKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJCTE9DS0VEIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAiY29taWMtaW1wYWN0Iik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBObyBpbXBhY3QgZnJlZXplIHRvIGtlZXAgZmxvdyBzbW9vdGgKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gOS4gU3RhdHVzIFJpc2sgKFZlbm9tL05hcC9XaXRoZXIgb24gQmFsbCkKICAgICAgICAgICAgaWYgKGJhbGwudGVjaG5pcXVlICYmICF0aGlzLl90ZWNoQXBwbGllZCkgewogICAgICAgICAgICAgICAgdGhpcy5fdGVjaEFwcGxpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgY29uc3QgdGVjaCA9IGJhbGwudGVjaG5pcXVlOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAodGVjaC50eXBlID09PSAndmVub20nKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBseVN0YXR1cygndmVub20nLCAxNS4wKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGVjaC50eXBlID09PSAnbmFwJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwbHlTdGF0dXMoJ25hcCcsIDguMCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRlY2gudHlwZSA9PT0gJ3dpdGhlcicpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGx5U3RhdHVzKCd3aXRoZXInLCAxNS4wLCAnQkwnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7IHRoaXMuX3RlY2hBcHBsaWVkID0gZmFsc2U7IH0sIDIwMDApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHdpbmRvdy5mbHV4LkFJUGxheWVyID0gQUlQbGF5ZXI7Cn0pKCk7","/AIPlayer.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCi8vIFJldXNhYmxlIHZlY3RvcnMKICAgIGNvbnN0IF9haVZlYyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfdGFyZ2V0UG9zID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgIGNvbnN0IF9zY2FuRGlyID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgIGNvbnN0IF9zY2FuVG9PcHAgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwoKY2xhc3MgQUlQbGF5ZXIgZXh0ZW5kcyB3aW5kb3cuZmx1eC5QbGF5ZXIgewogICAgICAgIGNvbnN0cnVjdG9yKHNjZW5lLCByb2xlKSB7CiAgICAgICAgICAgIHN1cGVyKHNjZW5lLCByb2xlKTsKICAgICAgICAgICAgdGhpcy5iYWxsUmVmID0gbnVsbDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFN0YXRzIGFyZSBtYW5hZ2VkIGJ5IFRlYW0vTWFpbiBvciBkZWZhdWx0IFBsYXllciB2YWx1ZXMuCiAgICAgICAgICAgIC8vIE5vIGNvbnN0cnVjdG9yIG92ZXJyaWRlcyB0byBlbnN1cmUgZmFpciBzY2FsaW5nIGFuZCBkZW1vIGNvbnNpc3RlbmN5LgogICAgICAgICAgICB0aGlzLl91cGRhdGVEZXJpdmVkU3RhdHMoKTsKCiAgICAgICAgICAgIC8vIFN0YXRlIE1hY2hpbmUKICAgICAgICAgICAgdGhpcy5haVN0YXRlID0gJ0lETEUnOwogICAgICAgICAgICB0aGlzLmRlY2lzaW9uVGltZXIgPSAwOwogICAgICAgICAgICB0aGlzLmRlY2lzaW9uSW50ZXJ2YWwgPSAwLjE7IC8vIElNUFJPVkVEOiBGYXN0ZXIgZGVjaXNpb25zICh3YXMgMC4yKQoKICAgICAgICAgICAgLy8gLS0tIFBFUkNFUFRJT04gU1lTVEVNIChSZWFjdGlvbiBUaW1lKSAtLS0KICAgICAgICAgICAgLy8gVGhlIEFJIHRyYWNrcyBhICJnaG9zdCIgdGFyZ2V0IHRoYXQgbGFncyBiZWhpbmQgcmVhbGl0eS4KICAgICAgICAgICAgLy8gVGhpcyBhbGxvd3MgaHVtYW4gcGxheWVycyB0byBqdWtlL2Zha2Ugb3V0IHRoZSBBSS4KICAgICAgICAgICAgdGhpcy5wZXJjZWl2ZWRUYXJnZXRQb3MgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgICAgICAgICB0aGlzLnJlYWN0aW9uU3BlZWQgPSA4LjA7IC8vIElNUFJPVkVEOiBGYXN0ZXIgcmVhY3Rpb24gKHdhcyA1LjApCgogICAgICAgICAgICAvLyBJTVBST1ZFRDogQmV0dGVyIGFudGljaXBhdGlvbgogICAgICAgICAgICB0aGlzLmFudGljaXBhdGlvblRpbWUgPSAwLjQ7IC8vIExlYWQgdGFyZ2V0IGJ5IHRoaXMgbWFueSBzZWNvbmRzCiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBSb2xlIENvbmZpZwogICAgICAgICAgICB0aGlzLmlzRm9yd2FyZCA9IFsnTEYnLCAnUkYnXS5pbmNsdWRlcyhyb2xlKTsKICAgICAgICAgICAgdGhpcy5pc01pZGZpZWxkZXIgPSByb2xlID09PSAnTUYnOwogICAgICAgICAgICB0aGlzLmlzRGVmZW5kZXIgPSBbJ0xEJywgJ1JEJ10uaW5jbHVkZXMocm9sZSk7CgogICAgICAgICAgICAvLyBBc3NpZ24gZGVmYXVsdCB0ZWNobmlxdWVzIHNvIEFJIGlzIGEgdGhyZWF0CiAgICAgICAgICAgIHRoaXMuX2Fzc2lnbkRlZmF1bHRUZWNocygpOwogICAgICAgIH0KCiAgICAgICAgX2Fzc2lnbkRlZmF1bHRUZWNocygpIHsKICAgICAgICAgICAgLy8gUmFuZG9tbHkgYXNzaWduIHRlY2hzIGJhc2VkIG9uIHJvbGUKY29uc3QgdGFja2xlVGVjaHMgPSBbJ3Zlbm9tJywgJ3dpdGhlcicsICdkcmFpbiddOwogICAgICAgICAgICBjb25zdCBzaG9vdFRlY2hzID0gWyd2ZW5vbScsICdzcGhlcmUnLCAnaW52aXNpYmxlJ107CiAgICAgICAgICAgIGNvbnN0IHBhc3NUZWNocyA9IFsndmVub20nLCAnd2l0aGVyJywgJ25hcCddOwogICAgICAgICAgICBjb25zdCBwYXNzaXZlVGVjaHMgPSBbJ2JyYXdsZXInLCAnZWxpdGVfZGVmZW5zZSddOwoKICAgICAgICAgICAgLy8gSGVscGVyIHRvIHBpY2sgcmFuZG9tCiAgICAgICAgICAgIGNvbnN0IHBpY2sgPSAoYXJyKSA9PiBhcnJbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogYXJyLmxlbmd0aCldOwogICAgICAgICAgICBjb25zdCBjaGFuY2UgPSAocHJvYikgPT4gTWF0aC5yYW5kb20oKSA8IHByb2I7CgppZiAodGhpcy5pc0RlZmVuZGVyKSB7CiAgICAgICAgICAgICAgICAvLyBEZWZlbmRlcnMgbG92ZSBzdGF0dXMgdGFja2xlcyBhbmQgcGFzc2l2ZXMKICAgICAgICAgICAgICAgIGlmIChjaGFuY2UoMC44KSkgdGhpcy50ZWNocy50YWNrbGUgPSBwaWNrKHRhY2tsZVRlY2hzKTsKICAgICAgICAgICAgICAgIGlmIChjaGFuY2UoMC4zKSkgdGhpcy50ZWNocy5wYXNzID0gcGljayhwYXNzVGVjaHMpOwogICAgICAgICAgICAgICAgaWYgKGNoYW5jZSgwLjUpKSB0aGlzLnRlY2hzLnBhc3NpdmUgPSBwaWNrKHBhc3NpdmVUZWNocyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5pc01pZGZpZWxkZXIpIHsKICAgICAgICAgICAgICAgIC8vIE1pZGZpZWxkZXJzIGFyZSBiYWxhbmNlZAogICAgICAgICAgICAgICAgaWYgKGNoYW5jZSgwLjYpKSB0aGlzLnRlY2hzLnRhY2tsZSA9IHBpY2sodGFja2xlVGVjaHMpOwogICAgICAgICAgICAgICAgaWYgKGNoYW5jZSgwLjYpKSB0aGlzLnRlY2hzLnBhc3MgPSBwaWNrKHBhc3NUZWNocyk7CiAgICAgICAgICAgICAgICBpZiAoY2hhbmNlKDAuMykpIHRoaXMudGVjaHMuc2hvb3QgPSBwaWNrKHNob290VGVjaHMpOwogICAgICAgICAgICAgICAgaWYgKGNoYW5jZSgwLjMpKSB0aGlzLnRlY2hzLnBhc3NpdmUgPSBwaWNrKHBhc3NpdmVUZWNocyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5pc0ZvcndhcmQpIHsKICAgICAgICAgICAgICAgIC8vIEZvcndhcmRzIGZvY3VzIG9uIHNob290aW5nCiAgICAgICAgICAgICAgICBpZiAoY2hhbmNlKDAuOSkpIHRoaXMudGVjaHMuc2hvb3QgPSBwaWNrKHNob290VGVjaHMpOwogICAgICAgICAgICAgICAgaWYgKGNoYW5jZSgwLjQpKSB0aGlzLnRlY2hzLnRhY2tsZSA9IHBpY2sodGFja2xlVGVjaHMpOyAvLyBGcm9udGxpbmUgcHJlc3N1cmUKICAgICAgICAgICAgICAgIGlmIChjaGFuY2UoMC4yKSkgdGhpcy50ZWNocy5wYXNzaXZlID0gcGljayhwYXNzaXZlVGVjaHMpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKdXBkYXRlKGR0KSB7CiAgICAgICAgICAgIC8vIFNhZmV0eTogQXV0by1saW5rIGJhbGwgaWYgbWlzc2luZyAoU2VsZi1oZWFsaW5nKQogICAgICAgICAgICBpZiAoIXRoaXMuYmFsbFJlZiAmJiB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UgJiYgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmVudGl0aWVzKSB7CiAgICAgICAgICAgICAgICB0aGlzLmJhbGxSZWYgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZW50aXRpZXMuYmFsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMC4gQ2hlY2sgaWYgQUkgbG9naWMgc2hvdWxkIHJ1bgogICAgICAgICAgICBjb25zdCBnYW1lID0gd2luZG93LmZsdXguZ2FtZUluc3RhbmNlOwogICAgICAgICAgICBjb25zdCBpc0RlbW8gPSBnYW1lICYmIGdhbWUuaXNEZW1vTW9kZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENoZWNrIGluY2FwYWNpdGF0aW9uIChTdHVuIG9yIE5hcCkKICAgICAgICAgICAgY29uc3QgaXNJbmNhcGFjaXRhdGVkID0gKHRoaXMuc3R1blRpbWVyID4gMCkgfHwgKHRoaXMuc3RhdHVzLm5hcCA+IDApOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQUkgcnVucyBpZjoKICAgICAgICAgICAgLy8gMS4gSXQncyBhbiBBSSB0ZWFtIChub3QgaHVtYW4pCiAgICAgICAgICAgIC8vIDIuIEl0J3MgYSBIdW1hbiB0ZWFtIEJVVCBEZW1vIE1vZGUgaXMgT04KICAgICAgICAgICAgLy8gMy4gSXQncyBhIEh1bWFuIHRlYW0sIERlbW8gaXMgT0ZGLCBidXQgdGhpcyBwbGF5ZXIgaXMgTk9UIHRoZSBhY3RpdmUgY29udHJvbGxlZCBwbGF5ZXIKICAgICAgICAgICAgY29uc3QgaXNIdW1hblRlYW0gPSB0aGlzLnRlYW0gJiYgdGhpcy50ZWFtLmlzSHVtYW47CiAgICAgICAgICAgIGNvbnN0IGlzQWN0aXZlUGxheWVyID0gdGhpcy50ZWFtICYmICh0aGlzLnRlYW0uYWN0aXZlUGxheWVyID09PSB0aGlzKTsKICAgICAgICAgICAgY29uc3Qgc2hvdWxkUnVuQUkgPSAoIWlzSHVtYW5UZWFtIHx8IGlzRGVtbyB8fCAoaXNIdW1hblRlYW0gJiYgIWlzQWN0aXZlUGxheWVyKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBNYXN0ZXIgQUkgU3dpdGNoIGZvciB0aGUgdGVhbQogICAgICAgICAgICBjb25zdCBpc1RlYW1BSUVuYWJsZWQgPSB0aGlzLnRlYW0gPyB0aGlzLnRlYW0uYWlFbmFibGVkIDogdHJ1ZTsKCiAgICAgICAgICAgIGlmIChpc0luY2FwYWNpdGF0ZWQpIHsKICAgICAgICAgICAgICAgIC8vIElmIHN0dW5uZWQvc2xlZXBpbmcsIGRvIG5vdGhpbmcuCiAgICAgICAgICAgICAgICB0aGlzLnNldElucHV0KDAsIDApOwogICAgICAgICAgICB9IGVsc2UgaWYgKHNob3VsZFJ1bkFJICYmIGlzVGVhbUFJRW5hYmxlZCkgewogICAgICAgICAgICAgICAgLy8gLS0tIElNUFJPVkVEIFBFUkNFUFRJT04gVVBEQVRFIC0tLQogICAgICAgICAgICAgICAgLy8gVXBkYXRlIHBlcmNlaXZlZCBwb3NpdGlvbiB0b3dhcmRzIHJlYWwgdGFyZ2V0IChCYWxsIG9yIEJhbGwgSG9sZGVyKQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYmFsbFJlZiAmJiB0aGlzLmJhbGxSZWYubWVzaCkgewogICAgICAgICAgICAgICAgICAgIGxldCByZWFsVGFyZ2V0ID0gdGhpcy5iYWxsUmVmLm1lc2gucG9zaXRpb24uY2xvbmUoKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgYmFsbCBpcyBoZWxkLCB0cmFjayB0aGUgaG9sZGVyIHdpdGggYW50aWNpcGF0aW9uCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYmFsbFJlZi5ob2xkZXIgJiYgdGhpcy5iYWxsUmVmLmhvbGRlci5tZXNoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWxUYXJnZXQgPSB0aGlzLmJhbGxSZWYuaG9sZGVyLm1lc2gucG9zaXRpb24uY2xvbmUoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElNUFJPVkVEOiBMZWFkIHRoZSB0YXJnZXQgYmFzZWQgb24gdGhlaXIgdmVsb2NpdHkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYmFsbFJlZi5ob2xkZXIudmVsb2NpdHkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWxUYXJnZXQuYWRkU2NhbGVkVmVjdG9yKHRoaXMuYmFsbFJlZi5ob2xkZXIudmVsb2NpdHksIHRoaXMuYW50aWNpcGF0aW9uVGltZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYmFsbFJlZi52ZWxvY2l0eSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBGb3IgbG9vc2UgYmFsbCwgYW50aWNpcGF0ZSBiYXNlZCBvbiBiYWxsIHZlbG9jaXR5CiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWxUYXJnZXQuYWRkU2NhbGVkVmVjdG9yKHRoaXMuYmFsbFJlZi52ZWxvY2l0eSwgdGhpcy5hbnRpY2lwYXRpb25UaW1lICogMC41KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIExlcnAgcGVyY2VwdGlvbiB0b3dhcmRzIGFudGljaXBhdGVkIHJlYWxpdHkKICAgICAgICAgICAgICAgICAgICBjb25zdCBhbHBoYSA9IE1hdGgubWluKDEuMCwgZHQgKiB0aGlzLnJlYWN0aW9uU3BlZWQpOwogICAgICAgICAgICAgICAgICAgIHRoaXMucGVyY2VpdmVkVGFyZ2V0UG9zLmxlcnAocmVhbFRhcmdldCwgYWxwaGEpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIDEuIERlY2lzaW9uIE1ha2luZwogICAgICAgICAgICAgICAgdGhpcy5kZWNpc2lvblRpbWVyICs9IGR0OwogICAgICAgICAgICAgICAgaWYgKHRoaXMuZGVjaXNpb25UaW1lciA+IHRoaXMuZGVjaXNpb25JbnRlcnZhbCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuZGVjaXNpb25UaW1lciA9IDA7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZXZhbHVhdGVTdGF0ZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIDIuIEV4ZWN1dGUgU3RhdGUgKFNldHMgaW5wdXRWZWN0b3IpCiAgICAgICAgICAgICAgICB0aGlzLl9leGVjdXRlU3RhdGUoZHQpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyAzLiBJbnRlcmNlcHRpb24gTG9naWMKICAgICAgICAgICAgICAgIHRoaXMuX2FwcGx5SW50ZXJjZXB0aW9uUHJlc3N1cmUoZHQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gSGVyZSBpZjoKICAgICAgICAgICAgICAgIC8vIDEuIENvbnRyb2xsZWQgYnkgSHVtYW4gKHNob3VsZFJ1bkFJID09IGZhbHNlKQogICAgICAgICAgICAgICAgLy8gMi4gQUkgTG9naWMgaXMgRGlzYWJsZWQgKGlzVGVhbUFJRW5hYmxlZCA9PSBmYWxzZSkKCiAgICAgICAgICAgICAgICAvLyBJZiBBSSBpcyBkaXNhYmxlZCwgd2UgbXVzdCBzdG9wIHRoZSBib3QgVU5MRVNTIGl0IGlzIGJlaW5nIGRyaXZlbiBieSBodW1hbiBpbnB1dC4KICAgICAgICAgICAgICAgIC8vIEh1bWFuIGlucHV0IGRyaXZlcyB0aGUgcGxheWVyIGlmOiBpc0h1bWFuVGVhbSBBTkQgaXNBY3RpdmVQbGF5ZXIgQU5EICFpc0RlbW8KICAgICAgICAgICAgICAgIGNvbnN0IGlzRHJpdmVuQnlIdW1hbiA9IGlzSHVtYW5UZWFtICYmIGlzQWN0aXZlUGxheWVyICYmICFpc0RlbW87CgogICAgICAgICAgICAgICAgaWYgKCFpc1RlYW1BSUVuYWJsZWQgJiYgIWlzRHJpdmVuQnlIdW1hbikgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0SW5wdXQoMCwgMCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gV2Ugc3RpbGwgYXBwbHkgcGFzc2l2ZSBpbnRlcmNlcHRpb24gaWYgaW4gdGhlIHdheS4KICAgICAgICAgICAgICAgIHRoaXMuX2FwcGx5SW50ZXJjZXB0aW9uUHJlc3N1cmUoZHQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyA0LiBCYXNlIFVwZGF0ZQogICAgICAgICAgICBzdXBlci51cGRhdGUoZHQpOwogICAgICAgIH0KCl9ldmFsdWF0ZVN0YXRlKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuYmFsbFJlZikgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBiYWxsID0gdGhpcy5iYWxsUmVmOwoKICAgICAgICAgICAgLy8gMS4gSSBoYXZlIHRoZSBiYWxsCiAgICAgICAgICAgIGlmICh0aGlzLmhhc0JhbGwpIHsKICAgICAgICAgICAgICAgIHRoaXMuYWlTdGF0ZSA9ICdBVFRBQ0tfQ0FSUlknOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAyLiBMb29zZSBCYWxsIExvZ2ljIChBbnRpLUZsb2NraW5nKQogICAgICAgICAgICBpZiAoIWJhbGwuaG9sZGVyKSB7CiAgICAgICAgICAgICAgICAvLyBEZWZhdWx0OiBSZXR1cm4gdG8gZm9ybWF0aW9uLiBPbmx5IGNoYXNlIGlmIHdlIGFyZSB0aGUgYmVzdCBjYW5kaWRhdGUuCiAgICAgICAgICAgICAgICB0aGlzLmFpU3RhdGUgPSAnUkVUVVJOX0hPTUUnOwoKLy8gSHlzdGVyZXNpczogSWYgSSB3YXMgYWxyZWFkeSBjaGFzaW5nLCBJJ20gZWZmZWN0aXZlbHkgImNsb3NlciIgdG8gcHJldmVudCBqaXR0ZXJ5IHN3aXRjaGluZwogICAgICAgICAgICAgICAgLy8gVGhpcyBwcmV2ZW50cyB0d28gcGxheWVycyBmcm9tIHN3YXBwaW5nIHJvbGVzIHJhcGlkbHkgd2hlbiBlcXVpZGlzdGFudC4KICAgICAgICAgICAgICAgIGNvbnN0IGJpYXMgPSAodGhpcy5haVN0YXRlID09PSAnQ0hBU0UnKSA/IDAuOCA6IDEuMDsKICAgICAgICAgICAgICAgIGNvbnN0IG15RGlzdCA9IHRoaXMubWVzaC5wb3NpdGlvbi5kaXN0YW5jZVRvKGJhbGwubWVzaC5wb3NpdGlvbikgKiBiaWFzOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsZXQgaXNDbG9zZXN0ID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICBpZiAodGhpcy50ZWFtICYmIHRoaXMudGVhbS5wbGF5ZXJzKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBwIG9mIHRoaXMudGVhbS5wbGF5ZXJzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwID09PSB0aGlzKSBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFwLm1lc2gpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWdub3JlIEdvYWxpZSAoR29hbGllIGhhbmRsZXMgdGhlaXIgb3duIGFyZWE7IGZpZWxkIHBsYXllcnMgc2hvdWxkbid0IHJlbHkgb24gdGhlbSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHAucm9sZSA9PT0gJ0dMJykgY29udGludWU7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmUgaW5jYXBhY2l0YXRlZCB0ZWFtbWF0ZXMKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHAuc3RhdHVzICYmIHAuc3RhdHVzLm5hcCA+IDApIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHRlYW1tYXRlIGRpc3RhbmNlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vdGU6IFdlIGRvbid0IGFwcGx5IGJpYXMgdG8gb3RoZXJzLCBlZmZlY3RpdmVseSBtYWtpbmcgIm1lIiBzdGlja2llciBpZiBJJ20gYWxyZWFkeSBjaGFzaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBEaXN0ID0gcC5tZXNoLnBvc2l0aW9uLmRpc3RhbmNlVG8oYmFsbC5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIGEgdGVhbW1hdGUgaXMgY2xvc2VyLCB5aWVsZCB0byB0aGVtCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwRGlzdCA8IG15RGlzdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNDbG9zZXN0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KfQoKICAgICAgICAgICAgICAgIGlmIChpc0Nsb3Nlc3QpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFpU3RhdGUgPSAnQ0hBU0UnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAzLiBUZWFtbWF0ZSBoYXMgYmFsbAogICAgICAgICAgICBpZiAoYmFsbC5ob2xkZXIudGVhbSA9PT0gdGhpcy50ZWFtKSB7CiAgICAgICAgICAgICAgICB0aGlzLmFpU3RhdGUgPSAnU1VQUE9SVCc7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDQuIE9wcG9uZW50IGhhcyBiYWxsCiAgICAgICAgICAgIGlmIChiYWxsLmhvbGRlci50ZWFtICE9PSB0aGlzLnRlYW0pIHsKICAgICAgICAgICAgICAgIHRoaXMuYWlTdGF0ZSA9ICdERUZFTkQnOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBfZXhlY3V0ZVN0YXRlKGR0KSB7CiAgICAgICAgICAgIGlmICghdGhpcy5iYWxsUmVmKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNldElucHV0KDAsIDApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzd2l0Y2ggKHRoaXMuYWlTdGF0ZSkgewogICAgICAgICAgICAgICAgY2FzZSAnQVRUQUNLX0NBUlJZJzogdGhpcy5fc3RhdGVBdHRhY2tDYXJyeShkdCk7IGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnU1VQUE9SVCc6IHRoaXMuX3N0YXRlU3VwcG9ydChkdCk7IGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnREVGRU5EJzogdGhpcy5fc3RhdGVEZWZlbmQoZHQpOyBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0NIQVNFJzogdGhpcy5fc3RhdGVDaGFzZShkdCk7IGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnUkVUVVJOX0hPTUUnOiAKICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHRoaXMuX3N0YXRlUmV0dXJuSG9tZShkdCk7IGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0gU1RBVEVTIC0tLQoKX3N0YXRlQXR0YWNrQ2FycnkoZHQpIHsKICAgICAgICAgICAgLy8gRHJpdmUgdG8gZ29hbAogICAgICAgICAgICAvLyBIb21lIChTaWRlIDEpIGF0dGFja3MgLVouIEF3YXkgKFNpZGUgLTEpIGF0dGFja3MgK1ouCiAgICAgICAgICAgIGNvbnN0IGF0dGFja0RpciA9ICh0aGlzLnRlYW0uc2lkZSA9PT0gMSkgPyAtMSA6IDE7CiAgICAgICAgICAgIGNvbnN0IGdvYWxaID0gMjggKiBhdHRhY2tEaXI7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBUYXJnZXQ6IEdvYWwgKGJ1dCByZXNwZWN0IGNyZWFzZSkKICAgICAgICAgICAgX3RhcmdldFBvcy5zZXQoMCwgMCwgZ29hbFopOwogICAgICAgICAgICB0aGlzLl9hdm9pZEdvYWxDcmVhc2UoX3RhcmdldFBvcyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBNb3ZlCiAgICAgICAgICAgIHRoaXMuX21vdmVUbyhfdGFyZ2V0UG9zKTsKCiAgICAgICAgICAgIC8vIERlY2lzaW9uOiBTaG9vdCBvciBQYXNzPwogICAgICAgICAgICBjb25zdCBkaXN0VG9Hb2FsID0gTWF0aC5hYnModGhpcy5tZXNoLnBvc2l0aW9uLnogLSBnb2FsWik7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAxLiBTaG9vdCBpZiBjbG9zZSBhbmQgY2xlYXIKICAgICAgICAgICAgaWYgKGRpc3RUb0dvYWwgPCAyMC4wICYmICF0aGlzLmlzVGhyb3dpbmcpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3NtYXJ0VGhyb3codGhpcy5iYWxsUmVmLCAnU0gnKTsgCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIDIuIFBhc3MgTG9naWMKICAgICAgICAgICAgLy8gQ2hlY2sgcGFzcyBpZjogU3Vycm91bmRlZCwgTG93IEVOLCBvciBQbGF5bWFrZXIgKE1pZGZpZWxkZXIpIHNlZXMgb3Bwb3J0dW5pdHkKICAgICAgICAgICAgY29uc3QgaXNTdXJyb3VuZGVkID0gdGhpcy5faXNTdXJyb3VuZGVkKCk7CiAgICAgICAgICAgIGNvbnN0IGxvd0VOID0gdGhpcy5jdXJyZW50RU4gPCAxMDsKICAgICAgICAgICAgY29uc3QgaXNQbGF5bWFrZXIgPSB0aGlzLmlzTWlkZmllbGRlcjsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICgoaXNTdXJyb3VuZGVkIHx8IGxvd0VOIHx8IGlzUGxheW1ha2VyKSAmJiAhdGhpcy5pc1Rocm93aW5nKSB7CiAgICAgICAgICAgICAgICBjb25zdCBiZXN0TWF0ZSA9IHRoaXMuX2ZpbmRCZXN0UGFzc1RhcmdldCgpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoYmVzdE1hdGUpIHsKICAgICAgICAgICAgICAgICAgICAvLyBFdmFsdWF0ZSBpZiBwYXNzIGlzIHdvcnRoIGl0CiAgICAgICAgICAgICAgICAgICAgLy8gSWYgUGxheW1ha2VyLCBwYXNzIGlmIG1hdGUgaXMgY2xvc2VyIHRvIGdvYWwKICAgICAgICAgICAgICAgICAgICAvLyBJZiBQYW5pYyAoU3Vycm91bmRlZC9Mb3dFTiksIHBhc3MgdG8gYW55b25lIG9wZW4KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsZXQgc2hvdWxkUGFzcyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIChpc1N1cnJvdW5kZWQgfHwgbG93RU4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2hvdWxkUGFzcyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc1BsYXltYWtlcikgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBteURpc3QgPSBNYXRoLmFicyh0aGlzLm1lc2gucG9zaXRpb24ueiAtIGdvYWxaKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbWF0ZURpc3QgPSBNYXRoLmFicyhiZXN0TWF0ZS5tZXNoLnBvc2l0aW9uLnogLSBnb2FsWik7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXRlRGlzdCA8IG15RGlzdCAtIDUuMCkgc2hvdWxkUGFzcyA9IHRydWU7IC8vIE1hdGUgaXMgNW0gY2xvc2VyCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIChzaG91bGRQYXNzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZhY2UgdGFyZ2V0CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5sb29rQXQoYmVzdE1hdGUubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEV4ZWN1dGUgUGFzcwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zbWFydFRocm93KHRoaXMuYmFsbFJlZiwgJ1BBJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIDMuIFBhbmljIENsZWFyIChJZiBzdXJyb3VuZGVkIGFuZCBubyBwYXNzKQogICAgICAgICAgICBpZiAoaXNTdXJyb3VuZGVkICYmICF0aGlzLmlzVGhyb3dpbmcpIHsKICAgICAgICAgICAgICAgIC8vIEp1c3Qgc2hvb3QvY2xlYXIKICAgICAgICAgICAgICAgIHRoaXMuX3NtYXJ0VGhyb3codGhpcy5iYWxsUmVmLCAnU0gnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX2lzU3Vycm91bmRlZCgpIHsKICAgICAgICAgICAgLy8gU2ltcGxlIGNoZWNrOiBjb3VudCBlbmVtaWVzIG5lYXJieQogICAgICAgICAgICBsZXQgY291bnQgPSAwOwogICAgICAgICAgICBjb25zdCBnYW1lID0gd2luZG93LmZsdXguZ2FtZUluc3RhbmNlOwogICAgICAgICAgICBpZiAoIWdhbWUpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgY29uc3Qgb3BwVGVhbSA9ICh0aGlzLnRlYW0uaWQgPT09ICdob21lJykgPyBnYW1lLnRlYW1zLmF3YXkgOiBnYW1lLnRlYW1zLmhvbWU7CiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IobGV0IHAgb2Ygb3BwVGVhbS5wbGF5ZXJzKSB7CiAgICAgICAgICAgICAgICBpZiAocC5tZXNoICYmIHAubWVzaC5wb3NpdGlvbi5kaXN0YW5jZVRvKHRoaXMubWVzaC5wb3NpdGlvbikgPCA0LjApIHsKICAgICAgICAgICAgICAgICAgICBjb3VudCsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBjb3VudCA+PSAyOwogICAgICAgIH0KCiAgICAgICAgX3NtYXJ0VGhyb3coYmFsbCwgZm9yY2VkVHlwZSA9IG51bGwpIHsKICAgICAgICAgICAgLy8gV3JhcHBlciBhcm91bmQgdGhyb3dCYWxsIHRvIG1hbmFnZSBIUCBhbmQgVGVjaHMKICAgICAgICAgICAgLy8gMS4gRGV0ZXJtaW5lIGludGVuZGVkIGFjdGlvbiB0eXBlCiAgICAgICAgICAgIGxldCB0eXBlID0gZm9yY2VkVHlwZTsKICAgICAgICAgICAgaWYgKCF0eXBlKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkaXIgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAxKS5hcHBseVF1YXRlcm5pb24odGhpcy5tZXNoLnF1YXRlcm5pb24pOwogICAgICAgICAgICAgICAgY29uc3QgYXR0YWNrRGlyID0gKHRoaXMudGVhbSAmJiB0aGlzLnRlYW0uc2lkZSA9PT0gMSkgPyAtMSA6IDE7CiAgICAgICAgICAgICAgICBjb25zdCBpc0FpbWluZ0dvYWwgPSAoZGlyLnogKiBhdHRhY2tEaXIgPiAwLjUpOwogICAgICAgICAgICAgICAgdHlwZSA9IGlzQWltaW5nR29hbCA/ICdTSCcgOiAnUEEnOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAyLiBHZXQgVGVjaAogICAgICAgICAgICBjb25zdCB0ZWNoTmFtZSA9ICh0eXBlID09PSAnU0gnKSA/IHRoaXMudGVjaHMuc2hvb3QgOiB0aGlzLnRlY2hzLnBhc3M7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAzLiBFc3RpbWF0ZSBDb3N0CiAgICAgICAgICAgIGxldCBiYXNlQ29zdCA9ICh0eXBlID09PSAnU0gnKSA/IDIwIDogMTA7CiAgICAgICAgICAgIGxldCB0ZWNoQ29zdCA9IDA7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAodGVjaE5hbWUpIHsKICAgICAgICAgICAgICAgIC8vIFJvdWdoIGVzdGltYXRlcyBiYXNlZCBvbiBQbGF5ZXIuanMKICAgICAgICAgICAgICAgIGlmICh0ZWNoTmFtZS5pbmNsdWRlcygnbmFwJykpIHRlY2hDb3N0ID0gMzA7CiAgICAgICAgICAgICAgICBlbHNlIGlmICh0ZWNoTmFtZS5pbmNsdWRlcygnc3BoZXJlJykgfHwgdGVjaE5hbWUuaW5jbHVkZXMoJ2ludmlzaWJsZScpKSB0ZWNoQ29zdCA9IDI1OwogICAgICAgICAgICAgICAgZWxzZSB0ZWNoQ29zdCA9IDIwOyAvLyBWZW5vbS9XaXRoZXIKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgdG90YWxDb3N0ID0gYmFzZUNvc3QgKyB0ZWNoQ29zdDsKCiAgICAgICAgICAgIC8vIDQuIERlY2lzaW9uCiAgICAgICAgICAgIC8vIElmIHdlIGhhdmUgYSB0ZWNoIGJ1dCBub3QgZW5vdWdoIEhQIGZvciBpdCwgQlVUIGVub3VnaCBIUCBmb3Igbm9ybWFsLi4uCiAgICAgICAgICAgIC8vIERpc2FibGUgdGVjaCB0ZW1wb3JhcmlseSB0byBhdm9pZCAiVGlyZWQiIHBlbmFsdHkgKDAuNXggc3RhdHMpCiAgICAgICAgICAgIGxldCB0ZW1wVGVjaCA9IG51bGw7CiAgICAgICAgICAgIGlmICh0ZWNoTmFtZSAmJiB0aGlzLnN0YXRzLkhQIDwgdG90YWxDb3N0ICYmIHRoaXMuc3RhdHMuSFAgPj0gYmFzZUNvc3QpIHsKICAgICAgICAgICAgICAgIC8vIFVuZXF1aXAKICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAnU0gnKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcFRlY2ggPSB0aGlzLnRlY2hzLnNob290OwogICAgICAgICAgICAgICAgICAgIHRoaXMudGVjaHMuc2hvb3QgPSBudWxsOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0ZW1wVGVjaCA9IHRoaXMudGVjaHMucGFzczsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRlY2hzLnBhc3MgPSBudWxsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBFeGVjdXRlCiAgICAgICAgICAgIHRoaXMudGhyb3dCYWxsKGJhbGwsIHR5cGUpOwoKICAgICAgICAgICAgLy8gUmVzdG9yZQogICAgICAgICAgICBpZiAodGVtcFRlY2gpIHsKICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAnU0gnKSB0aGlzLnRlY2hzLnNob290ID0gdGVtcFRlY2g7CiAgICAgICAgICAgICAgICBlbHNlIHRoaXMudGVjaHMucGFzcyA9IHRlbXBUZWNoOwogICAgICAgICAgICB9CiAgICAgICAgfQoKX3N0YXRlQ2hhc2UoZHQpIHsKICAgICAgICAgICAgLy8gSW50ZXJjZXB0aW9uOiBDaGFzZSB0aGUgUEVSQ0VJVkVEIHBvc2l0aW9uLCBub3QgdGhlIHJlYWwgb25lLgogICAgICAgICAgICAvLyBUaGlzIGFsbG93cyBqdWtlcyB0byB3b3JrIGJlY2F1c2UgdGhlIEFJIGlzIGNoYXNpbmcgd2hlcmUgeW91IFdFUkUuCiAgICAgICAgICAgIF90YXJnZXRQb3MuY29weSh0aGlzLnBlcmNlaXZlZFRhcmdldFBvcyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBJZiBiYWxsIGhhcyB2ZWxvY2l0eSwgbGVhZCBpdCBzbGlnaHRseSBiYXNlZCBvbiBwZXJjZXB0aW9uCiAgICAgICAgICAgIGNvbnN0IGJhbGwgPSB0aGlzLmJhbGxSZWY7CiAgICAgICAgICAgIGlmIChiYWxsLnZlbG9jaXR5Lmxlbmd0aFNxKCkgPiAxLjApIHsKICAgICAgICAgICAgICAgIF90YXJnZXRQb3MuYWRkU2NhbGVkVmVjdG9yKGJhbGwudmVsb2NpdHksIDAuMyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHRoaXMuX2F2b2lkR29hbENyZWFzZShfdGFyZ2V0UG9zKTsKICAgICAgICAgICAgdGhpcy5fbW92ZVRvKF90YXJnZXRQb3MpOwogICAgICAgIH0KCl9zdGF0ZVJldHVybkhvbWUoZHQpIHsKICAgICAgICAgICAgLy8gUmV0dXJuIHRvIGZvcm1hdGlvbiBwb3NpdGlvbgogICAgICAgICAgICBfdGFyZ2V0UG9zLmNvcHkodGhpcy5ob21lUG9zaXRpb24pOwogICAgICAgICAgICB0aGlzLl9hdm9pZEdvYWxDcmVhc2UoX3RhcmdldFBvcyk7CiAgICAgICAgICAgIHRoaXMuX21vdmVUbyhfdGFyZ2V0UG9zKTsKICAgICAgICB9Cgpfc3RhdGVTdXBwb3J0KGR0KSB7CiAgICAgICAgICAgIC8vIE9GRkVOU0UgKFRlYW1tYXRlIGhhcyBiYWxsKQogICAgICAgICAgICAvLyBHb2FsOiBGaW5kIG9wZW4gc3BhY2UgdG8gcmVjZWl2ZSBhIHBhc3MKICAgICAgICAgICAgY29uc3QgYmFsbFBvcyA9IHRoaXMuYmFsbFJlZi5tZXNoLnBvc2l0aW9uOwogICAgICAgICAgICBjb25zdCBhdHRhY2tEaXIgPSAodGhpcy50ZWFtLnNpZGUgPT09IDEpID8gLTEgOiAxOwogICAgICAgICAgICBjb25zdCBnb2FsWiA9ICh0aGlzLnRlYW0uc2lkZSA9PT0gMSkgPyAtMjggOiAyODsKCiAgICAgICAgICAgIC8vIDEuIERldGVybWluZSAiSWRlYWwiIFN1cHBvcnQgUG9zaXRpb24KICAgICAgICAgICAgLy8gU3RhcnQgd2l0aCBmb3JtYXRpb24gaG9tZQogICAgICAgICAgICBfdGFyZ2V0UG9zLmNvcHkodGhpcy5ob21lUG9zaXRpb24pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gMi4gRHluYW1pYyBBZGp1c3RtZW50CiAgICAgICAgICAgIGlmICh0aGlzLmlzRm9yd2FyZCkgewogICAgICAgICAgICAgICAgLy8gRm9yd2FyZHM6IE1ha2UgcnVucyB0b3dhcmRzIHRoZSBnb2FsL2JveAogICAgICAgICAgICAgICAgLy8gSWYgYmFsbCBpcyBkZWVwLCBjdXQgdG8gY2VudGVyLiBJZiBiYWxsIGlzIGJhY2ssIHB1c2ggbGluZS4KICAgICAgICAgICAgICAgIF90YXJnZXRQb3MueiA9IGJhbGxQb3MueiArIChhdHRhY2tEaXIgKiAxMC4wKTsgLy8gU3RheSBhaGVhZCBvZiBiYWxsCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFppZy16YWcgcnVuIHBhdHRlcm4gYmFzZWQgb24gdGltZSB0byBsb29rICJhbGl2ZSIKICAgICAgICAgICAgICAgIGNvbnN0IHRpbWUgPSBEYXRlLm5vdygpICogMC4wMDE7CiAgICAgICAgICAgICAgICBfdGFyZ2V0UG9zLnggKz0gTWF0aC5zaW4odGltZSArIHRoaXMubWVzaC5pZCkgKiA1LjA7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmlzTWlkZmllbGRlcikgewogICAgICAgICAgICAgICAgLy8gTWlkZmllbGRlcnM6IEZpbmQgcG9ja2V0IGJldHdlZW4gYmFsbCBhbmQgZ29hbAogICAgICAgICAgICAgICAgX3RhcmdldFBvcy5sZXJwVmVjdG9ycyhiYWxsUG9zLCBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCBnb2FsWiksIDAuNCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFN0YXkgd2lkZSBpZiBiYWxsIGlzIGNlbnRyYWwsIGNvbWUgY2VudHJhbCBpZiBiYWxsIGlzIHdpZGUKICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyhiYWxsUG9zLngpIDwgNSkgX3RhcmdldFBvcy54ID0gKHRoaXMuaG9tZVBvc2l0aW9uLnggPiAwID8gMTAgOiAtMTApOwogICAgICAgICAgICAgICAgZWxzZSBfdGFyZ2V0UG9zLnggPSAwOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gRGVmZW5kZXJzOiBTdXBwb3J0IGZyb20gYmVoaW5kIChzYWZldHkgdmFsdmUpCiAgICAgICAgICAgICAgICBfdGFyZ2V0UG9zLnogPSBiYWxsUG9zLnogLSAoYXR0YWNrRGlyICogOC4wKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMy4gQXZvaWQgRGVmZW5kZXJzIChSYXljYXN0LWlzaCBjaGVjaykKICAgICAgICAgICAgLy8gSWYgYSBkZWZlbmRlciBpcyBuZWFyIG15IHRhcmdldCwgc2hpZnQgYXdheQogICAgICAgICAgICBjb25zdCBnYW1lID0gd2luZG93LmZsdXguZ2FtZUluc3RhbmNlOwogICAgICAgICAgICBpZiAoZ2FtZSkgewogICAgICAgICAgICAgICAgY29uc3Qgb3BwVGVhbSA9ICh0aGlzLnRlYW0uaWQgPT09ICdob21lJykgPyBnYW1lLnRlYW1zLmF3YXkgOiBnYW1lLnRlYW1zLmhvbWU7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG9wcCBvZiBvcHBUZWFtLnBsYXllcnMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAob3BwLm1lc2ggJiYgb3BwLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyhfdGFyZ2V0UG9zKSA8IDQuMCkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBEZWZlbmRlciBpcyBjbG9nZ2luZyBteSBzcG90LiBTaGlmdCBhd2F5IGZyb20gdGhlbS4KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmxlZURpciA9IF90YXJnZXRQb3MuY2xvbmUoKS5zdWIob3BwLm1lc2gucG9zaXRpb24pLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBfdGFyZ2V0UG9zLmFkZChmbGVlRGlyLm11bHRpcGx5U2NhbGFyKDUuMCkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gNC4gQ2xhbXAgdG8gQXJlbmEKLy8gNC4gQ2xhbXAgdG8gQXJlbmEgKEtlZXAgcGxheWVycyBpbiBib3VuZHMsIGFuZCBvdXQgb2YgZ29hbCBuZXRzKQovLyA0LiBDbGFtcCB0byBBcmVuYSAmIENyZWFzZQogICAgICAgICAgICB0aGlzLl9hdm9pZEdvYWxDcmVhc2UoX3RhcmdldFBvcyk7CgogICAgICAgICAgICB0aGlzLl9tb3ZlVG8oX3RhcmdldFBvcyk7CiAgICAgICAgfQoKX3N0YXRlRGVmZW5kKGR0KSB7CiAgICAgICAgICAgIC8vIERFRkVOU0UgKE9wcG9uZW50IGhhcyBiYWxsKQogICAgICAgICAgICAvLyBVc2UgUGVyY2VpdmVkIFBvc2l0aW9uIGZvciBkaXN0YW5jZSBjaGVja3MgYW5kIG1vdmVtZW50CiAgICAgICAgICAgIGNvbnN0IHRhcmdldFBvcyA9IHRoaXMucGVyY2VpdmVkVGFyZ2V0UG9zOwogICAgICAgICAgICBjb25zdCBkaXN0VG9CYWxsID0gdGhpcy5tZXNoLnBvc2l0aW9uLmRpc3RhbmNlVG8odGFyZ2V0UG9zKTsKICAgICAgICAgICAgCi8vIDEuIERldGVybWluZSBQcmVzcyBSYW5nZQogICAgICAgICAgICAvLyBCYXNlIHJhbmdlCiAgICAgICAgICAgIGxldCBwcmVzc1JhbmdlID0gdGhpcy5pc0RlZmVuZGVyID8gMTUuMCA6IDEyLjA7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBBZ2dyZXNzaXZlIFRlY2ggVXNhZ2UKICAgICAgICAgICAgaWYgKHRoaXMudGVjaHMudGFja2xlICYmIHRoaXMuc3RhdHMuSFAgPiAyMCkgewogICAgICAgICAgICAgICAgcHJlc3NSYW5nZSArPSA1LjA7IAogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAtLS0gQU5USS1TV0FSTSBMT0dJQyAmIEFHR1JFU1NJT04gLS0tCiAgICAgICAgICAgIC8vIE9ubHkgdGhlIGNsb3Nlc3QgZGVmZW5kZXIgc2hvdWxkIGhhcmQtcHJlc3MgZnJvbSBkaXN0YW5jZS4KICAgICAgICAgICAgLy8gT3RoZXJzIHNob3VsZCBzdGljayB0byB0aGVpciB6b25lcy9tYXJrcyB1bmxlc3MgdGhlIGJhbGwgZW50ZXJzIHRoZWlyIHBlcnNvbmFsIHNwYWNlLgogICAgICAgICAgICBsZXQgYW1JQ2xvc2VzdCA9IHRydWU7CiAgICAgICAgICAgIGNvbnN0IG15RGlzdFNxID0gZGlzdFRvQmFsbCAqIGRpc3RUb0JhbGw7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAodGhpcy50ZWFtICYmIHRoaXMudGVhbS5wbGF5ZXJzKSB7CiAgICAgICAgICAgICAgICBmb3IoY29uc3QgbWF0ZSBvZiB0aGlzLnRlYW0ucGxheWVycykgewogICAgICAgICAgICAgICAgICAgIGlmIChtYXRlID09PSB0aGlzIHx8ICFtYXRlLm1lc2gpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIC8vIElnbm9yZSBHb2FsaWUgYW5kIGluY2FwYWNpdGF0ZWQgdGVhbW1hdGVzCiAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGUucm9sZSA9PT0gJ0dMJyB8fCBtYXRlLnN0YXR1cy5uYXAgPiAwIHx8IG1hdGUuc3R1blRpbWVyID4gMCkgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gVXNlIHJlYWwgcG9zaXRpb25zIGZvciB0ZWFtbWF0ZSBjb21wYXJpc29uIChBSSBrbm93cyB3aGVyZSB0ZWFtbWF0ZXMgYXJlKQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRTcSA9IG1hdGUubWVzaC5wb3NpdGlvbi5kaXN0YW5jZVRvU3F1YXJlZCh0YXJnZXRQb3MpOwogICAgICAgICAgICAgICAgICAgIGlmIChkU3EgPCBteURpc3RTcSkgewogICAgICAgICAgICAgICAgICAgICAgICBhbUlDbG9zZXN0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gWk9NQklFIEZJWDogSWYgSSBhbSB0aGUgY2xvc2VzdCwgSSBNVVNUIENIQVNFLgogICAgICAgICAgICAvLyBTZXQgcHJlc3NSYW5nZSB0byBlc3NlbnRpYWxseSBpbmZpbml0ZSBpZiBjbG9zZXN0LCBzbyB0aGV5IGRvbid0IGp1c3Qgc3RhbmQgdGhlcmUuCiAgICAgICAgICAgIGlmIChhbUlDbG9zZXN0KSB7CiAgICAgICAgICAgICAgICBwcmVzc1JhbmdlID0gNjAuMDsgLy8gRnVsbCBmaWVsZCBhZ2dyZXNzaW9uCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBJZiBub3QgY2xvc2VzdCwgcmV2ZXJ0IHRvIFpvbmUgRGVmZW5zZSByYW5nZSB0byBwcmV2ZW50IHN3YXJtaW5nCiAgICAgICAgICAgICAgICBwcmVzc1JhbmdlID0gOC4wOyAKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gSWYgYmFsbCBpcyBjbG9zZSBlbm91Z2ggKGJhc2VkIG9uIGNvbnRleHQpLCBQUkVTUyBJVAovLyBJZiBiYWxsIGlzIGNsb3NlIGVub3VnaCAoYmFzZWQgb24gY29udGV4dCksIFBSRVNTIElUCiAgICAgICAgICAgIGlmIChkaXN0VG9CYWxsIDwgcHJlc3NSYW5nZSkgewogICAgICAgICAgICAgICAgX3RhcmdldFBvcy5jb3B5KHRhcmdldFBvcyk7CiAgICAgICAgICAgICAgICB0aGlzLl9hdm9pZEdvYWxDcmVhc2UoX3RhcmdldFBvcyk7CiAgICAgICAgICAgICAgICB0aGlzLl9tb3ZlVG8oX3RhcmdldFBvcyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDIuIE1hcmsgTW9kZSAoTWFuLXRvLU1hbikKICAgICAgICAgICAgLy8gSWYgSSBoYXZlIGEgbWFyayBhc3NpZ25lZCwgc3RpY2sgdG8gdGhlbSB1bmxlc3MgcHJlc3NpbmcgYmFsbAogICAgICAgICAgICBpZiAodGhpcy5tYXJraW5nICYmIHRoaXMubWFya2luZy5tZXNoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBtYXJrUG9zID0gdGhpcy5tYXJraW5nLm1lc2gucG9zaXRpb247CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFBvc2l0aW9uOiBCZXR3ZWVuIG1hcmsgYW5kIG15IGdvYWwgKEdvYWwgU2lkZSkKICAgICAgICAgICAgICAgIGNvbnN0IG15R29hbFogPSAodGhpcy50ZWFtLnNpZGUgPT09IDEpID8gMjggOiAtMjg7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFZlY3RvciBmcm9tIE1hcmsgdG8gR29hbAogICAgICAgICAgICAgICAgY29uc3QgdG9Hb2FsID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgbXlHb2FsWiAtIG1hcmtQb3Mueik7CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0VG9Hb2FsID0gdG9Hb2FsLmxlbmd0aCgpOwogICAgICAgICAgICAgICAgdG9Hb2FsLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBTdGFuZCAzLjUgdW5pdHMgdG93YXJkcyBnb2FsIGZyb20gdGhlIG1hcmsgKEluY3JlYXNlZCBmcm9tIDIuMCB0byBnaXZlIGJyZWF0aGluZyByb29tKQogICAgICAgICAgICAgICAgX3RhcmdldFBvcy5jb3B5KG1hcmtQb3MpLmFkZFNjYWxlZFZlY3Rvcih0b0dvYWwsIDMuNSk7CiAgICAgICAgICAgICAgICAKdGhpcy5fYXZvaWRHb2FsQ3JlYXNlKF90YXJnZXRQb3MpOwogICAgICAgICAgICAgICAgdGhpcy5fbW92ZVRvKF90YXJnZXRQb3MpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAzLiBab25lIERlZmVuc2UgKEZvcm1hdGlvbiArIFNsaWRlKQogICAgICAgICAgICBfdGFyZ2V0UG9zLmNvcHkodGhpcy5ob21lUG9zaXRpb24pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU2xpZGUgbG9naWMgKFNoaWZ0IGZvcm1hdGlvbiB0b3dhcmRzIGJhbGwgc2lkZSkKICAgICAgICAgICAgX3RhcmdldFBvcy56ICs9IGJhbGxQb3MueiAqIDAuNjsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIERlZmVuZGVyIE92ZXJyaWRlOiBBbHdheXMgc3RheSBiZXR3ZWVuIGJhbGwgYW5kIGdvYWwKICAgICAgICAgICAgaWYgKHRoaXMuaXNEZWZlbmRlcikgewogICAgICAgICAgICAgICAgY29uc3QgbXlHb2FsWiA9ICh0aGlzLnRlYW0uc2lkZSA9PT0gMSkgPyAyOCA6IC0yODsKICAgICAgICAgICAgICAgIGNvbnN0IG1pZHBvaW50ID0gKGJhbGxQb3MueiArIG15R29hbFopICogMC41OwogICAgICAgICAgICAgICAgX3RhcmdldFBvcy56ID0gKF90YXJnZXRQb3MueiArIG1pZHBvaW50KSAqIDAuNTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQ2xhbXAKLy8gQ2xhbXAKICAgICAgICAgICAgX3RhcmdldFBvcy56ID0gTWF0aC5tYXgoLTI2LjAsIE1hdGgubWluKDI2LjAsIF90YXJnZXRQb3MueikpOwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5fYXZvaWRHb2FsQ3JlYXNlKF90YXJnZXRQb3MpOwogICAgICAgICAgICB0aGlzLl9tb3ZlVG8oX3RhcmdldFBvcyk7CiAgICAgICAgfQoKX2F2b2lkR29hbENyZWFzZSh0YXJnZXRQb3MpIHsKICAgICAgICAgICAgLy8gMS4gR29hbCBDcmVhc2UgQXZvaWRhbmNlIChSYWRpdXMgMTAgYXJvdW5kIGdvYWxzIGF0ICsvLSAyOCkKICAgICAgICAgICAgLy8gTWF0Y2hlcyBQbGF5ZXIuanMgX2FwcGx5R29hbENyZWFzZSBwaHlzaWNzIHRvIHByZXZlbnQgc3R1dHRlcmluZwogICAgICAgICAgICBjb25zdCBnb2FscyA9IFsKICAgICAgICAgICAgICAgIHsgeDogMCwgejogMjggfSwKICAgICAgICAgICAgICAgIHsgeDogMCwgejogLTI4IH0KICAgICAgICAgICAgXTsKICAgICAgICAgICAgY29uc3QgY3JlYXNlUmFkaXVzID0gMTAuNTsgLy8gU2xpZ2h0bHkgbGFyZ2VyIHRoYW4gcGh5c2ljcyAoMTAuMCkgZm9yIGJ1ZmZlcgoKICAgICAgICAgICAgZ29hbHMuZm9yRWFjaChnb2FsID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGR4ID0gdGFyZ2V0UG9zLnggLSBnb2FsLng7CiAgICAgICAgICAgICAgICBjb25zdCBkeiA9IHRhcmdldFBvcy56IC0gZ29hbC56OwogICAgICAgICAgICAgICAgY29uc3QgZGlzdFNxID0gZHgqZHggKyBkeipkejsKCiAgICAgICAgICAgICAgICBpZiAoZGlzdFNxIDwgY3JlYXNlUmFkaXVzICogY3JlYXNlUmFkaXVzKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gSW5zaWRlIGNyZWFzZSwgcHJvamVjdCB0byBlZGdlCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlzdCA9IE1hdGguc3FydChkaXN0U3EpOwogICAgICAgICAgICAgICAgICAgIGlmIChkaXN0ID4gMC4wMDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmF0aW8gPSBjcmVhc2VSYWRpdXMgLyBkaXN0OwogICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRQb3MueCA9IGdvYWwueCArIGR4ICogcmF0aW87CiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldFBvcy56ID0gZ29hbC56ICsgZHogKiByYXRpbzsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBFeGFjdCBjZW50ZXIsIHB1c2ggb3V0IHRvd2FyZHMgY2VudGVyIGZpZWxkCiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldFBvcy56ID0gZ29hbC56ICsgKGdvYWwueiA+IDAgPyAtY3JlYXNlUmFkaXVzIDogY3JlYXNlUmFkaXVzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gMi4gQXJlbmEgQm91bmRhcnkgQ2xhbXAgKFJhZGl1cyAzMikKICAgICAgICAgICAgY29uc3QgYXJlbmFSYWRpdXMgPSAzMS4wOyAvLyBLZWVwIHNsaWdodGx5IGluc2lkZSB2aXN1YWwvcGh5c2ljcyB3YWxsCiAgICAgICAgICAgIGNvbnN0IGRTcSA9IHRhcmdldFBvcy54KnRhcmdldFBvcy54ICsgdGFyZ2V0UG9zLnoqdGFyZ2V0UG9zLno7CiAgICAgICAgICAgIGlmIChkU3EgPiBhcmVuYVJhZGl1cyphcmVuYVJhZGl1cykgewogICAgICAgICAgICAgICAgY29uc3QgZCA9IE1hdGguc3FydChkU3EpOwogICAgICAgICAgICAgICAgY29uc3QgciA9IGFyZW5hUmFkaXVzIC8gZDsKICAgICAgICAgICAgICAgIHRhcmdldFBvcy54ICo9IHI7CiAgICAgICAgICAgICAgICB0YXJnZXRQb3MueiAqPSByOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBfZmluZEJlc3RQYXNzVGFyZ2V0KCkgewogICAgICAgICAgICBsZXQgYmVzdFRhcmdldCA9IG51bGw7CiAgICAgICAgICAgIGxldCBtYXhTY29yZSA9IC1JbmZpbml0eTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEF0dGFjayBkaXJlY3Rpb24gJiBHb2FsIFoKICAgICAgICAgICAgY29uc3QgYXR0YWNrRGlyID0gKHRoaXMudGVhbS5zaWRlID09PSAxKSA/IC0xIDogMTsgLy8gSG9tZSBhdHRhY2tzIC1aCiAgICAgICAgICAgIGNvbnN0IGdvYWxaID0gKHRoaXMudGVhbS5zaWRlID09PSAxKSA/IC0yOCA6IDI4OwoKICAgICAgICAgICAgZm9yIChjb25zdCBtYXRlIG9mIHRoaXMudGVhbS5wbGF5ZXJzKSB7CiAgICAgICAgICAgICAgICBpZiAobWF0ZSA9PT0gdGhpcykgY29udGludWU7CiAgICAgICAgICAgICAgICBpZiAoIW1hdGUubWVzaCkgY29udGludWU7CiAgICAgICAgICAgICAgICBpZiAobWF0ZS5zdGF0dXMubmFwID4gMCkgY29udGludWU7IC8vIERvbid0IHBhc3MgdG8gc2xlZXBlcnMKICAgICAgICAgICAgICAgIGlmIChtYXRlLnN0dW5UaW1lciA+IDApIGNvbnRpbnVlOyAgLy8gRG9uJ3QgcGFzcyB0byBzdHVubmVkIHBsYXllcnMKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgZGlzdCA9IHRoaXMubWVzaC5wb3NpdGlvbi5kaXN0YW5jZVRvKG1hdGUubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICBpZiAoZGlzdCA8IDQuMCkgY29udGludWU7ICAvLyBUb28gY2xvc2UgKFJlZHVjZWQgZm9yIHRpa2ktdGFrYSkKICAgICAgICAgICAgICAgIGlmIChkaXN0ID4gMzAuMCkgY29udGludWU7IC8vIFRvbyBmYXIgKEluY3JlYXNlZCByYW5nZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gMS4gUmF5Y2FzdCBDaGVjayAoSXMgdGhlIGxhbmUgY2xlYXI/KQogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzUGF0aEJsb2NrZWQobWF0ZS5tZXNoLnBvc2l0aW9uKSkgY29udGludWU7IAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyAyLiBDYWxjdWxhdGUgU3RyYXRlZ2ljIFNjb3JlCiAgICAgICAgICAgICAgICBsZXQgc2NvcmUgPSAwOwoKICAgICAgICAgICAgICAgIC8vIEEuIEZvcndhcmQgUHJvZ3Jlc3MgKFZlcnRpY2FsaXR5KQogICAgICAgICAgICAgICAgY29uc3QgbXlEaXN0VG9Hb2FsID0gTWF0aC5hYnModGhpcy5tZXNoLnBvc2l0aW9uLnogLSBnb2FsWik7CiAgICAgICAgICAgICAgICBjb25zdCBtYXRlRGlzdFRvR29hbCA9IE1hdGguYWJzKG1hdGUubWVzaC5wb3NpdGlvbi56IC0gZ29hbFopOwogICAgICAgICAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBteURpc3RUb0dvYWwgLSBtYXRlRGlzdFRvR29hbDsgLy8gUG9zaXRpdmUgaWYgbW92aW5nIGNsb3NlcgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzY29yZSArPSBwcm9ncmVzcyAqIDEuNTsgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEIuIEdvYWwgUHJveGltaXR5IChBYnNvbHV0ZSkKICAgICAgICAgICAgICAgIGlmIChtYXRlRGlzdFRvR29hbCA8IDE1LjApIHNjb3JlICs9IDEwLjA7CiAgICAgICAgICAgICAgICBpZiAobWF0ZURpc3RUb0dvYWwgPCA4LjApIHNjb3JlICs9IDE1LjA7CgogICAgICAgICAgICAgICAgLy8gQy4gT3Blbm5lc3MgKFNwYWNlIGFyb3VuZCByZWNlaXZlcikKICAgICAgICAgICAgICAgIGNvbnN0IG9wZW5uZXNzID0gdGhpcy5fY2FsY3VsYXRlT3Blbm5lc3MobWF0ZSk7CiAgICAgICAgICAgICAgICBzY29yZSArPSBvcGVubmVzcyAqIDMuMDsgLy8gSGlnaCB3ZWlnaHQgb24gc2FmZXR5CgogICAgICAgICAgICAgICAgLy8gRC4gUm9sZSBCaWFzIChGb3J3YXJkcyBhcmUgcHJpbWUgdGFyZ2V0cykKICAgICAgICAgICAgICAgIGlmIChtYXRlLmlzRm9yd2FyZCkgc2NvcmUgKz0gNS4wOwoKICAgICAgICAgICAgICAgIC8vIEUuIERpc3RhbmNlIFBlbmFsdHkgKExvbmcgcGFzc2VzIGFyZSByaXNreSkKICAgICAgICAgICAgICAgIHNjb3JlIC09IGRpc3QgKiAwLjU7CgogICAgICAgICAgICAgICAgaWYgKHNjb3JlID4gbWF4U2NvcmUpIHsKICAgICAgICAgICAgICAgICAgICBtYXhTY29yZSA9IHNjb3JlOwogICAgICAgICAgICAgICAgICAgIGJlc3RUYXJnZXQgPSBtYXRlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gYmVzdFRhcmdldDsKICAgICAgICB9CgogICAgICAgIF9jYWxjdWxhdGVPcGVubmVzcyhwbGF5ZXIpIHsKICAgICAgICAgICAgbGV0IG1pbkRlZkRpc3QgPSA5OTk7CiAgICAgICAgICAgIGNvbnN0IGdhbWUgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2U7CiAgICAgICAgICAgIGlmICghZ2FtZSkgcmV0dXJuIDA7CiAgICAgICAgICAgIGNvbnN0IG9wcFRlYW0gPSAodGhpcy50ZWFtLmlkID09PSAnaG9tZScpID8gZ2FtZS50ZWFtcy5hd2F5IDogZ2FtZS50ZWFtcy5ob21lOwoKICAgICAgICAgICAgZm9yIChjb25zdCBvcHAgb2Ygb3BwVGVhbS5wbGF5ZXJzKSB7CiAgICAgICAgICAgICAgICBpZiAoIW9wcC5tZXNoIHx8IG9wcC5zdGF0dXMubmFwID4gMCB8fCBvcHAuc3R1blRpbWVyID4gMCkgY29udGludWU7CiAgICAgICAgICAgICAgICBjb25zdCBkID0gcGxheWVyLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyhvcHAubWVzaC5wb3NpdGlvbik7CiAgICAgICAgICAgICAgICBpZiAoZCA8IG1pbkRlZkRpc3QpIG1pbkRlZkRpc3QgPSBkOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBDbGFtcDogQW55dGhpbmcgYmV5b25kIDhtIGlzICJXaWRlIE9wZW4iCiAgICAgICAgICAgIHJldHVybiBNYXRoLm1pbihtaW5EZWZEaXN0LCA4LjApOwogICAgICAgIH0KCiAgICAgICAgX2lzUGF0aEJsb2NrZWQodGFyZ2V0UG9zKSB7CiAgICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy5tZXNoLnBvc2l0aW9uOwogICAgICAgICAgICBjb25zdCBlbmQgPSB0YXJnZXRQb3M7CiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBzdGFydC5kaXN0YW5jZVRvKGVuZCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBQcmVwYXJlIFJheSBEaXJlY3Rpb24KICAgICAgICAgICAgX3NjYW5EaXIuc3ViVmVjdG9ycyhlbmQsIHN0YXJ0KS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGdhbWUgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2U7CiAgICAgICAgICAgIGlmICghZ2FtZSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBjb25zdCBvcHBUZWFtID0gKHRoaXMudGVhbS5pZCA9PT0gJ2hvbWUnKSA/IGdhbWUudGVhbXMuYXdheSA6IGdhbWUudGVhbXMuaG9tZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEludGVyY2VwdGlvbiByYWRpdXMKICAgICAgICAgICAgY29uc3Qgc2FmZXR5UmFkaXVzID0gMi41OyAKCiAgICAgICAgICAgIGZvciAoY29uc3Qgb3BwIG9mIG9wcFRlYW0ucGxheWVycykgewogICAgICAgICAgICAgICAgaWYgKCFvcHAubWVzaCB8fCBvcHAuc3RhdHVzLm5hcCA+IDAgfHwgb3BwLnN0dW5UaW1lciA+IDApIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBWZWN0b3IgZnJvbSBzdGFydCB0byBvcHBvbmVudAogICAgICAgICAgICAgICAgX3NjYW5Ub09wcC5zdWJWZWN0b3JzKG9wcC5tZXNoLnBvc2l0aW9uLCBzdGFydCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFByb2plY3Qgb250byBwYXRoCiAgICAgICAgICAgICAgICBjb25zdCBwcm9qZWN0aW9uID0gX3NjYW5Ub09wcC5kb3QoX3NjYW5EaXIpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiBwcm9qZWN0aW9uIGlzIHdpdGhpbiB0aGUgc2VnbWVudAogICAgICAgICAgICAgICAgaWYgKHByb2plY3Rpb24gPiAwICYmIHByb2plY3Rpb24gPCBkaXN0KSB7CiAgICAgICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHBlcnBlbmRpY3VsYXIgZGlzdGFuY2Ugc3F1YXJlZAogICAgICAgICAgICAgICAgICAgIC8vIGRpc3RTcSA9IHx0b09wcHxeMiAtIHByb2plY3Rpb25eMgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBlcnBEaXN0U3EgPSBfc2NhblRvT3BwLmxlbmd0aFNxKCkgLSAocHJvamVjdGlvbiAqIHByb2plY3Rpb24pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIChwZXJwRGlzdFNxIDwgKHNhZmV0eVJhZGl1cyAqIHNhZmV0eVJhZGl1cykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7IC8vIEJsb2NrZWQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCl9tb3ZlVG8odGFyZ2V0KSB7CiAgICAgICAgICAgIF9haVZlYy5zdWJWZWN0b3JzKHRhcmdldCwgdGhpcy5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgX2FpVmVjLnkgPSAwOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgZGlzdFNxID0gX2FpVmVjLmxlbmd0aFNxKCk7CgogICAgICAgICAgICAvLyBEZWFkem9uZTogSWYgd2l0aGluIDEuMG0gKDEuMCBzcSksIHN0b3AuCiAgICAgICAgICAgIC8vIEluY3JlYXNlZCBmcm9tIDAuMSAoMC4zbSkgdG8gcHJldmVudCBtaWNyby1hZGp1c3RtZW50IHNwaW5uaW5nIGF0IGRlc3RpbmF0aW9uLgogICAgICAgICAgICAvLyBUaGlzIGlzIGNydWNpYWwgd2hlbiB0YXJnZXRzIGFyZSBkeW5hbWljIChlLmcuIHJlbGF0aXZlIHRvIGJhbGwgaG9sZGVyKS4KICAgICAgICAgICAgaWYgKGRpc3RTcSA+IDEuMCkgewogICAgICAgICAgICAgICAgX2FpVmVjLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgdGhpcy5zZXRJbnB1dChfYWlWZWMueCwgX2FpVmVjLnopOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5zZXRJbnB1dCgwLCAwKTsKICAgICAgICAgICAgICAgIC8vIEJyYWtpbmcgZnJpY3Rpb24gdG8gc3RvcCBkcmlmdCBpbW1lZGlhdGVseSB1cG9uIHJlYWNoaW5nIHRhcmdldAogICAgICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS5tdWx0aXBseVNjYWxhcigwLjgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKX2FwcGx5SW50ZXJjZXB0aW9uUHJlc3N1cmUoZHQpIHsKICAgICAgICAgICAgY29uc3QgYmFsbCA9IHRoaXMuYmFsbFJlZjsKICAgICAgICAgICAgaWYgKCFiYWxsIHx8ICFiYWxsLm1lc2gpIHJldHVybjsgLy8gU2FmZXR5IGNoZWNrCgogICAgICAgICAgICAvLyAxLiBCYXNpYyBFbGlnaWJpbGl0eSBDaGVja3MKICAgICAgICAgICAgLy8gTXVzdCBiZSBmcmVlIGFuZCBtb3ZpbmcKICAgICAgICAgICAgaWYgKGJhbGwuc3RhdGUgIT09ICdmcmVlJyB8fCBiYWxsLnZlbG9jaXR5Lmxlbmd0aFNxKCkgPCAxLjApIHJldHVybjsKICAgICAgICAgICAgLy8gQ2Fubm90IGludGVyY2VwdCBpbnZpc2libGUgYmFsbAogICAgICAgICAgICBpZiAoYmFsbC5pc0ludmlzaWJsZSkgcmV0dXJuOwogICAgICAgICAgICAvLyBTa2lwIGlmIHNsZWVwaW5nIG9yIHN0dW5uZWQKICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzLm5hcCA+IDAgfHwgdGhpcy5zdHVuVGltZXIgPiAwKSByZXR1cm47CgogICAgICAgICAgICAvLyAyLiBSYW5nZSBDYWxjdWxhdGlvbiAoVGhlICJGaWVsZCIgUmFkaXVzKQogICAgICAgICAgICBsZXQgcmFuZ2UgPSAyLjA7IC8vIFJlZHVjZWQgZnJvbSAzLjUgdG8gcHJldmVudCAiZm9yY2UgZmllbGQiIGZlZWxpbmcKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFBhc3NpdmUgVGVjaHM6IEJyYXdsZXIgLyBFbGl0ZSBEZWZlbnNlCiAgICAgICAgICAgIGlmICh0aGlzLnRlY2hzLnBhc3NpdmUgPT09ICdicmF3bGVyJyB8fCB0aGlzLnRlY2hzLnBhc3NpdmUgPT09ICdlbGl0ZV9kZWZlbnNlJykgewogICAgICAgICAgICAgICAgcmFuZ2UgKz0gMS41OyAvLyBSZWR1Y2VkIGJvb3N0CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSB0aGlzLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyhiYWxsLm1lc2gucG9zaXRpb24pOwogICAgICAgICAgICBpZiAoZGlzdCA+IHJhbmdlKSByZXR1cm47CgogICAgICAgICAgICAvLyAzLiBEaXJlY3Rpb25hbCBGYWN0b3IgKFRoZSAiQ29uZSIpCiAgICAgICAgICAgIC8vIFZlY3RvciBmcm9tIEJhbGwgdG8gRGVmZW5kZXIKICAgICAgICAgICAgX3NjYW5Ub09wcC5zdWJWZWN0b3JzKHRoaXMubWVzaC5wb3NpdGlvbiwgYmFsbC5tZXNoLnBvc2l0aW9uKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgY29uc3QgYmFsbERpciA9IGJhbGwudmVsb2NpdHkuY2xvbmUoKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgCi8vIERvdCBQcm9kdWN0OiAKICAgICAgICAgICAgLy8gMS4wID0gQmFsbCBoZWFkaW5nIHN0cmFpZ2h0IGZvciBkZWZlbmRlcgogICAgICAgICAgICAvLyAwLjAgPSBQYXNzaW5nIGJ5IHNpZGUgKFBlcnBlbmRpY3VsYXIpCiAgICAgICAgICAgIGNvbnN0IGhlYWRpbmdEb3QgPSBiYWxsRGlyLmRvdChfc2NhblRvT3BwKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIE9ubHkgYXBwbHkgZHJhZyBpZiBiYWxsIGlzIGFwcHJvYWNoaW5nIERJUkVDVExZIChTdHJpY3RlciBjb25lKQogICAgICAgICAgICAvLyBJbmNyZWFzZWQgdGhyZXNob2xkIGZyb20gMC4wIHRvIDAuNyAoTXVzdCBiZSB3aXRoaW4gfjQ1IGRlZ3JlZXMpCiAgICAgICAgICAgIGlmIChoZWFkaW5nRG90IDwgMC43KSByZXR1cm47CiAgICAgICAgICAgIC8vIDQuIENhbGN1bGF0ZSBQcmVzc3VyZSBJbnRlbnNpdHkKICAgICAgICAgICAgLy8gRGlzdGFuY2UgRmFjdG9yOiBDbG9zZXIgPSBTdHJvbmdlciAoTGluZWFyIGZhbGxvZmYpCiAgICAgICAgICAgIGNvbnN0IGRpc3RGYWN0b3IgPSBNYXRoLm1heCgwLCAxLjAgLSAoZGlzdCAvIHJhbmdlKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBBbmdsZSBGYWN0b3I6IERpcmVjdCBoaXQgPSAxLjAsIEdsYW5jaW5nID0gMC40CiAgICAgICAgICAgIGNvbnN0IGFuZ2xlRmFjdG9yID0gTWF0aC5tYXgoMC4zLCBoZWFkaW5nRG90KTsKCiAgICAgICAgICAgIC8vIEJMIFN0YXQKICAgICAgICAgICAgY29uc3QgYmwgPSB0aGlzLmdldFN0YXQoJ0JMJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBUb3RhbCBQcmVzc3VyZSAoUEEvU0ggZHJhaW4gcGVyIHNlY29uZCkKICAgICAgICAgICAgLy8gQmFzZSBtdWx0aXBsaWVyIGZvciBzdGF0cyAoUmVkdWNlZCBmcm9tIDYuMCB0byAzLjApCiAgICAgICAgICAgIGNvbnN0IHByZXNzdXJlTXVsdGlwbGllciA9IDMuMDsgCiAgICAgICAgICAgIGNvbnN0IHByZXNzdXJlID0gYmwgKiBkaXN0RmFjdG9yICogYW5nbGVGYWN0b3IgKiBwcmVzc3VyZU11bHRpcGxpZXIgKiBkdDsKCiAgICAgICAgICAgIC8vIDUuIEFwcGx5IHRvIEJhbGwgU3RhdHMgKFBBL1NIKQogICAgICAgICAgICBpZiAoYmFsbC5wb3dlciA+IDApIHsKICAgICAgICAgICAgICAgIGJhbGwucG93ZXIgLT0gcHJlc3N1cmU7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFZpc3VhbCBGZWVkYmFjayAoQWNjdW11bGF0b3IpCiAgICAgICAgICAgICAgICB0aGlzLl9hY2N1bXVsYXRlZEJsb2NrID0gKHRoaXMuX2FjY3VtdWxhdGVkQmxvY2sgfHwgMCkgKyBwcmVzc3VyZTsKICAgICAgICAgICAgICAgIC8vIFNob3cgZmxvYXRpbmcgdGV4dCBldmVyeSA1IHBvaW50cyBkcmFpbmVkCiAgICAgICAgICAgICAgICBpZiAodGhpcy5fYWNjdW11bGF0ZWRCbG9jayA+PSA1LjApIHsgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsID0gTWF0aC5mbG9vcih0aGlzLl9hY2N1bXVsYXRlZEJsb2NrKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9hY2N1bXVsYXRlZEJsb2NrIC09IHZhbDsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgeyAKICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNwYXduIG9uIGJhbGwsIGF0dGFjaCB0byBiYWxsCiAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKGAtJHt2YWx9YCwgYmFsbC5tZXNoLnBvc2l0aW9uLCAiYmxvY2siLCBiYWxsLm1lc2gpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKLy8gNi4gQXBwbHkgUGh5c2ljYWwgRHJhZyAtIFJFTU9WRUQKICAgICAgICAgICAgLy8gVGhlIGJhbGwgbm93IHBhc3NlcyB0aHJvdWdoIGRlZmVuZGVycyB3aXRob3V0IHNsb3dpbmcgZG93biBwaHlzaWNhbGx5LgogICAgICAgICAgICAvLyBPbmx5IHN0YXRzIChQb3dlcikgYXJlIGRyYWluZWQuCgogICAgICAgICAgICAvLyA3LiBWaXN1YWxzOiBUaGUgIlRldGhlciIgLyBJbnRlcmZlcmVuY2UgRmllbGQKICAgICAgICAgICAgLy8gU3Bhd24gc3BhcmtzIGJldHdlZW4gYmFsbCBhbmQgZGVmZW5kZXIgdG8gc2hvdyB0aGUgZmllbGQgZWZmZWN0CiAgICAgICAgICAgIGlmIChNYXRoLnJhbmRvbSgpIDwgKGRpc3RGYWN0b3IgKiAwLjgpKSB7IAogICAgICAgICAgICAgICAgY29uc3QgbWlkID0gdGhpcy5tZXNoLnBvc2l0aW9uLmNsb25lKCkubGVycChiYWxsLm1lc2gucG9zaXRpb24sIDAuNSArIChNYXRoLnJhbmRvbSgpLTAuNSkqMC4yKTsKICAgICAgICAgICAgICAgIC8vIEppdHRlcgogICAgICAgICAgICAgICAgbWlkLnggKz0gKE1hdGgucmFuZG9tKCktMC41KSAqIDAuNTsKICAgICAgICAgICAgICAgIG1pZC55ICs9IChNYXRoLnJhbmRvbSgpLTAuNSkgKiAwLjU7CiAgICAgICAgICAgICAgICBtaWQueiArPSAoTWF0aC5yYW5kb20oKS0wLjUpICogMC41OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLnNwYXduQ2xhc2gpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2Uuc3Bhd25DbGFzaChtaWQsIDAuNik7IC8vIFNwYXJrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDguIFNob3QgU3RvcCAvIEJsb2NrIExvZ2ljCiAgICAgICAgICAgIGlmIChiYWxsLnBvd2VyIDw9IDAgJiYgYmFsbC5wb3dlclR5cGUgPT09ICdTSCcpIHsKICAgICAgICAgICAgICAgIGJhbGwucG93ZXJUeXBlID0gJ25vbmUnOyAvLyBOZXV0cmFsaXplIHNob3QKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gTk8gREVGTEVDVElPTjogVGhlIGJhbGwgY29udGludWVzIG9uIGl0cyBwYXRoLgogICAgICAgICAgICAgICAgLy8gSXQgaXMgbm93IGEgImRlYWQgYmFsbCIgKG5vIHBvd2VyKSBidXQga2VlcHMgbW92aW5nLgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgeyAKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJCTE9DS0VEIiwgdGhpcy5tZXNoLnBvc2l0aW9uLCAiY29taWMtaW1wYWN0Iik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBObyBpbXBhY3QgZnJlZXplIHRvIGtlZXAgZmxvdyBzbW9vdGgKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gOS4gU3RhdHVzIFJpc2sgKFZlbm9tL05hcC9XaXRoZXIgb24gQmFsbCkKICAgICAgICAgICAgaWYgKGJhbGwudGVjaG5pcXVlICYmICF0aGlzLl90ZWNoQXBwbGllZCkgewogICAgICAgICAgICAgICAgdGhpcy5fdGVjaEFwcGxpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgY29uc3QgdGVjaCA9IGJhbGwudGVjaG5pcXVlOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAodGVjaC50eXBlID09PSAndmVub20nKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBseVN0YXR1cygndmVub20nLCAxNS4wKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGVjaC50eXBlID09PSAnbmFwJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwbHlTdGF0dXMoJ25hcCcsIDguMCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRlY2gudHlwZSA9PT0gJ3dpdGhlcicpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGx5U3RhdHVzKCd3aXRoZXInLCAxNS4wLCAnQkwnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7IHRoaXMuX3RlY2hBcHBsaWVkID0gZmFsc2U7IH0sIDIwMDApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHdpbmRvdy5mbHV4LkFJUGxheWVyID0gQUlQbGF5ZXI7Cn0pKCk7","Team.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCi8vIEZvcm1hdGlvbiBEZWZpbml0aW9ucyAoQ29vcmRpbmF0ZXMgZm9yIFNpZGUgMTogRGVmZW5kcyArWiwgQXR0YWNrcyAtWikKICAgIC8vIFg6IExlZnQoLSkvUmlnaHQoKyksIFo6IEZvcndhcmQoLSkvQmFjaygrKQogICAgY29uc3QgRk9STUFUSU9OUyA9IHsKICAgICAgICAnTm9ybWFsJzogewogICAgICAgICAgICAnR0wnOiB7IHg6IDAsIHo6IDI1IH0sCiAgICAgICAgICAgICdMRCc6IHsgeDogLTgsIHo6IDE1IH0sICdSRCc6IHsgeDogOCwgejogMTUgfSwKICAgICAgICAgICAgJ01GJzogeyB4OiAwLCB6OiA1IH0sCiAgICAgICAgICAgICdMRic6IHsgeDogLTEwLCB6OiAtMTAgfSwgJ1JGJzogeyB4OiAxMCwgejogLTEwIH0KICAgICAgICB9LAogICAgICAgICdDZW50ZXIgQXR0YWNrJzogewogICAgICAgICAgICAnR0wnOiB7IHg6IDAsIHo6IDI1IH0sCiAgICAgICAgICAgICdMRCc6IHsgeDogLTgsIHo6IDE1IH0sICdSRCc6IHsgeDogOCwgejogMTUgfSwKICAgICAgICAgICAgJ01GJzogeyB4OiAwLCB6OiAwIH0sCiAgICAgICAgICAgICdMRic6IHsgeDogLTQsIHo6IC0xNSB9LCAnUkYnOiB7IHg6IDQsIHo6IC0xNSB9CiAgICAgICAgfSwKICAgICAgICAnUmlnaHQgU2lkZSc6IHsKICAgICAgICAgICAgJ0dMJzogeyB4OiAwLCB6OiAyNSB9LAogICAgICAgICAgICAnTEQnOiB7IHg6IDAsIHo6IDE1IH0sICdSRCc6IHsgeDogMTIsIHo6IDE1IH0sCiAgICAgICAgICAgICdNRic6IHsgeDogMTAsIHo6IDUgfSwKICAgICAgICAgICAgJ0xGJzogeyB4OiA1LCB6OiAtMTAgfSwgJ1JGJzogeyB4OiAxNSwgejogLTEwIH0KICAgICAgICB9LAogICAgICAgICdMZWZ0IFNpZGUnOiB7CiAgICAgICAgICAgICdHTCc6IHsgeDogMCwgejogMjUgfSwKICAgICAgICAgICAgJ0xEJzogeyB4OiAtMTIsIHo6IDE1IH0sICdSRCc6IHsgeDogMCwgejogMTUgfSwKICAgICAgICAgICAgJ01GJzogeyB4OiAtMTAsIHo6IDUgfSwKICAgICAgICAgICAgJ0xGJzogeyB4OiAtMTUsIHo6IC0xMCB9LCAnUkYnOiB7IHg6IC01LCB6OiAtMTAgfQogICAgICAgIH0sCiAgICAgICAgJ0FsbC1PdXQgRGVmZW5zZSc6IHsKICAgICAgICAgICAgJ0dMJzogeyB4OiAwLCB6OiAyNSB9LAogICAgICAgICAgICAnTEQnOiB7IHg6IC02LCB6OiAyMCB9LCAnUkQnOiB7IHg6IDYsIHo6IDIwIH0sCiAgICAgICAgICAgICdNRic6IHsgeDogMCwgejogMTAgfSwKICAgICAgICAgICAgJ0xGJzogeyB4OiAtMTAsIHo6IDUgfSwgJ1JGJzogeyB4OiAxMCwgejogNSB9CiAgICAgICAgfSwKICAgICAgICAnRmxhdCBMaW5lJzogewogICAgICAgICAgICAnR0wnOiB7IHg6IDAsIHo6IDI1IH0sCiAgICAgICAgICAgICdMRCc6IHsgeDogLTgsIHo6IDAgfSwgJ1JEJzogeyB4OiA4LCB6OiAwIH0sCiAgICAgICAgICAgICdNRic6IHsgeDogMCwgejogMCB9LAogICAgICAgICAgICAnTEYnOiB7IHg6IC0xNSwgejogMCB9LCAnUkYnOiB7IHg6IDE1LCB6OiAwIH0KICAgICAgICB9LAogICAgICAgICdDb3VudGVyJzogewogICAgICAgICAgICAnR0wnOiB7IHg6IDAsIHo6IDI1IH0sCiAgICAgICAgICAgICdMRCc6IHsgeDogLTgsIHo6IDIwIH0sICdSRCc6IHsgeDogOCwgejogMjAgfSwKICAgICAgICAgICAgJ01GJzogeyB4OiAwLCB6OiAxNSB9LAogICAgICAgICAgICAnTEYnOiB7IHg6IC0xMiwgejogLTIwIH0sICdSRic6IHsgeDogMTIsIHo6IC0yMCB9CiAgICAgICAgfSwKICAgICAgICAnRG91YmxlIFNpZGVzJzogewogICAgICAgICAgICAnR0wnOiB7IHg6IDAsIHo6IDI1IH0sCiAgICAgICAgICAgICdMRCc6IHsgeDogLTE4LCB6OiAxNSB9LCAnUkQnOiB7IHg6IDE4LCB6OiAxNSB9LAogICAgICAgICAgICAnTUYnOiB7IHg6IDAsIHo6IDUgfSwKICAgICAgICAgICAgJ0xGJzogeyB4OiAtMTgsIHo6IC0xMCB9LCAnUkYnOiB7IHg6IDE4LCB6OiAtMTAgfQogICAgICAgIH0KICAgIH07CgoKCiAgICAvLyAtLS0gRW5lbXkgSW5kaWNhdG9yIChSZWQgQXJyb3cgU3ByaXRlKSAtLS0KICAgIC8vIFNoYXJlZCB0ZXh0dXJlL21hdGVyaWFsIHNvIHdlIGRvbid0IGNyZWF0ZSA2IGNhbnZhc2VzLgpjb25zdCBfZW5lbXlBcnJvd1RleHR1cmUgPSAoKCkgPT4gewogICAgICAgIGNvbnN0IGMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgICBjLndpZHRoID0gNjQ7CiAgICAgICAgYy5oZWlnaHQgPSA2NDsKICAgICAgICBjb25zdCBjdHggPSBjLmdldENvbnRleHQoJzJkJyk7CiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBjLndpZHRoLCBjLmhlaWdodCk7CiAgICAgICAgCiAgICAgICAgLy8gQXJyb3cgcG9pbnRpbmcgRE9XTgogICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICBjdHgubW92ZVRvKDYsIDEyKTsgICAKICAgICAgICBjdHgubGluZVRvKDU4LCAxMik7ICAKICAgICAgICBjdHgubGluZVRvKDMyLCA1Mik7ICAKICAgICAgICBjdHguY2xvc2VQYXRoKCk7CiAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjZmYwMDAwJzsKICAgICAgICBjdHguZmlsbCgpOwogICAgICAgIGN0eC5saW5lV2lkdGggPSA0OwogICAgICAgIGN0eC5zdHJva2VTdHlsZSA9ICdyZ2JhKDI1NSwyNTUsMjU1LDAuOTUpJzsKICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgICAgcmV0dXJuIG5ldyBUSFJFRS5DYW52YXNUZXh0dXJlKGMpOwogICAgfSkoKTsKCmNvbnN0IF9wbGF5ZXJBcnJvd1RleHR1cmUgPSAoKCkgPT4gewogICAgICAgIGNvbnN0IGMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgICBjLndpZHRoID0gNjQ7IGMuaGVpZ2h0ID0gNjQ7CiAgICAgICAgY29uc3QgY3R4ID0gYy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgYy53aWR0aCwgYy5oZWlnaHQpOwogICAgICAgIAogICAgICAgIC8vIEFycm93IHBvaW50aW5nIERPV04KICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgY3R4Lm1vdmVUbyg2LCAxMik7ICAgCiAgICAgICAgY3R4LmxpbmVUbyg1OCwgMTIpOyAgCiAgICAgICAgY3R4LmxpbmVUbygzMiwgNTIpOyAgCiAgICAgICAgY3R4LmNsb3NlUGF0aCgpOwogICAgICAgIGN0eC5maWxsU3R5bGUgPSAnIzAwZmYwMCc7IC8vIEdyZWVuCiAgICAgICAgY3R4LmZpbGwoKTsKICAgICAgICBjdHgubGluZVdpZHRoID0gNDsKICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAncmdiYSgyNTUsMjU1LDI1NSwwLjk1KSc7CiAgICAgICAgY3R4LnN0cm9rZSgpOwogICAgICAgIHJldHVybiBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICAgIH0pKCk7CgogICAgY29uc3QgX3RlYW1tYXRlQXJyb3dUZXh0dXJlID0gKCgpID0+IHsKICAgICAgICBjb25zdCBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgYy53aWR0aCA9IDY0OyBjLmhlaWdodCA9IDY0OwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGMud2lkdGgsIGMuaGVpZ2h0KTsKICAgICAgICAKICAgICAgICAvLyBBcnJvdyBwb2ludGluZyBET1dOCiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgIGN0eC5tb3ZlVG8oNiwgMTIpOyAgIAogICAgICAgIGN0eC5saW5lVG8oNTgsIDEyKTsgIAogICAgICAgIGN0eC5saW5lVG8oMzIsIDUyKTsgIAogICAgICAgIGN0eC5jbG9zZVBhdGgoKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gJyNmZmZmZmYnOyAvLyBXaGl0ZQogICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDQ7CiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gJ3JnYmEoMCwwLDAsMC41KSc7CiAgICAgICAgY3R4LnN0cm9rZSgpOwogICAgICAgIHJldHVybiBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICAgIH0pKCk7CgogICAgY29uc3QgX2VuZW15QXJyb3dNYXRlcmlhbCA9IG5ldyBUSFJFRS5TcHJpdGVNYXRlcmlhbCh7IG1hcDogX2VuZW15QXJyb3dUZXh0dXJlLCB0cmFuc3BhcmVudDogdHJ1ZSwgZGVwdGhUZXN0OiBmYWxzZSwgZGVwdGhXcml0ZTogZmFsc2UgfSk7CiAgICBjb25zdCBfcGxheWVyQXJyb3dNYXRlcmlhbCA9IG5ldyBUSFJFRS5TcHJpdGVNYXRlcmlhbCh7IG1hcDogX3BsYXllckFycm93VGV4dHVyZSwgdHJhbnNwYXJlbnQ6IHRydWUsIGRlcHRoVGVzdDogZmFsc2UsIGRlcHRoV3JpdGU6IGZhbHNlIH0pOwogICAgY29uc3QgX3RlYW1tYXRlQXJyb3dNYXRlcmlhbCA9IG5ldyBUSFJFRS5TcHJpdGVNYXRlcmlhbCh7IG1hcDogX3RlYW1tYXRlQXJyb3dUZXh0dXJlLCB0cmFuc3BhcmVudDogdHJ1ZSwgZGVwdGhUZXN0OiBmYWxzZSwgZGVwdGhXcml0ZTogZmFsc2UgfSk7CmNsYXNzIFRlYW0gewogICAgICAgIC8qKgogICAgICAgICAqIEdlbmVyYXRlcyBhbmQgYXBwbGllcyBzdGF0cyB0byBhIHBsYXllciBiYXNlZCBvbiByb2xlIGFuZCBsZXZlbC4KICAgICAgICAgKiBDZW50cmFsaXplcyBiYWxhbmNpbmcgdG8gZW5zdXJlIGhpZ2gtbGV2ZWwgcGxheSBmZWVscyBkaXN0aW5jdC4KICAgICAgICAgKi8KICAgICAgICBzdGF0aWMgZ2VuZXJhdGVTdGF0cyhwbGF5ZXIsIHJvbGUsIGxldmVsID0gMSwgaXNIdW1hbiA9IGZhbHNlKSB7CiAgICAgICAgICAgIC8vIDEuIERlZmluZSBSb2xlIEJhc2VsaW5lcyAoTGV2ZWwgMSkKICAgICAgICAgICAgLy8gQmFsYW5jZWQgdG8gYmUgd2VhayBidXQgZnVuY3Rpb25hbCBhdCBMZXZlbCAxCiAgICAgICAgICAgIGNvbnN0IGJhc2UgPSB7CiAgICAgICAgICAgICAgICBIUDogMTAwLCBTUDogNTUsIEVOOiAxMCwgQVQ6IDUsIFBBOiA1LCBCTDogNSwgU0g6IDUsIENBOiA1CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBSb2xlIFNwZWNpYWxpemF0aW9ucwogICAgICAgICAgICBzd2l0Y2gocm9sZSkgewogICAgICAgICAgICAgICAgY2FzZSAnTEYnOiBjYXNlICdSRic6IC8vIFN0cmlrZXJzCiAgICAgICAgICAgICAgICAgICAgYmFzZS5TSCArPSAxMDsgYmFzZS5TUCArPSA1OyBiYXNlLkVOICs9IDU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdNRic6IC8vIFBsYXltYWtlcnMKICAgICAgICAgICAgICAgICAgICBiYXNlLlBBICs9IDEwOyBiYXNlLkFUICs9IDg7IGJhc2UuRU4gKz0gODsgYmFzZS5TUCArPSAyOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnTEQnOiBjYXNlICdSRCc6IC8vIERlZmVuZGVycwogICAgICAgICAgICAgICAgICAgIGJhc2UuQVQgKz0gMTI7IGJhc2UuQkwgKz0gMTA7IGJhc2UuUEEgKz0gNTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0dMJzogLy8gR29hbGllCiAgICAgICAgICAgICAgICAgICAgYmFzZS5DQSArPSAxMDsgYmFzZS5TUCArPSA1OyBiYXNlLlBBICs9IDE1OyAvLyBTdHJvbmcgYXJtCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDIuIFNjYWxpbmcgRmFjdG9ycyAoUGVyIExldmVsKQogICAgICAgICAgICAvLyBEZXNpZ25lZCBzbyBMZXZlbCA1MCBpcyAiR29kIFRpZXIiIGFuZCBMZXZlbCAxIGlzICJSb29raWUiCiAgICAgICAgICAgIGNvbnN0IGdyb3d0aCA9IHsKICAgICAgICAgICAgICAgIEhQOiAxNSwgICAgLy8gKzE1MDAgSFAgYXQgTHZsIDk5CiAgICAgICAgICAgICAgICBTUDogMC41LCAgIC8vICs1MCBTUCBhdCBMdmwgOTkgKFNwZWVkIGRlbW9uKQogICAgICAgICAgICAgICAgUHJpbWFyeTogMC44LCAvLyArODAgU3RhdCBhdCBMdmwgOTkKICAgICAgICAgICAgICAgIFNlY29uZGFyeTogMC41IC8vICs1MCBTdGF0IGF0IEx2bCA5OQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgLy8gSGVscGVyIHRvIHNjYWxlCiAgICAgICAgICAgIGNvbnN0IHNjYWxlID0gKHZhbCwgcmF0ZSkgPT4gTWF0aC5mbG9vcih2YWwgKyAoKGxldmVsIC0gMSkgKiByYXRlKSk7CgogICAgICAgICAgICAvLyBBcHBseSBTY2FsaW5nCiAgICAgICAgICAgIHBsYXllci5zdGF0cy5IUCA9IHNjYWxlKGJhc2UuSFAsIGdyb3d0aC5IUCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTUDogQ2FwIGF0IDk5LCBidXQgZW5zdXJlIGhpZ2ggbGV2ZWxzIGZlZWwgRkFTVAogICAgICAgICAgICBwbGF5ZXIuc3RhdHMuU1AgPSBNYXRoLm1pbig5OSwgc2NhbGUoYmFzZS5TUCwgZ3Jvd3RoLlNQKSk7CgogICAgICAgICAgICAvLyBTdGF0IGRpc3RyaWJ1dGlvbiBiYXNlZCBvbiByb2xlIHByaW9yaXRpZXMKICAgICAgICAgICAgaWYgKFsnTEYnLCAnUkYnXS5pbmNsdWRlcyhyb2xlKSkgewogICAgICAgICAgICAgICAgcGxheWVyLnN0YXRzLlNIID0gTWF0aC5taW4oOTksIHNjYWxlKGJhc2UuU0gsIGdyb3d0aC5QcmltYXJ5KSk7CiAgICAgICAgICAgICAgICBwbGF5ZXIuc3RhdHMuRU4gPSBNYXRoLm1pbig5OSwgc2NhbGUoYmFzZS5FTiwgZ3Jvd3RoLlByaW1hcnkpKTsKICAgICAgICAgICAgICAgIHBsYXllci5zdGF0cy5BVCA9IE1hdGgubWluKDk5LCBzY2FsZShiYXNlLkFULCBncm93dGguU2Vjb25kYXJ5KSk7CiAgICAgICAgICAgICAgICBwbGF5ZXIuc3RhdHMuUEEgPSBNYXRoLm1pbig5OSwgc2NhbGUoYmFzZS5QQSwgZ3Jvd3RoLlNlY29uZGFyeSkpOwogICAgICAgICAgICAgICAgcGxheWVyLnN0YXRzLkJMID0gTWF0aC5taW4oOTksIHNjYWxlKGJhc2UuQkwsIGdyb3d0aC5TZWNvbmRhcnkpKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyb2xlID09PSAnTUYnKSB7CiAgICAgICAgICAgICAgICBwbGF5ZXIuc3RhdHMuUEEgPSBNYXRoLm1pbig5OSwgc2NhbGUoYmFzZS5QQSwgZ3Jvd3RoLlByaW1hcnkpKTsKICAgICAgICAgICAgICAgIHBsYXllci5zdGF0cy5BVCA9IE1hdGgubWluKDk5LCBzY2FsZShiYXNlLkFULCBncm93dGguUHJpbWFyeSkpOwogICAgICAgICAgICAgICAgcGxheWVyLnN0YXRzLkVOID0gTWF0aC5taW4oOTksIHNjYWxlKGJhc2UuRU4sIGdyb3d0aC5QcmltYXJ5KSk7CiAgICAgICAgICAgICAgICBwbGF5ZXIuc3RhdHMuU0ggPSBNYXRoLm1pbig5OSwgc2NhbGUoYmFzZS5TSCwgZ3Jvd3RoLlNlY29uZGFyeSkpOwogICAgICAgICAgICAgICAgcGxheWVyLnN0YXRzLkJMID0gTWF0aC5taW4oOTksIHNjYWxlKGJhc2UuQkwsIGdyb3d0aC5TZWNvbmRhcnkpKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChbJ0xEJywgJ1JEJ10uaW5jbHVkZXMocm9sZSkpIHsKICAgICAgICAgICAgICAgIHBsYXllci5zdGF0cy5BVCA9IE1hdGgubWluKDk5LCBzY2FsZShiYXNlLkFULCBncm93dGguUHJpbWFyeSkpOwogICAgICAgICAgICAgICAgcGxheWVyLnN0YXRzLkJMID0gTWF0aC5taW4oOTksIHNjYWxlKGJhc2UuQkwsIGdyb3d0aC5QcmltYXJ5KSk7CiAgICAgICAgICAgICAgICBwbGF5ZXIuc3RhdHMuUEEgPSBNYXRoLm1pbig5OSwgc2NhbGUoYmFzZS5QQSwgZ3Jvd3RoLlNlY29uZGFyeSkpOwogICAgICAgICAgICAgICAgcGxheWVyLnN0YXRzLkVOID0gTWF0aC5taW4oOTksIHNjYWxlKGJhc2UuRU4sIGdyb3d0aC5TZWNvbmRhcnkpKTsKICAgICAgICAgICAgICAgIHBsYXllci5zdGF0cy5TSCA9IE1hdGgubWluKDk5LCBzY2FsZShiYXNlLlNILCAwLjIpKTsgLy8gRGVmZW5kZXJzIGJhZCBhdCBzaG9vdGluZwogICAgICAgICAgICB9IGVsc2UgaWYgKHJvbGUgPT09ICdHTCcpIHsKICAgICAgICAgICAgICAgIHBsYXllci5zdGF0cy5DQSA9IE1hdGgubWluKDk5LCBzY2FsZShiYXNlLkNBLCBncm93dGguUHJpbWFyeSkpOwogICAgICAgICAgICAgICAgcGxheWVyLnN0YXRzLlBBID0gTWF0aC5taW4oOTksIHNjYWxlKGJhc2UuUEEsIGdyb3d0aC5TZWNvbmRhcnkpKTsKICAgICAgICAgICAgICAgIHBsYXllci5zdGF0cy5TSCA9IE1hdGgubWluKDk5LCBzY2FsZShiYXNlLlNILCAwLjMpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMy4gSHVtYW4gUGxheWVyIEJvbnVzIChUaGUgIkhlcm8iIEZlZWwpCiAgICAgICAgICAgIC8vIEdpdmVzIHRoZSBwbGF5ZXIgYSBzbGlnaHQgZWRnZSB0byBtYWtlIGdhbWVwbGF5IGZlZWwgcHVuY2h5CiAgICAgICAgICAgIGlmIChpc0h1bWFuKSB7CiAgICAgICAgICAgICAgICBwbGF5ZXIuc3RhdHMuSFAgKz0gMTUwOyAvLyBUYW5raWVyCiAgICAgICAgICAgICAgICBwbGF5ZXIuc3RhdHMuU1AgKz0gNTsgICAvLyBGYXN0ZXIKICAgICAgICAgICAgICAgIHBsYXllci5zdGF0cy5FTiArPSA1OyAgIC8vIEhhcmRlciB0byB0YWNrbGUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gS2V5IFN0YXQgQm9vc3QKICAgICAgICAgICAgICAgIGlmIChyb2xlID09PSAnTEYnIHx8IHJvbGUgPT09ICdSRicpIHBsYXllci5zdGF0cy5TSCArPSA1OwogICAgICAgICAgICAgICAgaWYgKHJvbGUgPT09ICdNRicpIHBsYXllci5zdGF0cy5QQSArPSA1OwogICAgICAgICAgICAgICAgaWYgKHJvbGUgPT09ICdMRCcgfHwgcm9sZSA9PT0gJ1JEJykgcGxheWVyLnN0YXRzLkFUICs9IDU7CiAgICAgICAgICAgICAgICBpZiAocm9sZSA9PT0gJ0dMJykgcGxheWVyLnN0YXRzLkNBICs9IDU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDQuIEZpbmFsaXplCiAgICAgICAgICAgIHBsYXllci5zdGF0cy5tYXhIUCA9IHBsYXllci5zdGF0cy5IUDsKICAgICAgICAgICAgcGxheWVyLmxldmVsID0gbGV2ZWw7CiAgICAgICAgICAgIHBsYXllci5fdXBkYXRlRGVyaXZlZFN0YXRzKCk7CiAgICAgICAgfQoKY29uc3RydWN0b3Ioc2NlbmUsIGlkLCBzaWRlLCBjb2xvciwgaXNIdW1hbikgewogICAgICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7CiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDsgLy8gJ2hvbWUnIG9yICdhd2F5JwogICAgICAgICAgICB0aGlzLnNpZGUgPSBzaWRlOyAvLyAxIChEZWZlbmRzICtaKSBvciAtMSAoRGVmZW5kcyAtWikKICAgICAgICAgICAgdGhpcy5jb2xvciA9IGNvbG9yOwogICAgICAgICAgICB0aGlzLmlzSHVtYW4gPSBpc0h1bWFuOwogICAgICAgICAgICB0aGlzLmFpRW5hYmxlZCA9IHRydWU7IC8vIE1hc3RlciBzd2l0Y2ggZm9yIEFJIGxvZ2ljCiAgICAgICAgICAgIAogICAgICAgICAgICB0aGlzLnBsYXllcnMgPSBbXTsKICAgICAgICAgICAgdGhpcy5hY3RpdmVQbGF5ZXIgPSBudWxsOyAvLyBUaGUgcGxheWVyIGN1cnJlbnRseSBjb250cm9sbGVkL2ZvY3VzZWQKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEZvcm1hdGlvbiBBbmNob3JzCiAgICAgICAgICAgIHRoaXMuY3VycmVudEZvcm1hdGlvbiA9ICdOb3JtYWwnOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gUGxheWVyIEluZGljYXRvciAoR3JlZW4gQXJyb3cpCiAgICAgICAgICAgIGlmICh0aGlzLmlzSHVtYW4pIHsKICAgICAgICAgICAgICAgIHRoaXMucGxheWVyQXJyb3cgPSBuZXcgVEhSRUUuU3ByaXRlKF9wbGF5ZXJBcnJvd01hdGVyaWFsKTsKICAgICAgICAgICAgICAgIHRoaXMucGxheWVyQXJyb3cuc2NhbGUuc2V0KDAuOCwgMC44LCAxLjApOwogICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXJBcnJvdy5yZW5kZXJPcmRlciA9IDEwMDA7IC8vIE9uIHRvcAogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBhc3NpZ25NYXJrcyhvcHBvc2luZ1RlYW0pIHsKICAgICAgICAgICAgLy8gU2ltcGxlIGF1dG8tYXNzaWduIGxvZ2ljOiBNYXJrIHRoZSBwbGF5ZXIgaW4gdGhlICJtYXRjaGluZyIgcG9zaXRpb24KICAgICAgICAgICAgLy8gTEY8LT5SRCwgUkY8LT5MRCwgTUY8LT5NRiwgTEQ8LT5SRiwgUkQ8LT5MRiwgR0w8LT5MRgogICAgICAgICAgICB0aGlzLnBsYXllcnMuZm9yRWFjaChwID0+IHsKICAgICAgICAgICAgICAgIGxldCB0YXJnZXRSb2xlID0gJ01GJzsKICAgICAgICAgICAgICAgIHN3aXRjaCAocC5yb2xlKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnTEYnOiB0YXJnZXRSb2xlID0gJ1JEJzsgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnUkYnOiB0YXJnZXRSb2xlID0gJ0xEJzsgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnTUYnOiB0YXJnZXRSb2xlID0gJ01GJzsgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnTEQnOiB0YXJnZXRSb2xlID0gJ1JGJzsgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnUkQnOiB0YXJnZXRSb2xlID0gJ0xGJzsgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnR0wnOiB0YXJnZXRSb2xlID0gJ0xGJzsgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gb3Bwb3NpbmdUZWFtLnBsYXllcnMuZmluZChvcCA9PiBvcC5yb2xlID09PSB0YXJnZXRSb2xlKTsKICAgICAgICAgICAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICAgICAgICAgICAgICBwLm1hcmtpbmcgPSB0YXJnZXQ7CiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coYCR7dGhpcy5pZH0gJHtwLnJvbGV9IG1hcmtlZCAke3RhcmdldC5yb2xlfWApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGFkZFBsYXllcihwbGF5ZXIpIHsKICAgICAgICAgICAgdGhpcy5wbGF5ZXJzLnB1c2gocGxheWVyKTsKICAgICAgICAgICAgcGxheWVyLnRlYW0gPSB0aGlzOwoKICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIEhvbWUgUG9zaXRpb24gYmFzZWQgb24gRm9ybWF0aW9uCiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVBsYXllckhvbWVQb3NpdGlvbihwbGF5ZXIpOwoKICAgICAgICAgICAgLy8gRW5lbXkgaW5kaWNhdG9yOiByZWQgYXJyb3dzIG92ZXIgdGhlIEF3YXkgdGVhbSAoc28gZW5lbWllcyBhcmUgcmVhZGFibGUpCi8vIEVuZW15IGluZGljYXRvcjogcmVkIGFycm93cyBvdmVyIHRoZSBBd2F5IHRlYW0KICAgICAgICAgICAgaWYgKHRoaXMuaWQgPT09ICdhd2F5JyAmJiBwbGF5ZXIubWVzaCkgewogICAgICAgICAgICAgICAgY29uc3QgYXJyb3cgPSBuZXcgVEhSRUUuU3ByaXRlKF9lbmVteUFycm93TWF0ZXJpYWwpOwogICAgICAgICAgICAgICAgYXJyb3cuc2NhbGUuc2V0KDAuOCwgMC44LCAxLjApOwogICAgICAgICAgICAgICAgYXJyb3cucG9zaXRpb24uc2V0KDAsIDMuMiwgMCk7IC8vIGFib3ZlIGhlYWQKICAgICAgICAgICAgICAgIGFycm93LnJlbmRlck9yZGVyID0gOTk5OwogICAgICAgICAgICAgICAgcGxheWVyLm1lc2guYWRkKGFycm93KTsKICAgICAgICAgICAgICAgIHBsYXllci5lbmVteUFycm93ID0gYXJyb3c7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFRlYW1tYXRlIGluZGljYXRvcjogV2hpdGUgYXJyb3dzIGZvciBpbmFjdGl2ZSBodW1hbnMKICAgICAgICAgICAgaWYgKHRoaXMuaXNIdW1hbiAmJiBwbGF5ZXIubWVzaCkgewogICAgICAgICAgICAgICAgY29uc3QgYXJyb3cgPSBuZXcgVEhSRUUuU3ByaXRlKF90ZWFtbWF0ZUFycm93TWF0ZXJpYWwpOwogICAgICAgICAgICAgICAgYXJyb3cuc2NhbGUuc2V0KDAuNiwgMC42LCAxLjApOwogICAgICAgICAgICAgICAgYXJyb3cucG9zaXRpb24uc2V0KDAsIDMuMiwgMCk7CiAgICAgICAgICAgICAgICBhcnJvdy5yZW5kZXJPcmRlciA9IDk5OTsKICAgICAgICAgICAgICAgIGFycm93LnZpc2libGUgPSBmYWxzZTsgLy8gSGlkZGVuIGJ5IGRlZmF1bHQsIG1hbmFnZWQgYnkgc2V0QWN0aXZlUGxheWVyCiAgICAgICAgICAgICAgICBwbGF5ZXIubWVzaC5hZGQoYXJyb3cpOwogICAgICAgICAgICAgICAgcGxheWVyLnRlYW1tYXRlQXJyb3cgPSBhcnJvdzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgc2V0Rm9ybWF0aW9uKG5hbWUpIHsKICAgICAgICAgICAgaWYgKCFGT1JNQVRJT05TW25hbWVdKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuY3VycmVudEZvcm1hdGlvbiA9IG5hbWU7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGBUZWFtICR7dGhpcy5pZH0gc3dpdGNoZWQgdG8gJHtuYW1lfWApOwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5wbGF5ZXJzLmZvckVhY2gocCA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVQbGF5ZXJIb21lUG9zaXRpb24ocCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCl91cGRhdGVQbGF5ZXJIb21lUG9zaXRpb24ocGxheWVyKSB7CiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBGT1JNQVRJT05TW3RoaXMuY3VycmVudEZvcm1hdGlvbl07CiAgICAgICAgICAgIGlmICghZGF0YSkgcmV0dXJuOwoKICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gZGF0YVtwbGF5ZXIucm9sZV07CiAgICAgICAgICAgIGlmIChvZmZzZXQpIHsKICAgICAgICAgICAgICAgIC8vIFggUG9zaXRpb246CiAgICAgICAgICAgICAgICAvLyBGb3JtYXRpb25zOiAtWCBpcyBMZWZ0LCArWCBpcyBSaWdodC4KICAgICAgICAgICAgICAgIC8vIEhvbWUgVGVhbSAoU2lkZSAxKSBmYWNlcyAtWi4gTGVmdCBpcyAtWC4gVXNlIG9mZnNldC54IGFzIGlzLgogICAgICAgICAgICAgICAgbGV0IHhQb3MgPSBvZmZzZXQueDsKICAgICAgICAgICAgICAgIGxldCB6UG9zID0gb2Zmc2V0LnogKiB0aGlzLnNpZGU7CgogICAgICAgICAgICAgICAgcGxheWVyLmhvbWVQb3NpdGlvbi5zZXQoeFBvcywgMCwgelBvcyk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEF3YXkgVGVhbSAoU2lkZSAtMSkgZmFjZXMgK1ouIExlZnQgaXMgK1guIEZsaXAgWC4KICAgICAgICAgICAgICAgIGlmICh0aGlzLnNpZGUgPT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgcGxheWVyLmhvbWVQb3NpdGlvbi54ICo9IC0xOyAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU2V0IGluaXRpYWwgcG9zaXRpb24KICAgICAgICAgICAgaWYgKHBsYXllci5tZXNoKSB7CiAgICAgICAgICAgICAgICBwbGF5ZXIubWVzaC5wb3NpdGlvbi5jb3B5KHBsYXllci5ob21lUG9zaXRpb24pOwogICAgICAgICAgICAgICAgLy8gRmFjZSBjZW50ZXIgKDAsMCwwKQogICAgICAgICAgICAgICAgcGxheWVyLm1lc2gubG9va0F0KDAsIDAsIDApOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB1cGRhdGUoZHQpIHsKICAgICAgICAgICAgLy8gVXBkYXRlIGFsbCBwbGF5ZXJzCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbGF5ZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICB0aGlzLnBsYXllcnNbaV0udXBkYXRlKGR0KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQXV0by1zd2l0Y2ggYWN0aXZlIHBsYXllciBpZiBIdW1hbgogICAgICAgICAgICBpZiAodGhpcy5pc0h1bWFuKSB7CiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUFjdGl2ZVBsYXllclNlbGVjdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB1cGRhdGVBY3RpdmVQbGF5ZXJTZWxlY3Rpb24oKSB7CiAgICAgICAgICAgIGNvbnN0IGJhbGwgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZW50aXRpZXMuYmFsbDsKICAgICAgICAgICAgaWYgKCFiYWxsKSByZXR1cm47CgogICAgICAgICAgICAvLyAxLiBPRkZFTlNFOiBJZiB3ZSBoYXZlIHRoZSBiYWxsLCBhY3RpdmUgcGxheWVyIGlzIHRoZSBob2xkZXIKICAgICAgICAgICAgaWYgKGJhbGwuaG9sZGVyICYmIGJhbGwuaG9sZGVyLnRlYW0gPT09IHRoaXMpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZVBsYXllciAhPT0gYmFsbC5ob2xkZXIpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFjdGl2ZVBsYXllcihiYWxsLmhvbGRlcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDIuIERFRkVOU0U6IFNlbGVjdCBjbG9zZXN0IHRvIGJhbGwKICAgICAgICAgICAgLy8gT3B0aW1pemF0aW9uOiBPbmx5IGNoZWNrIGV2ZXJ5IGZldyBmcmFtZXMgb3IgaWYgZGlzdGFuY2UgaXMgc2lnbmlmaWNhbnQKICAgICAgICAgICAgbGV0IGNsb3Nlc3QgPSBudWxsOwogICAgICAgICAgICBsZXQgbWluRHN0ID0gSW5maW5pdHk7CgogICAgICAgICAgICBmb3IgKGNvbnN0IHAgb2YgdGhpcy5wbGF5ZXJzKSB7CiAgICAgICAgICAgICAgICBpZiAocC5yb2xlID09PSAnR0wnKSBjb250aW51ZTsgLy8gRG9uJ3QgYXV0by1zd2l0Y2ggdG8gZ29hbGllIHVzdWFsbHkKICAgICAgICAgICAgICAgIGlmICghcC5tZXNoKSBjb250aW51ZTsKCiAgICAgICAgICAgICAgICBjb25zdCBkID0gcC5tZXNoLnBvc2l0aW9uLmRpc3RhbmNlVG8oYmFsbC5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgIGlmIChkIDwgbWluRHN0KSB7CiAgICAgICAgICAgICAgICAgICAgbWluRHN0ID0gZDsKICAgICAgICAgICAgICAgICAgICBjbG9zZXN0ID0gcDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGNsb3Nlc3QgJiYgY2xvc2VzdCAhPT0gdGhpcy5hY3RpdmVQbGF5ZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlUGxheWVyKGNsb3Nlc3QpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKc2V0QWN0aXZlUGxheWVyKHBsYXllcikgewogICAgICAgICAgICAvLyBSZXNldCBpbnB1dCBvbiBwcmV2aW91cwogICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVQbGF5ZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlUGxheWVyLnNldElucHV0KDAsIDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuYWN0aXZlUGxheWVyID0gcGxheWVyOwoKICAgICAgICAgICAgLy8gVmlzdWFsIEluZGljYXRvcnMKICAgICAgICAgICAgaWYgKHRoaXMuaXNIdW1hbikgewogICAgICAgICAgICAgICAgLy8gMS4gR3JlZW4gQXJyb3cgZm9yIEFjdGl2ZQogICAgICAgICAgICAgICAgaWYgKHRoaXMucGxheWVyQXJyb3cgJiYgcGxheWVyLm1lc2gpIHsKICAgICAgICAgICAgICAgICAgICBwbGF5ZXIubWVzaC5hZGQodGhpcy5wbGF5ZXJBcnJvdyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXJBcnJvdy5wb3NpdGlvbi5zZXQoMCwgMy41LCAwKTsgLy8gRmxvYXQgYWJvdmUgaGVhZAogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIDIuIFdoaXRlIEFycm93cyBmb3IgT3RoZXJzCiAgICAgICAgICAgICAgICB0aGlzLnBsYXllcnMuZm9yRWFjaChwID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAocC50ZWFtbWF0ZUFycm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHAudGVhbW1hdGVBcnJvdy52aXNpYmxlID0gKHAgIT09IHBsYXllcik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgpyZXNldFBvc2l0aW9ucygpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBwIG9mIHRoaXMucGxheWVycykgewogICAgICAgICAgICAgICAgaWYgKHAubWVzaCkgewogICAgICAgICAgICAgICAgICAgIHAubWVzaC5wb3NpdGlvbi5jb3B5KHAuaG9tZVBvc2l0aW9uKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBSZXNldCBQaHlzaWNzCiAgICAgICAgICAgICAgICAgICAgcC52ZWxvY2l0eS5zZXQoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgcC5pbnB1dFZlY3Rvci5zZXQoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgcC5pc0Rhc2hpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBwLmlzVGhyb3dpbmcgPSBmYWxzZTsKcC5sb3NlQmFsbCgpOyAvLyBEcm9wIGJhbGwgaWYgaG9sZGluZwogICAgICAgICAgICAgICAgICAgIHAuY2FuQ2F0Y2ggPSB0cnVlOyAvLyBGb3JjZSByZXNldCBjYXBhYmlsaXR5CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gUmVzZXQgU3RhdHMKICAgICAgICAgICAgICAgICAgICBwLmN1cnJlbnRFTiA9IHAuc3RhdHMuRU47CiAgICAgICAgICAgICAgICAgICAgCi8vIE9yaWVudGF0aW9uOiBGYWNlIENlbnRlcgogICAgICAgICAgICAgICAgICAgIHAubWVzaC5sb29rQXQoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHAuc3luY1JvdGF0aW9uKSBwLnN5bmNSb3RhdGlvbigpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFJlc2V0IEFuaW1hdGlvbgogICAgICAgICAgICAgICAgICAgIHAucGxheSgnaWRsZScsIDAuMSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gUmVzZXQgYWN0aXZlIHBsYXllciB0byBNRgogICAgICAgICAgICBjb25zdCBtZiA9IHRoaXMucGxheWVycy5maW5kKHAgPT4gcC5yb2xlID09PSAnTUYnKTsKICAgICAgICAgICAgaWYgKG1mKSB0aGlzLnNldEFjdGl2ZVBsYXllcihtZik7CiAgICAgICAgfQogICAgfQoKICAgIHdpbmRvdy5mbHV4LlRlYW0gPSBUZWFtOwp9KSgpOw==","./Team.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCi8vIEZvcm1hdGlvbiBEZWZpbml0aW9ucyAoQ29vcmRpbmF0ZXMgZm9yIFNpZGUgMTogRGVmZW5kcyArWiwgQXR0YWNrcyAtWikKICAgIC8vIFg6IExlZnQoLSkvUmlnaHQoKyksIFo6IEZvcndhcmQoLSkvQmFjaygrKQogICAgY29uc3QgRk9STUFUSU9OUyA9IHsKICAgICAgICAnTm9ybWFsJzogewogICAgICAgICAgICAnR0wnOiB7IHg6IDAsIHo6IDI1IH0sCiAgICAgICAgICAgICdMRCc6IHsgeDogLTgsIHo6IDE1IH0sICdSRCc6IHsgeDogOCwgejogMTUgfSwKICAgICAgICAgICAgJ01GJzogeyB4OiAwLCB6OiA1IH0sCiAgICAgICAgICAgICdMRic6IHsgeDogLTEwLCB6OiAtMTAgfSwgJ1JGJzogeyB4OiAxMCwgejogLTEwIH0KICAgICAgICB9LAogICAgICAgICdDZW50ZXIgQXR0YWNrJzogewogICAgICAgICAgICAnR0wnOiB7IHg6IDAsIHo6IDI1IH0sCiAgICAgICAgICAgICdMRCc6IHsgeDogLTgsIHo6IDE1IH0sICdSRCc6IHsgeDogOCwgejogMTUgfSwKICAgICAgICAgICAgJ01GJzogeyB4OiAwLCB6OiAwIH0sCiAgICAgICAgICAgICdMRic6IHsgeDogLTQsIHo6IC0xNSB9LCAnUkYnOiB7IHg6IDQsIHo6IC0xNSB9CiAgICAgICAgfSwKICAgICAgICAnUmlnaHQgU2lkZSc6IHsKICAgICAgICAgICAgJ0dMJzogeyB4OiAwLCB6OiAyNSB9LAogICAgICAgICAgICAnTEQnOiB7IHg6IDAsIHo6IDE1IH0sICdSRCc6IHsgeDogMTIsIHo6IDE1IH0sCiAgICAgICAgICAgICdNRic6IHsgeDogMTAsIHo6IDUgfSwKICAgICAgICAgICAgJ0xGJzogeyB4OiA1LCB6OiAtMTAgfSwgJ1JGJzogeyB4OiAxNSwgejogLTEwIH0KICAgICAgICB9LAogICAgICAgICdMZWZ0IFNpZGUnOiB7CiAgICAgICAgICAgICdHTCc6IHsgeDogMCwgejogMjUgfSwKICAgICAgICAgICAgJ0xEJzogeyB4OiAtMTIsIHo6IDE1IH0sICdSRCc6IHsgeDogMCwgejogMTUgfSwKICAgICAgICAgICAgJ01GJzogeyB4OiAtMTAsIHo6IDUgfSwKICAgICAgICAgICAgJ0xGJzogeyB4OiAtMTUsIHo6IC0xMCB9LCAnUkYnOiB7IHg6IC01LCB6OiAtMTAgfQogICAgICAgIH0sCiAgICAgICAgJ0FsbC1PdXQgRGVmZW5zZSc6IHsKICAgICAgICAgICAgJ0dMJzogeyB4OiAwLCB6OiAyNSB9LAogICAgICAgICAgICAnTEQnOiB7IHg6IC02LCB6OiAyMCB9LCAnUkQnOiB7IHg6IDYsIHo6IDIwIH0sCiAgICAgICAgICAgICdNRic6IHsgeDogMCwgejogMTAgfSwKICAgICAgICAgICAgJ0xGJzogeyB4OiAtMTAsIHo6IDUgfSwgJ1JGJzogeyB4OiAxMCwgejogNSB9CiAgICAgICAgfSwKICAgICAgICAnRmxhdCBMaW5lJzogewogICAgICAgICAgICAnR0wnOiB7IHg6IDAsIHo6IDI1IH0sCiAgICAgICAgICAgICdMRCc6IHsgeDogLTgsIHo6IDAgfSwgJ1JEJzogeyB4OiA4LCB6OiAwIH0sCiAgICAgICAgICAgICdNRic6IHsgeDogMCwgejogMCB9LAogICAgICAgICAgICAnTEYnOiB7IHg6IC0xNSwgejogMCB9LCAnUkYnOiB7IHg6IDE1LCB6OiAwIH0KICAgICAgICB9LAogICAgICAgICdDb3VudGVyJzogewogICAgICAgICAgICAnR0wnOiB7IHg6IDAsIHo6IDI1IH0sCiAgICAgICAgICAgICdMRCc6IHsgeDogLTgsIHo6IDIwIH0sICdSRCc6IHsgeDogOCwgejogMjAgfSwKICAgICAgICAgICAgJ01GJzogeyB4OiAwLCB6OiAxNSB9LAogICAgICAgICAgICAnTEYnOiB7IHg6IC0xMiwgejogLTIwIH0sICdSRic6IHsgeDogMTIsIHo6IC0yMCB9CiAgICAgICAgfSwKICAgICAgICAnRG91YmxlIFNpZGVzJzogewogICAgICAgICAgICAnR0wnOiB7IHg6IDAsIHo6IDI1IH0sCiAgICAgICAgICAgICdMRCc6IHsgeDogLTE4LCB6OiAxNSB9LCAnUkQnOiB7IHg6IDE4LCB6OiAxNSB9LAogICAgICAgICAgICAnTUYnOiB7IHg6IDAsIHo6IDUgfSwKICAgICAgICAgICAgJ0xGJzogeyB4OiAtMTgsIHo6IC0xMCB9LCAnUkYnOiB7IHg6IDE4LCB6OiAtMTAgfQogICAgICAgIH0KICAgIH07CgoKCiAgICAvLyAtLS0gRW5lbXkgSW5kaWNhdG9yIChSZWQgQXJyb3cgU3ByaXRlKSAtLS0KICAgIC8vIFNoYXJlZCB0ZXh0dXJlL21hdGVyaWFsIHNvIHdlIGRvbid0IGNyZWF0ZSA2IGNhbnZhc2VzLgpjb25zdCBfZW5lbXlBcnJvd1RleHR1cmUgPSAoKCkgPT4gewogICAgICAgIGNvbnN0IGMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgICBjLndpZHRoID0gNjQ7CiAgICAgICAgYy5oZWlnaHQgPSA2NDsKICAgICAgICBjb25zdCBjdHggPSBjLmdldENvbnRleHQoJzJkJyk7CiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBjLndpZHRoLCBjLmhlaWdodCk7CiAgICAgICAgCiAgICAgICAgLy8gQXJyb3cgcG9pbnRpbmcgRE9XTgogICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICBjdHgubW92ZVRvKDYsIDEyKTsgICAKICAgICAgICBjdHgubGluZVRvKDU4LCAxMik7ICAKICAgICAgICBjdHgubGluZVRvKDMyLCA1Mik7ICAKICAgICAgICBjdHguY2xvc2VQYXRoKCk7CiAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjZmYwMDAwJzsKICAgICAgICBjdHguZmlsbCgpOwogICAgICAgIGN0eC5saW5lV2lkdGggPSA0OwogICAgICAgIGN0eC5zdHJva2VTdHlsZSA9ICdyZ2JhKDI1NSwyNTUsMjU1LDAuOTUpJzsKICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgICAgcmV0dXJuIG5ldyBUSFJFRS5DYW52YXNUZXh0dXJlKGMpOwogICAgfSkoKTsKCmNvbnN0IF9wbGF5ZXJBcnJvd1RleHR1cmUgPSAoKCkgPT4gewogICAgICAgIGNvbnN0IGMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgICBjLndpZHRoID0gNjQ7IGMuaGVpZ2h0ID0gNjQ7CiAgICAgICAgY29uc3QgY3R4ID0gYy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgYy53aWR0aCwgYy5oZWlnaHQpOwogICAgICAgIAogICAgICAgIC8vIEFycm93IHBvaW50aW5nIERPV04KICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgY3R4Lm1vdmVUbyg2LCAxMik7ICAgCiAgICAgICAgY3R4LmxpbmVUbyg1OCwgMTIpOyAgCiAgICAgICAgY3R4LmxpbmVUbygzMiwgNTIpOyAgCiAgICAgICAgY3R4LmNsb3NlUGF0aCgpOwogICAgICAgIGN0eC5maWxsU3R5bGUgPSAnIzAwZmYwMCc7IC8vIEdyZWVuCiAgICAgICAgY3R4LmZpbGwoKTsKICAgICAgICBjdHgubGluZVdpZHRoID0gNDsKICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAncmdiYSgyNTUsMjU1LDI1NSwwLjk1KSc7CiAgICAgICAgY3R4LnN0cm9rZSgpOwogICAgICAgIHJldHVybiBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICAgIH0pKCk7CgogICAgY29uc3QgX3RlYW1tYXRlQXJyb3dUZXh0dXJlID0gKCgpID0+IHsKICAgICAgICBjb25zdCBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgYy53aWR0aCA9IDY0OyBjLmhlaWdodCA9IDY0OwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGMud2lkdGgsIGMuaGVpZ2h0KTsKICAgICAgICAKICAgICAgICAvLyBBcnJvdyBwb2ludGluZyBET1dOCiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgIGN0eC5tb3ZlVG8oNiwgMTIpOyAgIAogICAgICAgIGN0eC5saW5lVG8oNTgsIDEyKTsgIAogICAgICAgIGN0eC5saW5lVG8oMzIsIDUyKTsgIAogICAgICAgIGN0eC5jbG9zZVBhdGgoKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gJyNmZmZmZmYnOyAvLyBXaGl0ZQogICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDQ7CiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gJ3JnYmEoMCwwLDAsMC41KSc7CiAgICAgICAgY3R4LnN0cm9rZSgpOwogICAgICAgIHJldHVybiBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICAgIH0pKCk7CgogICAgY29uc3QgX2VuZW15QXJyb3dNYXRlcmlhbCA9IG5ldyBUSFJFRS5TcHJpdGVNYXRlcmlhbCh7IG1hcDogX2VuZW15QXJyb3dUZXh0dXJlLCB0cmFuc3BhcmVudDogdHJ1ZSwgZGVwdGhUZXN0OiBmYWxzZSwgZGVwdGhXcml0ZTogZmFsc2UgfSk7CiAgICBjb25zdCBfcGxheWVyQXJyb3dNYXRlcmlhbCA9IG5ldyBUSFJFRS5TcHJpdGVNYXRlcmlhbCh7IG1hcDogX3BsYXllckFycm93VGV4dHVyZSwgdHJhbnNwYXJlbnQ6IHRydWUsIGRlcHRoVGVzdDogZmFsc2UsIGRlcHRoV3JpdGU6IGZhbHNlIH0pOwogICAgY29uc3QgX3RlYW1tYXRlQXJyb3dNYXRlcmlhbCA9IG5ldyBUSFJFRS5TcHJpdGVNYXRlcmlhbCh7IG1hcDogX3RlYW1tYXRlQXJyb3dUZXh0dXJlLCB0cmFuc3BhcmVudDogdHJ1ZSwgZGVwdGhUZXN0OiBmYWxzZSwgZGVwdGhXcml0ZTogZmFsc2UgfSk7CmNsYXNzIFRlYW0gewogICAgICAgIC8qKgogICAgICAgICAqIEdlbmVyYXRlcyBhbmQgYXBwbGllcyBzdGF0cyB0byBhIHBsYXllciBiYXNlZCBvbiByb2xlIGFuZCBsZXZlbC4KICAgICAgICAgKiBDZW50cmFsaXplcyBiYWxhbmNpbmcgdG8gZW5zdXJlIGhpZ2gtbGV2ZWwgcGxheSBmZWVscyBkaXN0aW5jdC4KICAgICAgICAgKi8KICAgICAgICBzdGF0aWMgZ2VuZXJhdGVTdGF0cyhwbGF5ZXIsIHJvbGUsIGxldmVsID0gMSwgaXNIdW1hbiA9IGZhbHNlKSB7CiAgICAgICAgICAgIC8vIDEuIERlZmluZSBSb2xlIEJhc2VsaW5lcyAoTGV2ZWwgMSkKICAgICAgICAgICAgLy8gQmFsYW5jZWQgdG8gYmUgd2VhayBidXQgZnVuY3Rpb25hbCBhdCBMZXZlbCAxCiAgICAgICAgICAgIGNvbnN0IGJhc2UgPSB7CiAgICAgICAgICAgICAgICBIUDogMTAwLCBTUDogNTUsIEVOOiAxMCwgQVQ6IDUsIFBBOiA1LCBCTDogNSwgU0g6IDUsIENBOiA1CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBSb2xlIFNwZWNpYWxpemF0aW9ucwogICAgICAgICAgICBzd2l0Y2gocm9sZSkgewogICAgICAgICAgICAgICAgY2FzZSAnTEYnOiBjYXNlICdSRic6IC8vIFN0cmlrZXJzCiAgICAgICAgICAgICAgICAgICAgYmFzZS5TSCArPSAxMDsgYmFzZS5TUCArPSA1OyBiYXNlLkVOICs9IDU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdNRic6IC8vIFBsYXltYWtlcnMKICAgICAgICAgICAgICAgICAgICBiYXNlLlBBICs9IDEwOyBiYXNlLkFUICs9IDg7IGJhc2UuRU4gKz0gODsgYmFzZS5TUCArPSAyOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnTEQnOiBjYXNlICdSRCc6IC8vIERlZmVuZGVycwogICAgICAgICAgICAgICAgICAgIGJhc2UuQVQgKz0gMTI7IGJhc2UuQkwgKz0gMTA7IGJhc2UuUEEgKz0gNTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0dMJzogLy8gR29hbGllCiAgICAgICAgICAgICAgICAgICAgYmFzZS5DQSArPSAxMDsgYmFzZS5TUCArPSA1OyBiYXNlLlBBICs9IDE1OyAvLyBTdHJvbmcgYXJtCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDIuIFNjYWxpbmcgRmFjdG9ycyAoUGVyIExldmVsKQogICAgICAgICAgICAvLyBEZXNpZ25lZCBzbyBMZXZlbCA1MCBpcyAiR29kIFRpZXIiIGFuZCBMZXZlbCAxIGlzICJSb29raWUiCiAgICAgICAgICAgIGNvbnN0IGdyb3d0aCA9IHsKICAgICAgICAgICAgICAgIEhQOiAxNSwgICAgLy8gKzE1MDAgSFAgYXQgTHZsIDk5CiAgICAgICAgICAgICAgICBTUDogMC41LCAgIC8vICs1MCBTUCBhdCBMdmwgOTkgKFNwZWVkIGRlbW9uKQogICAgICAgICAgICAgICAgUHJpbWFyeTogMC44LCAvLyArODAgU3RhdCBhdCBMdmwgOTkKICAgICAgICAgICAgICAgIFNlY29uZGFyeTogMC41IC8vICs1MCBTdGF0IGF0IEx2bCA5OQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgLy8gSGVscGVyIHRvIHNjYWxlCiAgICAgICAgICAgIGNvbnN0IHNjYWxlID0gKHZhbCwgcmF0ZSkgPT4gTWF0aC5mbG9vcih2YWwgKyAoKGxldmVsIC0gMSkgKiByYXRlKSk7CgogICAgICAgICAgICAvLyBBcHBseSBTY2FsaW5nCiAgICAgICAgICAgIHBsYXllci5zdGF0cy5IUCA9IHNjYWxlKGJhc2UuSFAsIGdyb3d0aC5IUCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTUDogQ2FwIGF0IDk5LCBidXQgZW5zdXJlIGhpZ2ggbGV2ZWxzIGZlZWwgRkFTVAogICAgICAgICAgICBwbGF5ZXIuc3RhdHMuU1AgPSBNYXRoLm1pbig5OSwgc2NhbGUoYmFzZS5TUCwgZ3Jvd3RoLlNQKSk7CgogICAgICAgICAgICAvLyBTdGF0IGRpc3RyaWJ1dGlvbiBiYXNlZCBvbiByb2xlIHByaW9yaXRpZXMKICAgICAgICAgICAgaWYgKFsnTEYnLCAnUkYnXS5pbmNsdWRlcyhyb2xlKSkgewogICAgICAgICAgICAgICAgcGxheWVyLnN0YXRzLlNIID0gTWF0aC5taW4oOTksIHNjYWxlKGJhc2UuU0gsIGdyb3d0aC5QcmltYXJ5KSk7CiAgICAgICAgICAgICAgICBwbGF5ZXIuc3RhdHMuRU4gPSBNYXRoLm1pbig5OSwgc2NhbGUoYmFzZS5FTiwgZ3Jvd3RoLlByaW1hcnkpKTsKICAgICAgICAgICAgICAgIHBsYXllci5zdGF0cy5BVCA9IE1hdGgubWluKDk5LCBzY2FsZShiYXNlLkFULCBncm93dGguU2Vjb25kYXJ5KSk7CiAgICAgICAgICAgICAgICBwbGF5ZXIuc3RhdHMuUEEgPSBNYXRoLm1pbig5OSwgc2NhbGUoYmFzZS5QQSwgZ3Jvd3RoLlNlY29uZGFyeSkpOwogICAgICAgICAgICAgICAgcGxheWVyLnN0YXRzLkJMID0gTWF0aC5taW4oOTksIHNjYWxlKGJhc2UuQkwsIGdyb3d0aC5TZWNvbmRhcnkpKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyb2xlID09PSAnTUYnKSB7CiAgICAgICAgICAgICAgICBwbGF5ZXIuc3RhdHMuUEEgPSBNYXRoLm1pbig5OSwgc2NhbGUoYmFzZS5QQSwgZ3Jvd3RoLlByaW1hcnkpKTsKICAgICAgICAgICAgICAgIHBsYXllci5zdGF0cy5BVCA9IE1hdGgubWluKDk5LCBzY2FsZShiYXNlLkFULCBncm93dGguUHJpbWFyeSkpOwogICAgICAgICAgICAgICAgcGxheWVyLnN0YXRzLkVOID0gTWF0aC5taW4oOTksIHNjYWxlKGJhc2UuRU4sIGdyb3d0aC5QcmltYXJ5KSk7CiAgICAgICAgICAgICAgICBwbGF5ZXIuc3RhdHMuU0ggPSBNYXRoLm1pbig5OSwgc2NhbGUoYmFzZS5TSCwgZ3Jvd3RoLlNlY29uZGFyeSkpOwogICAgICAgICAgICAgICAgcGxheWVyLnN0YXRzLkJMID0gTWF0aC5taW4oOTksIHNjYWxlKGJhc2UuQkwsIGdyb3d0aC5TZWNvbmRhcnkpKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChbJ0xEJywgJ1JEJ10uaW5jbHVkZXMocm9sZSkpIHsKICAgICAgICAgICAgICAgIHBsYXllci5zdGF0cy5BVCA9IE1hdGgubWluKDk5LCBzY2FsZShiYXNlLkFULCBncm93dGguUHJpbWFyeSkpOwogICAgICAgICAgICAgICAgcGxheWVyLnN0YXRzLkJMID0gTWF0aC5taW4oOTksIHNjYWxlKGJhc2UuQkwsIGdyb3d0aC5QcmltYXJ5KSk7CiAgICAgICAgICAgICAgICBwbGF5ZXIuc3RhdHMuUEEgPSBNYXRoLm1pbig5OSwgc2NhbGUoYmFzZS5QQSwgZ3Jvd3RoLlNlY29uZGFyeSkpOwogICAgICAgICAgICAgICAgcGxheWVyLnN0YXRzLkVOID0gTWF0aC5taW4oOTksIHNjYWxlKGJhc2UuRU4sIGdyb3d0aC5TZWNvbmRhcnkpKTsKICAgICAgICAgICAgICAgIHBsYXllci5zdGF0cy5TSCA9IE1hdGgubWluKDk5LCBzY2FsZShiYXNlLlNILCAwLjIpKTsgLy8gRGVmZW5kZXJzIGJhZCBhdCBzaG9vdGluZwogICAgICAgICAgICB9IGVsc2UgaWYgKHJvbGUgPT09ICdHTCcpIHsKICAgICAgICAgICAgICAgIHBsYXllci5zdGF0cy5DQSA9IE1hdGgubWluKDk5LCBzY2FsZShiYXNlLkNBLCBncm93dGguUHJpbWFyeSkpOwogICAgICAgICAgICAgICAgcGxheWVyLnN0YXRzLlBBID0gTWF0aC5taW4oOTksIHNjYWxlKGJhc2UuUEEsIGdyb3d0aC5TZWNvbmRhcnkpKTsKICAgICAgICAgICAgICAgIHBsYXllci5zdGF0cy5TSCA9IE1hdGgubWluKDk5LCBzY2FsZShiYXNlLlNILCAwLjMpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMy4gSHVtYW4gUGxheWVyIEJvbnVzIChUaGUgIkhlcm8iIEZlZWwpCiAgICAgICAgICAgIC8vIEdpdmVzIHRoZSBwbGF5ZXIgYSBzbGlnaHQgZWRnZSB0byBtYWtlIGdhbWVwbGF5IGZlZWwgcHVuY2h5CiAgICAgICAgICAgIGlmIChpc0h1bWFuKSB7CiAgICAgICAgICAgICAgICBwbGF5ZXIuc3RhdHMuSFAgKz0gMTUwOyAvLyBUYW5raWVyCiAgICAgICAgICAgICAgICBwbGF5ZXIuc3RhdHMuU1AgKz0gNTsgICAvLyBGYXN0ZXIKICAgICAgICAgICAgICAgIHBsYXllci5zdGF0cy5FTiArPSA1OyAgIC8vIEhhcmRlciB0byB0YWNrbGUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gS2V5IFN0YXQgQm9vc3QKICAgICAgICAgICAgICAgIGlmIChyb2xlID09PSAnTEYnIHx8IHJvbGUgPT09ICdSRicpIHBsYXllci5zdGF0cy5TSCArPSA1OwogICAgICAgICAgICAgICAgaWYgKHJvbGUgPT09ICdNRicpIHBsYXllci5zdGF0cy5QQSArPSA1OwogICAgICAgICAgICAgICAgaWYgKHJvbGUgPT09ICdMRCcgfHwgcm9sZSA9PT0gJ1JEJykgcGxheWVyLnN0YXRzLkFUICs9IDU7CiAgICAgICAgICAgICAgICBpZiAocm9sZSA9PT0gJ0dMJykgcGxheWVyLnN0YXRzLkNBICs9IDU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDQuIEZpbmFsaXplCiAgICAgICAgICAgIHBsYXllci5zdGF0cy5tYXhIUCA9IHBsYXllci5zdGF0cy5IUDsKICAgICAgICAgICAgcGxheWVyLmxldmVsID0gbGV2ZWw7CiAgICAgICAgICAgIHBsYXllci5fdXBkYXRlRGVyaXZlZFN0YXRzKCk7CiAgICAgICAgfQoKY29uc3RydWN0b3Ioc2NlbmUsIGlkLCBzaWRlLCBjb2xvciwgaXNIdW1hbikgewogICAgICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7CiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDsgLy8gJ2hvbWUnIG9yICdhd2F5JwogICAgICAgICAgICB0aGlzLnNpZGUgPSBzaWRlOyAvLyAxIChEZWZlbmRzICtaKSBvciAtMSAoRGVmZW5kcyAtWikKICAgICAgICAgICAgdGhpcy5jb2xvciA9IGNvbG9yOwogICAgICAgICAgICB0aGlzLmlzSHVtYW4gPSBpc0h1bWFuOwogICAgICAgICAgICB0aGlzLmFpRW5hYmxlZCA9IHRydWU7IC8vIE1hc3RlciBzd2l0Y2ggZm9yIEFJIGxvZ2ljCiAgICAgICAgICAgIAogICAgICAgICAgICB0aGlzLnBsYXllcnMgPSBbXTsKICAgICAgICAgICAgdGhpcy5hY3RpdmVQbGF5ZXIgPSBudWxsOyAvLyBUaGUgcGxheWVyIGN1cnJlbnRseSBjb250cm9sbGVkL2ZvY3VzZWQKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEZvcm1hdGlvbiBBbmNob3JzCiAgICAgICAgICAgIHRoaXMuY3VycmVudEZvcm1hdGlvbiA9ICdOb3JtYWwnOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gUGxheWVyIEluZGljYXRvciAoR3JlZW4gQXJyb3cpCiAgICAgICAgICAgIGlmICh0aGlzLmlzSHVtYW4pIHsKICAgICAgICAgICAgICAgIHRoaXMucGxheWVyQXJyb3cgPSBuZXcgVEhSRUUuU3ByaXRlKF9wbGF5ZXJBcnJvd01hdGVyaWFsKTsKICAgICAgICAgICAgICAgIHRoaXMucGxheWVyQXJyb3cuc2NhbGUuc2V0KDAuOCwgMC44LCAxLjApOwogICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXJBcnJvdy5yZW5kZXJPcmRlciA9IDEwMDA7IC8vIE9uIHRvcAogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBhc3NpZ25NYXJrcyhvcHBvc2luZ1RlYW0pIHsKICAgICAgICAgICAgLy8gU2ltcGxlIGF1dG8tYXNzaWduIGxvZ2ljOiBNYXJrIHRoZSBwbGF5ZXIgaW4gdGhlICJtYXRjaGluZyIgcG9zaXRpb24KICAgICAgICAgICAgLy8gTEY8LT5SRCwgUkY8LT5MRCwgTUY8LT5NRiwgTEQ8LT5SRiwgUkQ8LT5MRiwgR0w8LT5MRgogICAgICAgICAgICB0aGlzLnBsYXllcnMuZm9yRWFjaChwID0+IHsKICAgICAgICAgICAgICAgIGxldCB0YXJnZXRSb2xlID0gJ01GJzsKICAgICAgICAgICAgICAgIHN3aXRjaCAocC5yb2xlKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnTEYnOiB0YXJnZXRSb2xlID0gJ1JEJzsgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnUkYnOiB0YXJnZXRSb2xlID0gJ0xEJzsgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnTUYnOiB0YXJnZXRSb2xlID0gJ01GJzsgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnTEQnOiB0YXJnZXRSb2xlID0gJ1JGJzsgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnUkQnOiB0YXJnZXRSb2xlID0gJ0xGJzsgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnR0wnOiB0YXJnZXRSb2xlID0gJ0xGJzsgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gb3Bwb3NpbmdUZWFtLnBsYXllcnMuZmluZChvcCA9PiBvcC5yb2xlID09PSB0YXJnZXRSb2xlKTsKICAgICAgICAgICAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICAgICAgICAgICAgICBwLm1hcmtpbmcgPSB0YXJnZXQ7CiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coYCR7dGhpcy5pZH0gJHtwLnJvbGV9IG1hcmtlZCAke3RhcmdldC5yb2xlfWApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGFkZFBsYXllcihwbGF5ZXIpIHsKICAgICAgICAgICAgdGhpcy5wbGF5ZXJzLnB1c2gocGxheWVyKTsKICAgICAgICAgICAgcGxheWVyLnRlYW0gPSB0aGlzOwoKICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIEhvbWUgUG9zaXRpb24gYmFzZWQgb24gRm9ybWF0aW9uCiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVBsYXllckhvbWVQb3NpdGlvbihwbGF5ZXIpOwoKICAgICAgICAgICAgLy8gRW5lbXkgaW5kaWNhdG9yOiByZWQgYXJyb3dzIG92ZXIgdGhlIEF3YXkgdGVhbSAoc28gZW5lbWllcyBhcmUgcmVhZGFibGUpCi8vIEVuZW15IGluZGljYXRvcjogcmVkIGFycm93cyBvdmVyIHRoZSBBd2F5IHRlYW0KICAgICAgICAgICAgaWYgKHRoaXMuaWQgPT09ICdhd2F5JyAmJiBwbGF5ZXIubWVzaCkgewogICAgICAgICAgICAgICAgY29uc3QgYXJyb3cgPSBuZXcgVEhSRUUuU3ByaXRlKF9lbmVteUFycm93TWF0ZXJpYWwpOwogICAgICAgICAgICAgICAgYXJyb3cuc2NhbGUuc2V0KDAuOCwgMC44LCAxLjApOwogICAgICAgICAgICAgICAgYXJyb3cucG9zaXRpb24uc2V0KDAsIDMuMiwgMCk7IC8vIGFib3ZlIGhlYWQKICAgICAgICAgICAgICAgIGFycm93LnJlbmRlck9yZGVyID0gOTk5OwogICAgICAgICAgICAgICAgcGxheWVyLm1lc2guYWRkKGFycm93KTsKICAgICAgICAgICAgICAgIHBsYXllci5lbmVteUFycm93ID0gYXJyb3c7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFRlYW1tYXRlIGluZGljYXRvcjogV2hpdGUgYXJyb3dzIGZvciBpbmFjdGl2ZSBodW1hbnMKICAgICAgICAgICAgaWYgKHRoaXMuaXNIdW1hbiAmJiBwbGF5ZXIubWVzaCkgewogICAgICAgICAgICAgICAgY29uc3QgYXJyb3cgPSBuZXcgVEhSRUUuU3ByaXRlKF90ZWFtbWF0ZUFycm93TWF0ZXJpYWwpOwogICAgICAgICAgICAgICAgYXJyb3cuc2NhbGUuc2V0KDAuNiwgMC42LCAxLjApOwogICAgICAgICAgICAgICAgYXJyb3cucG9zaXRpb24uc2V0KDAsIDMuMiwgMCk7CiAgICAgICAgICAgICAgICBhcnJvdy5yZW5kZXJPcmRlciA9IDk5OTsKICAgICAgICAgICAgICAgIGFycm93LnZpc2libGUgPSBmYWxzZTsgLy8gSGlkZGVuIGJ5IGRlZmF1bHQsIG1hbmFnZWQgYnkgc2V0QWN0aXZlUGxheWVyCiAgICAgICAgICAgICAgICBwbGF5ZXIubWVzaC5hZGQoYXJyb3cpOwogICAgICAgICAgICAgICAgcGxheWVyLnRlYW1tYXRlQXJyb3cgPSBhcnJvdzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgc2V0Rm9ybWF0aW9uKG5hbWUpIHsKICAgICAgICAgICAgaWYgKCFGT1JNQVRJT05TW25hbWVdKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuY3VycmVudEZvcm1hdGlvbiA9IG5hbWU7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGBUZWFtICR7dGhpcy5pZH0gc3dpdGNoZWQgdG8gJHtuYW1lfWApOwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5wbGF5ZXJzLmZvckVhY2gocCA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVQbGF5ZXJIb21lUG9zaXRpb24ocCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCl91cGRhdGVQbGF5ZXJIb21lUG9zaXRpb24ocGxheWVyKSB7CiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBGT1JNQVRJT05TW3RoaXMuY3VycmVudEZvcm1hdGlvbl07CiAgICAgICAgICAgIGlmICghZGF0YSkgcmV0dXJuOwoKICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gZGF0YVtwbGF5ZXIucm9sZV07CiAgICAgICAgICAgIGlmIChvZmZzZXQpIHsKICAgICAgICAgICAgICAgIC8vIFggUG9zaXRpb246CiAgICAgICAgICAgICAgICAvLyBGb3JtYXRpb25zOiAtWCBpcyBMZWZ0LCArWCBpcyBSaWdodC4KICAgICAgICAgICAgICAgIC8vIEhvbWUgVGVhbSAoU2lkZSAxKSBmYWNlcyAtWi4gTGVmdCBpcyAtWC4gVXNlIG9mZnNldC54IGFzIGlzLgogICAgICAgICAgICAgICAgbGV0IHhQb3MgPSBvZmZzZXQueDsKICAgICAgICAgICAgICAgIGxldCB6UG9zID0gb2Zmc2V0LnogKiB0aGlzLnNpZGU7CgogICAgICAgICAgICAgICAgcGxheWVyLmhvbWVQb3NpdGlvbi5zZXQoeFBvcywgMCwgelBvcyk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEF3YXkgVGVhbSAoU2lkZSAtMSkgZmFjZXMgK1ouIExlZnQgaXMgK1guIEZsaXAgWC4KICAgICAgICAgICAgICAgIGlmICh0aGlzLnNpZGUgPT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgcGxheWVyLmhvbWVQb3NpdGlvbi54ICo9IC0xOyAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU2V0IGluaXRpYWwgcG9zaXRpb24KICAgICAgICAgICAgaWYgKHBsYXllci5tZXNoKSB7CiAgICAgICAgICAgICAgICBwbGF5ZXIubWVzaC5wb3NpdGlvbi5jb3B5KHBsYXllci5ob21lUG9zaXRpb24pOwogICAgICAgICAgICAgICAgLy8gRmFjZSBjZW50ZXIgKDAsMCwwKQogICAgICAgICAgICAgICAgcGxheWVyLm1lc2gubG9va0F0KDAsIDAsIDApOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB1cGRhdGUoZHQpIHsKICAgICAgICAgICAgLy8gVXBkYXRlIGFsbCBwbGF5ZXJzCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbGF5ZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICB0aGlzLnBsYXllcnNbaV0udXBkYXRlKGR0KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQXV0by1zd2l0Y2ggYWN0aXZlIHBsYXllciBpZiBIdW1hbgogICAgICAgICAgICBpZiAodGhpcy5pc0h1bWFuKSB7CiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUFjdGl2ZVBsYXllclNlbGVjdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB1cGRhdGVBY3RpdmVQbGF5ZXJTZWxlY3Rpb24oKSB7CiAgICAgICAgICAgIGNvbnN0IGJhbGwgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZW50aXRpZXMuYmFsbDsKICAgICAgICAgICAgaWYgKCFiYWxsKSByZXR1cm47CgogICAgICAgICAgICAvLyAxLiBPRkZFTlNFOiBJZiB3ZSBoYXZlIHRoZSBiYWxsLCBhY3RpdmUgcGxheWVyIGlzIHRoZSBob2xkZXIKICAgICAgICAgICAgaWYgKGJhbGwuaG9sZGVyICYmIGJhbGwuaG9sZGVyLnRlYW0gPT09IHRoaXMpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZVBsYXllciAhPT0gYmFsbC5ob2xkZXIpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFjdGl2ZVBsYXllcihiYWxsLmhvbGRlcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDIuIERFRkVOU0U6IFNlbGVjdCBjbG9zZXN0IHRvIGJhbGwKICAgICAgICAgICAgLy8gT3B0aW1pemF0aW9uOiBPbmx5IGNoZWNrIGV2ZXJ5IGZldyBmcmFtZXMgb3IgaWYgZGlzdGFuY2UgaXMgc2lnbmlmaWNhbnQKICAgICAgICAgICAgbGV0IGNsb3Nlc3QgPSBudWxsOwogICAgICAgICAgICBsZXQgbWluRHN0ID0gSW5maW5pdHk7CgogICAgICAgICAgICBmb3IgKGNvbnN0IHAgb2YgdGhpcy5wbGF5ZXJzKSB7CiAgICAgICAgICAgICAgICBpZiAocC5yb2xlID09PSAnR0wnKSBjb250aW51ZTsgLy8gRG9uJ3QgYXV0by1zd2l0Y2ggdG8gZ29hbGllIHVzdWFsbHkKICAgICAgICAgICAgICAgIGlmICghcC5tZXNoKSBjb250aW51ZTsKCiAgICAgICAgICAgICAgICBjb25zdCBkID0gcC5tZXNoLnBvc2l0aW9uLmRpc3RhbmNlVG8oYmFsbC5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgIGlmIChkIDwgbWluRHN0KSB7CiAgICAgICAgICAgICAgICAgICAgbWluRHN0ID0gZDsKICAgICAgICAgICAgICAgICAgICBjbG9zZXN0ID0gcDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGNsb3Nlc3QgJiYgY2xvc2VzdCAhPT0gdGhpcy5hY3RpdmVQbGF5ZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlUGxheWVyKGNsb3Nlc3QpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKc2V0QWN0aXZlUGxheWVyKHBsYXllcikgewogICAgICAgICAgICAvLyBSZXNldCBpbnB1dCBvbiBwcmV2aW91cwogICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVQbGF5ZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlUGxheWVyLnNldElucHV0KDAsIDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuYWN0aXZlUGxheWVyID0gcGxheWVyOwoKICAgICAgICAgICAgLy8gVmlzdWFsIEluZGljYXRvcnMKICAgICAgICAgICAgaWYgKHRoaXMuaXNIdW1hbikgewogICAgICAgICAgICAgICAgLy8gMS4gR3JlZW4gQXJyb3cgZm9yIEFjdGl2ZQogICAgICAgICAgICAgICAgaWYgKHRoaXMucGxheWVyQXJyb3cgJiYgcGxheWVyLm1lc2gpIHsKICAgICAgICAgICAgICAgICAgICBwbGF5ZXIubWVzaC5hZGQodGhpcy5wbGF5ZXJBcnJvdyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXJBcnJvdy5wb3NpdGlvbi5zZXQoMCwgMy41LCAwKTsgLy8gRmxvYXQgYWJvdmUgaGVhZAogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIDIuIFdoaXRlIEFycm93cyBmb3IgT3RoZXJzCiAgICAgICAgICAgICAgICB0aGlzLnBsYXllcnMuZm9yRWFjaChwID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAocC50ZWFtbWF0ZUFycm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHAudGVhbW1hdGVBcnJvdy52aXNpYmxlID0gKHAgIT09IHBsYXllcik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgpyZXNldFBvc2l0aW9ucygpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBwIG9mIHRoaXMucGxheWVycykgewogICAgICAgICAgICAgICAgaWYgKHAubWVzaCkgewogICAgICAgICAgICAgICAgICAgIHAubWVzaC5wb3NpdGlvbi5jb3B5KHAuaG9tZVBvc2l0aW9uKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBSZXNldCBQaHlzaWNzCiAgICAgICAgICAgICAgICAgICAgcC52ZWxvY2l0eS5zZXQoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgcC5pbnB1dFZlY3Rvci5zZXQoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgcC5pc0Rhc2hpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBwLmlzVGhyb3dpbmcgPSBmYWxzZTsKcC5sb3NlQmFsbCgpOyAvLyBEcm9wIGJhbGwgaWYgaG9sZGluZwogICAgICAgICAgICAgICAgICAgIHAuY2FuQ2F0Y2ggPSB0cnVlOyAvLyBGb3JjZSByZXNldCBjYXBhYmlsaXR5CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gUmVzZXQgU3RhdHMKICAgICAgICAgICAgICAgICAgICBwLmN1cnJlbnRFTiA9IHAuc3RhdHMuRU47CiAgICAgICAgICAgICAgICAgICAgCi8vIE9yaWVudGF0aW9uOiBGYWNlIENlbnRlcgogICAgICAgICAgICAgICAgICAgIHAubWVzaC5sb29rQXQoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHAuc3luY1JvdGF0aW9uKSBwLnN5bmNSb3RhdGlvbigpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFJlc2V0IEFuaW1hdGlvbgogICAgICAgICAgICAgICAgICAgIHAucGxheSgnaWRsZScsIDAuMSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gUmVzZXQgYWN0aXZlIHBsYXllciB0byBNRgogICAgICAgICAgICBjb25zdCBtZiA9IHRoaXMucGxheWVycy5maW5kKHAgPT4gcC5yb2xlID09PSAnTUYnKTsKICAgICAgICAgICAgaWYgKG1mKSB0aGlzLnNldEFjdGl2ZVBsYXllcihtZik7CiAgICAgICAgfQogICAgfQoKICAgIHdpbmRvdy5mbHV4LlRlYW0gPSBUZWFtOwp9KSgpOw==","/Team.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCi8vIEZvcm1hdGlvbiBEZWZpbml0aW9ucyAoQ29vcmRpbmF0ZXMgZm9yIFNpZGUgMTogRGVmZW5kcyArWiwgQXR0YWNrcyAtWikKICAgIC8vIFg6IExlZnQoLSkvUmlnaHQoKyksIFo6IEZvcndhcmQoLSkvQmFjaygrKQogICAgY29uc3QgRk9STUFUSU9OUyA9IHsKICAgICAgICAnTm9ybWFsJzogewogICAgICAgICAgICAnR0wnOiB7IHg6IDAsIHo6IDI1IH0sCiAgICAgICAgICAgICdMRCc6IHsgeDogLTgsIHo6IDE1IH0sICdSRCc6IHsgeDogOCwgejogMTUgfSwKICAgICAgICAgICAgJ01GJzogeyB4OiAwLCB6OiA1IH0sCiAgICAgICAgICAgICdMRic6IHsgeDogLTEwLCB6OiAtMTAgfSwgJ1JGJzogeyB4OiAxMCwgejogLTEwIH0KICAgICAgICB9LAogICAgICAgICdDZW50ZXIgQXR0YWNrJzogewogICAgICAgICAgICAnR0wnOiB7IHg6IDAsIHo6IDI1IH0sCiAgICAgICAgICAgICdMRCc6IHsgeDogLTgsIHo6IDE1IH0sICdSRCc6IHsgeDogOCwgejogMTUgfSwKICAgICAgICAgICAgJ01GJzogeyB4OiAwLCB6OiAwIH0sCiAgICAgICAgICAgICdMRic6IHsgeDogLTQsIHo6IC0xNSB9LCAnUkYnOiB7IHg6IDQsIHo6IC0xNSB9CiAgICAgICAgfSwKICAgICAgICAnUmlnaHQgU2lkZSc6IHsKICAgICAgICAgICAgJ0dMJzogeyB4OiAwLCB6OiAyNSB9LAogICAgICAgICAgICAnTEQnOiB7IHg6IDAsIHo6IDE1IH0sICdSRCc6IHsgeDogMTIsIHo6IDE1IH0sCiAgICAgICAgICAgICdNRic6IHsgeDogMTAsIHo6IDUgfSwKICAgICAgICAgICAgJ0xGJzogeyB4OiA1LCB6OiAtMTAgfSwgJ1JGJzogeyB4OiAxNSwgejogLTEwIH0KICAgICAgICB9LAogICAgICAgICdMZWZ0IFNpZGUnOiB7CiAgICAgICAgICAgICdHTCc6IHsgeDogMCwgejogMjUgfSwKICAgICAgICAgICAgJ0xEJzogeyB4OiAtMTIsIHo6IDE1IH0sICdSRCc6IHsgeDogMCwgejogMTUgfSwKICAgICAgICAgICAgJ01GJzogeyB4OiAtMTAsIHo6IDUgfSwKICAgICAgICAgICAgJ0xGJzogeyB4OiAtMTUsIHo6IC0xMCB9LCAnUkYnOiB7IHg6IC01LCB6OiAtMTAgfQogICAgICAgIH0sCiAgICAgICAgJ0FsbC1PdXQgRGVmZW5zZSc6IHsKICAgICAgICAgICAgJ0dMJzogeyB4OiAwLCB6OiAyNSB9LAogICAgICAgICAgICAnTEQnOiB7IHg6IC02LCB6OiAyMCB9LCAnUkQnOiB7IHg6IDYsIHo6IDIwIH0sCiAgICAgICAgICAgICdNRic6IHsgeDogMCwgejogMTAgfSwKICAgICAgICAgICAgJ0xGJzogeyB4OiAtMTAsIHo6IDUgfSwgJ1JGJzogeyB4OiAxMCwgejogNSB9CiAgICAgICAgfSwKICAgICAgICAnRmxhdCBMaW5lJzogewogICAgICAgICAgICAnR0wnOiB7IHg6IDAsIHo6IDI1IH0sCiAgICAgICAgICAgICdMRCc6IHsgeDogLTgsIHo6IDAgfSwgJ1JEJzogeyB4OiA4LCB6OiAwIH0sCiAgICAgICAgICAgICdNRic6IHsgeDogMCwgejogMCB9LAogICAgICAgICAgICAnTEYnOiB7IHg6IC0xNSwgejogMCB9LCAnUkYnOiB7IHg6IDE1LCB6OiAwIH0KICAgICAgICB9LAogICAgICAgICdDb3VudGVyJzogewogICAgICAgICAgICAnR0wnOiB7IHg6IDAsIHo6IDI1IH0sCiAgICAgICAgICAgICdMRCc6IHsgeDogLTgsIHo6IDIwIH0sICdSRCc6IHsgeDogOCwgejogMjAgfSwKICAgICAgICAgICAgJ01GJzogeyB4OiAwLCB6OiAxNSB9LAogICAgICAgICAgICAnTEYnOiB7IHg6IC0xMiwgejogLTIwIH0sICdSRic6IHsgeDogMTIsIHo6IC0yMCB9CiAgICAgICAgfSwKICAgICAgICAnRG91YmxlIFNpZGVzJzogewogICAgICAgICAgICAnR0wnOiB7IHg6IDAsIHo6IDI1IH0sCiAgICAgICAgICAgICdMRCc6IHsgeDogLTE4LCB6OiAxNSB9LCAnUkQnOiB7IHg6IDE4LCB6OiAxNSB9LAogICAgICAgICAgICAnTUYnOiB7IHg6IDAsIHo6IDUgfSwKICAgICAgICAgICAgJ0xGJzogeyB4OiAtMTgsIHo6IC0xMCB9LCAnUkYnOiB7IHg6IDE4LCB6OiAtMTAgfQogICAgICAgIH0KICAgIH07CgoKCiAgICAvLyAtLS0gRW5lbXkgSW5kaWNhdG9yIChSZWQgQXJyb3cgU3ByaXRlKSAtLS0KICAgIC8vIFNoYXJlZCB0ZXh0dXJlL21hdGVyaWFsIHNvIHdlIGRvbid0IGNyZWF0ZSA2IGNhbnZhc2VzLgpjb25zdCBfZW5lbXlBcnJvd1RleHR1cmUgPSAoKCkgPT4gewogICAgICAgIGNvbnN0IGMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgICBjLndpZHRoID0gNjQ7CiAgICAgICAgYy5oZWlnaHQgPSA2NDsKICAgICAgICBjb25zdCBjdHggPSBjLmdldENvbnRleHQoJzJkJyk7CiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBjLndpZHRoLCBjLmhlaWdodCk7CiAgICAgICAgCiAgICAgICAgLy8gQXJyb3cgcG9pbnRpbmcgRE9XTgogICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICBjdHgubW92ZVRvKDYsIDEyKTsgICAKICAgICAgICBjdHgubGluZVRvKDU4LCAxMik7ICAKICAgICAgICBjdHgubGluZVRvKDMyLCA1Mik7ICAKICAgICAgICBjdHguY2xvc2VQYXRoKCk7CiAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjZmYwMDAwJzsKICAgICAgICBjdHguZmlsbCgpOwogICAgICAgIGN0eC5saW5lV2lkdGggPSA0OwogICAgICAgIGN0eC5zdHJva2VTdHlsZSA9ICdyZ2JhKDI1NSwyNTUsMjU1LDAuOTUpJzsKICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgICAgcmV0dXJuIG5ldyBUSFJFRS5DYW52YXNUZXh0dXJlKGMpOwogICAgfSkoKTsKCmNvbnN0IF9wbGF5ZXJBcnJvd1RleHR1cmUgPSAoKCkgPT4gewogICAgICAgIGNvbnN0IGMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgICBjLndpZHRoID0gNjQ7IGMuaGVpZ2h0ID0gNjQ7CiAgICAgICAgY29uc3QgY3R4ID0gYy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgYy53aWR0aCwgYy5oZWlnaHQpOwogICAgICAgIAogICAgICAgIC8vIEFycm93IHBvaW50aW5nIERPV04KICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgY3R4Lm1vdmVUbyg2LCAxMik7ICAgCiAgICAgICAgY3R4LmxpbmVUbyg1OCwgMTIpOyAgCiAgICAgICAgY3R4LmxpbmVUbygzMiwgNTIpOyAgCiAgICAgICAgY3R4LmNsb3NlUGF0aCgpOwogICAgICAgIGN0eC5maWxsU3R5bGUgPSAnIzAwZmYwMCc7IC8vIEdyZWVuCiAgICAgICAgY3R4LmZpbGwoKTsKICAgICAgICBjdHgubGluZVdpZHRoID0gNDsKICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAncmdiYSgyNTUsMjU1LDI1NSwwLjk1KSc7CiAgICAgICAgY3R4LnN0cm9rZSgpOwogICAgICAgIHJldHVybiBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICAgIH0pKCk7CgogICAgY29uc3QgX3RlYW1tYXRlQXJyb3dUZXh0dXJlID0gKCgpID0+IHsKICAgICAgICBjb25zdCBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgYy53aWR0aCA9IDY0OyBjLmhlaWdodCA9IDY0OwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGMud2lkdGgsIGMuaGVpZ2h0KTsKICAgICAgICAKICAgICAgICAvLyBBcnJvdyBwb2ludGluZyBET1dOCiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgIGN0eC5tb3ZlVG8oNiwgMTIpOyAgIAogICAgICAgIGN0eC5saW5lVG8oNTgsIDEyKTsgIAogICAgICAgIGN0eC5saW5lVG8oMzIsIDUyKTsgIAogICAgICAgIGN0eC5jbG9zZVBhdGgoKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gJyNmZmZmZmYnOyAvLyBXaGl0ZQogICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDQ7CiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gJ3JnYmEoMCwwLDAsMC41KSc7CiAgICAgICAgY3R4LnN0cm9rZSgpOwogICAgICAgIHJldHVybiBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICAgIH0pKCk7CgogICAgY29uc3QgX2VuZW15QXJyb3dNYXRlcmlhbCA9IG5ldyBUSFJFRS5TcHJpdGVNYXRlcmlhbCh7IG1hcDogX2VuZW15QXJyb3dUZXh0dXJlLCB0cmFuc3BhcmVudDogdHJ1ZSwgZGVwdGhUZXN0OiBmYWxzZSwgZGVwdGhXcml0ZTogZmFsc2UgfSk7CiAgICBjb25zdCBfcGxheWVyQXJyb3dNYXRlcmlhbCA9IG5ldyBUSFJFRS5TcHJpdGVNYXRlcmlhbCh7IG1hcDogX3BsYXllckFycm93VGV4dHVyZSwgdHJhbnNwYXJlbnQ6IHRydWUsIGRlcHRoVGVzdDogZmFsc2UsIGRlcHRoV3JpdGU6IGZhbHNlIH0pOwogICAgY29uc3QgX3RlYW1tYXRlQXJyb3dNYXRlcmlhbCA9IG5ldyBUSFJFRS5TcHJpdGVNYXRlcmlhbCh7IG1hcDogX3RlYW1tYXRlQXJyb3dUZXh0dXJlLCB0cmFuc3BhcmVudDogdHJ1ZSwgZGVwdGhUZXN0OiBmYWxzZSwgZGVwdGhXcml0ZTogZmFsc2UgfSk7CmNsYXNzIFRlYW0gewogICAgICAgIC8qKgogICAgICAgICAqIEdlbmVyYXRlcyBhbmQgYXBwbGllcyBzdGF0cyB0byBhIHBsYXllciBiYXNlZCBvbiByb2xlIGFuZCBsZXZlbC4KICAgICAgICAgKiBDZW50cmFsaXplcyBiYWxhbmNpbmcgdG8gZW5zdXJlIGhpZ2gtbGV2ZWwgcGxheSBmZWVscyBkaXN0aW5jdC4KICAgICAgICAgKi8KICAgICAgICBzdGF0aWMgZ2VuZXJhdGVTdGF0cyhwbGF5ZXIsIHJvbGUsIGxldmVsID0gMSwgaXNIdW1hbiA9IGZhbHNlKSB7CiAgICAgICAgICAgIC8vIDEuIERlZmluZSBSb2xlIEJhc2VsaW5lcyAoTGV2ZWwgMSkKICAgICAgICAgICAgLy8gQmFsYW5jZWQgdG8gYmUgd2VhayBidXQgZnVuY3Rpb25hbCBhdCBMZXZlbCAxCiAgICAgICAgICAgIGNvbnN0IGJhc2UgPSB7CiAgICAgICAgICAgICAgICBIUDogMTAwLCBTUDogNTUsIEVOOiAxMCwgQVQ6IDUsIFBBOiA1LCBCTDogNSwgU0g6IDUsIENBOiA1CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBSb2xlIFNwZWNpYWxpemF0aW9ucwogICAgICAgICAgICBzd2l0Y2gocm9sZSkgewogICAgICAgICAgICAgICAgY2FzZSAnTEYnOiBjYXNlICdSRic6IC8vIFN0cmlrZXJzCiAgICAgICAgICAgICAgICAgICAgYmFzZS5TSCArPSAxMDsgYmFzZS5TUCArPSA1OyBiYXNlLkVOICs9IDU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdNRic6IC8vIFBsYXltYWtlcnMKICAgICAgICAgICAgICAgICAgICBiYXNlLlBBICs9IDEwOyBiYXNlLkFUICs9IDg7IGJhc2UuRU4gKz0gODsgYmFzZS5TUCArPSAyOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnTEQnOiBjYXNlICdSRCc6IC8vIERlZmVuZGVycwogICAgICAgICAgICAgICAgICAgIGJhc2UuQVQgKz0gMTI7IGJhc2UuQkwgKz0gMTA7IGJhc2UuUEEgKz0gNTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0dMJzogLy8gR29hbGllCiAgICAgICAgICAgICAgICAgICAgYmFzZS5DQSArPSAxMDsgYmFzZS5TUCArPSA1OyBiYXNlLlBBICs9IDE1OyAvLyBTdHJvbmcgYXJtCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDIuIFNjYWxpbmcgRmFjdG9ycyAoUGVyIExldmVsKQogICAgICAgICAgICAvLyBEZXNpZ25lZCBzbyBMZXZlbCA1MCBpcyAiR29kIFRpZXIiIGFuZCBMZXZlbCAxIGlzICJSb29raWUiCiAgICAgICAgICAgIGNvbnN0IGdyb3d0aCA9IHsKICAgICAgICAgICAgICAgIEhQOiAxNSwgICAgLy8gKzE1MDAgSFAgYXQgTHZsIDk5CiAgICAgICAgICAgICAgICBTUDogMC41LCAgIC8vICs1MCBTUCBhdCBMdmwgOTkgKFNwZWVkIGRlbW9uKQogICAgICAgICAgICAgICAgUHJpbWFyeTogMC44LCAvLyArODAgU3RhdCBhdCBMdmwgOTkKICAgICAgICAgICAgICAgIFNlY29uZGFyeTogMC41IC8vICs1MCBTdGF0IGF0IEx2bCA5OQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgLy8gSGVscGVyIHRvIHNjYWxlCiAgICAgICAgICAgIGNvbnN0IHNjYWxlID0gKHZhbCwgcmF0ZSkgPT4gTWF0aC5mbG9vcih2YWwgKyAoKGxldmVsIC0gMSkgKiByYXRlKSk7CgogICAgICAgICAgICAvLyBBcHBseSBTY2FsaW5nCiAgICAgICAgICAgIHBsYXllci5zdGF0cy5IUCA9IHNjYWxlKGJhc2UuSFAsIGdyb3d0aC5IUCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTUDogQ2FwIGF0IDk5LCBidXQgZW5zdXJlIGhpZ2ggbGV2ZWxzIGZlZWwgRkFTVAogICAgICAgICAgICBwbGF5ZXIuc3RhdHMuU1AgPSBNYXRoLm1pbig5OSwgc2NhbGUoYmFzZS5TUCwgZ3Jvd3RoLlNQKSk7CgogICAgICAgICAgICAvLyBTdGF0IGRpc3RyaWJ1dGlvbiBiYXNlZCBvbiByb2xlIHByaW9yaXRpZXMKICAgICAgICAgICAgaWYgKFsnTEYnLCAnUkYnXS5pbmNsdWRlcyhyb2xlKSkgewogICAgICAgICAgICAgICAgcGxheWVyLnN0YXRzLlNIID0gTWF0aC5taW4oOTksIHNjYWxlKGJhc2UuU0gsIGdyb3d0aC5QcmltYXJ5KSk7CiAgICAgICAgICAgICAgICBwbGF5ZXIuc3RhdHMuRU4gPSBNYXRoLm1pbig5OSwgc2NhbGUoYmFzZS5FTiwgZ3Jvd3RoLlByaW1hcnkpKTsKICAgICAgICAgICAgICAgIHBsYXllci5zdGF0cy5BVCA9IE1hdGgubWluKDk5LCBzY2FsZShiYXNlLkFULCBncm93dGguU2Vjb25kYXJ5KSk7CiAgICAgICAgICAgICAgICBwbGF5ZXIuc3RhdHMuUEEgPSBNYXRoLm1pbig5OSwgc2NhbGUoYmFzZS5QQSwgZ3Jvd3RoLlNlY29uZGFyeSkpOwogICAgICAgICAgICAgICAgcGxheWVyLnN0YXRzLkJMID0gTWF0aC5taW4oOTksIHNjYWxlKGJhc2UuQkwsIGdyb3d0aC5TZWNvbmRhcnkpKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyb2xlID09PSAnTUYnKSB7CiAgICAgICAgICAgICAgICBwbGF5ZXIuc3RhdHMuUEEgPSBNYXRoLm1pbig5OSwgc2NhbGUoYmFzZS5QQSwgZ3Jvd3RoLlByaW1hcnkpKTsKICAgICAgICAgICAgICAgIHBsYXllci5zdGF0cy5BVCA9IE1hdGgubWluKDk5LCBzY2FsZShiYXNlLkFULCBncm93dGguUHJpbWFyeSkpOwogICAgICAgICAgICAgICAgcGxheWVyLnN0YXRzLkVOID0gTWF0aC5taW4oOTksIHNjYWxlKGJhc2UuRU4sIGdyb3d0aC5QcmltYXJ5KSk7CiAgICAgICAgICAgICAgICBwbGF5ZXIuc3RhdHMuU0ggPSBNYXRoLm1pbig5OSwgc2NhbGUoYmFzZS5TSCwgZ3Jvd3RoLlNlY29uZGFyeSkpOwogICAgICAgICAgICAgICAgcGxheWVyLnN0YXRzLkJMID0gTWF0aC5taW4oOTksIHNjYWxlKGJhc2UuQkwsIGdyb3d0aC5TZWNvbmRhcnkpKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChbJ0xEJywgJ1JEJ10uaW5jbHVkZXMocm9sZSkpIHsKICAgICAgICAgICAgICAgIHBsYXllci5zdGF0cy5BVCA9IE1hdGgubWluKDk5LCBzY2FsZShiYXNlLkFULCBncm93dGguUHJpbWFyeSkpOwogICAgICAgICAgICAgICAgcGxheWVyLnN0YXRzLkJMID0gTWF0aC5taW4oOTksIHNjYWxlKGJhc2UuQkwsIGdyb3d0aC5QcmltYXJ5KSk7CiAgICAgICAgICAgICAgICBwbGF5ZXIuc3RhdHMuUEEgPSBNYXRoLm1pbig5OSwgc2NhbGUoYmFzZS5QQSwgZ3Jvd3RoLlNlY29uZGFyeSkpOwogICAgICAgICAgICAgICAgcGxheWVyLnN0YXRzLkVOID0gTWF0aC5taW4oOTksIHNjYWxlKGJhc2UuRU4sIGdyb3d0aC5TZWNvbmRhcnkpKTsKICAgICAgICAgICAgICAgIHBsYXllci5zdGF0cy5TSCA9IE1hdGgubWluKDk5LCBzY2FsZShiYXNlLlNILCAwLjIpKTsgLy8gRGVmZW5kZXJzIGJhZCBhdCBzaG9vdGluZwogICAgICAgICAgICB9IGVsc2UgaWYgKHJvbGUgPT09ICdHTCcpIHsKICAgICAgICAgICAgICAgIHBsYXllci5zdGF0cy5DQSA9IE1hdGgubWluKDk5LCBzY2FsZShiYXNlLkNBLCBncm93dGguUHJpbWFyeSkpOwogICAgICAgICAgICAgICAgcGxheWVyLnN0YXRzLlBBID0gTWF0aC5taW4oOTksIHNjYWxlKGJhc2UuUEEsIGdyb3d0aC5TZWNvbmRhcnkpKTsKICAgICAgICAgICAgICAgIHBsYXllci5zdGF0cy5TSCA9IE1hdGgubWluKDk5LCBzY2FsZShiYXNlLlNILCAwLjMpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMy4gSHVtYW4gUGxheWVyIEJvbnVzIChUaGUgIkhlcm8iIEZlZWwpCiAgICAgICAgICAgIC8vIEdpdmVzIHRoZSBwbGF5ZXIgYSBzbGlnaHQgZWRnZSB0byBtYWtlIGdhbWVwbGF5IGZlZWwgcHVuY2h5CiAgICAgICAgICAgIGlmIChpc0h1bWFuKSB7CiAgICAgICAgICAgICAgICBwbGF5ZXIuc3RhdHMuSFAgKz0gMTUwOyAvLyBUYW5raWVyCiAgICAgICAgICAgICAgICBwbGF5ZXIuc3RhdHMuU1AgKz0gNTsgICAvLyBGYXN0ZXIKICAgICAgICAgICAgICAgIHBsYXllci5zdGF0cy5FTiArPSA1OyAgIC8vIEhhcmRlciB0byB0YWNrbGUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gS2V5IFN0YXQgQm9vc3QKICAgICAgICAgICAgICAgIGlmIChyb2xlID09PSAnTEYnIHx8IHJvbGUgPT09ICdSRicpIHBsYXllci5zdGF0cy5TSCArPSA1OwogICAgICAgICAgICAgICAgaWYgKHJvbGUgPT09ICdNRicpIHBsYXllci5zdGF0cy5QQSArPSA1OwogICAgICAgICAgICAgICAgaWYgKHJvbGUgPT09ICdMRCcgfHwgcm9sZSA9PT0gJ1JEJykgcGxheWVyLnN0YXRzLkFUICs9IDU7CiAgICAgICAgICAgICAgICBpZiAocm9sZSA9PT0gJ0dMJykgcGxheWVyLnN0YXRzLkNBICs9IDU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDQuIEZpbmFsaXplCiAgICAgICAgICAgIHBsYXllci5zdGF0cy5tYXhIUCA9IHBsYXllci5zdGF0cy5IUDsKICAgICAgICAgICAgcGxheWVyLmxldmVsID0gbGV2ZWw7CiAgICAgICAgICAgIHBsYXllci5fdXBkYXRlRGVyaXZlZFN0YXRzKCk7CiAgICAgICAgfQoKY29uc3RydWN0b3Ioc2NlbmUsIGlkLCBzaWRlLCBjb2xvciwgaXNIdW1hbikgewogICAgICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7CiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDsgLy8gJ2hvbWUnIG9yICdhd2F5JwogICAgICAgICAgICB0aGlzLnNpZGUgPSBzaWRlOyAvLyAxIChEZWZlbmRzICtaKSBvciAtMSAoRGVmZW5kcyAtWikKICAgICAgICAgICAgdGhpcy5jb2xvciA9IGNvbG9yOwogICAgICAgICAgICB0aGlzLmlzSHVtYW4gPSBpc0h1bWFuOwogICAgICAgICAgICB0aGlzLmFpRW5hYmxlZCA9IHRydWU7IC8vIE1hc3RlciBzd2l0Y2ggZm9yIEFJIGxvZ2ljCiAgICAgICAgICAgIAogICAgICAgICAgICB0aGlzLnBsYXllcnMgPSBbXTsKICAgICAgICAgICAgdGhpcy5hY3RpdmVQbGF5ZXIgPSBudWxsOyAvLyBUaGUgcGxheWVyIGN1cnJlbnRseSBjb250cm9sbGVkL2ZvY3VzZWQKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEZvcm1hdGlvbiBBbmNob3JzCiAgICAgICAgICAgIHRoaXMuY3VycmVudEZvcm1hdGlvbiA9ICdOb3JtYWwnOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gUGxheWVyIEluZGljYXRvciAoR3JlZW4gQXJyb3cpCiAgICAgICAgICAgIGlmICh0aGlzLmlzSHVtYW4pIHsKICAgICAgICAgICAgICAgIHRoaXMucGxheWVyQXJyb3cgPSBuZXcgVEhSRUUuU3ByaXRlKF9wbGF5ZXJBcnJvd01hdGVyaWFsKTsKICAgICAgICAgICAgICAgIHRoaXMucGxheWVyQXJyb3cuc2NhbGUuc2V0KDAuOCwgMC44LCAxLjApOwogICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXJBcnJvdy5yZW5kZXJPcmRlciA9IDEwMDA7IC8vIE9uIHRvcAogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBhc3NpZ25NYXJrcyhvcHBvc2luZ1RlYW0pIHsKICAgICAgICAgICAgLy8gU2ltcGxlIGF1dG8tYXNzaWduIGxvZ2ljOiBNYXJrIHRoZSBwbGF5ZXIgaW4gdGhlICJtYXRjaGluZyIgcG9zaXRpb24KICAgICAgICAgICAgLy8gTEY8LT5SRCwgUkY8LT5MRCwgTUY8LT5NRiwgTEQ8LT5SRiwgUkQ8LT5MRiwgR0w8LT5MRgogICAgICAgICAgICB0aGlzLnBsYXllcnMuZm9yRWFjaChwID0+IHsKICAgICAgICAgICAgICAgIGxldCB0YXJnZXRSb2xlID0gJ01GJzsKICAgICAgICAgICAgICAgIHN3aXRjaCAocC5yb2xlKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnTEYnOiB0YXJnZXRSb2xlID0gJ1JEJzsgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnUkYnOiB0YXJnZXRSb2xlID0gJ0xEJzsgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnTUYnOiB0YXJnZXRSb2xlID0gJ01GJzsgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnTEQnOiB0YXJnZXRSb2xlID0gJ1JGJzsgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnUkQnOiB0YXJnZXRSb2xlID0gJ0xGJzsgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnR0wnOiB0YXJnZXRSb2xlID0gJ0xGJzsgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gb3Bwb3NpbmdUZWFtLnBsYXllcnMuZmluZChvcCA9PiBvcC5yb2xlID09PSB0YXJnZXRSb2xlKTsKICAgICAgICAgICAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICAgICAgICAgICAgICBwLm1hcmtpbmcgPSB0YXJnZXQ7CiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coYCR7dGhpcy5pZH0gJHtwLnJvbGV9IG1hcmtlZCAke3RhcmdldC5yb2xlfWApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGFkZFBsYXllcihwbGF5ZXIpIHsKICAgICAgICAgICAgdGhpcy5wbGF5ZXJzLnB1c2gocGxheWVyKTsKICAgICAgICAgICAgcGxheWVyLnRlYW0gPSB0aGlzOwoKICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIEhvbWUgUG9zaXRpb24gYmFzZWQgb24gRm9ybWF0aW9uCiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVBsYXllckhvbWVQb3NpdGlvbihwbGF5ZXIpOwoKICAgICAgICAgICAgLy8gRW5lbXkgaW5kaWNhdG9yOiByZWQgYXJyb3dzIG92ZXIgdGhlIEF3YXkgdGVhbSAoc28gZW5lbWllcyBhcmUgcmVhZGFibGUpCi8vIEVuZW15IGluZGljYXRvcjogcmVkIGFycm93cyBvdmVyIHRoZSBBd2F5IHRlYW0KICAgICAgICAgICAgaWYgKHRoaXMuaWQgPT09ICdhd2F5JyAmJiBwbGF5ZXIubWVzaCkgewogICAgICAgICAgICAgICAgY29uc3QgYXJyb3cgPSBuZXcgVEhSRUUuU3ByaXRlKF9lbmVteUFycm93TWF0ZXJpYWwpOwogICAgICAgICAgICAgICAgYXJyb3cuc2NhbGUuc2V0KDAuOCwgMC44LCAxLjApOwogICAgICAgICAgICAgICAgYXJyb3cucG9zaXRpb24uc2V0KDAsIDMuMiwgMCk7IC8vIGFib3ZlIGhlYWQKICAgICAgICAgICAgICAgIGFycm93LnJlbmRlck9yZGVyID0gOTk5OwogICAgICAgICAgICAgICAgcGxheWVyLm1lc2guYWRkKGFycm93KTsKICAgICAgICAgICAgICAgIHBsYXllci5lbmVteUFycm93ID0gYXJyb3c7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFRlYW1tYXRlIGluZGljYXRvcjogV2hpdGUgYXJyb3dzIGZvciBpbmFjdGl2ZSBodW1hbnMKICAgICAgICAgICAgaWYgKHRoaXMuaXNIdW1hbiAmJiBwbGF5ZXIubWVzaCkgewogICAgICAgICAgICAgICAgY29uc3QgYXJyb3cgPSBuZXcgVEhSRUUuU3ByaXRlKF90ZWFtbWF0ZUFycm93TWF0ZXJpYWwpOwogICAgICAgICAgICAgICAgYXJyb3cuc2NhbGUuc2V0KDAuNiwgMC42LCAxLjApOwogICAgICAgICAgICAgICAgYXJyb3cucG9zaXRpb24uc2V0KDAsIDMuMiwgMCk7CiAgICAgICAgICAgICAgICBhcnJvdy5yZW5kZXJPcmRlciA9IDk5OTsKICAgICAgICAgICAgICAgIGFycm93LnZpc2libGUgPSBmYWxzZTsgLy8gSGlkZGVuIGJ5IGRlZmF1bHQsIG1hbmFnZWQgYnkgc2V0QWN0aXZlUGxheWVyCiAgICAgICAgICAgICAgICBwbGF5ZXIubWVzaC5hZGQoYXJyb3cpOwogICAgICAgICAgICAgICAgcGxheWVyLnRlYW1tYXRlQXJyb3cgPSBhcnJvdzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgc2V0Rm9ybWF0aW9uKG5hbWUpIHsKICAgICAgICAgICAgaWYgKCFGT1JNQVRJT05TW25hbWVdKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuY3VycmVudEZvcm1hdGlvbiA9IG5hbWU7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGBUZWFtICR7dGhpcy5pZH0gc3dpdGNoZWQgdG8gJHtuYW1lfWApOwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5wbGF5ZXJzLmZvckVhY2gocCA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVQbGF5ZXJIb21lUG9zaXRpb24ocCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCl91cGRhdGVQbGF5ZXJIb21lUG9zaXRpb24ocGxheWVyKSB7CiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBGT1JNQVRJT05TW3RoaXMuY3VycmVudEZvcm1hdGlvbl07CiAgICAgICAgICAgIGlmICghZGF0YSkgcmV0dXJuOwoKICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gZGF0YVtwbGF5ZXIucm9sZV07CiAgICAgICAgICAgIGlmIChvZmZzZXQpIHsKICAgICAgICAgICAgICAgIC8vIFggUG9zaXRpb246CiAgICAgICAgICAgICAgICAvLyBGb3JtYXRpb25zOiAtWCBpcyBMZWZ0LCArWCBpcyBSaWdodC4KICAgICAgICAgICAgICAgIC8vIEhvbWUgVGVhbSAoU2lkZSAxKSBmYWNlcyAtWi4gTGVmdCBpcyAtWC4gVXNlIG9mZnNldC54IGFzIGlzLgogICAgICAgICAgICAgICAgbGV0IHhQb3MgPSBvZmZzZXQueDsKICAgICAgICAgICAgICAgIGxldCB6UG9zID0gb2Zmc2V0LnogKiB0aGlzLnNpZGU7CgogICAgICAgICAgICAgICAgcGxheWVyLmhvbWVQb3NpdGlvbi5zZXQoeFBvcywgMCwgelBvcyk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEF3YXkgVGVhbSAoU2lkZSAtMSkgZmFjZXMgK1ouIExlZnQgaXMgK1guIEZsaXAgWC4KICAgICAgICAgICAgICAgIGlmICh0aGlzLnNpZGUgPT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgcGxheWVyLmhvbWVQb3NpdGlvbi54ICo9IC0xOyAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU2V0IGluaXRpYWwgcG9zaXRpb24KICAgICAgICAgICAgaWYgKHBsYXllci5tZXNoKSB7CiAgICAgICAgICAgICAgICBwbGF5ZXIubWVzaC5wb3NpdGlvbi5jb3B5KHBsYXllci5ob21lUG9zaXRpb24pOwogICAgICAgICAgICAgICAgLy8gRmFjZSBjZW50ZXIgKDAsMCwwKQogICAgICAgICAgICAgICAgcGxheWVyLm1lc2gubG9va0F0KDAsIDAsIDApOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB1cGRhdGUoZHQpIHsKICAgICAgICAgICAgLy8gVXBkYXRlIGFsbCBwbGF5ZXJzCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbGF5ZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICB0aGlzLnBsYXllcnNbaV0udXBkYXRlKGR0KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQXV0by1zd2l0Y2ggYWN0aXZlIHBsYXllciBpZiBIdW1hbgogICAgICAgICAgICBpZiAodGhpcy5pc0h1bWFuKSB7CiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUFjdGl2ZVBsYXllclNlbGVjdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB1cGRhdGVBY3RpdmVQbGF5ZXJTZWxlY3Rpb24oKSB7CiAgICAgICAgICAgIGNvbnN0IGJhbGwgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZW50aXRpZXMuYmFsbDsKICAgICAgICAgICAgaWYgKCFiYWxsKSByZXR1cm47CgogICAgICAgICAgICAvLyAxLiBPRkZFTlNFOiBJZiB3ZSBoYXZlIHRoZSBiYWxsLCBhY3RpdmUgcGxheWVyIGlzIHRoZSBob2xkZXIKICAgICAgICAgICAgaWYgKGJhbGwuaG9sZGVyICYmIGJhbGwuaG9sZGVyLnRlYW0gPT09IHRoaXMpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZVBsYXllciAhPT0gYmFsbC5ob2xkZXIpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEFjdGl2ZVBsYXllcihiYWxsLmhvbGRlcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDIuIERFRkVOU0U6IFNlbGVjdCBjbG9zZXN0IHRvIGJhbGwKICAgICAgICAgICAgLy8gT3B0aW1pemF0aW9uOiBPbmx5IGNoZWNrIGV2ZXJ5IGZldyBmcmFtZXMgb3IgaWYgZGlzdGFuY2UgaXMgc2lnbmlmaWNhbnQKICAgICAgICAgICAgbGV0IGNsb3Nlc3QgPSBudWxsOwogICAgICAgICAgICBsZXQgbWluRHN0ID0gSW5maW5pdHk7CgogICAgICAgICAgICBmb3IgKGNvbnN0IHAgb2YgdGhpcy5wbGF5ZXJzKSB7CiAgICAgICAgICAgICAgICBpZiAocC5yb2xlID09PSAnR0wnKSBjb250aW51ZTsgLy8gRG9uJ3QgYXV0by1zd2l0Y2ggdG8gZ29hbGllIHVzdWFsbHkKICAgICAgICAgICAgICAgIGlmICghcC5tZXNoKSBjb250aW51ZTsKCiAgICAgICAgICAgICAgICBjb25zdCBkID0gcC5tZXNoLnBvc2l0aW9uLmRpc3RhbmNlVG8oYmFsbC5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgIGlmIChkIDwgbWluRHN0KSB7CiAgICAgICAgICAgICAgICAgICAgbWluRHN0ID0gZDsKICAgICAgICAgICAgICAgICAgICBjbG9zZXN0ID0gcDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGNsb3Nlc3QgJiYgY2xvc2VzdCAhPT0gdGhpcy5hY3RpdmVQbGF5ZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlUGxheWVyKGNsb3Nlc3QpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKc2V0QWN0aXZlUGxheWVyKHBsYXllcikgewogICAgICAgICAgICAvLyBSZXNldCBpbnB1dCBvbiBwcmV2aW91cwogICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVQbGF5ZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlUGxheWVyLnNldElucHV0KDAsIDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuYWN0aXZlUGxheWVyID0gcGxheWVyOwoKICAgICAgICAgICAgLy8gVmlzdWFsIEluZGljYXRvcnMKICAgICAgICAgICAgaWYgKHRoaXMuaXNIdW1hbikgewogICAgICAgICAgICAgICAgLy8gMS4gR3JlZW4gQXJyb3cgZm9yIEFjdGl2ZQogICAgICAgICAgICAgICAgaWYgKHRoaXMucGxheWVyQXJyb3cgJiYgcGxheWVyLm1lc2gpIHsKICAgICAgICAgICAgICAgICAgICBwbGF5ZXIubWVzaC5hZGQodGhpcy5wbGF5ZXJBcnJvdyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXJBcnJvdy5wb3NpdGlvbi5zZXQoMCwgMy41LCAwKTsgLy8gRmxvYXQgYWJvdmUgaGVhZAogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIDIuIFdoaXRlIEFycm93cyBmb3IgT3RoZXJzCiAgICAgICAgICAgICAgICB0aGlzLnBsYXllcnMuZm9yRWFjaChwID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAocC50ZWFtbWF0ZUFycm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHAudGVhbW1hdGVBcnJvdy52aXNpYmxlID0gKHAgIT09IHBsYXllcik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgpyZXNldFBvc2l0aW9ucygpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBwIG9mIHRoaXMucGxheWVycykgewogICAgICAgICAgICAgICAgaWYgKHAubWVzaCkgewogICAgICAgICAgICAgICAgICAgIHAubWVzaC5wb3NpdGlvbi5jb3B5KHAuaG9tZVBvc2l0aW9uKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBSZXNldCBQaHlzaWNzCiAgICAgICAgICAgICAgICAgICAgcC52ZWxvY2l0eS5zZXQoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgcC5pbnB1dFZlY3Rvci5zZXQoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgcC5pc0Rhc2hpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBwLmlzVGhyb3dpbmcgPSBmYWxzZTsKcC5sb3NlQmFsbCgpOyAvLyBEcm9wIGJhbGwgaWYgaG9sZGluZwogICAgICAgICAgICAgICAgICAgIHAuY2FuQ2F0Y2ggPSB0cnVlOyAvLyBGb3JjZSByZXNldCBjYXBhYmlsaXR5CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gUmVzZXQgU3RhdHMKICAgICAgICAgICAgICAgICAgICBwLmN1cnJlbnRFTiA9IHAuc3RhdHMuRU47CiAgICAgICAgICAgICAgICAgICAgCi8vIE9yaWVudGF0aW9uOiBGYWNlIENlbnRlcgogICAgICAgICAgICAgICAgICAgIHAubWVzaC5sb29rQXQoMCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHAuc3luY1JvdGF0aW9uKSBwLnN5bmNSb3RhdGlvbigpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFJlc2V0IEFuaW1hdGlvbgogICAgICAgICAgICAgICAgICAgIHAucGxheSgnaWRsZScsIDAuMSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gUmVzZXQgYWN0aXZlIHBsYXllciB0byBNRgogICAgICAgICAgICBjb25zdCBtZiA9IHRoaXMucGxheWVycy5maW5kKHAgPT4gcC5yb2xlID09PSAnTUYnKTsKICAgICAgICAgICAgaWYgKG1mKSB0aGlzLnNldEFjdGl2ZVBsYXllcihtZik7CiAgICAgICAgfQogICAgfQoKICAgIHdpbmRvdy5mbHV4LlRlYW0gPSBUZWFtOwp9KSgpOw==","Goalie.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKICAgIAogICAgLy8gUmV1c2FibGUgdmVjdG9ycyB0byBhdm9pZCBHQwpjb25zdCBfZ1ZlYyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfZ1BvcyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfYmFsbFBvcyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfZmFjZVZlYyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfZ29hbENlbnRlciA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfdGVtcFZlY0cgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwoKICAgIGNsYXNzIEdvYWxpZSBleHRlbmRzIHdpbmRvdy5mbHV4LlBsYXllciB7CmNvbnN0cnVjdG9yKHNjZW5lLCByb2xlKSB7CiAgICAgICAgICAgIHN1cGVyKHNjZW5lLCByb2xlKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEdvYWxpZSBTcGVjaWZpYyBTdGF0cyAoQnVmZmVkIGZvciBQbGF5YWJpbGl0eSkKICAgICAgICAgICAgdGhpcy5zdGF0cy5DQSA9IDMwOyAvLyBDYXRjaAogICAgICAgICAgICB0aGlzLnN0YXRzLlNQID0gNDA7IC8vIFNwZWVkCiAgICAgICAgICAgIHRoaXMuc3RhdHMuRU4gPSA1MDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEJVRkZFRDogU3Ryb25nIGFybSBmb3IgY2xlYXJpbmcgdGhlIHpvbmUKICAgICAgICAgICAgdGhpcy5zdGF0cy5QQSA9IDQ1OyAvLyBXYXMgMjAgLSBOb3cgc3Ryb25nIGVub3VnaCB0byByZWFjaCBtaWRmaWVsZAogICAgICAgICAgICB0aGlzLnN0YXRzLlNIID0gMzU7IC8vIFdhcyAxMCAtIERlY2VudCBjbGVhcmFuY2Uga2ljawogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5fdXBkYXRlRGVyaXZlZFN0YXRzKCk7CgogICAgICAgICAgICAvLyBHb2FsIERpbWVuc2lvbnMgKFNhdmUgQm94KQovLyBHb2FsIERpbWVuc2lvbnMgKFNhdmUgQm94KSAtIE1hdGNoZXMgR2FtZU1hbmFnZXIgZGV0ZWN0aW9uCnRoaXMuZ29hbFdpZHRoID0gMzMuMDsgLy8gSW5jcmVhc2VkIDUwJSAod2FzIDIyLjApCiAgICAgICAgICAgIHRoaXMuZ29hbEhlaWdodCA9IDI3LjA7IC8vIEluY3JlYXNlZCA1MCUgKHdhcyAxOC4wKQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU2F2ZSBNZWNoYW5pY3MKICAgICAgICAgICAgdGhpcy5zYXZlUmFkaXVzID0gNi4wOyAKICAgICAgICAgICAgdGhpcy5wcmVzc3VyZU11bHRpcGxpZXIgPSA1LjA7IAogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVGVjaHMKICAgICAgICAgICAgdGhpcy50ZWNocyA9IHsKICAgICAgICAgICAgICAgIGFjdGl2ZTogbnVsbCwgCiAgICAgICAgICAgICAgICBwYXNzaXZlOiBudWxsIAogICAgICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQUkgU3RhdGUKICAgICAgICAgICAgdGhpcy50aHJvd1RpbWVyID0gMDsKICAgICAgICAgICAgdGhpcy5fYWNjdW11bGF0ZWRTYXZlID0gMDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFN1cGVyIEdvYWxpZSBTdGF0ZQogICAgICAgICAgICB0aGlzLmlzU3VwZXJHb2FsaWUgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5zdXBlckdvYWxpZVRpbWVyID0gMDsKICAgICAgICB9Cgp1cGRhdGUoZHQpIHsKICAgICAgICAgICAgLy8gMS4gU3VwZXIgR29hbGllIFRpbWVyCiAgICAgICAgICAgIGlmICh0aGlzLmlzU3VwZXJHb2FsaWUpIHsKICAgICAgICAgICAgICAgIHRoaXMuc3VwZXJHb2FsaWVUaW1lciAtPSBkdDsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnN1cGVyR29hbGllVGltZXIgPD0gMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaXNTdXBlckdvYWxpZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAyLiBQb3NzZXNzaW9uIExvZ2ljIChCYWxsIEhlbGQpCiAgICAgICAgICAgIGlmICh0aGlzLmhhc0JhbGwpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2NoZWNrVGFja2xlUHJlc3N1cmUoZHQpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBnYW1lID0gd2luZG93LmZsdXguZ2FtZUluc3RhbmNlOwogICAgICAgICAgICAgICAgY29uc3QgaXNIdW1hbkNvbnRyb2xsZWQgPSB0aGlzLnRlYW0gJiYgdGhpcy50ZWFtLmlzSHVtYW4gJiYgdGhpcy50ZWFtLmFjdGl2ZVBsYXllciA9PT0gdGhpcyAmJiAhZ2FtZS5pc0RlbW9Nb2RlOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoaXNIdW1hbkNvbnRyb2xsZWQpIHsKICAgICAgICAgICAgICAgICAgICAvLyBIdW1hbjogRnVsbCBjb250cm9sIChSb3RhdGlvbiwgQ2hhcmdpbmcsIGV0YyB2aWEgUGxheWVyLnVwZGF0ZSkKICAgICAgICAgICAgICAgICAgICBzdXBlci51cGRhdGUoZHQpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBBSTogTG9naWMgdGhlbiB1cGRhdGUKICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNUaHJvd2luZykgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9haVBvc3Nlc3Npb25Mb2dpYyhkdCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vIEVuc3VyZSBBSSBkb2Vzbid0IGRyaWZ0CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRJbnB1dCgwLCAwKTsKICAgICAgICAgICAgICAgICAgICBzdXBlci51cGRhdGUoZHQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5fY29uc3RyYWluQm91bmRzKCk7CiAgICAgICAgICAgICAgICByZXR1cm47IAogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAzLiBEZWZlbnNlIC8gU2F2ZSBMb2dpYyAoTm8gQmFsbCkKICAgICAgICAgICAgLy8gV2UgbXVzdCBoYW5kbGUgdGltZXJzIGFuZCBzdGF0dXMgbWFudWFsbHkgYmVjYXVzZSB3ZSBza2lwIHN1cGVyLnVwZGF0ZSgpIHRvIHVzZSBjdXN0b20gbW92ZW1lbnQKICAgICAgICAgICAgaWYgKHRoaXMuZGFzaENvb2xkb3duID4gMCkgdGhpcy5kYXNoQ29vbGRvd24gLT0gZHQ7CiAgICAgICAgICAgIGlmICh0aGlzLmNsYXNoQ29vbGRvd24gPiAwKSB0aGlzLmNsYXNoQ29vbGRvd24gLT0gZHQ7CiAgICAgICAgICAgIGlmICh0aGlzLnN0dW5UaW1lciA+IDApIHRoaXMuc3R1blRpbWVyIC09IGR0OwogICAgICAgICAgICBpZiAodGhpcy5pbW11bml0eVRpbWVyID4gMCkgdGhpcy5pbW11bml0eVRpbWVyIC09IGR0OwoKICAgICAgICAgICAgdGhpcy5fdXBkYXRlU3RhdHVzKGR0KTsKCiAgICAgICAgICAgIGlmICh0aGlzLnN0dW5UaW1lciA+IDAgfHwgdGhpcy5zdGF0dXMubmFwID4gMCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMubWl4ZXIpIHRoaXMubWl4ZXIudXBkYXRlKGR0KTsKICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUhQQmFyKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9jb25zdHJhaW5Cb3VuZHMoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQ3VzdG9tIE1vdmVtZW50CiAgICAgICAgICAgIHRoaXMuX2RlZmVuc2VMb2dpYyhkdCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBVcGRhdGUgQW5pbWF0aW9uCiAgICAgICAgICAgIGlmICh0aGlzLm1peGVyKSB0aGlzLm1peGVyLnVwZGF0ZShkdCk7CiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUhQQmFyKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICB0aGlzLl9jb25zdHJhaW5Cb3VuZHMoKTsKICAgICAgICB9CgpfY29uc3RyYWluQm91bmRzKCkgewogICAgICAgICAgICBpZiAoIXRoaXMubWVzaCkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBwb3MgPSB0aGlzLm1lc2gucG9zaXRpb247CiAgICAgICAgICAgIGNvbnN0IHNpZGUgPSB0aGlzLnRlYW0gPyB0aGlzLnRlYW0uc2lkZSA6IDE7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBYIEJvdW5kcyAoV2lkdGggb2YgcGVuYWx0eSBhcmVhICsvLSAxMG0pIC0+IEluY3JlYXNlZCBmb3IgbWFzc2l2ZSBnb2FsCiAgICAgICAgICAgIGNvbnN0IHhMaW1pdCA9IDMwLjA7IC8vIE1heCB3aWR0aCBvZiBhcmVuYSAoUmFkaXVzIDMyKQogICAgICAgICAgICBpZiAocG9zLnggPiB4TGltaXQpIHsgcG9zLnggPSB4TGltaXQ7IHRoaXMudmVsb2NpdHkueCA9IDA7IH0KICAgICAgICAgICAgaWYgKHBvcy54IDwgLXhMaW1pdCkgeyBwb3MueCA9IC14TGltaXQ7IHRoaXMudmVsb2NpdHkueCA9IDA7IH0KICAgICAgICAgICAgCi8vIFkgQm91bmRzIChIZWlnaHQgKy8tIDE1bSkgLT4gSW5jcmVhc2VkIGZvciBtYXNzaXZlIGdvYWwgaGlnaCBzYXZlcwogICAgICAgICAgICBjb25zdCB5TGltaXQgPSAyMi41OyAvLyBJbmNyZWFzZWQgNTAlICh3YXMgMTUuMCkKICAgICAgICAgICAgaWYgKHBvcy55ID4geUxpbWl0KSB7IHBvcy55ID0geUxpbWl0OyB0aGlzLnZlbG9jaXR5LnkgPSAwOyB9CiAgICAgICAgICAgIGlmIChwb3MueSA8IC15TGltaXQpIHsgcG9zLnkgPSAteUxpbWl0OyB0aGlzLnZlbG9jaXR5LnkgPSAwOyB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBaIEJvdW5kcyAoRGVwdGgpCiAgICAgICAgICAgIC8vIEhvbWUgKFNpZGUgMSk6IEdvYWwgYXQgKzI4LiBUcmlnZ2VyIGF0IDI3LiBMaW1pdCB0byAyNi41IHRvIHByZXZlbnQgd2Fsa2luZyBpbi4KICAgICAgICAgICAgLy8gQXdheSAoU2lkZSAtMSk6IEdvYWwgYXQgLTI4LiBUcmlnZ2VyIGF0IC0yNy4gTGltaXQgdG8gLTI2LjUuCiAgICAgICAgICAgIGlmIChzaWRlID09PSAxKSB7CiAgICAgICAgICAgICAgICBpZiAocG9zLnogPiAyNi41KSB7IHBvcy56ID0gMjYuNTsgdGhpcy52ZWxvY2l0eS56ID0gMDsgfQogICAgICAgICAgICAgICAgaWYgKHBvcy56IDwgMTIuMCkgeyBwb3MueiA9IDEyLjA7IHRoaXMudmVsb2NpdHkueiA9IDA7IH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChwb3MueiA8IC0yNi41KSB7IHBvcy56ID0gLTI2LjU7IHRoaXMudmVsb2NpdHkueiA9IDA7IH0KICAgICAgICAgICAgICAgIGlmIChwb3MueiA+IC0xMi4wKSB7IHBvcy56ID0gLTEyLjA7IHRoaXMudmVsb2NpdHkueiA9IDA7IH0KICAgICAgICAgICAgfQogICAgICAgIH0KCi8vIE92ZXJyaWRlIHRocm93QmFsbCB0byBmaXggIndlYWsgdGhyb3ciIGlzc3VlCi8vIE92ZXJyaWRlIHRocm93QmFsbCB0byBmaXggIndlYWsgdGhyb3ciIGlzc3VlCiAgICAgICAgdGhyb3dCYWxsKGJhbGwsIGZvcmNlZFR5cGUgPSBudWxsLCBwb3dlck11bHRpcGxpZXIgPSAxLjApIHsKICAgICAgICAgICAgLy8gR29hbGllcyBhbG1vc3QgYWx3YXlzIFBBU1MsIGV2ZW4gd2hlbiAiY2xlYXJpbmciIGZvcndhcmQuCiAgICAgICAgICAgIC8vIFRoZSBkZWZhdWx0IFBsYXllciBsb2dpYyBzd2l0Y2hlcyB0byAnU0gnIChTaG9vdCkgaWYgYWltaW5nIGZvcndhcmQsIAogICAgICAgICAgICAvLyB3aGljaCB1c2VzIHRoZSBHb2FsaWUncyBsb3dlciBTSCBzdGF0LiBXZSBmb3JjZSBQQSB1bmxlc3Mgc3BlY2lmaWVkLgogICAgICAgICAgICBjb25zdCB0eXBlID0gZm9yY2VkVHlwZSB8fCAnUEEnOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQk9PU1Q6IEFwcGx5IGEgbXVsdGlwbGllciB0byBlbnN1cmUgdGhlIGdvYWxpZSBjYW4gY2xlYXIgdGhlIGJhbGwgdG8gbWlkZmllbGQuCiAgICAgICAgICAgIC8vIE5FUkZFRDogUmVkdWNlZCBmcm9tIDEuNiB0byAxLjIgdG8gcHJldmVudCBjcm9zcy1tYXAgdGhyb3dzIGFzIHBlciB1c2VyIGZlZWRiYWNrLgogICAgICAgICAgICBjb25zdCBib29zdCA9IDEuMjsKCiAgICAgICAgICAgIHN1cGVyLnRocm93QmFsbChiYWxsLCB0eXBlLCBwb3dlck11bHRpcGxpZXIgKiBib29zdCk7CiAgICAgICAgfQoKX2RlZmVuc2VMb2dpYyhkdCkgewogICAgICAgICAgICAvLyAwLiBHYW1lIFN0YXRlIENoZWNrCiAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2Uuc3RhdGUgIT09ICdhY3RpdmUnKSByZXR1cm47CgogICAgICAgICAgICBjb25zdCBiYWxsID0gd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmVudGl0aWVzLmJhbGw7CiAgICAgICAgICAgIGlmICghYmFsbCB8fCAhYmFsbC5tZXNoKSByZXR1cm47CgogICAgICAgICAgICAvLyBEZXRlcm1pbmUgVGhyZWF0IFNvdXJjZQogICAgICAgICAgICBsZXQgdGhyZWF0UG9zID0gX2JhbGxQb3M7CiAgICAgICAgICAgIGxldCBpc1RocmVhdCA9IGZhbHNlOwogICAgICAgICAgICBjb25zdCBteUdvYWxaID0gKHRoaXMudGVhbS5zaWRlID09PSAxKSA/IDI4IDogLTI4OwoKICAgICAgICAgICAgLy8gQ2FzZSBBOiBCYWxsIGlzIEhlbGQgKFByZS10aHJvdykKICAgICAgICAgICAgaWYgKGJhbGwuc3RhdGUgPT09ICdoZWxkJyAmJiBiYWxsLmhvbGRlciAmJiBiYWxsLmhvbGRlci50ZWFtICE9PSB0aGlzLnRlYW0pIHsKICAgICAgICAgICAgICAgIHRocmVhdFBvcyA9IGJhbGwuaG9sZGVyLm1lc2gucG9zaXRpb247CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIGhvbGRlciBpcyBpbiBhdHRhY2tpbmcgaGFsZiBvciBuZWFyIGVub3VnaAogICAgICAgICAgICAgICAgY29uc3QgZGlzdFRvR29hbCA9IE1hdGguYWJzKHRocmVhdFBvcy56IC0gbXlHb2FsWik7CiAgICAgICAgICAgICAgICBpZiAoZGlzdFRvR29hbCA8IDQwLjApIHsgLy8gSWYgdGhleSBhcmUgd2l0aGluIDQwbSwgdHJhY2sgdGhlbQogICAgICAgICAgICAgICAgICAgIGlzVGhyZWF0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSAKICAgICAgICAgICAgLy8gQ2FzZSBCOiBCYWxsIGlzIEZyZWUgKFNob3QvUGFzcykKICAgICAgICAgICAgZWxzZSBpZiAoYmFsbC5zdGF0ZSA9PT0gJ2ZyZWUnKSB7CiAgICAgICAgICAgICAgICB0aHJlYXRQb3MgPSBiYWxsLm1lc2gucG9zaXRpb247CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIERpcmVjdGlvbiBDaGVjawogICAgICAgICAgICAgICAgY29uc3QgbW92aW5nVG93YXJkcyA9ICh0aGlzLnRlYW0uc2lkZSA9PT0gMSAmJiBiYWxsLnZlbG9jaXR5LnogPiAwKSB8fCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAodGhpcy50ZWFtLnNpZGUgPT09IC0xICYmIGJhbGwudmVsb2NpdHkueiA8IDApOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBQb3NpdGlvbiBDaGVjawogICAgICAgICAgICAgICAgY29uc3QgaW5Gcm9udE9mR29hbCA9ICh0aGlzLnRlYW0uc2lkZSA9PT0gMSAmJiB0aHJlYXRQb3MueiA8IDI3LjUpIHx8IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLnRlYW0uc2lkZSA9PT0gLTEgJiYgdGhyZWF0UG9zLnogPiAtMjcuNSk7CgogICAgICAgICAgICAgICAgaXNUaHJlYXQgPSBtb3ZpbmdUb3dhcmRzICYmIGluRnJvbnRPZkdvYWw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChpc1RocmVhdCkgewogICAgICAgICAgICAgICAgLy8gLS0tIFBPU0lUSU9OSU5HOiBBTkdMRSBDVVRUSU5HIC0tLQogICAgICAgICAgICAgICAgX2JhbGxQb3MuY29weSh0aHJlYXRQb3MpOyAvLyBVcGRhdGUgcmVmZXJlbmNlIGZvciBsb29rQXQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gMS4gQ2FsY3VsYXRlIEdvYWwgQ2VudGVyCi8vIDEuIENhbGN1bGF0ZSBHb2FsIENlbnRlciAoQWRqdXN0ZWQgZm9yIFkgb2Zmc2V0KQogICAgICAgICAgICAgICAgX2dvYWxDZW50ZXIuc2V0KDAsIC0yLjIsIG15R29hbFopOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyAyLiBWZWN0b3IgZnJvbSBHb2FsIHRvIEJhbGwKICAgICAgICAgICAgICAgIF90ZW1wVmVjRy5zdWJWZWN0b3JzKF9iYWxsUG9zLCBfZ29hbENlbnRlcik7CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0VG9CYWxsID0gX3RlbXBWZWNHLmxlbmd0aCgpOwogICAgICAgICAgICAgICAgX3RlbXBWZWNHLm5vcm1hbGl6ZSgpOyAvLyBOb3cgaG9sZHMgZGlyZWN0aW9uCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIDMuIERldGVybWluZSBFeHRlbnNpb24gKEhvdyBmYXIgb3V0IHRvIHN0ZXApCiAgICAgICAgICAgICAgICAvLyBCYXNlOiAxLjVtIG9mZiBsaW5lLgogICAgICAgICAgICAgICAgLy8gTWF4OiA2LjBtIG9mZiBsaW5lIChDdXR0aW5nIGFuZ2xlKS4KICAgICAgICAgICAgICAgIC8vIFNjYWxlIGJhc2VkIG9uIGJhbGwgcHJveGltaXR5OiBDbG9zZXIgYmFsbCA9IE1vcmUgZXh0ZW5zaW9uICh0byBhIHBvaW50KQpsZXQgZXh0ZW5zaW9uID0gMS41OwogICAgICAgICAgICAgICAgaWYgKGRpc3RUb0JhbGwgPCAzMC4wKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmF0aW8gPSAxLjAgLSAoTWF0aC5tYXgoMCwgZGlzdFRvQmFsbCAtIDUuMCkgLyAyNS4wKTsgCiAgICAgICAgICAgICAgICAgICAgZXh0ZW5zaW9uID0gMS41ICsgKDQuNSAqIHJhdGlvKTsgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKLy8gU2FmZXR5OiBEb24ndCBnbyBwYXN0IHRoZSBiYWxsIChrZWVwIDFtIGJ1ZmZlcikKICAgICAgICAgICAgICAgIGV4dGVuc2lvbiA9IE1hdGgubWluKGV4dGVuc2lvbiwgZGlzdFRvQmFsbCAtIDEuMCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIDQuIENhbGN1bGF0ZSBUYXJnZXQgUG9zaXRpb24gKEJhc2UgSW50ZXJjZXB0aW9uKQogICAgICAgICAgICAgICAgX2dQb3MuY29weShfZ29hbENlbnRlcikuYWRkKF90ZW1wVmVjRy5tdWx0aXBseVNjYWxhcihleHRlbnNpb24pKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gNS4gVmVydGljYWwgT3ZlcnJpZGUgKEp1bXAgdG8gbWVldCBiYWxsKQogICAgICAgICAgICAgICAgLy8gRXhwbGljaXRseSBzZXQgWSB0byBtYXRjaCBiYWxsIGhlaWdodCBpZiBpdCdzIGhpZ2gKICAgICAgICAgICAgICAgIGlmIChfYmFsbFBvcy55ID4gMC41KSB7CiAgICAgICAgICAgICAgICAgICAgX2dQb3MueSA9IF9iYWxsUG9zLnk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIF9nUG9zLnkgPSAwLjU7IC8vIERlZmF1bHQgc3RhbmNlCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gNi4gQ2xhbXAgdG8gR29hbCBCb3ggRGltZW5zaW9ucyAoTGF0ZXJhbC9WZXJ0aWNhbCBMaW1pdHMpCiAgICAgICAgICAgICAgICAvLyBHb2FsIFdpZHRoIDIyICgrLy0gMTEpLCBIZWlnaHQgMTggKCsvLSA5KS4KICAgICAgICAgICAgICAgIC8vIEFsbG93IHNsaWdodGx5IG91dHNpZGUgcG9zdHMgdG8gY292ZXIgYW5nbGVzLgogICAgICAgICAgICAgICAgY29uc3QgY2xhbXBYID0gdGhpcy5nb2FsV2lkdGggKiAwLjY7IC8vICsvLSAxMy4yCmNvbnN0IGNsYW1wWSA9IDIxLjA7IC8vIEFsbG93IGhpZ2gganVtcHMgdXAgdG8gMjFtICh3YXMgMTQuMCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX2dQb3MueCA9IE1hdGgubWF4KC1jbGFtcFgsIE1hdGgubWluKGNsYW1wWCwgX2dQb3MueCkpOwogICAgICAgICAgICAgICAgX2dQb3MueSA9IE1hdGgubWF4KC1jbGFtcFksIE1hdGgubWluKGNsYW1wWSwgX2dQb3MueSkpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyA2LiBMZWFkIHRoZSBiYWxsIHNsaWdodGx5IGlmIGl0IGhhcyBsYXRlcmFsIHZlbG9jaXR5IChBbnRpY2lwYXRpb24pCmlmIChiYWxsLnZlbG9jaXR5Lmxlbmd0aFNxKCkgPiAxLjApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBhbnRpY2lwYXRpb24gPSBiYWxsLnZlbG9jaXR5LmNsb25lKCkubXVsdGlwbHlTY2FsYXIoMC4yNSk7IC8vIDAuMjVzIGxlYWQKICAgICAgICAgICAgICAgICAgICBhbnRpY2lwYXRpb24ueiA9IDA7IC8vIE9ubHkgbGF0ZXJhbCBsZWFkCiAgICAgICAgICAgICAgICAgICAgX2dQb3MuYWRkKGFudGljaXBhdGlvbik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gQ0xBTVAgWjogUHJldmVudCBHb2FsaWUgZnJvbSBnb2luZyBpbnRvIHRoZSBuZXQgb3IgYmVoaW5kIGdvYWwKLy8gQ0xBTVAgWjogUHJldmVudCBHb2FsaWUgZnJvbSBnb2luZyBpbnRvIHRoZSBuZXQgb3IgYmVoaW5kIGdvYWwKICAgICAgICAgICAgICAgIGlmICh0aGlzLnRlYW0uc2lkZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgIF9nUG9zLnogPSBNYXRoLm1pbigyNi41LCBfZ1Bvcy56KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgX2dQb3MueiA9IE1hdGgubWF4KC0yNi41LCBfZ1Bvcy56KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBNb3ZlIHRvd2FyZHMgdGFyZ2V0CiAgICAgICAgICAgICAgICBjb25zdCBtb3ZlRGlyID0gX2dWZWMuc3ViVmVjdG9ycyhfZ1BvcywgdGhpcy5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgIGNvbnN0IGRpc3RUb1RhcmdldCA9IG1vdmVEaXIubGVuZ3RoKCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChkaXN0VG9UYXJnZXQgPiAwLjEpIHsKICAgICAgICAgICAgICAgICAgICBtb3ZlRGlyLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgICAgIC8vIEJ1cnN0IHNwZWVkIGZvciBzYXZlcyBpZiBiYWxsIGlzIGNsb3NlCiAgICAgICAgICAgICAgICAgICAgY29uc3QgdXJnZW5jeSA9IChkaXN0VG9CYWxsIDwgMTAuMCkgPyAxLjUgOiAxLjA7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3BlZWQgPSB0aGlzLm1heFNwZWVkICogdXJnZW5jeTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB0aGlzLm1lc2gucG9zaXRpb24uYWRkKG1vdmVEaXIubXVsdGlwbHlTY2FsYXIoc3BlZWQgKiBkdCkpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEZhY2UgYmFsbAogICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5sb29rQXQoX2JhbGxQb3MpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSAnc3dpbScpIHRoaXMucGxheSgnc3dpbScsIDAuMik7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSAnaWRsZScpIHRoaXMucGxheSgnaWRsZScsIDAuMik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNoLmxvb2tBdChfYmFsbFBvcyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gLS0tIFNBVkUgTUVDSEFOSUMgLS0tCiAgICAgICAgICAgICAgICAvLyBJZiBiYWxsIGlzIHdpdGhpbiByYW5nZSwgYXBwbHkgQ0EgcHJlc3N1cmUKICAgICAgICAgICAgICAgIGNvbnN0IGRpc3QgPSB0aGlzLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyhiYWxsLm1lc2gucG9zaXRpb24pOwogICAgICAgICAgICAgICAgaWYgKGRpc3QgPCB0aGlzLnNhdmVSYWRpdXMpIHsgCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXBwbHlTYXZlUHJlc3N1cmUoYmFsbCwgZHQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gLS0tIElETEUgLyBSRVRVUk4gVE8gUE9TVCAtLS0KICAgICAgICAgICAgICAgIC8vIFJldHVybiB0byBob21lIHBvc2l0aW9uICh1c3VhbGx5IGNlbnRlciBvZiBnb2FsKQogICAgICAgICAgICAgICAgX2dQb3MuY29weSh0aGlzLmhvbWVQb3NpdGlvbik7CiAgICAgICAgICAgICAgICBjb25zdCBtb3ZlRGlyID0gX2dWZWMuc3ViVmVjdG9ycyhfZ1BvcywgdGhpcy5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKG1vdmVEaXIubGVuZ3RoKCkgPiAwLjUpIHsKICAgICAgICAgICAgICAgICAgICBtb3ZlRGlyLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi5hZGQobW92ZURpci5tdWx0aXBseVNjYWxhcih0aGlzLm1heFNwZWVkICogMC42ICogZHQpKTsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSAhPT0gJ3N3aW0nKSB0aGlzLnBsYXkoJ3N3aW0nLCAwLjIpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSAhPT0gJ2lkbGUnKSB0aGlzLnBsYXkoJ2lkbGUnLCAwLjIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBGYWNlIGNlbnRlciBmaWVsZAogICAgICAgICAgICAgICAgdGhpcy5tZXNoLmxvb2tBdCgwLCAwLCAwKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX2FwcGx5U2F2ZVByZXNzdXJlKGJhbGwsIGR0KSB7CiAgICAgICAgICAgIC8vIElmIEdvYWxpZSBpcyBBc2xlZXAsIHRoZXkgY2Fubm90IHNhdmUuCiAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cy5uYXAgPiAwKSByZXR1cm47CgogICAgICAgICAgICAvLyAtLS0gU1VQRVIgR09BTElFIFRSSUdHRVIgLS0tCiAgICAgICAgICAgIC8vIFRyaWdnZXIgaWY6IFRlY2ggZXF1aXBwZWQsIE5vdCBhY3RpdmUsIEJhbGwgaGFzIHBvd2VyLCBCYWxsIGlzIGNsb3NlCiAgICAgICAgICAgIGlmICh0aGlzLnRlY2hzLmFjdGl2ZSA9PT0gJ3N1cGVyX2dvYWxpZScgJiYgIXRoaXMuaXNTdXBlckdvYWxpZSAmJiBiYWxsLnBvd2VyID4gNS4wKSB7CiAgICAgICAgICAgICAgICAvLyBDaGFuY2UgdG8gdHJpZ2dlciAoSGlnaCBjaGFuY2UgZm9yIEFJLCBvciBjaGVjayBIUCkKICAgICAgICAgICAgICAgIC8vIENvc3Q6IDEwIEhQCiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0cy5IUCA+PSAxMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdHMuSFAgLT0gMTA7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc1N1cGVyR29hbGllID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnN1cGVyR29hbGllVGltZXIgPSAxLjU7IC8vIExhc3RzIDEuNXMKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgJHt0aGlzLnJvbGV9IHVzZWQgU1VQRVIgR09BTElFIWApOwogICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIlNVUEVSIEdPQUxJRSEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJzYXZlIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFRyaWdnZXIgVGVjaGNvcHkgRXZlbnQKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlICYmIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS50cmlnZ2VyVGVjaEV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS50cmlnZ2VyVGVjaEV2ZW50KHRoaXMsICdzdXBlcl9nb2FsaWUnKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBFZmZlY3RpdmUgQ0EKICAgICAgICAgICAgbGV0IGNhID0gdGhpcy5nZXRTdGF0KCdDQScpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQXBwbHkgU3VwZXIgR29hbGllIEJvbnVzIChlLmcuICs1MCUgKyBGbGF0IDEwKQogICAgICAgICAgICBpZiAodGhpcy5pc1N1cGVyR29hbGllKSB7CiAgICAgICAgICAgICAgICBjYSA9IChjYSAqIDEuNSkgKyAxMDsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQXBwbHkgR3JpcCBHbG92ZXMgKFBhc3NpdmUpCiAgICAgICAgICAgIGlmICh0aGlzLnRlY2hzLnBhc3NpdmUgPT09ICdncmlwX2dsb3ZlcycpIHsKICAgICAgICAgICAgICAgIGNhICs9IDU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBQcmVzc3VyZQogICAgICAgICAgICAvLyBQcmVzc3VyZSA9IENBICogZHQgKiBNdWx0aXBsaWVyCiAgICAgICAgICAgIGNvbnN0IHByZXNzdXJlID0gY2EgKiBkdCAqIHRoaXMucHJlc3N1cmVNdWx0aXBsaWVyOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGJhbGwucG93ZXIgPiAwKSB7CiAgICAgICAgICAgICAgICBiYWxsLnBvd2VyIC09IHByZXNzdXJlOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBWaXN1YWwgRmVlZGJhY2sKICAgICAgICAgICAgICAgIHRoaXMuX2FjY3VtdWxhdGVkU2F2ZSArPSBwcmVzc3VyZTsKICAgICAgICAgICAgICAgIC8vIFRIUk9UVExFOiBJbmNyZWFzZWQgdGhyZXNob2xkIHRvIDEyLjAKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9hY2N1bXVsYXRlZFNhdmUgPj0gMTIuMCkgeyAKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJCTE9DSyEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJjb21pYy1pbXBhY3QiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWNjdW11bGF0ZWRTYXZlID0gMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQXBwbHkgQmFsbCBUZWNobmlxdWUgdG8gR29hbGllIChSaXNrIG9mIGNhdGNoaW5nIHNwZWNpYWwgc2hvdHMpCiAgICAgICAgICAgIGlmIChiYWxsLnRlY2huaXF1ZSAmJiAhdGhpcy5fdGVjaEFwcGxpZWQpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3RlY2hBcHBsaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGNvbnN0IHRlY2ggPSBiYWxsLnRlY2huaXF1ZTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKHRlY2gudHlwZSA9PT0gJ3Zlbm9tJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwbHlTdGF0dXMoJ3Zlbm9tJywgMTUuMCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRlY2gudHlwZSA9PT0gJ25hcCcpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGx5U3RhdHVzKCduYXAnLCA4LjApOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0ZWNoLnR5cGUgPT09ICd3aXRoZXInKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBseVN0YXR1cygnd2l0aGVyJywgMTUuMCwgJ0NBJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsgdGhpcy5fdGVjaEFwcGxpZWQgPSBmYWxzZTsgfSwgMjAwMCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIENoZWNrIFJlc3VsdAogICAgICAgICAgICBpZiAoYmFsbC5wb3dlciA8PSAwKSB7CiAgICAgICAgICAgICAgICAvLyBDQVRDSAogICAgICAgICAgICAgICAgdGhpcy5jYXRjaEJhbGwoYmFsbCk7CiAgICAgICAgICAgIH0gCiAgICAgICAgfQoKICAgICAgICBjYXRjaEJhbGwoYmFsbCkgewogICAgICAgICAgICBiYWxsLmdyYWIodGhpcyk7CiAgICAgICAgICAgIHRoaXMucGxheSgnY2F0Y2gnLCAwLjEpOwogICAgICAgICAgICBjb25zb2xlLmxvZygiU0FWRUQgYnkgIiArIHRoaXMucm9sZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBFWFAgUkVXQVJEOiBTYXZlCiAgICAgICAgICAgIHRoaXMuZ2FpbkV4cCg1KTsKCiAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJTQVZFRCEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJjb21pYy1pbXBhY3QiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLnRyaWdnZXJJbXBhY3QpIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS50cmlnZ2VySW1wYWN0KDAuMTUsICdoZWF2eScpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gUmVzZXQgdGhyb3cgdGltZXIKICAgICAgICAgICAgdGhpcy50aHJvd1RpbWVyID0gMDsKICAgICAgICB9CgpfYWlQb3NzZXNzaW9uTG9naWMoZHQpIHsKICAgICAgICAgICAgdGhpcy50aHJvd1RpbWVyICs9IGR0OwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gSG9sZCBmb3IgYSBtb21lbnQgKDEuNXMpIHRoZW4gdGhyb3cKICAgICAgICAgICAgaWYgKHRoaXMudGhyb3dUaW1lciA+IDEuNSkgewogICAgICAgICAgICAgICAgLy8gRmluZCBiZXN0IHRhcmdldDogUHJlZmVyIE1GIG9yIERlZmVuZGVycywgYnV0IG11c3QgYmUgc29tZXdoYXQgZGlzdGFudCB0byBhdm9pZCAiaGFuZG9mZiIgbG9vawogICAgICAgICAgICAgICAgLy8gRmlsdGVyIGZvciB0ZWFtbWF0ZXMgPiA4IHVuaXRzIGF3YXkgaWYgcG9zc2libGUKICAgICAgICAgICAgICAgIGNvbnN0IHZhbGlkTWF0ZXMgPSB0aGlzLnRlYW0ucGxheWVycy5maWx0ZXIocCA9PiAKICAgICAgICAgICAgICAgICAgICBwICE9PSB0aGlzICYmIAogICAgICAgICAgICAgICAgICAgIHAubWVzaCAmJiAKICAgICAgICAgICAgICAgICAgICBwLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyh0aGlzLm1lc2gucG9zaXRpb24pID4gOC4wCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgIGxldCB0YXJnZXQgPSBudWxsOwoKICAgICAgICAgICAgICAgIC8vIFByaW9yaXR5IDE6IE1pZGZpZWxkZXIgKFBsYXltYWtlcikKICAgICAgICAgICAgICAgIHRhcmdldCA9IHZhbGlkTWF0ZXMuZmluZChwID0+IHAucm9sZSA9PT0gJ01GJyk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFByaW9yaXR5IDI6IERlZmVuZGVycwogICAgICAgICAgICAgICAgaWYgKCF0YXJnZXQpIHRhcmdldCA9IHZhbGlkTWF0ZXMuZmluZChwID0+IHAucm9sZSA9PT0gJ0xEJyB8fCBwLnJvbGUgPT09ICdSRCcpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBQcmlvcml0eSAzOiBBbnlvbmUgb3BlbiAoZmFsbGJhY2sgdG8gY2xvc2UgcmFuZ2UgaWYgbm8gb25lIGlzIGZhcikKICAgICAgICAgICAgICAgIGlmICghdGFyZ2V0KSB0YXJnZXQgPSB0aGlzLnRlYW0ucGxheWVycy5maW5kKHAgPT4gcCAhPT0gdGhpcyAmJiBwLnJvbGUgIT09ICdHTCcpOwoKICAgICAgICAgICAgICAgIGlmICh0YXJnZXQgJiYgdGFyZ2V0Lm1lc2gpIHsKICAgICAgICAgICAgICAgICAgICAvLyBBSU1JTkcgTE9HSUM6IExvZnQgdGhlIHBhc3MKICAgICAgICAgICAgICAgICAgICAvLyBMb29rIGF0IHRhcmdldCwgYnV0IGFpbSBzbGlnaHRseSB1cCB0byBjcmVhdGUgYW4gYXJjCiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0UG9zID0gdGFyZ2V0Lm1lc2gucG9zaXRpb24uY2xvbmUoKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgZGlzdGFuY2UKICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gdGhpcy5tZXNoLnBvc2l0aW9uLmRpc3RhbmNlVG8odGFyZ2V0UG9zKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBMb2Z0IGZhY3RvcjogVGhlIGZ1cnRoZXIgYXdheSwgdGhlIGhpZ2hlciB3ZSBhaW0KICAgICAgICAgICAgICAgICAgICAvLyAyMCB1bml0cyBhd2F5IC0+IEFpbSA1IHVuaXRzIGFib3ZlIGhlYWQKICAgICAgICAgICAgICAgICAgICBjb25zdCBsb2Z0ID0gTWF0aC5tYXgoMS4wLCBkaXN0ICogMC4yNSk7CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0UG9zLnkgKz0gbG9mdDsKCiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNoLmxvb2tBdCh0YXJnZXRQb3MpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFRocm93CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFsbCA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5lbnRpdGllcy5iYWxsOwogICAgICAgICAgICAgICAgICAgIHRoaXMudGhyb3dCYWxsKGJhbGwsICdQQScpOyAKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgJHt0aGlzLnJvbGV9IHRocm93cyB0byAke3RhcmdldC5yb2xlfSAoRGlzdDogJHtkaXN0LnRvRml4ZWQoMSl9KWApOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBDbGVhciBpdCBmb3J3YXJkCiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNoLmxvb2tBdCgwLCA1LCAwKTsgLy8gQWltIHVwLWNlbnRlcgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJhbGwgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZW50aXRpZXMuYmFsbDsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRocm93QmFsbChiYWxsLCAnU0gnKTsgLy8gSGFyZCBjbGVhcgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0aGlzLnRocm93VGltZXIgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHdpbmRvdy5mbHV4LkdvYWxpZSA9IEdvYWxpZTsKfSkoKTs=","./Goalie.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKICAgIAogICAgLy8gUmV1c2FibGUgdmVjdG9ycyB0byBhdm9pZCBHQwpjb25zdCBfZ1ZlYyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfZ1BvcyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfYmFsbFBvcyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfZmFjZVZlYyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfZ29hbENlbnRlciA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfdGVtcFZlY0cgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwoKICAgIGNsYXNzIEdvYWxpZSBleHRlbmRzIHdpbmRvdy5mbHV4LlBsYXllciB7CmNvbnN0cnVjdG9yKHNjZW5lLCByb2xlKSB7CiAgICAgICAgICAgIHN1cGVyKHNjZW5lLCByb2xlKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEdvYWxpZSBTcGVjaWZpYyBTdGF0cyAoQnVmZmVkIGZvciBQbGF5YWJpbGl0eSkKICAgICAgICAgICAgdGhpcy5zdGF0cy5DQSA9IDMwOyAvLyBDYXRjaAogICAgICAgICAgICB0aGlzLnN0YXRzLlNQID0gNDA7IC8vIFNwZWVkCiAgICAgICAgICAgIHRoaXMuc3RhdHMuRU4gPSA1MDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEJVRkZFRDogU3Ryb25nIGFybSBmb3IgY2xlYXJpbmcgdGhlIHpvbmUKICAgICAgICAgICAgdGhpcy5zdGF0cy5QQSA9IDQ1OyAvLyBXYXMgMjAgLSBOb3cgc3Ryb25nIGVub3VnaCB0byByZWFjaCBtaWRmaWVsZAogICAgICAgICAgICB0aGlzLnN0YXRzLlNIID0gMzU7IC8vIFdhcyAxMCAtIERlY2VudCBjbGVhcmFuY2Uga2ljawogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5fdXBkYXRlRGVyaXZlZFN0YXRzKCk7CgogICAgICAgICAgICAvLyBHb2FsIERpbWVuc2lvbnMgKFNhdmUgQm94KQovLyBHb2FsIERpbWVuc2lvbnMgKFNhdmUgQm94KSAtIE1hdGNoZXMgR2FtZU1hbmFnZXIgZGV0ZWN0aW9uCnRoaXMuZ29hbFdpZHRoID0gMzMuMDsgLy8gSW5jcmVhc2VkIDUwJSAod2FzIDIyLjApCiAgICAgICAgICAgIHRoaXMuZ29hbEhlaWdodCA9IDI3LjA7IC8vIEluY3JlYXNlZCA1MCUgKHdhcyAxOC4wKQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU2F2ZSBNZWNoYW5pY3MKICAgICAgICAgICAgdGhpcy5zYXZlUmFkaXVzID0gNi4wOyAKICAgICAgICAgICAgdGhpcy5wcmVzc3VyZU11bHRpcGxpZXIgPSA1LjA7IAogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVGVjaHMKICAgICAgICAgICAgdGhpcy50ZWNocyA9IHsKICAgICAgICAgICAgICAgIGFjdGl2ZTogbnVsbCwgCiAgICAgICAgICAgICAgICBwYXNzaXZlOiBudWxsIAogICAgICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQUkgU3RhdGUKICAgICAgICAgICAgdGhpcy50aHJvd1RpbWVyID0gMDsKICAgICAgICAgICAgdGhpcy5fYWNjdW11bGF0ZWRTYXZlID0gMDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFN1cGVyIEdvYWxpZSBTdGF0ZQogICAgICAgICAgICB0aGlzLmlzU3VwZXJHb2FsaWUgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5zdXBlckdvYWxpZVRpbWVyID0gMDsKICAgICAgICB9Cgp1cGRhdGUoZHQpIHsKICAgICAgICAgICAgLy8gMS4gU3VwZXIgR29hbGllIFRpbWVyCiAgICAgICAgICAgIGlmICh0aGlzLmlzU3VwZXJHb2FsaWUpIHsKICAgICAgICAgICAgICAgIHRoaXMuc3VwZXJHb2FsaWVUaW1lciAtPSBkdDsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnN1cGVyR29hbGllVGltZXIgPD0gMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaXNTdXBlckdvYWxpZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAyLiBQb3NzZXNzaW9uIExvZ2ljIChCYWxsIEhlbGQpCiAgICAgICAgICAgIGlmICh0aGlzLmhhc0JhbGwpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2NoZWNrVGFja2xlUHJlc3N1cmUoZHQpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBnYW1lID0gd2luZG93LmZsdXguZ2FtZUluc3RhbmNlOwogICAgICAgICAgICAgICAgY29uc3QgaXNIdW1hbkNvbnRyb2xsZWQgPSB0aGlzLnRlYW0gJiYgdGhpcy50ZWFtLmlzSHVtYW4gJiYgdGhpcy50ZWFtLmFjdGl2ZVBsYXllciA9PT0gdGhpcyAmJiAhZ2FtZS5pc0RlbW9Nb2RlOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoaXNIdW1hbkNvbnRyb2xsZWQpIHsKICAgICAgICAgICAgICAgICAgICAvLyBIdW1hbjogRnVsbCBjb250cm9sIChSb3RhdGlvbiwgQ2hhcmdpbmcsIGV0YyB2aWEgUGxheWVyLnVwZGF0ZSkKICAgICAgICAgICAgICAgICAgICBzdXBlci51cGRhdGUoZHQpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBBSTogTG9naWMgdGhlbiB1cGRhdGUKICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNUaHJvd2luZykgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9haVBvc3Nlc3Npb25Mb2dpYyhkdCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vIEVuc3VyZSBBSSBkb2Vzbid0IGRyaWZ0CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRJbnB1dCgwLCAwKTsKICAgICAgICAgICAgICAgICAgICBzdXBlci51cGRhdGUoZHQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5fY29uc3RyYWluQm91bmRzKCk7CiAgICAgICAgICAgICAgICByZXR1cm47IAogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAzLiBEZWZlbnNlIC8gU2F2ZSBMb2dpYyAoTm8gQmFsbCkKICAgICAgICAgICAgLy8gV2UgbXVzdCBoYW5kbGUgdGltZXJzIGFuZCBzdGF0dXMgbWFudWFsbHkgYmVjYXVzZSB3ZSBza2lwIHN1cGVyLnVwZGF0ZSgpIHRvIHVzZSBjdXN0b20gbW92ZW1lbnQKICAgICAgICAgICAgaWYgKHRoaXMuZGFzaENvb2xkb3duID4gMCkgdGhpcy5kYXNoQ29vbGRvd24gLT0gZHQ7CiAgICAgICAgICAgIGlmICh0aGlzLmNsYXNoQ29vbGRvd24gPiAwKSB0aGlzLmNsYXNoQ29vbGRvd24gLT0gZHQ7CiAgICAgICAgICAgIGlmICh0aGlzLnN0dW5UaW1lciA+IDApIHRoaXMuc3R1blRpbWVyIC09IGR0OwogICAgICAgICAgICBpZiAodGhpcy5pbW11bml0eVRpbWVyID4gMCkgdGhpcy5pbW11bml0eVRpbWVyIC09IGR0OwoKICAgICAgICAgICAgdGhpcy5fdXBkYXRlU3RhdHVzKGR0KTsKCiAgICAgICAgICAgIGlmICh0aGlzLnN0dW5UaW1lciA+IDAgfHwgdGhpcy5zdGF0dXMubmFwID4gMCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMubWl4ZXIpIHRoaXMubWl4ZXIudXBkYXRlKGR0KTsKICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUhQQmFyKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9jb25zdHJhaW5Cb3VuZHMoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQ3VzdG9tIE1vdmVtZW50CiAgICAgICAgICAgIHRoaXMuX2RlZmVuc2VMb2dpYyhkdCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBVcGRhdGUgQW5pbWF0aW9uCiAgICAgICAgICAgIGlmICh0aGlzLm1peGVyKSB0aGlzLm1peGVyLnVwZGF0ZShkdCk7CiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUhQQmFyKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICB0aGlzLl9jb25zdHJhaW5Cb3VuZHMoKTsKICAgICAgICB9CgpfY29uc3RyYWluQm91bmRzKCkgewogICAgICAgICAgICBpZiAoIXRoaXMubWVzaCkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBwb3MgPSB0aGlzLm1lc2gucG9zaXRpb247CiAgICAgICAgICAgIGNvbnN0IHNpZGUgPSB0aGlzLnRlYW0gPyB0aGlzLnRlYW0uc2lkZSA6IDE7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBYIEJvdW5kcyAoV2lkdGggb2YgcGVuYWx0eSBhcmVhICsvLSAxMG0pIC0+IEluY3JlYXNlZCBmb3IgbWFzc2l2ZSBnb2FsCiAgICAgICAgICAgIGNvbnN0IHhMaW1pdCA9IDMwLjA7IC8vIE1heCB3aWR0aCBvZiBhcmVuYSAoUmFkaXVzIDMyKQogICAgICAgICAgICBpZiAocG9zLnggPiB4TGltaXQpIHsgcG9zLnggPSB4TGltaXQ7IHRoaXMudmVsb2NpdHkueCA9IDA7IH0KICAgICAgICAgICAgaWYgKHBvcy54IDwgLXhMaW1pdCkgeyBwb3MueCA9IC14TGltaXQ7IHRoaXMudmVsb2NpdHkueCA9IDA7IH0KICAgICAgICAgICAgCi8vIFkgQm91bmRzIChIZWlnaHQgKy8tIDE1bSkgLT4gSW5jcmVhc2VkIGZvciBtYXNzaXZlIGdvYWwgaGlnaCBzYXZlcwogICAgICAgICAgICBjb25zdCB5TGltaXQgPSAyMi41OyAvLyBJbmNyZWFzZWQgNTAlICh3YXMgMTUuMCkKICAgICAgICAgICAgaWYgKHBvcy55ID4geUxpbWl0KSB7IHBvcy55ID0geUxpbWl0OyB0aGlzLnZlbG9jaXR5LnkgPSAwOyB9CiAgICAgICAgICAgIGlmIChwb3MueSA8IC15TGltaXQpIHsgcG9zLnkgPSAteUxpbWl0OyB0aGlzLnZlbG9jaXR5LnkgPSAwOyB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBaIEJvdW5kcyAoRGVwdGgpCiAgICAgICAgICAgIC8vIEhvbWUgKFNpZGUgMSk6IEdvYWwgYXQgKzI4LiBUcmlnZ2VyIGF0IDI3LiBMaW1pdCB0byAyNi41IHRvIHByZXZlbnQgd2Fsa2luZyBpbi4KICAgICAgICAgICAgLy8gQXdheSAoU2lkZSAtMSk6IEdvYWwgYXQgLTI4LiBUcmlnZ2VyIGF0IC0yNy4gTGltaXQgdG8gLTI2LjUuCiAgICAgICAgICAgIGlmIChzaWRlID09PSAxKSB7CiAgICAgICAgICAgICAgICBpZiAocG9zLnogPiAyNi41KSB7IHBvcy56ID0gMjYuNTsgdGhpcy52ZWxvY2l0eS56ID0gMDsgfQogICAgICAgICAgICAgICAgaWYgKHBvcy56IDwgMTIuMCkgeyBwb3MueiA9IDEyLjA7IHRoaXMudmVsb2NpdHkueiA9IDA7IH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChwb3MueiA8IC0yNi41KSB7IHBvcy56ID0gLTI2LjU7IHRoaXMudmVsb2NpdHkueiA9IDA7IH0KICAgICAgICAgICAgICAgIGlmIChwb3MueiA+IC0xMi4wKSB7IHBvcy56ID0gLTEyLjA7IHRoaXMudmVsb2NpdHkueiA9IDA7IH0KICAgICAgICAgICAgfQogICAgICAgIH0KCi8vIE92ZXJyaWRlIHRocm93QmFsbCB0byBmaXggIndlYWsgdGhyb3ciIGlzc3VlCi8vIE92ZXJyaWRlIHRocm93QmFsbCB0byBmaXggIndlYWsgdGhyb3ciIGlzc3VlCiAgICAgICAgdGhyb3dCYWxsKGJhbGwsIGZvcmNlZFR5cGUgPSBudWxsLCBwb3dlck11bHRpcGxpZXIgPSAxLjApIHsKICAgICAgICAgICAgLy8gR29hbGllcyBhbG1vc3QgYWx3YXlzIFBBU1MsIGV2ZW4gd2hlbiAiY2xlYXJpbmciIGZvcndhcmQuCiAgICAgICAgICAgIC8vIFRoZSBkZWZhdWx0IFBsYXllciBsb2dpYyBzd2l0Y2hlcyB0byAnU0gnIChTaG9vdCkgaWYgYWltaW5nIGZvcndhcmQsIAogICAgICAgICAgICAvLyB3aGljaCB1c2VzIHRoZSBHb2FsaWUncyBsb3dlciBTSCBzdGF0LiBXZSBmb3JjZSBQQSB1bmxlc3Mgc3BlY2lmaWVkLgogICAgICAgICAgICBjb25zdCB0eXBlID0gZm9yY2VkVHlwZSB8fCAnUEEnOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQk9PU1Q6IEFwcGx5IGEgbXVsdGlwbGllciB0byBlbnN1cmUgdGhlIGdvYWxpZSBjYW4gY2xlYXIgdGhlIGJhbGwgdG8gbWlkZmllbGQuCiAgICAgICAgICAgIC8vIE5FUkZFRDogUmVkdWNlZCBmcm9tIDEuNiB0byAxLjIgdG8gcHJldmVudCBjcm9zcy1tYXAgdGhyb3dzIGFzIHBlciB1c2VyIGZlZWRiYWNrLgogICAgICAgICAgICBjb25zdCBib29zdCA9IDEuMjsKCiAgICAgICAgICAgIHN1cGVyLnRocm93QmFsbChiYWxsLCB0eXBlLCBwb3dlck11bHRpcGxpZXIgKiBib29zdCk7CiAgICAgICAgfQoKX2RlZmVuc2VMb2dpYyhkdCkgewogICAgICAgICAgICAvLyAwLiBHYW1lIFN0YXRlIENoZWNrCiAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2Uuc3RhdGUgIT09ICdhY3RpdmUnKSByZXR1cm47CgogICAgICAgICAgICBjb25zdCBiYWxsID0gd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmVudGl0aWVzLmJhbGw7CiAgICAgICAgICAgIGlmICghYmFsbCB8fCAhYmFsbC5tZXNoKSByZXR1cm47CgogICAgICAgICAgICAvLyBEZXRlcm1pbmUgVGhyZWF0IFNvdXJjZQogICAgICAgICAgICBsZXQgdGhyZWF0UG9zID0gX2JhbGxQb3M7CiAgICAgICAgICAgIGxldCBpc1RocmVhdCA9IGZhbHNlOwogICAgICAgICAgICBjb25zdCBteUdvYWxaID0gKHRoaXMudGVhbS5zaWRlID09PSAxKSA/IDI4IDogLTI4OwoKICAgICAgICAgICAgLy8gQ2FzZSBBOiBCYWxsIGlzIEhlbGQgKFByZS10aHJvdykKICAgICAgICAgICAgaWYgKGJhbGwuc3RhdGUgPT09ICdoZWxkJyAmJiBiYWxsLmhvbGRlciAmJiBiYWxsLmhvbGRlci50ZWFtICE9PSB0aGlzLnRlYW0pIHsKICAgICAgICAgICAgICAgIHRocmVhdFBvcyA9IGJhbGwuaG9sZGVyLm1lc2gucG9zaXRpb247CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIGhvbGRlciBpcyBpbiBhdHRhY2tpbmcgaGFsZiBvciBuZWFyIGVub3VnaAogICAgICAgICAgICAgICAgY29uc3QgZGlzdFRvR29hbCA9IE1hdGguYWJzKHRocmVhdFBvcy56IC0gbXlHb2FsWik7CiAgICAgICAgICAgICAgICBpZiAoZGlzdFRvR29hbCA8IDQwLjApIHsgLy8gSWYgdGhleSBhcmUgd2l0aGluIDQwbSwgdHJhY2sgdGhlbQogICAgICAgICAgICAgICAgICAgIGlzVGhyZWF0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSAKICAgICAgICAgICAgLy8gQ2FzZSBCOiBCYWxsIGlzIEZyZWUgKFNob3QvUGFzcykKICAgICAgICAgICAgZWxzZSBpZiAoYmFsbC5zdGF0ZSA9PT0gJ2ZyZWUnKSB7CiAgICAgICAgICAgICAgICB0aHJlYXRQb3MgPSBiYWxsLm1lc2gucG9zaXRpb247CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIERpcmVjdGlvbiBDaGVjawogICAgICAgICAgICAgICAgY29uc3QgbW92aW5nVG93YXJkcyA9ICh0aGlzLnRlYW0uc2lkZSA9PT0gMSAmJiBiYWxsLnZlbG9jaXR5LnogPiAwKSB8fCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAodGhpcy50ZWFtLnNpZGUgPT09IC0xICYmIGJhbGwudmVsb2NpdHkueiA8IDApOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBQb3NpdGlvbiBDaGVjawogICAgICAgICAgICAgICAgY29uc3QgaW5Gcm9udE9mR29hbCA9ICh0aGlzLnRlYW0uc2lkZSA9PT0gMSAmJiB0aHJlYXRQb3MueiA8IDI3LjUpIHx8IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLnRlYW0uc2lkZSA9PT0gLTEgJiYgdGhyZWF0UG9zLnogPiAtMjcuNSk7CgogICAgICAgICAgICAgICAgaXNUaHJlYXQgPSBtb3ZpbmdUb3dhcmRzICYmIGluRnJvbnRPZkdvYWw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChpc1RocmVhdCkgewogICAgICAgICAgICAgICAgLy8gLS0tIFBPU0lUSU9OSU5HOiBBTkdMRSBDVVRUSU5HIC0tLQogICAgICAgICAgICAgICAgX2JhbGxQb3MuY29weSh0aHJlYXRQb3MpOyAvLyBVcGRhdGUgcmVmZXJlbmNlIGZvciBsb29rQXQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gMS4gQ2FsY3VsYXRlIEdvYWwgQ2VudGVyCi8vIDEuIENhbGN1bGF0ZSBHb2FsIENlbnRlciAoQWRqdXN0ZWQgZm9yIFkgb2Zmc2V0KQogICAgICAgICAgICAgICAgX2dvYWxDZW50ZXIuc2V0KDAsIC0yLjIsIG15R29hbFopOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyAyLiBWZWN0b3IgZnJvbSBHb2FsIHRvIEJhbGwKICAgICAgICAgICAgICAgIF90ZW1wVmVjRy5zdWJWZWN0b3JzKF9iYWxsUG9zLCBfZ29hbENlbnRlcik7CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0VG9CYWxsID0gX3RlbXBWZWNHLmxlbmd0aCgpOwogICAgICAgICAgICAgICAgX3RlbXBWZWNHLm5vcm1hbGl6ZSgpOyAvLyBOb3cgaG9sZHMgZGlyZWN0aW9uCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIDMuIERldGVybWluZSBFeHRlbnNpb24gKEhvdyBmYXIgb3V0IHRvIHN0ZXApCiAgICAgICAgICAgICAgICAvLyBCYXNlOiAxLjVtIG9mZiBsaW5lLgogICAgICAgICAgICAgICAgLy8gTWF4OiA2LjBtIG9mZiBsaW5lIChDdXR0aW5nIGFuZ2xlKS4KICAgICAgICAgICAgICAgIC8vIFNjYWxlIGJhc2VkIG9uIGJhbGwgcHJveGltaXR5OiBDbG9zZXIgYmFsbCA9IE1vcmUgZXh0ZW5zaW9uICh0byBhIHBvaW50KQpsZXQgZXh0ZW5zaW9uID0gMS41OwogICAgICAgICAgICAgICAgaWYgKGRpc3RUb0JhbGwgPCAzMC4wKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmF0aW8gPSAxLjAgLSAoTWF0aC5tYXgoMCwgZGlzdFRvQmFsbCAtIDUuMCkgLyAyNS4wKTsgCiAgICAgICAgICAgICAgICAgICAgZXh0ZW5zaW9uID0gMS41ICsgKDQuNSAqIHJhdGlvKTsgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKLy8gU2FmZXR5OiBEb24ndCBnbyBwYXN0IHRoZSBiYWxsIChrZWVwIDFtIGJ1ZmZlcikKICAgICAgICAgICAgICAgIGV4dGVuc2lvbiA9IE1hdGgubWluKGV4dGVuc2lvbiwgZGlzdFRvQmFsbCAtIDEuMCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIDQuIENhbGN1bGF0ZSBUYXJnZXQgUG9zaXRpb24gKEJhc2UgSW50ZXJjZXB0aW9uKQogICAgICAgICAgICAgICAgX2dQb3MuY29weShfZ29hbENlbnRlcikuYWRkKF90ZW1wVmVjRy5tdWx0aXBseVNjYWxhcihleHRlbnNpb24pKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gNS4gVmVydGljYWwgT3ZlcnJpZGUgKEp1bXAgdG8gbWVldCBiYWxsKQogICAgICAgICAgICAgICAgLy8gRXhwbGljaXRseSBzZXQgWSB0byBtYXRjaCBiYWxsIGhlaWdodCBpZiBpdCdzIGhpZ2gKICAgICAgICAgICAgICAgIGlmIChfYmFsbFBvcy55ID4gMC41KSB7CiAgICAgICAgICAgICAgICAgICAgX2dQb3MueSA9IF9iYWxsUG9zLnk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIF9nUG9zLnkgPSAwLjU7IC8vIERlZmF1bHQgc3RhbmNlCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gNi4gQ2xhbXAgdG8gR29hbCBCb3ggRGltZW5zaW9ucyAoTGF0ZXJhbC9WZXJ0aWNhbCBMaW1pdHMpCiAgICAgICAgICAgICAgICAvLyBHb2FsIFdpZHRoIDIyICgrLy0gMTEpLCBIZWlnaHQgMTggKCsvLSA5KS4KICAgICAgICAgICAgICAgIC8vIEFsbG93IHNsaWdodGx5IG91dHNpZGUgcG9zdHMgdG8gY292ZXIgYW5nbGVzLgogICAgICAgICAgICAgICAgY29uc3QgY2xhbXBYID0gdGhpcy5nb2FsV2lkdGggKiAwLjY7IC8vICsvLSAxMy4yCmNvbnN0IGNsYW1wWSA9IDIxLjA7IC8vIEFsbG93IGhpZ2gganVtcHMgdXAgdG8gMjFtICh3YXMgMTQuMCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX2dQb3MueCA9IE1hdGgubWF4KC1jbGFtcFgsIE1hdGgubWluKGNsYW1wWCwgX2dQb3MueCkpOwogICAgICAgICAgICAgICAgX2dQb3MueSA9IE1hdGgubWF4KC1jbGFtcFksIE1hdGgubWluKGNsYW1wWSwgX2dQb3MueSkpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyA2LiBMZWFkIHRoZSBiYWxsIHNsaWdodGx5IGlmIGl0IGhhcyBsYXRlcmFsIHZlbG9jaXR5IChBbnRpY2lwYXRpb24pCmlmIChiYWxsLnZlbG9jaXR5Lmxlbmd0aFNxKCkgPiAxLjApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBhbnRpY2lwYXRpb24gPSBiYWxsLnZlbG9jaXR5LmNsb25lKCkubXVsdGlwbHlTY2FsYXIoMC4yNSk7IC8vIDAuMjVzIGxlYWQKICAgICAgICAgICAgICAgICAgICBhbnRpY2lwYXRpb24ueiA9IDA7IC8vIE9ubHkgbGF0ZXJhbCBsZWFkCiAgICAgICAgICAgICAgICAgICAgX2dQb3MuYWRkKGFudGljaXBhdGlvbik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gQ0xBTVAgWjogUHJldmVudCBHb2FsaWUgZnJvbSBnb2luZyBpbnRvIHRoZSBuZXQgb3IgYmVoaW5kIGdvYWwKLy8gQ0xBTVAgWjogUHJldmVudCBHb2FsaWUgZnJvbSBnb2luZyBpbnRvIHRoZSBuZXQgb3IgYmVoaW5kIGdvYWwKICAgICAgICAgICAgICAgIGlmICh0aGlzLnRlYW0uc2lkZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgIF9nUG9zLnogPSBNYXRoLm1pbigyNi41LCBfZ1Bvcy56KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgX2dQb3MueiA9IE1hdGgubWF4KC0yNi41LCBfZ1Bvcy56KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBNb3ZlIHRvd2FyZHMgdGFyZ2V0CiAgICAgICAgICAgICAgICBjb25zdCBtb3ZlRGlyID0gX2dWZWMuc3ViVmVjdG9ycyhfZ1BvcywgdGhpcy5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgIGNvbnN0IGRpc3RUb1RhcmdldCA9IG1vdmVEaXIubGVuZ3RoKCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChkaXN0VG9UYXJnZXQgPiAwLjEpIHsKICAgICAgICAgICAgICAgICAgICBtb3ZlRGlyLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgICAgIC8vIEJ1cnN0IHNwZWVkIGZvciBzYXZlcyBpZiBiYWxsIGlzIGNsb3NlCiAgICAgICAgICAgICAgICAgICAgY29uc3QgdXJnZW5jeSA9IChkaXN0VG9CYWxsIDwgMTAuMCkgPyAxLjUgOiAxLjA7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3BlZWQgPSB0aGlzLm1heFNwZWVkICogdXJnZW5jeTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB0aGlzLm1lc2gucG9zaXRpb24uYWRkKG1vdmVEaXIubXVsdGlwbHlTY2FsYXIoc3BlZWQgKiBkdCkpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEZhY2UgYmFsbAogICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5sb29rQXQoX2JhbGxQb3MpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSAnc3dpbScpIHRoaXMucGxheSgnc3dpbScsIDAuMik7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSAnaWRsZScpIHRoaXMucGxheSgnaWRsZScsIDAuMik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNoLmxvb2tBdChfYmFsbFBvcyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gLS0tIFNBVkUgTUVDSEFOSUMgLS0tCiAgICAgICAgICAgICAgICAvLyBJZiBiYWxsIGlzIHdpdGhpbiByYW5nZSwgYXBwbHkgQ0EgcHJlc3N1cmUKICAgICAgICAgICAgICAgIGNvbnN0IGRpc3QgPSB0aGlzLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyhiYWxsLm1lc2gucG9zaXRpb24pOwogICAgICAgICAgICAgICAgaWYgKGRpc3QgPCB0aGlzLnNhdmVSYWRpdXMpIHsgCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXBwbHlTYXZlUHJlc3N1cmUoYmFsbCwgZHQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gLS0tIElETEUgLyBSRVRVUk4gVE8gUE9TVCAtLS0KICAgICAgICAgICAgICAgIC8vIFJldHVybiB0byBob21lIHBvc2l0aW9uICh1c3VhbGx5IGNlbnRlciBvZiBnb2FsKQogICAgICAgICAgICAgICAgX2dQb3MuY29weSh0aGlzLmhvbWVQb3NpdGlvbik7CiAgICAgICAgICAgICAgICBjb25zdCBtb3ZlRGlyID0gX2dWZWMuc3ViVmVjdG9ycyhfZ1BvcywgdGhpcy5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKG1vdmVEaXIubGVuZ3RoKCkgPiAwLjUpIHsKICAgICAgICAgICAgICAgICAgICBtb3ZlRGlyLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi5hZGQobW92ZURpci5tdWx0aXBseVNjYWxhcih0aGlzLm1heFNwZWVkICogMC42ICogZHQpKTsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSAhPT0gJ3N3aW0nKSB0aGlzLnBsYXkoJ3N3aW0nLCAwLjIpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSAhPT0gJ2lkbGUnKSB0aGlzLnBsYXkoJ2lkbGUnLCAwLjIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBGYWNlIGNlbnRlciBmaWVsZAogICAgICAgICAgICAgICAgdGhpcy5tZXNoLmxvb2tBdCgwLCAwLCAwKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX2FwcGx5U2F2ZVByZXNzdXJlKGJhbGwsIGR0KSB7CiAgICAgICAgICAgIC8vIElmIEdvYWxpZSBpcyBBc2xlZXAsIHRoZXkgY2Fubm90IHNhdmUuCiAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cy5uYXAgPiAwKSByZXR1cm47CgogICAgICAgICAgICAvLyAtLS0gU1VQRVIgR09BTElFIFRSSUdHRVIgLS0tCiAgICAgICAgICAgIC8vIFRyaWdnZXIgaWY6IFRlY2ggZXF1aXBwZWQsIE5vdCBhY3RpdmUsIEJhbGwgaGFzIHBvd2VyLCBCYWxsIGlzIGNsb3NlCiAgICAgICAgICAgIGlmICh0aGlzLnRlY2hzLmFjdGl2ZSA9PT0gJ3N1cGVyX2dvYWxpZScgJiYgIXRoaXMuaXNTdXBlckdvYWxpZSAmJiBiYWxsLnBvd2VyID4gNS4wKSB7CiAgICAgICAgICAgICAgICAvLyBDaGFuY2UgdG8gdHJpZ2dlciAoSGlnaCBjaGFuY2UgZm9yIEFJLCBvciBjaGVjayBIUCkKICAgICAgICAgICAgICAgIC8vIENvc3Q6IDEwIEhQCiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0cy5IUCA+PSAxMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdHMuSFAgLT0gMTA7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc1N1cGVyR29hbGllID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnN1cGVyR29hbGllVGltZXIgPSAxLjU7IC8vIExhc3RzIDEuNXMKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgJHt0aGlzLnJvbGV9IHVzZWQgU1VQRVIgR09BTElFIWApOwogICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIlNVUEVSIEdPQUxJRSEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJzYXZlIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFRyaWdnZXIgVGVjaGNvcHkgRXZlbnQKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlICYmIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS50cmlnZ2VyVGVjaEV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS50cmlnZ2VyVGVjaEV2ZW50KHRoaXMsICdzdXBlcl9nb2FsaWUnKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBFZmZlY3RpdmUgQ0EKICAgICAgICAgICAgbGV0IGNhID0gdGhpcy5nZXRTdGF0KCdDQScpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQXBwbHkgU3VwZXIgR29hbGllIEJvbnVzIChlLmcuICs1MCUgKyBGbGF0IDEwKQogICAgICAgICAgICBpZiAodGhpcy5pc1N1cGVyR29hbGllKSB7CiAgICAgICAgICAgICAgICBjYSA9IChjYSAqIDEuNSkgKyAxMDsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQXBwbHkgR3JpcCBHbG92ZXMgKFBhc3NpdmUpCiAgICAgICAgICAgIGlmICh0aGlzLnRlY2hzLnBhc3NpdmUgPT09ICdncmlwX2dsb3ZlcycpIHsKICAgICAgICAgICAgICAgIGNhICs9IDU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBQcmVzc3VyZQogICAgICAgICAgICAvLyBQcmVzc3VyZSA9IENBICogZHQgKiBNdWx0aXBsaWVyCiAgICAgICAgICAgIGNvbnN0IHByZXNzdXJlID0gY2EgKiBkdCAqIHRoaXMucHJlc3N1cmVNdWx0aXBsaWVyOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGJhbGwucG93ZXIgPiAwKSB7CiAgICAgICAgICAgICAgICBiYWxsLnBvd2VyIC09IHByZXNzdXJlOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBWaXN1YWwgRmVlZGJhY2sKICAgICAgICAgICAgICAgIHRoaXMuX2FjY3VtdWxhdGVkU2F2ZSArPSBwcmVzc3VyZTsKICAgICAgICAgICAgICAgIC8vIFRIUk9UVExFOiBJbmNyZWFzZWQgdGhyZXNob2xkIHRvIDEyLjAKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9hY2N1bXVsYXRlZFNhdmUgPj0gMTIuMCkgeyAKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJCTE9DSyEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJjb21pYy1pbXBhY3QiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWNjdW11bGF0ZWRTYXZlID0gMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQXBwbHkgQmFsbCBUZWNobmlxdWUgdG8gR29hbGllIChSaXNrIG9mIGNhdGNoaW5nIHNwZWNpYWwgc2hvdHMpCiAgICAgICAgICAgIGlmIChiYWxsLnRlY2huaXF1ZSAmJiAhdGhpcy5fdGVjaEFwcGxpZWQpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3RlY2hBcHBsaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGNvbnN0IHRlY2ggPSBiYWxsLnRlY2huaXF1ZTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKHRlY2gudHlwZSA9PT0gJ3Zlbm9tJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwbHlTdGF0dXMoJ3Zlbm9tJywgMTUuMCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRlY2gudHlwZSA9PT0gJ25hcCcpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGx5U3RhdHVzKCduYXAnLCA4LjApOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0ZWNoLnR5cGUgPT09ICd3aXRoZXInKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBseVN0YXR1cygnd2l0aGVyJywgMTUuMCwgJ0NBJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsgdGhpcy5fdGVjaEFwcGxpZWQgPSBmYWxzZTsgfSwgMjAwMCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIENoZWNrIFJlc3VsdAogICAgICAgICAgICBpZiAoYmFsbC5wb3dlciA8PSAwKSB7CiAgICAgICAgICAgICAgICAvLyBDQVRDSAogICAgICAgICAgICAgICAgdGhpcy5jYXRjaEJhbGwoYmFsbCk7CiAgICAgICAgICAgIH0gCiAgICAgICAgfQoKICAgICAgICBjYXRjaEJhbGwoYmFsbCkgewogICAgICAgICAgICBiYWxsLmdyYWIodGhpcyk7CiAgICAgICAgICAgIHRoaXMucGxheSgnY2F0Y2gnLCAwLjEpOwogICAgICAgICAgICBjb25zb2xlLmxvZygiU0FWRUQgYnkgIiArIHRoaXMucm9sZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBFWFAgUkVXQVJEOiBTYXZlCiAgICAgICAgICAgIHRoaXMuZ2FpbkV4cCg1KTsKCiAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJTQVZFRCEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJjb21pYy1pbXBhY3QiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLnRyaWdnZXJJbXBhY3QpIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS50cmlnZ2VySW1wYWN0KDAuMTUsICdoZWF2eScpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gUmVzZXQgdGhyb3cgdGltZXIKICAgICAgICAgICAgdGhpcy50aHJvd1RpbWVyID0gMDsKICAgICAgICB9CgpfYWlQb3NzZXNzaW9uTG9naWMoZHQpIHsKICAgICAgICAgICAgdGhpcy50aHJvd1RpbWVyICs9IGR0OwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gSG9sZCBmb3IgYSBtb21lbnQgKDEuNXMpIHRoZW4gdGhyb3cKICAgICAgICAgICAgaWYgKHRoaXMudGhyb3dUaW1lciA+IDEuNSkgewogICAgICAgICAgICAgICAgLy8gRmluZCBiZXN0IHRhcmdldDogUHJlZmVyIE1GIG9yIERlZmVuZGVycywgYnV0IG11c3QgYmUgc29tZXdoYXQgZGlzdGFudCB0byBhdm9pZCAiaGFuZG9mZiIgbG9vawogICAgICAgICAgICAgICAgLy8gRmlsdGVyIGZvciB0ZWFtbWF0ZXMgPiA4IHVuaXRzIGF3YXkgaWYgcG9zc2libGUKICAgICAgICAgICAgICAgIGNvbnN0IHZhbGlkTWF0ZXMgPSB0aGlzLnRlYW0ucGxheWVycy5maWx0ZXIocCA9PiAKICAgICAgICAgICAgICAgICAgICBwICE9PSB0aGlzICYmIAogICAgICAgICAgICAgICAgICAgIHAubWVzaCAmJiAKICAgICAgICAgICAgICAgICAgICBwLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyh0aGlzLm1lc2gucG9zaXRpb24pID4gOC4wCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgIGxldCB0YXJnZXQgPSBudWxsOwoKICAgICAgICAgICAgICAgIC8vIFByaW9yaXR5IDE6IE1pZGZpZWxkZXIgKFBsYXltYWtlcikKICAgICAgICAgICAgICAgIHRhcmdldCA9IHZhbGlkTWF0ZXMuZmluZChwID0+IHAucm9sZSA9PT0gJ01GJyk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFByaW9yaXR5IDI6IERlZmVuZGVycwogICAgICAgICAgICAgICAgaWYgKCF0YXJnZXQpIHRhcmdldCA9IHZhbGlkTWF0ZXMuZmluZChwID0+IHAucm9sZSA9PT0gJ0xEJyB8fCBwLnJvbGUgPT09ICdSRCcpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBQcmlvcml0eSAzOiBBbnlvbmUgb3BlbiAoZmFsbGJhY2sgdG8gY2xvc2UgcmFuZ2UgaWYgbm8gb25lIGlzIGZhcikKICAgICAgICAgICAgICAgIGlmICghdGFyZ2V0KSB0YXJnZXQgPSB0aGlzLnRlYW0ucGxheWVycy5maW5kKHAgPT4gcCAhPT0gdGhpcyAmJiBwLnJvbGUgIT09ICdHTCcpOwoKICAgICAgICAgICAgICAgIGlmICh0YXJnZXQgJiYgdGFyZ2V0Lm1lc2gpIHsKICAgICAgICAgICAgICAgICAgICAvLyBBSU1JTkcgTE9HSUM6IExvZnQgdGhlIHBhc3MKICAgICAgICAgICAgICAgICAgICAvLyBMb29rIGF0IHRhcmdldCwgYnV0IGFpbSBzbGlnaHRseSB1cCB0byBjcmVhdGUgYW4gYXJjCiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0UG9zID0gdGFyZ2V0Lm1lc2gucG9zaXRpb24uY2xvbmUoKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgZGlzdGFuY2UKICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gdGhpcy5tZXNoLnBvc2l0aW9uLmRpc3RhbmNlVG8odGFyZ2V0UG9zKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBMb2Z0IGZhY3RvcjogVGhlIGZ1cnRoZXIgYXdheSwgdGhlIGhpZ2hlciB3ZSBhaW0KICAgICAgICAgICAgICAgICAgICAvLyAyMCB1bml0cyBhd2F5IC0+IEFpbSA1IHVuaXRzIGFib3ZlIGhlYWQKICAgICAgICAgICAgICAgICAgICBjb25zdCBsb2Z0ID0gTWF0aC5tYXgoMS4wLCBkaXN0ICogMC4yNSk7CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0UG9zLnkgKz0gbG9mdDsKCiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNoLmxvb2tBdCh0YXJnZXRQb3MpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFRocm93CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFsbCA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5lbnRpdGllcy5iYWxsOwogICAgICAgICAgICAgICAgICAgIHRoaXMudGhyb3dCYWxsKGJhbGwsICdQQScpOyAKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgJHt0aGlzLnJvbGV9IHRocm93cyB0byAke3RhcmdldC5yb2xlfSAoRGlzdDogJHtkaXN0LnRvRml4ZWQoMSl9KWApOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBDbGVhciBpdCBmb3J3YXJkCiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNoLmxvb2tBdCgwLCA1LCAwKTsgLy8gQWltIHVwLWNlbnRlcgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJhbGwgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZW50aXRpZXMuYmFsbDsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRocm93QmFsbChiYWxsLCAnU0gnKTsgLy8gSGFyZCBjbGVhcgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0aGlzLnRocm93VGltZXIgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHdpbmRvdy5mbHV4LkdvYWxpZSA9IEdvYWxpZTsKfSkoKTs=","/Goalie.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKICAgIAogICAgLy8gUmV1c2FibGUgdmVjdG9ycyB0byBhdm9pZCBHQwpjb25zdCBfZ1ZlYyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfZ1BvcyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfYmFsbFBvcyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfZmFjZVZlYyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfZ29hbENlbnRlciA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfdGVtcFZlY0cgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwoKICAgIGNsYXNzIEdvYWxpZSBleHRlbmRzIHdpbmRvdy5mbHV4LlBsYXllciB7CmNvbnN0cnVjdG9yKHNjZW5lLCByb2xlKSB7CiAgICAgICAgICAgIHN1cGVyKHNjZW5lLCByb2xlKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEdvYWxpZSBTcGVjaWZpYyBTdGF0cyAoQnVmZmVkIGZvciBQbGF5YWJpbGl0eSkKICAgICAgICAgICAgdGhpcy5zdGF0cy5DQSA9IDMwOyAvLyBDYXRjaAogICAgICAgICAgICB0aGlzLnN0YXRzLlNQID0gNDA7IC8vIFNwZWVkCiAgICAgICAgICAgIHRoaXMuc3RhdHMuRU4gPSA1MDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEJVRkZFRDogU3Ryb25nIGFybSBmb3IgY2xlYXJpbmcgdGhlIHpvbmUKICAgICAgICAgICAgdGhpcy5zdGF0cy5QQSA9IDQ1OyAvLyBXYXMgMjAgLSBOb3cgc3Ryb25nIGVub3VnaCB0byByZWFjaCBtaWRmaWVsZAogICAgICAgICAgICB0aGlzLnN0YXRzLlNIID0gMzU7IC8vIFdhcyAxMCAtIERlY2VudCBjbGVhcmFuY2Uga2ljawogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5fdXBkYXRlRGVyaXZlZFN0YXRzKCk7CgogICAgICAgICAgICAvLyBHb2FsIERpbWVuc2lvbnMgKFNhdmUgQm94KQovLyBHb2FsIERpbWVuc2lvbnMgKFNhdmUgQm94KSAtIE1hdGNoZXMgR2FtZU1hbmFnZXIgZGV0ZWN0aW9uCnRoaXMuZ29hbFdpZHRoID0gMzMuMDsgLy8gSW5jcmVhc2VkIDUwJSAod2FzIDIyLjApCiAgICAgICAgICAgIHRoaXMuZ29hbEhlaWdodCA9IDI3LjA7IC8vIEluY3JlYXNlZCA1MCUgKHdhcyAxOC4wKQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU2F2ZSBNZWNoYW5pY3MKICAgICAgICAgICAgdGhpcy5zYXZlUmFkaXVzID0gNi4wOyAKICAgICAgICAgICAgdGhpcy5wcmVzc3VyZU11bHRpcGxpZXIgPSA1LjA7IAogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVGVjaHMKICAgICAgICAgICAgdGhpcy50ZWNocyA9IHsKICAgICAgICAgICAgICAgIGFjdGl2ZTogbnVsbCwgCiAgICAgICAgICAgICAgICBwYXNzaXZlOiBudWxsIAogICAgICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQUkgU3RhdGUKICAgICAgICAgICAgdGhpcy50aHJvd1RpbWVyID0gMDsKICAgICAgICAgICAgdGhpcy5fYWNjdW11bGF0ZWRTYXZlID0gMDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFN1cGVyIEdvYWxpZSBTdGF0ZQogICAgICAgICAgICB0aGlzLmlzU3VwZXJHb2FsaWUgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5zdXBlckdvYWxpZVRpbWVyID0gMDsKICAgICAgICB9Cgp1cGRhdGUoZHQpIHsKICAgICAgICAgICAgLy8gMS4gU3VwZXIgR29hbGllIFRpbWVyCiAgICAgICAgICAgIGlmICh0aGlzLmlzU3VwZXJHb2FsaWUpIHsKICAgICAgICAgICAgICAgIHRoaXMuc3VwZXJHb2FsaWVUaW1lciAtPSBkdDsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnN1cGVyR29hbGllVGltZXIgPD0gMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaXNTdXBlckdvYWxpZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAyLiBQb3NzZXNzaW9uIExvZ2ljIChCYWxsIEhlbGQpCiAgICAgICAgICAgIGlmICh0aGlzLmhhc0JhbGwpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2NoZWNrVGFja2xlUHJlc3N1cmUoZHQpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBnYW1lID0gd2luZG93LmZsdXguZ2FtZUluc3RhbmNlOwogICAgICAgICAgICAgICAgY29uc3QgaXNIdW1hbkNvbnRyb2xsZWQgPSB0aGlzLnRlYW0gJiYgdGhpcy50ZWFtLmlzSHVtYW4gJiYgdGhpcy50ZWFtLmFjdGl2ZVBsYXllciA9PT0gdGhpcyAmJiAhZ2FtZS5pc0RlbW9Nb2RlOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoaXNIdW1hbkNvbnRyb2xsZWQpIHsKICAgICAgICAgICAgICAgICAgICAvLyBIdW1hbjogRnVsbCBjb250cm9sIChSb3RhdGlvbiwgQ2hhcmdpbmcsIGV0YyB2aWEgUGxheWVyLnVwZGF0ZSkKICAgICAgICAgICAgICAgICAgICBzdXBlci51cGRhdGUoZHQpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBBSTogTG9naWMgdGhlbiB1cGRhdGUKICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNUaHJvd2luZykgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9haVBvc3Nlc3Npb25Mb2dpYyhkdCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vIEVuc3VyZSBBSSBkb2Vzbid0IGRyaWZ0CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRJbnB1dCgwLCAwKTsKICAgICAgICAgICAgICAgICAgICBzdXBlci51cGRhdGUoZHQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5fY29uc3RyYWluQm91bmRzKCk7CiAgICAgICAgICAgICAgICByZXR1cm47IAogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAzLiBEZWZlbnNlIC8gU2F2ZSBMb2dpYyAoTm8gQmFsbCkKICAgICAgICAgICAgLy8gV2UgbXVzdCBoYW5kbGUgdGltZXJzIGFuZCBzdGF0dXMgbWFudWFsbHkgYmVjYXVzZSB3ZSBza2lwIHN1cGVyLnVwZGF0ZSgpIHRvIHVzZSBjdXN0b20gbW92ZW1lbnQKICAgICAgICAgICAgaWYgKHRoaXMuZGFzaENvb2xkb3duID4gMCkgdGhpcy5kYXNoQ29vbGRvd24gLT0gZHQ7CiAgICAgICAgICAgIGlmICh0aGlzLmNsYXNoQ29vbGRvd24gPiAwKSB0aGlzLmNsYXNoQ29vbGRvd24gLT0gZHQ7CiAgICAgICAgICAgIGlmICh0aGlzLnN0dW5UaW1lciA+IDApIHRoaXMuc3R1blRpbWVyIC09IGR0OwogICAgICAgICAgICBpZiAodGhpcy5pbW11bml0eVRpbWVyID4gMCkgdGhpcy5pbW11bml0eVRpbWVyIC09IGR0OwoKICAgICAgICAgICAgdGhpcy5fdXBkYXRlU3RhdHVzKGR0KTsKCiAgICAgICAgICAgIGlmICh0aGlzLnN0dW5UaW1lciA+IDAgfHwgdGhpcy5zdGF0dXMubmFwID4gMCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMubWl4ZXIpIHRoaXMubWl4ZXIudXBkYXRlKGR0KTsKICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUhQQmFyKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9jb25zdHJhaW5Cb3VuZHMoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQ3VzdG9tIE1vdmVtZW50CiAgICAgICAgICAgIHRoaXMuX2RlZmVuc2VMb2dpYyhkdCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBVcGRhdGUgQW5pbWF0aW9uCiAgICAgICAgICAgIGlmICh0aGlzLm1peGVyKSB0aGlzLm1peGVyLnVwZGF0ZShkdCk7CiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUhQQmFyKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICB0aGlzLl9jb25zdHJhaW5Cb3VuZHMoKTsKICAgICAgICB9CgpfY29uc3RyYWluQm91bmRzKCkgewogICAgICAgICAgICBpZiAoIXRoaXMubWVzaCkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBwb3MgPSB0aGlzLm1lc2gucG9zaXRpb247CiAgICAgICAgICAgIGNvbnN0IHNpZGUgPSB0aGlzLnRlYW0gPyB0aGlzLnRlYW0uc2lkZSA6IDE7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBYIEJvdW5kcyAoV2lkdGggb2YgcGVuYWx0eSBhcmVhICsvLSAxMG0pIC0+IEluY3JlYXNlZCBmb3IgbWFzc2l2ZSBnb2FsCiAgICAgICAgICAgIGNvbnN0IHhMaW1pdCA9IDMwLjA7IC8vIE1heCB3aWR0aCBvZiBhcmVuYSAoUmFkaXVzIDMyKQogICAgICAgICAgICBpZiAocG9zLnggPiB4TGltaXQpIHsgcG9zLnggPSB4TGltaXQ7IHRoaXMudmVsb2NpdHkueCA9IDA7IH0KICAgICAgICAgICAgaWYgKHBvcy54IDwgLXhMaW1pdCkgeyBwb3MueCA9IC14TGltaXQ7IHRoaXMudmVsb2NpdHkueCA9IDA7IH0KICAgICAgICAgICAgCi8vIFkgQm91bmRzIChIZWlnaHQgKy8tIDE1bSkgLT4gSW5jcmVhc2VkIGZvciBtYXNzaXZlIGdvYWwgaGlnaCBzYXZlcwogICAgICAgICAgICBjb25zdCB5TGltaXQgPSAyMi41OyAvLyBJbmNyZWFzZWQgNTAlICh3YXMgMTUuMCkKICAgICAgICAgICAgaWYgKHBvcy55ID4geUxpbWl0KSB7IHBvcy55ID0geUxpbWl0OyB0aGlzLnZlbG9jaXR5LnkgPSAwOyB9CiAgICAgICAgICAgIGlmIChwb3MueSA8IC15TGltaXQpIHsgcG9zLnkgPSAteUxpbWl0OyB0aGlzLnZlbG9jaXR5LnkgPSAwOyB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBaIEJvdW5kcyAoRGVwdGgpCiAgICAgICAgICAgIC8vIEhvbWUgKFNpZGUgMSk6IEdvYWwgYXQgKzI4LiBUcmlnZ2VyIGF0IDI3LiBMaW1pdCB0byAyNi41IHRvIHByZXZlbnQgd2Fsa2luZyBpbi4KICAgICAgICAgICAgLy8gQXdheSAoU2lkZSAtMSk6IEdvYWwgYXQgLTI4LiBUcmlnZ2VyIGF0IC0yNy4gTGltaXQgdG8gLTI2LjUuCiAgICAgICAgICAgIGlmIChzaWRlID09PSAxKSB7CiAgICAgICAgICAgICAgICBpZiAocG9zLnogPiAyNi41KSB7IHBvcy56ID0gMjYuNTsgdGhpcy52ZWxvY2l0eS56ID0gMDsgfQogICAgICAgICAgICAgICAgaWYgKHBvcy56IDwgMTIuMCkgeyBwb3MueiA9IDEyLjA7IHRoaXMudmVsb2NpdHkueiA9IDA7IH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChwb3MueiA8IC0yNi41KSB7IHBvcy56ID0gLTI2LjU7IHRoaXMudmVsb2NpdHkueiA9IDA7IH0KICAgICAgICAgICAgICAgIGlmIChwb3MueiA+IC0xMi4wKSB7IHBvcy56ID0gLTEyLjA7IHRoaXMudmVsb2NpdHkueiA9IDA7IH0KICAgICAgICAgICAgfQogICAgICAgIH0KCi8vIE92ZXJyaWRlIHRocm93QmFsbCB0byBmaXggIndlYWsgdGhyb3ciIGlzc3VlCi8vIE92ZXJyaWRlIHRocm93QmFsbCB0byBmaXggIndlYWsgdGhyb3ciIGlzc3VlCiAgICAgICAgdGhyb3dCYWxsKGJhbGwsIGZvcmNlZFR5cGUgPSBudWxsLCBwb3dlck11bHRpcGxpZXIgPSAxLjApIHsKICAgICAgICAgICAgLy8gR29hbGllcyBhbG1vc3QgYWx3YXlzIFBBU1MsIGV2ZW4gd2hlbiAiY2xlYXJpbmciIGZvcndhcmQuCiAgICAgICAgICAgIC8vIFRoZSBkZWZhdWx0IFBsYXllciBsb2dpYyBzd2l0Y2hlcyB0byAnU0gnIChTaG9vdCkgaWYgYWltaW5nIGZvcndhcmQsIAogICAgICAgICAgICAvLyB3aGljaCB1c2VzIHRoZSBHb2FsaWUncyBsb3dlciBTSCBzdGF0LiBXZSBmb3JjZSBQQSB1bmxlc3Mgc3BlY2lmaWVkLgogICAgICAgICAgICBjb25zdCB0eXBlID0gZm9yY2VkVHlwZSB8fCAnUEEnOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQk9PU1Q6IEFwcGx5IGEgbXVsdGlwbGllciB0byBlbnN1cmUgdGhlIGdvYWxpZSBjYW4gY2xlYXIgdGhlIGJhbGwgdG8gbWlkZmllbGQuCiAgICAgICAgICAgIC8vIE5FUkZFRDogUmVkdWNlZCBmcm9tIDEuNiB0byAxLjIgdG8gcHJldmVudCBjcm9zcy1tYXAgdGhyb3dzIGFzIHBlciB1c2VyIGZlZWRiYWNrLgogICAgICAgICAgICBjb25zdCBib29zdCA9IDEuMjsKCiAgICAgICAgICAgIHN1cGVyLnRocm93QmFsbChiYWxsLCB0eXBlLCBwb3dlck11bHRpcGxpZXIgKiBib29zdCk7CiAgICAgICAgfQoKX2RlZmVuc2VMb2dpYyhkdCkgewogICAgICAgICAgICAvLyAwLiBHYW1lIFN0YXRlIENoZWNrCiAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2Uuc3RhdGUgIT09ICdhY3RpdmUnKSByZXR1cm47CgogICAgICAgICAgICBjb25zdCBiYWxsID0gd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmVudGl0aWVzLmJhbGw7CiAgICAgICAgICAgIGlmICghYmFsbCB8fCAhYmFsbC5tZXNoKSByZXR1cm47CgogICAgICAgICAgICAvLyBEZXRlcm1pbmUgVGhyZWF0IFNvdXJjZQogICAgICAgICAgICBsZXQgdGhyZWF0UG9zID0gX2JhbGxQb3M7CiAgICAgICAgICAgIGxldCBpc1RocmVhdCA9IGZhbHNlOwogICAgICAgICAgICBjb25zdCBteUdvYWxaID0gKHRoaXMudGVhbS5zaWRlID09PSAxKSA/IDI4IDogLTI4OwoKICAgICAgICAgICAgLy8gQ2FzZSBBOiBCYWxsIGlzIEhlbGQgKFByZS10aHJvdykKICAgICAgICAgICAgaWYgKGJhbGwuc3RhdGUgPT09ICdoZWxkJyAmJiBiYWxsLmhvbGRlciAmJiBiYWxsLmhvbGRlci50ZWFtICE9PSB0aGlzLnRlYW0pIHsKICAgICAgICAgICAgICAgIHRocmVhdFBvcyA9IGJhbGwuaG9sZGVyLm1lc2gucG9zaXRpb247CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIGhvbGRlciBpcyBpbiBhdHRhY2tpbmcgaGFsZiBvciBuZWFyIGVub3VnaAogICAgICAgICAgICAgICAgY29uc3QgZGlzdFRvR29hbCA9IE1hdGguYWJzKHRocmVhdFBvcy56IC0gbXlHb2FsWik7CiAgICAgICAgICAgICAgICBpZiAoZGlzdFRvR29hbCA8IDQwLjApIHsgLy8gSWYgdGhleSBhcmUgd2l0aGluIDQwbSwgdHJhY2sgdGhlbQogICAgICAgICAgICAgICAgICAgIGlzVGhyZWF0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSAKICAgICAgICAgICAgLy8gQ2FzZSBCOiBCYWxsIGlzIEZyZWUgKFNob3QvUGFzcykKICAgICAgICAgICAgZWxzZSBpZiAoYmFsbC5zdGF0ZSA9PT0gJ2ZyZWUnKSB7CiAgICAgICAgICAgICAgICB0aHJlYXRQb3MgPSBiYWxsLm1lc2gucG9zaXRpb247CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIERpcmVjdGlvbiBDaGVjawogICAgICAgICAgICAgICAgY29uc3QgbW92aW5nVG93YXJkcyA9ICh0aGlzLnRlYW0uc2lkZSA9PT0gMSAmJiBiYWxsLnZlbG9jaXR5LnogPiAwKSB8fCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAodGhpcy50ZWFtLnNpZGUgPT09IC0xICYmIGJhbGwudmVsb2NpdHkueiA8IDApOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBQb3NpdGlvbiBDaGVjawogICAgICAgICAgICAgICAgY29uc3QgaW5Gcm9udE9mR29hbCA9ICh0aGlzLnRlYW0uc2lkZSA9PT0gMSAmJiB0aHJlYXRQb3MueiA8IDI3LjUpIHx8IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLnRlYW0uc2lkZSA9PT0gLTEgJiYgdGhyZWF0UG9zLnogPiAtMjcuNSk7CgogICAgICAgICAgICAgICAgaXNUaHJlYXQgPSBtb3ZpbmdUb3dhcmRzICYmIGluRnJvbnRPZkdvYWw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChpc1RocmVhdCkgewogICAgICAgICAgICAgICAgLy8gLS0tIFBPU0lUSU9OSU5HOiBBTkdMRSBDVVRUSU5HIC0tLQogICAgICAgICAgICAgICAgX2JhbGxQb3MuY29weSh0aHJlYXRQb3MpOyAvLyBVcGRhdGUgcmVmZXJlbmNlIGZvciBsb29rQXQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gMS4gQ2FsY3VsYXRlIEdvYWwgQ2VudGVyCi8vIDEuIENhbGN1bGF0ZSBHb2FsIENlbnRlciAoQWRqdXN0ZWQgZm9yIFkgb2Zmc2V0KQogICAgICAgICAgICAgICAgX2dvYWxDZW50ZXIuc2V0KDAsIC0yLjIsIG15R29hbFopOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyAyLiBWZWN0b3IgZnJvbSBHb2FsIHRvIEJhbGwKICAgICAgICAgICAgICAgIF90ZW1wVmVjRy5zdWJWZWN0b3JzKF9iYWxsUG9zLCBfZ29hbENlbnRlcik7CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0VG9CYWxsID0gX3RlbXBWZWNHLmxlbmd0aCgpOwogICAgICAgICAgICAgICAgX3RlbXBWZWNHLm5vcm1hbGl6ZSgpOyAvLyBOb3cgaG9sZHMgZGlyZWN0aW9uCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIDMuIERldGVybWluZSBFeHRlbnNpb24gKEhvdyBmYXIgb3V0IHRvIHN0ZXApCiAgICAgICAgICAgICAgICAvLyBCYXNlOiAxLjVtIG9mZiBsaW5lLgogICAgICAgICAgICAgICAgLy8gTWF4OiA2LjBtIG9mZiBsaW5lIChDdXR0aW5nIGFuZ2xlKS4KICAgICAgICAgICAgICAgIC8vIFNjYWxlIGJhc2VkIG9uIGJhbGwgcHJveGltaXR5OiBDbG9zZXIgYmFsbCA9IE1vcmUgZXh0ZW5zaW9uICh0byBhIHBvaW50KQpsZXQgZXh0ZW5zaW9uID0gMS41OwogICAgICAgICAgICAgICAgaWYgKGRpc3RUb0JhbGwgPCAzMC4wKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmF0aW8gPSAxLjAgLSAoTWF0aC5tYXgoMCwgZGlzdFRvQmFsbCAtIDUuMCkgLyAyNS4wKTsgCiAgICAgICAgICAgICAgICAgICAgZXh0ZW5zaW9uID0gMS41ICsgKDQuNSAqIHJhdGlvKTsgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKLy8gU2FmZXR5OiBEb24ndCBnbyBwYXN0IHRoZSBiYWxsIChrZWVwIDFtIGJ1ZmZlcikKICAgICAgICAgICAgICAgIGV4dGVuc2lvbiA9IE1hdGgubWluKGV4dGVuc2lvbiwgZGlzdFRvQmFsbCAtIDEuMCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIDQuIENhbGN1bGF0ZSBUYXJnZXQgUG9zaXRpb24gKEJhc2UgSW50ZXJjZXB0aW9uKQogICAgICAgICAgICAgICAgX2dQb3MuY29weShfZ29hbENlbnRlcikuYWRkKF90ZW1wVmVjRy5tdWx0aXBseVNjYWxhcihleHRlbnNpb24pKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gNS4gVmVydGljYWwgT3ZlcnJpZGUgKEp1bXAgdG8gbWVldCBiYWxsKQogICAgICAgICAgICAgICAgLy8gRXhwbGljaXRseSBzZXQgWSB0byBtYXRjaCBiYWxsIGhlaWdodCBpZiBpdCdzIGhpZ2gKICAgICAgICAgICAgICAgIGlmIChfYmFsbFBvcy55ID4gMC41KSB7CiAgICAgICAgICAgICAgICAgICAgX2dQb3MueSA9IF9iYWxsUG9zLnk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIF9nUG9zLnkgPSAwLjU7IC8vIERlZmF1bHQgc3RhbmNlCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gNi4gQ2xhbXAgdG8gR29hbCBCb3ggRGltZW5zaW9ucyAoTGF0ZXJhbC9WZXJ0aWNhbCBMaW1pdHMpCiAgICAgICAgICAgICAgICAvLyBHb2FsIFdpZHRoIDIyICgrLy0gMTEpLCBIZWlnaHQgMTggKCsvLSA5KS4KICAgICAgICAgICAgICAgIC8vIEFsbG93IHNsaWdodGx5IG91dHNpZGUgcG9zdHMgdG8gY292ZXIgYW5nbGVzLgogICAgICAgICAgICAgICAgY29uc3QgY2xhbXBYID0gdGhpcy5nb2FsV2lkdGggKiAwLjY7IC8vICsvLSAxMy4yCmNvbnN0IGNsYW1wWSA9IDIxLjA7IC8vIEFsbG93IGhpZ2gganVtcHMgdXAgdG8gMjFtICh3YXMgMTQuMCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgX2dQb3MueCA9IE1hdGgubWF4KC1jbGFtcFgsIE1hdGgubWluKGNsYW1wWCwgX2dQb3MueCkpOwogICAgICAgICAgICAgICAgX2dQb3MueSA9IE1hdGgubWF4KC1jbGFtcFksIE1hdGgubWluKGNsYW1wWSwgX2dQb3MueSkpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyA2LiBMZWFkIHRoZSBiYWxsIHNsaWdodGx5IGlmIGl0IGhhcyBsYXRlcmFsIHZlbG9jaXR5IChBbnRpY2lwYXRpb24pCmlmIChiYWxsLnZlbG9jaXR5Lmxlbmd0aFNxKCkgPiAxLjApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBhbnRpY2lwYXRpb24gPSBiYWxsLnZlbG9jaXR5LmNsb25lKCkubXVsdGlwbHlTY2FsYXIoMC4yNSk7IC8vIDAuMjVzIGxlYWQKICAgICAgICAgICAgICAgICAgICBhbnRpY2lwYXRpb24ueiA9IDA7IC8vIE9ubHkgbGF0ZXJhbCBsZWFkCiAgICAgICAgICAgICAgICAgICAgX2dQb3MuYWRkKGFudGljaXBhdGlvbik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gQ0xBTVAgWjogUHJldmVudCBHb2FsaWUgZnJvbSBnb2luZyBpbnRvIHRoZSBuZXQgb3IgYmVoaW5kIGdvYWwKLy8gQ0xBTVAgWjogUHJldmVudCBHb2FsaWUgZnJvbSBnb2luZyBpbnRvIHRoZSBuZXQgb3IgYmVoaW5kIGdvYWwKICAgICAgICAgICAgICAgIGlmICh0aGlzLnRlYW0uc2lkZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgIF9nUG9zLnogPSBNYXRoLm1pbigyNi41LCBfZ1Bvcy56KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgX2dQb3MueiA9IE1hdGgubWF4KC0yNi41LCBfZ1Bvcy56KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBNb3ZlIHRvd2FyZHMgdGFyZ2V0CiAgICAgICAgICAgICAgICBjb25zdCBtb3ZlRGlyID0gX2dWZWMuc3ViVmVjdG9ycyhfZ1BvcywgdGhpcy5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgIGNvbnN0IGRpc3RUb1RhcmdldCA9IG1vdmVEaXIubGVuZ3RoKCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChkaXN0VG9UYXJnZXQgPiAwLjEpIHsKICAgICAgICAgICAgICAgICAgICBtb3ZlRGlyLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgICAgIC8vIEJ1cnN0IHNwZWVkIGZvciBzYXZlcyBpZiBiYWxsIGlzIGNsb3NlCiAgICAgICAgICAgICAgICAgICAgY29uc3QgdXJnZW5jeSA9IChkaXN0VG9CYWxsIDwgMTAuMCkgPyAxLjUgOiAxLjA7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3BlZWQgPSB0aGlzLm1heFNwZWVkICogdXJnZW5jeTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB0aGlzLm1lc2gucG9zaXRpb24uYWRkKG1vdmVEaXIubXVsdGlwbHlTY2FsYXIoc3BlZWQgKiBkdCkpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEZhY2UgYmFsbAogICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5sb29rQXQoX2JhbGxQb3MpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSAnc3dpbScpIHRoaXMucGxheSgnc3dpbScsIDAuMik7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSAnaWRsZScpIHRoaXMucGxheSgnaWRsZScsIDAuMik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNoLmxvb2tBdChfYmFsbFBvcyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gLS0tIFNBVkUgTUVDSEFOSUMgLS0tCiAgICAgICAgICAgICAgICAvLyBJZiBiYWxsIGlzIHdpdGhpbiByYW5nZSwgYXBwbHkgQ0EgcHJlc3N1cmUKICAgICAgICAgICAgICAgIGNvbnN0IGRpc3QgPSB0aGlzLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyhiYWxsLm1lc2gucG9zaXRpb24pOwogICAgICAgICAgICAgICAgaWYgKGRpc3QgPCB0aGlzLnNhdmVSYWRpdXMpIHsgCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXBwbHlTYXZlUHJlc3N1cmUoYmFsbCwgZHQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gLS0tIElETEUgLyBSRVRVUk4gVE8gUE9TVCAtLS0KICAgICAgICAgICAgICAgIC8vIFJldHVybiB0byBob21lIHBvc2l0aW9uICh1c3VhbGx5IGNlbnRlciBvZiBnb2FsKQogICAgICAgICAgICAgICAgX2dQb3MuY29weSh0aGlzLmhvbWVQb3NpdGlvbik7CiAgICAgICAgICAgICAgICBjb25zdCBtb3ZlRGlyID0gX2dWZWMuc3ViVmVjdG9ycyhfZ1BvcywgdGhpcy5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKG1vdmVEaXIubGVuZ3RoKCkgPiAwLjUpIHsKICAgICAgICAgICAgICAgICAgICBtb3ZlRGlyLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi5hZGQobW92ZURpci5tdWx0aXBseVNjYWxhcih0aGlzLm1heFNwZWVkICogMC42ICogZHQpKTsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSAhPT0gJ3N3aW0nKSB0aGlzLnBsYXkoJ3N3aW0nLCAwLjIpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSAhPT0gJ2lkbGUnKSB0aGlzLnBsYXkoJ2lkbGUnLCAwLjIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBGYWNlIGNlbnRlciBmaWVsZAogICAgICAgICAgICAgICAgdGhpcy5tZXNoLmxvb2tBdCgwLCAwLCAwKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX2FwcGx5U2F2ZVByZXNzdXJlKGJhbGwsIGR0KSB7CiAgICAgICAgICAgIC8vIElmIEdvYWxpZSBpcyBBc2xlZXAsIHRoZXkgY2Fubm90IHNhdmUuCiAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cy5uYXAgPiAwKSByZXR1cm47CgogICAgICAgICAgICAvLyAtLS0gU1VQRVIgR09BTElFIFRSSUdHRVIgLS0tCiAgICAgICAgICAgIC8vIFRyaWdnZXIgaWY6IFRlY2ggZXF1aXBwZWQsIE5vdCBhY3RpdmUsIEJhbGwgaGFzIHBvd2VyLCBCYWxsIGlzIGNsb3NlCiAgICAgICAgICAgIGlmICh0aGlzLnRlY2hzLmFjdGl2ZSA9PT0gJ3N1cGVyX2dvYWxpZScgJiYgIXRoaXMuaXNTdXBlckdvYWxpZSAmJiBiYWxsLnBvd2VyID4gNS4wKSB7CiAgICAgICAgICAgICAgICAvLyBDaGFuY2UgdG8gdHJpZ2dlciAoSGlnaCBjaGFuY2UgZm9yIEFJLCBvciBjaGVjayBIUCkKICAgICAgICAgICAgICAgIC8vIENvc3Q6IDEwIEhQCiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0cy5IUCA+PSAxMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdHMuSFAgLT0gMTA7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc1N1cGVyR29hbGllID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnN1cGVyR29hbGllVGltZXIgPSAxLjU7IC8vIExhc3RzIDEuNXMKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgJHt0aGlzLnJvbGV9IHVzZWQgU1VQRVIgR09BTElFIWApOwogICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIlNVUEVSIEdPQUxJRSEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJzYXZlIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFRyaWdnZXIgVGVjaGNvcHkgRXZlbnQKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlICYmIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS50cmlnZ2VyVGVjaEV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS50cmlnZ2VyVGVjaEV2ZW50KHRoaXMsICdzdXBlcl9nb2FsaWUnKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBFZmZlY3RpdmUgQ0EKICAgICAgICAgICAgbGV0IGNhID0gdGhpcy5nZXRTdGF0KCdDQScpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQXBwbHkgU3VwZXIgR29hbGllIEJvbnVzIChlLmcuICs1MCUgKyBGbGF0IDEwKQogICAgICAgICAgICBpZiAodGhpcy5pc1N1cGVyR29hbGllKSB7CiAgICAgICAgICAgICAgICBjYSA9IChjYSAqIDEuNSkgKyAxMDsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQXBwbHkgR3JpcCBHbG92ZXMgKFBhc3NpdmUpCiAgICAgICAgICAgIGlmICh0aGlzLnRlY2hzLnBhc3NpdmUgPT09ICdncmlwX2dsb3ZlcycpIHsKICAgICAgICAgICAgICAgIGNhICs9IDU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBQcmVzc3VyZQogICAgICAgICAgICAvLyBQcmVzc3VyZSA9IENBICogZHQgKiBNdWx0aXBsaWVyCiAgICAgICAgICAgIGNvbnN0IHByZXNzdXJlID0gY2EgKiBkdCAqIHRoaXMucHJlc3N1cmVNdWx0aXBsaWVyOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGJhbGwucG93ZXIgPiAwKSB7CiAgICAgICAgICAgICAgICBiYWxsLnBvd2VyIC09IHByZXNzdXJlOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBWaXN1YWwgRmVlZGJhY2sKICAgICAgICAgICAgICAgIHRoaXMuX2FjY3VtdWxhdGVkU2F2ZSArPSBwcmVzc3VyZTsKICAgICAgICAgICAgICAgIC8vIFRIUk9UVExFOiBJbmNyZWFzZWQgdGhyZXNob2xkIHRvIDEyLjAKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9hY2N1bXVsYXRlZFNhdmUgPj0gMTIuMCkgeyAKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLmZsb2F0aW5nVGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJCTE9DSyEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJjb21pYy1pbXBhY3QiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWNjdW11bGF0ZWRTYXZlID0gMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQXBwbHkgQmFsbCBUZWNobmlxdWUgdG8gR29hbGllIChSaXNrIG9mIGNhdGNoaW5nIHNwZWNpYWwgc2hvdHMpCiAgICAgICAgICAgIGlmIChiYWxsLnRlY2huaXF1ZSAmJiAhdGhpcy5fdGVjaEFwcGxpZWQpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3RlY2hBcHBsaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGNvbnN0IHRlY2ggPSBiYWxsLnRlY2huaXF1ZTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKHRlY2gudHlwZSA9PT0gJ3Zlbm9tJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwbHlTdGF0dXMoJ3Zlbm9tJywgMTUuMCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRlY2gudHlwZSA9PT0gJ25hcCcpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGx5U3RhdHVzKCduYXAnLCA4LjApOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0ZWNoLnR5cGUgPT09ICd3aXRoZXInKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBseVN0YXR1cygnd2l0aGVyJywgMTUuMCwgJ0NBJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsgdGhpcy5fdGVjaEFwcGxpZWQgPSBmYWxzZTsgfSwgMjAwMCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIENoZWNrIFJlc3VsdAogICAgICAgICAgICBpZiAoYmFsbC5wb3dlciA8PSAwKSB7CiAgICAgICAgICAgICAgICAvLyBDQVRDSAogICAgICAgICAgICAgICAgdGhpcy5jYXRjaEJhbGwoYmFsbCk7CiAgICAgICAgICAgIH0gCiAgICAgICAgfQoKICAgICAgICBjYXRjaEJhbGwoYmFsbCkgewogICAgICAgICAgICBiYWxsLmdyYWIodGhpcyk7CiAgICAgICAgICAgIHRoaXMucGxheSgnY2F0Y2gnLCAwLjEpOwogICAgICAgICAgICBjb25zb2xlLmxvZygiU0FWRUQgYnkgIiArIHRoaXMucm9sZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBFWFAgUkVXQVJEOiBTYXZlCiAgICAgICAgICAgIHRoaXMuZ2FpbkV4cCg1KTsKCiAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0KSB7CiAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZmxvYXRpbmdUZXh0LnNwYXduKCJTQVZFRCEiLCB0aGlzLm1lc2gucG9zaXRpb24sICJjb21pYy1pbXBhY3QiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlLnRyaWdnZXJJbXBhY3QpIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS50cmlnZ2VySW1wYWN0KDAuMTUsICdoZWF2eScpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gUmVzZXQgdGhyb3cgdGltZXIKICAgICAgICAgICAgdGhpcy50aHJvd1RpbWVyID0gMDsKICAgICAgICB9CgpfYWlQb3NzZXNzaW9uTG9naWMoZHQpIHsKICAgICAgICAgICAgdGhpcy50aHJvd1RpbWVyICs9IGR0OwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gSG9sZCBmb3IgYSBtb21lbnQgKDEuNXMpIHRoZW4gdGhyb3cKICAgICAgICAgICAgaWYgKHRoaXMudGhyb3dUaW1lciA+IDEuNSkgewogICAgICAgICAgICAgICAgLy8gRmluZCBiZXN0IHRhcmdldDogUHJlZmVyIE1GIG9yIERlZmVuZGVycywgYnV0IG11c3QgYmUgc29tZXdoYXQgZGlzdGFudCB0byBhdm9pZCAiaGFuZG9mZiIgbG9vawogICAgICAgICAgICAgICAgLy8gRmlsdGVyIGZvciB0ZWFtbWF0ZXMgPiA4IHVuaXRzIGF3YXkgaWYgcG9zc2libGUKICAgICAgICAgICAgICAgIGNvbnN0IHZhbGlkTWF0ZXMgPSB0aGlzLnRlYW0ucGxheWVycy5maWx0ZXIocCA9PiAKICAgICAgICAgICAgICAgICAgICBwICE9PSB0aGlzICYmIAogICAgICAgICAgICAgICAgICAgIHAubWVzaCAmJiAKICAgICAgICAgICAgICAgICAgICBwLm1lc2gucG9zaXRpb24uZGlzdGFuY2VUbyh0aGlzLm1lc2gucG9zaXRpb24pID4gOC4wCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgIGxldCB0YXJnZXQgPSBudWxsOwoKICAgICAgICAgICAgICAgIC8vIFByaW9yaXR5IDE6IE1pZGZpZWxkZXIgKFBsYXltYWtlcikKICAgICAgICAgICAgICAgIHRhcmdldCA9IHZhbGlkTWF0ZXMuZmluZChwID0+IHAucm9sZSA9PT0gJ01GJyk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFByaW9yaXR5IDI6IERlZmVuZGVycwogICAgICAgICAgICAgICAgaWYgKCF0YXJnZXQpIHRhcmdldCA9IHZhbGlkTWF0ZXMuZmluZChwID0+IHAucm9sZSA9PT0gJ0xEJyB8fCBwLnJvbGUgPT09ICdSRCcpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBQcmlvcml0eSAzOiBBbnlvbmUgb3BlbiAoZmFsbGJhY2sgdG8gY2xvc2UgcmFuZ2UgaWYgbm8gb25lIGlzIGZhcikKICAgICAgICAgICAgICAgIGlmICghdGFyZ2V0KSB0YXJnZXQgPSB0aGlzLnRlYW0ucGxheWVycy5maW5kKHAgPT4gcCAhPT0gdGhpcyAmJiBwLnJvbGUgIT09ICdHTCcpOwoKICAgICAgICAgICAgICAgIGlmICh0YXJnZXQgJiYgdGFyZ2V0Lm1lc2gpIHsKICAgICAgICAgICAgICAgICAgICAvLyBBSU1JTkcgTE9HSUM6IExvZnQgdGhlIHBhc3MKICAgICAgICAgICAgICAgICAgICAvLyBMb29rIGF0IHRhcmdldCwgYnV0IGFpbSBzbGlnaHRseSB1cCB0byBjcmVhdGUgYW4gYXJjCiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0UG9zID0gdGFyZ2V0Lm1lc2gucG9zaXRpb24uY2xvbmUoKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgZGlzdGFuY2UKICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gdGhpcy5tZXNoLnBvc2l0aW9uLmRpc3RhbmNlVG8odGFyZ2V0UG9zKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBMb2Z0IGZhY3RvcjogVGhlIGZ1cnRoZXIgYXdheSwgdGhlIGhpZ2hlciB3ZSBhaW0KICAgICAgICAgICAgICAgICAgICAvLyAyMCB1bml0cyBhd2F5IC0+IEFpbSA1IHVuaXRzIGFib3ZlIGhlYWQKICAgICAgICAgICAgICAgICAgICBjb25zdCBsb2Z0ID0gTWF0aC5tYXgoMS4wLCBkaXN0ICogMC4yNSk7CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0UG9zLnkgKz0gbG9mdDsKCiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNoLmxvb2tBdCh0YXJnZXRQb3MpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFRocm93CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFsbCA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5lbnRpdGllcy5iYWxsOwogICAgICAgICAgICAgICAgICAgIHRoaXMudGhyb3dCYWxsKGJhbGwsICdQQScpOyAKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgJHt0aGlzLnJvbGV9IHRocm93cyB0byAke3RhcmdldC5yb2xlfSAoRGlzdDogJHtkaXN0LnRvRml4ZWQoMSl9KWApOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBDbGVhciBpdCBmb3J3YXJkCiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNoLmxvb2tBdCgwLCA1LCAwKTsgLy8gQWltIHVwLWNlbnRlcgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJhbGwgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuZW50aXRpZXMuYmFsbDsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRocm93QmFsbChiYWxsLCAnU0gnKTsgLy8gSGFyZCBjbGVhcgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0aGlzLnRocm93VGltZXIgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHdpbmRvdy5mbHV4LkdvYWxpZSA9IEdvYWxpZTsKfSkoKTs=","MiniMap.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICBjbGFzcyBNaW5pTWFwIHsKICAgICAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICAgICAgdGhpcy5jb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWluaW1hcCcpOwogICAgICAgICAgICB0aGlzLmRvdHMgPSBuZXcgTWFwKCk7IC8vIE1hcCBlbnRpdHkgdG8gRE9NIGVsZW1lbnQKICAgICAgICAgICAgdGhpcy53aWR0aCA9IDEwMDsgLy8gTWF0Y2hlcyBDU1Mgd2lkdGgKICAgICAgICAgICAgdGhpcy5oZWlnaHQgPSAxMDA7IC8vIE1hdGNoZXMgQ1NTIGhlaWdodAogICAgICAgICAgICB0aGlzLndvcmxkUmFkaXVzID0gMzA7IC8vIEFyZW5hIHJhZGl1cwogICAgICAgIH0KCiAgICAgICAgcmVnaXN0ZXIoZW50aXR5LCB0eXBlKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5jb250YWluZXIpIHJldHVybjsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGRvdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICBkb3QuY2xhc3NOYW1lID0gYG1hcC1kb3QgJHt0eXBlfWA7CiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKGRvdCk7CiAgICAgICAgICAgIAogICAgICAgICAgICB0aGlzLmRvdHMuc2V0KGVudGl0eSwgZG90KTsKICAgICAgICB9CgogICAgICAgIGluaXQoaG9tZVRlYW0sIGF3YXlUZWFtLCBiYWxsKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5jb250YWluZXIpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5jb250YWluZXIuaW5uZXJIVE1MID0gJyc7IC8vIENsZWFyIGV4aXN0aW5nCiAgICAgICAgICAgIHRoaXMuZG90cy5jbGVhcigpOwoKICAgICAgICAgICAgLy8gUmVnaXN0ZXIgSG9tZSBUZWFtCiAgICAgICAgICAgIGhvbWVUZWFtLnBsYXllcnMuZm9yRWFjaChwID0+IHRoaXMucmVnaXN0ZXIocCwgJ2hvbWUnKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBSZWdpc3RlciBBd2F5IFRlYW0KICAgICAgICAgICAgYXdheVRlYW0ucGxheWVycy5mb3JFYWNoKHAgPT4gdGhpcy5yZWdpc3RlcihwLCAnYXdheScpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFJlZ2lzdGVyIEJhbGwKICAgICAgICAgICAgdGhpcy5yZWdpc3RlcihiYWxsLCAnYmFsbCcpOwogICAgICAgIH0KCiAgICAgICAgdXBkYXRlKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuY29udGFpbmVyKSByZXR1cm47CgogICAgICAgICAgICBjb25zdCBoYWxmVyA9IHRoaXMud2lkdGggLyAyOwogICAgICAgICAgICBjb25zdCBoYWxmSCA9IHRoaXMuaGVpZ2h0IC8gMjsKICAgICAgICAgICAgLy8gU2NhbGU6IE1hcCBSYWRpdXMgKDUwcHgpIC8gV29ybGQgUmFkaXVzICgzMCB1bml0cykKICAgICAgICAgICAgY29uc3Qgc2NhbGUgPSBoYWxmVyAvIHRoaXMud29ybGRSYWRpdXM7IAoKZm9yIChjb25zdCBbZW50aXR5LCBkb3RdIG9mIHRoaXMuZG90cykgewogICAgICAgICAgICAgICAgaWYgKCFlbnRpdHkubWVzaCkgY29udGludWU7CgogICAgICAgICAgICAgICAgLy8gSW52aXNpYmxlIEJhbGwgTG9naWMKICAgICAgICAgICAgICAgIGlmIChlbnRpdHkuaXNJbnZpc2libGUpIHsKICAgICAgICAgICAgICAgICAgICBkb3Quc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZG90LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCFlbnRpdHkubWVzaCkgY29udGludWU7CgogICAgICAgICAgICAgICAgY29uc3QgcG9zID0gZW50aXR5Lm1lc2gucG9zaXRpb247CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIE1hcCBMb2dpYzoKICAgICAgICAgICAgICAgIC8vIFdvcmxkIFogaXMgVXAvRG93bi4gLVogaXMgVG9wIChBdHRhY2sgRGlyZWN0aW9uIGZvciBIb21lKSwgK1ogaXMgQm90dG9tLgogICAgICAgICAgICAgICAgLy8gV29ybGQgWCBpcyBMZWZ0L1JpZ2h0LgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgcmF3IHBvc2l0aW9uIHJlbGF0aXZlIHRvIGNlbnRlcgogICAgICAgICAgICAgICAgbGV0IGR4ID0gcG9zLnggKiBzY2FsZTsKICAgICAgICAgICAgICAgIGxldCBkeSA9IHBvcy56ICogc2NhbGU7CgogICAgICAgICAgICAgICAgLy8gQ2xhbXAgdG8gY2lyY2xlIChrZWVwIGRvdHMgaW5zaWRlIHRoZSBtYXApCiAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gTWF0aC5zcXJ0KGR4KmR4ICsgZHkqZHkpOwogICAgICAgICAgICAgICAgY29uc3QgbWF4RGlzdCA9IGhhbGZXIC0gMjsgLy8gLTIgZm9yIGRvdCByYWRpdXMgcGFkZGluZwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoZGlzdCA+IG1heERpc3QpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBhbmdsZSA9IE1hdGguYXRhbjIoZHksIGR4KTsKICAgICAgICAgICAgICAgICAgICBkeCA9IE1hdGguY29zKGFuZ2xlKSAqIG1heERpc3Q7CiAgICAgICAgICAgICAgICAgICAgZHkgPSBNYXRoLnNpbihhbmdsZSkgKiBtYXhEaXN0OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIENvbnZlcnQgdG8gQ1NTIGNvb3JkaW5hdGVzICgwLDAgaXMgVG9wLUxlZnQpCiAgICAgICAgICAgICAgICAvLyBDZW50ZXIgaXMgKDUwLCA1MCkKICAgICAgICAgICAgICAgIGNvbnN0IGNzc1ggPSBoYWxmVyArIGR4OwogICAgICAgICAgICAgICAgY29uc3QgY3NzWSA9IGhhbGZIICsgZHk7CgogICAgICAgICAgICAgICAgZG90LnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoJHtjc3NYfXB4LCAke2Nzc1l9cHgpYDsKICAgICAgICAgICAgICAgIAovLyBTdGF0dXMgVXBkYXRlcwogICAgICAgICAgICAgICAgaWYgKGVudGl0eS5zdGF0dXMpIHsKICAgICAgICAgICAgICAgICAgICAvLyBOYXAgKFNsZWVwKSB0dXJucyBkb3QgZGFyay9ibGFjawogICAgICAgICAgICAgICAgICAgIGlmIChlbnRpdHkuc3RhdHVzLm5hcCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFkb3QuY2xhc3NMaXN0LmNvbnRhaW5zKCduYXAnKSkgZG90LmNsYXNzTGlzdC5hZGQoJ25hcCcpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkb3QuY2xhc3NMaXN0LmNvbnRhaW5zKCduYXAnKSkgZG90LmNsYXNzTGlzdC5yZW1vdmUoJ25hcCcpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBBY3RpdmUgUGxheWVyIE1hcmtlciAoR3JlZW4pCi8vIEFjdGl2ZSBQbGF5ZXIgTWFya2VyIChHcmVlbikKICAgICAgICAgICAgICAgIGNvbnN0IGdhbWUgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2U7CiAgICAgICAgICAgICAgICBjb25zdCBpc0FjdGl2ZSA9IChnYW1lICYmIGdhbWUudGVhbXMuaG9tZSAmJiBnYW1lLnRlYW1zLmhvbWUuYWN0aXZlUGxheWVyID09PSBlbnRpdHkpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoaXNBY3RpdmUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIWRvdC5jbGFzc0xpc3QuY29udGFpbnMoJ2FjdGl2ZS1wbGF5ZXInKSkgZG90LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZS1wbGF5ZXInKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRvdC5jbGFzc0xpc3QuY29udGFpbnMoJ2FjdGl2ZS1wbGF5ZXInKSkgZG90LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZS1wbGF5ZXInKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBCYWxsIENhcnJpZXIgTWFya2VyIChHbG93KQogICAgICAgICAgICAgICAgaWYgKGVudGl0eS5oYXNCYWxsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFkb3QuY2xhc3NMaXN0LmNvbnRhaW5zKCdiYWxsLWNhcnJpZXInKSkgZG90LmNsYXNzTGlzdC5hZGQoJ2JhbGwtY2FycmllcicpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZG90LmNsYXNzTGlzdC5jb250YWlucygnYmFsbC1jYXJyaWVyJykpIGRvdC5jbGFzc0xpc3QucmVtb3ZlKCdiYWxsLWNhcnJpZXInKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgICAgICAgICAgCgogICAgCgogICAgd2luZG93LmZsdXguTWluaU1hcCA9IE1pbmlNYXA7Cn0pKCk7","./MiniMap.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICBjbGFzcyBNaW5pTWFwIHsKICAgICAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICAgICAgdGhpcy5jb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWluaW1hcCcpOwogICAgICAgICAgICB0aGlzLmRvdHMgPSBuZXcgTWFwKCk7IC8vIE1hcCBlbnRpdHkgdG8gRE9NIGVsZW1lbnQKICAgICAgICAgICAgdGhpcy53aWR0aCA9IDEwMDsgLy8gTWF0Y2hlcyBDU1Mgd2lkdGgKICAgICAgICAgICAgdGhpcy5oZWlnaHQgPSAxMDA7IC8vIE1hdGNoZXMgQ1NTIGhlaWdodAogICAgICAgICAgICB0aGlzLndvcmxkUmFkaXVzID0gMzA7IC8vIEFyZW5hIHJhZGl1cwogICAgICAgIH0KCiAgICAgICAgcmVnaXN0ZXIoZW50aXR5LCB0eXBlKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5jb250YWluZXIpIHJldHVybjsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGRvdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICBkb3QuY2xhc3NOYW1lID0gYG1hcC1kb3QgJHt0eXBlfWA7CiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKGRvdCk7CiAgICAgICAgICAgIAogICAgICAgICAgICB0aGlzLmRvdHMuc2V0KGVudGl0eSwgZG90KTsKICAgICAgICB9CgogICAgICAgIGluaXQoaG9tZVRlYW0sIGF3YXlUZWFtLCBiYWxsKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5jb250YWluZXIpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5jb250YWluZXIuaW5uZXJIVE1MID0gJyc7IC8vIENsZWFyIGV4aXN0aW5nCiAgICAgICAgICAgIHRoaXMuZG90cy5jbGVhcigpOwoKICAgICAgICAgICAgLy8gUmVnaXN0ZXIgSG9tZSBUZWFtCiAgICAgICAgICAgIGhvbWVUZWFtLnBsYXllcnMuZm9yRWFjaChwID0+IHRoaXMucmVnaXN0ZXIocCwgJ2hvbWUnKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBSZWdpc3RlciBBd2F5IFRlYW0KICAgICAgICAgICAgYXdheVRlYW0ucGxheWVycy5mb3JFYWNoKHAgPT4gdGhpcy5yZWdpc3RlcihwLCAnYXdheScpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFJlZ2lzdGVyIEJhbGwKICAgICAgICAgICAgdGhpcy5yZWdpc3RlcihiYWxsLCAnYmFsbCcpOwogICAgICAgIH0KCiAgICAgICAgdXBkYXRlKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuY29udGFpbmVyKSByZXR1cm47CgogICAgICAgICAgICBjb25zdCBoYWxmVyA9IHRoaXMud2lkdGggLyAyOwogICAgICAgICAgICBjb25zdCBoYWxmSCA9IHRoaXMuaGVpZ2h0IC8gMjsKICAgICAgICAgICAgLy8gU2NhbGU6IE1hcCBSYWRpdXMgKDUwcHgpIC8gV29ybGQgUmFkaXVzICgzMCB1bml0cykKICAgICAgICAgICAgY29uc3Qgc2NhbGUgPSBoYWxmVyAvIHRoaXMud29ybGRSYWRpdXM7IAoKZm9yIChjb25zdCBbZW50aXR5LCBkb3RdIG9mIHRoaXMuZG90cykgewogICAgICAgICAgICAgICAgaWYgKCFlbnRpdHkubWVzaCkgY29udGludWU7CgogICAgICAgICAgICAgICAgLy8gSW52aXNpYmxlIEJhbGwgTG9naWMKICAgICAgICAgICAgICAgIGlmIChlbnRpdHkuaXNJbnZpc2libGUpIHsKICAgICAgICAgICAgICAgICAgICBkb3Quc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZG90LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCFlbnRpdHkubWVzaCkgY29udGludWU7CgogICAgICAgICAgICAgICAgY29uc3QgcG9zID0gZW50aXR5Lm1lc2gucG9zaXRpb247CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIE1hcCBMb2dpYzoKICAgICAgICAgICAgICAgIC8vIFdvcmxkIFogaXMgVXAvRG93bi4gLVogaXMgVG9wIChBdHRhY2sgRGlyZWN0aW9uIGZvciBIb21lKSwgK1ogaXMgQm90dG9tLgogICAgICAgICAgICAgICAgLy8gV29ybGQgWCBpcyBMZWZ0L1JpZ2h0LgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgcmF3IHBvc2l0aW9uIHJlbGF0aXZlIHRvIGNlbnRlcgogICAgICAgICAgICAgICAgbGV0IGR4ID0gcG9zLnggKiBzY2FsZTsKICAgICAgICAgICAgICAgIGxldCBkeSA9IHBvcy56ICogc2NhbGU7CgogICAgICAgICAgICAgICAgLy8gQ2xhbXAgdG8gY2lyY2xlIChrZWVwIGRvdHMgaW5zaWRlIHRoZSBtYXApCiAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gTWF0aC5zcXJ0KGR4KmR4ICsgZHkqZHkpOwogICAgICAgICAgICAgICAgY29uc3QgbWF4RGlzdCA9IGhhbGZXIC0gMjsgLy8gLTIgZm9yIGRvdCByYWRpdXMgcGFkZGluZwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoZGlzdCA+IG1heERpc3QpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBhbmdsZSA9IE1hdGguYXRhbjIoZHksIGR4KTsKICAgICAgICAgICAgICAgICAgICBkeCA9IE1hdGguY29zKGFuZ2xlKSAqIG1heERpc3Q7CiAgICAgICAgICAgICAgICAgICAgZHkgPSBNYXRoLnNpbihhbmdsZSkgKiBtYXhEaXN0OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIENvbnZlcnQgdG8gQ1NTIGNvb3JkaW5hdGVzICgwLDAgaXMgVG9wLUxlZnQpCiAgICAgICAgICAgICAgICAvLyBDZW50ZXIgaXMgKDUwLCA1MCkKICAgICAgICAgICAgICAgIGNvbnN0IGNzc1ggPSBoYWxmVyArIGR4OwogICAgICAgICAgICAgICAgY29uc3QgY3NzWSA9IGhhbGZIICsgZHk7CgogICAgICAgICAgICAgICAgZG90LnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoJHtjc3NYfXB4LCAke2Nzc1l9cHgpYDsKICAgICAgICAgICAgICAgIAovLyBTdGF0dXMgVXBkYXRlcwogICAgICAgICAgICAgICAgaWYgKGVudGl0eS5zdGF0dXMpIHsKICAgICAgICAgICAgICAgICAgICAvLyBOYXAgKFNsZWVwKSB0dXJucyBkb3QgZGFyay9ibGFjawogICAgICAgICAgICAgICAgICAgIGlmIChlbnRpdHkuc3RhdHVzLm5hcCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFkb3QuY2xhc3NMaXN0LmNvbnRhaW5zKCduYXAnKSkgZG90LmNsYXNzTGlzdC5hZGQoJ25hcCcpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkb3QuY2xhc3NMaXN0LmNvbnRhaW5zKCduYXAnKSkgZG90LmNsYXNzTGlzdC5yZW1vdmUoJ25hcCcpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBBY3RpdmUgUGxheWVyIE1hcmtlciAoR3JlZW4pCi8vIEFjdGl2ZSBQbGF5ZXIgTWFya2VyIChHcmVlbikKICAgICAgICAgICAgICAgIGNvbnN0IGdhbWUgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2U7CiAgICAgICAgICAgICAgICBjb25zdCBpc0FjdGl2ZSA9IChnYW1lICYmIGdhbWUudGVhbXMuaG9tZSAmJiBnYW1lLnRlYW1zLmhvbWUuYWN0aXZlUGxheWVyID09PSBlbnRpdHkpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoaXNBY3RpdmUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIWRvdC5jbGFzc0xpc3QuY29udGFpbnMoJ2FjdGl2ZS1wbGF5ZXInKSkgZG90LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZS1wbGF5ZXInKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRvdC5jbGFzc0xpc3QuY29udGFpbnMoJ2FjdGl2ZS1wbGF5ZXInKSkgZG90LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZS1wbGF5ZXInKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBCYWxsIENhcnJpZXIgTWFya2VyIChHbG93KQogICAgICAgICAgICAgICAgaWYgKGVudGl0eS5oYXNCYWxsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFkb3QuY2xhc3NMaXN0LmNvbnRhaW5zKCdiYWxsLWNhcnJpZXInKSkgZG90LmNsYXNzTGlzdC5hZGQoJ2JhbGwtY2FycmllcicpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZG90LmNsYXNzTGlzdC5jb250YWlucygnYmFsbC1jYXJyaWVyJykpIGRvdC5jbGFzc0xpc3QucmVtb3ZlKCdiYWxsLWNhcnJpZXInKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgICAgICAgICAgCgogICAgCgogICAgd2luZG93LmZsdXguTWluaU1hcCA9IE1pbmlNYXA7Cn0pKCk7","/MiniMap.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICBjbGFzcyBNaW5pTWFwIHsKICAgICAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICAgICAgdGhpcy5jb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWluaW1hcCcpOwogICAgICAgICAgICB0aGlzLmRvdHMgPSBuZXcgTWFwKCk7IC8vIE1hcCBlbnRpdHkgdG8gRE9NIGVsZW1lbnQKICAgICAgICAgICAgdGhpcy53aWR0aCA9IDEwMDsgLy8gTWF0Y2hlcyBDU1Mgd2lkdGgKICAgICAgICAgICAgdGhpcy5oZWlnaHQgPSAxMDA7IC8vIE1hdGNoZXMgQ1NTIGhlaWdodAogICAgICAgICAgICB0aGlzLndvcmxkUmFkaXVzID0gMzA7IC8vIEFyZW5hIHJhZGl1cwogICAgICAgIH0KCiAgICAgICAgcmVnaXN0ZXIoZW50aXR5LCB0eXBlKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5jb250YWluZXIpIHJldHVybjsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGRvdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICBkb3QuY2xhc3NOYW1lID0gYG1hcC1kb3QgJHt0eXBlfWA7CiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKGRvdCk7CiAgICAgICAgICAgIAogICAgICAgICAgICB0aGlzLmRvdHMuc2V0KGVudGl0eSwgZG90KTsKICAgICAgICB9CgogICAgICAgIGluaXQoaG9tZVRlYW0sIGF3YXlUZWFtLCBiYWxsKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5jb250YWluZXIpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5jb250YWluZXIuaW5uZXJIVE1MID0gJyc7IC8vIENsZWFyIGV4aXN0aW5nCiAgICAgICAgICAgIHRoaXMuZG90cy5jbGVhcigpOwoKICAgICAgICAgICAgLy8gUmVnaXN0ZXIgSG9tZSBUZWFtCiAgICAgICAgICAgIGhvbWVUZWFtLnBsYXllcnMuZm9yRWFjaChwID0+IHRoaXMucmVnaXN0ZXIocCwgJ2hvbWUnKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBSZWdpc3RlciBBd2F5IFRlYW0KICAgICAgICAgICAgYXdheVRlYW0ucGxheWVycy5mb3JFYWNoKHAgPT4gdGhpcy5yZWdpc3RlcihwLCAnYXdheScpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFJlZ2lzdGVyIEJhbGwKICAgICAgICAgICAgdGhpcy5yZWdpc3RlcihiYWxsLCAnYmFsbCcpOwogICAgICAgIH0KCiAgICAgICAgdXBkYXRlKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuY29udGFpbmVyKSByZXR1cm47CgogICAgICAgICAgICBjb25zdCBoYWxmVyA9IHRoaXMud2lkdGggLyAyOwogICAgICAgICAgICBjb25zdCBoYWxmSCA9IHRoaXMuaGVpZ2h0IC8gMjsKICAgICAgICAgICAgLy8gU2NhbGU6IE1hcCBSYWRpdXMgKDUwcHgpIC8gV29ybGQgUmFkaXVzICgzMCB1bml0cykKICAgICAgICAgICAgY29uc3Qgc2NhbGUgPSBoYWxmVyAvIHRoaXMud29ybGRSYWRpdXM7IAoKZm9yIChjb25zdCBbZW50aXR5LCBkb3RdIG9mIHRoaXMuZG90cykgewogICAgICAgICAgICAgICAgaWYgKCFlbnRpdHkubWVzaCkgY29udGludWU7CgogICAgICAgICAgICAgICAgLy8gSW52aXNpYmxlIEJhbGwgTG9naWMKICAgICAgICAgICAgICAgIGlmIChlbnRpdHkuaXNJbnZpc2libGUpIHsKICAgICAgICAgICAgICAgICAgICBkb3Quc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZG90LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCFlbnRpdHkubWVzaCkgY29udGludWU7CgogICAgICAgICAgICAgICAgY29uc3QgcG9zID0gZW50aXR5Lm1lc2gucG9zaXRpb247CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIE1hcCBMb2dpYzoKICAgICAgICAgICAgICAgIC8vIFdvcmxkIFogaXMgVXAvRG93bi4gLVogaXMgVG9wIChBdHRhY2sgRGlyZWN0aW9uIGZvciBIb21lKSwgK1ogaXMgQm90dG9tLgogICAgICAgICAgICAgICAgLy8gV29ybGQgWCBpcyBMZWZ0L1JpZ2h0LgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgcmF3IHBvc2l0aW9uIHJlbGF0aXZlIHRvIGNlbnRlcgogICAgICAgICAgICAgICAgbGV0IGR4ID0gcG9zLnggKiBzY2FsZTsKICAgICAgICAgICAgICAgIGxldCBkeSA9IHBvcy56ICogc2NhbGU7CgogICAgICAgICAgICAgICAgLy8gQ2xhbXAgdG8gY2lyY2xlIChrZWVwIGRvdHMgaW5zaWRlIHRoZSBtYXApCiAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gTWF0aC5zcXJ0KGR4KmR4ICsgZHkqZHkpOwogICAgICAgICAgICAgICAgY29uc3QgbWF4RGlzdCA9IGhhbGZXIC0gMjsgLy8gLTIgZm9yIGRvdCByYWRpdXMgcGFkZGluZwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoZGlzdCA+IG1heERpc3QpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBhbmdsZSA9IE1hdGguYXRhbjIoZHksIGR4KTsKICAgICAgICAgICAgICAgICAgICBkeCA9IE1hdGguY29zKGFuZ2xlKSAqIG1heERpc3Q7CiAgICAgICAgICAgICAgICAgICAgZHkgPSBNYXRoLnNpbihhbmdsZSkgKiBtYXhEaXN0OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIENvbnZlcnQgdG8gQ1NTIGNvb3JkaW5hdGVzICgwLDAgaXMgVG9wLUxlZnQpCiAgICAgICAgICAgICAgICAvLyBDZW50ZXIgaXMgKDUwLCA1MCkKICAgICAgICAgICAgICAgIGNvbnN0IGNzc1ggPSBoYWxmVyArIGR4OwogICAgICAgICAgICAgICAgY29uc3QgY3NzWSA9IGhhbGZIICsgZHk7CgogICAgICAgICAgICAgICAgZG90LnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoJHtjc3NYfXB4LCAke2Nzc1l9cHgpYDsKICAgICAgICAgICAgICAgIAovLyBTdGF0dXMgVXBkYXRlcwogICAgICAgICAgICAgICAgaWYgKGVudGl0eS5zdGF0dXMpIHsKICAgICAgICAgICAgICAgICAgICAvLyBOYXAgKFNsZWVwKSB0dXJucyBkb3QgZGFyay9ibGFjawogICAgICAgICAgICAgICAgICAgIGlmIChlbnRpdHkuc3RhdHVzLm5hcCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFkb3QuY2xhc3NMaXN0LmNvbnRhaW5zKCduYXAnKSkgZG90LmNsYXNzTGlzdC5hZGQoJ25hcCcpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkb3QuY2xhc3NMaXN0LmNvbnRhaW5zKCduYXAnKSkgZG90LmNsYXNzTGlzdC5yZW1vdmUoJ25hcCcpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBBY3RpdmUgUGxheWVyIE1hcmtlciAoR3JlZW4pCi8vIEFjdGl2ZSBQbGF5ZXIgTWFya2VyIChHcmVlbikKICAgICAgICAgICAgICAgIGNvbnN0IGdhbWUgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2U7CiAgICAgICAgICAgICAgICBjb25zdCBpc0FjdGl2ZSA9IChnYW1lICYmIGdhbWUudGVhbXMuaG9tZSAmJiBnYW1lLnRlYW1zLmhvbWUuYWN0aXZlUGxheWVyID09PSBlbnRpdHkpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoaXNBY3RpdmUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIWRvdC5jbGFzc0xpc3QuY29udGFpbnMoJ2FjdGl2ZS1wbGF5ZXInKSkgZG90LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZS1wbGF5ZXInKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRvdC5jbGFzc0xpc3QuY29udGFpbnMoJ2FjdGl2ZS1wbGF5ZXInKSkgZG90LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZS1wbGF5ZXInKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBCYWxsIENhcnJpZXIgTWFya2VyIChHbG93KQogICAgICAgICAgICAgICAgaWYgKGVudGl0eS5oYXNCYWxsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFkb3QuY2xhc3NMaXN0LmNvbnRhaW5zKCdiYWxsLWNhcnJpZXInKSkgZG90LmNsYXNzTGlzdC5hZGQoJ2JhbGwtY2FycmllcicpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZG90LmNsYXNzTGlzdC5jb250YWlucygnYmFsbC1jYXJyaWVyJykpIGRvdC5jbGFzc0xpc3QucmVtb3ZlKCdiYWxsLWNhcnJpZXInKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgICAgICAgICAgCgogICAgCgogICAgd2luZG93LmZsdXguTWluaU1hcCA9IE1pbmlNYXA7Cn0pKCk7","FloatingTextManager.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICBjbGFzcyBGbG9hdGluZ1RleHRNYW5hZ2VyIHsKICAgICAgICBjb25zdHJ1Y3RvcihzY2VuZSwgY29udGFpbmVySWQsIGNhbWVyYSkgewogICAgICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7CiAgICAgICAgICAgIHRoaXMuY2FtZXJhID0gY2FtZXJhOwogICAgICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNvbnRhaW5lcklkKTsKICAgICAgICAgICAgdGhpcy50ZXh0cyA9IFtdOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gUmV1c2FibGUgdmVjdG9yIGZvciBwcm9qZWN0aW9uCiAgICAgICAgICAgIHRoaXMuX3RlbXBWID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgICAgICB9CgpzcGF3bih0ZXh0LCB3b3JsZFBvcywgdHlwZSA9ICdkZWZhdWx0JywgdGFyZ2V0ID0gbnVsbCkgewogICAgICAgICAgICBpZiAoIXRoaXMuY29udGFpbmVyIHx8ICF0aGlzLmNhbWVyYSkgcmV0dXJuOwoKICAgICAgICAgICAgLy8gQ3JlYXRlIFdyYXBwZXIgKFBvc2l0aW9uaW5nKQogICAgICAgICAgICBjb25zdCB3cmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIHdyYXBwZXIuY2xhc3NOYW1lID0gJ2Zsb2F0aW5nLXRleHQtd3JhcHBlcic7CgogICAgICAgICAgICAvLyBDcmVhdGUgSW5uZXIgKEFuaW1hdGlvbi9TdHlsaW5nKQogICAgICAgICAgICBjb25zdCBpbm5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgICAgICAgICAgaW5uZXIuaW5uZXJUZXh0ID0gdGV4dDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFNtYXJ0IENsYXNzIEFzc2lnbm1lbnQKICAgICAgICAgICAgbGV0IGNsYXNzZXMgPSBbJ2Zsb2F0aW5nLXRleHQtaW5uZXInXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEFkZCBiYXNlIHR5cGUKICAgICAgICAgICAgY2xhc3Nlcy5wdXNoKHR5cGUpOwoKICAgICAgICAgICAgLy8gS2V5d29yZCBEZXRlY3Rpb24gZm9yIEF1dG8tU3R5bGluZwogICAgICAgICAgICBjb25zdCB1cHBlciA9IHRleHQudG9TdHJpbmcoKS50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgICAKaWYgKHVwcGVyLmluY2x1ZGVzKCdQT0lTT04nKSB8fCB1cHBlci5pbmNsdWRlcygnVkVOT00nKSkgY2xhc3Nlcy5wdXNoKCd2ZW5vbScpOwogICAgICAgICAgICBlbHNlIGlmICh1cHBlci5pbmNsdWRlcygnU0xFRVAnKSB8fCB1cHBlci5pbmNsdWRlcygnTkFQJykgfHwgdXBwZXIuaW5jbHVkZXMoJ1paWicpKSBjbGFzc2VzLnB1c2goJ3NsZWVwJyk7CiAgICAgICAgICAgIGVsc2UgaWYgKHVwcGVyLmluY2x1ZGVzKCdXSVRIRVInKSkgY2xhc3Nlcy5wdXNoKCd3aXRoZXInKTsKICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ3RlY2gnIHx8IHVwcGVyLmluY2x1ZGVzKCdTSE9UJykgfHwgdXBwZXIuaW5jbHVkZXMoJ0pFQ0hUJykgfHwgdXBwZXIuaW5jbHVkZXMoJ1RBQ0tMRScpKSBjbGFzc2VzLnB1c2goJ3RlY2gnKTsKICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ2NvbWljLWltcGFjdCcpIGNsYXNzZXMucHVzaCgnY29taWMtaW1wYWN0Jyk7CiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT09ICdjb21pYy1hY3Rpb24nKSBjbGFzc2VzLnB1c2goJ2NvbWljLWFjdGlvbicpOwogICAgICAgICAgICBlbHNlIGlmICghaXNOYU4ocGFyc2VJbnQodGV4dCkpICYmIHR5cGUgIT09ICdzY29yZScpIGNsYXNzZXMucHVzaCgnZGFtYWdlJyk7IC8vIE51bWVyaWMgaXMgdXN1YWxseSBkYW1hZ2UKICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ3NhdmUnIHx8IHR5cGUgPT09ICdibG9jaycpIGNsYXNzZXMucHVzaCgnc2F2ZScpOwoKICAgICAgICAgICAgaW5uZXIuY2xhc3NOYW1lID0gY2xhc3Nlcy5qb2luKCcgJyk7CiAgICAgICAgICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQoaW5uZXIpOwogICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmRDaGlsZCh3cmFwcGVyKTsKCiAgICAgICAgICAgIC8vIFBoeXNpY3MgSW5zdGFuY2UKICAgICAgICAgICAgY29uc3QgaW5zdGFuY2UgPSB7CiAgICAgICAgICAgICAgICBlbDogd3JhcHBlciwgCiAgICAgICAgICAgICAgICB3b3JsZFBvczogd29ybGRQb3MuY2xvbmUoKSwKICAgICAgICAgICAgICAgIG9mZnNldDogbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMCksCiAgICAgICAgICAgICAgICB2ZWxvY2l0eTogbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMCksCiAgICAgICAgICAgICAgICBncmF2aXR5OiAwLAogICAgICAgICAgICAgICAgZHJhZzogMCwKICAgICAgICAgICAgICAgIGVsYXN0aWNpdHk6IDAuNiwKICAgICAgICAgICAgICAgIGZsb29yWTogLTk5OSwgLy8gVmlydHVhbCBmbG9vciByZWxhdGl2ZSB0byBzdGFydAogICAgICAgICAgICAgICAgCmxpZmU6IDEuMCwgIC8vIFJlZHVjZWQgZnJvbSAxLjUKICAgICAgICAgICAgICAgIG1heExpZmU6IDEuMCwKICAgICAgICAgICAgICAgIHRhcmdldDogdGFyZ2V0CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBDdXN0b21pemUgUGh5c2ljcyBiYXNlZCBvbiBUeXBlCmlmIChjbGFzc2VzLmluY2x1ZGVzKCdkYW1hZ2UnKSB8fCBjbGFzc2VzLmluY2x1ZGVzKCdzYXZlJykgfHwgY2xhc3Nlcy5pbmNsdWRlcygnYmxvY2snKSkgewogICAgICAgICAgICAgICAgLy8gREVCUklTIFBIWVNJQ1MgKFBvcCwgQXJjLCBCb3VuY2UpCiAgICAgICAgICAgICAgICBpbnN0YW5jZS50YXJnZXQgPSBudWxsOyAvLyBEZXRhY2ggZnJvbSBlbnRpdHkgc28gaXQgZmFsbHMgbmF0dXJhbGx5CiAgICAgICAgICAgICAgICBpbnN0YW5jZS5ncmF2aXR5ID0gNDAuMDsgLy8gSGVhdnkgZ3Jhdml0eSBmb3Igc25hcHB5IGZlZWwKICAgICAgICAgICAgICAgIGluc3RhbmNlLmRyYWcgPSAwLjU7CiAgICAgICAgICAgICAgICBpbnN0YW5jZS5mbG9vclkgPSAtNC4wOyAvLyBCb3VuY2Ugb2ZmIGEgdmlydHVhbCBmbG9vciBiZWxvdyBpbXBhY3QKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRXhwbG9zaXZlIEJ1cnN0CiAgICAgICAgICAgICAgICBjb25zdCBzcHJlYWQgPSA2LjA7CiAgICAgICAgICAgICAgICBpbnN0YW5jZS52ZWxvY2l0eS5zZXQoCiAgICAgICAgICAgICAgICAgICAgKE1hdGgucmFuZG9tKCkgLSAwLjUpICogc3ByZWFkLAogICAgICAgICAgICAgICAgICAgIDE1LjAgKyBNYXRoLnJhbmRvbSgpICogNS4wLCAvLyBIaWdoIGluaXRpYWwgcG9wCiAgICAgICAgICAgICAgICAgICAgKE1hdGgucmFuZG9tKCkgLSAwLjUpICogc3ByZWFkCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpbnN0YW5jZS5saWZlID0gMi4wOwogICAgICAgICAgICAgICAgaW5zdGFuY2UubWF4TGlmZSA9IDIuMDsKCiAgICAgICAgICAgIH0gZWxzZSBpZiAoY2xhc3Nlcy5pbmNsdWRlcygnY29taWMtaW1wYWN0JykpIHsKICAgICAgICAgICAgICAgIC8vIENPTUlDIFBPUCAoU3RheSBpbiBwbGFjZSBtb3N0bHksIHNsaWdodCBkcmlmdCkKICAgICAgICAgICAgICAgIGluc3RhbmNlLmdyYXZpdHkgPSAwOwogICAgICAgICAgICAgICAgaW5zdGFuY2UudmVsb2NpdHkuc2V0KChNYXRoLnJhbmRvbSgpLTAuNSkqMiwgMS4wLCAoTWF0aC5yYW5kb20oKS0wLjUpKjIpOwppbnN0YW5jZS5saWZlID0gMC41OyAvLyBSZWR1Y2VkIGZyb20gMC44CiAgICAgICAgICAgICAgICBpbnN0YW5jZS5tYXhMaWZlID0gMC41OwoKICAgICAgICAgICAgfSBlbHNlIGlmIChjbGFzc2VzLmluY2x1ZGVzKCdjb21pYy1hY3Rpb24nKSkgewogICAgICAgICAgICAgICAgLy8gQ09NSUMgWklQIChGYXN0IG1vdmVtZW50KQogICAgICAgICAgICAgICAgaW5zdGFuY2UuZ3Jhdml0eSA9IDA7CiAgICAgICAgICAgICAgICBpbnN0YW5jZS52ZWxvY2l0eS5zZXQoMCwgMi4wLCAwKTsKaW5zdGFuY2UubGlmZSA9IDAuNDsgLy8gUmVkdWNlZCBmcm9tIDAuNgogICAgICAgICAgICAgICAgaW5zdGFuY2UubWF4TGlmZSA9IDAuNDsKCiAgICAgICAgICAgIH0gZWxzZSBpZiAoY2xhc3Nlcy5pbmNsdWRlcygndGVjaCcpKSB7CiAgICAgICAgICAgICAgICAvLyBURUNIIEZMT0FUIChTbG93IHJpc2UpCiAgICAgICAgICAgICAgICBpbnN0YW5jZS5ncmF2aXR5ID0gMDsKICAgICAgICAgICAgICAgIGluc3RhbmNlLnZlbG9jaXR5LnNldCgwLCAyLjAsIDApOyAvLyBTdGVhZHkgcmlzZQogICAgICAgICAgICAgICAgaW5zdGFuY2UubGlmZSA9IDIuNTsKICAgICAgICAgICAgICAgIGluc3RhbmNlLm1heExpZmUgPSAyLjU7CiAgICAgICAgICAgICAgICBpbnN0YW5jZS5vZmZzZXQueSA9IDIuMDsgLy8gU3RhcnQgaGlnaGVyCgogICAgICAgICAgICB9IGVsc2UgaWYgKGNsYXNzZXMuaW5jbHVkZXMoJ3NsZWVwJykpIHsKICAgICAgICAgICAgICAgIC8vIFNMRUVQIERSSUZUIChTbG93IG1lYW5kZXJpbmcpCiAgICAgICAgICAgICAgICBpbnN0YW5jZS5ncmF2aXR5ID0gLTAuNTsgLy8gU2xpZ2h0IGFudGktZ3Jhdml0eQogICAgICAgICAgICAgICAgaW5zdGFuY2UudmVsb2NpdHkuc2V0KDAsIDAuNSwgMCk7CiAgICAgICAgICAgICAgICBpbnN0YW5jZS5saWZlID0gMy4wOwogICAgICAgICAgICAgICAgaW5zdGFuY2UubWF4TGlmZSA9IDMuMDsKCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBERUZBVUxUIChTdGF0dXMsIGV0YykKICAgICAgICAgICAgICAgIGluc3RhbmNlLnZlbG9jaXR5LnNldCgwLCAzLjAsIDApOwogICAgICAgICAgICAgICAgaW5zdGFuY2UuZ3Jhdml0eSA9IDUuMDsgLy8gU2xpZ2h0IGFyYwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBSYW5kb21pemUgc3RhcnQgcG9zIHNsaWdodGx5IHRvIHByZXZlbnQgc3RhY2tpbmcKICAgICAgICAgICAgaWYgKCF0YXJnZXQpIHsKICAgICAgICAgICAgICAgIGluc3RhbmNlLndvcmxkUG9zLnggKz0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogMC41OwogICAgICAgICAgICAgICAgaW5zdGFuY2Uud29ybGRQb3MueiArPSAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiAwLjU7CiAgICAgICAgICAgIH0KaW5zdGFuY2Uud29ybGRQb3MueSArPSAxLjA7CiAgICAgICAgICAgIHRoaXMudGV4dHMucHVzaChpbnN0YW5jZSk7CiAgICAgICAgICAgIHRoaXMudXBkYXRlUG9zaXRpb24oaW5zdGFuY2UpOwogICAgICAgIH0KCi8vIHNwYXduVmVyc3VzIHJlbW92ZWQKCiAgICAgICAgdXBkYXRlKGR0KSB7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSB0aGlzLnRleHRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0ID0gdGhpcy50ZXh0c1tpXTsKICAgICAgICAgICAgICAgIHQubGlmZSAtPSBkdDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gSWYgYXR0YWNoZWQgdG8gYSB0YXJnZXQsIHVwZGF0ZSBiYXNlIHBvc2l0aW9uIChvbmx5IGZvciBub24tZGVicmlzKQogICAgICAgICAgICAgICAgaWYgKHQudGFyZ2V0ICYmIHQudGFyZ2V0LnBhcmVudCkgeyAKICAgICAgICAgICAgICAgICAgICB0LndvcmxkUG9zLmNvcHkodC50YXJnZXQucG9zaXRpb24pOwogICAgICAgICAgICAgICAgICAgIHQud29ybGRQb3MueSArPSAxLjA7IAogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIFBoeXNpY3MgSW50ZWdyYXRpb24KICAgICAgICAgICAgICAgIGlmICh0LmdyYXZpdHkgIT09IDAgfHwgdC52ZWxvY2l0eS5sZW5ndGhTcSgpID4gMCkgewogICAgICAgICAgICAgICAgICAgIC8vIEdyYXZpdHkKICAgICAgICAgICAgICAgICAgICB0LnZlbG9jaXR5LnkgLT0gdC5ncmF2aXR5ICogZHQ7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gRHJhZyAoQWlyIHJlc2lzdGFuY2UpCiAgICAgICAgICAgICAgICAgICAgaWYgKHQuZHJhZyA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdC52ZWxvY2l0eS5tdWx0aXBseVNjYWxhcihNYXRoLm1heCgwLCAxLjAgLSAodC5kcmFnICogZHQpKSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBNb3ZlCiAgICAgICAgICAgICAgICAgICAgdC5vZmZzZXQuYWRkU2NhbGVkVmVjdG9yKHQudmVsb2NpdHksIGR0KTsKCiAgICAgICAgICAgICAgICAgICAgLy8gQm91bmNlIExvZ2ljCiAgICAgICAgICAgICAgICAgICAgaWYgKHQub2Zmc2V0LnkgPCB0LmZsb29yWSkgewogICAgICAgICAgICAgICAgICAgICAgICB0Lm9mZnNldC55ID0gdC5mbG9vclk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJvdW5jZSB2ZWxvY2l0eQogICAgICAgICAgICAgICAgICAgICAgICB0LnZlbG9jaXR5LnkgKj0gLXQuZWxhc3RpY2l0eTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gR3JvdW5kIGZyaWN0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIHQudmVsb2NpdHkueCAqPSAwLjc7CiAgICAgICAgICAgICAgICAgICAgICAgIHQudmVsb2NpdHkueiAqPSAwLjc7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAvLyBTdG9wIGJvdW5jaW5nIGlmIGVuZXJneSBpcyBsb3cKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKHQudmVsb2NpdHkueSkgPCAyLjApIHQudmVsb2NpdHkueSA9IDA7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0LmxpZmUgPD0gMCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0LmVsLnBhcmVudE5vZGUpIHQuZWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0LmVsKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRleHRzLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVQb3NpdGlvbih0KTsKICAgICAgICAgICAgICAgICAgICAvLyBGYWRlIG91dCBpbiBsYXN0IDMwJQogICAgICAgICAgICAgICAgICAgIGlmICh0LmxpZmUgPCB0Lm1heExpZmUgKiAwLjMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdC5lbC5zdHlsZS5vcGFjaXR5ID0gdC5saWZlIC8gKHQubWF4TGlmZSAqIDAuMyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB1cGRhdGVQb3NpdGlvbih0KSB7CiAgICAgICAgICAgIC8vIFByb2plY3Qgd29ybGQgcG9zICsgb2Zmc2V0IHRvIHNjcmVlbgogICAgICAgICAgICB0aGlzLl90ZW1wVi5jb3B5KHQud29ybGRQb3MpLmFkZCh0Lm9mZnNldCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTdGFuZGFyZCBUaHJlZS5qcyBwcm9qZWN0aW9uCiAgICAgICAgICAgIHRoaXMuX3RlbXBWLnByb2plY3QodGhpcy5jYW1lcmEpOwoKICAgICAgICAgICAgY29uc3QgeCA9ICh0aGlzLl90ZW1wVi54ICogLjUgKyAuNSkgKiB0aGlzLmNvbnRhaW5lci5jbGllbnRXaWR0aDsKICAgICAgICAgICAgY29uc3QgeSA9ICgtKHRoaXMuX3RlbXBWLnkgKiAuNSkgKyAuNSkgKiB0aGlzLmNvbnRhaW5lci5jbGllbnRIZWlnaHQ7CgogICAgICAgICAgICAvLyBIaWRlIGlmIGJlaGluZCBjYW1lcmEKICAgICAgICAgICAgaWYgKHRoaXMuX3RlbXBWLnogPiAxKSB7CiAgICAgICAgICAgICAgICB0LmVsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0LmVsLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICAgICAgdC5lbC5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKCR7eH1weCwgJHt5fXB4KWA7CiAgICAgICAgICAgIH0KfQogICAgfQoKICAgIHdpbmRvdy5mbHV4LkZsb2F0aW5nVGV4dE1hbmFnZXIgPSBGbG9hdGluZ1RleHRNYW5hZ2VyOwp9KSgpOw==","./FloatingTextManager.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICBjbGFzcyBGbG9hdGluZ1RleHRNYW5hZ2VyIHsKICAgICAgICBjb25zdHJ1Y3RvcihzY2VuZSwgY29udGFpbmVySWQsIGNhbWVyYSkgewogICAgICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7CiAgICAgICAgICAgIHRoaXMuY2FtZXJhID0gY2FtZXJhOwogICAgICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNvbnRhaW5lcklkKTsKICAgICAgICAgICAgdGhpcy50ZXh0cyA9IFtdOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gUmV1c2FibGUgdmVjdG9yIGZvciBwcm9qZWN0aW9uCiAgICAgICAgICAgIHRoaXMuX3RlbXBWID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgICAgICB9CgpzcGF3bih0ZXh0LCB3b3JsZFBvcywgdHlwZSA9ICdkZWZhdWx0JywgdGFyZ2V0ID0gbnVsbCkgewogICAgICAgICAgICBpZiAoIXRoaXMuY29udGFpbmVyIHx8ICF0aGlzLmNhbWVyYSkgcmV0dXJuOwoKICAgICAgICAgICAgLy8gQ3JlYXRlIFdyYXBwZXIgKFBvc2l0aW9uaW5nKQogICAgICAgICAgICBjb25zdCB3cmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIHdyYXBwZXIuY2xhc3NOYW1lID0gJ2Zsb2F0aW5nLXRleHQtd3JhcHBlcic7CgogICAgICAgICAgICAvLyBDcmVhdGUgSW5uZXIgKEFuaW1hdGlvbi9TdHlsaW5nKQogICAgICAgICAgICBjb25zdCBpbm5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgICAgICAgICAgaW5uZXIuaW5uZXJUZXh0ID0gdGV4dDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFNtYXJ0IENsYXNzIEFzc2lnbm1lbnQKICAgICAgICAgICAgbGV0IGNsYXNzZXMgPSBbJ2Zsb2F0aW5nLXRleHQtaW5uZXInXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEFkZCBiYXNlIHR5cGUKICAgICAgICAgICAgY2xhc3Nlcy5wdXNoKHR5cGUpOwoKICAgICAgICAgICAgLy8gS2V5d29yZCBEZXRlY3Rpb24gZm9yIEF1dG8tU3R5bGluZwogICAgICAgICAgICBjb25zdCB1cHBlciA9IHRleHQudG9TdHJpbmcoKS50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgICAKaWYgKHVwcGVyLmluY2x1ZGVzKCdQT0lTT04nKSB8fCB1cHBlci5pbmNsdWRlcygnVkVOT00nKSkgY2xhc3Nlcy5wdXNoKCd2ZW5vbScpOwogICAgICAgICAgICBlbHNlIGlmICh1cHBlci5pbmNsdWRlcygnU0xFRVAnKSB8fCB1cHBlci5pbmNsdWRlcygnTkFQJykgfHwgdXBwZXIuaW5jbHVkZXMoJ1paWicpKSBjbGFzc2VzLnB1c2goJ3NsZWVwJyk7CiAgICAgICAgICAgIGVsc2UgaWYgKHVwcGVyLmluY2x1ZGVzKCdXSVRIRVInKSkgY2xhc3Nlcy5wdXNoKCd3aXRoZXInKTsKICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ3RlY2gnIHx8IHVwcGVyLmluY2x1ZGVzKCdTSE9UJykgfHwgdXBwZXIuaW5jbHVkZXMoJ0pFQ0hUJykgfHwgdXBwZXIuaW5jbHVkZXMoJ1RBQ0tMRScpKSBjbGFzc2VzLnB1c2goJ3RlY2gnKTsKICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ2NvbWljLWltcGFjdCcpIGNsYXNzZXMucHVzaCgnY29taWMtaW1wYWN0Jyk7CiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT09ICdjb21pYy1hY3Rpb24nKSBjbGFzc2VzLnB1c2goJ2NvbWljLWFjdGlvbicpOwogICAgICAgICAgICBlbHNlIGlmICghaXNOYU4ocGFyc2VJbnQodGV4dCkpICYmIHR5cGUgIT09ICdzY29yZScpIGNsYXNzZXMucHVzaCgnZGFtYWdlJyk7IC8vIE51bWVyaWMgaXMgdXN1YWxseSBkYW1hZ2UKICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ3NhdmUnIHx8IHR5cGUgPT09ICdibG9jaycpIGNsYXNzZXMucHVzaCgnc2F2ZScpOwoKICAgICAgICAgICAgaW5uZXIuY2xhc3NOYW1lID0gY2xhc3Nlcy5qb2luKCcgJyk7CiAgICAgICAgICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQoaW5uZXIpOwogICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmRDaGlsZCh3cmFwcGVyKTsKCiAgICAgICAgICAgIC8vIFBoeXNpY3MgSW5zdGFuY2UKICAgICAgICAgICAgY29uc3QgaW5zdGFuY2UgPSB7CiAgICAgICAgICAgICAgICBlbDogd3JhcHBlciwgCiAgICAgICAgICAgICAgICB3b3JsZFBvczogd29ybGRQb3MuY2xvbmUoKSwKICAgICAgICAgICAgICAgIG9mZnNldDogbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMCksCiAgICAgICAgICAgICAgICB2ZWxvY2l0eTogbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMCksCiAgICAgICAgICAgICAgICBncmF2aXR5OiAwLAogICAgICAgICAgICAgICAgZHJhZzogMCwKICAgICAgICAgICAgICAgIGVsYXN0aWNpdHk6IDAuNiwKICAgICAgICAgICAgICAgIGZsb29yWTogLTk5OSwgLy8gVmlydHVhbCBmbG9vciByZWxhdGl2ZSB0byBzdGFydAogICAgICAgICAgICAgICAgCmxpZmU6IDEuMCwgIC8vIFJlZHVjZWQgZnJvbSAxLjUKICAgICAgICAgICAgICAgIG1heExpZmU6IDEuMCwKICAgICAgICAgICAgICAgIHRhcmdldDogdGFyZ2V0CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBDdXN0b21pemUgUGh5c2ljcyBiYXNlZCBvbiBUeXBlCmlmIChjbGFzc2VzLmluY2x1ZGVzKCdkYW1hZ2UnKSB8fCBjbGFzc2VzLmluY2x1ZGVzKCdzYXZlJykgfHwgY2xhc3Nlcy5pbmNsdWRlcygnYmxvY2snKSkgewogICAgICAgICAgICAgICAgLy8gREVCUklTIFBIWVNJQ1MgKFBvcCwgQXJjLCBCb3VuY2UpCiAgICAgICAgICAgICAgICBpbnN0YW5jZS50YXJnZXQgPSBudWxsOyAvLyBEZXRhY2ggZnJvbSBlbnRpdHkgc28gaXQgZmFsbHMgbmF0dXJhbGx5CiAgICAgICAgICAgICAgICBpbnN0YW5jZS5ncmF2aXR5ID0gNDAuMDsgLy8gSGVhdnkgZ3Jhdml0eSBmb3Igc25hcHB5IGZlZWwKICAgICAgICAgICAgICAgIGluc3RhbmNlLmRyYWcgPSAwLjU7CiAgICAgICAgICAgICAgICBpbnN0YW5jZS5mbG9vclkgPSAtNC4wOyAvLyBCb3VuY2Ugb2ZmIGEgdmlydHVhbCBmbG9vciBiZWxvdyBpbXBhY3QKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRXhwbG9zaXZlIEJ1cnN0CiAgICAgICAgICAgICAgICBjb25zdCBzcHJlYWQgPSA2LjA7CiAgICAgICAgICAgICAgICBpbnN0YW5jZS52ZWxvY2l0eS5zZXQoCiAgICAgICAgICAgICAgICAgICAgKE1hdGgucmFuZG9tKCkgLSAwLjUpICogc3ByZWFkLAogICAgICAgICAgICAgICAgICAgIDE1LjAgKyBNYXRoLnJhbmRvbSgpICogNS4wLCAvLyBIaWdoIGluaXRpYWwgcG9wCiAgICAgICAgICAgICAgICAgICAgKE1hdGgucmFuZG9tKCkgLSAwLjUpICogc3ByZWFkCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpbnN0YW5jZS5saWZlID0gMi4wOwogICAgICAgICAgICAgICAgaW5zdGFuY2UubWF4TGlmZSA9IDIuMDsKCiAgICAgICAgICAgIH0gZWxzZSBpZiAoY2xhc3Nlcy5pbmNsdWRlcygnY29taWMtaW1wYWN0JykpIHsKICAgICAgICAgICAgICAgIC8vIENPTUlDIFBPUCAoU3RheSBpbiBwbGFjZSBtb3N0bHksIHNsaWdodCBkcmlmdCkKICAgICAgICAgICAgICAgIGluc3RhbmNlLmdyYXZpdHkgPSAwOwogICAgICAgICAgICAgICAgaW5zdGFuY2UudmVsb2NpdHkuc2V0KChNYXRoLnJhbmRvbSgpLTAuNSkqMiwgMS4wLCAoTWF0aC5yYW5kb20oKS0wLjUpKjIpOwppbnN0YW5jZS5saWZlID0gMC41OyAvLyBSZWR1Y2VkIGZyb20gMC44CiAgICAgICAgICAgICAgICBpbnN0YW5jZS5tYXhMaWZlID0gMC41OwoKICAgICAgICAgICAgfSBlbHNlIGlmIChjbGFzc2VzLmluY2x1ZGVzKCdjb21pYy1hY3Rpb24nKSkgewogICAgICAgICAgICAgICAgLy8gQ09NSUMgWklQIChGYXN0IG1vdmVtZW50KQogICAgICAgICAgICAgICAgaW5zdGFuY2UuZ3Jhdml0eSA9IDA7CiAgICAgICAgICAgICAgICBpbnN0YW5jZS52ZWxvY2l0eS5zZXQoMCwgMi4wLCAwKTsKaW5zdGFuY2UubGlmZSA9IDAuNDsgLy8gUmVkdWNlZCBmcm9tIDAuNgogICAgICAgICAgICAgICAgaW5zdGFuY2UubWF4TGlmZSA9IDAuNDsKCiAgICAgICAgICAgIH0gZWxzZSBpZiAoY2xhc3Nlcy5pbmNsdWRlcygndGVjaCcpKSB7CiAgICAgICAgICAgICAgICAvLyBURUNIIEZMT0FUIChTbG93IHJpc2UpCiAgICAgICAgICAgICAgICBpbnN0YW5jZS5ncmF2aXR5ID0gMDsKICAgICAgICAgICAgICAgIGluc3RhbmNlLnZlbG9jaXR5LnNldCgwLCAyLjAsIDApOyAvLyBTdGVhZHkgcmlzZQogICAgICAgICAgICAgICAgaW5zdGFuY2UubGlmZSA9IDIuNTsKICAgICAgICAgICAgICAgIGluc3RhbmNlLm1heExpZmUgPSAyLjU7CiAgICAgICAgICAgICAgICBpbnN0YW5jZS5vZmZzZXQueSA9IDIuMDsgLy8gU3RhcnQgaGlnaGVyCgogICAgICAgICAgICB9IGVsc2UgaWYgKGNsYXNzZXMuaW5jbHVkZXMoJ3NsZWVwJykpIHsKICAgICAgICAgICAgICAgIC8vIFNMRUVQIERSSUZUIChTbG93IG1lYW5kZXJpbmcpCiAgICAgICAgICAgICAgICBpbnN0YW5jZS5ncmF2aXR5ID0gLTAuNTsgLy8gU2xpZ2h0IGFudGktZ3Jhdml0eQogICAgICAgICAgICAgICAgaW5zdGFuY2UudmVsb2NpdHkuc2V0KDAsIDAuNSwgMCk7CiAgICAgICAgICAgICAgICBpbnN0YW5jZS5saWZlID0gMy4wOwogICAgICAgICAgICAgICAgaW5zdGFuY2UubWF4TGlmZSA9IDMuMDsKCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBERUZBVUxUIChTdGF0dXMsIGV0YykKICAgICAgICAgICAgICAgIGluc3RhbmNlLnZlbG9jaXR5LnNldCgwLCAzLjAsIDApOwogICAgICAgICAgICAgICAgaW5zdGFuY2UuZ3Jhdml0eSA9IDUuMDsgLy8gU2xpZ2h0IGFyYwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBSYW5kb21pemUgc3RhcnQgcG9zIHNsaWdodGx5IHRvIHByZXZlbnQgc3RhY2tpbmcKICAgICAgICAgICAgaWYgKCF0YXJnZXQpIHsKICAgICAgICAgICAgICAgIGluc3RhbmNlLndvcmxkUG9zLnggKz0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogMC41OwogICAgICAgICAgICAgICAgaW5zdGFuY2Uud29ybGRQb3MueiArPSAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiAwLjU7CiAgICAgICAgICAgIH0KaW5zdGFuY2Uud29ybGRQb3MueSArPSAxLjA7CiAgICAgICAgICAgIHRoaXMudGV4dHMucHVzaChpbnN0YW5jZSk7CiAgICAgICAgICAgIHRoaXMudXBkYXRlUG9zaXRpb24oaW5zdGFuY2UpOwogICAgICAgIH0KCi8vIHNwYXduVmVyc3VzIHJlbW92ZWQKCiAgICAgICAgdXBkYXRlKGR0KSB7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSB0aGlzLnRleHRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0ID0gdGhpcy50ZXh0c1tpXTsKICAgICAgICAgICAgICAgIHQubGlmZSAtPSBkdDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gSWYgYXR0YWNoZWQgdG8gYSB0YXJnZXQsIHVwZGF0ZSBiYXNlIHBvc2l0aW9uIChvbmx5IGZvciBub24tZGVicmlzKQogICAgICAgICAgICAgICAgaWYgKHQudGFyZ2V0ICYmIHQudGFyZ2V0LnBhcmVudCkgeyAKICAgICAgICAgICAgICAgICAgICB0LndvcmxkUG9zLmNvcHkodC50YXJnZXQucG9zaXRpb24pOwogICAgICAgICAgICAgICAgICAgIHQud29ybGRQb3MueSArPSAxLjA7IAogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIFBoeXNpY3MgSW50ZWdyYXRpb24KICAgICAgICAgICAgICAgIGlmICh0LmdyYXZpdHkgIT09IDAgfHwgdC52ZWxvY2l0eS5sZW5ndGhTcSgpID4gMCkgewogICAgICAgICAgICAgICAgICAgIC8vIEdyYXZpdHkKICAgICAgICAgICAgICAgICAgICB0LnZlbG9jaXR5LnkgLT0gdC5ncmF2aXR5ICogZHQ7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gRHJhZyAoQWlyIHJlc2lzdGFuY2UpCiAgICAgICAgICAgICAgICAgICAgaWYgKHQuZHJhZyA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdC52ZWxvY2l0eS5tdWx0aXBseVNjYWxhcihNYXRoLm1heCgwLCAxLjAgLSAodC5kcmFnICogZHQpKSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBNb3ZlCiAgICAgICAgICAgICAgICAgICAgdC5vZmZzZXQuYWRkU2NhbGVkVmVjdG9yKHQudmVsb2NpdHksIGR0KTsKCiAgICAgICAgICAgICAgICAgICAgLy8gQm91bmNlIExvZ2ljCiAgICAgICAgICAgICAgICAgICAgaWYgKHQub2Zmc2V0LnkgPCB0LmZsb29yWSkgewogICAgICAgICAgICAgICAgICAgICAgICB0Lm9mZnNldC55ID0gdC5mbG9vclk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJvdW5jZSB2ZWxvY2l0eQogICAgICAgICAgICAgICAgICAgICAgICB0LnZlbG9jaXR5LnkgKj0gLXQuZWxhc3RpY2l0eTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gR3JvdW5kIGZyaWN0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIHQudmVsb2NpdHkueCAqPSAwLjc7CiAgICAgICAgICAgICAgICAgICAgICAgIHQudmVsb2NpdHkueiAqPSAwLjc7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAvLyBTdG9wIGJvdW5jaW5nIGlmIGVuZXJneSBpcyBsb3cKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKHQudmVsb2NpdHkueSkgPCAyLjApIHQudmVsb2NpdHkueSA9IDA7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0LmxpZmUgPD0gMCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0LmVsLnBhcmVudE5vZGUpIHQuZWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0LmVsKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRleHRzLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVQb3NpdGlvbih0KTsKICAgICAgICAgICAgICAgICAgICAvLyBGYWRlIG91dCBpbiBsYXN0IDMwJQogICAgICAgICAgICAgICAgICAgIGlmICh0LmxpZmUgPCB0Lm1heExpZmUgKiAwLjMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdC5lbC5zdHlsZS5vcGFjaXR5ID0gdC5saWZlIC8gKHQubWF4TGlmZSAqIDAuMyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB1cGRhdGVQb3NpdGlvbih0KSB7CiAgICAgICAgICAgIC8vIFByb2plY3Qgd29ybGQgcG9zICsgb2Zmc2V0IHRvIHNjcmVlbgogICAgICAgICAgICB0aGlzLl90ZW1wVi5jb3B5KHQud29ybGRQb3MpLmFkZCh0Lm9mZnNldCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTdGFuZGFyZCBUaHJlZS5qcyBwcm9qZWN0aW9uCiAgICAgICAgICAgIHRoaXMuX3RlbXBWLnByb2plY3QodGhpcy5jYW1lcmEpOwoKICAgICAgICAgICAgY29uc3QgeCA9ICh0aGlzLl90ZW1wVi54ICogLjUgKyAuNSkgKiB0aGlzLmNvbnRhaW5lci5jbGllbnRXaWR0aDsKICAgICAgICAgICAgY29uc3QgeSA9ICgtKHRoaXMuX3RlbXBWLnkgKiAuNSkgKyAuNSkgKiB0aGlzLmNvbnRhaW5lci5jbGllbnRIZWlnaHQ7CgogICAgICAgICAgICAvLyBIaWRlIGlmIGJlaGluZCBjYW1lcmEKICAgICAgICAgICAgaWYgKHRoaXMuX3RlbXBWLnogPiAxKSB7CiAgICAgICAgICAgICAgICB0LmVsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0LmVsLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICAgICAgdC5lbC5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKCR7eH1weCwgJHt5fXB4KWA7CiAgICAgICAgICAgIH0KfQogICAgfQoKICAgIHdpbmRvdy5mbHV4LkZsb2F0aW5nVGV4dE1hbmFnZXIgPSBGbG9hdGluZ1RleHRNYW5hZ2VyOwp9KSgpOw==","/FloatingTextManager.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICBjbGFzcyBGbG9hdGluZ1RleHRNYW5hZ2VyIHsKICAgICAgICBjb25zdHJ1Y3RvcihzY2VuZSwgY29udGFpbmVySWQsIGNhbWVyYSkgewogICAgICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7CiAgICAgICAgICAgIHRoaXMuY2FtZXJhID0gY2FtZXJhOwogICAgICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNvbnRhaW5lcklkKTsKICAgICAgICAgICAgdGhpcy50ZXh0cyA9IFtdOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gUmV1c2FibGUgdmVjdG9yIGZvciBwcm9qZWN0aW9uCiAgICAgICAgICAgIHRoaXMuX3RlbXBWID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgICAgICB9CgpzcGF3bih0ZXh0LCB3b3JsZFBvcywgdHlwZSA9ICdkZWZhdWx0JywgdGFyZ2V0ID0gbnVsbCkgewogICAgICAgICAgICBpZiAoIXRoaXMuY29udGFpbmVyIHx8ICF0aGlzLmNhbWVyYSkgcmV0dXJuOwoKICAgICAgICAgICAgLy8gQ3JlYXRlIFdyYXBwZXIgKFBvc2l0aW9uaW5nKQogICAgICAgICAgICBjb25zdCB3cmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIHdyYXBwZXIuY2xhc3NOYW1lID0gJ2Zsb2F0aW5nLXRleHQtd3JhcHBlcic7CgogICAgICAgICAgICAvLyBDcmVhdGUgSW5uZXIgKEFuaW1hdGlvbi9TdHlsaW5nKQogICAgICAgICAgICBjb25zdCBpbm5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgICAgICAgICAgaW5uZXIuaW5uZXJUZXh0ID0gdGV4dDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFNtYXJ0IENsYXNzIEFzc2lnbm1lbnQKICAgICAgICAgICAgbGV0IGNsYXNzZXMgPSBbJ2Zsb2F0aW5nLXRleHQtaW5uZXInXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEFkZCBiYXNlIHR5cGUKICAgICAgICAgICAgY2xhc3Nlcy5wdXNoKHR5cGUpOwoKICAgICAgICAgICAgLy8gS2V5d29yZCBEZXRlY3Rpb24gZm9yIEF1dG8tU3R5bGluZwogICAgICAgICAgICBjb25zdCB1cHBlciA9IHRleHQudG9TdHJpbmcoKS50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgICAKaWYgKHVwcGVyLmluY2x1ZGVzKCdQT0lTT04nKSB8fCB1cHBlci5pbmNsdWRlcygnVkVOT00nKSkgY2xhc3Nlcy5wdXNoKCd2ZW5vbScpOwogICAgICAgICAgICBlbHNlIGlmICh1cHBlci5pbmNsdWRlcygnU0xFRVAnKSB8fCB1cHBlci5pbmNsdWRlcygnTkFQJykgfHwgdXBwZXIuaW5jbHVkZXMoJ1paWicpKSBjbGFzc2VzLnB1c2goJ3NsZWVwJyk7CiAgICAgICAgICAgIGVsc2UgaWYgKHVwcGVyLmluY2x1ZGVzKCdXSVRIRVInKSkgY2xhc3Nlcy5wdXNoKCd3aXRoZXInKTsKICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ3RlY2gnIHx8IHVwcGVyLmluY2x1ZGVzKCdTSE9UJykgfHwgdXBwZXIuaW5jbHVkZXMoJ0pFQ0hUJykgfHwgdXBwZXIuaW5jbHVkZXMoJ1RBQ0tMRScpKSBjbGFzc2VzLnB1c2goJ3RlY2gnKTsKICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ2NvbWljLWltcGFjdCcpIGNsYXNzZXMucHVzaCgnY29taWMtaW1wYWN0Jyk7CiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT09ICdjb21pYy1hY3Rpb24nKSBjbGFzc2VzLnB1c2goJ2NvbWljLWFjdGlvbicpOwogICAgICAgICAgICBlbHNlIGlmICghaXNOYU4ocGFyc2VJbnQodGV4dCkpICYmIHR5cGUgIT09ICdzY29yZScpIGNsYXNzZXMucHVzaCgnZGFtYWdlJyk7IC8vIE51bWVyaWMgaXMgdXN1YWxseSBkYW1hZ2UKICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ3NhdmUnIHx8IHR5cGUgPT09ICdibG9jaycpIGNsYXNzZXMucHVzaCgnc2F2ZScpOwoKICAgICAgICAgICAgaW5uZXIuY2xhc3NOYW1lID0gY2xhc3Nlcy5qb2luKCcgJyk7CiAgICAgICAgICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQoaW5uZXIpOwogICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmRDaGlsZCh3cmFwcGVyKTsKCiAgICAgICAgICAgIC8vIFBoeXNpY3MgSW5zdGFuY2UKICAgICAgICAgICAgY29uc3QgaW5zdGFuY2UgPSB7CiAgICAgICAgICAgICAgICBlbDogd3JhcHBlciwgCiAgICAgICAgICAgICAgICB3b3JsZFBvczogd29ybGRQb3MuY2xvbmUoKSwKICAgICAgICAgICAgICAgIG9mZnNldDogbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMCksCiAgICAgICAgICAgICAgICB2ZWxvY2l0eTogbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMCksCiAgICAgICAgICAgICAgICBncmF2aXR5OiAwLAogICAgICAgICAgICAgICAgZHJhZzogMCwKICAgICAgICAgICAgICAgIGVsYXN0aWNpdHk6IDAuNiwKICAgICAgICAgICAgICAgIGZsb29yWTogLTk5OSwgLy8gVmlydHVhbCBmbG9vciByZWxhdGl2ZSB0byBzdGFydAogICAgICAgICAgICAgICAgCmxpZmU6IDEuMCwgIC8vIFJlZHVjZWQgZnJvbSAxLjUKICAgICAgICAgICAgICAgIG1heExpZmU6IDEuMCwKICAgICAgICAgICAgICAgIHRhcmdldDogdGFyZ2V0CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBDdXN0b21pemUgUGh5c2ljcyBiYXNlZCBvbiBUeXBlCmlmIChjbGFzc2VzLmluY2x1ZGVzKCdkYW1hZ2UnKSB8fCBjbGFzc2VzLmluY2x1ZGVzKCdzYXZlJykgfHwgY2xhc3Nlcy5pbmNsdWRlcygnYmxvY2snKSkgewogICAgICAgICAgICAgICAgLy8gREVCUklTIFBIWVNJQ1MgKFBvcCwgQXJjLCBCb3VuY2UpCiAgICAgICAgICAgICAgICBpbnN0YW5jZS50YXJnZXQgPSBudWxsOyAvLyBEZXRhY2ggZnJvbSBlbnRpdHkgc28gaXQgZmFsbHMgbmF0dXJhbGx5CiAgICAgICAgICAgICAgICBpbnN0YW5jZS5ncmF2aXR5ID0gNDAuMDsgLy8gSGVhdnkgZ3Jhdml0eSBmb3Igc25hcHB5IGZlZWwKICAgICAgICAgICAgICAgIGluc3RhbmNlLmRyYWcgPSAwLjU7CiAgICAgICAgICAgICAgICBpbnN0YW5jZS5mbG9vclkgPSAtNC4wOyAvLyBCb3VuY2Ugb2ZmIGEgdmlydHVhbCBmbG9vciBiZWxvdyBpbXBhY3QKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRXhwbG9zaXZlIEJ1cnN0CiAgICAgICAgICAgICAgICBjb25zdCBzcHJlYWQgPSA2LjA7CiAgICAgICAgICAgICAgICBpbnN0YW5jZS52ZWxvY2l0eS5zZXQoCiAgICAgICAgICAgICAgICAgICAgKE1hdGgucmFuZG9tKCkgLSAwLjUpICogc3ByZWFkLAogICAgICAgICAgICAgICAgICAgIDE1LjAgKyBNYXRoLnJhbmRvbSgpICogNS4wLCAvLyBIaWdoIGluaXRpYWwgcG9wCiAgICAgICAgICAgICAgICAgICAgKE1hdGgucmFuZG9tKCkgLSAwLjUpICogc3ByZWFkCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpbnN0YW5jZS5saWZlID0gMi4wOwogICAgICAgICAgICAgICAgaW5zdGFuY2UubWF4TGlmZSA9IDIuMDsKCiAgICAgICAgICAgIH0gZWxzZSBpZiAoY2xhc3Nlcy5pbmNsdWRlcygnY29taWMtaW1wYWN0JykpIHsKICAgICAgICAgICAgICAgIC8vIENPTUlDIFBPUCAoU3RheSBpbiBwbGFjZSBtb3N0bHksIHNsaWdodCBkcmlmdCkKICAgICAgICAgICAgICAgIGluc3RhbmNlLmdyYXZpdHkgPSAwOwogICAgICAgICAgICAgICAgaW5zdGFuY2UudmVsb2NpdHkuc2V0KChNYXRoLnJhbmRvbSgpLTAuNSkqMiwgMS4wLCAoTWF0aC5yYW5kb20oKS0wLjUpKjIpOwppbnN0YW5jZS5saWZlID0gMC41OyAvLyBSZWR1Y2VkIGZyb20gMC44CiAgICAgICAgICAgICAgICBpbnN0YW5jZS5tYXhMaWZlID0gMC41OwoKICAgICAgICAgICAgfSBlbHNlIGlmIChjbGFzc2VzLmluY2x1ZGVzKCdjb21pYy1hY3Rpb24nKSkgewogICAgICAgICAgICAgICAgLy8gQ09NSUMgWklQIChGYXN0IG1vdmVtZW50KQogICAgICAgICAgICAgICAgaW5zdGFuY2UuZ3Jhdml0eSA9IDA7CiAgICAgICAgICAgICAgICBpbnN0YW5jZS52ZWxvY2l0eS5zZXQoMCwgMi4wLCAwKTsKaW5zdGFuY2UubGlmZSA9IDAuNDsgLy8gUmVkdWNlZCBmcm9tIDAuNgogICAgICAgICAgICAgICAgaW5zdGFuY2UubWF4TGlmZSA9IDAuNDsKCiAgICAgICAgICAgIH0gZWxzZSBpZiAoY2xhc3Nlcy5pbmNsdWRlcygndGVjaCcpKSB7CiAgICAgICAgICAgICAgICAvLyBURUNIIEZMT0FUIChTbG93IHJpc2UpCiAgICAgICAgICAgICAgICBpbnN0YW5jZS5ncmF2aXR5ID0gMDsKICAgICAgICAgICAgICAgIGluc3RhbmNlLnZlbG9jaXR5LnNldCgwLCAyLjAsIDApOyAvLyBTdGVhZHkgcmlzZQogICAgICAgICAgICAgICAgaW5zdGFuY2UubGlmZSA9IDIuNTsKICAgICAgICAgICAgICAgIGluc3RhbmNlLm1heExpZmUgPSAyLjU7CiAgICAgICAgICAgICAgICBpbnN0YW5jZS5vZmZzZXQueSA9IDIuMDsgLy8gU3RhcnQgaGlnaGVyCgogICAgICAgICAgICB9IGVsc2UgaWYgKGNsYXNzZXMuaW5jbHVkZXMoJ3NsZWVwJykpIHsKICAgICAgICAgICAgICAgIC8vIFNMRUVQIERSSUZUIChTbG93IG1lYW5kZXJpbmcpCiAgICAgICAgICAgICAgICBpbnN0YW5jZS5ncmF2aXR5ID0gLTAuNTsgLy8gU2xpZ2h0IGFudGktZ3Jhdml0eQogICAgICAgICAgICAgICAgaW5zdGFuY2UudmVsb2NpdHkuc2V0KDAsIDAuNSwgMCk7CiAgICAgICAgICAgICAgICBpbnN0YW5jZS5saWZlID0gMy4wOwogICAgICAgICAgICAgICAgaW5zdGFuY2UubWF4TGlmZSA9IDMuMDsKCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBERUZBVUxUIChTdGF0dXMsIGV0YykKICAgICAgICAgICAgICAgIGluc3RhbmNlLnZlbG9jaXR5LnNldCgwLCAzLjAsIDApOwogICAgICAgICAgICAgICAgaW5zdGFuY2UuZ3Jhdml0eSA9IDUuMDsgLy8gU2xpZ2h0IGFyYwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBSYW5kb21pemUgc3RhcnQgcG9zIHNsaWdodGx5IHRvIHByZXZlbnQgc3RhY2tpbmcKICAgICAgICAgICAgaWYgKCF0YXJnZXQpIHsKICAgICAgICAgICAgICAgIGluc3RhbmNlLndvcmxkUG9zLnggKz0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogMC41OwogICAgICAgICAgICAgICAgaW5zdGFuY2Uud29ybGRQb3MueiArPSAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiAwLjU7CiAgICAgICAgICAgIH0KaW5zdGFuY2Uud29ybGRQb3MueSArPSAxLjA7CiAgICAgICAgICAgIHRoaXMudGV4dHMucHVzaChpbnN0YW5jZSk7CiAgICAgICAgICAgIHRoaXMudXBkYXRlUG9zaXRpb24oaW5zdGFuY2UpOwogICAgICAgIH0KCi8vIHNwYXduVmVyc3VzIHJlbW92ZWQKCiAgICAgICAgdXBkYXRlKGR0KSB7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSB0aGlzLnRleHRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0ID0gdGhpcy50ZXh0c1tpXTsKICAgICAgICAgICAgICAgIHQubGlmZSAtPSBkdDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gSWYgYXR0YWNoZWQgdG8gYSB0YXJnZXQsIHVwZGF0ZSBiYXNlIHBvc2l0aW9uIChvbmx5IGZvciBub24tZGVicmlzKQogICAgICAgICAgICAgICAgaWYgKHQudGFyZ2V0ICYmIHQudGFyZ2V0LnBhcmVudCkgeyAKICAgICAgICAgICAgICAgICAgICB0LndvcmxkUG9zLmNvcHkodC50YXJnZXQucG9zaXRpb24pOwogICAgICAgICAgICAgICAgICAgIHQud29ybGRQb3MueSArPSAxLjA7IAogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIFBoeXNpY3MgSW50ZWdyYXRpb24KICAgICAgICAgICAgICAgIGlmICh0LmdyYXZpdHkgIT09IDAgfHwgdC52ZWxvY2l0eS5sZW5ndGhTcSgpID4gMCkgewogICAgICAgICAgICAgICAgICAgIC8vIEdyYXZpdHkKICAgICAgICAgICAgICAgICAgICB0LnZlbG9jaXR5LnkgLT0gdC5ncmF2aXR5ICogZHQ7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gRHJhZyAoQWlyIHJlc2lzdGFuY2UpCiAgICAgICAgICAgICAgICAgICAgaWYgKHQuZHJhZyA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdC52ZWxvY2l0eS5tdWx0aXBseVNjYWxhcihNYXRoLm1heCgwLCAxLjAgLSAodC5kcmFnICogZHQpKSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBNb3ZlCiAgICAgICAgICAgICAgICAgICAgdC5vZmZzZXQuYWRkU2NhbGVkVmVjdG9yKHQudmVsb2NpdHksIGR0KTsKCiAgICAgICAgICAgICAgICAgICAgLy8gQm91bmNlIExvZ2ljCiAgICAgICAgICAgICAgICAgICAgaWYgKHQub2Zmc2V0LnkgPCB0LmZsb29yWSkgewogICAgICAgICAgICAgICAgICAgICAgICB0Lm9mZnNldC55ID0gdC5mbG9vclk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJvdW5jZSB2ZWxvY2l0eQogICAgICAgICAgICAgICAgICAgICAgICB0LnZlbG9jaXR5LnkgKj0gLXQuZWxhc3RpY2l0eTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gR3JvdW5kIGZyaWN0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIHQudmVsb2NpdHkueCAqPSAwLjc7CiAgICAgICAgICAgICAgICAgICAgICAgIHQudmVsb2NpdHkueiAqPSAwLjc7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAvLyBTdG9wIGJvdW5jaW5nIGlmIGVuZXJneSBpcyBsb3cKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKHQudmVsb2NpdHkueSkgPCAyLjApIHQudmVsb2NpdHkueSA9IDA7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0LmxpZmUgPD0gMCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0LmVsLnBhcmVudE5vZGUpIHQuZWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0LmVsKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRleHRzLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVQb3NpdGlvbih0KTsKICAgICAgICAgICAgICAgICAgICAvLyBGYWRlIG91dCBpbiBsYXN0IDMwJQogICAgICAgICAgICAgICAgICAgIGlmICh0LmxpZmUgPCB0Lm1heExpZmUgKiAwLjMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdC5lbC5zdHlsZS5vcGFjaXR5ID0gdC5saWZlIC8gKHQubWF4TGlmZSAqIDAuMyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB1cGRhdGVQb3NpdGlvbih0KSB7CiAgICAgICAgICAgIC8vIFByb2plY3Qgd29ybGQgcG9zICsgb2Zmc2V0IHRvIHNjcmVlbgogICAgICAgICAgICB0aGlzLl90ZW1wVi5jb3B5KHQud29ybGRQb3MpLmFkZCh0Lm9mZnNldCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTdGFuZGFyZCBUaHJlZS5qcyBwcm9qZWN0aW9uCiAgICAgICAgICAgIHRoaXMuX3RlbXBWLnByb2plY3QodGhpcy5jYW1lcmEpOwoKICAgICAgICAgICAgY29uc3QgeCA9ICh0aGlzLl90ZW1wVi54ICogLjUgKyAuNSkgKiB0aGlzLmNvbnRhaW5lci5jbGllbnRXaWR0aDsKICAgICAgICAgICAgY29uc3QgeSA9ICgtKHRoaXMuX3RlbXBWLnkgKiAuNSkgKyAuNSkgKiB0aGlzLmNvbnRhaW5lci5jbGllbnRIZWlnaHQ7CgogICAgICAgICAgICAvLyBIaWRlIGlmIGJlaGluZCBjYW1lcmEKICAgICAgICAgICAgaWYgKHRoaXMuX3RlbXBWLnogPiAxKSB7CiAgICAgICAgICAgICAgICB0LmVsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0LmVsLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICAgICAgdC5lbC5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKCR7eH1weCwgJHt5fXB4KWA7CiAgICAgICAgICAgIH0KfQogICAgfQoKICAgIHdpbmRvdy5mbHV4LkZsb2F0aW5nVGV4dE1hbmFnZXIgPSBGbG9hdGluZ1RleHRNYW5hZ2VyOwp9KSgpOw==","CameraManager.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICAvLyBSZXVzYWJsZSB2ZWN0b3JzIHRvIGF2b2lkIEdhcmJhZ2UgQ29sbGVjdGlvbgogICAgY29uc3QgX2lkZWFsUG9zID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgIGNvbnN0IF9pZGVhbExvb2sgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgY29uc3QgX2N1cnJlbnRQb3MgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgY29uc3QgX2N1cnJlbnRMb29rID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgIGNvbnN0IF92ZWxvY2l0eSA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfdGFyZ2V0V29ybGRQb3MgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgY29uc3QgX2NhbU9mZnNldCA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfbG9va0FoZWFkID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgIGNvbnN0IF9nb2FsUG9zID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgIGNvbnN0IF9jYW1Gd2QgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgY29uc3QgX2NhbVJpZ2h0ID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKCiAgICBjbGFzcyBDYW1lcmFNYW5hZ2VyIHsKICAgICAgICBjb25zdHJ1Y3RvcihjYW1lcmEsIHNjZW5lKSB7CiAgICAgICAgICAgIHRoaXMuY2FtZXJhID0gY2FtZXJhOwogICAgICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7CgogICAgICAgICAgICAvLyAtLS0gSU1QUk9WRUQgQ09ORklHVVJBVElPTiAtLS0KICAgICAgICAgICAgdGhpcy5jb25maWcgPSB7CiAgICAgICAgICAgICAgICAvLyBGSVhFRCBQRVJTUEVDVElWRSBTRVRUSU5HUwogICAgICAgICAgICAgICAgYmFzZURpc3RhbmNlOiAyMi4wLAogICAgICAgICAgICAgICAgYmFzZUhlaWdodDogMTQuMCwKCiAgICAgICAgICAgICAgICAvLyBJTVBST1ZFRDogRmFzdGVyLCBtb3JlIHJlc3BvbnNpdmUgc21vb3RoaW5nCiAgICAgICAgICAgICAgICBmb2xsb3dTcGVlZDogNC4wLCAgICAgLy8gSW5jcmVhc2VkIGZyb20gMi41CiAgICAgICAgICAgICAgICBsb29rU3BlZWQ6IDUuMCwgICAgICAgLy8gSW5jcmVhc2VkIGZyb20gMy41CgogICAgICAgICAgICAgICAgLy8gRHluYW1pYyBGT1YKICAgICAgICAgICAgICAgIGZvdkJhc2U6IDUwLAogICAgICAgICAgICAgICAgZm92TWF4OiA2MCwKCiAgICAgICAgICAgICAgICAvLyBJTVBST1ZFRDogTG9vay1haGVhZCBzZXR0aW5ncwogICAgICAgICAgICAgICAgbG9va0FoZWFkRGlzdGFuY2U6IDYuMCwKICAgICAgICAgICAgICAgIGxvb2tBaGVhZFNtb290aGluZzogMy4wLAoKICAgICAgICAgICAgICAgIC8vIFNtYXJ0IGZyYW1pbmcKICAgICAgICAgICAgICAgIGJhbGxUcmFja1dlaWdodDogMC4zLAogICAgICAgICAgICAgICAgdGhyZWF0QXdhcmVuZXNzOiB0cnVlCiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBTdGF0ZQogICAgICAgICAgICB0aGlzLnRhcmdldCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuYmFsbCA9IG51bGw7IC8vIERpcmVjdCBiYWxsIHJlZmVyZW5jZSBmb3Igc21hcnQgZnJhbWluZwogICAgICAgICAgICB0aGlzLnRhcmdldFZlbCA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICAgICAgICAgIHRoaXMudGFyZ2V0SW5wdXQgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgICAgICAgICB0aGlzLnNtb290aGVkSW5wdXQgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgICAgICAgICB0aGlzLnNtb290aGVkTG9va0FoZWFkID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKCiAgICAgICAgICAgIC8vIENhbWVyYSBTdGF0ZQogICAgICAgICAgICB0aGlzLnBvcyA9IGNhbWVyYS5wb3NpdGlvbi5jbG9uZSgpOwogICAgICAgICAgICB0aGlzLmxvb2tBdCA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIDApOwoKICAgICAgICAgICAgLy8gT3JiaXQgU3RhdGUKICAgICAgICAgICAgdGhpcy5jdXJyZW50WWF3ID0gTWF0aC5QSTsKICAgICAgICAgICAgdGhpcy50YXJnZXRZYXcgPSBNYXRoLlBJOwoKICAgICAgICAgICAgLy8gSU1QUk9WRUQ6IE1hbnVhbCBvcmJpdCBmcm9tIHRvdWNoIChyaWdodCBzaWRlIG9mIHNjcmVlbikKICAgICAgICAgICAgdGhpcy5tYW51YWxPcmJpdFlhdyA9IDA7CiAgICAgICAgICAgIHRoaXMubWFudWFsT3JiaXRQaXRjaCA9IDA7CiAgICAgICAgICAgIHRoaXMub3JiaXRTZW5zaXRpdml0eSA9IDAuMDA0OwogICAgICAgICAgICB0aGlzLmF1dG9SZWNlbnRlclRpbWVyID0gMDsKICAgICAgICAgICAgdGhpcy5hdXRvUmVjZW50ZXJEZWxheSA9IDMuMDsKCi8vIFNoYWtlCiAgICAgICAgICAgIHRoaXMuc2hha2VJbnRlbnNpdHkgPSAwOwogICAgICAgICAgICB0aGlzLnNoYWtlUm9sbCA9IDA7IC8vIE5FVzogUm90YXRpb25hbCBzaGFrZQogICAgICAgICAgICB0aGlzLnNoYWtlT2Zmc2V0ID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgICAgICAgICAgdGhpcy5mb3ZJbXB1bHNlID0gMDsKCiAgICAgICAgICAgIC8vIENpbmVtYXRpYyBTdGF0ZQogICAgICAgICAgICB0aGlzLmlzQ2luZW1hdGljID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuY2luZW1hdGljVGltZXIgPSAwOwogICAgICAgICAgICB0aGlzLmNpbmVtYXRpY0R1cmF0aW9uID0gMDsKICAgICAgICAgICAgdGhpcy5jaW5lbWF0aWNUeXBlID0gJ2RlZmF1bHQnOwogICAgICAgICAgICB0aGlzLmNpbmVtYXRpY1N0YXJ0UG9zID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgICAgICAgICAgdGhpcy5jaW5lbWF0aWNTdGFydExvb2sgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgICAgICAgICB0aGlzLmNpbmVtYXRpY0VuZFBvcyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CgogICAgICAgICAgICAvLyBJTVBST1ZFRDogRHluYW1pYyBwdWxsLWJhY2sgYmFzZWQgb24gYWN0aW9uCiAgICAgICAgICAgIHRoaXMuY3VycmVudFB1bGxCYWNrID0gMDsKICAgICAgICAgICAgdGhpcy5tYXhQdWxsQmFjayA9IDg7CiAgICAgICAgfQoKICAgICAgICAvLyBORVc6IFNldCBiYWxsIHJlZmVyZW5jZSBmb3Igc21hcnQgZnJhbWluZwogICAgICAgIHNldEJhbGwoYmFsbCkgewogICAgICAgICAgICB0aGlzLmJhbGwgPSBiYWxsOwogICAgICAgIH0KCiAgICAgICAgLy8gSU1QUk9WRUQ6IEdldCBjYW1lcmEtcmVsYXRpdmUgaW5wdXQgdHJhbnNmb3JtYXRpb24KICAgICAgICBnZXRDYW1lcmFSZWxhdGl2ZUlucHV0KGlucHV0WCwgaW5wdXRaKSB7CiAgICAgICAgICAgIHRoaXMuY2FtZXJhLmdldFdvcmxkRGlyZWN0aW9uKF9jYW1Gd2QpOwogICAgICAgICAgICBfY2FtRndkLnkgPSAwOwoKICAgICAgICAgICAgaWYgKF9jYW1Gd2QubGVuZ3RoU3EoKSA8IDAuMDAxKSB7CiAgICAgICAgICAgICAgICBfY2FtRndkLnNldCgwLCAwLCAtMSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBfY2FtRndkLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfY2FtUmlnaHQuY3Jvc3NWZWN0b3JzKG5ldyBUSFJFRS5WZWN0b3IzKDAsIDEsIDApLCBfY2FtRndkKS5ub3JtYWxpemUoKTsKCiAgICAgICAgICAgIC8vIFRyYW5zZm9ybSBpbnB1dCB0byB3b3JsZCBzcGFjZQogICAgICAgICAgICBjb25zdCB3b3JsZFggPSAoaW5wdXRYICogX2NhbVJpZ2h0LngpICsgKGlucHV0WiAqIF9jYW1Gd2QueCk7CiAgICAgICAgICAgIGNvbnN0IHdvcmxkWiA9IChpbnB1dFggKiBfY2FtUmlnaHQueikgKyAoaW5wdXRaICogX2NhbUZ3ZC56KTsKCiAgICAgICAgICAgIHJldHVybiB7IHg6IHdvcmxkWCwgejogd29ybGRaIH07CiAgICAgICAgfQoKICAgICAgICAvLyBORVc6IE1hbnVhbCBvcmJpdCBpbnB1dCBmcm9tIHRvdWNoCiAgICAgICAgaGFuZGxlT3JiaXRJbnB1dChkeCwgZHkpIHsKICAgICAgICAgICAgdGhpcy5tYW51YWxPcmJpdFlhdyArPSBkeCAqIHRoaXMub3JiaXRTZW5zaXRpdml0eTsKICAgICAgICAgICAgdGhpcy5tYW51YWxPcmJpdFBpdGNoICs9IGR5ICogdGhpcy5vcmJpdFNlbnNpdGl2aXR5ICogMC41OwoKICAgICAgICAgICAgLy8gQ2xhbXAgcGl0Y2gKICAgICAgICAgICAgdGhpcy5tYW51YWxPcmJpdFBpdGNoID0gTWF0aC5tYXgoLTAuMywgTWF0aC5taW4oMC41LCB0aGlzLm1hbnVhbE9yYml0UGl0Y2gpKTsKCiAgICAgICAgICAgIC8vIFJlc2V0IGF1dG8tcmVjZW50ZXIgdGltZXIKICAgICAgICAgICAgdGhpcy5hdXRvUmVjZW50ZXJUaW1lciA9IDA7CiAgICAgICAgfQoKICAgICAgICAvLyBORVc6IFJlY2VudGVyIGNhbWVyYQogICAgICAgIHJlY2VudGVyKCkgewogICAgICAgICAgICB0aGlzLm1hbnVhbE9yYml0WWF3ID0gMDsKICAgICAgICAgICAgdGhpcy5tYW51YWxPcmJpdFBpdGNoID0gMDsKICAgICAgICB9CgogICAgICAgIHBsYXlDaW5lbWF0aWModHlwZSwgdGFyZ2V0LCBkdXJhdGlvbiA9IDEuNSkgewogICAgICAgICAgICB0aGlzLmlzQ2luZW1hdGljID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5jaW5lbWF0aWNUaW1lciA9IDA7CiAgICAgICAgICAgIHRoaXMuY2luZW1hdGljRHVyYXRpb24gPSBkdXJhdGlvbjsKICAgICAgICAgICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7CiAgICAgICAgICAgIHRoaXMuY2luZW1hdGljVHlwZSA9IHR5cGU7CgogICAgICAgICAgICB0aGlzLmNpbmVtYXRpY1N0YXJ0UG9zLmNvcHkodGhpcy5wb3MpOwogICAgICAgICAgICB0aGlzLmNpbmVtYXRpY1N0YXJ0TG9vay5jb3B5KHRoaXMubG9va0F0KTsKCiAgICAgICAgICAgIHRoaXMuYWRkRm92SW1wdWxzZSgtMTUpOwogICAgICAgIH0KCiAgICAgICAgX3VwZGF0ZUNpbmVtYXRpYyhkdCkgewogICAgICAgICAgICB0aGlzLmNpbmVtYXRpY1RpbWVyICs9IGR0OwogICAgICAgICAgICBjb25zdCBwcm9ncmVzcyA9IE1hdGgubWluKDEuMCwgdGhpcy5jaW5lbWF0aWNUaW1lciAvIHRoaXMuY2luZW1hdGljRHVyYXRpb24pOwoKICAgICAgICAgICAgY29uc3QgdCA9IDEgLSBNYXRoLnBvdygxIC0gcHJvZ3Jlc3MsIDMpOwoKICAgICAgICAgICAgbGV0IGFjdGl2ZVRhcmdldCA9IHRoaXMudGFyZ2V0OwogICAgICAgICAgICBsZXQgaXNCYWxsVHJhY2tpbmcgPSBmYWxzZTsKICAgICAgICAgICAgY29uc3QgYmFsbCA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSA/IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5lbnRpdGllcy5iYWxsIDogbnVsbDsKCiAgICAgICAgICAgIGlmIChiYWxsICYmIGJhbGwubWVzaCAmJiBiYWxsLnN0YXRlID09PSAnZnJlZScgJiYgYmFsbC52ZWxvY2l0eS5sZW5ndGhTcSgpID4gMi4wKSB7CiAgICAgICAgICAgICAgICBhY3RpdmVUYXJnZXQgPSBiYWxsLm1lc2g7CiAgICAgICAgICAgICAgICBpc0JhbGxUcmFja2luZyA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghYWN0aXZlVGFyZ2V0KSB7CiAgICAgICAgICAgICAgICB0aGlzLmlzQ2luZW1hdGljID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGFjdGl2ZVRhcmdldC5nZXRXb3JsZFBvc2l0aW9uKF90YXJnZXRXb3JsZFBvcyk7CgogICAgICAgICAgICBjb25zdCBlbmRMb29rID0gX3RhcmdldFdvcmxkUG9zLmNsb25lKCk7CiAgICAgICAgICAgIGxldCBmd2QgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgICAgICAgICBsZXQgcmlnaHQgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwoKICAgICAgICAgICAgaWYgKGlzQmFsbFRyYWNraW5nKSB7CiAgICAgICAgICAgICAgICBlbmRMb29rLmFkZFNjYWxlZFZlY3RvcihiYWxsLnZlbG9jaXR5LCAwLjMpOwoKICAgICAgICAgICAgICAgIGZ3ZC5jb3B5KGJhbGwudmVsb2NpdHkpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgZndkLnkgPSAwOwogICAgICAgICAgICAgICAgaWYgKGZ3ZC5sZW5ndGhTcSgpIDwgMC4wMSkgZndkLnNldCgwLDAsMSk7CiAgICAgICAgICAgICAgICBmd2Qubm9ybWFsaXplKCk7CgogICAgICAgICAgICAgICAgcmlnaHQuY3Jvc3NWZWN0b3JzKG5ldyBUSFJFRS5WZWN0b3IzKDAsMSwwKSwgZndkKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGVuZExvb2sueSArPSAxLjU7CiAgICAgICAgICAgICAgICBmd2Quc2V0KDAsIDAsIDEpLmFwcGx5UXVhdGVybmlvbihhY3RpdmVUYXJnZXQucXVhdGVybmlvbik7CiAgICAgICAgICAgICAgICByaWdodC5zZXQoMSwgMCwgMCkuYXBwbHlRdWF0ZXJuaW9uKGFjdGl2ZVRhcmdldC5xdWF0ZXJuaW9uKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgZW5kUG9zID0gX3RhcmdldFdvcmxkUG9zLmNsb25lKCk7CgogICAgICAgICAgICBpZiAodGhpcy5jaW5lbWF0aWNUeXBlID09PSAnamVjaHQnKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gaXNCYWxsVHJhY2tpbmcgPyAxNC4wIDogMTAuMDsKICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IGZ3ZC5jbG9uZSgpLm11bHRpcGx5U2NhbGFyKC1kaXN0KS5hZGQocmlnaHQuY2xvbmUoKS5tdWx0aXBseVNjYWxhcigzLjApKTsKICAgICAgICAgICAgICAgIGVuZFBvcy5hZGQob2Zmc2V0KTsKICAgICAgICAgICAgICAgIGVuZFBvcy55ICs9IDYuMDsKICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmNpbmVtYXRpY1R5cGUgPT09ICdzcGhlcmUnKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gaXNCYWxsVHJhY2tpbmcgPyAxNi4wIDogMTIuMDsKICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IGZ3ZC5jbG9uZSgpLm11bHRpcGx5U2NhbGFyKC1kaXN0KTsKICAgICAgICAgICAgICAgIGVuZFBvcy5hZGQob2Zmc2V0KTsKICAgICAgICAgICAgICAgIGVuZFBvcy55ICs9IDEwLjA7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5jaW5lbWF0aWNUeXBlID09PSAnaW52aXNpYmxlJykgewogICAgICAgICAgICAgICAgY29uc3QgZGlzdCA9IDEyLjA7CiAgICAgICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBmd2QuY2xvbmUoKS5tdWx0aXBseVNjYWxhcigtZGlzdCAqIDAuNSkuYWRkKHJpZ2h0LmNsb25lKCkubXVsdGlwbHlTY2FsYXIoZGlzdCkpOwogICAgICAgICAgICAgICAgZW5kUG9zLmFkZChvZmZzZXQpOwogICAgICAgICAgICAgICAgZW5kUG9zLnkgKz0gNS4wOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgZGlzdCA9IGlzQmFsbFRyYWNraW5nID8gMTQuMCA6IDEwLjA7CiAgICAgICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBmd2QuY2xvbmUoKS5tdWx0aXBseVNjYWxhcigtZGlzdCk7CiAgICAgICAgICAgICAgICBlbmRQb3MuYWRkKG9mZnNldCk7CiAgICAgICAgICAgICAgICBlbmRQb3MueSArPSA1LjA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMucG9zLmxlcnAoZW5kUG9zLCBkdCAqIDQuMCk7CiAgICAgICAgICAgIHRoaXMubG9va0F0LmxlcnAoZW5kTG9vaywgZHQgKiA2LjApOwoKICAgICAgICAgICAgdGhpcy5jYW1lcmEucG9zaXRpb24uY29weSh0aGlzLnBvcyk7CiAgICAgICAgICAgIHRoaXMuY2FtZXJhLmxvb2tBdCh0aGlzLmxvb2tBdCk7CgogICAgICAgICAgICBpZiAodGhpcy5jaW5lbWF0aWNUaW1lciA+PSB0aGlzLmNpbmVtYXRpY0R1cmF0aW9uKSB7CiAgICAgICAgICAgICAgICB0aGlzLmlzQ2luZW1hdGljID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHNldFRhcmdldChtZXNoLCB2ZWxvY2l0eSwgaW5wdXQpIHsKICAgICAgICAgICAgdGhpcy50YXJnZXQgPSBtZXNoOwogICAgICAgICAgICBpZiAodmVsb2NpdHkpIHRoaXMudGFyZ2V0VmVsLmNvcHkodmVsb2NpdHkpOwogICAgICAgICAgICBpZiAoaW5wdXQpIHRoaXMudGFyZ2V0SW5wdXQuY29weShpbnB1dCk7CiAgICAgICAgICAgIGVsc2UgdGhpcy50YXJnZXRJbnB1dC5zZXQoMCwgMCwgMCk7CiAgICAgICAgfQoKICAgICAgICAvLyBLZWVwIGZvciBjb21wYXRpYmlsaXR5CiAgICAgICAgaGFuZGxlSW5wdXQoZHgsIGR5KSB7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlT3JiaXRJbnB1dChkeCwgZHkpOwogICAgICAgIH0KCiAgICAgICAgZ2V0WWF3KCkgeyByZXR1cm4gdGhpcy5jdXJyZW50WWF3OyB9CgogICAgICAgIGFkZFNoYWtlKGFtb3VudCkgewoKICAgICAgICAgICAgdGhpcy5zaGFrZUludGVuc2l0eSA9IE1hdGgubWluKHRoaXMuc2hha2VJbnRlbnNpdHkgKyBhbW91bnQsIDQuMCk7IC8vIEluY3JlYXNlZCBjYXAKICAgICAgICAgICAgdGhpcy5zaGFrZVJvbGwgPSBNYXRoLm1pbih0aGlzLnNoYWtlUm9sbCArIGFtb3VudCAqIDAuMiwgMC44KTsgLy8gQWRkIHJvbGwKICAgICAgICB9CiAgICAgICAgYWRkRm92SW1wdWxzZShhbW91bnQpIHsKICAgICAgICAgICAgdGhpcy5mb3ZJbXB1bHNlID0gTWF0aC5taW4odGhpcy5mb3ZJbXB1bHNlICsgYW1vdW50LCAzMCk7CiAgICAgICAgfQoKICAgICAgICBzbmFwVG9UYXJnZXQoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy50YXJnZXQpIHJldHVybjsKICAgICAgICAgICAgdGhpcy50YXJnZXQuZ2V0V29ybGRQb3NpdGlvbihfdGFyZ2V0V29ybGRQb3MpOwoKICAgICAgICAgICAgdGhpcy5fY2FsY3VsYXRlSWRlYWxTdGF0ZSgwKTsKCiAgICAgICAgICAgIHRoaXMucG9zLmNvcHkoX2lkZWFsUG9zKTsKICAgICAgICAgICAgdGhpcy5sb29rQXQuY29weShfaWRlYWxMb29rKTsKICAgICAgICAgICAgdGhpcy5jdXJyZW50WWF3ID0gdGhpcy50YXJnZXRZYXc7CgogICAgICAgICAgICB0aGlzLmNhbWVyYS5wb3NpdGlvbi5jb3B5KHRoaXMucG9zKTsKICAgICAgICAgICAgdGhpcy5jYW1lcmEubG9va0F0KHRoaXMubG9va0F0KTsKCiAgICAgICAgICAgIHRoaXMuc21vb3RoZWRJbnB1dC5zZXQoMCwgMCwgMCk7CiAgICAgICAgICAgIHRoaXMuc21vb3RoZWRMb29rQWhlYWQuc2V0KDAsIDAsIDApOwogICAgICAgIH0KCiAgICAgICAgdXBkYXRlKGR0KSB7CiAgICAgICAgICAgIGlmICh0aGlzLmlzQ2luZW1hdGljKSB7CiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVDaW5lbWF0aWMoZHQpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIXRoaXMudGFyZ2V0KSByZXR1cm47CgogICAgICAgICAgICBjb25zdCBzYWZlRHQgPSBNYXRoLm1pbihkdCwgMC4wNSk7CgogICAgICAgICAgICAvLyBJTVBST1ZFRDogQXV0by1yZWNlbnRlciBsb2dpYwogICAgICAgICAgICB0aGlzLmF1dG9SZWNlbnRlclRpbWVyICs9IHNhZmVEdDsKICAgICAgICAgICAgaWYgKHRoaXMuYXV0b1JlY2VudGVyVGltZXIgPiB0aGlzLmF1dG9SZWNlbnRlckRlbGF5KSB7CiAgICAgICAgICAgICAgICBjb25zdCByZWNlbnRlclNwZWVkID0gMi4wICogc2FmZUR0OwogICAgICAgICAgICAgICAgdGhpcy5tYW51YWxPcmJpdFlhdyAqPSAoMS4wIC0gcmVjZW50ZXJTcGVlZCk7CiAgICAgICAgICAgICAgICB0aGlzLm1hbnVhbE9yYml0UGl0Y2ggKj0gKDEuMCAtIHJlY2VudGVyU3BlZWQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBJTVBST1ZFRDogU21hcnQgcHVsbC1iYWNrIGJhc2VkIG9uIGJhbGwgc3BlZWQKICAgICAgICAgICAgaWYgKHRoaXMuYmFsbCAmJiB0aGlzLmJhbGwudmVsb2NpdHkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGJhbGxTcGVlZCA9IHRoaXMuYmFsbC52ZWxvY2l0eS5sZW5ndGgoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldFB1bGxCYWNrID0gTWF0aC5taW4odGhpcy5tYXhQdWxsQmFjaywgYmFsbFNwZWVkICogMC4zKTsKICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFB1bGxCYWNrICs9ICh0YXJnZXRQdWxsQmFjayAtIHRoaXMuY3VycmVudFB1bGxCYWNrKSAqIHNhZmVEdCAqIDMuMDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFB1bGxCYWNrICo9ICgxLjAgLSBzYWZlRHQgKiAyLjApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAxLiBVcGRhdGUgVGFyZ2V0IEluZm8KICAgICAgICAgICAgdGhpcy50YXJnZXQuZ2V0V29ybGRQb3NpdGlvbihfdGFyZ2V0V29ybGRQb3MpOwoKICAgICAgICAgICAgLy8gMi4gQ2FsY3VsYXRlIElkZWFsIFN0YXRlCiAgICAgICAgICAgIHRoaXMuX2NhbGN1bGF0ZUlkZWFsU3RhdGUoc2FmZUR0KTsKCiAgICAgICAgICAgIC8vIDMuIElNUFJPVkVEOiBGYXN0ZXIsIG1vcmUgcmVzcG9uc2l2ZSBzbW9vdGhpbmcKICAgICAgICAgICAgY29uc3QgcG9zRmFjdG9yID0gMS4wIC0gTWF0aC5leHAoLXRoaXMuY29uZmlnLmZvbGxvd1NwZWVkICogc2FmZUR0KTsKICAgICAgICAgICAgY29uc3QgbG9va0ZhY3RvciA9IDEuMCAtIE1hdGguZXhwKC10aGlzLmNvbmZpZy5sb29rU3BlZWQgKiBzYWZlRHQpOwoKICAgICAgICAgICAgdGhpcy5wb3MubGVycChfaWRlYWxQb3MsIHBvc0ZhY3Rvcik7CiAgICAgICAgICAgIHRoaXMubG9va0F0LmxlcnAoX2lkZWFsTG9vaywgbG9va0ZhY3Rvcik7CgovLyA0LiBTY3JlZW4gU2hha2UgKFBvc2l0aW9uICYgUm90YXRpb24pCiAgICAgICAgICAgIGlmICh0aGlzLnNoYWtlSW50ZW5zaXR5ID4gMCkgewogICAgICAgICAgICAgICAgY29uc3QgZGVjYXkgPSA4LjAgKiBzYWZlRHQ7IC8vIEZhc3QgZGVjYXkgZm9yIHNuYXBweSBmZWVsCiAgICAgICAgICAgICAgICB0aGlzLnNoYWtlSW50ZW5zaXR5IC09IGRlY2F5OwogICAgICAgICAgICAgICAgaWYgKHRoaXMuc2hha2VJbnRlbnNpdHkgPCAwKSB0aGlzLnNoYWtlSW50ZW5zaXR5ID0gMDsKCiAgICAgICAgICAgICAgICBjb25zdCBzaGFrZU1hZyA9IHRoaXMuc2hha2VJbnRlbnNpdHkgKiAwLjU7CiAgICAgICAgICAgICAgICB0aGlzLnNoYWtlT2Zmc2V0LnNldCgKICAgICAgICAgICAgICAgICAgICAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiBzaGFrZU1hZywKICAgICAgICAgICAgICAgICAgICAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiBzaGFrZU1hZywKICAgICAgICAgICAgICAgICAgICAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiBzaGFrZU1hZwogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuc2hha2VPZmZzZXQuc2V0KDAsIDAsIDApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBSb2xsIFNoYWtlCiAgICAgICAgICAgIGlmICh0aGlzLnNoYWtlUm9sbCA+IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuc2hha2VSb2xsIC09IDUuMCAqIHNhZmVEdDsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnNoYWtlUm9sbCA8IDApIHRoaXMuc2hha2VSb2xsID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuY2FtZXJhLnJvdGF0aW9uLnogPSAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiB0aGlzLnNoYWtlUm9sbDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuY2FtZXJhLnJvdGF0aW9uLnogPSAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyA1LiBEeW5hbWljIEZPVgogICAgICAgICAgICBjb25zdCBzcGVlZCA9IHRoaXMudGFyZ2V0VmVsLmxlbmd0aCgpOwogICAgICAgICAgICBjb25zdCBzcGVlZFJhdGlvID0gTWF0aC5taW4oc3BlZWQgLyAyMC4wLCAxLjApOwogICAgICAgICAgICBjb25zdCB3YXJwID0gc3BlZWRSYXRpbyAqIHNwZWVkUmF0aW87CgogICAgICAgICAgICBjb25zdCB0YXJnZXRGb3YgPSB0aGlzLmNvbmZpZy5mb3ZCYXNlICsgKHRoaXMuY29uZmlnLmZvdk1heCAtIHRoaXMuY29uZmlnLmZvdkJhc2UpICogd2FycCArIHRoaXMuZm92SW1wdWxzZTsKCiAgICAgICAgICAgIHRoaXMuZm92SW1wdWxzZSAqPSBNYXRoLm1heCgwLCAxLjAgLSAoNS4wICogc2FmZUR0KSk7CgogICAgICAgICAgICB0aGlzLmNhbWVyYS5mb3YgKz0gKHRhcmdldEZvdiAtIHRoaXMuY2FtZXJhLmZvdikgKiAzLjAgKiBzYWZlRHQ7CiAgICAgICAgICAgIHRoaXMuY2FtZXJhLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKCiAgICAgICAgICAgIC8vIDYuIEFwcGx5IHRvIENhbWVyYQogICAgICAgICAgICB0aGlzLmNhbWVyYS5wb3NpdGlvbi5jb3B5KHRoaXMucG9zKS5hZGQodGhpcy5zaGFrZU9mZnNldCk7CiAgICAgICAgICAgIHRoaXMuY2FtZXJhLmxvb2tBdCh0aGlzLmxvb2tBdCk7CiAgICAgICAgfQoKICAgICAgICBfY2FsY3VsYXRlSWRlYWxTdGF0ZShkdCkgewogICAgICAgICAgICBjb25zdCB0UG9zID0gX3RhcmdldFdvcmxkUG9zOwoKICAgICAgICAgICAgLy8gSU1QUk9WRUQ6IEFwcGx5IG1hbnVhbCBvcmJpdAogICAgICAgICAgICBjb25zdCBvcmJpdGVkWCA9IHRQb3MueCAqIE1hdGguY29zKHRoaXMubWFudWFsT3JiaXRZYXcpIC0gdFBvcy56ICogTWF0aC5zaW4odGhpcy5tYW51YWxPcmJpdFlhdyk7CgogICAgICAgICAgICAvLyAxLiBDYWxjdWxhdGUgSWRlYWwgUG9zaXRpb24gd2l0aCBwdWxsLWJhY2sKICAgICAgICAgICAgY29uc3QgZWZmZWN0aXZlRGlzdGFuY2UgPSB0aGlzLmNvbmZpZy5iYXNlRGlzdGFuY2UgKyB0aGlzLmN1cnJlbnRQdWxsQmFjazsKICAgICAgICAgICAgY29uc3QgZWZmZWN0aXZlSGVpZ2h0ID0gdGhpcy5jb25maWcuYmFzZUhlaWdodCArIHRoaXMuY3VycmVudFB1bGxCYWNrICogMC4zICsgdGhpcy5tYW51YWxPcmJpdFBpdGNoICogMTA7CgogICAgICAgICAgICBjb25zdCBjYW1YID0gdFBvcy54ICogMC45OwogICAgICAgICAgICBjb25zdCBjYW1ZID0gKHRQb3MueSAqIDAuMSkgKyBlZmZlY3RpdmVIZWlnaHQ7CiAgICAgICAgICAgIGxldCBjYW1aID0gdFBvcy56ICsgZWZmZWN0aXZlRGlzdGFuY2U7CgogICAgICAgICAgICAvLyBJTVBST1ZFRDogQXBwbHkgb3JiaXQgcm90YXRpb24gdG8gY2FtZXJhIHBvc2l0aW9uCiAgICAgICAgICAgIGNvbnN0IGZpbmFsQ2FtWCA9IGNhbVggKiBNYXRoLmNvcyh0aGlzLm1hbnVhbE9yYml0WWF3KSArIGVmZmVjdGl2ZURpc3RhbmNlICogTWF0aC5zaW4odGhpcy5tYW51YWxPcmJpdFlhdyk7CiAgICAgICAgICAgIGNvbnN0IGZpbmFsQ2FtWiA9IGNhbVogKiBNYXRoLmNvcyh0aGlzLm1hbnVhbE9yYml0WWF3KSAtIGNhbVggKiBNYXRoLnNpbih0aGlzLm1hbnVhbE9yYml0WWF3KTsKCiAgICAgICAgICAgIGlmIChmaW5hbENhbVogPiAzOC4wKSB7CiAgICAgICAgICAgICAgICBfaWRlYWxQb3Muc2V0KGZpbmFsQ2FtWCwgY2FtWSwgMzguMCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBfaWRlYWxQb3Muc2V0KGZpbmFsQ2FtWCwgY2FtWSwgZmluYWxDYW1aKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMi4gQ2FsY3VsYXRlIElkZWFsIExvb2tBdCB3aXRoIElNUFJPVkVEIGxvb2stYWhlYWQKICAgICAgICAgICAgX2lkZWFsTG9vay5jb3B5KHRQb3MpOwoKICAgICAgICAgICAgLy8gSU1QUk9WRUQ6IFZlbG9jaXR5LWJhc2VkIGxvb2stYWhlYWQKICAgICAgICAgICAgaWYgKHRoaXMudGFyZ2V0VmVsLmxlbmd0aFNxKCkgPiAwLjUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNwZWVkID0gdGhpcy50YXJnZXRWZWwubGVuZ3RoKCk7CiAgICAgICAgICAgICAgICBjb25zdCBsb29rQWhlYWRGYWN0b3IgPSBNYXRoLm1pbigxLjAsIHNwZWVkIC8gMTAuMCkgKiB0aGlzLmNvbmZpZy5sb29rQWhlYWREaXN0YW5jZTsKCiAgICAgICAgICAgICAgICBjb25zdCB2ZWxEaXIgPSB0aGlzLnRhcmdldFZlbC5jbG9uZSgpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgX2xvb2tBaGVhZC5jb3B5KHZlbERpcikubXVsdGlwbHlTY2FsYXIobG9va0FoZWFkRmFjdG9yKTsKCiAgICAgICAgICAgICAgICAvLyBTbW9vdGggdGhlIGxvb2stYWhlYWQKICAgICAgICAgICAgICAgIHRoaXMuc21vb3RoZWRMb29rQWhlYWQubGVycChfbG9va0FoZWFkLCBkdCAqIHRoaXMuY29uZmlnLmxvb2tBaGVhZFNtb290aGluZyk7CiAgICAgICAgICAgICAgICBfaWRlYWxMb29rLmFkZCh0aGlzLnNtb290aGVkTG9va0FoZWFkKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuc21vb3RoZWRMb29rQWhlYWQubXVsdGlwbHlTY2FsYXIoMS4wIC0gZHQgKiAyLjApOwogICAgICAgICAgICAgICAgX2lkZWFsTG9vay5hZGQodGhpcy5zbW9vdGhlZExvb2tBaGVhZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9pZGVhbExvb2sueiAtPSA1LjA7CiAgICAgICAgICAgIF9pZGVhbExvb2sueSAqPSAwLjU7CgogICAgICAgICAgICAvLyBJTVBST1ZFRDogSW5jbHVkZSBiYWxsIGluIGZyYW1pbmcgd2hlbiBuZWFyYnkKICAgICAgICAgICAgaWYgKHRoaXMuYmFsbCAmJiB0aGlzLmJhbGwubWVzaCAmJiB0aGlzLmNvbmZpZy5iYWxsVHJhY2tXZWlnaHQgPiAwKSB7CiAgICAgICAgICAgICAgICBjb25zdCBiYWxsUG9zID0gdGhpcy5iYWxsLm1lc2gucG9zaXRpb247CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0VG9CYWxsID0gdFBvcy5kaXN0YW5jZVRvKGJhbGxQb3MpOwoKICAgICAgICAgICAgICAgIGlmIChkaXN0VG9CYWxsIDwgMjAgJiYgZGlzdFRvQmFsbCA+IDIpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBiYWxsV2VpZ2h0ID0gTWF0aC5tYXgoMCwgMSAtIGRpc3RUb0JhbGwgLyAyMCkgKiB0aGlzLmNvbmZpZy5iYWxsVHJhY2tXZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgX2lkZWFsTG9vay5sZXJwKGJhbGxQb3MsIGJhbGxXZWlnaHQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAzLiBJbnB1dCBBbnRpY2lwYXRpb24gKFNtb290aGVkKQogICAgICAgICAgICB0aGlzLnNtb290aGVkSW5wdXQubGVycCh0aGlzLnRhcmdldElucHV0LCBkdCAqIDIuMCk7CgogICAgICAgICAgICBpZiAodGhpcy5zbW9vdGhlZElucHV0Lmxlbmd0aFNxKCkgPiAwLjAxKSB7CiAgICAgICAgICAgICAgICBfaWRlYWxMb29rLnggKz0gdGhpcy5zbW9vdGhlZElucHV0LnggKiAzLjA7CiAgICAgICAgICAgICAgICBfaWRlYWxMb29rLnogKz0gdGhpcy5zbW9vdGhlZElucHV0LnogKiAzLjA7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIE5FVzogR2V0IGZvcndhcmQgZGlyZWN0aW9uIGZvciBVSSByZWZlcmVuY2UKICAgICAgICBnZXRGb3J3YXJkRGlyZWN0aW9uKCkgewogICAgICAgICAgICB0aGlzLmNhbWVyYS5nZXRXb3JsZERpcmVjdGlvbihfY2FtRndkKTsKICAgICAgICAgICAgX2NhbUZ3ZC55ID0gMDsKICAgICAgICAgICAgaWYgKF9jYW1Gd2QubGVuZ3RoU3EoKSA8IDAuMDAxKSB7CiAgICAgICAgICAgICAgICBfY2FtRndkLnNldCgwLCAwLCAtMSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBfY2FtRndkLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBfY2FtRndkLmNsb25lKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBORVc6IEdldCByaWdodCBkaXJlY3Rpb24KICAgICAgICBnZXRSaWdodERpcmVjdGlvbigpIHsKICAgICAgICAgICAgY29uc3QgZndkID0gdGhpcy5nZXRGb3J3YXJkRGlyZWN0aW9uKCk7CiAgICAgICAgICAgIF9jYW1SaWdodC5jcm9zc1ZlY3RvcnMobmV3IFRIUkVFLlZlY3RvcjMoMCwgMSwgMCksIGZ3ZCkubm9ybWFsaXplKCk7CiAgICAgICAgICAgIHJldHVybiBfY2FtUmlnaHQuY2xvbmUoKTsKICAgICAgICB9CiAgICB9CgogICAgd2luZG93LmZsdXguQ2FtZXJhTWFuYWdlciA9IENhbWVyYU1hbmFnZXI7Cn0pKCk7Cg==","./CameraManager.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICAvLyBSZXVzYWJsZSB2ZWN0b3JzIHRvIGF2b2lkIEdhcmJhZ2UgQ29sbGVjdGlvbgogICAgY29uc3QgX2lkZWFsUG9zID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgIGNvbnN0IF9pZGVhbExvb2sgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgY29uc3QgX2N1cnJlbnRQb3MgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgY29uc3QgX2N1cnJlbnRMb29rID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgIGNvbnN0IF92ZWxvY2l0eSA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfdGFyZ2V0V29ybGRQb3MgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgY29uc3QgX2NhbU9mZnNldCA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfbG9va0FoZWFkID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgIGNvbnN0IF9nb2FsUG9zID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgIGNvbnN0IF9jYW1Gd2QgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgY29uc3QgX2NhbVJpZ2h0ID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKCiAgICBjbGFzcyBDYW1lcmFNYW5hZ2VyIHsKICAgICAgICBjb25zdHJ1Y3RvcihjYW1lcmEsIHNjZW5lKSB7CiAgICAgICAgICAgIHRoaXMuY2FtZXJhID0gY2FtZXJhOwogICAgICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7CgogICAgICAgICAgICAvLyAtLS0gSU1QUk9WRUQgQ09ORklHVVJBVElPTiAtLS0KICAgICAgICAgICAgdGhpcy5jb25maWcgPSB7CiAgICAgICAgICAgICAgICAvLyBGSVhFRCBQRVJTUEVDVElWRSBTRVRUSU5HUwogICAgICAgICAgICAgICAgYmFzZURpc3RhbmNlOiAyMi4wLAogICAgICAgICAgICAgICAgYmFzZUhlaWdodDogMTQuMCwKCiAgICAgICAgICAgICAgICAvLyBJTVBST1ZFRDogRmFzdGVyLCBtb3JlIHJlc3BvbnNpdmUgc21vb3RoaW5nCiAgICAgICAgICAgICAgICBmb2xsb3dTcGVlZDogNC4wLCAgICAgLy8gSW5jcmVhc2VkIGZyb20gMi41CiAgICAgICAgICAgICAgICBsb29rU3BlZWQ6IDUuMCwgICAgICAgLy8gSW5jcmVhc2VkIGZyb20gMy41CgogICAgICAgICAgICAgICAgLy8gRHluYW1pYyBGT1YKICAgICAgICAgICAgICAgIGZvdkJhc2U6IDUwLAogICAgICAgICAgICAgICAgZm92TWF4OiA2MCwKCiAgICAgICAgICAgICAgICAvLyBJTVBST1ZFRDogTG9vay1haGVhZCBzZXR0aW5ncwogICAgICAgICAgICAgICAgbG9va0FoZWFkRGlzdGFuY2U6IDYuMCwKICAgICAgICAgICAgICAgIGxvb2tBaGVhZFNtb290aGluZzogMy4wLAoKICAgICAgICAgICAgICAgIC8vIFNtYXJ0IGZyYW1pbmcKICAgICAgICAgICAgICAgIGJhbGxUcmFja1dlaWdodDogMC4zLAogICAgICAgICAgICAgICAgdGhyZWF0QXdhcmVuZXNzOiB0cnVlCiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBTdGF0ZQogICAgICAgICAgICB0aGlzLnRhcmdldCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuYmFsbCA9IG51bGw7IC8vIERpcmVjdCBiYWxsIHJlZmVyZW5jZSBmb3Igc21hcnQgZnJhbWluZwogICAgICAgICAgICB0aGlzLnRhcmdldFZlbCA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICAgICAgICAgIHRoaXMudGFyZ2V0SW5wdXQgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgICAgICAgICB0aGlzLnNtb290aGVkSW5wdXQgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgICAgICAgICB0aGlzLnNtb290aGVkTG9va0FoZWFkID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKCiAgICAgICAgICAgIC8vIENhbWVyYSBTdGF0ZQogICAgICAgICAgICB0aGlzLnBvcyA9IGNhbWVyYS5wb3NpdGlvbi5jbG9uZSgpOwogICAgICAgICAgICB0aGlzLmxvb2tBdCA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIDApOwoKICAgICAgICAgICAgLy8gT3JiaXQgU3RhdGUKICAgICAgICAgICAgdGhpcy5jdXJyZW50WWF3ID0gTWF0aC5QSTsKICAgICAgICAgICAgdGhpcy50YXJnZXRZYXcgPSBNYXRoLlBJOwoKICAgICAgICAgICAgLy8gSU1QUk9WRUQ6IE1hbnVhbCBvcmJpdCBmcm9tIHRvdWNoIChyaWdodCBzaWRlIG9mIHNjcmVlbikKICAgICAgICAgICAgdGhpcy5tYW51YWxPcmJpdFlhdyA9IDA7CiAgICAgICAgICAgIHRoaXMubWFudWFsT3JiaXRQaXRjaCA9IDA7CiAgICAgICAgICAgIHRoaXMub3JiaXRTZW5zaXRpdml0eSA9IDAuMDA0OwogICAgICAgICAgICB0aGlzLmF1dG9SZWNlbnRlclRpbWVyID0gMDsKICAgICAgICAgICAgdGhpcy5hdXRvUmVjZW50ZXJEZWxheSA9IDMuMDsKCi8vIFNoYWtlCiAgICAgICAgICAgIHRoaXMuc2hha2VJbnRlbnNpdHkgPSAwOwogICAgICAgICAgICB0aGlzLnNoYWtlUm9sbCA9IDA7IC8vIE5FVzogUm90YXRpb25hbCBzaGFrZQogICAgICAgICAgICB0aGlzLnNoYWtlT2Zmc2V0ID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgICAgICAgICAgdGhpcy5mb3ZJbXB1bHNlID0gMDsKCiAgICAgICAgICAgIC8vIENpbmVtYXRpYyBTdGF0ZQogICAgICAgICAgICB0aGlzLmlzQ2luZW1hdGljID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuY2luZW1hdGljVGltZXIgPSAwOwogICAgICAgICAgICB0aGlzLmNpbmVtYXRpY0R1cmF0aW9uID0gMDsKICAgICAgICAgICAgdGhpcy5jaW5lbWF0aWNUeXBlID0gJ2RlZmF1bHQnOwogICAgICAgICAgICB0aGlzLmNpbmVtYXRpY1N0YXJ0UG9zID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgICAgICAgICAgdGhpcy5jaW5lbWF0aWNTdGFydExvb2sgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgICAgICAgICB0aGlzLmNpbmVtYXRpY0VuZFBvcyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CgogICAgICAgICAgICAvLyBJTVBST1ZFRDogRHluYW1pYyBwdWxsLWJhY2sgYmFzZWQgb24gYWN0aW9uCiAgICAgICAgICAgIHRoaXMuY3VycmVudFB1bGxCYWNrID0gMDsKICAgICAgICAgICAgdGhpcy5tYXhQdWxsQmFjayA9IDg7CiAgICAgICAgfQoKICAgICAgICAvLyBORVc6IFNldCBiYWxsIHJlZmVyZW5jZSBmb3Igc21hcnQgZnJhbWluZwogICAgICAgIHNldEJhbGwoYmFsbCkgewogICAgICAgICAgICB0aGlzLmJhbGwgPSBiYWxsOwogICAgICAgIH0KCiAgICAgICAgLy8gSU1QUk9WRUQ6IEdldCBjYW1lcmEtcmVsYXRpdmUgaW5wdXQgdHJhbnNmb3JtYXRpb24KICAgICAgICBnZXRDYW1lcmFSZWxhdGl2ZUlucHV0KGlucHV0WCwgaW5wdXRaKSB7CiAgICAgICAgICAgIHRoaXMuY2FtZXJhLmdldFdvcmxkRGlyZWN0aW9uKF9jYW1Gd2QpOwogICAgICAgICAgICBfY2FtRndkLnkgPSAwOwoKICAgICAgICAgICAgaWYgKF9jYW1Gd2QubGVuZ3RoU3EoKSA8IDAuMDAxKSB7CiAgICAgICAgICAgICAgICBfY2FtRndkLnNldCgwLCAwLCAtMSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBfY2FtRndkLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfY2FtUmlnaHQuY3Jvc3NWZWN0b3JzKG5ldyBUSFJFRS5WZWN0b3IzKDAsIDEsIDApLCBfY2FtRndkKS5ub3JtYWxpemUoKTsKCiAgICAgICAgICAgIC8vIFRyYW5zZm9ybSBpbnB1dCB0byB3b3JsZCBzcGFjZQogICAgICAgICAgICBjb25zdCB3b3JsZFggPSAoaW5wdXRYICogX2NhbVJpZ2h0LngpICsgKGlucHV0WiAqIF9jYW1Gd2QueCk7CiAgICAgICAgICAgIGNvbnN0IHdvcmxkWiA9IChpbnB1dFggKiBfY2FtUmlnaHQueikgKyAoaW5wdXRaICogX2NhbUZ3ZC56KTsKCiAgICAgICAgICAgIHJldHVybiB7IHg6IHdvcmxkWCwgejogd29ybGRaIH07CiAgICAgICAgfQoKICAgICAgICAvLyBORVc6IE1hbnVhbCBvcmJpdCBpbnB1dCBmcm9tIHRvdWNoCiAgICAgICAgaGFuZGxlT3JiaXRJbnB1dChkeCwgZHkpIHsKICAgICAgICAgICAgdGhpcy5tYW51YWxPcmJpdFlhdyArPSBkeCAqIHRoaXMub3JiaXRTZW5zaXRpdml0eTsKICAgICAgICAgICAgdGhpcy5tYW51YWxPcmJpdFBpdGNoICs9IGR5ICogdGhpcy5vcmJpdFNlbnNpdGl2aXR5ICogMC41OwoKICAgICAgICAgICAgLy8gQ2xhbXAgcGl0Y2gKICAgICAgICAgICAgdGhpcy5tYW51YWxPcmJpdFBpdGNoID0gTWF0aC5tYXgoLTAuMywgTWF0aC5taW4oMC41LCB0aGlzLm1hbnVhbE9yYml0UGl0Y2gpKTsKCiAgICAgICAgICAgIC8vIFJlc2V0IGF1dG8tcmVjZW50ZXIgdGltZXIKICAgICAgICAgICAgdGhpcy5hdXRvUmVjZW50ZXJUaW1lciA9IDA7CiAgICAgICAgfQoKICAgICAgICAvLyBORVc6IFJlY2VudGVyIGNhbWVyYQogICAgICAgIHJlY2VudGVyKCkgewogICAgICAgICAgICB0aGlzLm1hbnVhbE9yYml0WWF3ID0gMDsKICAgICAgICAgICAgdGhpcy5tYW51YWxPcmJpdFBpdGNoID0gMDsKICAgICAgICB9CgogICAgICAgIHBsYXlDaW5lbWF0aWModHlwZSwgdGFyZ2V0LCBkdXJhdGlvbiA9IDEuNSkgewogICAgICAgICAgICB0aGlzLmlzQ2luZW1hdGljID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5jaW5lbWF0aWNUaW1lciA9IDA7CiAgICAgICAgICAgIHRoaXMuY2luZW1hdGljRHVyYXRpb24gPSBkdXJhdGlvbjsKICAgICAgICAgICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7CiAgICAgICAgICAgIHRoaXMuY2luZW1hdGljVHlwZSA9IHR5cGU7CgogICAgICAgICAgICB0aGlzLmNpbmVtYXRpY1N0YXJ0UG9zLmNvcHkodGhpcy5wb3MpOwogICAgICAgICAgICB0aGlzLmNpbmVtYXRpY1N0YXJ0TG9vay5jb3B5KHRoaXMubG9va0F0KTsKCiAgICAgICAgICAgIHRoaXMuYWRkRm92SW1wdWxzZSgtMTUpOwogICAgICAgIH0KCiAgICAgICAgX3VwZGF0ZUNpbmVtYXRpYyhkdCkgewogICAgICAgICAgICB0aGlzLmNpbmVtYXRpY1RpbWVyICs9IGR0OwogICAgICAgICAgICBjb25zdCBwcm9ncmVzcyA9IE1hdGgubWluKDEuMCwgdGhpcy5jaW5lbWF0aWNUaW1lciAvIHRoaXMuY2luZW1hdGljRHVyYXRpb24pOwoKICAgICAgICAgICAgY29uc3QgdCA9IDEgLSBNYXRoLnBvdygxIC0gcHJvZ3Jlc3MsIDMpOwoKICAgICAgICAgICAgbGV0IGFjdGl2ZVRhcmdldCA9IHRoaXMudGFyZ2V0OwogICAgICAgICAgICBsZXQgaXNCYWxsVHJhY2tpbmcgPSBmYWxzZTsKICAgICAgICAgICAgY29uc3QgYmFsbCA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSA/IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5lbnRpdGllcy5iYWxsIDogbnVsbDsKCiAgICAgICAgICAgIGlmIChiYWxsICYmIGJhbGwubWVzaCAmJiBiYWxsLnN0YXRlID09PSAnZnJlZScgJiYgYmFsbC52ZWxvY2l0eS5sZW5ndGhTcSgpID4gMi4wKSB7CiAgICAgICAgICAgICAgICBhY3RpdmVUYXJnZXQgPSBiYWxsLm1lc2g7CiAgICAgICAgICAgICAgICBpc0JhbGxUcmFja2luZyA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghYWN0aXZlVGFyZ2V0KSB7CiAgICAgICAgICAgICAgICB0aGlzLmlzQ2luZW1hdGljID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGFjdGl2ZVRhcmdldC5nZXRXb3JsZFBvc2l0aW9uKF90YXJnZXRXb3JsZFBvcyk7CgogICAgICAgICAgICBjb25zdCBlbmRMb29rID0gX3RhcmdldFdvcmxkUG9zLmNsb25lKCk7CiAgICAgICAgICAgIGxldCBmd2QgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgICAgICAgICBsZXQgcmlnaHQgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwoKICAgICAgICAgICAgaWYgKGlzQmFsbFRyYWNraW5nKSB7CiAgICAgICAgICAgICAgICBlbmRMb29rLmFkZFNjYWxlZFZlY3RvcihiYWxsLnZlbG9jaXR5LCAwLjMpOwoKICAgICAgICAgICAgICAgIGZ3ZC5jb3B5KGJhbGwudmVsb2NpdHkpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgZndkLnkgPSAwOwogICAgICAgICAgICAgICAgaWYgKGZ3ZC5sZW5ndGhTcSgpIDwgMC4wMSkgZndkLnNldCgwLDAsMSk7CiAgICAgICAgICAgICAgICBmd2Qubm9ybWFsaXplKCk7CgogICAgICAgICAgICAgICAgcmlnaHQuY3Jvc3NWZWN0b3JzKG5ldyBUSFJFRS5WZWN0b3IzKDAsMSwwKSwgZndkKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGVuZExvb2sueSArPSAxLjU7CiAgICAgICAgICAgICAgICBmd2Quc2V0KDAsIDAsIDEpLmFwcGx5UXVhdGVybmlvbihhY3RpdmVUYXJnZXQucXVhdGVybmlvbik7CiAgICAgICAgICAgICAgICByaWdodC5zZXQoMSwgMCwgMCkuYXBwbHlRdWF0ZXJuaW9uKGFjdGl2ZVRhcmdldC5xdWF0ZXJuaW9uKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgZW5kUG9zID0gX3RhcmdldFdvcmxkUG9zLmNsb25lKCk7CgogICAgICAgICAgICBpZiAodGhpcy5jaW5lbWF0aWNUeXBlID09PSAnamVjaHQnKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gaXNCYWxsVHJhY2tpbmcgPyAxNC4wIDogMTAuMDsKICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IGZ3ZC5jbG9uZSgpLm11bHRpcGx5U2NhbGFyKC1kaXN0KS5hZGQocmlnaHQuY2xvbmUoKS5tdWx0aXBseVNjYWxhcigzLjApKTsKICAgICAgICAgICAgICAgIGVuZFBvcy5hZGQob2Zmc2V0KTsKICAgICAgICAgICAgICAgIGVuZFBvcy55ICs9IDYuMDsKICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmNpbmVtYXRpY1R5cGUgPT09ICdzcGhlcmUnKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gaXNCYWxsVHJhY2tpbmcgPyAxNi4wIDogMTIuMDsKICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IGZ3ZC5jbG9uZSgpLm11bHRpcGx5U2NhbGFyKC1kaXN0KTsKICAgICAgICAgICAgICAgIGVuZFBvcy5hZGQob2Zmc2V0KTsKICAgICAgICAgICAgICAgIGVuZFBvcy55ICs9IDEwLjA7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5jaW5lbWF0aWNUeXBlID09PSAnaW52aXNpYmxlJykgewogICAgICAgICAgICAgICAgY29uc3QgZGlzdCA9IDEyLjA7CiAgICAgICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBmd2QuY2xvbmUoKS5tdWx0aXBseVNjYWxhcigtZGlzdCAqIDAuNSkuYWRkKHJpZ2h0LmNsb25lKCkubXVsdGlwbHlTY2FsYXIoZGlzdCkpOwogICAgICAgICAgICAgICAgZW5kUG9zLmFkZChvZmZzZXQpOwogICAgICAgICAgICAgICAgZW5kUG9zLnkgKz0gNS4wOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgZGlzdCA9IGlzQmFsbFRyYWNraW5nID8gMTQuMCA6IDEwLjA7CiAgICAgICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBmd2QuY2xvbmUoKS5tdWx0aXBseVNjYWxhcigtZGlzdCk7CiAgICAgICAgICAgICAgICBlbmRQb3MuYWRkKG9mZnNldCk7CiAgICAgICAgICAgICAgICBlbmRQb3MueSArPSA1LjA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMucG9zLmxlcnAoZW5kUG9zLCBkdCAqIDQuMCk7CiAgICAgICAgICAgIHRoaXMubG9va0F0LmxlcnAoZW5kTG9vaywgZHQgKiA2LjApOwoKICAgICAgICAgICAgdGhpcy5jYW1lcmEucG9zaXRpb24uY29weSh0aGlzLnBvcyk7CiAgICAgICAgICAgIHRoaXMuY2FtZXJhLmxvb2tBdCh0aGlzLmxvb2tBdCk7CgogICAgICAgICAgICBpZiAodGhpcy5jaW5lbWF0aWNUaW1lciA+PSB0aGlzLmNpbmVtYXRpY0R1cmF0aW9uKSB7CiAgICAgICAgICAgICAgICB0aGlzLmlzQ2luZW1hdGljID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHNldFRhcmdldChtZXNoLCB2ZWxvY2l0eSwgaW5wdXQpIHsKICAgICAgICAgICAgdGhpcy50YXJnZXQgPSBtZXNoOwogICAgICAgICAgICBpZiAodmVsb2NpdHkpIHRoaXMudGFyZ2V0VmVsLmNvcHkodmVsb2NpdHkpOwogICAgICAgICAgICBpZiAoaW5wdXQpIHRoaXMudGFyZ2V0SW5wdXQuY29weShpbnB1dCk7CiAgICAgICAgICAgIGVsc2UgdGhpcy50YXJnZXRJbnB1dC5zZXQoMCwgMCwgMCk7CiAgICAgICAgfQoKICAgICAgICAvLyBLZWVwIGZvciBjb21wYXRpYmlsaXR5CiAgICAgICAgaGFuZGxlSW5wdXQoZHgsIGR5KSB7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlT3JiaXRJbnB1dChkeCwgZHkpOwogICAgICAgIH0KCiAgICAgICAgZ2V0WWF3KCkgeyByZXR1cm4gdGhpcy5jdXJyZW50WWF3OyB9CgogICAgICAgIGFkZFNoYWtlKGFtb3VudCkgewoKICAgICAgICAgICAgdGhpcy5zaGFrZUludGVuc2l0eSA9IE1hdGgubWluKHRoaXMuc2hha2VJbnRlbnNpdHkgKyBhbW91bnQsIDQuMCk7IC8vIEluY3JlYXNlZCBjYXAKICAgICAgICAgICAgdGhpcy5zaGFrZVJvbGwgPSBNYXRoLm1pbih0aGlzLnNoYWtlUm9sbCArIGFtb3VudCAqIDAuMiwgMC44KTsgLy8gQWRkIHJvbGwKICAgICAgICB9CiAgICAgICAgYWRkRm92SW1wdWxzZShhbW91bnQpIHsKICAgICAgICAgICAgdGhpcy5mb3ZJbXB1bHNlID0gTWF0aC5taW4odGhpcy5mb3ZJbXB1bHNlICsgYW1vdW50LCAzMCk7CiAgICAgICAgfQoKICAgICAgICBzbmFwVG9UYXJnZXQoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy50YXJnZXQpIHJldHVybjsKICAgICAgICAgICAgdGhpcy50YXJnZXQuZ2V0V29ybGRQb3NpdGlvbihfdGFyZ2V0V29ybGRQb3MpOwoKICAgICAgICAgICAgdGhpcy5fY2FsY3VsYXRlSWRlYWxTdGF0ZSgwKTsKCiAgICAgICAgICAgIHRoaXMucG9zLmNvcHkoX2lkZWFsUG9zKTsKICAgICAgICAgICAgdGhpcy5sb29rQXQuY29weShfaWRlYWxMb29rKTsKICAgICAgICAgICAgdGhpcy5jdXJyZW50WWF3ID0gdGhpcy50YXJnZXRZYXc7CgogICAgICAgICAgICB0aGlzLmNhbWVyYS5wb3NpdGlvbi5jb3B5KHRoaXMucG9zKTsKICAgICAgICAgICAgdGhpcy5jYW1lcmEubG9va0F0KHRoaXMubG9va0F0KTsKCiAgICAgICAgICAgIHRoaXMuc21vb3RoZWRJbnB1dC5zZXQoMCwgMCwgMCk7CiAgICAgICAgICAgIHRoaXMuc21vb3RoZWRMb29rQWhlYWQuc2V0KDAsIDAsIDApOwogICAgICAgIH0KCiAgICAgICAgdXBkYXRlKGR0KSB7CiAgICAgICAgICAgIGlmICh0aGlzLmlzQ2luZW1hdGljKSB7CiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVDaW5lbWF0aWMoZHQpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIXRoaXMudGFyZ2V0KSByZXR1cm47CgogICAgICAgICAgICBjb25zdCBzYWZlRHQgPSBNYXRoLm1pbihkdCwgMC4wNSk7CgogICAgICAgICAgICAvLyBJTVBST1ZFRDogQXV0by1yZWNlbnRlciBsb2dpYwogICAgICAgICAgICB0aGlzLmF1dG9SZWNlbnRlclRpbWVyICs9IHNhZmVEdDsKICAgICAgICAgICAgaWYgKHRoaXMuYXV0b1JlY2VudGVyVGltZXIgPiB0aGlzLmF1dG9SZWNlbnRlckRlbGF5KSB7CiAgICAgICAgICAgICAgICBjb25zdCByZWNlbnRlclNwZWVkID0gMi4wICogc2FmZUR0OwogICAgICAgICAgICAgICAgdGhpcy5tYW51YWxPcmJpdFlhdyAqPSAoMS4wIC0gcmVjZW50ZXJTcGVlZCk7CiAgICAgICAgICAgICAgICB0aGlzLm1hbnVhbE9yYml0UGl0Y2ggKj0gKDEuMCAtIHJlY2VudGVyU3BlZWQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBJTVBST1ZFRDogU21hcnQgcHVsbC1iYWNrIGJhc2VkIG9uIGJhbGwgc3BlZWQKICAgICAgICAgICAgaWYgKHRoaXMuYmFsbCAmJiB0aGlzLmJhbGwudmVsb2NpdHkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGJhbGxTcGVlZCA9IHRoaXMuYmFsbC52ZWxvY2l0eS5sZW5ndGgoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldFB1bGxCYWNrID0gTWF0aC5taW4odGhpcy5tYXhQdWxsQmFjaywgYmFsbFNwZWVkICogMC4zKTsKICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFB1bGxCYWNrICs9ICh0YXJnZXRQdWxsQmFjayAtIHRoaXMuY3VycmVudFB1bGxCYWNrKSAqIHNhZmVEdCAqIDMuMDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFB1bGxCYWNrICo9ICgxLjAgLSBzYWZlRHQgKiAyLjApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAxLiBVcGRhdGUgVGFyZ2V0IEluZm8KICAgICAgICAgICAgdGhpcy50YXJnZXQuZ2V0V29ybGRQb3NpdGlvbihfdGFyZ2V0V29ybGRQb3MpOwoKICAgICAgICAgICAgLy8gMi4gQ2FsY3VsYXRlIElkZWFsIFN0YXRlCiAgICAgICAgICAgIHRoaXMuX2NhbGN1bGF0ZUlkZWFsU3RhdGUoc2FmZUR0KTsKCiAgICAgICAgICAgIC8vIDMuIElNUFJPVkVEOiBGYXN0ZXIsIG1vcmUgcmVzcG9uc2l2ZSBzbW9vdGhpbmcKICAgICAgICAgICAgY29uc3QgcG9zRmFjdG9yID0gMS4wIC0gTWF0aC5leHAoLXRoaXMuY29uZmlnLmZvbGxvd1NwZWVkICogc2FmZUR0KTsKICAgICAgICAgICAgY29uc3QgbG9va0ZhY3RvciA9IDEuMCAtIE1hdGguZXhwKC10aGlzLmNvbmZpZy5sb29rU3BlZWQgKiBzYWZlRHQpOwoKICAgICAgICAgICAgdGhpcy5wb3MubGVycChfaWRlYWxQb3MsIHBvc0ZhY3Rvcik7CiAgICAgICAgICAgIHRoaXMubG9va0F0LmxlcnAoX2lkZWFsTG9vaywgbG9va0ZhY3Rvcik7CgovLyA0LiBTY3JlZW4gU2hha2UgKFBvc2l0aW9uICYgUm90YXRpb24pCiAgICAgICAgICAgIGlmICh0aGlzLnNoYWtlSW50ZW5zaXR5ID4gMCkgewogICAgICAgICAgICAgICAgY29uc3QgZGVjYXkgPSA4LjAgKiBzYWZlRHQ7IC8vIEZhc3QgZGVjYXkgZm9yIHNuYXBweSBmZWVsCiAgICAgICAgICAgICAgICB0aGlzLnNoYWtlSW50ZW5zaXR5IC09IGRlY2F5OwogICAgICAgICAgICAgICAgaWYgKHRoaXMuc2hha2VJbnRlbnNpdHkgPCAwKSB0aGlzLnNoYWtlSW50ZW5zaXR5ID0gMDsKCiAgICAgICAgICAgICAgICBjb25zdCBzaGFrZU1hZyA9IHRoaXMuc2hha2VJbnRlbnNpdHkgKiAwLjU7CiAgICAgICAgICAgICAgICB0aGlzLnNoYWtlT2Zmc2V0LnNldCgKICAgICAgICAgICAgICAgICAgICAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiBzaGFrZU1hZywKICAgICAgICAgICAgICAgICAgICAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiBzaGFrZU1hZywKICAgICAgICAgICAgICAgICAgICAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiBzaGFrZU1hZwogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuc2hha2VPZmZzZXQuc2V0KDAsIDAsIDApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBSb2xsIFNoYWtlCiAgICAgICAgICAgIGlmICh0aGlzLnNoYWtlUm9sbCA+IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuc2hha2VSb2xsIC09IDUuMCAqIHNhZmVEdDsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnNoYWtlUm9sbCA8IDApIHRoaXMuc2hha2VSb2xsID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuY2FtZXJhLnJvdGF0aW9uLnogPSAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiB0aGlzLnNoYWtlUm9sbDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuY2FtZXJhLnJvdGF0aW9uLnogPSAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyA1LiBEeW5hbWljIEZPVgogICAgICAgICAgICBjb25zdCBzcGVlZCA9IHRoaXMudGFyZ2V0VmVsLmxlbmd0aCgpOwogICAgICAgICAgICBjb25zdCBzcGVlZFJhdGlvID0gTWF0aC5taW4oc3BlZWQgLyAyMC4wLCAxLjApOwogICAgICAgICAgICBjb25zdCB3YXJwID0gc3BlZWRSYXRpbyAqIHNwZWVkUmF0aW87CgogICAgICAgICAgICBjb25zdCB0YXJnZXRGb3YgPSB0aGlzLmNvbmZpZy5mb3ZCYXNlICsgKHRoaXMuY29uZmlnLmZvdk1heCAtIHRoaXMuY29uZmlnLmZvdkJhc2UpICogd2FycCArIHRoaXMuZm92SW1wdWxzZTsKCiAgICAgICAgICAgIHRoaXMuZm92SW1wdWxzZSAqPSBNYXRoLm1heCgwLCAxLjAgLSAoNS4wICogc2FmZUR0KSk7CgogICAgICAgICAgICB0aGlzLmNhbWVyYS5mb3YgKz0gKHRhcmdldEZvdiAtIHRoaXMuY2FtZXJhLmZvdikgKiAzLjAgKiBzYWZlRHQ7CiAgICAgICAgICAgIHRoaXMuY2FtZXJhLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKCiAgICAgICAgICAgIC8vIDYuIEFwcGx5IHRvIENhbWVyYQogICAgICAgICAgICB0aGlzLmNhbWVyYS5wb3NpdGlvbi5jb3B5KHRoaXMucG9zKS5hZGQodGhpcy5zaGFrZU9mZnNldCk7CiAgICAgICAgICAgIHRoaXMuY2FtZXJhLmxvb2tBdCh0aGlzLmxvb2tBdCk7CiAgICAgICAgfQoKICAgICAgICBfY2FsY3VsYXRlSWRlYWxTdGF0ZShkdCkgewogICAgICAgICAgICBjb25zdCB0UG9zID0gX3RhcmdldFdvcmxkUG9zOwoKICAgICAgICAgICAgLy8gSU1QUk9WRUQ6IEFwcGx5IG1hbnVhbCBvcmJpdAogICAgICAgICAgICBjb25zdCBvcmJpdGVkWCA9IHRQb3MueCAqIE1hdGguY29zKHRoaXMubWFudWFsT3JiaXRZYXcpIC0gdFBvcy56ICogTWF0aC5zaW4odGhpcy5tYW51YWxPcmJpdFlhdyk7CgogICAgICAgICAgICAvLyAxLiBDYWxjdWxhdGUgSWRlYWwgUG9zaXRpb24gd2l0aCBwdWxsLWJhY2sKICAgICAgICAgICAgY29uc3QgZWZmZWN0aXZlRGlzdGFuY2UgPSB0aGlzLmNvbmZpZy5iYXNlRGlzdGFuY2UgKyB0aGlzLmN1cnJlbnRQdWxsQmFjazsKICAgICAgICAgICAgY29uc3QgZWZmZWN0aXZlSGVpZ2h0ID0gdGhpcy5jb25maWcuYmFzZUhlaWdodCArIHRoaXMuY3VycmVudFB1bGxCYWNrICogMC4zICsgdGhpcy5tYW51YWxPcmJpdFBpdGNoICogMTA7CgogICAgICAgICAgICBjb25zdCBjYW1YID0gdFBvcy54ICogMC45OwogICAgICAgICAgICBjb25zdCBjYW1ZID0gKHRQb3MueSAqIDAuMSkgKyBlZmZlY3RpdmVIZWlnaHQ7CiAgICAgICAgICAgIGxldCBjYW1aID0gdFBvcy56ICsgZWZmZWN0aXZlRGlzdGFuY2U7CgogICAgICAgICAgICAvLyBJTVBST1ZFRDogQXBwbHkgb3JiaXQgcm90YXRpb24gdG8gY2FtZXJhIHBvc2l0aW9uCiAgICAgICAgICAgIGNvbnN0IGZpbmFsQ2FtWCA9IGNhbVggKiBNYXRoLmNvcyh0aGlzLm1hbnVhbE9yYml0WWF3KSArIGVmZmVjdGl2ZURpc3RhbmNlICogTWF0aC5zaW4odGhpcy5tYW51YWxPcmJpdFlhdyk7CiAgICAgICAgICAgIGNvbnN0IGZpbmFsQ2FtWiA9IGNhbVogKiBNYXRoLmNvcyh0aGlzLm1hbnVhbE9yYml0WWF3KSAtIGNhbVggKiBNYXRoLnNpbih0aGlzLm1hbnVhbE9yYml0WWF3KTsKCiAgICAgICAgICAgIGlmIChmaW5hbENhbVogPiAzOC4wKSB7CiAgICAgICAgICAgICAgICBfaWRlYWxQb3Muc2V0KGZpbmFsQ2FtWCwgY2FtWSwgMzguMCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBfaWRlYWxQb3Muc2V0KGZpbmFsQ2FtWCwgY2FtWSwgZmluYWxDYW1aKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMi4gQ2FsY3VsYXRlIElkZWFsIExvb2tBdCB3aXRoIElNUFJPVkVEIGxvb2stYWhlYWQKICAgICAgICAgICAgX2lkZWFsTG9vay5jb3B5KHRQb3MpOwoKICAgICAgICAgICAgLy8gSU1QUk9WRUQ6IFZlbG9jaXR5LWJhc2VkIGxvb2stYWhlYWQKICAgICAgICAgICAgaWYgKHRoaXMudGFyZ2V0VmVsLmxlbmd0aFNxKCkgPiAwLjUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNwZWVkID0gdGhpcy50YXJnZXRWZWwubGVuZ3RoKCk7CiAgICAgICAgICAgICAgICBjb25zdCBsb29rQWhlYWRGYWN0b3IgPSBNYXRoLm1pbigxLjAsIHNwZWVkIC8gMTAuMCkgKiB0aGlzLmNvbmZpZy5sb29rQWhlYWREaXN0YW5jZTsKCiAgICAgICAgICAgICAgICBjb25zdCB2ZWxEaXIgPSB0aGlzLnRhcmdldFZlbC5jbG9uZSgpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgX2xvb2tBaGVhZC5jb3B5KHZlbERpcikubXVsdGlwbHlTY2FsYXIobG9va0FoZWFkRmFjdG9yKTsKCiAgICAgICAgICAgICAgICAvLyBTbW9vdGggdGhlIGxvb2stYWhlYWQKICAgICAgICAgICAgICAgIHRoaXMuc21vb3RoZWRMb29rQWhlYWQubGVycChfbG9va0FoZWFkLCBkdCAqIHRoaXMuY29uZmlnLmxvb2tBaGVhZFNtb290aGluZyk7CiAgICAgICAgICAgICAgICBfaWRlYWxMb29rLmFkZCh0aGlzLnNtb290aGVkTG9va0FoZWFkKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuc21vb3RoZWRMb29rQWhlYWQubXVsdGlwbHlTY2FsYXIoMS4wIC0gZHQgKiAyLjApOwogICAgICAgICAgICAgICAgX2lkZWFsTG9vay5hZGQodGhpcy5zbW9vdGhlZExvb2tBaGVhZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9pZGVhbExvb2sueiAtPSA1LjA7CiAgICAgICAgICAgIF9pZGVhbExvb2sueSAqPSAwLjU7CgogICAgICAgICAgICAvLyBJTVBST1ZFRDogSW5jbHVkZSBiYWxsIGluIGZyYW1pbmcgd2hlbiBuZWFyYnkKICAgICAgICAgICAgaWYgKHRoaXMuYmFsbCAmJiB0aGlzLmJhbGwubWVzaCAmJiB0aGlzLmNvbmZpZy5iYWxsVHJhY2tXZWlnaHQgPiAwKSB7CiAgICAgICAgICAgICAgICBjb25zdCBiYWxsUG9zID0gdGhpcy5iYWxsLm1lc2gucG9zaXRpb247CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0VG9CYWxsID0gdFBvcy5kaXN0YW5jZVRvKGJhbGxQb3MpOwoKICAgICAgICAgICAgICAgIGlmIChkaXN0VG9CYWxsIDwgMjAgJiYgZGlzdFRvQmFsbCA+IDIpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBiYWxsV2VpZ2h0ID0gTWF0aC5tYXgoMCwgMSAtIGRpc3RUb0JhbGwgLyAyMCkgKiB0aGlzLmNvbmZpZy5iYWxsVHJhY2tXZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgX2lkZWFsTG9vay5sZXJwKGJhbGxQb3MsIGJhbGxXZWlnaHQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAzLiBJbnB1dCBBbnRpY2lwYXRpb24gKFNtb290aGVkKQogICAgICAgICAgICB0aGlzLnNtb290aGVkSW5wdXQubGVycCh0aGlzLnRhcmdldElucHV0LCBkdCAqIDIuMCk7CgogICAgICAgICAgICBpZiAodGhpcy5zbW9vdGhlZElucHV0Lmxlbmd0aFNxKCkgPiAwLjAxKSB7CiAgICAgICAgICAgICAgICBfaWRlYWxMb29rLnggKz0gdGhpcy5zbW9vdGhlZElucHV0LnggKiAzLjA7CiAgICAgICAgICAgICAgICBfaWRlYWxMb29rLnogKz0gdGhpcy5zbW9vdGhlZElucHV0LnogKiAzLjA7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIE5FVzogR2V0IGZvcndhcmQgZGlyZWN0aW9uIGZvciBVSSByZWZlcmVuY2UKICAgICAgICBnZXRGb3J3YXJkRGlyZWN0aW9uKCkgewogICAgICAgICAgICB0aGlzLmNhbWVyYS5nZXRXb3JsZERpcmVjdGlvbihfY2FtRndkKTsKICAgICAgICAgICAgX2NhbUZ3ZC55ID0gMDsKICAgICAgICAgICAgaWYgKF9jYW1Gd2QubGVuZ3RoU3EoKSA8IDAuMDAxKSB7CiAgICAgICAgICAgICAgICBfY2FtRndkLnNldCgwLCAwLCAtMSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBfY2FtRndkLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBfY2FtRndkLmNsb25lKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBORVc6IEdldCByaWdodCBkaXJlY3Rpb24KICAgICAgICBnZXRSaWdodERpcmVjdGlvbigpIHsKICAgICAgICAgICAgY29uc3QgZndkID0gdGhpcy5nZXRGb3J3YXJkRGlyZWN0aW9uKCk7CiAgICAgICAgICAgIF9jYW1SaWdodC5jcm9zc1ZlY3RvcnMobmV3IFRIUkVFLlZlY3RvcjMoMCwgMSwgMCksIGZ3ZCkubm9ybWFsaXplKCk7CiAgICAgICAgICAgIHJldHVybiBfY2FtUmlnaHQuY2xvbmUoKTsKICAgICAgICB9CiAgICB9CgogICAgd2luZG93LmZsdXguQ2FtZXJhTWFuYWdlciA9IENhbWVyYU1hbmFnZXI7Cn0pKCk7Cg==","/CameraManager.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICAvLyBSZXVzYWJsZSB2ZWN0b3JzIHRvIGF2b2lkIEdhcmJhZ2UgQ29sbGVjdGlvbgogICAgY29uc3QgX2lkZWFsUG9zID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgIGNvbnN0IF9pZGVhbExvb2sgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgY29uc3QgX2N1cnJlbnRQb3MgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgY29uc3QgX2N1cnJlbnRMb29rID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgIGNvbnN0IF92ZWxvY2l0eSA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfdGFyZ2V0V29ybGRQb3MgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgY29uc3QgX2NhbU9mZnNldCA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICBjb25zdCBfbG9va0FoZWFkID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgIGNvbnN0IF9nb2FsUG9zID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgIGNvbnN0IF9jYW1Gd2QgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgY29uc3QgX2NhbVJpZ2h0ID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKCiAgICBjbGFzcyBDYW1lcmFNYW5hZ2VyIHsKICAgICAgICBjb25zdHJ1Y3RvcihjYW1lcmEsIHNjZW5lKSB7CiAgICAgICAgICAgIHRoaXMuY2FtZXJhID0gY2FtZXJhOwogICAgICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7CgogICAgICAgICAgICAvLyAtLS0gSU1QUk9WRUQgQ09ORklHVVJBVElPTiAtLS0KICAgICAgICAgICAgdGhpcy5jb25maWcgPSB7CiAgICAgICAgICAgICAgICAvLyBGSVhFRCBQRVJTUEVDVElWRSBTRVRUSU5HUwogICAgICAgICAgICAgICAgYmFzZURpc3RhbmNlOiAyMi4wLAogICAgICAgICAgICAgICAgYmFzZUhlaWdodDogMTQuMCwKCiAgICAgICAgICAgICAgICAvLyBJTVBST1ZFRDogRmFzdGVyLCBtb3JlIHJlc3BvbnNpdmUgc21vb3RoaW5nCiAgICAgICAgICAgICAgICBmb2xsb3dTcGVlZDogNC4wLCAgICAgLy8gSW5jcmVhc2VkIGZyb20gMi41CiAgICAgICAgICAgICAgICBsb29rU3BlZWQ6IDUuMCwgICAgICAgLy8gSW5jcmVhc2VkIGZyb20gMy41CgogICAgICAgICAgICAgICAgLy8gRHluYW1pYyBGT1YKICAgICAgICAgICAgICAgIGZvdkJhc2U6IDUwLAogICAgICAgICAgICAgICAgZm92TWF4OiA2MCwKCiAgICAgICAgICAgICAgICAvLyBJTVBST1ZFRDogTG9vay1haGVhZCBzZXR0aW5ncwogICAgICAgICAgICAgICAgbG9va0FoZWFkRGlzdGFuY2U6IDYuMCwKICAgICAgICAgICAgICAgIGxvb2tBaGVhZFNtb290aGluZzogMy4wLAoKICAgICAgICAgICAgICAgIC8vIFNtYXJ0IGZyYW1pbmcKICAgICAgICAgICAgICAgIGJhbGxUcmFja1dlaWdodDogMC4zLAogICAgICAgICAgICAgICAgdGhyZWF0QXdhcmVuZXNzOiB0cnVlCiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBTdGF0ZQogICAgICAgICAgICB0aGlzLnRhcmdldCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuYmFsbCA9IG51bGw7IC8vIERpcmVjdCBiYWxsIHJlZmVyZW5jZSBmb3Igc21hcnQgZnJhbWluZwogICAgICAgICAgICB0aGlzLnRhcmdldFZlbCA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICAgICAgICAgIHRoaXMudGFyZ2V0SW5wdXQgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgICAgICAgICB0aGlzLnNtb290aGVkSW5wdXQgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgICAgICAgICB0aGlzLnNtb290aGVkTG9va0FoZWFkID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKCiAgICAgICAgICAgIC8vIENhbWVyYSBTdGF0ZQogICAgICAgICAgICB0aGlzLnBvcyA9IGNhbWVyYS5wb3NpdGlvbi5jbG9uZSgpOwogICAgICAgICAgICB0aGlzLmxvb2tBdCA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIDApOwoKICAgICAgICAgICAgLy8gT3JiaXQgU3RhdGUKICAgICAgICAgICAgdGhpcy5jdXJyZW50WWF3ID0gTWF0aC5QSTsKICAgICAgICAgICAgdGhpcy50YXJnZXRZYXcgPSBNYXRoLlBJOwoKICAgICAgICAgICAgLy8gSU1QUk9WRUQ6IE1hbnVhbCBvcmJpdCBmcm9tIHRvdWNoIChyaWdodCBzaWRlIG9mIHNjcmVlbikKICAgICAgICAgICAgdGhpcy5tYW51YWxPcmJpdFlhdyA9IDA7CiAgICAgICAgICAgIHRoaXMubWFudWFsT3JiaXRQaXRjaCA9IDA7CiAgICAgICAgICAgIHRoaXMub3JiaXRTZW5zaXRpdml0eSA9IDAuMDA0OwogICAgICAgICAgICB0aGlzLmF1dG9SZWNlbnRlclRpbWVyID0gMDsKICAgICAgICAgICAgdGhpcy5hdXRvUmVjZW50ZXJEZWxheSA9IDMuMDsKCi8vIFNoYWtlCiAgICAgICAgICAgIHRoaXMuc2hha2VJbnRlbnNpdHkgPSAwOwogICAgICAgICAgICB0aGlzLnNoYWtlUm9sbCA9IDA7IC8vIE5FVzogUm90YXRpb25hbCBzaGFrZQogICAgICAgICAgICB0aGlzLnNoYWtlT2Zmc2V0ID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgICAgICAgICAgdGhpcy5mb3ZJbXB1bHNlID0gMDsKCiAgICAgICAgICAgIC8vIENpbmVtYXRpYyBTdGF0ZQogICAgICAgICAgICB0aGlzLmlzQ2luZW1hdGljID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuY2luZW1hdGljVGltZXIgPSAwOwogICAgICAgICAgICB0aGlzLmNpbmVtYXRpY0R1cmF0aW9uID0gMDsKICAgICAgICAgICAgdGhpcy5jaW5lbWF0aWNUeXBlID0gJ2RlZmF1bHQnOwogICAgICAgICAgICB0aGlzLmNpbmVtYXRpY1N0YXJ0UG9zID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgICAgICAgICAgdGhpcy5jaW5lbWF0aWNTdGFydExvb2sgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgICAgICAgICB0aGlzLmNpbmVtYXRpY0VuZFBvcyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CgogICAgICAgICAgICAvLyBJTVBST1ZFRDogRHluYW1pYyBwdWxsLWJhY2sgYmFzZWQgb24gYWN0aW9uCiAgICAgICAgICAgIHRoaXMuY3VycmVudFB1bGxCYWNrID0gMDsKICAgICAgICAgICAgdGhpcy5tYXhQdWxsQmFjayA9IDg7CiAgICAgICAgfQoKICAgICAgICAvLyBORVc6IFNldCBiYWxsIHJlZmVyZW5jZSBmb3Igc21hcnQgZnJhbWluZwogICAgICAgIHNldEJhbGwoYmFsbCkgewogICAgICAgICAgICB0aGlzLmJhbGwgPSBiYWxsOwogICAgICAgIH0KCiAgICAgICAgLy8gSU1QUk9WRUQ6IEdldCBjYW1lcmEtcmVsYXRpdmUgaW5wdXQgdHJhbnNmb3JtYXRpb24KICAgICAgICBnZXRDYW1lcmFSZWxhdGl2ZUlucHV0KGlucHV0WCwgaW5wdXRaKSB7CiAgICAgICAgICAgIHRoaXMuY2FtZXJhLmdldFdvcmxkRGlyZWN0aW9uKF9jYW1Gd2QpOwogICAgICAgICAgICBfY2FtRndkLnkgPSAwOwoKICAgICAgICAgICAgaWYgKF9jYW1Gd2QubGVuZ3RoU3EoKSA8IDAuMDAxKSB7CiAgICAgICAgICAgICAgICBfY2FtRndkLnNldCgwLCAwLCAtMSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBfY2FtRndkLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfY2FtUmlnaHQuY3Jvc3NWZWN0b3JzKG5ldyBUSFJFRS5WZWN0b3IzKDAsIDEsIDApLCBfY2FtRndkKS5ub3JtYWxpemUoKTsKCiAgICAgICAgICAgIC8vIFRyYW5zZm9ybSBpbnB1dCB0byB3b3JsZCBzcGFjZQogICAgICAgICAgICBjb25zdCB3b3JsZFggPSAoaW5wdXRYICogX2NhbVJpZ2h0LngpICsgKGlucHV0WiAqIF9jYW1Gd2QueCk7CiAgICAgICAgICAgIGNvbnN0IHdvcmxkWiA9IChpbnB1dFggKiBfY2FtUmlnaHQueikgKyAoaW5wdXRaICogX2NhbUZ3ZC56KTsKCiAgICAgICAgICAgIHJldHVybiB7IHg6IHdvcmxkWCwgejogd29ybGRaIH07CiAgICAgICAgfQoKICAgICAgICAvLyBORVc6IE1hbnVhbCBvcmJpdCBpbnB1dCBmcm9tIHRvdWNoCiAgICAgICAgaGFuZGxlT3JiaXRJbnB1dChkeCwgZHkpIHsKICAgICAgICAgICAgdGhpcy5tYW51YWxPcmJpdFlhdyArPSBkeCAqIHRoaXMub3JiaXRTZW5zaXRpdml0eTsKICAgICAgICAgICAgdGhpcy5tYW51YWxPcmJpdFBpdGNoICs9IGR5ICogdGhpcy5vcmJpdFNlbnNpdGl2aXR5ICogMC41OwoKICAgICAgICAgICAgLy8gQ2xhbXAgcGl0Y2gKICAgICAgICAgICAgdGhpcy5tYW51YWxPcmJpdFBpdGNoID0gTWF0aC5tYXgoLTAuMywgTWF0aC5taW4oMC41LCB0aGlzLm1hbnVhbE9yYml0UGl0Y2gpKTsKCiAgICAgICAgICAgIC8vIFJlc2V0IGF1dG8tcmVjZW50ZXIgdGltZXIKICAgICAgICAgICAgdGhpcy5hdXRvUmVjZW50ZXJUaW1lciA9IDA7CiAgICAgICAgfQoKICAgICAgICAvLyBORVc6IFJlY2VudGVyIGNhbWVyYQogICAgICAgIHJlY2VudGVyKCkgewogICAgICAgICAgICB0aGlzLm1hbnVhbE9yYml0WWF3ID0gMDsKICAgICAgICAgICAgdGhpcy5tYW51YWxPcmJpdFBpdGNoID0gMDsKICAgICAgICB9CgogICAgICAgIHBsYXlDaW5lbWF0aWModHlwZSwgdGFyZ2V0LCBkdXJhdGlvbiA9IDEuNSkgewogICAgICAgICAgICB0aGlzLmlzQ2luZW1hdGljID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5jaW5lbWF0aWNUaW1lciA9IDA7CiAgICAgICAgICAgIHRoaXMuY2luZW1hdGljRHVyYXRpb24gPSBkdXJhdGlvbjsKICAgICAgICAgICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7CiAgICAgICAgICAgIHRoaXMuY2luZW1hdGljVHlwZSA9IHR5cGU7CgogICAgICAgICAgICB0aGlzLmNpbmVtYXRpY1N0YXJ0UG9zLmNvcHkodGhpcy5wb3MpOwogICAgICAgICAgICB0aGlzLmNpbmVtYXRpY1N0YXJ0TG9vay5jb3B5KHRoaXMubG9va0F0KTsKCiAgICAgICAgICAgIHRoaXMuYWRkRm92SW1wdWxzZSgtMTUpOwogICAgICAgIH0KCiAgICAgICAgX3VwZGF0ZUNpbmVtYXRpYyhkdCkgewogICAgICAgICAgICB0aGlzLmNpbmVtYXRpY1RpbWVyICs9IGR0OwogICAgICAgICAgICBjb25zdCBwcm9ncmVzcyA9IE1hdGgubWluKDEuMCwgdGhpcy5jaW5lbWF0aWNUaW1lciAvIHRoaXMuY2luZW1hdGljRHVyYXRpb24pOwoKICAgICAgICAgICAgY29uc3QgdCA9IDEgLSBNYXRoLnBvdygxIC0gcHJvZ3Jlc3MsIDMpOwoKICAgICAgICAgICAgbGV0IGFjdGl2ZVRhcmdldCA9IHRoaXMudGFyZ2V0OwogICAgICAgICAgICBsZXQgaXNCYWxsVHJhY2tpbmcgPSBmYWxzZTsKICAgICAgICAgICAgY29uc3QgYmFsbCA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZSA/IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5lbnRpdGllcy5iYWxsIDogbnVsbDsKCiAgICAgICAgICAgIGlmIChiYWxsICYmIGJhbGwubWVzaCAmJiBiYWxsLnN0YXRlID09PSAnZnJlZScgJiYgYmFsbC52ZWxvY2l0eS5sZW5ndGhTcSgpID4gMi4wKSB7CiAgICAgICAgICAgICAgICBhY3RpdmVUYXJnZXQgPSBiYWxsLm1lc2g7CiAgICAgICAgICAgICAgICBpc0JhbGxUcmFja2luZyA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghYWN0aXZlVGFyZ2V0KSB7CiAgICAgICAgICAgICAgICB0aGlzLmlzQ2luZW1hdGljID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGFjdGl2ZVRhcmdldC5nZXRXb3JsZFBvc2l0aW9uKF90YXJnZXRXb3JsZFBvcyk7CgogICAgICAgICAgICBjb25zdCBlbmRMb29rID0gX3RhcmdldFdvcmxkUG9zLmNsb25lKCk7CiAgICAgICAgICAgIGxldCBmd2QgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgICAgICAgICBsZXQgcmlnaHQgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwoKICAgICAgICAgICAgaWYgKGlzQmFsbFRyYWNraW5nKSB7CiAgICAgICAgICAgICAgICBlbmRMb29rLmFkZFNjYWxlZFZlY3RvcihiYWxsLnZlbG9jaXR5LCAwLjMpOwoKICAgICAgICAgICAgICAgIGZ3ZC5jb3B5KGJhbGwudmVsb2NpdHkpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgZndkLnkgPSAwOwogICAgICAgICAgICAgICAgaWYgKGZ3ZC5sZW5ndGhTcSgpIDwgMC4wMSkgZndkLnNldCgwLDAsMSk7CiAgICAgICAgICAgICAgICBmd2Qubm9ybWFsaXplKCk7CgogICAgICAgICAgICAgICAgcmlnaHQuY3Jvc3NWZWN0b3JzKG5ldyBUSFJFRS5WZWN0b3IzKDAsMSwwKSwgZndkKS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGVuZExvb2sueSArPSAxLjU7CiAgICAgICAgICAgICAgICBmd2Quc2V0KDAsIDAsIDEpLmFwcGx5UXVhdGVybmlvbihhY3RpdmVUYXJnZXQucXVhdGVybmlvbik7CiAgICAgICAgICAgICAgICByaWdodC5zZXQoMSwgMCwgMCkuYXBwbHlRdWF0ZXJuaW9uKGFjdGl2ZVRhcmdldC5xdWF0ZXJuaW9uKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgZW5kUG9zID0gX3RhcmdldFdvcmxkUG9zLmNsb25lKCk7CgogICAgICAgICAgICBpZiAodGhpcy5jaW5lbWF0aWNUeXBlID09PSAnamVjaHQnKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gaXNCYWxsVHJhY2tpbmcgPyAxNC4wIDogMTAuMDsKICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IGZ3ZC5jbG9uZSgpLm11bHRpcGx5U2NhbGFyKC1kaXN0KS5hZGQocmlnaHQuY2xvbmUoKS5tdWx0aXBseVNjYWxhcigzLjApKTsKICAgICAgICAgICAgICAgIGVuZFBvcy5hZGQob2Zmc2V0KTsKICAgICAgICAgICAgICAgIGVuZFBvcy55ICs9IDYuMDsKICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmNpbmVtYXRpY1R5cGUgPT09ICdzcGhlcmUnKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gaXNCYWxsVHJhY2tpbmcgPyAxNi4wIDogMTIuMDsKICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IGZ3ZC5jbG9uZSgpLm11bHRpcGx5U2NhbGFyKC1kaXN0KTsKICAgICAgICAgICAgICAgIGVuZFBvcy5hZGQob2Zmc2V0KTsKICAgICAgICAgICAgICAgIGVuZFBvcy55ICs9IDEwLjA7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5jaW5lbWF0aWNUeXBlID09PSAnaW52aXNpYmxlJykgewogICAgICAgICAgICAgICAgY29uc3QgZGlzdCA9IDEyLjA7CiAgICAgICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBmd2QuY2xvbmUoKS5tdWx0aXBseVNjYWxhcigtZGlzdCAqIDAuNSkuYWRkKHJpZ2h0LmNsb25lKCkubXVsdGlwbHlTY2FsYXIoZGlzdCkpOwogICAgICAgICAgICAgICAgZW5kUG9zLmFkZChvZmZzZXQpOwogICAgICAgICAgICAgICAgZW5kUG9zLnkgKz0gNS4wOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgZGlzdCA9IGlzQmFsbFRyYWNraW5nID8gMTQuMCA6IDEwLjA7CiAgICAgICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBmd2QuY2xvbmUoKS5tdWx0aXBseVNjYWxhcigtZGlzdCk7CiAgICAgICAgICAgICAgICBlbmRQb3MuYWRkKG9mZnNldCk7CiAgICAgICAgICAgICAgICBlbmRQb3MueSArPSA1LjA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMucG9zLmxlcnAoZW5kUG9zLCBkdCAqIDQuMCk7CiAgICAgICAgICAgIHRoaXMubG9va0F0LmxlcnAoZW5kTG9vaywgZHQgKiA2LjApOwoKICAgICAgICAgICAgdGhpcy5jYW1lcmEucG9zaXRpb24uY29weSh0aGlzLnBvcyk7CiAgICAgICAgICAgIHRoaXMuY2FtZXJhLmxvb2tBdCh0aGlzLmxvb2tBdCk7CgogICAgICAgICAgICBpZiAodGhpcy5jaW5lbWF0aWNUaW1lciA+PSB0aGlzLmNpbmVtYXRpY0R1cmF0aW9uKSB7CiAgICAgICAgICAgICAgICB0aGlzLmlzQ2luZW1hdGljID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHNldFRhcmdldChtZXNoLCB2ZWxvY2l0eSwgaW5wdXQpIHsKICAgICAgICAgICAgdGhpcy50YXJnZXQgPSBtZXNoOwogICAgICAgICAgICBpZiAodmVsb2NpdHkpIHRoaXMudGFyZ2V0VmVsLmNvcHkodmVsb2NpdHkpOwogICAgICAgICAgICBpZiAoaW5wdXQpIHRoaXMudGFyZ2V0SW5wdXQuY29weShpbnB1dCk7CiAgICAgICAgICAgIGVsc2UgdGhpcy50YXJnZXRJbnB1dC5zZXQoMCwgMCwgMCk7CiAgICAgICAgfQoKICAgICAgICAvLyBLZWVwIGZvciBjb21wYXRpYmlsaXR5CiAgICAgICAgaGFuZGxlSW5wdXQoZHgsIGR5KSB7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlT3JiaXRJbnB1dChkeCwgZHkpOwogICAgICAgIH0KCiAgICAgICAgZ2V0WWF3KCkgeyByZXR1cm4gdGhpcy5jdXJyZW50WWF3OyB9CgogICAgICAgIGFkZFNoYWtlKGFtb3VudCkgewoKICAgICAgICAgICAgdGhpcy5zaGFrZUludGVuc2l0eSA9IE1hdGgubWluKHRoaXMuc2hha2VJbnRlbnNpdHkgKyBhbW91bnQsIDQuMCk7IC8vIEluY3JlYXNlZCBjYXAKICAgICAgICAgICAgdGhpcy5zaGFrZVJvbGwgPSBNYXRoLm1pbih0aGlzLnNoYWtlUm9sbCArIGFtb3VudCAqIDAuMiwgMC44KTsgLy8gQWRkIHJvbGwKICAgICAgICB9CiAgICAgICAgYWRkRm92SW1wdWxzZShhbW91bnQpIHsKICAgICAgICAgICAgdGhpcy5mb3ZJbXB1bHNlID0gTWF0aC5taW4odGhpcy5mb3ZJbXB1bHNlICsgYW1vdW50LCAzMCk7CiAgICAgICAgfQoKICAgICAgICBzbmFwVG9UYXJnZXQoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy50YXJnZXQpIHJldHVybjsKICAgICAgICAgICAgdGhpcy50YXJnZXQuZ2V0V29ybGRQb3NpdGlvbihfdGFyZ2V0V29ybGRQb3MpOwoKICAgICAgICAgICAgdGhpcy5fY2FsY3VsYXRlSWRlYWxTdGF0ZSgwKTsKCiAgICAgICAgICAgIHRoaXMucG9zLmNvcHkoX2lkZWFsUG9zKTsKICAgICAgICAgICAgdGhpcy5sb29rQXQuY29weShfaWRlYWxMb29rKTsKICAgICAgICAgICAgdGhpcy5jdXJyZW50WWF3ID0gdGhpcy50YXJnZXRZYXc7CgogICAgICAgICAgICB0aGlzLmNhbWVyYS5wb3NpdGlvbi5jb3B5KHRoaXMucG9zKTsKICAgICAgICAgICAgdGhpcy5jYW1lcmEubG9va0F0KHRoaXMubG9va0F0KTsKCiAgICAgICAgICAgIHRoaXMuc21vb3RoZWRJbnB1dC5zZXQoMCwgMCwgMCk7CiAgICAgICAgICAgIHRoaXMuc21vb3RoZWRMb29rQWhlYWQuc2V0KDAsIDAsIDApOwogICAgICAgIH0KCiAgICAgICAgdXBkYXRlKGR0KSB7CiAgICAgICAgICAgIGlmICh0aGlzLmlzQ2luZW1hdGljKSB7CiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVDaW5lbWF0aWMoZHQpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIXRoaXMudGFyZ2V0KSByZXR1cm47CgogICAgICAgICAgICBjb25zdCBzYWZlRHQgPSBNYXRoLm1pbihkdCwgMC4wNSk7CgogICAgICAgICAgICAvLyBJTVBST1ZFRDogQXV0by1yZWNlbnRlciBsb2dpYwogICAgICAgICAgICB0aGlzLmF1dG9SZWNlbnRlclRpbWVyICs9IHNhZmVEdDsKICAgICAgICAgICAgaWYgKHRoaXMuYXV0b1JlY2VudGVyVGltZXIgPiB0aGlzLmF1dG9SZWNlbnRlckRlbGF5KSB7CiAgICAgICAgICAgICAgICBjb25zdCByZWNlbnRlclNwZWVkID0gMi4wICogc2FmZUR0OwogICAgICAgICAgICAgICAgdGhpcy5tYW51YWxPcmJpdFlhdyAqPSAoMS4wIC0gcmVjZW50ZXJTcGVlZCk7CiAgICAgICAgICAgICAgICB0aGlzLm1hbnVhbE9yYml0UGl0Y2ggKj0gKDEuMCAtIHJlY2VudGVyU3BlZWQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBJTVBST1ZFRDogU21hcnQgcHVsbC1iYWNrIGJhc2VkIG9uIGJhbGwgc3BlZWQKICAgICAgICAgICAgaWYgKHRoaXMuYmFsbCAmJiB0aGlzLmJhbGwudmVsb2NpdHkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGJhbGxTcGVlZCA9IHRoaXMuYmFsbC52ZWxvY2l0eS5sZW5ndGgoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldFB1bGxCYWNrID0gTWF0aC5taW4odGhpcy5tYXhQdWxsQmFjaywgYmFsbFNwZWVkICogMC4zKTsKICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFB1bGxCYWNrICs9ICh0YXJnZXRQdWxsQmFjayAtIHRoaXMuY3VycmVudFB1bGxCYWNrKSAqIHNhZmVEdCAqIDMuMDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFB1bGxCYWNrICo9ICgxLjAgLSBzYWZlRHQgKiAyLjApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAxLiBVcGRhdGUgVGFyZ2V0IEluZm8KICAgICAgICAgICAgdGhpcy50YXJnZXQuZ2V0V29ybGRQb3NpdGlvbihfdGFyZ2V0V29ybGRQb3MpOwoKICAgICAgICAgICAgLy8gMi4gQ2FsY3VsYXRlIElkZWFsIFN0YXRlCiAgICAgICAgICAgIHRoaXMuX2NhbGN1bGF0ZUlkZWFsU3RhdGUoc2FmZUR0KTsKCiAgICAgICAgICAgIC8vIDMuIElNUFJPVkVEOiBGYXN0ZXIsIG1vcmUgcmVzcG9uc2l2ZSBzbW9vdGhpbmcKICAgICAgICAgICAgY29uc3QgcG9zRmFjdG9yID0gMS4wIC0gTWF0aC5leHAoLXRoaXMuY29uZmlnLmZvbGxvd1NwZWVkICogc2FmZUR0KTsKICAgICAgICAgICAgY29uc3QgbG9va0ZhY3RvciA9IDEuMCAtIE1hdGguZXhwKC10aGlzLmNvbmZpZy5sb29rU3BlZWQgKiBzYWZlRHQpOwoKICAgICAgICAgICAgdGhpcy5wb3MubGVycChfaWRlYWxQb3MsIHBvc0ZhY3Rvcik7CiAgICAgICAgICAgIHRoaXMubG9va0F0LmxlcnAoX2lkZWFsTG9vaywgbG9va0ZhY3Rvcik7CgovLyA0LiBTY3JlZW4gU2hha2UgKFBvc2l0aW9uICYgUm90YXRpb24pCiAgICAgICAgICAgIGlmICh0aGlzLnNoYWtlSW50ZW5zaXR5ID4gMCkgewogICAgICAgICAgICAgICAgY29uc3QgZGVjYXkgPSA4LjAgKiBzYWZlRHQ7IC8vIEZhc3QgZGVjYXkgZm9yIHNuYXBweSBmZWVsCiAgICAgICAgICAgICAgICB0aGlzLnNoYWtlSW50ZW5zaXR5IC09IGRlY2F5OwogICAgICAgICAgICAgICAgaWYgKHRoaXMuc2hha2VJbnRlbnNpdHkgPCAwKSB0aGlzLnNoYWtlSW50ZW5zaXR5ID0gMDsKCiAgICAgICAgICAgICAgICBjb25zdCBzaGFrZU1hZyA9IHRoaXMuc2hha2VJbnRlbnNpdHkgKiAwLjU7CiAgICAgICAgICAgICAgICB0aGlzLnNoYWtlT2Zmc2V0LnNldCgKICAgICAgICAgICAgICAgICAgICAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiBzaGFrZU1hZywKICAgICAgICAgICAgICAgICAgICAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiBzaGFrZU1hZywKICAgICAgICAgICAgICAgICAgICAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiBzaGFrZU1hZwogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuc2hha2VPZmZzZXQuc2V0KDAsIDAsIDApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBSb2xsIFNoYWtlCiAgICAgICAgICAgIGlmICh0aGlzLnNoYWtlUm9sbCA+IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuc2hha2VSb2xsIC09IDUuMCAqIHNhZmVEdDsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnNoYWtlUm9sbCA8IDApIHRoaXMuc2hha2VSb2xsID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuY2FtZXJhLnJvdGF0aW9uLnogPSAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiB0aGlzLnNoYWtlUm9sbDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuY2FtZXJhLnJvdGF0aW9uLnogPSAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyA1LiBEeW5hbWljIEZPVgogICAgICAgICAgICBjb25zdCBzcGVlZCA9IHRoaXMudGFyZ2V0VmVsLmxlbmd0aCgpOwogICAgICAgICAgICBjb25zdCBzcGVlZFJhdGlvID0gTWF0aC5taW4oc3BlZWQgLyAyMC4wLCAxLjApOwogICAgICAgICAgICBjb25zdCB3YXJwID0gc3BlZWRSYXRpbyAqIHNwZWVkUmF0aW87CgogICAgICAgICAgICBjb25zdCB0YXJnZXRGb3YgPSB0aGlzLmNvbmZpZy5mb3ZCYXNlICsgKHRoaXMuY29uZmlnLmZvdk1heCAtIHRoaXMuY29uZmlnLmZvdkJhc2UpICogd2FycCArIHRoaXMuZm92SW1wdWxzZTsKCiAgICAgICAgICAgIHRoaXMuZm92SW1wdWxzZSAqPSBNYXRoLm1heCgwLCAxLjAgLSAoNS4wICogc2FmZUR0KSk7CgogICAgICAgICAgICB0aGlzLmNhbWVyYS5mb3YgKz0gKHRhcmdldEZvdiAtIHRoaXMuY2FtZXJhLmZvdikgKiAzLjAgKiBzYWZlRHQ7CiAgICAgICAgICAgIHRoaXMuY2FtZXJhLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKCiAgICAgICAgICAgIC8vIDYuIEFwcGx5IHRvIENhbWVyYQogICAgICAgICAgICB0aGlzLmNhbWVyYS5wb3NpdGlvbi5jb3B5KHRoaXMucG9zKS5hZGQodGhpcy5zaGFrZU9mZnNldCk7CiAgICAgICAgICAgIHRoaXMuY2FtZXJhLmxvb2tBdCh0aGlzLmxvb2tBdCk7CiAgICAgICAgfQoKICAgICAgICBfY2FsY3VsYXRlSWRlYWxTdGF0ZShkdCkgewogICAgICAgICAgICBjb25zdCB0UG9zID0gX3RhcmdldFdvcmxkUG9zOwoKICAgICAgICAgICAgLy8gSU1QUk9WRUQ6IEFwcGx5IG1hbnVhbCBvcmJpdAogICAgICAgICAgICBjb25zdCBvcmJpdGVkWCA9IHRQb3MueCAqIE1hdGguY29zKHRoaXMubWFudWFsT3JiaXRZYXcpIC0gdFBvcy56ICogTWF0aC5zaW4odGhpcy5tYW51YWxPcmJpdFlhdyk7CgogICAgICAgICAgICAvLyAxLiBDYWxjdWxhdGUgSWRlYWwgUG9zaXRpb24gd2l0aCBwdWxsLWJhY2sKICAgICAgICAgICAgY29uc3QgZWZmZWN0aXZlRGlzdGFuY2UgPSB0aGlzLmNvbmZpZy5iYXNlRGlzdGFuY2UgKyB0aGlzLmN1cnJlbnRQdWxsQmFjazsKICAgICAgICAgICAgY29uc3QgZWZmZWN0aXZlSGVpZ2h0ID0gdGhpcy5jb25maWcuYmFzZUhlaWdodCArIHRoaXMuY3VycmVudFB1bGxCYWNrICogMC4zICsgdGhpcy5tYW51YWxPcmJpdFBpdGNoICogMTA7CgogICAgICAgICAgICBjb25zdCBjYW1YID0gdFBvcy54ICogMC45OwogICAgICAgICAgICBjb25zdCBjYW1ZID0gKHRQb3MueSAqIDAuMSkgKyBlZmZlY3RpdmVIZWlnaHQ7CiAgICAgICAgICAgIGxldCBjYW1aID0gdFBvcy56ICsgZWZmZWN0aXZlRGlzdGFuY2U7CgogICAgICAgICAgICAvLyBJTVBST1ZFRDogQXBwbHkgb3JiaXQgcm90YXRpb24gdG8gY2FtZXJhIHBvc2l0aW9uCiAgICAgICAgICAgIGNvbnN0IGZpbmFsQ2FtWCA9IGNhbVggKiBNYXRoLmNvcyh0aGlzLm1hbnVhbE9yYml0WWF3KSArIGVmZmVjdGl2ZURpc3RhbmNlICogTWF0aC5zaW4odGhpcy5tYW51YWxPcmJpdFlhdyk7CiAgICAgICAgICAgIGNvbnN0IGZpbmFsQ2FtWiA9IGNhbVogKiBNYXRoLmNvcyh0aGlzLm1hbnVhbE9yYml0WWF3KSAtIGNhbVggKiBNYXRoLnNpbih0aGlzLm1hbnVhbE9yYml0WWF3KTsKCiAgICAgICAgICAgIGlmIChmaW5hbENhbVogPiAzOC4wKSB7CiAgICAgICAgICAgICAgICBfaWRlYWxQb3Muc2V0KGZpbmFsQ2FtWCwgY2FtWSwgMzguMCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBfaWRlYWxQb3Muc2V0KGZpbmFsQ2FtWCwgY2FtWSwgZmluYWxDYW1aKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMi4gQ2FsY3VsYXRlIElkZWFsIExvb2tBdCB3aXRoIElNUFJPVkVEIGxvb2stYWhlYWQKICAgICAgICAgICAgX2lkZWFsTG9vay5jb3B5KHRQb3MpOwoKICAgICAgICAgICAgLy8gSU1QUk9WRUQ6IFZlbG9jaXR5LWJhc2VkIGxvb2stYWhlYWQKICAgICAgICAgICAgaWYgKHRoaXMudGFyZ2V0VmVsLmxlbmd0aFNxKCkgPiAwLjUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNwZWVkID0gdGhpcy50YXJnZXRWZWwubGVuZ3RoKCk7CiAgICAgICAgICAgICAgICBjb25zdCBsb29rQWhlYWRGYWN0b3IgPSBNYXRoLm1pbigxLjAsIHNwZWVkIC8gMTAuMCkgKiB0aGlzLmNvbmZpZy5sb29rQWhlYWREaXN0YW5jZTsKCiAgICAgICAgICAgICAgICBjb25zdCB2ZWxEaXIgPSB0aGlzLnRhcmdldFZlbC5jbG9uZSgpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgX2xvb2tBaGVhZC5jb3B5KHZlbERpcikubXVsdGlwbHlTY2FsYXIobG9va0FoZWFkRmFjdG9yKTsKCiAgICAgICAgICAgICAgICAvLyBTbW9vdGggdGhlIGxvb2stYWhlYWQKICAgICAgICAgICAgICAgIHRoaXMuc21vb3RoZWRMb29rQWhlYWQubGVycChfbG9va0FoZWFkLCBkdCAqIHRoaXMuY29uZmlnLmxvb2tBaGVhZFNtb290aGluZyk7CiAgICAgICAgICAgICAgICBfaWRlYWxMb29rLmFkZCh0aGlzLnNtb290aGVkTG9va0FoZWFkKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuc21vb3RoZWRMb29rQWhlYWQubXVsdGlwbHlTY2FsYXIoMS4wIC0gZHQgKiAyLjApOwogICAgICAgICAgICAgICAgX2lkZWFsTG9vay5hZGQodGhpcy5zbW9vdGhlZExvb2tBaGVhZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9pZGVhbExvb2sueiAtPSA1LjA7CiAgICAgICAgICAgIF9pZGVhbExvb2sueSAqPSAwLjU7CgogICAgICAgICAgICAvLyBJTVBST1ZFRDogSW5jbHVkZSBiYWxsIGluIGZyYW1pbmcgd2hlbiBuZWFyYnkKICAgICAgICAgICAgaWYgKHRoaXMuYmFsbCAmJiB0aGlzLmJhbGwubWVzaCAmJiB0aGlzLmNvbmZpZy5iYWxsVHJhY2tXZWlnaHQgPiAwKSB7CiAgICAgICAgICAgICAgICBjb25zdCBiYWxsUG9zID0gdGhpcy5iYWxsLm1lc2gucG9zaXRpb247CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0VG9CYWxsID0gdFBvcy5kaXN0YW5jZVRvKGJhbGxQb3MpOwoKICAgICAgICAgICAgICAgIGlmIChkaXN0VG9CYWxsIDwgMjAgJiYgZGlzdFRvQmFsbCA+IDIpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBiYWxsV2VpZ2h0ID0gTWF0aC5tYXgoMCwgMSAtIGRpc3RUb0JhbGwgLyAyMCkgKiB0aGlzLmNvbmZpZy5iYWxsVHJhY2tXZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgX2lkZWFsTG9vay5sZXJwKGJhbGxQb3MsIGJhbGxXZWlnaHQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAzLiBJbnB1dCBBbnRpY2lwYXRpb24gKFNtb290aGVkKQogICAgICAgICAgICB0aGlzLnNtb290aGVkSW5wdXQubGVycCh0aGlzLnRhcmdldElucHV0LCBkdCAqIDIuMCk7CgogICAgICAgICAgICBpZiAodGhpcy5zbW9vdGhlZElucHV0Lmxlbmd0aFNxKCkgPiAwLjAxKSB7CiAgICAgICAgICAgICAgICBfaWRlYWxMb29rLnggKz0gdGhpcy5zbW9vdGhlZElucHV0LnggKiAzLjA7CiAgICAgICAgICAgICAgICBfaWRlYWxMb29rLnogKz0gdGhpcy5zbW9vdGhlZElucHV0LnogKiAzLjA7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIE5FVzogR2V0IGZvcndhcmQgZGlyZWN0aW9uIGZvciBVSSByZWZlcmVuY2UKICAgICAgICBnZXRGb3J3YXJkRGlyZWN0aW9uKCkgewogICAgICAgICAgICB0aGlzLmNhbWVyYS5nZXRXb3JsZERpcmVjdGlvbihfY2FtRndkKTsKICAgICAgICAgICAgX2NhbUZ3ZC55ID0gMDsKICAgICAgICAgICAgaWYgKF9jYW1Gd2QubGVuZ3RoU3EoKSA8IDAuMDAxKSB7CiAgICAgICAgICAgICAgICBfY2FtRndkLnNldCgwLCAwLCAtMSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBfY2FtRndkLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBfY2FtRndkLmNsb25lKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBORVc6IEdldCByaWdodCBkaXJlY3Rpb24KICAgICAgICBnZXRSaWdodERpcmVjdGlvbigpIHsKICAgICAgICAgICAgY29uc3QgZndkID0gdGhpcy5nZXRGb3J3YXJkRGlyZWN0aW9uKCk7CiAgICAgICAgICAgIF9jYW1SaWdodC5jcm9zc1ZlY3RvcnMobmV3IFRIUkVFLlZlY3RvcjMoMCwgMSwgMCksIGZ3ZCkubm9ybWFsaXplKCk7CiAgICAgICAgICAgIHJldHVybiBfY2FtUmlnaHQuY2xvbmUoKTsKICAgICAgICB9CiAgICB9CgogICAgd2luZG93LmZsdXguQ2FtZXJhTWFuYWdlciA9IENhbWVyYU1hbmFnZXI7Cn0pKCk7Cg==","ParticleManager.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICAvLyAtLS0gVEVYVFVSRSBHRU5FUkFUT1JTIC0tLQogICAgCiAgICAvLyAxLiBWZW5vbSBCdWJibGUgKEdyZWVuLCBzaGlueSwgc2hhcnApCiAgICBjb25zdCBfdmVub21UZXggPSAoKCkgPT4gewogICAgICAgIGNvbnN0IGMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgICBjLndpZHRoID0gNjQ7IGMuaGVpZ2h0ID0gNjQ7CiAgICAgICAgY29uc3QgY3R4ID0gYy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgIGNvbnN0IGcgPSBjdHguY3JlYXRlUmFkaWFsR3JhZGllbnQoMzIsIDMyLCA0LCAzMiwgMzIsIDMwKTsKICAgICAgICBnLmFkZENvbG9yU3RvcCgwLCAncmdiYSgxNTAsIDI1NSwgMTAwLCAwLjkpJyk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMC44LCAncmdiYSgwLCAyMDAsIDAsIDAuNSknKTsKICAgICAgICBnLmFkZENvbG9yU3RvcCgxLCAncmdiYSgwLCA1MCwgMCwgMCknKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gZzsKICAgICAgICBjdHguYmVnaW5QYXRoKCk7IGN0eC5hcmMoMzIsIDMyLCAzMCwgMCwgTWF0aC5QSSoyKTsgY3R4LmZpbGwoKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC45KSc7CiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOyBjdHguYXJjKDIwLCAyMCwgNiwgMCwgTWF0aC5QSSoyKTsgY3R4LmZpbGwoKTsKICAgICAgICByZXR1cm4gbmV3IFRIUkVFLkNhbnZhc1RleHR1cmUoYyk7CiAgICB9KSgpOwoKICAgIC8vIDIuIFNsZWVwIFp6egogICAgY29uc3QgX25hcFRleCA9ICgoKSA9PiB7CiAgICAgICAgY29uc3QgYyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICAgIGMud2lkdGggPSA2NDsgYy5oZWlnaHQgPSA2NDsKICAgICAgICBjb25zdCBjdHggPSBjLmdldENvbnRleHQoJzJkJyk7CiAgICAgICAgY3R4LmZvbnQgPSAnYm9sZCBpdGFsaWMgNDhweCBzYW5zLXNlcmlmJzsKICAgICAgICBjdHguZmlsbFN0eWxlID0gJyNmZmZmZmYnOwogICAgICAgIGN0eC50ZXh0QWxpZ24gPSAnY2VudGVyJzsKICAgICAgICBjdHgudGV4dEJhc2VsaW5lID0gJ21pZGRsZSc7CiAgICAgICAgY3R4LnNoYWRvd0NvbG9yID0gJyMwMDAwZmYnOwogICAgICAgIGN0eC5zaGFkb3dCbHVyID0gNDsKICAgICAgICBjdHguZmlsbFRleHQoJ1onLCAzMiwgMzIpOwogICAgICAgIHJldHVybiBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICAgIH0pKCk7CgogICAgLy8gMy4gV2l0aGVyIFNtb2tlCiAgICBjb25zdCBfd2l0aGVyVGV4ID0gKCgpID0+IHsKICAgICAgICBjb25zdCBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgYy53aWR0aCA9IDY0OyBjLmhlaWdodCA9IDY0OwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjb25zdCBnID0gY3R4LmNyZWF0ZVJhZGlhbEdyYWRpZW50KDMyLCAzMiwgMCwgMzIsIDMyLCAzMik7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMCwgJ3JnYmEoODAsIDgwLCA4MCwgMC44KScpOwogICAgICAgIGcuYWRkQ29sb3JTdG9wKDAuNSwgJ3JnYmEoNDAsIDQwLCA0MCwgMC40KScpOwogICAgICAgIGcuYWRkQ29sb3JTdG9wKDEsICdyZ2JhKDAsIDAsIDAsIDApJyk7CiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGc7CiAgICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIDY0LCA2NCk7CiAgICAgICAgcmV0dXJuIG5ldyBUSFJFRS5DYW52YXNUZXh0dXJlKGMpOwogICAgfSkoKTsKCiAgICAvLyA0LiBTaG9ja3dhdmUgUmluZyAoTmV3KQogICAgY29uc3QgX3Nob2Nrd2F2ZVRleCA9ICgoKSA9PiB7CiAgICAgICAgY29uc3QgYyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICAgIGMud2lkdGggPSAxMjg7IGMuaGVpZ2h0ID0gMTI4OwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjb25zdCBjeCA9IDY0LCBjeSA9IDY0OwogICAgICAgIGNvbnN0IGcgPSBjdHguY3JlYXRlUmFkaWFsR3JhZGllbnQoY3gsIGN5LCA0MCwgY3gsIGN5LCA2MCk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMCwgJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMCknKTsKICAgICAgICBnLmFkZENvbG9yU3RvcCgwLjUsICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDEpJyk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMSwgJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMCknKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gZzsKICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgMTI4LCAxMjgpOwogICAgICAgIHJldHVybiBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICAgIH0pKCk7CgogICAgLy8gNS4gRmxhc2ggU3RhciAoTmV3KQogICAgY29uc3QgX2ZsYXNoVGV4ID0gKCgpID0+IHsKICAgICAgICBjb25zdCBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgYy53aWR0aCA9IDY0OyBjLmhlaWdodCA9IDY0OwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjb25zdCBjeCA9IDMyLCBjeSA9IDMyOwogICAgICAgIGN0eC5maWxsU3R5bGUgPSAnI2ZmZmZmZic7CiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgIGZvcihsZXQgaT0wOyBpPDQ7IGkrKykgewogICAgICAgICAgICBjb25zdCBhID0gKGkgKiBNYXRoLlBJIC8gMik7CiAgICAgICAgICAgIGN0eC5tb3ZlVG8oY3gsIGN5KTsKICAgICAgICAgICAgY3R4LmxpbmVUbyhjeCArIE1hdGguY29zKGEpKjMwLCBjeSArIE1hdGguc2luKGEpKjMwKTsKICAgICAgICAgICAgY3R4LmxpbmVUbyhjeCArIE1hdGguY29zKGEgKyAwLjIpKjEwLCBjeSArIE1hdGguc2luKGEgKyAwLjIpKjEwKTsKICAgICAgICB9CiAgICAgICAgY3R4LmZpbGwoKTsKICAgICAgICBjb25zdCBnID0gY3R4LmNyZWF0ZVJhZGlhbEdyYWRpZW50KGN4LCBjeSwgMCwgY3gsIGN5LCAyMCk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMCwgJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMSknKTsKICAgICAgICBnLmFkZENvbG9yU3RvcCgxLCAncmdiYSgyNTUsIDI1NSwgMjU1LCAwKScpOwogICAgICAgIGN0eC5maWxsU3R5bGUgPSBnOwogICAgICAgIGN0eC5iZWdpblBhdGgoKTsgY3R4LmFyYyhjeCwgY3ksIDIwLCAwLCBNYXRoLlBJKjIpOyBjdHguZmlsbCgpOwogICAgICAgIHJldHVybiBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICAgIH0pKCk7CgogICAgLy8gNi4gRGVicmlzIFNoYXJkIChOZXcpCiAgICBjb25zdCBfZGVicmlzVGV4ID0gKCgpID0+IHsKICAgICAgICBjb25zdCBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgYy53aWR0aCA9IDMyOyBjLmhlaWdodCA9IDMyOwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gJyNmZmZmZmYnOwogICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICBjdHgubW92ZVRvKDE2LCAwKTsgY3R4LmxpbmVUbygzMiwgMTYpOyBjdHgubGluZVRvKDE2LCAzMik7IGN0eC5saW5lVG8oMCwgMTYpOwogICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgcmV0dXJuIG5ldyBUSFJFRS5DYW52YXNUZXh0dXJlKGMpOwogICAgfSkoKTsKLy8gNy4gQnViYmxlIFRleHR1cmUgKE5ldzogQWVzdGhldGljICYgU3VidGxlKQovLyA3LiBCdWJibGUgVGV4dHVyZSAoTmV3OiBBZXN0aGV0aWMgJiBTdWJ0bGUpCiAgICBjb25zdCBfYnViYmxlVGV4ID0gKCgpID0+IHsKICAgICAgICBjb25zdCBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgYy53aWR0aCA9IDY0OyBjLmhlaWdodCA9IDY0OwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICAKICAgICAgICAvLyBDbGVhcgogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgNjQsIDY0KTsKCiAgICAgICAgLy8gTWFpbiBCdWJibGUgQm9keSAoU29mdCBHcmFkaWVudCkKICAgICAgICBjb25zdCBnID0gY3R4LmNyZWF0ZVJhZGlhbEdyYWRpZW50KDI4LCAyOCwgMCwgMzIsIDMyLCAzMCk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMCwgJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC4xKScpOwogICAgICAgIGcuYWRkQ29sb3JTdG9wKDAuNSwgJ3JnYmEoMTAwLCAyMjAsIDI1NSwgMC4yKScpOwogICAgICAgIGcuYWRkQ29sb3JTdG9wKDAuOSwgJ3JnYmEoNTAsIDE1MCwgMjU1LCAwLjQpJyk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMSwgJ3JnYmEoNTAsIDE1MCwgMjU1LCAwLjApJyk7IC8vIFNvZnQgZWRnZQogICAgICAgIAogICAgICAgIGN0eC5maWxsU3R5bGUgPSBnOwogICAgICAgIGN0eC5iZWdpblBhdGgoKTsgY3R4LmFyYygzMiwgMzIsIDMwLCAwLCBNYXRoLlBJKjIpOyBjdHguZmlsbCgpOwogICAgICAgIAogICAgICAgIC8vIFNoYXJwIFNwZWN1bGFyIEhpZ2hsaWdodCAoUmVmbGVjdGlvbikKICAgICAgICBjb25zdCBnMiA9IGN0eC5jcmVhdGVSYWRpYWxHcmFkaWVudCgyMCwgMjAsIDAsIDIwLCAyMCwgMTIpOwogICAgICAgIGcyLmFkZENvbG9yU3RvcCgwLCAncmdiYSgyNTUsIDI1NSwgMjU1LCAwLjkpJyk7CiAgICAgICAgZzIuYWRkQ29sb3JTdG9wKDEsICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMCknKTsKICAgICAgICAKICAgICAgICBjdHguZmlsbFN0eWxlID0gZzI7CiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOyAKICAgICAgICBjdHguZWxsaXBzZSgyMiwgMjIsIDEwLCA2LCAtTWF0aC5QSSAvIDQsIDAsIE1hdGguUEkgKiAyKTsgCiAgICAgICAgY3R4LmZpbGwoKTsKICAgICAgICAKICAgICAgICAvLyBCb3R0b20gUmltIExpZ2h0CiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gJ3JnYmEoMTUwLCAyNTUsIDI1NSwgMC4zKSc7CiAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDI7CiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOyBjdHguYXJjKDMyLCAzMiwgMjgsIDAuMiAqIE1hdGguUEksIDAuOCAqIE1hdGguUEkpOyBjdHguc3Ryb2tlKCk7CiAgICAgICAgCnJldHVybiBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICAgIH0pKCk7CgogICAgLy8gOC4gTWljcm8gQnViYmxlIChOZXc6IFNoYXJwLCBoaWdoLXZpcyBjYXZpdGF0aW9uKQogICAgY29uc3QgX21pY3JvQnViYmxlVGV4ID0gKCgpID0+IHsKICAgICAgICBjb25zdCBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgYy53aWR0aCA9IDMyOyBjLmhlaWdodCA9IDMyOwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIDMyLCAzMik7CiAgICAgICAgCiAgICAgICAgLy8gSW50ZW5zZSBicmlnaHQgY29yZQogICAgICAgIGNvbnN0IGcgPSBjdHguY3JlYXRlUmFkaWFsR3JhZGllbnQoMTYsIDE2LCAwLCAxNiwgMTYsIDE2KTsKICAgICAgICBnLmFkZENvbG9yU3RvcCgwLCAncmdiYSgyNTUsIDI1NSwgMjU1LCAxLjApJyk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMC4zLCAncmdiYSgyMjAsIDI1NSwgMjU1LCAwLjgpJyk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMC42LCAncmdiYSgxMDAsIDIwMCwgMjU1LCAwLjMpJyk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMS4wLCAncmdiYSgwLCAwLCAwLCAwKScpOwogICAgICAgIAogICAgICAgIGN0eC5maWxsU3R5bGUgPSBnOwogICAgICAgIGN0eC5iZWdpblBhdGgoKTsgY3R4LmFyYygxNiwgMTYsIDE2LCAwLCBNYXRoLlBJKjIpOyBjdHguZmlsbCgpOwogICAgICAgIHJldHVybiBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICAgIH0pKCk7CgogICAgY2xhc3MgUGFydGljbGVNYW5hZ2VyIHsKICAgICAgICBjb25zdHJ1Y3RvcihzY2VuZSkgewogICAgICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7CiAgICAgICAgICAgIHRoaXMucGFydGljbGVzID0gW107CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTaGFyZWQgTWF0ZXJpYWxzCiAgICAgICAgICAgIHRoaXMubWF0ZXJpYWxzID0gewogICAgICAgICAgICAgICAgdmVub206IG5ldyBUSFJFRS5TcHJpdGVNYXRlcmlhbCh7IG1hcDogX3Zlbm9tVGV4LCB0cmFuc3BhcmVudDogdHJ1ZSwgZGVwdGhXcml0ZTogZmFsc2UsIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nIH0pLAogICAgICAgICAgICAgICAgbmFwOiBuZXcgVEhSRUUuU3ByaXRlTWF0ZXJpYWwoeyBtYXA6IF9uYXBUZXgsIHRyYW5zcGFyZW50OiB0cnVlLCBkZXB0aFdyaXRlOiBmYWxzZSwgYmxlbmRpbmc6IFRIUkVFLk5vcm1hbEJsZW5kaW5nIH0pLAogICAgICAgICAgICAgICAgd2l0aGVyOiBuZXcgVEhSRUUuU3ByaXRlTWF0ZXJpYWwoeyBtYXA6IF93aXRoZXJUZXgsIHRyYW5zcGFyZW50OiB0cnVlLCBkZXB0aFdyaXRlOiBmYWxzZSwgYmxlbmRpbmc6IFRIUkVFLk5vcm1hbEJsZW5kaW5nIH0pLAogICAgICAgICAgICAgICAgbGVhcm5lZDogbmV3IFRIUkVFLlNwcml0ZU1hdGVyaWFsKHsgbWFwOiBfdmVub21UZXgsIGNvbG9yOiAweDAwZmZmZiwgdHJhbnNwYXJlbnQ6IHRydWUsIGRlcHRoV3JpdGU6IGZhbHNlLCBibGVuZGluZzogVEhSRUUuQWRkaXRpdmVCbGVuZGluZyB9KSwKICAgICAgICAgICAgICAgIHNob2Nrd2F2ZTogbmV3IFRIUkVFLlNwcml0ZU1hdGVyaWFsKHsgbWFwOiBfc2hvY2t3YXZlVGV4LCB0cmFuc3BhcmVudDogdHJ1ZSwgZGVwdGhXcml0ZTogZmFsc2UsIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nIH0pLAogICAgICAgICAgICAgICAgZmxhc2g6IG5ldyBUSFJFRS5TcHJpdGVNYXRlcmlhbCh7IG1hcDogX2ZsYXNoVGV4LCB0cmFuc3BhcmVudDogdHJ1ZSwgZGVwdGhXcml0ZTogZmFsc2UsIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nIH0pLAogICAgICAgICAgICAgICAgZGVicmlzOiBuZXcgVEhSRUUuU3ByaXRlTWF0ZXJpYWwoeyBtYXA6IF9kZWJyaXNUZXgsIHRyYW5zcGFyZW50OiB0cnVlLCBkZXB0aFdyaXRlOiBmYWxzZSwgYmxlbmRpbmc6IFRIUkVFLk5vcm1hbEJsZW5kaW5nIH0pLAogICAgICAgICAgICAgICAgYnViYmxlOiBuZXcgVEhSRUUuU3ByaXRlTWF0ZXJpYWwoeyBtYXA6IF9idWJibGVUZXgsIHRyYW5zcGFyZW50OiB0cnVlLCBkZXB0aFdyaXRlOiBmYWxzZSwgYmxlbmRpbmc6IFRIUkVFLkFkZGl0aXZlQmxlbmRpbmcgfSksCiAgICAgICAgICAgICAgICBidWJibGVfbWljcm86IG5ldyBUSFJFRS5TcHJpdGVNYXRlcmlhbCh7IG1hcDogX21pY3JvQnViYmxlVGV4LCB0cmFuc3BhcmVudDogdHJ1ZSwgZGVwdGhXcml0ZTogZmFsc2UsIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nIH0pCiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBPYmplY3QgUG9vbAovLyBPYmplY3QgUG9vbAogICAgICAgICAgICB0aGlzLnBvb2wgPSBbXTsKICAgICAgICAgICAgdGhpcy5wb29sU2l6ZSA9IDMwMDsgLy8gSW5jcmVhc2VkIGZvciBkZWJyaXMKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpPHRoaXMucG9vbFNpemU7IGkrKykgewogICAgICAgICAgICAgICAgLy8gQ3JlYXRlIHVuaXF1ZSBtYXRlcmlhbCBmb3IgZWFjaCBzcHJpdGUgdG8gcHJldmVudCBzdGF0ZSBzaGFyaW5nIChmbGlja2VyaW5nKQogICAgICAgICAgICAgICAgY29uc3QgbWF0ID0gdGhpcy5tYXRlcmlhbHMudmVub20uY2xvbmUoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNwcml0ZSA9IG5ldyBUSFJFRS5TcHJpdGUobWF0KTsgCiAgICAgICAgICAgICAgICBzcHJpdGUudmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgc3ByaXRlLnNjYWxlLnNldCgwLDAsMCk7IAogICAgICAgICAgICAgICAgdGhpcy5zY2VuZS5hZGQoc3ByaXRlKTsKICAgICAgICAgICAgICAgIHRoaXMucG9vbC5wdXNoKHNwcml0ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgpzcGF3bih0eXBlLCBwb3MsIG9wdGlvbnMgPSB7fSkgewogICAgICAgICAgICBjb25zdCBwID0gdGhpcy5wb29sLmZpbmQocyA9PiAhcy52aXNpYmxlKTsKICAgICAgICAgICAgaWYgKCFwKSByZXR1cm47CgogICAgICAgICAgICBwLnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQ29weSBwcm9wZXJ0aWVzIGZyb20gdGVtcGxhdGUgaW5zdGVhZCBvZiBzaGFyaW5nIHJlZmVyZW5jZQogICAgICAgICAgICBjb25zdCB0ZW1wbGF0ZSA9IHRoaXMubWF0ZXJpYWxzW3R5cGVdIHx8IHRoaXMubWF0ZXJpYWxzLnZlbm9tOwogICAgICAgICAgICBwLm1hdGVyaWFsLm1hcCA9IHRlbXBsYXRlLm1hcDsKICAgICAgICAgICAgcC5tYXRlcmlhbC5ibGVuZGluZyA9IHRlbXBsYXRlLmJsZW5kaW5nOwogICAgICAgICAgICBwLm1hdGVyaWFsLmRlcHRoV3JpdGUgPSB0ZW1wbGF0ZS5kZXB0aFdyaXRlOwogICAgICAgICAgICBwLm1hdGVyaWFsLnRyYW5zcGFyZW50ID0gdGVtcGxhdGUudHJhbnNwYXJlbnQ7CgogICAgICAgICAgICBwLnBvc2l0aW9uLmNvcHkocG9zKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFJlc2V0IHJvdGF0aW9uICYgY29sb3IKICAgICAgICAgICAgcC5tYXRlcmlhbC5yb3RhdGlvbiA9IDA7CiAgICAgICAgICAgIHAubWF0ZXJpYWwuY29sb3Iuc2V0SGV4KDB4ZmZmZmZmKTsKICAgICAgICAgICAgcC5tYXRlcmlhbC5vcGFjaXR5ID0gMS4wOwoKICAgICAgICAgICAgY29uc3QgZGF0YSA9IHsKCgogICAgICAgICAgICAgICAgbWVzaDogcCwKICAgICAgICAgICAgICAgIHR5cGU6IHR5cGUsCiAgICAgICAgICAgICAgICBhZ2U6IDAsCiAgICAgICAgICAgICAgICBsaWZlOiBvcHRpb25zLmxpZmUgfHwgMS4wLAogICAgICAgICAgICAgICAgbWF4TGlmZTogb3B0aW9ucy5saWZlIHx8IDEuMCwKICAgICAgICAgICAgICAgIHZlbG9jaXR5OiBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAwKSwKICAgICAgICAgICAgICAgIHN0YXJ0U2NhbGU6IG9wdGlvbnMuc2NhbGUgfHwgMS4wLAogICAgICAgICAgICAgICAgZ3Jhdml0eTogMCwKICAgICAgICAgICAgICAgIGRyYWc6IDAKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8vIENvbmZpZ3VyYXRpb24gcGVyIHR5cGUKICAgICAgICAgICAgaWYgKHR5cGUgPT09ICd2ZW5vbScpIHsKICAgICAgICAgICAgICAgIGRhdGEubGlmZSA9IDEuMCArIE1hdGgucmFuZG9tKCkgKiAwLjU7CiAgICAgICAgICAgICAgICBkYXRhLnZlbG9jaXR5LnNldCgwLCAxLjAgKyBNYXRoLnJhbmRvbSgpLCAwKTsKICAgICAgICAgICAgICAgIGRhdGEuc3RhcnRTY2FsZSA9IDAuMyArIE1hdGgucmFuZG9tKCkgKiAwLjI7CiAgICAgICAgICAgICAgICBwLm1hdGVyaWFsLm9wYWNpdHkgPSAwLjg7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnbmFwJykgewogICAgICAgICAgICAgICAgZGF0YS5saWZlID0gMi4wOwogICAgICAgICAgICAgICAgZGF0YS52ZWxvY2l0eS5zZXQoKE1hdGgucmFuZG9tKCktMC41KSowLjIsIDAuNSwgKE1hdGgucmFuZG9tKCktMC41KSowLjIpOwogICAgICAgICAgICAgICAgZGF0YS5zdGFydFNjYWxlID0gMC40OwogICAgICAgICAgICAgICAgcC5tYXRlcmlhbC5vcGFjaXR5ID0gMS4wOwoKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnd2l0aGVyJykgewogICAgICAgICAgICAgICAgZGF0YS5saWZlID0gMS41OwogICAgICAgICAgICAgICAgZGF0YS52ZWxvY2l0eS5zZXQoKE1hdGgucmFuZG9tKCktMC41KSowLjUsIDAuNSwgKE1hdGgucmFuZG9tKCktMC41KSowLjUpOwogICAgICAgICAgICAgICAgcC5tYXRlcmlhbC5vcGFjaXR5ID0gMC42OwogICAgICAgICAgICAgICAgcC5tYXRlcmlhbC5yb3RhdGlvbiA9IE1hdGgucmFuZG9tKCkgKiBNYXRoLlBJOwoKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnc2hvY2t3YXZlJykgewogICAgICAgICAgICAgICAgZGF0YS5saWZlID0gb3B0aW9ucy5saWZlIHx8IDAuNDsKICAgICAgICAgICAgICAgIGRhdGEubWF4TGlmZSA9IGRhdGEubGlmZTsKICAgICAgICAgICAgICAgIGRhdGEuc3RhcnRTY2FsZSA9IG9wdGlvbnMuc2NhbGUgfHwgMi4wOwogICAgICAgICAgICAgICAgcC5tYXRlcmlhbC5vcGFjaXR5ID0gMS4wOwogICAgICAgICAgICAgICAgLy8gU2hvY2t3YXZlcyBncm93IHJhcGlkbHkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdmbGFzaCcpIHsKICAgICAgICAgICAgICAgIGRhdGEubGlmZSA9IDAuMjsKICAgICAgICAgICAgICAgIGRhdGEubWF4TGlmZSA9IDAuMjsKICAgICAgICAgICAgICAgIGRhdGEuc3RhcnRTY2FsZSA9IG9wdGlvbnMuc2NhbGUgfHwgMy4wOwogICAgICAgICAgICAgICAgcC5tYXRlcmlhbC5vcGFjaXR5ID0gMS4wOwogICAgICAgICAgICAgICAgcC5tYXRlcmlhbC5yb3RhdGlvbiA9IE1hdGgucmFuZG9tKCkgKiBNYXRoLlBJOwoKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnZGVicmlzJykgewogICAgICAgICAgICAgICAgZGF0YS5saWZlID0gMS41OwogICAgICAgICAgICAgICAgZGF0YS5tYXhMaWZlID0gMS41OwogICAgICAgICAgICAgICAgY29uc3Qgc3BlZWQgPSA1LjAgKyBNYXRoLnJhbmRvbSgpICogMTAuMDsKICAgICAgICAgICAgICAgIGRhdGEudmVsb2NpdHkuc2V0KAogICAgICAgICAgICAgICAgICAgIChNYXRoLnJhbmRvbSgpLTAuNSkgKiBzcGVlZCwKICAgICAgICAgICAgICAgICAgICAoTWF0aC5yYW5kb20oKSAqIHNwZWVkICogMC41KSArIDIuMCwKICAgICAgICAgICAgICAgICAgICAoTWF0aC5yYW5kb20oKS0wLjUpICogc3BlZWQKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBkYXRhLmdyYXZpdHkgPSAyMC4wOwogICAgICAgICAgICAgICAgZGF0YS5kcmFnID0gMS4wOwogICAgICAgICAgICAgICAgZGF0YS5zdGFydFNjYWxlID0gKG9wdGlvbnMuc2NhbGUgfHwgMC4zKSAqICgwLjUgKyBNYXRoLnJhbmRvbSgpKTsKICAgICAgICAgICAgICAgIHAubWF0ZXJpYWwub3BhY2l0eSA9IDEuMDsKcC5tYXRlcmlhbC5vcGFjaXR5ID0gMS4wOwogICAgICAgICAgICAgICAgcC5tYXRlcmlhbC5yb3RhdGlvbiA9IE1hdGgucmFuZG9tKCkgKiBNYXRoLlBJOwogICAgICAgICAgICAgICAgZGF0YS5saWZlID0gMS4wICsgTWF0aC5yYW5kb20oKSAqIDEuMDsgLy8gTG9uZ2VyIGxpZmUKICAgICAgICAgICAgICAgIGRhdGEubWF4TGlmZSA9IGRhdGEubGlmZTsKICAgICAgICAgICAgICAgIGRhdGEudmVsb2NpdHkuc2V0KAogICAgICAgICAgICAgICAgICAgIChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDAuNSwgLy8gR2VudGxlIGRyaWZ0IFgKICAgICAgICAgICAgICAgICAgICAwLjUgKyBNYXRoLnJhbmRvbSgpICogMS4wLCAgIC8vIFJpc2UgWQogICAgICAgICAgICAgICAgICAgIChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDAuNSAgLy8gR2VudGxlIGRyaWZ0IFoKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBkYXRhLnN0YXJ0U2NhbGUgPSAob3B0aW9ucy5zY2FsZSB8fCAwLjIpICogKDAuOCArIE1hdGgucmFuZG9tKCkgKiAwLjQpOwogICAgICAgICAgICAgICAgcC5tYXRlcmlhbC5vcGFjaXR5ID0gMC42OyAvLyBNb3JlIHRyYW5zcGFyZW50CiAgICAgICAgICAgICAgICBwLm1hdGVyaWFsLmNvbG9yLnNldEhleCgweGFhY2NmZik7IC8vIFNsaWdodCBibHVlIHRpbnQKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnYnViYmxlX21pY3JvJykgewogICAgICAgICAgICAgICAgLy8gQ0FWSVRBVElPTiBCVUJCTEVTOiBGYXN0LCBzaG9ydC1saXZlZCwgYnJpZ2h0CiAgICAgICAgICAgICAgICBkYXRhLmxpZmUgPSAwLjQgKyBNYXRoLnJhbmRvbSgpICogMC40OwogICAgICAgICAgICAgICAgZGF0YS5tYXhMaWZlID0gZGF0YS5saWZlOwogICAgICAgICAgICAgICAgZGF0YS52ZWxvY2l0eS5zZXQoCiAgICAgICAgICAgICAgICAgICAgKE1hdGgucmFuZG9tKCkgLSAwLjUpICogMS41LCAvLyBKaXR0ZXJ5IFgKICAgICAgICAgICAgICAgICAgICAxLjUgKyBNYXRoLnJhbmRvbSgpICogMi4wLCAgIC8vIEZhc3QgUmlzZSBZCiAgICAgICAgICAgICAgICAgICAgKE1hdGgucmFuZG9tKCkgLSAwLjUpICogMS41ICAvLyBKaXR0ZXJ5IFoKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBkYXRhLnN0YXJ0U2NhbGUgPSAob3B0aW9ucy5zY2FsZSB8fCAwLjA4KSAqICgwLjggKyBNYXRoLnJhbmRvbSgpICogMC41KTsKICAgICAgICAgICAgICAgIHAubWF0ZXJpYWwub3BhY2l0eSA9IDAuOTsgLy8gSGlnaCB2aXNpYmlsaXR5CiAgICAgICAgICAgICAgICBwLm1hdGVyaWFsLmNvbG9yLnNldEhleCgweGZmZmZmZik7IC8vIFB1cmUgd2hpdGUvY3lhbiBjb3JlCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEFwcGx5IGluaXRpYWwgc2NhbGUKICAgICAgICAgICAgLy8gQXBwbHkgaW5pdGlhbCBzY2FsZQogICAgICAgICAgICBpZiAodHlwZSAhPT0gJ3Nob2Nrd2F2ZScpIHsKICAgICAgICAgICAgICAgIHAuc2NhbGUuc2V0U2NhbGFyKGRhdGEuc3RhcnRTY2FsZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBwLnNjYWxlLnNldFNjYWxhcigwLjEpOyAvLyBTaG9ja3dhdmVzIHN0YXJ0IHNtYWxsCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMucGFydGljbGVzLnB1c2goZGF0YSk7CiAgICAgICAgfQoKICAgICAgICB1cGRhdGUoZHQpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IHRoaXMucGFydGljbGVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwID0gdGhpcy5wYXJ0aWNsZXNbaV07CiAgICAgICAgICAgICAgICBwLmFnZSArPSBkdDsKCiAgICAgICAgICAgICAgICBpZiAocC5hZ2UgPj0gcC5saWZlKSB7CiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBwLm1lc2guc2NhbGUuc2V0KDAsMCwwKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcnRpY2xlcy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29uc3QgdCA9IHAuYWdlIC8gcC5saWZlOwoKICAgICAgICAgICAgICAgIC8vIFBoeXNpY3MKICAgICAgICAgICAgICAgIGlmIChwLmdyYXZpdHkgPiAwKSBwLnZlbG9jaXR5LnkgLT0gcC5ncmF2aXR5ICogZHQ7CiAgICAgICAgICAgICAgICBpZiAocC5kcmFnID4gMCkgcC52ZWxvY2l0eS5tdWx0aXBseVNjYWxhcihNYXRoLm1heCgwLCAxLjAgLSAocC5kcmFnICogZHQpKSk7CiAgICAgICAgICAgICAgICBwLm1lc2gucG9zaXRpb24uYWRkU2NhbGVkVmVjdG9yKHAudmVsb2NpdHksIGR0KTsKCiAgICAgICAgICAgICAgICAvLyBCZWhhdmlvcgogICAgICAgICAgICAgICAgaWYgKHAudHlwZSA9PT0gJ3Nob2Nrd2F2ZScpIHsKICAgICAgICAgICAgICAgICAgICAvLyBSYXBpZCBleHBhbnNpb24KICAgICAgICAgICAgICAgICAgICBjb25zdCBzID0gcC5zdGFydFNjYWxlICogTWF0aC5wb3codCwgMC41KSAqIDUuMDsgCiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLnNjYWxlLnNldFNjYWxhcihzKTsKICAgICAgICAgICAgICAgICAgICBwLm1lc2gubWF0ZXJpYWwub3BhY2l0eSA9IDEuMCAtIE1hdGgucG93KHQsIDIpOyAvLyBGYWRlIG91dAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwLnR5cGUgPT09ICdmbGFzaCcpIHsKICAgICAgICAgICAgICAgICAgICAvLyBRdWljayBwb3AKICAgICAgICAgICAgICAgICAgICBjb25zdCBzID0gcC5zdGFydFNjYWxlICogKDEuMCAtIHQpOwogICAgICAgICAgICAgICAgICAgIHAubWVzaC5zY2FsZS5zZXRTY2FsYXIocyk7CiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLm1hdGVyaWFsLnJvdGF0aW9uICs9IDUuMCAqIGR0OwoKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocC50eXBlID09PSAnZGVicmlzJykgewogICAgICAgICAgICAgICAgICAgIC8vIFNwaW4gYW5kIHNocmluawogICAgICAgICAgICAgICAgICAgIHAubWVzaC5tYXRlcmlhbC5yb3RhdGlvbiArPSAxMC4wICogZHQ7CiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLnNjYWxlLnNldFNjYWxhcihwLnN0YXJ0U2NhbGUgKiAoMS4wIC0gdCkpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwLnR5cGUgPT09ICd2ZW5vbScpIHsKICAgICAgICAgICAgICAgICAgICBwLm1lc2gucG9zaXRpb24ueCArPSBNYXRoLnNpbihwLmFnZSAqIDEwICsgcC5tZXNoLmlkKSAqIGR0ICogMC41OwogICAgICAgICAgICAgICAgICAgIHAubWVzaC5tYXRlcmlhbC5vcGFjaXR5ID0gMC44ICogKDEuMCAtIE1hdGgucG93KHQsIDMpKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocC50eXBlID09PSAnbmFwJykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHMgPSBwLnN0YXJ0U2NhbGUgKiAoMC41ICsgdCAqIDEuNSk7CiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLnNjYWxlLnNldFNjYWxhcihzKTsKICAgICAgICAgICAgICAgICAgICBwLm1lc2gubWF0ZXJpYWwub3BhY2l0eSA9IDEuMCAtIE1hdGgucG93KHQsIDIpOwpwLm1lc2gucG9zaXRpb24ueCArPSBNYXRoLnNpbihwLmFnZSAqIDIpICogZHQgKiAwLjM7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHAudHlwZSA9PT0gJ2J1YmJsZScpIHsKICAgICAgICAgICAgICAgICAgICAvLyBBZXN0aGV0aWMgV29iYmxlCiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLnBvc2l0aW9uLnggKz0gTWF0aC5zaW4ocC5hZ2UgKiA1LjAgKyBwLm1lc2guaWQpICogZHQgKiAwLjI7CiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLnBvc2l0aW9uLnogKz0gTWF0aC5jb3MocC5hZ2UgKiA0LjAgKyBwLm1lc2guaWQpICogZHQgKiAwLjI7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gU2NhbGUgdXAgc2xpZ2h0bHkgdGhlbiBmYWRlCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcyA9IHAuc3RhcnRTY2FsZSAqICgxLjAgKyB0ICogMC4yKTsKICAgICAgICAgICAgICAgICAgICBwLm1lc2guc2NhbGUuc2V0U2NhbGFyKHMpOwogICAgICAgICAgICAgICAgICAgIHAubWVzaC5tYXRlcmlhbC5vcGFjaXR5ID0gMC42ICogKDEuMCAtIE1hdGgucG93KHQsIDIpKTsgLy8gU21vb3RoIGZhZGUKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocC50eXBlID09PSAnYnViYmxlX21pY3JvJykgewogICAgICAgICAgICAgICAgICAgIC8vIENoYW90aWMgSml0dGVyCiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLnBvc2l0aW9uLnggKz0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogZHQgKiAyLjA7CiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLnBvc2l0aW9uLnogKz0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogZHQgKiAyLjA7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gU2hyaW5rIHJhcGlkbHkKICAgICAgICAgICAgICAgICAgICBjb25zdCBzID0gcC5zdGFydFNjYWxlICogKDEuMCAtIHQpOwogICAgICAgICAgICAgICAgICAgIHAubWVzaC5zY2FsZS5zZXRTY2FsYXIocyk7CiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLm1hdGVyaWFsLm9wYWNpdHkgPSAwLjkgKiAoMS4wIC0gdCk7IC8vIExpbmVhciBmYWRlCn0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIHdpbmRvdy5mbHV4LlBhcnRpY2xlTWFuYWdlciA9IFBhcnRpY2xlTWFuYWdlcjsKfSkoKTs=","./ParticleManager.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICAvLyAtLS0gVEVYVFVSRSBHRU5FUkFUT1JTIC0tLQogICAgCiAgICAvLyAxLiBWZW5vbSBCdWJibGUgKEdyZWVuLCBzaGlueSwgc2hhcnApCiAgICBjb25zdCBfdmVub21UZXggPSAoKCkgPT4gewogICAgICAgIGNvbnN0IGMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgICBjLndpZHRoID0gNjQ7IGMuaGVpZ2h0ID0gNjQ7CiAgICAgICAgY29uc3QgY3R4ID0gYy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgIGNvbnN0IGcgPSBjdHguY3JlYXRlUmFkaWFsR3JhZGllbnQoMzIsIDMyLCA0LCAzMiwgMzIsIDMwKTsKICAgICAgICBnLmFkZENvbG9yU3RvcCgwLCAncmdiYSgxNTAsIDI1NSwgMTAwLCAwLjkpJyk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMC44LCAncmdiYSgwLCAyMDAsIDAsIDAuNSknKTsKICAgICAgICBnLmFkZENvbG9yU3RvcCgxLCAncmdiYSgwLCA1MCwgMCwgMCknKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gZzsKICAgICAgICBjdHguYmVnaW5QYXRoKCk7IGN0eC5hcmMoMzIsIDMyLCAzMCwgMCwgTWF0aC5QSSoyKTsgY3R4LmZpbGwoKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC45KSc7CiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOyBjdHguYXJjKDIwLCAyMCwgNiwgMCwgTWF0aC5QSSoyKTsgY3R4LmZpbGwoKTsKICAgICAgICByZXR1cm4gbmV3IFRIUkVFLkNhbnZhc1RleHR1cmUoYyk7CiAgICB9KSgpOwoKICAgIC8vIDIuIFNsZWVwIFp6egogICAgY29uc3QgX25hcFRleCA9ICgoKSA9PiB7CiAgICAgICAgY29uc3QgYyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICAgIGMud2lkdGggPSA2NDsgYy5oZWlnaHQgPSA2NDsKICAgICAgICBjb25zdCBjdHggPSBjLmdldENvbnRleHQoJzJkJyk7CiAgICAgICAgY3R4LmZvbnQgPSAnYm9sZCBpdGFsaWMgNDhweCBzYW5zLXNlcmlmJzsKICAgICAgICBjdHguZmlsbFN0eWxlID0gJyNmZmZmZmYnOwogICAgICAgIGN0eC50ZXh0QWxpZ24gPSAnY2VudGVyJzsKICAgICAgICBjdHgudGV4dEJhc2VsaW5lID0gJ21pZGRsZSc7CiAgICAgICAgY3R4LnNoYWRvd0NvbG9yID0gJyMwMDAwZmYnOwogICAgICAgIGN0eC5zaGFkb3dCbHVyID0gNDsKICAgICAgICBjdHguZmlsbFRleHQoJ1onLCAzMiwgMzIpOwogICAgICAgIHJldHVybiBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICAgIH0pKCk7CgogICAgLy8gMy4gV2l0aGVyIFNtb2tlCiAgICBjb25zdCBfd2l0aGVyVGV4ID0gKCgpID0+IHsKICAgICAgICBjb25zdCBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgYy53aWR0aCA9IDY0OyBjLmhlaWdodCA9IDY0OwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjb25zdCBnID0gY3R4LmNyZWF0ZVJhZGlhbEdyYWRpZW50KDMyLCAzMiwgMCwgMzIsIDMyLCAzMik7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMCwgJ3JnYmEoODAsIDgwLCA4MCwgMC44KScpOwogICAgICAgIGcuYWRkQ29sb3JTdG9wKDAuNSwgJ3JnYmEoNDAsIDQwLCA0MCwgMC40KScpOwogICAgICAgIGcuYWRkQ29sb3JTdG9wKDEsICdyZ2JhKDAsIDAsIDAsIDApJyk7CiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGc7CiAgICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIDY0LCA2NCk7CiAgICAgICAgcmV0dXJuIG5ldyBUSFJFRS5DYW52YXNUZXh0dXJlKGMpOwogICAgfSkoKTsKCiAgICAvLyA0LiBTaG9ja3dhdmUgUmluZyAoTmV3KQogICAgY29uc3QgX3Nob2Nrd2F2ZVRleCA9ICgoKSA9PiB7CiAgICAgICAgY29uc3QgYyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICAgIGMud2lkdGggPSAxMjg7IGMuaGVpZ2h0ID0gMTI4OwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjb25zdCBjeCA9IDY0LCBjeSA9IDY0OwogICAgICAgIGNvbnN0IGcgPSBjdHguY3JlYXRlUmFkaWFsR3JhZGllbnQoY3gsIGN5LCA0MCwgY3gsIGN5LCA2MCk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMCwgJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMCknKTsKICAgICAgICBnLmFkZENvbG9yU3RvcCgwLjUsICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDEpJyk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMSwgJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMCknKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gZzsKICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgMTI4LCAxMjgpOwogICAgICAgIHJldHVybiBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICAgIH0pKCk7CgogICAgLy8gNS4gRmxhc2ggU3RhciAoTmV3KQogICAgY29uc3QgX2ZsYXNoVGV4ID0gKCgpID0+IHsKICAgICAgICBjb25zdCBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgYy53aWR0aCA9IDY0OyBjLmhlaWdodCA9IDY0OwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjb25zdCBjeCA9IDMyLCBjeSA9IDMyOwogICAgICAgIGN0eC5maWxsU3R5bGUgPSAnI2ZmZmZmZic7CiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgIGZvcihsZXQgaT0wOyBpPDQ7IGkrKykgewogICAgICAgICAgICBjb25zdCBhID0gKGkgKiBNYXRoLlBJIC8gMik7CiAgICAgICAgICAgIGN0eC5tb3ZlVG8oY3gsIGN5KTsKICAgICAgICAgICAgY3R4LmxpbmVUbyhjeCArIE1hdGguY29zKGEpKjMwLCBjeSArIE1hdGguc2luKGEpKjMwKTsKICAgICAgICAgICAgY3R4LmxpbmVUbyhjeCArIE1hdGguY29zKGEgKyAwLjIpKjEwLCBjeSArIE1hdGguc2luKGEgKyAwLjIpKjEwKTsKICAgICAgICB9CiAgICAgICAgY3R4LmZpbGwoKTsKICAgICAgICBjb25zdCBnID0gY3R4LmNyZWF0ZVJhZGlhbEdyYWRpZW50KGN4LCBjeSwgMCwgY3gsIGN5LCAyMCk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMCwgJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMSknKTsKICAgICAgICBnLmFkZENvbG9yU3RvcCgxLCAncmdiYSgyNTUsIDI1NSwgMjU1LCAwKScpOwogICAgICAgIGN0eC5maWxsU3R5bGUgPSBnOwogICAgICAgIGN0eC5iZWdpblBhdGgoKTsgY3R4LmFyYyhjeCwgY3ksIDIwLCAwLCBNYXRoLlBJKjIpOyBjdHguZmlsbCgpOwogICAgICAgIHJldHVybiBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICAgIH0pKCk7CgogICAgLy8gNi4gRGVicmlzIFNoYXJkIChOZXcpCiAgICBjb25zdCBfZGVicmlzVGV4ID0gKCgpID0+IHsKICAgICAgICBjb25zdCBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgYy53aWR0aCA9IDMyOyBjLmhlaWdodCA9IDMyOwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gJyNmZmZmZmYnOwogICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICBjdHgubW92ZVRvKDE2LCAwKTsgY3R4LmxpbmVUbygzMiwgMTYpOyBjdHgubGluZVRvKDE2LCAzMik7IGN0eC5saW5lVG8oMCwgMTYpOwogICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgcmV0dXJuIG5ldyBUSFJFRS5DYW52YXNUZXh0dXJlKGMpOwogICAgfSkoKTsKLy8gNy4gQnViYmxlIFRleHR1cmUgKE5ldzogQWVzdGhldGljICYgU3VidGxlKQovLyA3LiBCdWJibGUgVGV4dHVyZSAoTmV3OiBBZXN0aGV0aWMgJiBTdWJ0bGUpCiAgICBjb25zdCBfYnViYmxlVGV4ID0gKCgpID0+IHsKICAgICAgICBjb25zdCBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgYy53aWR0aCA9IDY0OyBjLmhlaWdodCA9IDY0OwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICAKICAgICAgICAvLyBDbGVhcgogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgNjQsIDY0KTsKCiAgICAgICAgLy8gTWFpbiBCdWJibGUgQm9keSAoU29mdCBHcmFkaWVudCkKICAgICAgICBjb25zdCBnID0gY3R4LmNyZWF0ZVJhZGlhbEdyYWRpZW50KDI4LCAyOCwgMCwgMzIsIDMyLCAzMCk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMCwgJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC4xKScpOwogICAgICAgIGcuYWRkQ29sb3JTdG9wKDAuNSwgJ3JnYmEoMTAwLCAyMjAsIDI1NSwgMC4yKScpOwogICAgICAgIGcuYWRkQ29sb3JTdG9wKDAuOSwgJ3JnYmEoNTAsIDE1MCwgMjU1LCAwLjQpJyk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMSwgJ3JnYmEoNTAsIDE1MCwgMjU1LCAwLjApJyk7IC8vIFNvZnQgZWRnZQogICAgICAgIAogICAgICAgIGN0eC5maWxsU3R5bGUgPSBnOwogICAgICAgIGN0eC5iZWdpblBhdGgoKTsgY3R4LmFyYygzMiwgMzIsIDMwLCAwLCBNYXRoLlBJKjIpOyBjdHguZmlsbCgpOwogICAgICAgIAogICAgICAgIC8vIFNoYXJwIFNwZWN1bGFyIEhpZ2hsaWdodCAoUmVmbGVjdGlvbikKICAgICAgICBjb25zdCBnMiA9IGN0eC5jcmVhdGVSYWRpYWxHcmFkaWVudCgyMCwgMjAsIDAsIDIwLCAyMCwgMTIpOwogICAgICAgIGcyLmFkZENvbG9yU3RvcCgwLCAncmdiYSgyNTUsIDI1NSwgMjU1LCAwLjkpJyk7CiAgICAgICAgZzIuYWRkQ29sb3JTdG9wKDEsICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMCknKTsKICAgICAgICAKICAgICAgICBjdHguZmlsbFN0eWxlID0gZzI7CiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOyAKICAgICAgICBjdHguZWxsaXBzZSgyMiwgMjIsIDEwLCA2LCAtTWF0aC5QSSAvIDQsIDAsIE1hdGguUEkgKiAyKTsgCiAgICAgICAgY3R4LmZpbGwoKTsKICAgICAgICAKICAgICAgICAvLyBCb3R0b20gUmltIExpZ2h0CiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gJ3JnYmEoMTUwLCAyNTUsIDI1NSwgMC4zKSc7CiAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDI7CiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOyBjdHguYXJjKDMyLCAzMiwgMjgsIDAuMiAqIE1hdGguUEksIDAuOCAqIE1hdGguUEkpOyBjdHguc3Ryb2tlKCk7CiAgICAgICAgCnJldHVybiBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICAgIH0pKCk7CgogICAgLy8gOC4gTWljcm8gQnViYmxlIChOZXc6IFNoYXJwLCBoaWdoLXZpcyBjYXZpdGF0aW9uKQogICAgY29uc3QgX21pY3JvQnViYmxlVGV4ID0gKCgpID0+IHsKICAgICAgICBjb25zdCBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgYy53aWR0aCA9IDMyOyBjLmhlaWdodCA9IDMyOwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIDMyLCAzMik7CiAgICAgICAgCiAgICAgICAgLy8gSW50ZW5zZSBicmlnaHQgY29yZQogICAgICAgIGNvbnN0IGcgPSBjdHguY3JlYXRlUmFkaWFsR3JhZGllbnQoMTYsIDE2LCAwLCAxNiwgMTYsIDE2KTsKICAgICAgICBnLmFkZENvbG9yU3RvcCgwLCAncmdiYSgyNTUsIDI1NSwgMjU1LCAxLjApJyk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMC4zLCAncmdiYSgyMjAsIDI1NSwgMjU1LCAwLjgpJyk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMC42LCAncmdiYSgxMDAsIDIwMCwgMjU1LCAwLjMpJyk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMS4wLCAncmdiYSgwLCAwLCAwLCAwKScpOwogICAgICAgIAogICAgICAgIGN0eC5maWxsU3R5bGUgPSBnOwogICAgICAgIGN0eC5iZWdpblBhdGgoKTsgY3R4LmFyYygxNiwgMTYsIDE2LCAwLCBNYXRoLlBJKjIpOyBjdHguZmlsbCgpOwogICAgICAgIHJldHVybiBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICAgIH0pKCk7CgogICAgY2xhc3MgUGFydGljbGVNYW5hZ2VyIHsKICAgICAgICBjb25zdHJ1Y3RvcihzY2VuZSkgewogICAgICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7CiAgICAgICAgICAgIHRoaXMucGFydGljbGVzID0gW107CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTaGFyZWQgTWF0ZXJpYWxzCiAgICAgICAgICAgIHRoaXMubWF0ZXJpYWxzID0gewogICAgICAgICAgICAgICAgdmVub206IG5ldyBUSFJFRS5TcHJpdGVNYXRlcmlhbCh7IG1hcDogX3Zlbm9tVGV4LCB0cmFuc3BhcmVudDogdHJ1ZSwgZGVwdGhXcml0ZTogZmFsc2UsIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nIH0pLAogICAgICAgICAgICAgICAgbmFwOiBuZXcgVEhSRUUuU3ByaXRlTWF0ZXJpYWwoeyBtYXA6IF9uYXBUZXgsIHRyYW5zcGFyZW50OiB0cnVlLCBkZXB0aFdyaXRlOiBmYWxzZSwgYmxlbmRpbmc6IFRIUkVFLk5vcm1hbEJsZW5kaW5nIH0pLAogICAgICAgICAgICAgICAgd2l0aGVyOiBuZXcgVEhSRUUuU3ByaXRlTWF0ZXJpYWwoeyBtYXA6IF93aXRoZXJUZXgsIHRyYW5zcGFyZW50OiB0cnVlLCBkZXB0aFdyaXRlOiBmYWxzZSwgYmxlbmRpbmc6IFRIUkVFLk5vcm1hbEJsZW5kaW5nIH0pLAogICAgICAgICAgICAgICAgbGVhcm5lZDogbmV3IFRIUkVFLlNwcml0ZU1hdGVyaWFsKHsgbWFwOiBfdmVub21UZXgsIGNvbG9yOiAweDAwZmZmZiwgdHJhbnNwYXJlbnQ6IHRydWUsIGRlcHRoV3JpdGU6IGZhbHNlLCBibGVuZGluZzogVEhSRUUuQWRkaXRpdmVCbGVuZGluZyB9KSwKICAgICAgICAgICAgICAgIHNob2Nrd2F2ZTogbmV3IFRIUkVFLlNwcml0ZU1hdGVyaWFsKHsgbWFwOiBfc2hvY2t3YXZlVGV4LCB0cmFuc3BhcmVudDogdHJ1ZSwgZGVwdGhXcml0ZTogZmFsc2UsIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nIH0pLAogICAgICAgICAgICAgICAgZmxhc2g6IG5ldyBUSFJFRS5TcHJpdGVNYXRlcmlhbCh7IG1hcDogX2ZsYXNoVGV4LCB0cmFuc3BhcmVudDogdHJ1ZSwgZGVwdGhXcml0ZTogZmFsc2UsIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nIH0pLAogICAgICAgICAgICAgICAgZGVicmlzOiBuZXcgVEhSRUUuU3ByaXRlTWF0ZXJpYWwoeyBtYXA6IF9kZWJyaXNUZXgsIHRyYW5zcGFyZW50OiB0cnVlLCBkZXB0aFdyaXRlOiBmYWxzZSwgYmxlbmRpbmc6IFRIUkVFLk5vcm1hbEJsZW5kaW5nIH0pLAogICAgICAgICAgICAgICAgYnViYmxlOiBuZXcgVEhSRUUuU3ByaXRlTWF0ZXJpYWwoeyBtYXA6IF9idWJibGVUZXgsIHRyYW5zcGFyZW50OiB0cnVlLCBkZXB0aFdyaXRlOiBmYWxzZSwgYmxlbmRpbmc6IFRIUkVFLkFkZGl0aXZlQmxlbmRpbmcgfSksCiAgICAgICAgICAgICAgICBidWJibGVfbWljcm86IG5ldyBUSFJFRS5TcHJpdGVNYXRlcmlhbCh7IG1hcDogX21pY3JvQnViYmxlVGV4LCB0cmFuc3BhcmVudDogdHJ1ZSwgZGVwdGhXcml0ZTogZmFsc2UsIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nIH0pCiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBPYmplY3QgUG9vbAovLyBPYmplY3QgUG9vbAogICAgICAgICAgICB0aGlzLnBvb2wgPSBbXTsKICAgICAgICAgICAgdGhpcy5wb29sU2l6ZSA9IDMwMDsgLy8gSW5jcmVhc2VkIGZvciBkZWJyaXMKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpPHRoaXMucG9vbFNpemU7IGkrKykgewogICAgICAgICAgICAgICAgLy8gQ3JlYXRlIHVuaXF1ZSBtYXRlcmlhbCBmb3IgZWFjaCBzcHJpdGUgdG8gcHJldmVudCBzdGF0ZSBzaGFyaW5nIChmbGlja2VyaW5nKQogICAgICAgICAgICAgICAgY29uc3QgbWF0ID0gdGhpcy5tYXRlcmlhbHMudmVub20uY2xvbmUoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNwcml0ZSA9IG5ldyBUSFJFRS5TcHJpdGUobWF0KTsgCiAgICAgICAgICAgICAgICBzcHJpdGUudmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgc3ByaXRlLnNjYWxlLnNldCgwLDAsMCk7IAogICAgICAgICAgICAgICAgdGhpcy5zY2VuZS5hZGQoc3ByaXRlKTsKICAgICAgICAgICAgICAgIHRoaXMucG9vbC5wdXNoKHNwcml0ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgpzcGF3bih0eXBlLCBwb3MsIG9wdGlvbnMgPSB7fSkgewogICAgICAgICAgICBjb25zdCBwID0gdGhpcy5wb29sLmZpbmQocyA9PiAhcy52aXNpYmxlKTsKICAgICAgICAgICAgaWYgKCFwKSByZXR1cm47CgogICAgICAgICAgICBwLnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQ29weSBwcm9wZXJ0aWVzIGZyb20gdGVtcGxhdGUgaW5zdGVhZCBvZiBzaGFyaW5nIHJlZmVyZW5jZQogICAgICAgICAgICBjb25zdCB0ZW1wbGF0ZSA9IHRoaXMubWF0ZXJpYWxzW3R5cGVdIHx8IHRoaXMubWF0ZXJpYWxzLnZlbm9tOwogICAgICAgICAgICBwLm1hdGVyaWFsLm1hcCA9IHRlbXBsYXRlLm1hcDsKICAgICAgICAgICAgcC5tYXRlcmlhbC5ibGVuZGluZyA9IHRlbXBsYXRlLmJsZW5kaW5nOwogICAgICAgICAgICBwLm1hdGVyaWFsLmRlcHRoV3JpdGUgPSB0ZW1wbGF0ZS5kZXB0aFdyaXRlOwogICAgICAgICAgICBwLm1hdGVyaWFsLnRyYW5zcGFyZW50ID0gdGVtcGxhdGUudHJhbnNwYXJlbnQ7CgogICAgICAgICAgICBwLnBvc2l0aW9uLmNvcHkocG9zKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFJlc2V0IHJvdGF0aW9uICYgY29sb3IKICAgICAgICAgICAgcC5tYXRlcmlhbC5yb3RhdGlvbiA9IDA7CiAgICAgICAgICAgIHAubWF0ZXJpYWwuY29sb3Iuc2V0SGV4KDB4ZmZmZmZmKTsKICAgICAgICAgICAgcC5tYXRlcmlhbC5vcGFjaXR5ID0gMS4wOwoKICAgICAgICAgICAgY29uc3QgZGF0YSA9IHsKCgogICAgICAgICAgICAgICAgbWVzaDogcCwKICAgICAgICAgICAgICAgIHR5cGU6IHR5cGUsCiAgICAgICAgICAgICAgICBhZ2U6IDAsCiAgICAgICAgICAgICAgICBsaWZlOiBvcHRpb25zLmxpZmUgfHwgMS4wLAogICAgICAgICAgICAgICAgbWF4TGlmZTogb3B0aW9ucy5saWZlIHx8IDEuMCwKICAgICAgICAgICAgICAgIHZlbG9jaXR5OiBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAwKSwKICAgICAgICAgICAgICAgIHN0YXJ0U2NhbGU6IG9wdGlvbnMuc2NhbGUgfHwgMS4wLAogICAgICAgICAgICAgICAgZ3Jhdml0eTogMCwKICAgICAgICAgICAgICAgIGRyYWc6IDAKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8vIENvbmZpZ3VyYXRpb24gcGVyIHR5cGUKICAgICAgICAgICAgaWYgKHR5cGUgPT09ICd2ZW5vbScpIHsKICAgICAgICAgICAgICAgIGRhdGEubGlmZSA9IDEuMCArIE1hdGgucmFuZG9tKCkgKiAwLjU7CiAgICAgICAgICAgICAgICBkYXRhLnZlbG9jaXR5LnNldCgwLCAxLjAgKyBNYXRoLnJhbmRvbSgpLCAwKTsKICAgICAgICAgICAgICAgIGRhdGEuc3RhcnRTY2FsZSA9IDAuMyArIE1hdGgucmFuZG9tKCkgKiAwLjI7CiAgICAgICAgICAgICAgICBwLm1hdGVyaWFsLm9wYWNpdHkgPSAwLjg7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnbmFwJykgewogICAgICAgICAgICAgICAgZGF0YS5saWZlID0gMi4wOwogICAgICAgICAgICAgICAgZGF0YS52ZWxvY2l0eS5zZXQoKE1hdGgucmFuZG9tKCktMC41KSowLjIsIDAuNSwgKE1hdGgucmFuZG9tKCktMC41KSowLjIpOwogICAgICAgICAgICAgICAgZGF0YS5zdGFydFNjYWxlID0gMC40OwogICAgICAgICAgICAgICAgcC5tYXRlcmlhbC5vcGFjaXR5ID0gMS4wOwoKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnd2l0aGVyJykgewogICAgICAgICAgICAgICAgZGF0YS5saWZlID0gMS41OwogICAgICAgICAgICAgICAgZGF0YS52ZWxvY2l0eS5zZXQoKE1hdGgucmFuZG9tKCktMC41KSowLjUsIDAuNSwgKE1hdGgucmFuZG9tKCktMC41KSowLjUpOwogICAgICAgICAgICAgICAgcC5tYXRlcmlhbC5vcGFjaXR5ID0gMC42OwogICAgICAgICAgICAgICAgcC5tYXRlcmlhbC5yb3RhdGlvbiA9IE1hdGgucmFuZG9tKCkgKiBNYXRoLlBJOwoKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnc2hvY2t3YXZlJykgewogICAgICAgICAgICAgICAgZGF0YS5saWZlID0gb3B0aW9ucy5saWZlIHx8IDAuNDsKICAgICAgICAgICAgICAgIGRhdGEubWF4TGlmZSA9IGRhdGEubGlmZTsKICAgICAgICAgICAgICAgIGRhdGEuc3RhcnRTY2FsZSA9IG9wdGlvbnMuc2NhbGUgfHwgMi4wOwogICAgICAgICAgICAgICAgcC5tYXRlcmlhbC5vcGFjaXR5ID0gMS4wOwogICAgICAgICAgICAgICAgLy8gU2hvY2t3YXZlcyBncm93IHJhcGlkbHkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdmbGFzaCcpIHsKICAgICAgICAgICAgICAgIGRhdGEubGlmZSA9IDAuMjsKICAgICAgICAgICAgICAgIGRhdGEubWF4TGlmZSA9IDAuMjsKICAgICAgICAgICAgICAgIGRhdGEuc3RhcnRTY2FsZSA9IG9wdGlvbnMuc2NhbGUgfHwgMy4wOwogICAgICAgICAgICAgICAgcC5tYXRlcmlhbC5vcGFjaXR5ID0gMS4wOwogICAgICAgICAgICAgICAgcC5tYXRlcmlhbC5yb3RhdGlvbiA9IE1hdGgucmFuZG9tKCkgKiBNYXRoLlBJOwoKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnZGVicmlzJykgewogICAgICAgICAgICAgICAgZGF0YS5saWZlID0gMS41OwogICAgICAgICAgICAgICAgZGF0YS5tYXhMaWZlID0gMS41OwogICAgICAgICAgICAgICAgY29uc3Qgc3BlZWQgPSA1LjAgKyBNYXRoLnJhbmRvbSgpICogMTAuMDsKICAgICAgICAgICAgICAgIGRhdGEudmVsb2NpdHkuc2V0KAogICAgICAgICAgICAgICAgICAgIChNYXRoLnJhbmRvbSgpLTAuNSkgKiBzcGVlZCwKICAgICAgICAgICAgICAgICAgICAoTWF0aC5yYW5kb20oKSAqIHNwZWVkICogMC41KSArIDIuMCwKICAgICAgICAgICAgICAgICAgICAoTWF0aC5yYW5kb20oKS0wLjUpICogc3BlZWQKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBkYXRhLmdyYXZpdHkgPSAyMC4wOwogICAgICAgICAgICAgICAgZGF0YS5kcmFnID0gMS4wOwogICAgICAgICAgICAgICAgZGF0YS5zdGFydFNjYWxlID0gKG9wdGlvbnMuc2NhbGUgfHwgMC4zKSAqICgwLjUgKyBNYXRoLnJhbmRvbSgpKTsKICAgICAgICAgICAgICAgIHAubWF0ZXJpYWwub3BhY2l0eSA9IDEuMDsKcC5tYXRlcmlhbC5vcGFjaXR5ID0gMS4wOwogICAgICAgICAgICAgICAgcC5tYXRlcmlhbC5yb3RhdGlvbiA9IE1hdGgucmFuZG9tKCkgKiBNYXRoLlBJOwogICAgICAgICAgICAgICAgZGF0YS5saWZlID0gMS4wICsgTWF0aC5yYW5kb20oKSAqIDEuMDsgLy8gTG9uZ2VyIGxpZmUKICAgICAgICAgICAgICAgIGRhdGEubWF4TGlmZSA9IGRhdGEubGlmZTsKICAgICAgICAgICAgICAgIGRhdGEudmVsb2NpdHkuc2V0KAogICAgICAgICAgICAgICAgICAgIChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDAuNSwgLy8gR2VudGxlIGRyaWZ0IFgKICAgICAgICAgICAgICAgICAgICAwLjUgKyBNYXRoLnJhbmRvbSgpICogMS4wLCAgIC8vIFJpc2UgWQogICAgICAgICAgICAgICAgICAgIChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDAuNSAgLy8gR2VudGxlIGRyaWZ0IFoKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBkYXRhLnN0YXJ0U2NhbGUgPSAob3B0aW9ucy5zY2FsZSB8fCAwLjIpICogKDAuOCArIE1hdGgucmFuZG9tKCkgKiAwLjQpOwogICAgICAgICAgICAgICAgcC5tYXRlcmlhbC5vcGFjaXR5ID0gMC42OyAvLyBNb3JlIHRyYW5zcGFyZW50CiAgICAgICAgICAgICAgICBwLm1hdGVyaWFsLmNvbG9yLnNldEhleCgweGFhY2NmZik7IC8vIFNsaWdodCBibHVlIHRpbnQKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnYnViYmxlX21pY3JvJykgewogICAgICAgICAgICAgICAgLy8gQ0FWSVRBVElPTiBCVUJCTEVTOiBGYXN0LCBzaG9ydC1saXZlZCwgYnJpZ2h0CiAgICAgICAgICAgICAgICBkYXRhLmxpZmUgPSAwLjQgKyBNYXRoLnJhbmRvbSgpICogMC40OwogICAgICAgICAgICAgICAgZGF0YS5tYXhMaWZlID0gZGF0YS5saWZlOwogICAgICAgICAgICAgICAgZGF0YS52ZWxvY2l0eS5zZXQoCiAgICAgICAgICAgICAgICAgICAgKE1hdGgucmFuZG9tKCkgLSAwLjUpICogMS41LCAvLyBKaXR0ZXJ5IFgKICAgICAgICAgICAgICAgICAgICAxLjUgKyBNYXRoLnJhbmRvbSgpICogMi4wLCAgIC8vIEZhc3QgUmlzZSBZCiAgICAgICAgICAgICAgICAgICAgKE1hdGgucmFuZG9tKCkgLSAwLjUpICogMS41ICAvLyBKaXR0ZXJ5IFoKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBkYXRhLnN0YXJ0U2NhbGUgPSAob3B0aW9ucy5zY2FsZSB8fCAwLjA4KSAqICgwLjggKyBNYXRoLnJhbmRvbSgpICogMC41KTsKICAgICAgICAgICAgICAgIHAubWF0ZXJpYWwub3BhY2l0eSA9IDAuOTsgLy8gSGlnaCB2aXNpYmlsaXR5CiAgICAgICAgICAgICAgICBwLm1hdGVyaWFsLmNvbG9yLnNldEhleCgweGZmZmZmZik7IC8vIFB1cmUgd2hpdGUvY3lhbiBjb3JlCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEFwcGx5IGluaXRpYWwgc2NhbGUKICAgICAgICAgICAgLy8gQXBwbHkgaW5pdGlhbCBzY2FsZQogICAgICAgICAgICBpZiAodHlwZSAhPT0gJ3Nob2Nrd2F2ZScpIHsKICAgICAgICAgICAgICAgIHAuc2NhbGUuc2V0U2NhbGFyKGRhdGEuc3RhcnRTY2FsZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBwLnNjYWxlLnNldFNjYWxhcigwLjEpOyAvLyBTaG9ja3dhdmVzIHN0YXJ0IHNtYWxsCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMucGFydGljbGVzLnB1c2goZGF0YSk7CiAgICAgICAgfQoKICAgICAgICB1cGRhdGUoZHQpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IHRoaXMucGFydGljbGVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwID0gdGhpcy5wYXJ0aWNsZXNbaV07CiAgICAgICAgICAgICAgICBwLmFnZSArPSBkdDsKCiAgICAgICAgICAgICAgICBpZiAocC5hZ2UgPj0gcC5saWZlKSB7CiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBwLm1lc2guc2NhbGUuc2V0KDAsMCwwKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcnRpY2xlcy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29uc3QgdCA9IHAuYWdlIC8gcC5saWZlOwoKICAgICAgICAgICAgICAgIC8vIFBoeXNpY3MKICAgICAgICAgICAgICAgIGlmIChwLmdyYXZpdHkgPiAwKSBwLnZlbG9jaXR5LnkgLT0gcC5ncmF2aXR5ICogZHQ7CiAgICAgICAgICAgICAgICBpZiAocC5kcmFnID4gMCkgcC52ZWxvY2l0eS5tdWx0aXBseVNjYWxhcihNYXRoLm1heCgwLCAxLjAgLSAocC5kcmFnICogZHQpKSk7CiAgICAgICAgICAgICAgICBwLm1lc2gucG9zaXRpb24uYWRkU2NhbGVkVmVjdG9yKHAudmVsb2NpdHksIGR0KTsKCiAgICAgICAgICAgICAgICAvLyBCZWhhdmlvcgogICAgICAgICAgICAgICAgaWYgKHAudHlwZSA9PT0gJ3Nob2Nrd2F2ZScpIHsKICAgICAgICAgICAgICAgICAgICAvLyBSYXBpZCBleHBhbnNpb24KICAgICAgICAgICAgICAgICAgICBjb25zdCBzID0gcC5zdGFydFNjYWxlICogTWF0aC5wb3codCwgMC41KSAqIDUuMDsgCiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLnNjYWxlLnNldFNjYWxhcihzKTsKICAgICAgICAgICAgICAgICAgICBwLm1lc2gubWF0ZXJpYWwub3BhY2l0eSA9IDEuMCAtIE1hdGgucG93KHQsIDIpOyAvLyBGYWRlIG91dAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwLnR5cGUgPT09ICdmbGFzaCcpIHsKICAgICAgICAgICAgICAgICAgICAvLyBRdWljayBwb3AKICAgICAgICAgICAgICAgICAgICBjb25zdCBzID0gcC5zdGFydFNjYWxlICogKDEuMCAtIHQpOwogICAgICAgICAgICAgICAgICAgIHAubWVzaC5zY2FsZS5zZXRTY2FsYXIocyk7CiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLm1hdGVyaWFsLnJvdGF0aW9uICs9IDUuMCAqIGR0OwoKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocC50eXBlID09PSAnZGVicmlzJykgewogICAgICAgICAgICAgICAgICAgIC8vIFNwaW4gYW5kIHNocmluawogICAgICAgICAgICAgICAgICAgIHAubWVzaC5tYXRlcmlhbC5yb3RhdGlvbiArPSAxMC4wICogZHQ7CiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLnNjYWxlLnNldFNjYWxhcihwLnN0YXJ0U2NhbGUgKiAoMS4wIC0gdCkpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwLnR5cGUgPT09ICd2ZW5vbScpIHsKICAgICAgICAgICAgICAgICAgICBwLm1lc2gucG9zaXRpb24ueCArPSBNYXRoLnNpbihwLmFnZSAqIDEwICsgcC5tZXNoLmlkKSAqIGR0ICogMC41OwogICAgICAgICAgICAgICAgICAgIHAubWVzaC5tYXRlcmlhbC5vcGFjaXR5ID0gMC44ICogKDEuMCAtIE1hdGgucG93KHQsIDMpKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocC50eXBlID09PSAnbmFwJykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHMgPSBwLnN0YXJ0U2NhbGUgKiAoMC41ICsgdCAqIDEuNSk7CiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLnNjYWxlLnNldFNjYWxhcihzKTsKICAgICAgICAgICAgICAgICAgICBwLm1lc2gubWF0ZXJpYWwub3BhY2l0eSA9IDEuMCAtIE1hdGgucG93KHQsIDIpOwpwLm1lc2gucG9zaXRpb24ueCArPSBNYXRoLnNpbihwLmFnZSAqIDIpICogZHQgKiAwLjM7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHAudHlwZSA9PT0gJ2J1YmJsZScpIHsKICAgICAgICAgICAgICAgICAgICAvLyBBZXN0aGV0aWMgV29iYmxlCiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLnBvc2l0aW9uLnggKz0gTWF0aC5zaW4ocC5hZ2UgKiA1LjAgKyBwLm1lc2guaWQpICogZHQgKiAwLjI7CiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLnBvc2l0aW9uLnogKz0gTWF0aC5jb3MocC5hZ2UgKiA0LjAgKyBwLm1lc2guaWQpICogZHQgKiAwLjI7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gU2NhbGUgdXAgc2xpZ2h0bHkgdGhlbiBmYWRlCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcyA9IHAuc3RhcnRTY2FsZSAqICgxLjAgKyB0ICogMC4yKTsKICAgICAgICAgICAgICAgICAgICBwLm1lc2guc2NhbGUuc2V0U2NhbGFyKHMpOwogICAgICAgICAgICAgICAgICAgIHAubWVzaC5tYXRlcmlhbC5vcGFjaXR5ID0gMC42ICogKDEuMCAtIE1hdGgucG93KHQsIDIpKTsgLy8gU21vb3RoIGZhZGUKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocC50eXBlID09PSAnYnViYmxlX21pY3JvJykgewogICAgICAgICAgICAgICAgICAgIC8vIENoYW90aWMgSml0dGVyCiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLnBvc2l0aW9uLnggKz0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogZHQgKiAyLjA7CiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLnBvc2l0aW9uLnogKz0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogZHQgKiAyLjA7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gU2hyaW5rIHJhcGlkbHkKICAgICAgICAgICAgICAgICAgICBjb25zdCBzID0gcC5zdGFydFNjYWxlICogKDEuMCAtIHQpOwogICAgICAgICAgICAgICAgICAgIHAubWVzaC5zY2FsZS5zZXRTY2FsYXIocyk7CiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLm1hdGVyaWFsLm9wYWNpdHkgPSAwLjkgKiAoMS4wIC0gdCk7IC8vIExpbmVhciBmYWRlCn0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIHdpbmRvdy5mbHV4LlBhcnRpY2xlTWFuYWdlciA9IFBhcnRpY2xlTWFuYWdlcjsKfSkoKTs=","/ParticleManager.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICAvLyAtLS0gVEVYVFVSRSBHRU5FUkFUT1JTIC0tLQogICAgCiAgICAvLyAxLiBWZW5vbSBCdWJibGUgKEdyZWVuLCBzaGlueSwgc2hhcnApCiAgICBjb25zdCBfdmVub21UZXggPSAoKCkgPT4gewogICAgICAgIGNvbnN0IGMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgICBjLndpZHRoID0gNjQ7IGMuaGVpZ2h0ID0gNjQ7CiAgICAgICAgY29uc3QgY3R4ID0gYy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgIGNvbnN0IGcgPSBjdHguY3JlYXRlUmFkaWFsR3JhZGllbnQoMzIsIDMyLCA0LCAzMiwgMzIsIDMwKTsKICAgICAgICBnLmFkZENvbG9yU3RvcCgwLCAncmdiYSgxNTAsIDI1NSwgMTAwLCAwLjkpJyk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMC44LCAncmdiYSgwLCAyMDAsIDAsIDAuNSknKTsKICAgICAgICBnLmFkZENvbG9yU3RvcCgxLCAncmdiYSgwLCA1MCwgMCwgMCknKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gZzsKICAgICAgICBjdHguYmVnaW5QYXRoKCk7IGN0eC5hcmMoMzIsIDMyLCAzMCwgMCwgTWF0aC5QSSoyKTsgY3R4LmZpbGwoKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC45KSc7CiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOyBjdHguYXJjKDIwLCAyMCwgNiwgMCwgTWF0aC5QSSoyKTsgY3R4LmZpbGwoKTsKICAgICAgICByZXR1cm4gbmV3IFRIUkVFLkNhbnZhc1RleHR1cmUoYyk7CiAgICB9KSgpOwoKICAgIC8vIDIuIFNsZWVwIFp6egogICAgY29uc3QgX25hcFRleCA9ICgoKSA9PiB7CiAgICAgICAgY29uc3QgYyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICAgIGMud2lkdGggPSA2NDsgYy5oZWlnaHQgPSA2NDsKICAgICAgICBjb25zdCBjdHggPSBjLmdldENvbnRleHQoJzJkJyk7CiAgICAgICAgY3R4LmZvbnQgPSAnYm9sZCBpdGFsaWMgNDhweCBzYW5zLXNlcmlmJzsKICAgICAgICBjdHguZmlsbFN0eWxlID0gJyNmZmZmZmYnOwogICAgICAgIGN0eC50ZXh0QWxpZ24gPSAnY2VudGVyJzsKICAgICAgICBjdHgudGV4dEJhc2VsaW5lID0gJ21pZGRsZSc7CiAgICAgICAgY3R4LnNoYWRvd0NvbG9yID0gJyMwMDAwZmYnOwogICAgICAgIGN0eC5zaGFkb3dCbHVyID0gNDsKICAgICAgICBjdHguZmlsbFRleHQoJ1onLCAzMiwgMzIpOwogICAgICAgIHJldHVybiBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICAgIH0pKCk7CgogICAgLy8gMy4gV2l0aGVyIFNtb2tlCiAgICBjb25zdCBfd2l0aGVyVGV4ID0gKCgpID0+IHsKICAgICAgICBjb25zdCBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgYy53aWR0aCA9IDY0OyBjLmhlaWdodCA9IDY0OwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjb25zdCBnID0gY3R4LmNyZWF0ZVJhZGlhbEdyYWRpZW50KDMyLCAzMiwgMCwgMzIsIDMyLCAzMik7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMCwgJ3JnYmEoODAsIDgwLCA4MCwgMC44KScpOwogICAgICAgIGcuYWRkQ29sb3JTdG9wKDAuNSwgJ3JnYmEoNDAsIDQwLCA0MCwgMC40KScpOwogICAgICAgIGcuYWRkQ29sb3JTdG9wKDEsICdyZ2JhKDAsIDAsIDAsIDApJyk7CiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGc7CiAgICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIDY0LCA2NCk7CiAgICAgICAgcmV0dXJuIG5ldyBUSFJFRS5DYW52YXNUZXh0dXJlKGMpOwogICAgfSkoKTsKCiAgICAvLyA0LiBTaG9ja3dhdmUgUmluZyAoTmV3KQogICAgY29uc3QgX3Nob2Nrd2F2ZVRleCA9ICgoKSA9PiB7CiAgICAgICAgY29uc3QgYyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICAgIGMud2lkdGggPSAxMjg7IGMuaGVpZ2h0ID0gMTI4OwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjb25zdCBjeCA9IDY0LCBjeSA9IDY0OwogICAgICAgIGNvbnN0IGcgPSBjdHguY3JlYXRlUmFkaWFsR3JhZGllbnQoY3gsIGN5LCA0MCwgY3gsIGN5LCA2MCk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMCwgJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMCknKTsKICAgICAgICBnLmFkZENvbG9yU3RvcCgwLjUsICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDEpJyk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMSwgJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMCknKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gZzsKICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgMTI4LCAxMjgpOwogICAgICAgIHJldHVybiBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICAgIH0pKCk7CgogICAgLy8gNS4gRmxhc2ggU3RhciAoTmV3KQogICAgY29uc3QgX2ZsYXNoVGV4ID0gKCgpID0+IHsKICAgICAgICBjb25zdCBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgYy53aWR0aCA9IDY0OyBjLmhlaWdodCA9IDY0OwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjb25zdCBjeCA9IDMyLCBjeSA9IDMyOwogICAgICAgIGN0eC5maWxsU3R5bGUgPSAnI2ZmZmZmZic7CiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgIGZvcihsZXQgaT0wOyBpPDQ7IGkrKykgewogICAgICAgICAgICBjb25zdCBhID0gKGkgKiBNYXRoLlBJIC8gMik7CiAgICAgICAgICAgIGN0eC5tb3ZlVG8oY3gsIGN5KTsKICAgICAgICAgICAgY3R4LmxpbmVUbyhjeCArIE1hdGguY29zKGEpKjMwLCBjeSArIE1hdGguc2luKGEpKjMwKTsKICAgICAgICAgICAgY3R4LmxpbmVUbyhjeCArIE1hdGguY29zKGEgKyAwLjIpKjEwLCBjeSArIE1hdGguc2luKGEgKyAwLjIpKjEwKTsKICAgICAgICB9CiAgICAgICAgY3R4LmZpbGwoKTsKICAgICAgICBjb25zdCBnID0gY3R4LmNyZWF0ZVJhZGlhbEdyYWRpZW50KGN4LCBjeSwgMCwgY3gsIGN5LCAyMCk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMCwgJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMSknKTsKICAgICAgICBnLmFkZENvbG9yU3RvcCgxLCAncmdiYSgyNTUsIDI1NSwgMjU1LCAwKScpOwogICAgICAgIGN0eC5maWxsU3R5bGUgPSBnOwogICAgICAgIGN0eC5iZWdpblBhdGgoKTsgY3R4LmFyYyhjeCwgY3ksIDIwLCAwLCBNYXRoLlBJKjIpOyBjdHguZmlsbCgpOwogICAgICAgIHJldHVybiBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICAgIH0pKCk7CgogICAgLy8gNi4gRGVicmlzIFNoYXJkIChOZXcpCiAgICBjb25zdCBfZGVicmlzVGV4ID0gKCgpID0+IHsKICAgICAgICBjb25zdCBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgYy53aWR0aCA9IDMyOyBjLmhlaWdodCA9IDMyOwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gJyNmZmZmZmYnOwogICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICBjdHgubW92ZVRvKDE2LCAwKTsgY3R4LmxpbmVUbygzMiwgMTYpOyBjdHgubGluZVRvKDE2LCAzMik7IGN0eC5saW5lVG8oMCwgMTYpOwogICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgcmV0dXJuIG5ldyBUSFJFRS5DYW52YXNUZXh0dXJlKGMpOwogICAgfSkoKTsKLy8gNy4gQnViYmxlIFRleHR1cmUgKE5ldzogQWVzdGhldGljICYgU3VidGxlKQovLyA3LiBCdWJibGUgVGV4dHVyZSAoTmV3OiBBZXN0aGV0aWMgJiBTdWJ0bGUpCiAgICBjb25zdCBfYnViYmxlVGV4ID0gKCgpID0+IHsKICAgICAgICBjb25zdCBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgYy53aWR0aCA9IDY0OyBjLmhlaWdodCA9IDY0OwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICAKICAgICAgICAvLyBDbGVhcgogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgNjQsIDY0KTsKCiAgICAgICAgLy8gTWFpbiBCdWJibGUgQm9keSAoU29mdCBHcmFkaWVudCkKICAgICAgICBjb25zdCBnID0gY3R4LmNyZWF0ZVJhZGlhbEdyYWRpZW50KDI4LCAyOCwgMCwgMzIsIDMyLCAzMCk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMCwgJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC4xKScpOwogICAgICAgIGcuYWRkQ29sb3JTdG9wKDAuNSwgJ3JnYmEoMTAwLCAyMjAsIDI1NSwgMC4yKScpOwogICAgICAgIGcuYWRkQ29sb3JTdG9wKDAuOSwgJ3JnYmEoNTAsIDE1MCwgMjU1LCAwLjQpJyk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMSwgJ3JnYmEoNTAsIDE1MCwgMjU1LCAwLjApJyk7IC8vIFNvZnQgZWRnZQogICAgICAgIAogICAgICAgIGN0eC5maWxsU3R5bGUgPSBnOwogICAgICAgIGN0eC5iZWdpblBhdGgoKTsgY3R4LmFyYygzMiwgMzIsIDMwLCAwLCBNYXRoLlBJKjIpOyBjdHguZmlsbCgpOwogICAgICAgIAogICAgICAgIC8vIFNoYXJwIFNwZWN1bGFyIEhpZ2hsaWdodCAoUmVmbGVjdGlvbikKICAgICAgICBjb25zdCBnMiA9IGN0eC5jcmVhdGVSYWRpYWxHcmFkaWVudCgyMCwgMjAsIDAsIDIwLCAyMCwgMTIpOwogICAgICAgIGcyLmFkZENvbG9yU3RvcCgwLCAncmdiYSgyNTUsIDI1NSwgMjU1LCAwLjkpJyk7CiAgICAgICAgZzIuYWRkQ29sb3JTdG9wKDEsICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMCknKTsKICAgICAgICAKICAgICAgICBjdHguZmlsbFN0eWxlID0gZzI7CiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOyAKICAgICAgICBjdHguZWxsaXBzZSgyMiwgMjIsIDEwLCA2LCAtTWF0aC5QSSAvIDQsIDAsIE1hdGguUEkgKiAyKTsgCiAgICAgICAgY3R4LmZpbGwoKTsKICAgICAgICAKICAgICAgICAvLyBCb3R0b20gUmltIExpZ2h0CiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gJ3JnYmEoMTUwLCAyNTUsIDI1NSwgMC4zKSc7CiAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDI7CiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOyBjdHguYXJjKDMyLCAzMiwgMjgsIDAuMiAqIE1hdGguUEksIDAuOCAqIE1hdGguUEkpOyBjdHguc3Ryb2tlKCk7CiAgICAgICAgCnJldHVybiBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICAgIH0pKCk7CgogICAgLy8gOC4gTWljcm8gQnViYmxlIChOZXc6IFNoYXJwLCBoaWdoLXZpcyBjYXZpdGF0aW9uKQogICAgY29uc3QgX21pY3JvQnViYmxlVGV4ID0gKCgpID0+IHsKICAgICAgICBjb25zdCBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgYy53aWR0aCA9IDMyOyBjLmhlaWdodCA9IDMyOwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIDMyLCAzMik7CiAgICAgICAgCiAgICAgICAgLy8gSW50ZW5zZSBicmlnaHQgY29yZQogICAgICAgIGNvbnN0IGcgPSBjdHguY3JlYXRlUmFkaWFsR3JhZGllbnQoMTYsIDE2LCAwLCAxNiwgMTYsIDE2KTsKICAgICAgICBnLmFkZENvbG9yU3RvcCgwLCAncmdiYSgyNTUsIDI1NSwgMjU1LCAxLjApJyk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMC4zLCAncmdiYSgyMjAsIDI1NSwgMjU1LCAwLjgpJyk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMC42LCAncmdiYSgxMDAsIDIwMCwgMjU1LCAwLjMpJyk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMS4wLCAncmdiYSgwLCAwLCAwLCAwKScpOwogICAgICAgIAogICAgICAgIGN0eC5maWxsU3R5bGUgPSBnOwogICAgICAgIGN0eC5iZWdpblBhdGgoKTsgY3R4LmFyYygxNiwgMTYsIDE2LCAwLCBNYXRoLlBJKjIpOyBjdHguZmlsbCgpOwogICAgICAgIHJldHVybiBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICAgIH0pKCk7CgogICAgY2xhc3MgUGFydGljbGVNYW5hZ2VyIHsKICAgICAgICBjb25zdHJ1Y3RvcihzY2VuZSkgewogICAgICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7CiAgICAgICAgICAgIHRoaXMucGFydGljbGVzID0gW107CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTaGFyZWQgTWF0ZXJpYWxzCiAgICAgICAgICAgIHRoaXMubWF0ZXJpYWxzID0gewogICAgICAgICAgICAgICAgdmVub206IG5ldyBUSFJFRS5TcHJpdGVNYXRlcmlhbCh7IG1hcDogX3Zlbm9tVGV4LCB0cmFuc3BhcmVudDogdHJ1ZSwgZGVwdGhXcml0ZTogZmFsc2UsIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nIH0pLAogICAgICAgICAgICAgICAgbmFwOiBuZXcgVEhSRUUuU3ByaXRlTWF0ZXJpYWwoeyBtYXA6IF9uYXBUZXgsIHRyYW5zcGFyZW50OiB0cnVlLCBkZXB0aFdyaXRlOiBmYWxzZSwgYmxlbmRpbmc6IFRIUkVFLk5vcm1hbEJsZW5kaW5nIH0pLAogICAgICAgICAgICAgICAgd2l0aGVyOiBuZXcgVEhSRUUuU3ByaXRlTWF0ZXJpYWwoeyBtYXA6IF93aXRoZXJUZXgsIHRyYW5zcGFyZW50OiB0cnVlLCBkZXB0aFdyaXRlOiBmYWxzZSwgYmxlbmRpbmc6IFRIUkVFLk5vcm1hbEJsZW5kaW5nIH0pLAogICAgICAgICAgICAgICAgbGVhcm5lZDogbmV3IFRIUkVFLlNwcml0ZU1hdGVyaWFsKHsgbWFwOiBfdmVub21UZXgsIGNvbG9yOiAweDAwZmZmZiwgdHJhbnNwYXJlbnQ6IHRydWUsIGRlcHRoV3JpdGU6IGZhbHNlLCBibGVuZGluZzogVEhSRUUuQWRkaXRpdmVCbGVuZGluZyB9KSwKICAgICAgICAgICAgICAgIHNob2Nrd2F2ZTogbmV3IFRIUkVFLlNwcml0ZU1hdGVyaWFsKHsgbWFwOiBfc2hvY2t3YXZlVGV4LCB0cmFuc3BhcmVudDogdHJ1ZSwgZGVwdGhXcml0ZTogZmFsc2UsIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nIH0pLAogICAgICAgICAgICAgICAgZmxhc2g6IG5ldyBUSFJFRS5TcHJpdGVNYXRlcmlhbCh7IG1hcDogX2ZsYXNoVGV4LCB0cmFuc3BhcmVudDogdHJ1ZSwgZGVwdGhXcml0ZTogZmFsc2UsIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nIH0pLAogICAgICAgICAgICAgICAgZGVicmlzOiBuZXcgVEhSRUUuU3ByaXRlTWF0ZXJpYWwoeyBtYXA6IF9kZWJyaXNUZXgsIHRyYW5zcGFyZW50OiB0cnVlLCBkZXB0aFdyaXRlOiBmYWxzZSwgYmxlbmRpbmc6IFRIUkVFLk5vcm1hbEJsZW5kaW5nIH0pLAogICAgICAgICAgICAgICAgYnViYmxlOiBuZXcgVEhSRUUuU3ByaXRlTWF0ZXJpYWwoeyBtYXA6IF9idWJibGVUZXgsIHRyYW5zcGFyZW50OiB0cnVlLCBkZXB0aFdyaXRlOiBmYWxzZSwgYmxlbmRpbmc6IFRIUkVFLkFkZGl0aXZlQmxlbmRpbmcgfSksCiAgICAgICAgICAgICAgICBidWJibGVfbWljcm86IG5ldyBUSFJFRS5TcHJpdGVNYXRlcmlhbCh7IG1hcDogX21pY3JvQnViYmxlVGV4LCB0cmFuc3BhcmVudDogdHJ1ZSwgZGVwdGhXcml0ZTogZmFsc2UsIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nIH0pCiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBPYmplY3QgUG9vbAovLyBPYmplY3QgUG9vbAogICAgICAgICAgICB0aGlzLnBvb2wgPSBbXTsKICAgICAgICAgICAgdGhpcy5wb29sU2l6ZSA9IDMwMDsgLy8gSW5jcmVhc2VkIGZvciBkZWJyaXMKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpPHRoaXMucG9vbFNpemU7IGkrKykgewogICAgICAgICAgICAgICAgLy8gQ3JlYXRlIHVuaXF1ZSBtYXRlcmlhbCBmb3IgZWFjaCBzcHJpdGUgdG8gcHJldmVudCBzdGF0ZSBzaGFyaW5nIChmbGlja2VyaW5nKQogICAgICAgICAgICAgICAgY29uc3QgbWF0ID0gdGhpcy5tYXRlcmlhbHMudmVub20uY2xvbmUoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNwcml0ZSA9IG5ldyBUSFJFRS5TcHJpdGUobWF0KTsgCiAgICAgICAgICAgICAgICBzcHJpdGUudmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgc3ByaXRlLnNjYWxlLnNldCgwLDAsMCk7IAogICAgICAgICAgICAgICAgdGhpcy5zY2VuZS5hZGQoc3ByaXRlKTsKICAgICAgICAgICAgICAgIHRoaXMucG9vbC5wdXNoKHNwcml0ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgpzcGF3bih0eXBlLCBwb3MsIG9wdGlvbnMgPSB7fSkgewogICAgICAgICAgICBjb25zdCBwID0gdGhpcy5wb29sLmZpbmQocyA9PiAhcy52aXNpYmxlKTsKICAgICAgICAgICAgaWYgKCFwKSByZXR1cm47CgogICAgICAgICAgICBwLnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQ29weSBwcm9wZXJ0aWVzIGZyb20gdGVtcGxhdGUgaW5zdGVhZCBvZiBzaGFyaW5nIHJlZmVyZW5jZQogICAgICAgICAgICBjb25zdCB0ZW1wbGF0ZSA9IHRoaXMubWF0ZXJpYWxzW3R5cGVdIHx8IHRoaXMubWF0ZXJpYWxzLnZlbm9tOwogICAgICAgICAgICBwLm1hdGVyaWFsLm1hcCA9IHRlbXBsYXRlLm1hcDsKICAgICAgICAgICAgcC5tYXRlcmlhbC5ibGVuZGluZyA9IHRlbXBsYXRlLmJsZW5kaW5nOwogICAgICAgICAgICBwLm1hdGVyaWFsLmRlcHRoV3JpdGUgPSB0ZW1wbGF0ZS5kZXB0aFdyaXRlOwogICAgICAgICAgICBwLm1hdGVyaWFsLnRyYW5zcGFyZW50ID0gdGVtcGxhdGUudHJhbnNwYXJlbnQ7CgogICAgICAgICAgICBwLnBvc2l0aW9uLmNvcHkocG9zKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFJlc2V0IHJvdGF0aW9uICYgY29sb3IKICAgICAgICAgICAgcC5tYXRlcmlhbC5yb3RhdGlvbiA9IDA7CiAgICAgICAgICAgIHAubWF0ZXJpYWwuY29sb3Iuc2V0SGV4KDB4ZmZmZmZmKTsKICAgICAgICAgICAgcC5tYXRlcmlhbC5vcGFjaXR5ID0gMS4wOwoKICAgICAgICAgICAgY29uc3QgZGF0YSA9IHsKCgogICAgICAgICAgICAgICAgbWVzaDogcCwKICAgICAgICAgICAgICAgIHR5cGU6IHR5cGUsCiAgICAgICAgICAgICAgICBhZ2U6IDAsCiAgICAgICAgICAgICAgICBsaWZlOiBvcHRpb25zLmxpZmUgfHwgMS4wLAogICAgICAgICAgICAgICAgbWF4TGlmZTogb3B0aW9ucy5saWZlIHx8IDEuMCwKICAgICAgICAgICAgICAgIHZlbG9jaXR5OiBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAwKSwKICAgICAgICAgICAgICAgIHN0YXJ0U2NhbGU6IG9wdGlvbnMuc2NhbGUgfHwgMS4wLAogICAgICAgICAgICAgICAgZ3Jhdml0eTogMCwKICAgICAgICAgICAgICAgIGRyYWc6IDAKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8vIENvbmZpZ3VyYXRpb24gcGVyIHR5cGUKICAgICAgICAgICAgaWYgKHR5cGUgPT09ICd2ZW5vbScpIHsKICAgICAgICAgICAgICAgIGRhdGEubGlmZSA9IDEuMCArIE1hdGgucmFuZG9tKCkgKiAwLjU7CiAgICAgICAgICAgICAgICBkYXRhLnZlbG9jaXR5LnNldCgwLCAxLjAgKyBNYXRoLnJhbmRvbSgpLCAwKTsKICAgICAgICAgICAgICAgIGRhdGEuc3RhcnRTY2FsZSA9IDAuMyArIE1hdGgucmFuZG9tKCkgKiAwLjI7CiAgICAgICAgICAgICAgICBwLm1hdGVyaWFsLm9wYWNpdHkgPSAwLjg7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnbmFwJykgewogICAgICAgICAgICAgICAgZGF0YS5saWZlID0gMi4wOwogICAgICAgICAgICAgICAgZGF0YS52ZWxvY2l0eS5zZXQoKE1hdGgucmFuZG9tKCktMC41KSowLjIsIDAuNSwgKE1hdGgucmFuZG9tKCktMC41KSowLjIpOwogICAgICAgICAgICAgICAgZGF0YS5zdGFydFNjYWxlID0gMC40OwogICAgICAgICAgICAgICAgcC5tYXRlcmlhbC5vcGFjaXR5ID0gMS4wOwoKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnd2l0aGVyJykgewogICAgICAgICAgICAgICAgZGF0YS5saWZlID0gMS41OwogICAgICAgICAgICAgICAgZGF0YS52ZWxvY2l0eS5zZXQoKE1hdGgucmFuZG9tKCktMC41KSowLjUsIDAuNSwgKE1hdGgucmFuZG9tKCktMC41KSowLjUpOwogICAgICAgICAgICAgICAgcC5tYXRlcmlhbC5vcGFjaXR5ID0gMC42OwogICAgICAgICAgICAgICAgcC5tYXRlcmlhbC5yb3RhdGlvbiA9IE1hdGgucmFuZG9tKCkgKiBNYXRoLlBJOwoKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnc2hvY2t3YXZlJykgewogICAgICAgICAgICAgICAgZGF0YS5saWZlID0gb3B0aW9ucy5saWZlIHx8IDAuNDsKICAgICAgICAgICAgICAgIGRhdGEubWF4TGlmZSA9IGRhdGEubGlmZTsKICAgICAgICAgICAgICAgIGRhdGEuc3RhcnRTY2FsZSA9IG9wdGlvbnMuc2NhbGUgfHwgMi4wOwogICAgICAgICAgICAgICAgcC5tYXRlcmlhbC5vcGFjaXR5ID0gMS4wOwogICAgICAgICAgICAgICAgLy8gU2hvY2t3YXZlcyBncm93IHJhcGlkbHkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdmbGFzaCcpIHsKICAgICAgICAgICAgICAgIGRhdGEubGlmZSA9IDAuMjsKICAgICAgICAgICAgICAgIGRhdGEubWF4TGlmZSA9IDAuMjsKICAgICAgICAgICAgICAgIGRhdGEuc3RhcnRTY2FsZSA9IG9wdGlvbnMuc2NhbGUgfHwgMy4wOwogICAgICAgICAgICAgICAgcC5tYXRlcmlhbC5vcGFjaXR5ID0gMS4wOwogICAgICAgICAgICAgICAgcC5tYXRlcmlhbC5yb3RhdGlvbiA9IE1hdGgucmFuZG9tKCkgKiBNYXRoLlBJOwoKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnZGVicmlzJykgewogICAgICAgICAgICAgICAgZGF0YS5saWZlID0gMS41OwogICAgICAgICAgICAgICAgZGF0YS5tYXhMaWZlID0gMS41OwogICAgICAgICAgICAgICAgY29uc3Qgc3BlZWQgPSA1LjAgKyBNYXRoLnJhbmRvbSgpICogMTAuMDsKICAgICAgICAgICAgICAgIGRhdGEudmVsb2NpdHkuc2V0KAogICAgICAgICAgICAgICAgICAgIChNYXRoLnJhbmRvbSgpLTAuNSkgKiBzcGVlZCwKICAgICAgICAgICAgICAgICAgICAoTWF0aC5yYW5kb20oKSAqIHNwZWVkICogMC41KSArIDIuMCwKICAgICAgICAgICAgICAgICAgICAoTWF0aC5yYW5kb20oKS0wLjUpICogc3BlZWQKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBkYXRhLmdyYXZpdHkgPSAyMC4wOwogICAgICAgICAgICAgICAgZGF0YS5kcmFnID0gMS4wOwogICAgICAgICAgICAgICAgZGF0YS5zdGFydFNjYWxlID0gKG9wdGlvbnMuc2NhbGUgfHwgMC4zKSAqICgwLjUgKyBNYXRoLnJhbmRvbSgpKTsKICAgICAgICAgICAgICAgIHAubWF0ZXJpYWwub3BhY2l0eSA9IDEuMDsKcC5tYXRlcmlhbC5vcGFjaXR5ID0gMS4wOwogICAgICAgICAgICAgICAgcC5tYXRlcmlhbC5yb3RhdGlvbiA9IE1hdGgucmFuZG9tKCkgKiBNYXRoLlBJOwogICAgICAgICAgICAgICAgZGF0YS5saWZlID0gMS4wICsgTWF0aC5yYW5kb20oKSAqIDEuMDsgLy8gTG9uZ2VyIGxpZmUKICAgICAgICAgICAgICAgIGRhdGEubWF4TGlmZSA9IGRhdGEubGlmZTsKICAgICAgICAgICAgICAgIGRhdGEudmVsb2NpdHkuc2V0KAogICAgICAgICAgICAgICAgICAgIChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDAuNSwgLy8gR2VudGxlIGRyaWZ0IFgKICAgICAgICAgICAgICAgICAgICAwLjUgKyBNYXRoLnJhbmRvbSgpICogMS4wLCAgIC8vIFJpc2UgWQogICAgICAgICAgICAgICAgICAgIChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDAuNSAgLy8gR2VudGxlIGRyaWZ0IFoKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBkYXRhLnN0YXJ0U2NhbGUgPSAob3B0aW9ucy5zY2FsZSB8fCAwLjIpICogKDAuOCArIE1hdGgucmFuZG9tKCkgKiAwLjQpOwogICAgICAgICAgICAgICAgcC5tYXRlcmlhbC5vcGFjaXR5ID0gMC42OyAvLyBNb3JlIHRyYW5zcGFyZW50CiAgICAgICAgICAgICAgICBwLm1hdGVyaWFsLmNvbG9yLnNldEhleCgweGFhY2NmZik7IC8vIFNsaWdodCBibHVlIHRpbnQKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnYnViYmxlX21pY3JvJykgewogICAgICAgICAgICAgICAgLy8gQ0FWSVRBVElPTiBCVUJCTEVTOiBGYXN0LCBzaG9ydC1saXZlZCwgYnJpZ2h0CiAgICAgICAgICAgICAgICBkYXRhLmxpZmUgPSAwLjQgKyBNYXRoLnJhbmRvbSgpICogMC40OwogICAgICAgICAgICAgICAgZGF0YS5tYXhMaWZlID0gZGF0YS5saWZlOwogICAgICAgICAgICAgICAgZGF0YS52ZWxvY2l0eS5zZXQoCiAgICAgICAgICAgICAgICAgICAgKE1hdGgucmFuZG9tKCkgLSAwLjUpICogMS41LCAvLyBKaXR0ZXJ5IFgKICAgICAgICAgICAgICAgICAgICAxLjUgKyBNYXRoLnJhbmRvbSgpICogMi4wLCAgIC8vIEZhc3QgUmlzZSBZCiAgICAgICAgICAgICAgICAgICAgKE1hdGgucmFuZG9tKCkgLSAwLjUpICogMS41ICAvLyBKaXR0ZXJ5IFoKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBkYXRhLnN0YXJ0U2NhbGUgPSAob3B0aW9ucy5zY2FsZSB8fCAwLjA4KSAqICgwLjggKyBNYXRoLnJhbmRvbSgpICogMC41KTsKICAgICAgICAgICAgICAgIHAubWF0ZXJpYWwub3BhY2l0eSA9IDAuOTsgLy8gSGlnaCB2aXNpYmlsaXR5CiAgICAgICAgICAgICAgICBwLm1hdGVyaWFsLmNvbG9yLnNldEhleCgweGZmZmZmZik7IC8vIFB1cmUgd2hpdGUvY3lhbiBjb3JlCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEFwcGx5IGluaXRpYWwgc2NhbGUKICAgICAgICAgICAgLy8gQXBwbHkgaW5pdGlhbCBzY2FsZQogICAgICAgICAgICBpZiAodHlwZSAhPT0gJ3Nob2Nrd2F2ZScpIHsKICAgICAgICAgICAgICAgIHAuc2NhbGUuc2V0U2NhbGFyKGRhdGEuc3RhcnRTY2FsZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBwLnNjYWxlLnNldFNjYWxhcigwLjEpOyAvLyBTaG9ja3dhdmVzIHN0YXJ0IHNtYWxsCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMucGFydGljbGVzLnB1c2goZGF0YSk7CiAgICAgICAgfQoKICAgICAgICB1cGRhdGUoZHQpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IHRoaXMucGFydGljbGVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwID0gdGhpcy5wYXJ0aWNsZXNbaV07CiAgICAgICAgICAgICAgICBwLmFnZSArPSBkdDsKCiAgICAgICAgICAgICAgICBpZiAocC5hZ2UgPj0gcC5saWZlKSB7CiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBwLm1lc2guc2NhbGUuc2V0KDAsMCwwKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcnRpY2xlcy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29uc3QgdCA9IHAuYWdlIC8gcC5saWZlOwoKICAgICAgICAgICAgICAgIC8vIFBoeXNpY3MKICAgICAgICAgICAgICAgIGlmIChwLmdyYXZpdHkgPiAwKSBwLnZlbG9jaXR5LnkgLT0gcC5ncmF2aXR5ICogZHQ7CiAgICAgICAgICAgICAgICBpZiAocC5kcmFnID4gMCkgcC52ZWxvY2l0eS5tdWx0aXBseVNjYWxhcihNYXRoLm1heCgwLCAxLjAgLSAocC5kcmFnICogZHQpKSk7CiAgICAgICAgICAgICAgICBwLm1lc2gucG9zaXRpb24uYWRkU2NhbGVkVmVjdG9yKHAudmVsb2NpdHksIGR0KTsKCiAgICAgICAgICAgICAgICAvLyBCZWhhdmlvcgogICAgICAgICAgICAgICAgaWYgKHAudHlwZSA9PT0gJ3Nob2Nrd2F2ZScpIHsKICAgICAgICAgICAgICAgICAgICAvLyBSYXBpZCBleHBhbnNpb24KICAgICAgICAgICAgICAgICAgICBjb25zdCBzID0gcC5zdGFydFNjYWxlICogTWF0aC5wb3codCwgMC41KSAqIDUuMDsgCiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLnNjYWxlLnNldFNjYWxhcihzKTsKICAgICAgICAgICAgICAgICAgICBwLm1lc2gubWF0ZXJpYWwub3BhY2l0eSA9IDEuMCAtIE1hdGgucG93KHQsIDIpOyAvLyBGYWRlIG91dAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwLnR5cGUgPT09ICdmbGFzaCcpIHsKICAgICAgICAgICAgICAgICAgICAvLyBRdWljayBwb3AKICAgICAgICAgICAgICAgICAgICBjb25zdCBzID0gcC5zdGFydFNjYWxlICogKDEuMCAtIHQpOwogICAgICAgICAgICAgICAgICAgIHAubWVzaC5zY2FsZS5zZXRTY2FsYXIocyk7CiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLm1hdGVyaWFsLnJvdGF0aW9uICs9IDUuMCAqIGR0OwoKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocC50eXBlID09PSAnZGVicmlzJykgewogICAgICAgICAgICAgICAgICAgIC8vIFNwaW4gYW5kIHNocmluawogICAgICAgICAgICAgICAgICAgIHAubWVzaC5tYXRlcmlhbC5yb3RhdGlvbiArPSAxMC4wICogZHQ7CiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLnNjYWxlLnNldFNjYWxhcihwLnN0YXJ0U2NhbGUgKiAoMS4wIC0gdCkpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwLnR5cGUgPT09ICd2ZW5vbScpIHsKICAgICAgICAgICAgICAgICAgICBwLm1lc2gucG9zaXRpb24ueCArPSBNYXRoLnNpbihwLmFnZSAqIDEwICsgcC5tZXNoLmlkKSAqIGR0ICogMC41OwogICAgICAgICAgICAgICAgICAgIHAubWVzaC5tYXRlcmlhbC5vcGFjaXR5ID0gMC44ICogKDEuMCAtIE1hdGgucG93KHQsIDMpKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocC50eXBlID09PSAnbmFwJykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHMgPSBwLnN0YXJ0U2NhbGUgKiAoMC41ICsgdCAqIDEuNSk7CiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLnNjYWxlLnNldFNjYWxhcihzKTsKICAgICAgICAgICAgICAgICAgICBwLm1lc2gubWF0ZXJpYWwub3BhY2l0eSA9IDEuMCAtIE1hdGgucG93KHQsIDIpOwpwLm1lc2gucG9zaXRpb24ueCArPSBNYXRoLnNpbihwLmFnZSAqIDIpICogZHQgKiAwLjM7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHAudHlwZSA9PT0gJ2J1YmJsZScpIHsKICAgICAgICAgICAgICAgICAgICAvLyBBZXN0aGV0aWMgV29iYmxlCiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLnBvc2l0aW9uLnggKz0gTWF0aC5zaW4ocC5hZ2UgKiA1LjAgKyBwLm1lc2guaWQpICogZHQgKiAwLjI7CiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLnBvc2l0aW9uLnogKz0gTWF0aC5jb3MocC5hZ2UgKiA0LjAgKyBwLm1lc2guaWQpICogZHQgKiAwLjI7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gU2NhbGUgdXAgc2xpZ2h0bHkgdGhlbiBmYWRlCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcyA9IHAuc3RhcnRTY2FsZSAqICgxLjAgKyB0ICogMC4yKTsKICAgICAgICAgICAgICAgICAgICBwLm1lc2guc2NhbGUuc2V0U2NhbGFyKHMpOwogICAgICAgICAgICAgICAgICAgIHAubWVzaC5tYXRlcmlhbC5vcGFjaXR5ID0gMC42ICogKDEuMCAtIE1hdGgucG93KHQsIDIpKTsgLy8gU21vb3RoIGZhZGUKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocC50eXBlID09PSAnYnViYmxlX21pY3JvJykgewogICAgICAgICAgICAgICAgICAgIC8vIENoYW90aWMgSml0dGVyCiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLnBvc2l0aW9uLnggKz0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogZHQgKiAyLjA7CiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLnBvc2l0aW9uLnogKz0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogZHQgKiAyLjA7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gU2hyaW5rIHJhcGlkbHkKICAgICAgICAgICAgICAgICAgICBjb25zdCBzID0gcC5zdGFydFNjYWxlICogKDEuMCAtIHQpOwogICAgICAgICAgICAgICAgICAgIHAubWVzaC5zY2FsZS5zZXRTY2FsYXIocyk7CiAgICAgICAgICAgICAgICAgICAgcC5tZXNoLm1hdGVyaWFsLm9wYWNpdHkgPSAwLjkgKiAoMS4wIC0gdCk7IC8vIExpbmVhciBmYWRlCn0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIHdpbmRvdy5mbHV4LlBhcnRpY2xlTWFuYWdlciA9IFBhcnRpY2xlTWFuYWdlcjsKfSkoKTs=","DevTools.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICBjbGFzcyBEZXZUb29scyB7CiAgICAgICAgY29uc3RydWN0b3IoZ2FtZU1hbmFnZXIpIHsKICAgICAgICAgICAgdGhpcy5nYW1lID0gZ2FtZU1hbmFnZXI7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBsaWwtZ3VpIGF0dGFjaGVzIHRvIHdpbmRvdy5saWwgYnkgZGVmYXVsdCBpbiBVTUQgYnVpbGQKICAgICAgICAgICAgaWYgKCF3aW5kb3cubGlsIHx8ICF3aW5kb3cubGlsLkdVSSkgewogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJEZXZUb29sczogbGlsLWd1aSBub3QgZm91bmQuIik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCmNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYW1lLWNvbnRhaW5lcicpOwogICAgICAgICAgICB0aGlzLmd1aSA9IG5ldyB3aW5kb3cubGlsLkdVSSh7IHRpdGxlOiAnRmx1eCBEZXZUb29scycsIGNvbnRhaW5lcjogY29udGFpbmVyIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gUG9zaXRpb24gYXMgYSBjb2xsYXBzZWQgdGFiIG9uIHRoZSByaWdodCBmcmFtZQovLyBQb3NpdGlvbiBhcyBhIHNsaWRpbmcgdGFiIG9uIHRoZSByaWdodCBmcmFtZQovLyBQb3NpdGlvbiBhcyBhIHNsaWRpbmcgdGFiIG9uIHRoZSByaWdodCBmcmFtZQovLyBXcmFwcGVyIGZvciBzbGlkaW5nIGFuaW1hdGlvbgogICAgICAgICAgICBjb25zdCB3cmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIHdyYXBwZXIuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnOwogICAgICAgICAgICB3cmFwcGVyLnN0eWxlLnRvcCA9ICcxMDBweCc7CiAgICAgICAgICAgIHdyYXBwZXIuc3R5bGUucmlnaHQgPSAnLTI2MHB4JzsKICAgICAgICAgICAgd3JhcHBlci5zdHlsZS53aWR0aCA9ICcyNjBweCc7CiAgICAgICAgICAgIHdyYXBwZXIuc3R5bGUudHJhbnNpdGlvbiA9ICdyaWdodCAwLjNzIGN1YmljLWJlemllcigwLjIsIDAuOCwgMC4yLCAxLjApJzsKICAgICAgICAgICAgd3JhcHBlci5zdHlsZS56SW5kZXggPSAnOTk5OSc7CiAgICAgICAgICAgIHdyYXBwZXIuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgICAgICAgICAgd3JhcHBlci5zdHlsZS5mbGV4RGlyZWN0aW9uID0gJ2NvbHVtbic7CiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh3cmFwcGVyKTsKCiAgICAgICAgICAgIGNvbnN0IGRvbSA9IHRoaXMuZ3VpLmRvbUVsZW1lbnQ7CiAgICAgICAgICAgIGRvbS5zdHlsZS53aWR0aCA9ICcxMDAlJzsKICAgICAgICAgICAgZG9tLnN0eWxlLnNldFByb3BlcnR5KCctLXdpZHRoJywgJzEwMCUnKTsKICAgICAgICAgICAgZG9tLnN0eWxlLm1heEhlaWdodCA9ICc4MHZoJzsKICAgICAgICAgICAgZG9tLnN0eWxlLm92ZXJmbG93WSA9ICdhdXRvJzsKICAgICAgICAgICAgZG9tLnN0eWxlLm92ZXJmbG93WCA9ICdoaWRkZW4nOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gTW92ZSBHVUkgaW50byB3cmFwcGVyCiAgICAgICAgICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQoZG9tKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENyZWF0ZSBUb2dnbGUgSGFuZGxlCiAgICAgICAgICAgIGNvbnN0IGhhbmRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICBoYW5kbGUuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnOwogICAgICAgICAgICBoYW5kbGUuc3R5bGUubGVmdCA9ICctNDBweCc7IC8vIFByb3RydWRlIHRvIHRoZSBsZWZ0CiAgICAgICAgICAgIGhhbmRsZS5zdHlsZS50b3AgPSAnMCc7CiAgICAgICAgICAgIGhhbmRsZS5zdHlsZS53aWR0aCA9ICc0MHB4JzsKICAgICAgICAgICAgaGFuZGxlLnN0eWxlLmhlaWdodCA9ICc0MHB4JzsKICAgICAgICAgICAgaGFuZGxlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICdyZ2JhKDAsIDIwLCA0MCwgMC45KSc7CiAgICAgICAgICAgIGhhbmRsZS5zdHlsZS5ib3JkZXIgPSAnMXB4IHNvbGlkICMwMGZmZmYnOwogICAgICAgICAgICBoYW5kbGUuc3R5bGUuYm9yZGVyUmlnaHQgPSAnbm9uZSc7CiAgICAgICAgICAgIGhhbmRsZS5zdHlsZS5ib3JkZXJUb3BMZWZ0UmFkaXVzID0gJzhweCc7CiAgICAgICAgICAgIGhhbmRsZS5zdHlsZS5ib3JkZXJCb3R0b21MZWZ0UmFkaXVzID0gJzhweCc7CiAgICAgICAgICAgIGhhbmRsZS5zdHlsZS5jdXJzb3IgPSAncG9pbnRlcic7CiAgICAgICAgICAgIGhhbmRsZS5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgICAgICAgICBoYW5kbGUuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSAnY2VudGVyJzsKICAgICAgICAgICAgaGFuZGxlLnN0eWxlLmFsaWduSXRlbXMgPSAnY2VudGVyJzsKICAgICAgICAgICAgaGFuZGxlLnN0eWxlLmNvbG9yID0gJyMwMGZmZmYnOwogICAgICAgICAgICBoYW5kbGUuc3R5bGUuZm9udFNpemUgPSAnMjBweCc7CiAgICAgICAgICAgIGhhbmRsZS5pbm5lckhUTUwgPSAn4pqZJzsKICAgICAgICAgICAgaGFuZGxlLnN0eWxlLmJveFNoYWRvdyA9ICctNXB4IDAgMTBweCByZ2JhKDAsMCwwLDAuNSknOwogICAgICAgICAgICAKICAgICAgICAgICAgd3JhcHBlci5hcHBlbmRDaGlsZChoYW5kbGUpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVG9nZ2xlIExvZ2ljCiAgICAgICAgICAgIGxldCBpc09wZW4gPSBmYWxzZTsKICAgICAgICAgICAgaGFuZGxlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7IC8vIFByZXZlbnQgZ2FtZSBpbnB1dHMKICAgICAgICAgICAgICAgIGlzT3BlbiA9ICFpc09wZW47CiAgICAgICAgICAgICAgICB3cmFwcGVyLnN0eWxlLnJpZ2h0ID0gaXNPcGVuID8gJzBweCcgOiAnLTI2MHB4JzsKICAgICAgICAgICAgICAgIGhhbmRsZS5pbm5lckhUTUwgPSBpc09wZW4gPyAnwrsnIDogJ+KamSc7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAvLyBEZWZhdWx0IGdsb2JhbCB0aW1lU2NhbGUgaWYgbm90IHNldAppZiAod2luZG93LmZsdXgudGltZVNjYWxlID09PSB1bmRlZmluZWQpIHdpbmRvdy5mbHV4LnRpbWVTY2FsZSA9IDAuODsKCnRoaXMuX3NldHVwR2VuZXJhbCgpOwogICAgICAgICAgICB0aGlzLl9zZXR1cEdhbWVTdGF0ZSgpOwp0aGlzLl9zZXR1cE92ZXJsYXlzKCk7CiAgICAgICAgICAgIHRoaXMuX3NldHVwVGVhbXMoKTsKICAgICAgICAgICAgdGhpcy5fc2V0dXBQbGF5ZXJJbnNwZWN0b3IoKTsKICAgICAgICAgICAgdGhpcy5fc2V0dXBCYWxsU2FuZGJveCgpOwp0aGlzLl9zZXR1cEZYTGFiKCk7CiAgICAgICAgICAgIHRoaXMuX3NldHVwVmlzdWFscygpOwogICAgICAgIH0KCl9zZXR1cEdlbmVyYWwoKSB7CiAgICAgICAgICAgIGNvbnN0IGZvbGRlciA9IHRoaXMuZ3VpLmFkZEZvbGRlcignR2VuZXJhbCcpOwogICAgICAgICAgICAKY29uc3QgcGFyYW1zID0gewogICAgICAgICAgICAgICAgdGltZVNjYWxlOiB3aW5kb3cuZmx1eC50aW1lU2NhbGUsCiAgICAgICAgICAgICAgICBkZW1vTW9kZTogdGhpcy5nYW1lLmlzRGVtb01vZGUsCiAgICAgICAgICAgICAgICB0b2dnbGVIVUQ6IHRydWUsCiAgICAgICAgICAgICAgICByZXNvbHV0aW9uOiAwLjUwLAogICAgICAgICAgICAgICAgYXJlbmFPcGFjaXR5OiAwLjAsCiAgICAgICAgICAgICAgICBhcmVuYTJPcGFjaXR5OiAwLjA1CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBmb2xkZXIuYWRkKHBhcmFtcywgJ3RpbWVTY2FsZScsIDAuMCwgNS4wKS5uYW1lKCdHYW1lIFNwZWVkJykub25DaGFuZ2UodiA9PiB7CiAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC50aW1lU2NhbGUgPSB2OwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGZvbGRlci5hZGQocGFyYW1zLCAnZGVtb01vZGUnKS5uYW1lKCdEZW1vIE1vZGUnKS5saXN0ZW4oKS5vbkNoYW5nZSh2ID0+IHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmdhbWUuaXNEZW1vTW9kZSAhPT0gdikgewogICAgICAgICAgICAgICAgICAgIHRoaXMuZ2FtZS50b2dnbGVEZW1vTW9kZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGZvbGRlci5hZGQocGFyYW1zLCAndG9nZ2xlSFVEJykubmFtZSgnU2hvdyBIVUQnKS5vbkNoYW5nZSh2ID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGh1ZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1aS1sYXllcicpOwogICAgICAgICAgICAgICAgaWYgKGh1ZCkgewogICAgICAgICAgICAgICAgICAgIGh1ZC5zdHlsZS52aXNpYmlsaXR5ID0gdiA/ICd2aXNpYmxlJyA6ICdoaWRkZW4nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGZvbGRlci5hZGQocGFyYW1zLCAncmVzb2x1dGlvbicsIDAuMSwgMi4wKS5uYW1lKCdSZXNvbHV0aW9uIFNjYWxlJykub25DaGFuZ2UodiA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB3ID0gd2luZG93LmlubmVyV2lkdGg7CiAgICAgICAgICAgICAgICBjb25zdCBoID0gd2luZG93LmlubmVySGVpZ2h0OwogICAgICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSB0aGlzLmdhbWUucmVuZGVyZXI7CiAgICAgICAgICAgICAgICBpZiAocmVuZGVyZXIpIHsKICAgICAgICAgICAgICAgICAgICByZW5kZXJlci5zZXRTaXplKHcgKiB2LCBoICogdiwgZmFsc2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCmZvbGRlci5hZGQocGFyYW1zLCAnYXJlbmFPcGFjaXR5JywgMC4wLCAxLjApLm5hbWUoJ0FyZW5hIDEgT3BhY2l0eScpLm9uQ2hhbmdlKHYgPT4gewogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmFyZW5hTWVzaCAmJiB3aW5kb3cuZmx1eC5hcmVuYU1lc2gubWF0ZXJpYWwpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5hcmVuYU1lc2gubWF0ZXJpYWwub3BhY2l0eSA9IHY7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY29uc3QgYmxlbmRNb2RlcyA9IHsKICAgICAgICAgICAgICAgICdOb3JtYWwnOiBUSFJFRS5Ob3JtYWxCbGVuZGluZywKICAgICAgICAgICAgICAgICdBZGRpdGl2ZSc6IFRIUkVFLkFkZGl0aXZlQmxlbmRpbmcsCiAgICAgICAgICAgICAgICAnTXVsdGlwbHknOiBUSFJFRS5NdWx0aXBseUJsZW5kaW5nLAogICAgICAgICAgICAgICAgJ1N1YnRyYWN0aXZlJzogVEhSRUUuU3VidHJhY3RpdmVCbGVuZGluZywKICAgICAgICAgICAgICAgICdOb0JsZW5kaW5nJzogVEhSRUUuTm9CbGVuZGluZwogICAgICAgICAgICB9OwogICAgICAgICAgICBwYXJhbXMuYXJlbmFCbGVuZCA9ICdNdWx0aXBseSc7CgogICAgICAgICAgICBmb2xkZXIuYWRkKHBhcmFtcywgJ2FyZW5hQmxlbmQnLCBPYmplY3Qua2V5cyhibGVuZE1vZGVzKSkubmFtZSgnQXJlbmEgMSBCbGVuZCcpLm9uQ2hhbmdlKHYgPT4gewogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmFyZW5hTWVzaCAmJiB3aW5kb3cuZmx1eC5hcmVuYU1lc2gubWF0ZXJpYWwpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5hcmVuYU1lc2gubWF0ZXJpYWwuYmxlbmRpbmcgPSBibGVuZE1vZGVzW3ZdOwogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmFyZW5hTWVzaC5tYXRlcmlhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gQXJlbmEgMiBDb250cm9scwogICAgICAgICAgICBmb2xkZXIuYWRkKHBhcmFtcywgJ2FyZW5hMk9wYWNpdHknLCAwLjAsIDEuMCkubmFtZSgnQXJlbmEgMiBPcGFjaXR5Jykub25DaGFuZ2UodiA9PiB7CiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguYXJlbmFNZXNoMiAmJiB3aW5kb3cuZmx1eC5hcmVuYU1lc2gyLm1hdGVyaWFsKSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguYXJlbmFNZXNoMi5tYXRlcmlhbC5vcGFjaXR5ID0gdjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBwYXJhbXMuYXJlbmEyQmxlbmQgPSAnTm9ybWFsJzsKICAgICAgICAgICAgZm9sZGVyLmFkZChwYXJhbXMsICdhcmVuYTJCbGVuZCcsIE9iamVjdC5rZXlzKGJsZW5kTW9kZXMpKS5uYW1lKCdBcmVuYSAyIEJsZW5kJykub25DaGFuZ2UodiA9PiB7CiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguYXJlbmFNZXNoMiAmJiB3aW5kb3cuZmx1eC5hcmVuYU1lc2gyLm1hdGVyaWFsKSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguYXJlbmFNZXNoMi5tYXRlcmlhbC5ibGVuZGluZyA9IGJsZW5kTW9kZXNbdl07CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguYXJlbmFNZXNoMi5tYXRlcmlhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQXBwbHkgZGVmYXVsdHMKICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmFyZW5hTWVzaCAmJiB3aW5kb3cuZmx1eC5hcmVuYU1lc2gubWF0ZXJpYWwpIHsKICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmFyZW5hTWVzaC5tYXRlcmlhbC5vcGFjaXR5ID0gcGFyYW1zLmFyZW5hT3BhY2l0eTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAod2luZG93LmZsdXguYXJlbmFNZXNoMiAmJiB3aW5kb3cuZmx1eC5hcmVuYU1lc2gyLm1hdGVyaWFsKSB7CiAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5hcmVuYU1lc2gyLm1hdGVyaWFsLm9wYWNpdHkgPSBwYXJhbXMuYXJlbmEyT3BhY2l0eTsKICAgICAgICAgICAgfQogICAgICAgIH0KCl9zZXR1cE92ZXJsYXlzKCkgewogICAgICAgICAgICBjb25zdCBmb2xkZXIgPSB0aGlzLmd1aS5hZGRGb2xkZXIoJ092ZXJsYXlzICYgRlgnKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIDEuIEdJRiBPdmVybGF5CiAgICAgICAgICAgIGNvbnN0IGdpZkVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjcmVlbi1vdmVybGF5LWdpZicpOwogICAgICAgICAgICBpZiAoZ2lmRWwpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGdpZlBhcmFtcyA9IHsKICAgICAgICAgICAgICAgICAgICB2aXNpYmxlOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAuNzIsCiAgICAgICAgICAgICAgICAgICAgYmxlbmQ6ICdzb2Z0LWxpZ2h0JwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgZ0ZvbGRlciA9IGZvbGRlci5hZGRGb2xkZXIoJ1NjcmVlbiBHSUYnKTsKICAgICAgICAgICAgICAgIGdGb2xkZXIuYWRkKGdpZlBhcmFtcywgJ3Zpc2libGUnKS5vbkNoYW5nZSh2ID0+IGdpZkVsLnN0eWxlLmRpc3BsYXkgPSB2ID8gJ2Jsb2NrJyA6ICdub25lJyk7CiAgICAgICAgICAgICAgICBnRm9sZGVyLmFkZChnaWZQYXJhbXMsICdvcGFjaXR5JywgMC4wLCAxLjApLm9uQ2hhbmdlKHYgPT4gZ2lmRWwuc3R5bGUub3BhY2l0eSA9IHYpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBibGVuZE1vZGVzID0gWwogICAgICAgICAgICAgICAgICAgICdub3JtYWwnLCAnbXVsdGlwbHknLCAnc2NyZWVuJywgJ292ZXJsYXknLCAKICAgICAgICAgICAgICAgICAgICAnZGFya2VuJywgJ2xpZ2h0ZW4nLCAnY29sb3ItZG9kZ2UnLCAnY29sb3ItYnVybicsIAogICAgICAgICAgICAgICAgICAgICdoYXJkLWxpZ2h0JywgJ3NvZnQtbGlnaHQnLCAnZGlmZmVyZW5jZScsICdleGNsdXNpb24nLCAKICAgICAgICAgICAgICAgICAgICAnaHVlJywgJ3NhdHVyYXRpb24nLCAnY29sb3InLCAnbHVtaW5vc2l0eScKICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICBnRm9sZGVyLmFkZChnaWZQYXJhbXMsICdibGVuZCcsIGJsZW5kTW9kZXMpLm9uQ2hhbmdlKHYgPT4gZ2lmRWwuc3R5bGUubWl4QmxlbmRNb2RlID0gdik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDIuIFdhdGVyIE92ZXJsYXkKICAgICAgICAgICAgY29uc3Qgd28gPSB0aGlzLmdhbWUud2F0ZXJPdmVybGF5OwogICAgICAgICAgICBpZiAod28gJiYgd28ubWVzaCkgewogICAgICAgICAgICAgICAgY29uc3Qgd0ZvbGRlciA9IGZvbGRlci5hZGRGb2xkZXIoJ1dhdGVyIFNoYWRlcicpOwogICAgICAgICAgICAgICAgY29uc3Qgd1BhcmFtcyA9IHsgCiAgICAgICAgICAgICAgICAgICAgdmlzaWJsZTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiB3by5tYXRlcmlhbC51bmlmb3Jtcy51T3BhY2l0eSA/IHdvLm1hdGVyaWFsLnVuaWZvcm1zLnVPcGFjaXR5LnZhbHVlIDogMC41LAogICAgICAgICAgICAgICAgICAgIGJsZW5kOiAnQWRkaXRpdmUnCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB3Rm9sZGVyLmFkZCh3UGFyYW1zLCAndmlzaWJsZScpLm9uQ2hhbmdlKHYgPT4gd28ubWVzaC52aXNpYmxlID0gdik7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmICh3by5tYXRlcmlhbC51bmlmb3Jtcy51T3BhY2l0eSkgewogICAgICAgICAgICAgICAgICAgIHdGb2xkZXIuYWRkKHdQYXJhbXMsICdvcGFjaXR5JywgMC4wLCAyLjApLm9uQ2hhbmdlKHYgPT4gd28ubWF0ZXJpYWwudW5pZm9ybXMudU9wYWNpdHkudmFsdWUgPSB2KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCB0aHJlZUJsZW5kcyA9IHsKICAgICAgICAgICAgICAgICAgICAnTm9ybWFsJzogVEhSRUUuTm9ybWFsQmxlbmRpbmcsCiAgICAgICAgICAgICAgICAgICAgJ0FkZGl0aXZlJzogVEhSRUUuQWRkaXRpdmVCbGVuZGluZywKICAgICAgICAgICAgICAgICAgICAnU3VidHJhY3RpdmUnOiBUSFJFRS5TdWJ0cmFjdGl2ZUJsZW5kaW5nLAogICAgICAgICAgICAgICAgICAgICdNdWx0aXBseSc6IFRIUkVFLk11bHRpcGx5QmxlbmRpbmcsCiAgICAgICAgICAgICAgICAgICAgJ05vQmxlbmRpbmcnOiBUSFJFRS5Ob0JsZW5kaW5nCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB3Rm9sZGVyLmFkZCh3UGFyYW1zLCAnYmxlbmQnLCBPYmplY3Qua2V5cyh0aHJlZUJsZW5kcykpLm9uQ2hhbmdlKHYgPT4gewogICAgICAgICAgICAgICAgICAgIHdvLm1hdGVyaWFsLmJsZW5kaW5nID0gdGhyZWVCbGVuZHNbdl07CiAgICAgICAgICAgICAgICAgICAgd28ubWF0ZXJpYWwubmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDMuIExpZ2h0IFNoYWZ0cwogICAgICAgICAgICBjb25zdCBscyA9IHRoaXMuZ2FtZS5saWdodFNoYWZ0czsKICAgICAgICAgICAgaWYgKGxzICYmIGxzLmNvbnRhaW5lcikgewogICAgICAgICAgICAgICAgY29uc3QgbFBhcmFtcyA9IHsgdmlzaWJsZTogdHJ1ZSB9OwogICAgICAgICAgICAgICAgZm9sZGVyLmFkZChsUGFyYW1zLCAndmlzaWJsZScpLm5hbWUoJ0xpZ2h0IFNoYWZ0cycpLm9uQ2hhbmdlKHYgPT4gbHMuY29udGFpbmVyLnZpc2libGUgPSB2KTsKICAgICAgICAgICAgfQogICAgICAgIH0KCl9zZXR1cEdhbWVTdGF0ZSgpIHsKICAgICAgICAgICAgY29uc3QgZm9sZGVyID0gdGhpcy5ndWkuYWRkRm9sZGVyKCdHYW1lIFN0YXRlJyk7CiAgICAgICAgICAgIGNvbnN0IGdtID0gdGhpcy5nYW1lOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgcGFyYW1zID0gewogICAgICAgICAgICAgICAgZm9yY2VIb21lR29hbDogKCkgPT4geyAKICAgICAgICAgICAgICAgICAgICBpZihnbS5zdGF0ZSA9PT0gJ2FjdGl2ZScpIGdtLmdvYWxTY29yZWQoJ2hvbWUnKTsgCiAgICAgICAgICAgICAgICAgICAgZWxzZSBjb25zb2xlLndhcm4oIkdhbWUgbXVzdCBiZSBhY3RpdmUgdG8gdHJpZ2dlciBnb2FsIik7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZm9yY2VBd2F5R29hbDogKCkgPT4geyAKICAgICAgICAgICAgICAgICAgICBpZihnbS5zdGF0ZSA9PT0gJ2FjdGl2ZScpIGdtLmdvYWxTY29yZWQoJ2F3YXknKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGNvbnNvbGUud2FybigiR2FtZSBtdXN0IGJlIGFjdGl2ZSB0byB0cmlnZ2VyIGdvYWwiKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBmb3JjZUhhbGZ0aW1lOiAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYoZ20uc3RhdGUgPT09ICdhY3RpdmUnKSBnbS5lbmRIYWxmKCk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVzZXRSb3VuZDogKCkgPT4gZ20ucmVzZXRSb3VuZCgpLAogICAgICAgICAgICAgICAgZXhpdFRvTWVudTogKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UgJiYgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLm1lbnVNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5tZW51TWFuYWdlci5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5zdGF0ZSA9ICdtZW51JzsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3RvcCBwcmFjdGljZSBpZiBydW5uaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UucHJhY3RpY2VNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UucHJhY3RpY2VNYW5hZ2VyLnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGZvbGRlci5hZGQocGFyYW1zLCAnZm9yY2VIb21lR29hbCcpLm5hbWUoJ1RyaWdnZXIgSG9tZSBHb2FsJyk7CiAgICAgICAgICAgIGZvbGRlci5hZGQocGFyYW1zLCAnZm9yY2VBd2F5R29hbCcpLm5hbWUoJ1RyaWdnZXIgQXdheSBHb2FsJyk7CiAgICAgICAgICAgIGZvbGRlci5hZGQocGFyYW1zLCAnZm9yY2VIYWxmdGltZScpLm5hbWUoJ0ZvcmNlIEhhbGZ0aW1lJyk7CiAgICAgICAgICAgIGZvbGRlci5hZGQocGFyYW1zLCAncmVzZXRSb3VuZCcpLm5hbWUoJ1Jlc2V0IFJvdW5kJyk7CiAgICAgICAgICAgIGZvbGRlci5hZGQocGFyYW1zLCAnZXhpdFRvTWVudScpLm5hbWUoJ0V4aXQgdG8gTWVudScpOwogICAgICAgIH0KCiAgICAgICAgX3NldHVwVGVhbXMoKSB7CiAgICAgICAgICAgIGNvbnN0IGZvbGRlciA9IHRoaXMuZ3VpLmFkZEZvbGRlcignVGVhbXMnKTsKICAgICAgICAgICAgaWYgKCF0aGlzLmdhbWUudGVhbXMuaG9tZSB8fCAhdGhpcy5nYW1lLnRlYW1zLmF3YXkpIHJldHVybjsKCiAgICAgICAgICAgIGNvbnN0IGhvbWUgPSB0aGlzLmdhbWUudGVhbXMuaG9tZTsKICAgICAgICAgICAgY29uc3QgYXdheSA9IHRoaXMuZ2FtZS50ZWFtcy5hd2F5OwoKICAgICAgICAgICAgLy8gSG9tZQogICAgICAgICAgICBjb25zdCBoRm9sZGVyID0gZm9sZGVyLmFkZEZvbGRlcignSG9tZSBUZWFtJyk7CiAgICAgICAgICAgIGhGb2xkZXIuYWRkKGhvbWUsICdpc0h1bWFuJykubmFtZSgnSXMgSHVtYW4gQ29udHJvbGxlZCcpLmxpc3RlbigpOwogICAgICAgICAgICBoRm9sZGVyLmFkZChob21lLCAnYWlFbmFibGVkJykubmFtZSgnQUkgTG9naWMgRW5hYmxlZCcpLmxpc3RlbigpOwoKICAgICAgICAgICAgLy8gQXdheQogICAgICAgICAgICBjb25zdCBhRm9sZGVyID0gZm9sZGVyLmFkZEZvbGRlcignQXdheSBUZWFtJyk7CiAgICAgICAgICAgIGFGb2xkZXIuYWRkKGF3YXksICdpc0h1bWFuJykubmFtZSgnSXMgSHVtYW4gQ29udHJvbGxlZCcpLmxpc3RlbigpOwogICAgICAgICAgICBhRm9sZGVyLmFkZChhd2F5LCAnYWlFbmFibGVkJykubmFtZSgnQUkgTG9naWMgRW5hYmxlZCcpLmxpc3RlbigpOwoKICAgICAgICB9Cgpfc2V0dXBQbGF5ZXJJbnNwZWN0b3IoKSB7CiAgICAgICAgICAgIGNvbnN0IGZvbGRlciA9IHRoaXMuZ3VpLmFkZEZvbGRlcignUGxheWVyIEluc3BlY3RvciAoSG9tZSBBY3RpdmUpJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBIZWxwZXIgdG8gZ2V0IGN1cnJlbnQgYWN0aXZlIHBsYXllciBzYWZlbHkKICAgICAgICAgICAgY29uc3QgZ2V0QWN0aXZlID0gKCkgPT4gewogICAgICAgICAgICAgICAgcmV0dXJuICh0aGlzLmdhbWUudGVhbXMuaG9tZSAmJiB0aGlzLmdhbWUudGVhbXMuaG9tZS5hY3RpdmVQbGF5ZXIpIAogICAgICAgICAgICAgICAgICAgID8gdGhpcy5nYW1lLnRlYW1zLmhvbWUuYWN0aXZlUGxheWVyIAogICAgICAgICAgICAgICAgICAgIDogbnVsbDsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8vIFByb3h5IG9iamVjdCB0byBiaW5kIEdVSSB0byBkeW5hbWljIHRhcmdldAogICAgICAgICAgICBjb25zdCBwcm94eSA9IHsKICAgICAgICAgICAgICAgIGdldCBSb2xlKCkgeyAKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gZ2V0QWN0aXZlKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHAgPyBwLnJvbGUgOiAnLSc7IAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZ2V0IEdvZE1vZGUoKSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcCA/IHAuaXNHb2RNb2RlIDogZmFsc2U7IAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNldCBHb2RNb2RlKHYpIHsgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IGdldEFjdGl2ZSgpOwogICAgICAgICAgICAgICAgICAgIGlmKHApIHAuaXNHb2RNb2RlID0gdjsgCiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIC8vIFJ1bnRpbWUgVmFsdWVzCiAgICAgICAgICAgICAgICBnZXQgSFAoKSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcCA/IHAuc3RhdHMuSFAgOiAwOyAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZXQgSFAodikgeyAKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gZ2V0QWN0aXZlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYocCkgcC5zdGF0cy5IUCA9IHY7IAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZ2V0IEN1cnJlbnRFTigpIHsgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IGdldEFjdGl2ZSgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBwID8gcC5jdXJyZW50RU4gOiAwOyAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZXQgQ3VycmVudEVOKHYpIHsgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IGdldEFjdGl2ZSgpOwogICAgICAgICAgICAgICAgICAgIGlmKHApIHAuY3VycmVudEVOID0gdjsgCiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIC8vIEJhc2UgU3RhdHMKICAgICAgICAgICAgICAgIGdldCBNYXhIUCgpIHsgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IGdldEFjdGl2ZSgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBwID8gcC5zdGF0cy5tYXhIUCA6IDA7IAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNldCBNYXhIUCh2KSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICBpZihwKSBwLnN0YXRzLm1heEhQID0gdjsgCiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIGdldCBTUCgpIHsgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IGdldEFjdGl2ZSgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBwID8gcC5zdGF0cy5TUCA6IDA7IAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNldCBTUCh2KSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICBpZihwKSB7IAogICAgICAgICAgICAgICAgICAgICAgICBwLnN0YXRzLlNQID0gdjsgCiAgICAgICAgICAgICAgICAgICAgICAgIHAuX3VwZGF0ZURlcml2ZWRTdGF0cygpOyAKICAgICAgICAgICAgICAgICAgICB9IAogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICBnZXQgRU4oKSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcCA/IHAuc3RhdHMuRU4gOiAwOyAKICAgICAgICAgICAgICAgIH0sIAogICAgICAgICAgICAgICAgc2V0IEVOKHYpIHsgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IGdldEFjdGl2ZSgpOwogICAgICAgICAgICAgICAgICAgIGlmKHApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcC5zdGF0cy5FTiA9IHY7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICBnZXQgQVQoKSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcCA/IHAuc3RhdHMuQVQgOiAwOyAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZXQgQVQodikgeyAKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gZ2V0QWN0aXZlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYocCkgcC5zdGF0cy5BVCA9IHY7IAogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICBnZXQgUEEoKSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcCA/IHAuc3RhdHMuUEEgOiAwOyAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZXQgUEEodikgeyAKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gZ2V0QWN0aXZlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYocCkgcC5zdGF0cy5QQSA9IHY7IAogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICBnZXQgQkwoKSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcCA/IHAuc3RhdHMuQkwgOiAwOyAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZXQgQkwodikgeyAKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gZ2V0QWN0aXZlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYocCkgcC5zdGF0cy5CTCA9IHY7IAogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICBnZXQgU0goKSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcCA/IHAuc3RhdHMuU0ggOiAwOyAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZXQgU0godikgeyAKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gZ2V0QWN0aXZlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYocCkgcC5zdGF0cy5TSCA9IHY7IAogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICBnZXQgQ0EoKSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcCA/IHAuc3RhdHMuQ0EgOiAwOyAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZXQgQ0EodikgeyAKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gZ2V0QWN0aXZlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYocCkgcC5zdGF0cy5DQSA9IHY7IAogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAvLyBBY3Rpb25zCiAgICAgICAgICAgICAgICBMZXZlbFVwOiAoKSA9PiB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICBpZihwKSBwLmxldmVsVXAoKTsgCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgRnVsbEhlYWw6ICgpID0+IHsgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IGdldEFjdGl2ZSgpOyAKICAgICAgICAgICAgICAgICAgICBpZihwKSB7IAogICAgICAgICAgICAgICAgICAgICAgICBwLnN0YXRzLkhQID0gcC5zdGF0cy5tYXhIUDsgCiAgICAgICAgICAgICAgICAgICAgICAgIHAuY3VycmVudEVOID0gcC5nZXRTdGF0KCdFTicpOyAKICAgICAgICAgICAgICAgICAgICAgICAgcC5zdGF0dXMudmVub20gPSAwOyAKICAgICAgICAgICAgICAgICAgICAgICAgcC5zdGF0dXMubmFwID0gMDsgCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcihsZXQgayBpbiBwLnN0YXR1cy53aXRoZXIpIHAuc3RhdHVzLndpdGhlcltrXSA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIkZVTEwgSEVBTCIsIHAubWVzaC5wb3NpdGlvbiwgImhlYWwiKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgRHJhaW5FTjogKCkgPT4geyAKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gZ2V0QWN0aXZlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYocCkgewogICAgICAgICAgICAgICAgICAgICAgICBwLmN1cnJlbnRFTiA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIHAuZnVtYmxlKCk7IC8vIFRyaWdnZXIgZnVtYmxlIGxvZ2ljCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgZm9sZGVyLmFkZChwcm94eSwgJ1JvbGUnKS5saXN0ZW4oKS5kaXNhYmxlKCk7CiAgICAgICAgICAgIGZvbGRlci5hZGQocHJveHksICdHb2RNb2RlJykubmFtZSgnR29kIE1vZGUgKEluZiBIUC9FTiknKS5saXN0ZW4oKTsKCiAgICAgICAgICAgIGNvbnN0IHJ0Rm9sZGVyID0gZm9sZGVyLmFkZEZvbGRlcignUnVudGltZSBTdGF0dXMnKTsKICAgICAgICAgICAgcnRGb2xkZXIuYWRkKHByb3h5LCAnSFAnLCAwLCA5OTk5KS5saXN0ZW4oKTsKICAgICAgICAgICAgcnRGb2xkZXIuYWRkKHByb3h5LCAnQ3VycmVudEVOJywgMCwgMTAwKS5uYW1lKCdDdXJyZW50IEVOJykubGlzdGVuKCk7CgogICAgICAgICAgICBjb25zdCBzdGF0Rm9sZGVyID0gZm9sZGVyLmFkZEZvbGRlcignQmFzZSBTdGF0cycpOwogICAgICAgICAgICBzdGF0Rm9sZGVyLmFkZChwcm94eSwgJ01heEhQJywgMTAwLCA5OTk5KS5saXN0ZW4oKTsKICAgICAgICAgICAgc3RhdEZvbGRlci5hZGQocHJveHksICdFTicsIDAsIDk5KS5uYW1lKCdNYXggRU4nKS5saXN0ZW4oKTsKICAgICAgICAgICAgc3RhdEZvbGRlci5hZGQocHJveHksICdTUCcsIDAsIDk5KS5saXN0ZW4oKTsKICAgICAgICAgICAgc3RhdEZvbGRlci5hZGQocHJveHksICdBVCcsIDAsIDk5KS5saXN0ZW4oKTsKICAgICAgICAgICAgc3RhdEZvbGRlci5hZGQocHJveHksICdQQScsIDAsIDk5KS5saXN0ZW4oKTsKICAgICAgICAgICAgc3RhdEZvbGRlci5hZGQocHJveHksICdCTCcsIDAsIDk5KS5saXN0ZW4oKTsKICAgICAgICAgICAgc3RhdEZvbGRlci5hZGQocHJveHksICdTSCcsIDAsIDk5KS5saXN0ZW4oKTsKICAgICAgICAgICAgc3RhdEZvbGRlci5hZGQocHJveHksICdDQScsIDAsIDk5KS5saXN0ZW4oKTsKCiAgICAgICAgICAgIGNvbnN0IGFjdGlvbkZvbGRlciA9IGZvbGRlci5hZGRGb2xkZXIoJ0FjdGlvbnMnKTsKICAgICAgICAgICAgYWN0aW9uRm9sZGVyLmFkZChwcm94eSwgJ0xldmVsVXAnKS5uYW1lKCdJbnN0YW50IExldmVsIFVwJyk7CiAgICAgICAgICAgIGFjdGlvbkZvbGRlci5hZGQocHJveHksICdGdWxsSGVhbCcpLm5hbWUoJ0Z1bGwgSGVhbCAmIEN1cmUnKTsKICAgICAgICAgICAgYWN0aW9uRm9sZGVyLmFkZChwcm94eSwgJ0RyYWluRU4nKS5uYW1lKCdEcmFpbiBFTiAoRnVtYmxlKScpOwogICAgICAgIH0KCiAgICAgICAgX3NldHVwQmFsbFNhbmRib3goKSB7CiAgICAgICAgICAgIGNvbnN0IGZvbGRlciA9IHRoaXMuZ3VpLmFkZEZvbGRlcignQmFsbCAmIFBoeXNpY3MgU2FuZGJveCcpOwogICAgICAgICAgICBjb25zdCBDID0gd2luZG93LmZsdXguQmFsbENvbmZpZzsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICghQykgewogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJCYWxsQ29uZmlnIG5vdCBmb3VuZC4gU2tpcHBpbmcgUGh5c2ljcyBTYW5kYm94LiIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAxLiBQaHlzaWNzIENvbnN0YW50cwogICAgICAgICAgICBjb25zdCBwaHlzRm9sZGVyID0gZm9sZGVyLmFkZEZvbGRlcignUGh5c2ljcyBDb25zdGFudHMnKTsKICAgICAgICAgICAgcGh5c0ZvbGRlci5hZGQoQywgJ1dBVEVSX0RSQUcnLCAwLjAsIDUuMCkubmFtZSgnV2F0ZXIgRHJhZycpOwogICAgICAgICAgICBwaHlzRm9sZGVyLmFkZChDLCAnU1BJTl9EUkFHJywgMC4wLCA1LjApLm5hbWUoJ1NwaW4gRGVjYXknKTsKICAgICAgICAgICAgcGh5c0ZvbGRlci5hZGQoQywgJ01BR05VU19DT0VGRicsIDAuMCwgNS4wKS5uYW1lKCdNYWdudXMgRWZmZWN0Jyk7CiAgICAgICAgICAgIHBoeXNGb2xkZXIuYWRkKEMsICdHUkFWSVRZX1NQUklORycsIDAuMCwgMjAuMCkubmFtZSgnVmVydCBTcHJpbmcnKTsKICAgICAgICAgICAgcGh5c0ZvbGRlci5hZGQoQywgJ0dSQVZJVFlfREFNUCcsIDAuMCwgMTAuMCkubmFtZSgnVmVydCBEYW1wJyk7CiAgICAgICAgICAgIHBoeXNGb2xkZXIuYWRkKEMsICdCT1VOREFSWV9SQURJVVMnLCAxMC4wLCAxMDAuMCkubmFtZSgnQXJlbmEgU2l6ZScpOwoKICAgICAgICAgICAgLy8gMi4gVGVsZXBvcnQgVG9vbHMKICAgICAgICAgICAgY29uc3QgdHBGb2xkZXIgPSBmb2xkZXIuYWRkRm9sZGVyKCdUZWxlcG9ydCBCYWxsJyk7CiAgICAgICAgICAgIGNvbnN0IHRwUGFyYW1zID0gewogICAgICAgICAgICAgICAgVG9DZW50ZXI6ICgpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBiID0gdGhpcy5nYW1lLmVudGl0aWVzLmJhbGw7CiAgICAgICAgICAgICAgICAgICAgaWYoYikgYi5yZXNldCgpOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIFRvQWN0aXZlUGxheWVyOiAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYiA9IHRoaXMuZ2FtZS5lbnRpdGllcy5iYWxsOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSB0aGlzLmdhbWUudGVhbXMuaG9tZS5hY3RpdmVQbGF5ZXI7CiAgICAgICAgICAgICAgICAgICAgaWYoYiAmJiBwKSBiLmdyYWIocCk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgVG9Ib21lR29hbDogKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLmdhbWUuZW50aXRpZXMuYmFsbDsKICAgICAgICAgICAgICAgICAgICBpZihiKSB7IGIuZHJvcCgpOyBiLm1lc2gucG9zaXRpb24uc2V0KDAsIDAsIDI1KTsgYi52ZWxvY2l0eS5zZXQoMCwwLDApOyB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgVG9Bd2F5R29hbDogKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLmdhbWUuZW50aXRpZXMuYmFsbDsKICAgICAgICAgICAgICAgICAgICBpZihiKSB7IGIuZHJvcCgpOyBiLm1lc2gucG9zaXRpb24uc2V0KDAsIDAsIC0yNSk7IGIudmVsb2NpdHkuc2V0KDAsMCwwKTsgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIFRvU2t5OiAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYiA9IHRoaXMuZ2FtZS5lbnRpdGllcy5iYWxsOwogICAgICAgICAgICAgICAgICAgIGlmKGIpIHsgYi5kcm9wKCk7IGIubWVzaC5wb3NpdGlvbi5zZXQoMCwgMTAsIDApOyBiLnZlbG9jaXR5LnNldCgwLDAsMCk7IH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgdHBGb2xkZXIuYWRkKHRwUGFyYW1zLCAnVG9DZW50ZXInKTsKICAgICAgICAgICAgdHBGb2xkZXIuYWRkKHRwUGFyYW1zLCAnVG9BY3RpdmVQbGF5ZXInKTsKICAgICAgICAgICAgdHBGb2xkZXIuYWRkKHRwUGFyYW1zLCAnVG9Ib21lR29hbCcpOwogICAgICAgICAgICB0cEZvbGRlci5hZGQodHBQYXJhbXMsICdUb0F3YXlHb2FsJyk7CiAgICAgICAgICAgIHRwRm9sZGVyLmFkZCh0cFBhcmFtcywgJ1RvU2t5Jyk7CgogICAgICAgICAgICAvLyAzLiBGb3JjZSBTaG9vdAogICAgICAgICAgICBjb25zdCBzaG9vdEZvbGRlciA9IGZvbGRlci5hZGRGb2xkZXIoJ0ZvcmNlIFNob290Jyk7CiAgICAgICAgICAgIGNvbnN0IHNob290UGFyYW1zID0gewogICAgICAgICAgICAgICAgUG93ZXI6IDIwLAogICAgICAgICAgICAgICAgQ3VydmU6IDAsCiAgICAgICAgICAgICAgICBTaG9vdEZvcndhcmQ6ICgpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBiID0gdGhpcy5nYW1lLmVudGl0aWVzLmJhbGw7CiAgICAgICAgICAgICAgICAgICAgaWYoYikgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBTaG9vdCB0b3dhcmRzIC1aIChIb21lIEF0dGFjayBEaXJlY3Rpb24pCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpciA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIC0xKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3BpbiA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIHNob290UGFyYW1zLkN1cnZlLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgYi5zaG9vdChkaXIsIHNob290UGFyYW1zLlBvd2VyLCAnU0gnLCBudWxsLCBzcGluKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgU2hvb3RCYWNrd2FyZDogKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLmdhbWUuZW50aXRpZXMuYmFsbDsKICAgICAgICAgICAgICAgICAgICBpZihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpciA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIDEpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzcGluID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgc2hvb3RQYXJhbXMuQ3VydmUsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBiLnNob290KGRpciwgc2hvb3RQYXJhbXMuUG93ZXIsICdTSCcsIG51bGwsIHNwaW4pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBTaG9vdFVwOiAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYiA9IHRoaXMuZ2FtZS5lbnRpdGllcy5iYWxsOwogICAgICAgICAgICAgICAgICAgIGlmKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlyID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMSwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGIuc2hvb3QoZGlyLCBzaG9vdFBhcmFtcy5Qb3dlciwgJ1BBJyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIFJhbmRvbUN1cnZlOiAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYiA9IHRoaXMuZ2FtZS5lbnRpdGllcy5iYWxsOwogICAgICAgICAgICAgICAgICAgIGlmKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlyID0gbmV3IFRIUkVFLlZlY3RvcjMoTWF0aC5yYW5kb20oKS0wLjUsIDAsIE1hdGgucmFuZG9tKCktMC41KS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3BpbiA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIChNYXRoLnJhbmRvbSgpLTAuNSkqMjAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBiLnNob290KGRpciwgc2hvb3RQYXJhbXMuUG93ZXIsICdTSCcsIG51bGwsIHNwaW4pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgc2hvb3RGb2xkZXIuYWRkKHNob290UGFyYW1zLCAnUG93ZXInLCA1LCA1MCk7CiAgICAgICAgICAgIHNob290Rm9sZGVyLmFkZChzaG9vdFBhcmFtcywgJ0N1cnZlJywgLTIwLCAyMCkubmFtZSgnU3BpbiBZJyk7CiAgICAgICAgICAgIHNob290Rm9sZGVyLmFkZChzaG9vdFBhcmFtcywgJ1Nob290Rm9yd2FyZCcpOwogICAgICAgICAgICBzaG9vdEZvbGRlci5hZGQoc2hvb3RQYXJhbXMsICdTaG9vdEJhY2t3YXJkJyk7CiAgICAgICAgICAgIHNob290Rm9sZGVyLmFkZChzaG9vdFBhcmFtcywgJ1Nob290VXAnKTsKICAgICAgICAgICAgc2hvb3RGb2xkZXIuYWRkKHNob290UGFyYW1zLCAnUmFuZG9tQ3VydmUnKTsKICAgICAgICB9CiAgICB9Cgp3aW5kb3cuZmx1eC5EZXZUb29scyA9IERldlRvb2xzOwoKICAgIERldlRvb2xzLnByb3RvdHlwZS5fc2V0dXBWaXN1YWxEZWJ1ZyA9IGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnN0IGZvbGRlciA9IHRoaXMuZ3VpLmFkZEZvbGRlcignVmlzdWFsIERlYnVnZ2luZycpOwogICAgICAgIGNvbnN0IGR2ID0gdGhpcy5nYW1lLmRlYnVnVmlzdWFsaXplcjsKICAgICAgICBpZiAoIWR2KSByZXR1cm47CgogICAgICAgIGNvbnN0IHBhcmFtcyA9IHsKICAgICAgICAgICAgZW5hYmxlZDogZHYuZW5hYmxlZCwKICAgICAgICAgICAgaGl0Ym94ZXM6IGR2LnNob3dIaXRib3hlcywKICAgICAgICAgICAgdmVjdG9yczogZHYuc2hvd1ZlY3RvcnMsCiAgICAgICAgICAgIGFpOiBkdi5zaG93QUkKICAgICAgICB9OwoKICAgICAgICBmb2xkZXIuYWRkKHBhcmFtcywgJ2VuYWJsZWQnKS5uYW1lKCdFbmFibGUgVmlzdWFsaXplcicpLm9uQ2hhbmdlKHYgPT4gZHYuZW5hYmxlZCA9IHYpOwogICAgICAgIGZvbGRlci5hZGQocGFyYW1zLCAnaGl0Ym94ZXMnKS5uYW1lKCdTaG93IEhpdGJveGVzJykub25DaGFuZ2UodiA9PiBkdi5zaG93SGl0Ym94ZXMgPSB2KTsKICAgICAgICBmb2xkZXIuYWRkKHBhcmFtcywgJ3ZlY3RvcnMnKS5uYW1lKCdTaG93IFZlY3RvcnMnKS5vbkNoYW5nZSh2ID0+IGR2LnNob3dWZWN0b3JzID0gdik7CiAgICAgICAgZm9sZGVyLmFkZChwYXJhbXMsICdhaScpLm5hbWUoJ1Nob3cgQUkgUGVyY2VwdGlvbicpLm9uQ2hhbmdlKHYgPT4gZHYuc2hvd0FJID0gdik7CiAgICB9OwoKICAgIERldlRvb2xzLnByb3RvdHlwZS5fc2V0dXBGWExhYiA9IGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnN0IGZvbGRlciA9IHRoaXMuZ3VpLmFkZEZvbGRlcignRlggTGFiICYgVUkgVGVzdCcpOwogICAgICAgIAogICAgICAgIGNvbnN0IGdldFRhcmdldFBvcyA9ICgpID0+IHsKICAgICAgICAgICAgY29uc3QgcCA9IHRoaXMuZ2FtZS50ZWFtcy5ob21lLmFjdGl2ZVBsYXllcjsKICAgICAgICAgICAgcmV0dXJuIHAgJiYgcC5tZXNoID8gcC5tZXNoLnBvc2l0aW9uIDogbmV3IFRIUkVFLlZlY3RvcjMoMCwgMiwgMCk7CiAgICAgICAgfTsKCiAgICAgICAgY29uc3QgZnhQYXJhbXMgPSB7CiAgICAgICAgICAgIFNwYXduVmVub206ICgpID0+IHRoaXMuZ2FtZS5wYXJ0aWNsZU1hbmFnZXIuc3Bhd24oJ3Zlbm9tJywgZ2V0VGFyZ2V0UG9zKCkpLAogICAgICAgICAgICBTcGF3bk5hcDogKCkgPT4gdGhpcy5nYW1lLnBhcnRpY2xlTWFuYWdlci5zcGF3bignbmFwJywgZ2V0VGFyZ2V0UG9zKCkpLAogICAgICAgICAgICBTcGF3bldpdGhlcjogKCkgPT4gdGhpcy5nYW1lLnBhcnRpY2xlTWFuYWdlci5zcGF3bignd2l0aGVyJywgZ2V0VGFyZ2V0UG9zKCkpLAogICAgICAgICAgICBTcGF3bkxlYXJuZWQ6ICgpID0+IHRoaXMuZ2FtZS5wYXJ0aWNsZU1hbmFnZXIuc3Bhd24oJ2xlYXJuZWQnLCBnZXRUYXJnZXRQb3MoKSksCiAgICAgICAgICAgIFNwYXduQ2xhc2g6ICgpID0+IHRoaXMuZ2FtZS5zcGF3bkNsYXNoKGdldFRhcmdldFBvcygpKSwKICAgICAgICB9OwoKICAgICAgICBjb25zdCBmeFN1YiA9IGZvbGRlci5hZGRGb2xkZXIoJ1BhcnRpY2xlcycpOwogICAgICAgIGZ4U3ViLmFkZChmeFBhcmFtcywgJ1NwYXduVmVub20nKTsKICAgICAgICBmeFN1Yi5hZGQoZnhQYXJhbXMsICdTcGF3bk5hcCcpOwogICAgICAgIGZ4U3ViLmFkZChmeFBhcmFtcywgJ1NwYXduV2l0aGVyJyk7CiAgICAgICAgZnhTdWIuYWRkKGZ4UGFyYW1zLCAnU3Bhd25MZWFybmVkJyk7CiAgICAgICAgZnhTdWIuYWRkKGZ4UGFyYW1zLCAnU3Bhd25DbGFzaCcpOwoKICAgICAgICBjb25zdCB0eHRQYXJhbXMgPSB7CiAgICAgICAgICAgIFRleHQ6ICJURVNUIiwKICAgICAgICAgICAgVHlwZTogImRhbWFnZSIsCiAgICAgICAgICAgIFNwYXduOiAoKSA9PiB7CiAgICAgICAgICAgICAgICBpZih0aGlzLmdhbWUuZmxvYXRpbmdUZXh0KSAKICAgICAgICAgICAgICAgICAgICB0aGlzLmdhbWUuZmxvYXRpbmdUZXh0LnNwYXduKHR4dFBhcmFtcy5UZXh0LCBnZXRUYXJnZXRQb3MoKSwgdHh0UGFyYW1zLlR5cGUpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICBjb25zdCB0eHRTdWIgPSBmb2xkZXIuYWRkRm9sZGVyKCdGbG9hdGluZyBUZXh0Jyk7CiAgICAgICAgdHh0U3ViLmFkZCh0eHRQYXJhbXMsICdUZXh0Jyk7CiAgICAgICAgdHh0U3ViLmFkZCh0eHRQYXJhbXMsICdUeXBlJywgWydkYW1hZ2UnLCAnaGVhbCcsICdzdGF0dXMnLCAndGVjaCcsICdjb21pYy1pbXBhY3QnLCAnY29taWMtYWN0aW9uJywgJ3NhdmUnLCAnYmxvY2snLCAnZGVmYXVsdCddKTsKICAgICAgICB0eHRTdWIuYWRkKHR4dFBhcmFtcywgJ1NwYXduJykubmFtZSgnU3Bhd24gVGV4dCcpOwoKICAgICAgICBjb25zdCBjYW1QYXJhbXMgPSB7CiAgICAgICAgICAgIFNoYWtlU21hbGw6ICgpID0+IHRoaXMuZ2FtZS5jYW1lcmFNYW5hZ2VyLmFkZFNoYWtlKDAuNSksCiAgICAgICAgICAgIFNoYWtlQmlnOiAoKSA9PiB0aGlzLmdhbWUuY2FtZXJhTWFuYWdlci5hZGRTaGFrZSgyLjApLAogICAgICAgICAgICBJbXBhY3RMaWdodDogKCkgPT4gdGhpcy5nYW1lLnRyaWdnZXJJbXBhY3QoMC4xLCAnZGVmYXVsdCcpLAogICAgICAgICAgICBJbXBhY3RIZWF2eTogKCkgPT4gdGhpcy5nYW1lLnRyaWdnZXJJbXBhY3QoMC4yLCAnaGVhdnknKSwKICAgICAgICAgICAgSW1wYWN0U2hhdHRlcjogKCkgPT4gdGhpcy5nYW1lLnRyaWdnZXJJbXBhY3QoMC40LCAnc2hhdHRlcicpLAogICAgICAgIH07CgogICAgICAgIGNvbnN0IGNhbVN1YiA9IGZvbGRlci5hZGRGb2xkZXIoJ0NhbWVyYSAmIEltcGFjdCcpOwogICAgICAgIGNhbVN1Yi5hZGQoY2FtUGFyYW1zLCAnU2hha2VTbWFsbCcpOwogICAgICAgIGNhbVN1Yi5hZGQoY2FtUGFyYW1zLCAnU2hha2VCaWcnKTsKICAgICAgICBjYW1TdWIuYWRkKGNhbVBhcmFtcywgJ0ltcGFjdExpZ2h0Jyk7CiAgICAgICAgY2FtU3ViLmFkZChjYW1QYXJhbXMsICdJbXBhY3RIZWF2eScpOwogICAgICAgIGNhbVN1Yi5hZGQoY2FtUGFyYW1zLCAnSW1wYWN0U2hhdHRlcicpOwogICAgfTsKCgpEZXZUb29scy5wcm90b3R5cGUuX3NldHVwVmlzdWFscyA9IGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnN0IGZvbGRlciA9IHRoaXMuZ3VpLmFkZEZvbGRlcignVmlzdWFsaXphdGlvbiBSb29tJyk7CiAgICAgICAgCiAgICAgICAgY29uc3Qgdml6UGFyYW1zID0gewogICAgICAgICAgICBhY3RpdmU6IGZhbHNlLAogICAgICAgICAgICBhc3NldDogJ1RpZHVzJywKICAgICAgICAgICAgc2NhbGU6IDEuMCwKICAgICAgICAgICAgYW5pbTogJ2lkbGUnLAogICAgICAgICAgICBzcGF3bjogKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLnZpekdyb3VwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy52aXpHcm91cCA9IG5ldyBUSFJFRS5Hcm91cCgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZ2FtZS5zY2VuZS5hZGQodGhpcy52aXpHcm91cCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBDbGVhciBwcmV2aW91cwogICAgICAgICAgICAgICAgd2hpbGUodGhpcy52aXpHcm91cC5jaGlsZHJlbi5sZW5ndGggPiAwKXsgCiAgICAgICAgICAgICAgICAgICAgdGhpcy52aXpHcm91cC5yZW1vdmUodGhpcy52aXpHcm91cC5jaGlsZHJlblswXSk7IAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCB1cmxNYXAgPSB7CiAgICAgICAgICAgICAgICAgICAgJ1RpZHVzJzogJ2h0dHBzOi8vY2RuLnRpbnlnbGIuY29tL21vZGVscy9kYTc4OGJlZjI1OGM0ZjBiOGQ5ZWYxYWNjMTljNTU2Ny5nbGInLAogICAgICAgICAgICAgICAgICAgICdXYWtrYSc6ICdodHRwczovL2Nkbi50aW55Z2xiLmNvbS9tb2RlbHMvNTkxMTRjOTg5NTE2NDdjOWI4ZGE3NGIwYmQzNjM2Y2IuZ2xiJywKICAgICAgICAgICAgICAgICAgICAnQmFsbCc6ICdodHRwczovL2Nkbi50aW55Z2xiLmNvbS9tb2RlbHMvNTIxYWU4Nzg4ZTU4NGUzNzhhNzlkOTczMmEwNzUzNTYuZ2xiJywKICAgICAgICAgICAgICAgICAgICAnR29hbCc6ICdodHRwczovL2Nkbi50aW55Z2xiLmNvbS9tb2RlbHMvYTUxNmJkOTBmYTdjNGRlZGI1ZGNiZmRmODAzZjEzZDUuZ2xiJwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgdXJsID0gdXJsTWFwW3ZpelBhcmFtcy5hc3NldF07CiAgICAgICAgICAgICAgICBpZih1cmwpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5Bc3NldExvYWRlci5sb2FkTW9kZWwodXJsLCAoZ2x0ZikgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtb2RlbCA9IGdsdGYuc2NlbmU7CiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsLnNjYWxlLnNldFNjYWxhcih2aXpQYXJhbXMuc2NhbGUpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZpekdyb3VwLmFkZChtb2RlbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZihnbHRmLmFuaW1hdGlvbnMgJiYgZ2x0Zi5hbmltYXRpb25zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudml6TWl4ZXIgPSBuZXcgVEhSRUUuQW5pbWF0aW9uTWl4ZXIobW9kZWwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVHJ5IHRvIGZpbmQgYW5pbWF0aW9uIGJ5IG5hbWUgb3IgZGVmYXVsdCB0byBmaXJzdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNsaXAgPSBUSFJFRS5BbmltYXRpb25DbGlwLmZpbmRCeU5hbWUoZ2x0Zi5hbmltYXRpb25zLCB2aXpQYXJhbXMuYW5pbSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWNsaXApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBGYWxsYmFjayBtYXBwaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbWFwID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaWRsZSc6IFsndHJlYWRpbmcnLCAnaWRsZSddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3dpbSc6IFsnc3dpbSddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndGhyb3cnOiBbJ3Rocm93J10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjYXRjaCc6IFsnY2F0Y2gnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JlYWN0JzogWydyZWFjdCcsICdoaXQnLCAnZGFtYWdlJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGtleXdvcmRzID0gbWFwW3ZpelBhcmFtcy5hbmltXSB8fCBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGlwID0gZ2x0Zi5hbmltYXRpb25zLmZpbmQoYSA9PiBrZXl3b3Jkcy5zb21lKGsgPT4gYS5uYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoaykpKSB8fCBnbHRmLmFuaW1hdGlvbnNbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjbGlwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52aXpNaXhlci5jbGlwQWN0aW9uKGNsaXApLnBsYXkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudml6TWl4ZXIgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRvZ2dsZVJvb206ICgpID0+IHsKICAgICAgICAgICAgICAgIHZpelBhcmFtcy5hY3RpdmUgPSAhdml6UGFyYW1zLmFjdGl2ZTsKICAgICAgICAgICAgICAgIGNvbnN0IGdhbWVMYXllciA9IFt0aGlzLmdhbWUudGVhbXMuaG9tZSwgdGhpcy5nYW1lLnRlYW1zLmF3YXksIHRoaXMuZ2FtZS5lbnRpdGllcy5iYWxsXTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gVG9nZ2xlIEdhbWUgVmlzaWJpbGl0eQogICAgICAgICAgICAgICAgZ2FtZUxheWVyLmZvckVhY2godCA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYodCAmJiB0LnBsYXllcnMpIHQucGxheWVycy5mb3JFYWNoKHAgPT4geyBpZihwLm1lc2gpIHAubWVzaC52aXNpYmxlID0gIXZpelBhcmFtcy5hY3RpdmU7IH0pOwogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYodCAmJiB0Lm1lc2gpIHQubWVzaC52aXNpYmxlID0gIXZpelBhcmFtcy5hY3RpdmU7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGlmKHdpbmRvdy5mbHV4LmFyZW5hTWVzaCkgd2luZG93LmZsdXguYXJlbmFNZXNoLnZpc2libGUgPSAhdml6UGFyYW1zLmFjdGl2ZTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYodml6UGFyYW1zLmFjdGl2ZSkgewogICAgICAgICAgICAgICAgICAgIC8vIE1vdmUgQ2FtZXJhIHRvIFZvaWQKICAgICAgICAgICAgICAgICAgICB0aGlzLmdhbWUuY2FtZXJhLnBvc2l0aW9uLnNldCgxMDAwLCA1LCAxMDEwKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmdhbWUuY2FtZXJhLmxvb2tBdCgxMDAwLCAyLCAxMDAwKTsKICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnZpekdyb3VwKSB0aGlzLnZpekdyb3VwLnBvc2l0aW9uLnNldCgxMDAwLCAwLCAxMDAwKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBBZGQgTGlnaHQgZm9yIFZpegogICAgICAgICAgICAgICAgICAgIGlmKCF0aGlzLnZpekxpZ2h0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudml6TGlnaHQgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCgweGZmZmZmZiwgMS4wKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52aXpMaWdodC5wb3NpdGlvbi5zZXQoMTAwNSwgMTAsIDEwMDUpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdhbWUuc2NlbmUuYWRkKHRoaXMudml6TGlnaHQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aGlzLnZpekxpZ2h0LnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFNwYXduIGluaXRpYWwKICAgICAgICAgICAgICAgICAgICB2aXpQYXJhbXMuc3Bhd24oKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gUmVzdG9yZSBDYW1lcmEKICAgICAgICAgICAgICAgICAgICBpZih0aGlzLmdhbWUuY2FtZXJhTWFuYWdlcikgdGhpcy5nYW1lLmNhbWVyYU1hbmFnZXIuc25hcFRvVGFyZ2V0KCk7CiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy52aXpMaWdodCkgdGhpcy52aXpMaWdodC52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIAogICAgICAgIGZvbGRlci5hZGQodml6UGFyYW1zLCAndG9nZ2xlUm9vbScpLm5hbWUoJ1RvZ2dsZSBSb29tJyk7CiAgICAgICAgZm9sZGVyLmFkZCh2aXpQYXJhbXMsICdhc3NldCcsIFsnVGlkdXMnLCAnV2Fra2EnLCAnQmFsbCcsICdHb2FsJ10pLm9uQ2hhbmdlKCgpID0+IHsgaWYodml6UGFyYW1zLmFjdGl2ZSkgdml6UGFyYW1zLnNwYXduKCk7IH0pOwogICAgICAgIGZvbGRlci5hZGQodml6UGFyYW1zLCAnc2NhbGUnLCAwLjEsIDUuMCkub25DaGFuZ2UodiA9PiB7CiAgICAgICAgICAgIGlmKHRoaXMudml6R3JvdXAgJiYgdGhpcy52aXpHcm91cC5jaGlsZHJlblswXSkgewogICAgICAgICAgICAgICAgdGhpcy52aXpHcm91cC5jaGlsZHJlblswXS5zY2FsZS5zZXRTY2FsYXIodik7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBmb2xkZXIuYWRkKHZpelBhcmFtcywgJ2FuaW0nLCBbJ2lkbGUnLCAnc3dpbScsICd0aHJvdycsICdjYXRjaCcsICdyZWFjdCddKS5uYW1lKCdBbmltYXRpb24nKS5vbkNoYW5nZSgoKSA9PiB7CiAgICAgICAgICAgICBpZih2aXpQYXJhbXMuYWN0aXZlKSB2aXpQYXJhbXMuc3Bhd24oKTsKICAgICAgICB9KTsKICAgICAgICBmb2xkZXIuYWRkKHZpelBhcmFtcywgJ3NwYXduJykubmFtZSgnUmVsb2FkIEFzc2V0Jyk7CiAgICAgICAgCiAgICAgICAgLy8gSG9vayBpbnRvIHVwZGF0ZSBsb29wIGZvciBtaXhlcgogICAgICAgIGNvbnN0IG9yaWdpbmFsVXBkYXRlID0gdGhpcy5nYW1lLnVwZGF0ZS5iaW5kKHRoaXMuZ2FtZSk7CiAgICAgICAgdGhpcy5nYW1lLnVwZGF0ZSA9IChkdCkgPT4gewogICAgICAgICAgICBvcmlnaW5hbFVwZGF0ZShkdCk7CiAgICAgICAgICAgIGlmICh2aXpQYXJhbXMuYWN0aXZlICYmIHRoaXMudml6TWl4ZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMudml6TWl4ZXIudXBkYXRlKGR0KTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9Owp9KSgpOw==","./DevTools.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICBjbGFzcyBEZXZUb29scyB7CiAgICAgICAgY29uc3RydWN0b3IoZ2FtZU1hbmFnZXIpIHsKICAgICAgICAgICAgdGhpcy5nYW1lID0gZ2FtZU1hbmFnZXI7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBsaWwtZ3VpIGF0dGFjaGVzIHRvIHdpbmRvdy5saWwgYnkgZGVmYXVsdCBpbiBVTUQgYnVpbGQKICAgICAgICAgICAgaWYgKCF3aW5kb3cubGlsIHx8ICF3aW5kb3cubGlsLkdVSSkgewogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJEZXZUb29sczogbGlsLWd1aSBub3QgZm91bmQuIik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCmNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYW1lLWNvbnRhaW5lcicpOwogICAgICAgICAgICB0aGlzLmd1aSA9IG5ldyB3aW5kb3cubGlsLkdVSSh7IHRpdGxlOiAnRmx1eCBEZXZUb29scycsIGNvbnRhaW5lcjogY29udGFpbmVyIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gUG9zaXRpb24gYXMgYSBjb2xsYXBzZWQgdGFiIG9uIHRoZSByaWdodCBmcmFtZQovLyBQb3NpdGlvbiBhcyBhIHNsaWRpbmcgdGFiIG9uIHRoZSByaWdodCBmcmFtZQovLyBQb3NpdGlvbiBhcyBhIHNsaWRpbmcgdGFiIG9uIHRoZSByaWdodCBmcmFtZQovLyBXcmFwcGVyIGZvciBzbGlkaW5nIGFuaW1hdGlvbgogICAgICAgICAgICBjb25zdCB3cmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIHdyYXBwZXIuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnOwogICAgICAgICAgICB3cmFwcGVyLnN0eWxlLnRvcCA9ICcxMDBweCc7CiAgICAgICAgICAgIHdyYXBwZXIuc3R5bGUucmlnaHQgPSAnLTI2MHB4JzsKICAgICAgICAgICAgd3JhcHBlci5zdHlsZS53aWR0aCA9ICcyNjBweCc7CiAgICAgICAgICAgIHdyYXBwZXIuc3R5bGUudHJhbnNpdGlvbiA9ICdyaWdodCAwLjNzIGN1YmljLWJlemllcigwLjIsIDAuOCwgMC4yLCAxLjApJzsKICAgICAgICAgICAgd3JhcHBlci5zdHlsZS56SW5kZXggPSAnOTk5OSc7CiAgICAgICAgICAgIHdyYXBwZXIuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgICAgICAgICAgd3JhcHBlci5zdHlsZS5mbGV4RGlyZWN0aW9uID0gJ2NvbHVtbic7CiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh3cmFwcGVyKTsKCiAgICAgICAgICAgIGNvbnN0IGRvbSA9IHRoaXMuZ3VpLmRvbUVsZW1lbnQ7CiAgICAgICAgICAgIGRvbS5zdHlsZS53aWR0aCA9ICcxMDAlJzsKICAgICAgICAgICAgZG9tLnN0eWxlLnNldFByb3BlcnR5KCctLXdpZHRoJywgJzEwMCUnKTsKICAgICAgICAgICAgZG9tLnN0eWxlLm1heEhlaWdodCA9ICc4MHZoJzsKICAgICAgICAgICAgZG9tLnN0eWxlLm92ZXJmbG93WSA9ICdhdXRvJzsKICAgICAgICAgICAgZG9tLnN0eWxlLm92ZXJmbG93WCA9ICdoaWRkZW4nOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gTW92ZSBHVUkgaW50byB3cmFwcGVyCiAgICAgICAgICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQoZG9tKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENyZWF0ZSBUb2dnbGUgSGFuZGxlCiAgICAgICAgICAgIGNvbnN0IGhhbmRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICBoYW5kbGUuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnOwogICAgICAgICAgICBoYW5kbGUuc3R5bGUubGVmdCA9ICctNDBweCc7IC8vIFByb3RydWRlIHRvIHRoZSBsZWZ0CiAgICAgICAgICAgIGhhbmRsZS5zdHlsZS50b3AgPSAnMCc7CiAgICAgICAgICAgIGhhbmRsZS5zdHlsZS53aWR0aCA9ICc0MHB4JzsKICAgICAgICAgICAgaGFuZGxlLnN0eWxlLmhlaWdodCA9ICc0MHB4JzsKICAgICAgICAgICAgaGFuZGxlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICdyZ2JhKDAsIDIwLCA0MCwgMC45KSc7CiAgICAgICAgICAgIGhhbmRsZS5zdHlsZS5ib3JkZXIgPSAnMXB4IHNvbGlkICMwMGZmZmYnOwogICAgICAgICAgICBoYW5kbGUuc3R5bGUuYm9yZGVyUmlnaHQgPSAnbm9uZSc7CiAgICAgICAgICAgIGhhbmRsZS5zdHlsZS5ib3JkZXJUb3BMZWZ0UmFkaXVzID0gJzhweCc7CiAgICAgICAgICAgIGhhbmRsZS5zdHlsZS5ib3JkZXJCb3R0b21MZWZ0UmFkaXVzID0gJzhweCc7CiAgICAgICAgICAgIGhhbmRsZS5zdHlsZS5jdXJzb3IgPSAncG9pbnRlcic7CiAgICAgICAgICAgIGhhbmRsZS5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgICAgICAgICBoYW5kbGUuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSAnY2VudGVyJzsKICAgICAgICAgICAgaGFuZGxlLnN0eWxlLmFsaWduSXRlbXMgPSAnY2VudGVyJzsKICAgICAgICAgICAgaGFuZGxlLnN0eWxlLmNvbG9yID0gJyMwMGZmZmYnOwogICAgICAgICAgICBoYW5kbGUuc3R5bGUuZm9udFNpemUgPSAnMjBweCc7CiAgICAgICAgICAgIGhhbmRsZS5pbm5lckhUTUwgPSAn4pqZJzsKICAgICAgICAgICAgaGFuZGxlLnN0eWxlLmJveFNoYWRvdyA9ICctNXB4IDAgMTBweCByZ2JhKDAsMCwwLDAuNSknOwogICAgICAgICAgICAKICAgICAgICAgICAgd3JhcHBlci5hcHBlbmRDaGlsZChoYW5kbGUpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVG9nZ2xlIExvZ2ljCiAgICAgICAgICAgIGxldCBpc09wZW4gPSBmYWxzZTsKICAgICAgICAgICAgaGFuZGxlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7IC8vIFByZXZlbnQgZ2FtZSBpbnB1dHMKICAgICAgICAgICAgICAgIGlzT3BlbiA9ICFpc09wZW47CiAgICAgICAgICAgICAgICB3cmFwcGVyLnN0eWxlLnJpZ2h0ID0gaXNPcGVuID8gJzBweCcgOiAnLTI2MHB4JzsKICAgICAgICAgICAgICAgIGhhbmRsZS5pbm5lckhUTUwgPSBpc09wZW4gPyAnwrsnIDogJ+KamSc7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAvLyBEZWZhdWx0IGdsb2JhbCB0aW1lU2NhbGUgaWYgbm90IHNldAppZiAod2luZG93LmZsdXgudGltZVNjYWxlID09PSB1bmRlZmluZWQpIHdpbmRvdy5mbHV4LnRpbWVTY2FsZSA9IDAuODsKCnRoaXMuX3NldHVwR2VuZXJhbCgpOwogICAgICAgICAgICB0aGlzLl9zZXR1cEdhbWVTdGF0ZSgpOwp0aGlzLl9zZXR1cE92ZXJsYXlzKCk7CiAgICAgICAgICAgIHRoaXMuX3NldHVwVGVhbXMoKTsKICAgICAgICAgICAgdGhpcy5fc2V0dXBQbGF5ZXJJbnNwZWN0b3IoKTsKICAgICAgICAgICAgdGhpcy5fc2V0dXBCYWxsU2FuZGJveCgpOwp0aGlzLl9zZXR1cEZYTGFiKCk7CiAgICAgICAgICAgIHRoaXMuX3NldHVwVmlzdWFscygpOwogICAgICAgIH0KCl9zZXR1cEdlbmVyYWwoKSB7CiAgICAgICAgICAgIGNvbnN0IGZvbGRlciA9IHRoaXMuZ3VpLmFkZEZvbGRlcignR2VuZXJhbCcpOwogICAgICAgICAgICAKY29uc3QgcGFyYW1zID0gewogICAgICAgICAgICAgICAgdGltZVNjYWxlOiB3aW5kb3cuZmx1eC50aW1lU2NhbGUsCiAgICAgICAgICAgICAgICBkZW1vTW9kZTogdGhpcy5nYW1lLmlzRGVtb01vZGUsCiAgICAgICAgICAgICAgICB0b2dnbGVIVUQ6IHRydWUsCiAgICAgICAgICAgICAgICByZXNvbHV0aW9uOiAwLjUwLAogICAgICAgICAgICAgICAgYXJlbmFPcGFjaXR5OiAwLjAsCiAgICAgICAgICAgICAgICBhcmVuYTJPcGFjaXR5OiAwLjA1CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBmb2xkZXIuYWRkKHBhcmFtcywgJ3RpbWVTY2FsZScsIDAuMCwgNS4wKS5uYW1lKCdHYW1lIFNwZWVkJykub25DaGFuZ2UodiA9PiB7CiAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC50aW1lU2NhbGUgPSB2OwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGZvbGRlci5hZGQocGFyYW1zLCAnZGVtb01vZGUnKS5uYW1lKCdEZW1vIE1vZGUnKS5saXN0ZW4oKS5vbkNoYW5nZSh2ID0+IHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmdhbWUuaXNEZW1vTW9kZSAhPT0gdikgewogICAgICAgICAgICAgICAgICAgIHRoaXMuZ2FtZS50b2dnbGVEZW1vTW9kZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGZvbGRlci5hZGQocGFyYW1zLCAndG9nZ2xlSFVEJykubmFtZSgnU2hvdyBIVUQnKS5vbkNoYW5nZSh2ID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGh1ZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1aS1sYXllcicpOwogICAgICAgICAgICAgICAgaWYgKGh1ZCkgewogICAgICAgICAgICAgICAgICAgIGh1ZC5zdHlsZS52aXNpYmlsaXR5ID0gdiA/ICd2aXNpYmxlJyA6ICdoaWRkZW4nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGZvbGRlci5hZGQocGFyYW1zLCAncmVzb2x1dGlvbicsIDAuMSwgMi4wKS5uYW1lKCdSZXNvbHV0aW9uIFNjYWxlJykub25DaGFuZ2UodiA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB3ID0gd2luZG93LmlubmVyV2lkdGg7CiAgICAgICAgICAgICAgICBjb25zdCBoID0gd2luZG93LmlubmVySGVpZ2h0OwogICAgICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSB0aGlzLmdhbWUucmVuZGVyZXI7CiAgICAgICAgICAgICAgICBpZiAocmVuZGVyZXIpIHsKICAgICAgICAgICAgICAgICAgICByZW5kZXJlci5zZXRTaXplKHcgKiB2LCBoICogdiwgZmFsc2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCmZvbGRlci5hZGQocGFyYW1zLCAnYXJlbmFPcGFjaXR5JywgMC4wLCAxLjApLm5hbWUoJ0FyZW5hIDEgT3BhY2l0eScpLm9uQ2hhbmdlKHYgPT4gewogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmFyZW5hTWVzaCAmJiB3aW5kb3cuZmx1eC5hcmVuYU1lc2gubWF0ZXJpYWwpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5hcmVuYU1lc2gubWF0ZXJpYWwub3BhY2l0eSA9IHY7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY29uc3QgYmxlbmRNb2RlcyA9IHsKICAgICAgICAgICAgICAgICdOb3JtYWwnOiBUSFJFRS5Ob3JtYWxCbGVuZGluZywKICAgICAgICAgICAgICAgICdBZGRpdGl2ZSc6IFRIUkVFLkFkZGl0aXZlQmxlbmRpbmcsCiAgICAgICAgICAgICAgICAnTXVsdGlwbHknOiBUSFJFRS5NdWx0aXBseUJsZW5kaW5nLAogICAgICAgICAgICAgICAgJ1N1YnRyYWN0aXZlJzogVEhSRUUuU3VidHJhY3RpdmVCbGVuZGluZywKICAgICAgICAgICAgICAgICdOb0JsZW5kaW5nJzogVEhSRUUuTm9CbGVuZGluZwogICAgICAgICAgICB9OwogICAgICAgICAgICBwYXJhbXMuYXJlbmFCbGVuZCA9ICdNdWx0aXBseSc7CgogICAgICAgICAgICBmb2xkZXIuYWRkKHBhcmFtcywgJ2FyZW5hQmxlbmQnLCBPYmplY3Qua2V5cyhibGVuZE1vZGVzKSkubmFtZSgnQXJlbmEgMSBCbGVuZCcpLm9uQ2hhbmdlKHYgPT4gewogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmFyZW5hTWVzaCAmJiB3aW5kb3cuZmx1eC5hcmVuYU1lc2gubWF0ZXJpYWwpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5hcmVuYU1lc2gubWF0ZXJpYWwuYmxlbmRpbmcgPSBibGVuZE1vZGVzW3ZdOwogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmFyZW5hTWVzaC5tYXRlcmlhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gQXJlbmEgMiBDb250cm9scwogICAgICAgICAgICBmb2xkZXIuYWRkKHBhcmFtcywgJ2FyZW5hMk9wYWNpdHknLCAwLjAsIDEuMCkubmFtZSgnQXJlbmEgMiBPcGFjaXR5Jykub25DaGFuZ2UodiA9PiB7CiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguYXJlbmFNZXNoMiAmJiB3aW5kb3cuZmx1eC5hcmVuYU1lc2gyLm1hdGVyaWFsKSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguYXJlbmFNZXNoMi5tYXRlcmlhbC5vcGFjaXR5ID0gdjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBwYXJhbXMuYXJlbmEyQmxlbmQgPSAnTm9ybWFsJzsKICAgICAgICAgICAgZm9sZGVyLmFkZChwYXJhbXMsICdhcmVuYTJCbGVuZCcsIE9iamVjdC5rZXlzKGJsZW5kTW9kZXMpKS5uYW1lKCdBcmVuYSAyIEJsZW5kJykub25DaGFuZ2UodiA9PiB7CiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguYXJlbmFNZXNoMiAmJiB3aW5kb3cuZmx1eC5hcmVuYU1lc2gyLm1hdGVyaWFsKSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguYXJlbmFNZXNoMi5tYXRlcmlhbC5ibGVuZGluZyA9IGJsZW5kTW9kZXNbdl07CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguYXJlbmFNZXNoMi5tYXRlcmlhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQXBwbHkgZGVmYXVsdHMKICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmFyZW5hTWVzaCAmJiB3aW5kb3cuZmx1eC5hcmVuYU1lc2gubWF0ZXJpYWwpIHsKICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmFyZW5hTWVzaC5tYXRlcmlhbC5vcGFjaXR5ID0gcGFyYW1zLmFyZW5hT3BhY2l0eTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAod2luZG93LmZsdXguYXJlbmFNZXNoMiAmJiB3aW5kb3cuZmx1eC5hcmVuYU1lc2gyLm1hdGVyaWFsKSB7CiAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5hcmVuYU1lc2gyLm1hdGVyaWFsLm9wYWNpdHkgPSBwYXJhbXMuYXJlbmEyT3BhY2l0eTsKICAgICAgICAgICAgfQogICAgICAgIH0KCl9zZXR1cE92ZXJsYXlzKCkgewogICAgICAgICAgICBjb25zdCBmb2xkZXIgPSB0aGlzLmd1aS5hZGRGb2xkZXIoJ092ZXJsYXlzICYgRlgnKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIDEuIEdJRiBPdmVybGF5CiAgICAgICAgICAgIGNvbnN0IGdpZkVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjcmVlbi1vdmVybGF5LWdpZicpOwogICAgICAgICAgICBpZiAoZ2lmRWwpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGdpZlBhcmFtcyA9IHsKICAgICAgICAgICAgICAgICAgICB2aXNpYmxlOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAuNzIsCiAgICAgICAgICAgICAgICAgICAgYmxlbmQ6ICdzb2Z0LWxpZ2h0JwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgZ0ZvbGRlciA9IGZvbGRlci5hZGRGb2xkZXIoJ1NjcmVlbiBHSUYnKTsKICAgICAgICAgICAgICAgIGdGb2xkZXIuYWRkKGdpZlBhcmFtcywgJ3Zpc2libGUnKS5vbkNoYW5nZSh2ID0+IGdpZkVsLnN0eWxlLmRpc3BsYXkgPSB2ID8gJ2Jsb2NrJyA6ICdub25lJyk7CiAgICAgICAgICAgICAgICBnRm9sZGVyLmFkZChnaWZQYXJhbXMsICdvcGFjaXR5JywgMC4wLCAxLjApLm9uQ2hhbmdlKHYgPT4gZ2lmRWwuc3R5bGUub3BhY2l0eSA9IHYpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBibGVuZE1vZGVzID0gWwogICAgICAgICAgICAgICAgICAgICdub3JtYWwnLCAnbXVsdGlwbHknLCAnc2NyZWVuJywgJ292ZXJsYXknLCAKICAgICAgICAgICAgICAgICAgICAnZGFya2VuJywgJ2xpZ2h0ZW4nLCAnY29sb3ItZG9kZ2UnLCAnY29sb3ItYnVybicsIAogICAgICAgICAgICAgICAgICAgICdoYXJkLWxpZ2h0JywgJ3NvZnQtbGlnaHQnLCAnZGlmZmVyZW5jZScsICdleGNsdXNpb24nLCAKICAgICAgICAgICAgICAgICAgICAnaHVlJywgJ3NhdHVyYXRpb24nLCAnY29sb3InLCAnbHVtaW5vc2l0eScKICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICBnRm9sZGVyLmFkZChnaWZQYXJhbXMsICdibGVuZCcsIGJsZW5kTW9kZXMpLm9uQ2hhbmdlKHYgPT4gZ2lmRWwuc3R5bGUubWl4QmxlbmRNb2RlID0gdik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDIuIFdhdGVyIE92ZXJsYXkKICAgICAgICAgICAgY29uc3Qgd28gPSB0aGlzLmdhbWUud2F0ZXJPdmVybGF5OwogICAgICAgICAgICBpZiAod28gJiYgd28ubWVzaCkgewogICAgICAgICAgICAgICAgY29uc3Qgd0ZvbGRlciA9IGZvbGRlci5hZGRGb2xkZXIoJ1dhdGVyIFNoYWRlcicpOwogICAgICAgICAgICAgICAgY29uc3Qgd1BhcmFtcyA9IHsgCiAgICAgICAgICAgICAgICAgICAgdmlzaWJsZTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiB3by5tYXRlcmlhbC51bmlmb3Jtcy51T3BhY2l0eSA/IHdvLm1hdGVyaWFsLnVuaWZvcm1zLnVPcGFjaXR5LnZhbHVlIDogMC41LAogICAgICAgICAgICAgICAgICAgIGJsZW5kOiAnQWRkaXRpdmUnCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB3Rm9sZGVyLmFkZCh3UGFyYW1zLCAndmlzaWJsZScpLm9uQ2hhbmdlKHYgPT4gd28ubWVzaC52aXNpYmxlID0gdik7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmICh3by5tYXRlcmlhbC51bmlmb3Jtcy51T3BhY2l0eSkgewogICAgICAgICAgICAgICAgICAgIHdGb2xkZXIuYWRkKHdQYXJhbXMsICdvcGFjaXR5JywgMC4wLCAyLjApLm9uQ2hhbmdlKHYgPT4gd28ubWF0ZXJpYWwudW5pZm9ybXMudU9wYWNpdHkudmFsdWUgPSB2KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCB0aHJlZUJsZW5kcyA9IHsKICAgICAgICAgICAgICAgICAgICAnTm9ybWFsJzogVEhSRUUuTm9ybWFsQmxlbmRpbmcsCiAgICAgICAgICAgICAgICAgICAgJ0FkZGl0aXZlJzogVEhSRUUuQWRkaXRpdmVCbGVuZGluZywKICAgICAgICAgICAgICAgICAgICAnU3VidHJhY3RpdmUnOiBUSFJFRS5TdWJ0cmFjdGl2ZUJsZW5kaW5nLAogICAgICAgICAgICAgICAgICAgICdNdWx0aXBseSc6IFRIUkVFLk11bHRpcGx5QmxlbmRpbmcsCiAgICAgICAgICAgICAgICAgICAgJ05vQmxlbmRpbmcnOiBUSFJFRS5Ob0JsZW5kaW5nCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB3Rm9sZGVyLmFkZCh3UGFyYW1zLCAnYmxlbmQnLCBPYmplY3Qua2V5cyh0aHJlZUJsZW5kcykpLm9uQ2hhbmdlKHYgPT4gewogICAgICAgICAgICAgICAgICAgIHdvLm1hdGVyaWFsLmJsZW5kaW5nID0gdGhyZWVCbGVuZHNbdl07CiAgICAgICAgICAgICAgICAgICAgd28ubWF0ZXJpYWwubmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDMuIExpZ2h0IFNoYWZ0cwogICAgICAgICAgICBjb25zdCBscyA9IHRoaXMuZ2FtZS5saWdodFNoYWZ0czsKICAgICAgICAgICAgaWYgKGxzICYmIGxzLmNvbnRhaW5lcikgewogICAgICAgICAgICAgICAgY29uc3QgbFBhcmFtcyA9IHsgdmlzaWJsZTogdHJ1ZSB9OwogICAgICAgICAgICAgICAgZm9sZGVyLmFkZChsUGFyYW1zLCAndmlzaWJsZScpLm5hbWUoJ0xpZ2h0IFNoYWZ0cycpLm9uQ2hhbmdlKHYgPT4gbHMuY29udGFpbmVyLnZpc2libGUgPSB2KTsKICAgICAgICAgICAgfQogICAgICAgIH0KCl9zZXR1cEdhbWVTdGF0ZSgpIHsKICAgICAgICAgICAgY29uc3QgZm9sZGVyID0gdGhpcy5ndWkuYWRkRm9sZGVyKCdHYW1lIFN0YXRlJyk7CiAgICAgICAgICAgIGNvbnN0IGdtID0gdGhpcy5nYW1lOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgcGFyYW1zID0gewogICAgICAgICAgICAgICAgZm9yY2VIb21lR29hbDogKCkgPT4geyAKICAgICAgICAgICAgICAgICAgICBpZihnbS5zdGF0ZSA9PT0gJ2FjdGl2ZScpIGdtLmdvYWxTY29yZWQoJ2hvbWUnKTsgCiAgICAgICAgICAgICAgICAgICAgZWxzZSBjb25zb2xlLndhcm4oIkdhbWUgbXVzdCBiZSBhY3RpdmUgdG8gdHJpZ2dlciBnb2FsIik7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZm9yY2VBd2F5R29hbDogKCkgPT4geyAKICAgICAgICAgICAgICAgICAgICBpZihnbS5zdGF0ZSA9PT0gJ2FjdGl2ZScpIGdtLmdvYWxTY29yZWQoJ2F3YXknKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGNvbnNvbGUud2FybigiR2FtZSBtdXN0IGJlIGFjdGl2ZSB0byB0cmlnZ2VyIGdvYWwiKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBmb3JjZUhhbGZ0aW1lOiAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYoZ20uc3RhdGUgPT09ICdhY3RpdmUnKSBnbS5lbmRIYWxmKCk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVzZXRSb3VuZDogKCkgPT4gZ20ucmVzZXRSb3VuZCgpLAogICAgICAgICAgICAgICAgZXhpdFRvTWVudTogKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UgJiYgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLm1lbnVNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5tZW51TWFuYWdlci5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5zdGF0ZSA9ICdtZW51JzsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3RvcCBwcmFjdGljZSBpZiBydW5uaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UucHJhY3RpY2VNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UucHJhY3RpY2VNYW5hZ2VyLnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGZvbGRlci5hZGQocGFyYW1zLCAnZm9yY2VIb21lR29hbCcpLm5hbWUoJ1RyaWdnZXIgSG9tZSBHb2FsJyk7CiAgICAgICAgICAgIGZvbGRlci5hZGQocGFyYW1zLCAnZm9yY2VBd2F5R29hbCcpLm5hbWUoJ1RyaWdnZXIgQXdheSBHb2FsJyk7CiAgICAgICAgICAgIGZvbGRlci5hZGQocGFyYW1zLCAnZm9yY2VIYWxmdGltZScpLm5hbWUoJ0ZvcmNlIEhhbGZ0aW1lJyk7CiAgICAgICAgICAgIGZvbGRlci5hZGQocGFyYW1zLCAncmVzZXRSb3VuZCcpLm5hbWUoJ1Jlc2V0IFJvdW5kJyk7CiAgICAgICAgICAgIGZvbGRlci5hZGQocGFyYW1zLCAnZXhpdFRvTWVudScpLm5hbWUoJ0V4aXQgdG8gTWVudScpOwogICAgICAgIH0KCiAgICAgICAgX3NldHVwVGVhbXMoKSB7CiAgICAgICAgICAgIGNvbnN0IGZvbGRlciA9IHRoaXMuZ3VpLmFkZEZvbGRlcignVGVhbXMnKTsKICAgICAgICAgICAgaWYgKCF0aGlzLmdhbWUudGVhbXMuaG9tZSB8fCAhdGhpcy5nYW1lLnRlYW1zLmF3YXkpIHJldHVybjsKCiAgICAgICAgICAgIGNvbnN0IGhvbWUgPSB0aGlzLmdhbWUudGVhbXMuaG9tZTsKICAgICAgICAgICAgY29uc3QgYXdheSA9IHRoaXMuZ2FtZS50ZWFtcy5hd2F5OwoKICAgICAgICAgICAgLy8gSG9tZQogICAgICAgICAgICBjb25zdCBoRm9sZGVyID0gZm9sZGVyLmFkZEZvbGRlcignSG9tZSBUZWFtJyk7CiAgICAgICAgICAgIGhGb2xkZXIuYWRkKGhvbWUsICdpc0h1bWFuJykubmFtZSgnSXMgSHVtYW4gQ29udHJvbGxlZCcpLmxpc3RlbigpOwogICAgICAgICAgICBoRm9sZGVyLmFkZChob21lLCAnYWlFbmFibGVkJykubmFtZSgnQUkgTG9naWMgRW5hYmxlZCcpLmxpc3RlbigpOwoKICAgICAgICAgICAgLy8gQXdheQogICAgICAgICAgICBjb25zdCBhRm9sZGVyID0gZm9sZGVyLmFkZEZvbGRlcignQXdheSBUZWFtJyk7CiAgICAgICAgICAgIGFGb2xkZXIuYWRkKGF3YXksICdpc0h1bWFuJykubmFtZSgnSXMgSHVtYW4gQ29udHJvbGxlZCcpLmxpc3RlbigpOwogICAgICAgICAgICBhRm9sZGVyLmFkZChhd2F5LCAnYWlFbmFibGVkJykubmFtZSgnQUkgTG9naWMgRW5hYmxlZCcpLmxpc3RlbigpOwoKICAgICAgICB9Cgpfc2V0dXBQbGF5ZXJJbnNwZWN0b3IoKSB7CiAgICAgICAgICAgIGNvbnN0IGZvbGRlciA9IHRoaXMuZ3VpLmFkZEZvbGRlcignUGxheWVyIEluc3BlY3RvciAoSG9tZSBBY3RpdmUpJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBIZWxwZXIgdG8gZ2V0IGN1cnJlbnQgYWN0aXZlIHBsYXllciBzYWZlbHkKICAgICAgICAgICAgY29uc3QgZ2V0QWN0aXZlID0gKCkgPT4gewogICAgICAgICAgICAgICAgcmV0dXJuICh0aGlzLmdhbWUudGVhbXMuaG9tZSAmJiB0aGlzLmdhbWUudGVhbXMuaG9tZS5hY3RpdmVQbGF5ZXIpIAogICAgICAgICAgICAgICAgICAgID8gdGhpcy5nYW1lLnRlYW1zLmhvbWUuYWN0aXZlUGxheWVyIAogICAgICAgICAgICAgICAgICAgIDogbnVsbDsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8vIFByb3h5IG9iamVjdCB0byBiaW5kIEdVSSB0byBkeW5hbWljIHRhcmdldAogICAgICAgICAgICBjb25zdCBwcm94eSA9IHsKICAgICAgICAgICAgICAgIGdldCBSb2xlKCkgeyAKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gZ2V0QWN0aXZlKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHAgPyBwLnJvbGUgOiAnLSc7IAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZ2V0IEdvZE1vZGUoKSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcCA/IHAuaXNHb2RNb2RlIDogZmFsc2U7IAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNldCBHb2RNb2RlKHYpIHsgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IGdldEFjdGl2ZSgpOwogICAgICAgICAgICAgICAgICAgIGlmKHApIHAuaXNHb2RNb2RlID0gdjsgCiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIC8vIFJ1bnRpbWUgVmFsdWVzCiAgICAgICAgICAgICAgICBnZXQgSFAoKSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcCA/IHAuc3RhdHMuSFAgOiAwOyAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZXQgSFAodikgeyAKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gZ2V0QWN0aXZlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYocCkgcC5zdGF0cy5IUCA9IHY7IAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZ2V0IEN1cnJlbnRFTigpIHsgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IGdldEFjdGl2ZSgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBwID8gcC5jdXJyZW50RU4gOiAwOyAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZXQgQ3VycmVudEVOKHYpIHsgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IGdldEFjdGl2ZSgpOwogICAgICAgICAgICAgICAgICAgIGlmKHApIHAuY3VycmVudEVOID0gdjsgCiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIC8vIEJhc2UgU3RhdHMKICAgICAgICAgICAgICAgIGdldCBNYXhIUCgpIHsgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IGdldEFjdGl2ZSgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBwID8gcC5zdGF0cy5tYXhIUCA6IDA7IAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNldCBNYXhIUCh2KSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICBpZihwKSBwLnN0YXRzLm1heEhQID0gdjsgCiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIGdldCBTUCgpIHsgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IGdldEFjdGl2ZSgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBwID8gcC5zdGF0cy5TUCA6IDA7IAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNldCBTUCh2KSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICBpZihwKSB7IAogICAgICAgICAgICAgICAgICAgICAgICBwLnN0YXRzLlNQID0gdjsgCiAgICAgICAgICAgICAgICAgICAgICAgIHAuX3VwZGF0ZURlcml2ZWRTdGF0cygpOyAKICAgICAgICAgICAgICAgICAgICB9IAogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICBnZXQgRU4oKSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcCA/IHAuc3RhdHMuRU4gOiAwOyAKICAgICAgICAgICAgICAgIH0sIAogICAgICAgICAgICAgICAgc2V0IEVOKHYpIHsgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IGdldEFjdGl2ZSgpOwogICAgICAgICAgICAgICAgICAgIGlmKHApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcC5zdGF0cy5FTiA9IHY7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICBnZXQgQVQoKSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcCA/IHAuc3RhdHMuQVQgOiAwOyAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZXQgQVQodikgeyAKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gZ2V0QWN0aXZlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYocCkgcC5zdGF0cy5BVCA9IHY7IAogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICBnZXQgUEEoKSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcCA/IHAuc3RhdHMuUEEgOiAwOyAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZXQgUEEodikgeyAKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gZ2V0QWN0aXZlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYocCkgcC5zdGF0cy5QQSA9IHY7IAogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICBnZXQgQkwoKSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcCA/IHAuc3RhdHMuQkwgOiAwOyAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZXQgQkwodikgeyAKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gZ2V0QWN0aXZlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYocCkgcC5zdGF0cy5CTCA9IHY7IAogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICBnZXQgU0goKSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcCA/IHAuc3RhdHMuU0ggOiAwOyAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZXQgU0godikgeyAKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gZ2V0QWN0aXZlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYocCkgcC5zdGF0cy5TSCA9IHY7IAogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICBnZXQgQ0EoKSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcCA/IHAuc3RhdHMuQ0EgOiAwOyAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZXQgQ0EodikgeyAKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gZ2V0QWN0aXZlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYocCkgcC5zdGF0cy5DQSA9IHY7IAogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAvLyBBY3Rpb25zCiAgICAgICAgICAgICAgICBMZXZlbFVwOiAoKSA9PiB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICBpZihwKSBwLmxldmVsVXAoKTsgCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgRnVsbEhlYWw6ICgpID0+IHsgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IGdldEFjdGl2ZSgpOyAKICAgICAgICAgICAgICAgICAgICBpZihwKSB7IAogICAgICAgICAgICAgICAgICAgICAgICBwLnN0YXRzLkhQID0gcC5zdGF0cy5tYXhIUDsgCiAgICAgICAgICAgICAgICAgICAgICAgIHAuY3VycmVudEVOID0gcC5nZXRTdGF0KCdFTicpOyAKICAgICAgICAgICAgICAgICAgICAgICAgcC5zdGF0dXMudmVub20gPSAwOyAKICAgICAgICAgICAgICAgICAgICAgICAgcC5zdGF0dXMubmFwID0gMDsgCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcihsZXQgayBpbiBwLnN0YXR1cy53aXRoZXIpIHAuc3RhdHVzLndpdGhlcltrXSA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIkZVTEwgSEVBTCIsIHAubWVzaC5wb3NpdGlvbiwgImhlYWwiKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgRHJhaW5FTjogKCkgPT4geyAKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gZ2V0QWN0aXZlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYocCkgewogICAgICAgICAgICAgICAgICAgICAgICBwLmN1cnJlbnRFTiA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIHAuZnVtYmxlKCk7IC8vIFRyaWdnZXIgZnVtYmxlIGxvZ2ljCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgZm9sZGVyLmFkZChwcm94eSwgJ1JvbGUnKS5saXN0ZW4oKS5kaXNhYmxlKCk7CiAgICAgICAgICAgIGZvbGRlci5hZGQocHJveHksICdHb2RNb2RlJykubmFtZSgnR29kIE1vZGUgKEluZiBIUC9FTiknKS5saXN0ZW4oKTsKCiAgICAgICAgICAgIGNvbnN0IHJ0Rm9sZGVyID0gZm9sZGVyLmFkZEZvbGRlcignUnVudGltZSBTdGF0dXMnKTsKICAgICAgICAgICAgcnRGb2xkZXIuYWRkKHByb3h5LCAnSFAnLCAwLCA5OTk5KS5saXN0ZW4oKTsKICAgICAgICAgICAgcnRGb2xkZXIuYWRkKHByb3h5LCAnQ3VycmVudEVOJywgMCwgMTAwKS5uYW1lKCdDdXJyZW50IEVOJykubGlzdGVuKCk7CgogICAgICAgICAgICBjb25zdCBzdGF0Rm9sZGVyID0gZm9sZGVyLmFkZEZvbGRlcignQmFzZSBTdGF0cycpOwogICAgICAgICAgICBzdGF0Rm9sZGVyLmFkZChwcm94eSwgJ01heEhQJywgMTAwLCA5OTk5KS5saXN0ZW4oKTsKICAgICAgICAgICAgc3RhdEZvbGRlci5hZGQocHJveHksICdFTicsIDAsIDk5KS5uYW1lKCdNYXggRU4nKS5saXN0ZW4oKTsKICAgICAgICAgICAgc3RhdEZvbGRlci5hZGQocHJveHksICdTUCcsIDAsIDk5KS5saXN0ZW4oKTsKICAgICAgICAgICAgc3RhdEZvbGRlci5hZGQocHJveHksICdBVCcsIDAsIDk5KS5saXN0ZW4oKTsKICAgICAgICAgICAgc3RhdEZvbGRlci5hZGQocHJveHksICdQQScsIDAsIDk5KS5saXN0ZW4oKTsKICAgICAgICAgICAgc3RhdEZvbGRlci5hZGQocHJveHksICdCTCcsIDAsIDk5KS5saXN0ZW4oKTsKICAgICAgICAgICAgc3RhdEZvbGRlci5hZGQocHJveHksICdTSCcsIDAsIDk5KS5saXN0ZW4oKTsKICAgICAgICAgICAgc3RhdEZvbGRlci5hZGQocHJveHksICdDQScsIDAsIDk5KS5saXN0ZW4oKTsKCiAgICAgICAgICAgIGNvbnN0IGFjdGlvbkZvbGRlciA9IGZvbGRlci5hZGRGb2xkZXIoJ0FjdGlvbnMnKTsKICAgICAgICAgICAgYWN0aW9uRm9sZGVyLmFkZChwcm94eSwgJ0xldmVsVXAnKS5uYW1lKCdJbnN0YW50IExldmVsIFVwJyk7CiAgICAgICAgICAgIGFjdGlvbkZvbGRlci5hZGQocHJveHksICdGdWxsSGVhbCcpLm5hbWUoJ0Z1bGwgSGVhbCAmIEN1cmUnKTsKICAgICAgICAgICAgYWN0aW9uRm9sZGVyLmFkZChwcm94eSwgJ0RyYWluRU4nKS5uYW1lKCdEcmFpbiBFTiAoRnVtYmxlKScpOwogICAgICAgIH0KCiAgICAgICAgX3NldHVwQmFsbFNhbmRib3goKSB7CiAgICAgICAgICAgIGNvbnN0IGZvbGRlciA9IHRoaXMuZ3VpLmFkZEZvbGRlcignQmFsbCAmIFBoeXNpY3MgU2FuZGJveCcpOwogICAgICAgICAgICBjb25zdCBDID0gd2luZG93LmZsdXguQmFsbENvbmZpZzsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICghQykgewogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJCYWxsQ29uZmlnIG5vdCBmb3VuZC4gU2tpcHBpbmcgUGh5c2ljcyBTYW5kYm94LiIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAxLiBQaHlzaWNzIENvbnN0YW50cwogICAgICAgICAgICBjb25zdCBwaHlzRm9sZGVyID0gZm9sZGVyLmFkZEZvbGRlcignUGh5c2ljcyBDb25zdGFudHMnKTsKICAgICAgICAgICAgcGh5c0ZvbGRlci5hZGQoQywgJ1dBVEVSX0RSQUcnLCAwLjAsIDUuMCkubmFtZSgnV2F0ZXIgRHJhZycpOwogICAgICAgICAgICBwaHlzRm9sZGVyLmFkZChDLCAnU1BJTl9EUkFHJywgMC4wLCA1LjApLm5hbWUoJ1NwaW4gRGVjYXknKTsKICAgICAgICAgICAgcGh5c0ZvbGRlci5hZGQoQywgJ01BR05VU19DT0VGRicsIDAuMCwgNS4wKS5uYW1lKCdNYWdudXMgRWZmZWN0Jyk7CiAgICAgICAgICAgIHBoeXNGb2xkZXIuYWRkKEMsICdHUkFWSVRZX1NQUklORycsIDAuMCwgMjAuMCkubmFtZSgnVmVydCBTcHJpbmcnKTsKICAgICAgICAgICAgcGh5c0ZvbGRlci5hZGQoQywgJ0dSQVZJVFlfREFNUCcsIDAuMCwgMTAuMCkubmFtZSgnVmVydCBEYW1wJyk7CiAgICAgICAgICAgIHBoeXNGb2xkZXIuYWRkKEMsICdCT1VOREFSWV9SQURJVVMnLCAxMC4wLCAxMDAuMCkubmFtZSgnQXJlbmEgU2l6ZScpOwoKICAgICAgICAgICAgLy8gMi4gVGVsZXBvcnQgVG9vbHMKICAgICAgICAgICAgY29uc3QgdHBGb2xkZXIgPSBmb2xkZXIuYWRkRm9sZGVyKCdUZWxlcG9ydCBCYWxsJyk7CiAgICAgICAgICAgIGNvbnN0IHRwUGFyYW1zID0gewogICAgICAgICAgICAgICAgVG9DZW50ZXI6ICgpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBiID0gdGhpcy5nYW1lLmVudGl0aWVzLmJhbGw7CiAgICAgICAgICAgICAgICAgICAgaWYoYikgYi5yZXNldCgpOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIFRvQWN0aXZlUGxheWVyOiAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYiA9IHRoaXMuZ2FtZS5lbnRpdGllcy5iYWxsOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSB0aGlzLmdhbWUudGVhbXMuaG9tZS5hY3RpdmVQbGF5ZXI7CiAgICAgICAgICAgICAgICAgICAgaWYoYiAmJiBwKSBiLmdyYWIocCk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgVG9Ib21lR29hbDogKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLmdhbWUuZW50aXRpZXMuYmFsbDsKICAgICAgICAgICAgICAgICAgICBpZihiKSB7IGIuZHJvcCgpOyBiLm1lc2gucG9zaXRpb24uc2V0KDAsIDAsIDI1KTsgYi52ZWxvY2l0eS5zZXQoMCwwLDApOyB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgVG9Bd2F5R29hbDogKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLmdhbWUuZW50aXRpZXMuYmFsbDsKICAgICAgICAgICAgICAgICAgICBpZihiKSB7IGIuZHJvcCgpOyBiLm1lc2gucG9zaXRpb24uc2V0KDAsIDAsIC0yNSk7IGIudmVsb2NpdHkuc2V0KDAsMCwwKTsgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIFRvU2t5OiAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYiA9IHRoaXMuZ2FtZS5lbnRpdGllcy5iYWxsOwogICAgICAgICAgICAgICAgICAgIGlmKGIpIHsgYi5kcm9wKCk7IGIubWVzaC5wb3NpdGlvbi5zZXQoMCwgMTAsIDApOyBiLnZlbG9jaXR5LnNldCgwLDAsMCk7IH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgdHBGb2xkZXIuYWRkKHRwUGFyYW1zLCAnVG9DZW50ZXInKTsKICAgICAgICAgICAgdHBGb2xkZXIuYWRkKHRwUGFyYW1zLCAnVG9BY3RpdmVQbGF5ZXInKTsKICAgICAgICAgICAgdHBGb2xkZXIuYWRkKHRwUGFyYW1zLCAnVG9Ib21lR29hbCcpOwogICAgICAgICAgICB0cEZvbGRlci5hZGQodHBQYXJhbXMsICdUb0F3YXlHb2FsJyk7CiAgICAgICAgICAgIHRwRm9sZGVyLmFkZCh0cFBhcmFtcywgJ1RvU2t5Jyk7CgogICAgICAgICAgICAvLyAzLiBGb3JjZSBTaG9vdAogICAgICAgICAgICBjb25zdCBzaG9vdEZvbGRlciA9IGZvbGRlci5hZGRGb2xkZXIoJ0ZvcmNlIFNob290Jyk7CiAgICAgICAgICAgIGNvbnN0IHNob290UGFyYW1zID0gewogICAgICAgICAgICAgICAgUG93ZXI6IDIwLAogICAgICAgICAgICAgICAgQ3VydmU6IDAsCiAgICAgICAgICAgICAgICBTaG9vdEZvcndhcmQ6ICgpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBiID0gdGhpcy5nYW1lLmVudGl0aWVzLmJhbGw7CiAgICAgICAgICAgICAgICAgICAgaWYoYikgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBTaG9vdCB0b3dhcmRzIC1aIChIb21lIEF0dGFjayBEaXJlY3Rpb24pCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpciA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIC0xKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3BpbiA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIHNob290UGFyYW1zLkN1cnZlLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgYi5zaG9vdChkaXIsIHNob290UGFyYW1zLlBvd2VyLCAnU0gnLCBudWxsLCBzcGluKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgU2hvb3RCYWNrd2FyZDogKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLmdhbWUuZW50aXRpZXMuYmFsbDsKICAgICAgICAgICAgICAgICAgICBpZihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpciA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIDEpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzcGluID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgc2hvb3RQYXJhbXMuQ3VydmUsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBiLnNob290KGRpciwgc2hvb3RQYXJhbXMuUG93ZXIsICdTSCcsIG51bGwsIHNwaW4pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBTaG9vdFVwOiAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYiA9IHRoaXMuZ2FtZS5lbnRpdGllcy5iYWxsOwogICAgICAgICAgICAgICAgICAgIGlmKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlyID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMSwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGIuc2hvb3QoZGlyLCBzaG9vdFBhcmFtcy5Qb3dlciwgJ1BBJyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIFJhbmRvbUN1cnZlOiAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYiA9IHRoaXMuZ2FtZS5lbnRpdGllcy5iYWxsOwogICAgICAgICAgICAgICAgICAgIGlmKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlyID0gbmV3IFRIUkVFLlZlY3RvcjMoTWF0aC5yYW5kb20oKS0wLjUsIDAsIE1hdGgucmFuZG9tKCktMC41KS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3BpbiA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIChNYXRoLnJhbmRvbSgpLTAuNSkqMjAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBiLnNob290KGRpciwgc2hvb3RQYXJhbXMuUG93ZXIsICdTSCcsIG51bGwsIHNwaW4pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgc2hvb3RGb2xkZXIuYWRkKHNob290UGFyYW1zLCAnUG93ZXInLCA1LCA1MCk7CiAgICAgICAgICAgIHNob290Rm9sZGVyLmFkZChzaG9vdFBhcmFtcywgJ0N1cnZlJywgLTIwLCAyMCkubmFtZSgnU3BpbiBZJyk7CiAgICAgICAgICAgIHNob290Rm9sZGVyLmFkZChzaG9vdFBhcmFtcywgJ1Nob290Rm9yd2FyZCcpOwogICAgICAgICAgICBzaG9vdEZvbGRlci5hZGQoc2hvb3RQYXJhbXMsICdTaG9vdEJhY2t3YXJkJyk7CiAgICAgICAgICAgIHNob290Rm9sZGVyLmFkZChzaG9vdFBhcmFtcywgJ1Nob290VXAnKTsKICAgICAgICAgICAgc2hvb3RGb2xkZXIuYWRkKHNob290UGFyYW1zLCAnUmFuZG9tQ3VydmUnKTsKICAgICAgICB9CiAgICB9Cgp3aW5kb3cuZmx1eC5EZXZUb29scyA9IERldlRvb2xzOwoKICAgIERldlRvb2xzLnByb3RvdHlwZS5fc2V0dXBWaXN1YWxEZWJ1ZyA9IGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnN0IGZvbGRlciA9IHRoaXMuZ3VpLmFkZEZvbGRlcignVmlzdWFsIERlYnVnZ2luZycpOwogICAgICAgIGNvbnN0IGR2ID0gdGhpcy5nYW1lLmRlYnVnVmlzdWFsaXplcjsKICAgICAgICBpZiAoIWR2KSByZXR1cm47CgogICAgICAgIGNvbnN0IHBhcmFtcyA9IHsKICAgICAgICAgICAgZW5hYmxlZDogZHYuZW5hYmxlZCwKICAgICAgICAgICAgaGl0Ym94ZXM6IGR2LnNob3dIaXRib3hlcywKICAgICAgICAgICAgdmVjdG9yczogZHYuc2hvd1ZlY3RvcnMsCiAgICAgICAgICAgIGFpOiBkdi5zaG93QUkKICAgICAgICB9OwoKICAgICAgICBmb2xkZXIuYWRkKHBhcmFtcywgJ2VuYWJsZWQnKS5uYW1lKCdFbmFibGUgVmlzdWFsaXplcicpLm9uQ2hhbmdlKHYgPT4gZHYuZW5hYmxlZCA9IHYpOwogICAgICAgIGZvbGRlci5hZGQocGFyYW1zLCAnaGl0Ym94ZXMnKS5uYW1lKCdTaG93IEhpdGJveGVzJykub25DaGFuZ2UodiA9PiBkdi5zaG93SGl0Ym94ZXMgPSB2KTsKICAgICAgICBmb2xkZXIuYWRkKHBhcmFtcywgJ3ZlY3RvcnMnKS5uYW1lKCdTaG93IFZlY3RvcnMnKS5vbkNoYW5nZSh2ID0+IGR2LnNob3dWZWN0b3JzID0gdik7CiAgICAgICAgZm9sZGVyLmFkZChwYXJhbXMsICdhaScpLm5hbWUoJ1Nob3cgQUkgUGVyY2VwdGlvbicpLm9uQ2hhbmdlKHYgPT4gZHYuc2hvd0FJID0gdik7CiAgICB9OwoKICAgIERldlRvb2xzLnByb3RvdHlwZS5fc2V0dXBGWExhYiA9IGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnN0IGZvbGRlciA9IHRoaXMuZ3VpLmFkZEZvbGRlcignRlggTGFiICYgVUkgVGVzdCcpOwogICAgICAgIAogICAgICAgIGNvbnN0IGdldFRhcmdldFBvcyA9ICgpID0+IHsKICAgICAgICAgICAgY29uc3QgcCA9IHRoaXMuZ2FtZS50ZWFtcy5ob21lLmFjdGl2ZVBsYXllcjsKICAgICAgICAgICAgcmV0dXJuIHAgJiYgcC5tZXNoID8gcC5tZXNoLnBvc2l0aW9uIDogbmV3IFRIUkVFLlZlY3RvcjMoMCwgMiwgMCk7CiAgICAgICAgfTsKCiAgICAgICAgY29uc3QgZnhQYXJhbXMgPSB7CiAgICAgICAgICAgIFNwYXduVmVub206ICgpID0+IHRoaXMuZ2FtZS5wYXJ0aWNsZU1hbmFnZXIuc3Bhd24oJ3Zlbm9tJywgZ2V0VGFyZ2V0UG9zKCkpLAogICAgICAgICAgICBTcGF3bk5hcDogKCkgPT4gdGhpcy5nYW1lLnBhcnRpY2xlTWFuYWdlci5zcGF3bignbmFwJywgZ2V0VGFyZ2V0UG9zKCkpLAogICAgICAgICAgICBTcGF3bldpdGhlcjogKCkgPT4gdGhpcy5nYW1lLnBhcnRpY2xlTWFuYWdlci5zcGF3bignd2l0aGVyJywgZ2V0VGFyZ2V0UG9zKCkpLAogICAgICAgICAgICBTcGF3bkxlYXJuZWQ6ICgpID0+IHRoaXMuZ2FtZS5wYXJ0aWNsZU1hbmFnZXIuc3Bhd24oJ2xlYXJuZWQnLCBnZXRUYXJnZXRQb3MoKSksCiAgICAgICAgICAgIFNwYXduQ2xhc2g6ICgpID0+IHRoaXMuZ2FtZS5zcGF3bkNsYXNoKGdldFRhcmdldFBvcygpKSwKICAgICAgICB9OwoKICAgICAgICBjb25zdCBmeFN1YiA9IGZvbGRlci5hZGRGb2xkZXIoJ1BhcnRpY2xlcycpOwogICAgICAgIGZ4U3ViLmFkZChmeFBhcmFtcywgJ1NwYXduVmVub20nKTsKICAgICAgICBmeFN1Yi5hZGQoZnhQYXJhbXMsICdTcGF3bk5hcCcpOwogICAgICAgIGZ4U3ViLmFkZChmeFBhcmFtcywgJ1NwYXduV2l0aGVyJyk7CiAgICAgICAgZnhTdWIuYWRkKGZ4UGFyYW1zLCAnU3Bhd25MZWFybmVkJyk7CiAgICAgICAgZnhTdWIuYWRkKGZ4UGFyYW1zLCAnU3Bhd25DbGFzaCcpOwoKICAgICAgICBjb25zdCB0eHRQYXJhbXMgPSB7CiAgICAgICAgICAgIFRleHQ6ICJURVNUIiwKICAgICAgICAgICAgVHlwZTogImRhbWFnZSIsCiAgICAgICAgICAgIFNwYXduOiAoKSA9PiB7CiAgICAgICAgICAgICAgICBpZih0aGlzLmdhbWUuZmxvYXRpbmdUZXh0KSAKICAgICAgICAgICAgICAgICAgICB0aGlzLmdhbWUuZmxvYXRpbmdUZXh0LnNwYXduKHR4dFBhcmFtcy5UZXh0LCBnZXRUYXJnZXRQb3MoKSwgdHh0UGFyYW1zLlR5cGUpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICBjb25zdCB0eHRTdWIgPSBmb2xkZXIuYWRkRm9sZGVyKCdGbG9hdGluZyBUZXh0Jyk7CiAgICAgICAgdHh0U3ViLmFkZCh0eHRQYXJhbXMsICdUZXh0Jyk7CiAgICAgICAgdHh0U3ViLmFkZCh0eHRQYXJhbXMsICdUeXBlJywgWydkYW1hZ2UnLCAnaGVhbCcsICdzdGF0dXMnLCAndGVjaCcsICdjb21pYy1pbXBhY3QnLCAnY29taWMtYWN0aW9uJywgJ3NhdmUnLCAnYmxvY2snLCAnZGVmYXVsdCddKTsKICAgICAgICB0eHRTdWIuYWRkKHR4dFBhcmFtcywgJ1NwYXduJykubmFtZSgnU3Bhd24gVGV4dCcpOwoKICAgICAgICBjb25zdCBjYW1QYXJhbXMgPSB7CiAgICAgICAgICAgIFNoYWtlU21hbGw6ICgpID0+IHRoaXMuZ2FtZS5jYW1lcmFNYW5hZ2VyLmFkZFNoYWtlKDAuNSksCiAgICAgICAgICAgIFNoYWtlQmlnOiAoKSA9PiB0aGlzLmdhbWUuY2FtZXJhTWFuYWdlci5hZGRTaGFrZSgyLjApLAogICAgICAgICAgICBJbXBhY3RMaWdodDogKCkgPT4gdGhpcy5nYW1lLnRyaWdnZXJJbXBhY3QoMC4xLCAnZGVmYXVsdCcpLAogICAgICAgICAgICBJbXBhY3RIZWF2eTogKCkgPT4gdGhpcy5nYW1lLnRyaWdnZXJJbXBhY3QoMC4yLCAnaGVhdnknKSwKICAgICAgICAgICAgSW1wYWN0U2hhdHRlcjogKCkgPT4gdGhpcy5nYW1lLnRyaWdnZXJJbXBhY3QoMC40LCAnc2hhdHRlcicpLAogICAgICAgIH07CgogICAgICAgIGNvbnN0IGNhbVN1YiA9IGZvbGRlci5hZGRGb2xkZXIoJ0NhbWVyYSAmIEltcGFjdCcpOwogICAgICAgIGNhbVN1Yi5hZGQoY2FtUGFyYW1zLCAnU2hha2VTbWFsbCcpOwogICAgICAgIGNhbVN1Yi5hZGQoY2FtUGFyYW1zLCAnU2hha2VCaWcnKTsKICAgICAgICBjYW1TdWIuYWRkKGNhbVBhcmFtcywgJ0ltcGFjdExpZ2h0Jyk7CiAgICAgICAgY2FtU3ViLmFkZChjYW1QYXJhbXMsICdJbXBhY3RIZWF2eScpOwogICAgICAgIGNhbVN1Yi5hZGQoY2FtUGFyYW1zLCAnSW1wYWN0U2hhdHRlcicpOwogICAgfTsKCgpEZXZUb29scy5wcm90b3R5cGUuX3NldHVwVmlzdWFscyA9IGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnN0IGZvbGRlciA9IHRoaXMuZ3VpLmFkZEZvbGRlcignVmlzdWFsaXphdGlvbiBSb29tJyk7CiAgICAgICAgCiAgICAgICAgY29uc3Qgdml6UGFyYW1zID0gewogICAgICAgICAgICBhY3RpdmU6IGZhbHNlLAogICAgICAgICAgICBhc3NldDogJ1RpZHVzJywKICAgICAgICAgICAgc2NhbGU6IDEuMCwKICAgICAgICAgICAgYW5pbTogJ2lkbGUnLAogICAgICAgICAgICBzcGF3bjogKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLnZpekdyb3VwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy52aXpHcm91cCA9IG5ldyBUSFJFRS5Hcm91cCgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZ2FtZS5zY2VuZS5hZGQodGhpcy52aXpHcm91cCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBDbGVhciBwcmV2aW91cwogICAgICAgICAgICAgICAgd2hpbGUodGhpcy52aXpHcm91cC5jaGlsZHJlbi5sZW5ndGggPiAwKXsgCiAgICAgICAgICAgICAgICAgICAgdGhpcy52aXpHcm91cC5yZW1vdmUodGhpcy52aXpHcm91cC5jaGlsZHJlblswXSk7IAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCB1cmxNYXAgPSB7CiAgICAgICAgICAgICAgICAgICAgJ1RpZHVzJzogJ2h0dHBzOi8vY2RuLnRpbnlnbGIuY29tL21vZGVscy9kYTc4OGJlZjI1OGM0ZjBiOGQ5ZWYxYWNjMTljNTU2Ny5nbGInLAogICAgICAgICAgICAgICAgICAgICdXYWtrYSc6ICdodHRwczovL2Nkbi50aW55Z2xiLmNvbS9tb2RlbHMvNTkxMTRjOTg5NTE2NDdjOWI4ZGE3NGIwYmQzNjM2Y2IuZ2xiJywKICAgICAgICAgICAgICAgICAgICAnQmFsbCc6ICdodHRwczovL2Nkbi50aW55Z2xiLmNvbS9tb2RlbHMvNTIxYWU4Nzg4ZTU4NGUzNzhhNzlkOTczMmEwNzUzNTYuZ2xiJywKICAgICAgICAgICAgICAgICAgICAnR29hbCc6ICdodHRwczovL2Nkbi50aW55Z2xiLmNvbS9tb2RlbHMvYTUxNmJkOTBmYTdjNGRlZGI1ZGNiZmRmODAzZjEzZDUuZ2xiJwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgdXJsID0gdXJsTWFwW3ZpelBhcmFtcy5hc3NldF07CiAgICAgICAgICAgICAgICBpZih1cmwpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5Bc3NldExvYWRlci5sb2FkTW9kZWwodXJsLCAoZ2x0ZikgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtb2RlbCA9IGdsdGYuc2NlbmU7CiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsLnNjYWxlLnNldFNjYWxhcih2aXpQYXJhbXMuc2NhbGUpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZpekdyb3VwLmFkZChtb2RlbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZihnbHRmLmFuaW1hdGlvbnMgJiYgZ2x0Zi5hbmltYXRpb25zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudml6TWl4ZXIgPSBuZXcgVEhSRUUuQW5pbWF0aW9uTWl4ZXIobW9kZWwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVHJ5IHRvIGZpbmQgYW5pbWF0aW9uIGJ5IG5hbWUgb3IgZGVmYXVsdCB0byBmaXJzdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNsaXAgPSBUSFJFRS5BbmltYXRpb25DbGlwLmZpbmRCeU5hbWUoZ2x0Zi5hbmltYXRpb25zLCB2aXpQYXJhbXMuYW5pbSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWNsaXApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBGYWxsYmFjayBtYXBwaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbWFwID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaWRsZSc6IFsndHJlYWRpbmcnLCAnaWRsZSddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3dpbSc6IFsnc3dpbSddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndGhyb3cnOiBbJ3Rocm93J10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjYXRjaCc6IFsnY2F0Y2gnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JlYWN0JzogWydyZWFjdCcsICdoaXQnLCAnZGFtYWdlJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGtleXdvcmRzID0gbWFwW3ZpelBhcmFtcy5hbmltXSB8fCBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGlwID0gZ2x0Zi5hbmltYXRpb25zLmZpbmQoYSA9PiBrZXl3b3Jkcy5zb21lKGsgPT4gYS5uYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoaykpKSB8fCBnbHRmLmFuaW1hdGlvbnNbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjbGlwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52aXpNaXhlci5jbGlwQWN0aW9uKGNsaXApLnBsYXkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudml6TWl4ZXIgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRvZ2dsZVJvb206ICgpID0+IHsKICAgICAgICAgICAgICAgIHZpelBhcmFtcy5hY3RpdmUgPSAhdml6UGFyYW1zLmFjdGl2ZTsKICAgICAgICAgICAgICAgIGNvbnN0IGdhbWVMYXllciA9IFt0aGlzLmdhbWUudGVhbXMuaG9tZSwgdGhpcy5nYW1lLnRlYW1zLmF3YXksIHRoaXMuZ2FtZS5lbnRpdGllcy5iYWxsXTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gVG9nZ2xlIEdhbWUgVmlzaWJpbGl0eQogICAgICAgICAgICAgICAgZ2FtZUxheWVyLmZvckVhY2godCA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYodCAmJiB0LnBsYXllcnMpIHQucGxheWVycy5mb3JFYWNoKHAgPT4geyBpZihwLm1lc2gpIHAubWVzaC52aXNpYmxlID0gIXZpelBhcmFtcy5hY3RpdmU7IH0pOwogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYodCAmJiB0Lm1lc2gpIHQubWVzaC52aXNpYmxlID0gIXZpelBhcmFtcy5hY3RpdmU7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGlmKHdpbmRvdy5mbHV4LmFyZW5hTWVzaCkgd2luZG93LmZsdXguYXJlbmFNZXNoLnZpc2libGUgPSAhdml6UGFyYW1zLmFjdGl2ZTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYodml6UGFyYW1zLmFjdGl2ZSkgewogICAgICAgICAgICAgICAgICAgIC8vIE1vdmUgQ2FtZXJhIHRvIFZvaWQKICAgICAgICAgICAgICAgICAgICB0aGlzLmdhbWUuY2FtZXJhLnBvc2l0aW9uLnNldCgxMDAwLCA1LCAxMDEwKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmdhbWUuY2FtZXJhLmxvb2tBdCgxMDAwLCAyLCAxMDAwKTsKICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnZpekdyb3VwKSB0aGlzLnZpekdyb3VwLnBvc2l0aW9uLnNldCgxMDAwLCAwLCAxMDAwKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBBZGQgTGlnaHQgZm9yIFZpegogICAgICAgICAgICAgICAgICAgIGlmKCF0aGlzLnZpekxpZ2h0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudml6TGlnaHQgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCgweGZmZmZmZiwgMS4wKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52aXpMaWdodC5wb3NpdGlvbi5zZXQoMTAwNSwgMTAsIDEwMDUpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdhbWUuc2NlbmUuYWRkKHRoaXMudml6TGlnaHQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aGlzLnZpekxpZ2h0LnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFNwYXduIGluaXRpYWwKICAgICAgICAgICAgICAgICAgICB2aXpQYXJhbXMuc3Bhd24oKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gUmVzdG9yZSBDYW1lcmEKICAgICAgICAgICAgICAgICAgICBpZih0aGlzLmdhbWUuY2FtZXJhTWFuYWdlcikgdGhpcy5nYW1lLmNhbWVyYU1hbmFnZXIuc25hcFRvVGFyZ2V0KCk7CiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy52aXpMaWdodCkgdGhpcy52aXpMaWdodC52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIAogICAgICAgIGZvbGRlci5hZGQodml6UGFyYW1zLCAndG9nZ2xlUm9vbScpLm5hbWUoJ1RvZ2dsZSBSb29tJyk7CiAgICAgICAgZm9sZGVyLmFkZCh2aXpQYXJhbXMsICdhc3NldCcsIFsnVGlkdXMnLCAnV2Fra2EnLCAnQmFsbCcsICdHb2FsJ10pLm9uQ2hhbmdlKCgpID0+IHsgaWYodml6UGFyYW1zLmFjdGl2ZSkgdml6UGFyYW1zLnNwYXduKCk7IH0pOwogICAgICAgIGZvbGRlci5hZGQodml6UGFyYW1zLCAnc2NhbGUnLCAwLjEsIDUuMCkub25DaGFuZ2UodiA9PiB7CiAgICAgICAgICAgIGlmKHRoaXMudml6R3JvdXAgJiYgdGhpcy52aXpHcm91cC5jaGlsZHJlblswXSkgewogICAgICAgICAgICAgICAgdGhpcy52aXpHcm91cC5jaGlsZHJlblswXS5zY2FsZS5zZXRTY2FsYXIodik7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBmb2xkZXIuYWRkKHZpelBhcmFtcywgJ2FuaW0nLCBbJ2lkbGUnLCAnc3dpbScsICd0aHJvdycsICdjYXRjaCcsICdyZWFjdCddKS5uYW1lKCdBbmltYXRpb24nKS5vbkNoYW5nZSgoKSA9PiB7CiAgICAgICAgICAgICBpZih2aXpQYXJhbXMuYWN0aXZlKSB2aXpQYXJhbXMuc3Bhd24oKTsKICAgICAgICB9KTsKICAgICAgICBmb2xkZXIuYWRkKHZpelBhcmFtcywgJ3NwYXduJykubmFtZSgnUmVsb2FkIEFzc2V0Jyk7CiAgICAgICAgCiAgICAgICAgLy8gSG9vayBpbnRvIHVwZGF0ZSBsb29wIGZvciBtaXhlcgogICAgICAgIGNvbnN0IG9yaWdpbmFsVXBkYXRlID0gdGhpcy5nYW1lLnVwZGF0ZS5iaW5kKHRoaXMuZ2FtZSk7CiAgICAgICAgdGhpcy5nYW1lLnVwZGF0ZSA9IChkdCkgPT4gewogICAgICAgICAgICBvcmlnaW5hbFVwZGF0ZShkdCk7CiAgICAgICAgICAgIGlmICh2aXpQYXJhbXMuYWN0aXZlICYmIHRoaXMudml6TWl4ZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMudml6TWl4ZXIudXBkYXRlKGR0KTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9Owp9KSgpOw==","/DevTools.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICBjbGFzcyBEZXZUb29scyB7CiAgICAgICAgY29uc3RydWN0b3IoZ2FtZU1hbmFnZXIpIHsKICAgICAgICAgICAgdGhpcy5nYW1lID0gZ2FtZU1hbmFnZXI7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBsaWwtZ3VpIGF0dGFjaGVzIHRvIHdpbmRvdy5saWwgYnkgZGVmYXVsdCBpbiBVTUQgYnVpbGQKICAgICAgICAgICAgaWYgKCF3aW5kb3cubGlsIHx8ICF3aW5kb3cubGlsLkdVSSkgewogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJEZXZUb29sczogbGlsLWd1aSBub3QgZm91bmQuIik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCmNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYW1lLWNvbnRhaW5lcicpOwogICAgICAgICAgICB0aGlzLmd1aSA9IG5ldyB3aW5kb3cubGlsLkdVSSh7IHRpdGxlOiAnRmx1eCBEZXZUb29scycsIGNvbnRhaW5lcjogY29udGFpbmVyIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gUG9zaXRpb24gYXMgYSBjb2xsYXBzZWQgdGFiIG9uIHRoZSByaWdodCBmcmFtZQovLyBQb3NpdGlvbiBhcyBhIHNsaWRpbmcgdGFiIG9uIHRoZSByaWdodCBmcmFtZQovLyBQb3NpdGlvbiBhcyBhIHNsaWRpbmcgdGFiIG9uIHRoZSByaWdodCBmcmFtZQovLyBXcmFwcGVyIGZvciBzbGlkaW5nIGFuaW1hdGlvbgogICAgICAgICAgICBjb25zdCB3cmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIHdyYXBwZXIuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnOwogICAgICAgICAgICB3cmFwcGVyLnN0eWxlLnRvcCA9ICcxMDBweCc7CiAgICAgICAgICAgIHdyYXBwZXIuc3R5bGUucmlnaHQgPSAnLTI2MHB4JzsKICAgICAgICAgICAgd3JhcHBlci5zdHlsZS53aWR0aCA9ICcyNjBweCc7CiAgICAgICAgICAgIHdyYXBwZXIuc3R5bGUudHJhbnNpdGlvbiA9ICdyaWdodCAwLjNzIGN1YmljLWJlemllcigwLjIsIDAuOCwgMC4yLCAxLjApJzsKICAgICAgICAgICAgd3JhcHBlci5zdHlsZS56SW5kZXggPSAnOTk5OSc7CiAgICAgICAgICAgIHdyYXBwZXIuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgICAgICAgICAgd3JhcHBlci5zdHlsZS5mbGV4RGlyZWN0aW9uID0gJ2NvbHVtbic7CiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh3cmFwcGVyKTsKCiAgICAgICAgICAgIGNvbnN0IGRvbSA9IHRoaXMuZ3VpLmRvbUVsZW1lbnQ7CiAgICAgICAgICAgIGRvbS5zdHlsZS53aWR0aCA9ICcxMDAlJzsKICAgICAgICAgICAgZG9tLnN0eWxlLnNldFByb3BlcnR5KCctLXdpZHRoJywgJzEwMCUnKTsKICAgICAgICAgICAgZG9tLnN0eWxlLm1heEhlaWdodCA9ICc4MHZoJzsKICAgICAgICAgICAgZG9tLnN0eWxlLm92ZXJmbG93WSA9ICdhdXRvJzsKICAgICAgICAgICAgZG9tLnN0eWxlLm92ZXJmbG93WCA9ICdoaWRkZW4nOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gTW92ZSBHVUkgaW50byB3cmFwcGVyCiAgICAgICAgICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQoZG9tKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENyZWF0ZSBUb2dnbGUgSGFuZGxlCiAgICAgICAgICAgIGNvbnN0IGhhbmRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICBoYW5kbGUuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnOwogICAgICAgICAgICBoYW5kbGUuc3R5bGUubGVmdCA9ICctNDBweCc7IC8vIFByb3RydWRlIHRvIHRoZSBsZWZ0CiAgICAgICAgICAgIGhhbmRsZS5zdHlsZS50b3AgPSAnMCc7CiAgICAgICAgICAgIGhhbmRsZS5zdHlsZS53aWR0aCA9ICc0MHB4JzsKICAgICAgICAgICAgaGFuZGxlLnN0eWxlLmhlaWdodCA9ICc0MHB4JzsKICAgICAgICAgICAgaGFuZGxlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICdyZ2JhKDAsIDIwLCA0MCwgMC45KSc7CiAgICAgICAgICAgIGhhbmRsZS5zdHlsZS5ib3JkZXIgPSAnMXB4IHNvbGlkICMwMGZmZmYnOwogICAgICAgICAgICBoYW5kbGUuc3R5bGUuYm9yZGVyUmlnaHQgPSAnbm9uZSc7CiAgICAgICAgICAgIGhhbmRsZS5zdHlsZS5ib3JkZXJUb3BMZWZ0UmFkaXVzID0gJzhweCc7CiAgICAgICAgICAgIGhhbmRsZS5zdHlsZS5ib3JkZXJCb3R0b21MZWZ0UmFkaXVzID0gJzhweCc7CiAgICAgICAgICAgIGhhbmRsZS5zdHlsZS5jdXJzb3IgPSAncG9pbnRlcic7CiAgICAgICAgICAgIGhhbmRsZS5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgICAgICAgICBoYW5kbGUuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSAnY2VudGVyJzsKICAgICAgICAgICAgaGFuZGxlLnN0eWxlLmFsaWduSXRlbXMgPSAnY2VudGVyJzsKICAgICAgICAgICAgaGFuZGxlLnN0eWxlLmNvbG9yID0gJyMwMGZmZmYnOwogICAgICAgICAgICBoYW5kbGUuc3R5bGUuZm9udFNpemUgPSAnMjBweCc7CiAgICAgICAgICAgIGhhbmRsZS5pbm5lckhUTUwgPSAn4pqZJzsKICAgICAgICAgICAgaGFuZGxlLnN0eWxlLmJveFNoYWRvdyA9ICctNXB4IDAgMTBweCByZ2JhKDAsMCwwLDAuNSknOwogICAgICAgICAgICAKICAgICAgICAgICAgd3JhcHBlci5hcHBlbmRDaGlsZChoYW5kbGUpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVG9nZ2xlIExvZ2ljCiAgICAgICAgICAgIGxldCBpc09wZW4gPSBmYWxzZTsKICAgICAgICAgICAgaGFuZGxlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7IC8vIFByZXZlbnQgZ2FtZSBpbnB1dHMKICAgICAgICAgICAgICAgIGlzT3BlbiA9ICFpc09wZW47CiAgICAgICAgICAgICAgICB3cmFwcGVyLnN0eWxlLnJpZ2h0ID0gaXNPcGVuID8gJzBweCcgOiAnLTI2MHB4JzsKICAgICAgICAgICAgICAgIGhhbmRsZS5pbm5lckhUTUwgPSBpc09wZW4gPyAnwrsnIDogJ+KamSc7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAvLyBEZWZhdWx0IGdsb2JhbCB0aW1lU2NhbGUgaWYgbm90IHNldAppZiAod2luZG93LmZsdXgudGltZVNjYWxlID09PSB1bmRlZmluZWQpIHdpbmRvdy5mbHV4LnRpbWVTY2FsZSA9IDAuODsKCnRoaXMuX3NldHVwR2VuZXJhbCgpOwogICAgICAgICAgICB0aGlzLl9zZXR1cEdhbWVTdGF0ZSgpOwp0aGlzLl9zZXR1cE92ZXJsYXlzKCk7CiAgICAgICAgICAgIHRoaXMuX3NldHVwVGVhbXMoKTsKICAgICAgICAgICAgdGhpcy5fc2V0dXBQbGF5ZXJJbnNwZWN0b3IoKTsKICAgICAgICAgICAgdGhpcy5fc2V0dXBCYWxsU2FuZGJveCgpOwp0aGlzLl9zZXR1cEZYTGFiKCk7CiAgICAgICAgICAgIHRoaXMuX3NldHVwVmlzdWFscygpOwogICAgICAgIH0KCl9zZXR1cEdlbmVyYWwoKSB7CiAgICAgICAgICAgIGNvbnN0IGZvbGRlciA9IHRoaXMuZ3VpLmFkZEZvbGRlcignR2VuZXJhbCcpOwogICAgICAgICAgICAKY29uc3QgcGFyYW1zID0gewogICAgICAgICAgICAgICAgdGltZVNjYWxlOiB3aW5kb3cuZmx1eC50aW1lU2NhbGUsCiAgICAgICAgICAgICAgICBkZW1vTW9kZTogdGhpcy5nYW1lLmlzRGVtb01vZGUsCiAgICAgICAgICAgICAgICB0b2dnbGVIVUQ6IHRydWUsCiAgICAgICAgICAgICAgICByZXNvbHV0aW9uOiAwLjUwLAogICAgICAgICAgICAgICAgYXJlbmFPcGFjaXR5OiAwLjAsCiAgICAgICAgICAgICAgICBhcmVuYTJPcGFjaXR5OiAwLjA1CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBmb2xkZXIuYWRkKHBhcmFtcywgJ3RpbWVTY2FsZScsIDAuMCwgNS4wKS5uYW1lKCdHYW1lIFNwZWVkJykub25DaGFuZ2UodiA9PiB7CiAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC50aW1lU2NhbGUgPSB2OwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGZvbGRlci5hZGQocGFyYW1zLCAnZGVtb01vZGUnKS5uYW1lKCdEZW1vIE1vZGUnKS5saXN0ZW4oKS5vbkNoYW5nZSh2ID0+IHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmdhbWUuaXNEZW1vTW9kZSAhPT0gdikgewogICAgICAgICAgICAgICAgICAgIHRoaXMuZ2FtZS50b2dnbGVEZW1vTW9kZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGZvbGRlci5hZGQocGFyYW1zLCAndG9nZ2xlSFVEJykubmFtZSgnU2hvdyBIVUQnKS5vbkNoYW5nZSh2ID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGh1ZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1aS1sYXllcicpOwogICAgICAgICAgICAgICAgaWYgKGh1ZCkgewogICAgICAgICAgICAgICAgICAgIGh1ZC5zdHlsZS52aXNpYmlsaXR5ID0gdiA/ICd2aXNpYmxlJyA6ICdoaWRkZW4nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGZvbGRlci5hZGQocGFyYW1zLCAncmVzb2x1dGlvbicsIDAuMSwgMi4wKS5uYW1lKCdSZXNvbHV0aW9uIFNjYWxlJykub25DaGFuZ2UodiA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB3ID0gd2luZG93LmlubmVyV2lkdGg7CiAgICAgICAgICAgICAgICBjb25zdCBoID0gd2luZG93LmlubmVySGVpZ2h0OwogICAgICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSB0aGlzLmdhbWUucmVuZGVyZXI7CiAgICAgICAgICAgICAgICBpZiAocmVuZGVyZXIpIHsKICAgICAgICAgICAgICAgICAgICByZW5kZXJlci5zZXRTaXplKHcgKiB2LCBoICogdiwgZmFsc2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCmZvbGRlci5hZGQocGFyYW1zLCAnYXJlbmFPcGFjaXR5JywgMC4wLCAxLjApLm5hbWUoJ0FyZW5hIDEgT3BhY2l0eScpLm9uQ2hhbmdlKHYgPT4gewogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmFyZW5hTWVzaCAmJiB3aW5kb3cuZmx1eC5hcmVuYU1lc2gubWF0ZXJpYWwpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5hcmVuYU1lc2gubWF0ZXJpYWwub3BhY2l0eSA9IHY7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY29uc3QgYmxlbmRNb2RlcyA9IHsKICAgICAgICAgICAgICAgICdOb3JtYWwnOiBUSFJFRS5Ob3JtYWxCbGVuZGluZywKICAgICAgICAgICAgICAgICdBZGRpdGl2ZSc6IFRIUkVFLkFkZGl0aXZlQmxlbmRpbmcsCiAgICAgICAgICAgICAgICAnTXVsdGlwbHknOiBUSFJFRS5NdWx0aXBseUJsZW5kaW5nLAogICAgICAgICAgICAgICAgJ1N1YnRyYWN0aXZlJzogVEhSRUUuU3VidHJhY3RpdmVCbGVuZGluZywKICAgICAgICAgICAgICAgICdOb0JsZW5kaW5nJzogVEhSRUUuTm9CbGVuZGluZwogICAgICAgICAgICB9OwogICAgICAgICAgICBwYXJhbXMuYXJlbmFCbGVuZCA9ICdNdWx0aXBseSc7CgogICAgICAgICAgICBmb2xkZXIuYWRkKHBhcmFtcywgJ2FyZW5hQmxlbmQnLCBPYmplY3Qua2V5cyhibGVuZE1vZGVzKSkubmFtZSgnQXJlbmEgMSBCbGVuZCcpLm9uQ2hhbmdlKHYgPT4gewogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmFyZW5hTWVzaCAmJiB3aW5kb3cuZmx1eC5hcmVuYU1lc2gubWF0ZXJpYWwpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5hcmVuYU1lc2gubWF0ZXJpYWwuYmxlbmRpbmcgPSBibGVuZE1vZGVzW3ZdOwogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmFyZW5hTWVzaC5tYXRlcmlhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gQXJlbmEgMiBDb250cm9scwogICAgICAgICAgICBmb2xkZXIuYWRkKHBhcmFtcywgJ2FyZW5hMk9wYWNpdHknLCAwLjAsIDEuMCkubmFtZSgnQXJlbmEgMiBPcGFjaXR5Jykub25DaGFuZ2UodiA9PiB7CiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguYXJlbmFNZXNoMiAmJiB3aW5kb3cuZmx1eC5hcmVuYU1lc2gyLm1hdGVyaWFsKSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguYXJlbmFNZXNoMi5tYXRlcmlhbC5vcGFjaXR5ID0gdjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBwYXJhbXMuYXJlbmEyQmxlbmQgPSAnTm9ybWFsJzsKICAgICAgICAgICAgZm9sZGVyLmFkZChwYXJhbXMsICdhcmVuYTJCbGVuZCcsIE9iamVjdC5rZXlzKGJsZW5kTW9kZXMpKS5uYW1lKCdBcmVuYSAyIEJsZW5kJykub25DaGFuZ2UodiA9PiB7CiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguYXJlbmFNZXNoMiAmJiB3aW5kb3cuZmx1eC5hcmVuYU1lc2gyLm1hdGVyaWFsKSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguYXJlbmFNZXNoMi5tYXRlcmlhbC5ibGVuZGluZyA9IGJsZW5kTW9kZXNbdl07CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmZsdXguYXJlbmFNZXNoMi5tYXRlcmlhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQXBwbHkgZGVmYXVsdHMKICAgICAgICAgICAgaWYgKHdpbmRvdy5mbHV4LmFyZW5hTWVzaCAmJiB3aW5kb3cuZmx1eC5hcmVuYU1lc2gubWF0ZXJpYWwpIHsKICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmFyZW5hTWVzaC5tYXRlcmlhbC5vcGFjaXR5ID0gcGFyYW1zLmFyZW5hT3BhY2l0eTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAod2luZG93LmZsdXguYXJlbmFNZXNoMiAmJiB3aW5kb3cuZmx1eC5hcmVuYU1lc2gyLm1hdGVyaWFsKSB7CiAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5hcmVuYU1lc2gyLm1hdGVyaWFsLm9wYWNpdHkgPSBwYXJhbXMuYXJlbmEyT3BhY2l0eTsKICAgICAgICAgICAgfQogICAgICAgIH0KCl9zZXR1cE92ZXJsYXlzKCkgewogICAgICAgICAgICBjb25zdCBmb2xkZXIgPSB0aGlzLmd1aS5hZGRGb2xkZXIoJ092ZXJsYXlzICYgRlgnKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIDEuIEdJRiBPdmVybGF5CiAgICAgICAgICAgIGNvbnN0IGdpZkVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjcmVlbi1vdmVybGF5LWdpZicpOwogICAgICAgICAgICBpZiAoZ2lmRWwpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGdpZlBhcmFtcyA9IHsKICAgICAgICAgICAgICAgICAgICB2aXNpYmxlOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAuNzIsCiAgICAgICAgICAgICAgICAgICAgYmxlbmQ6ICdzb2Z0LWxpZ2h0JwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgZ0ZvbGRlciA9IGZvbGRlci5hZGRGb2xkZXIoJ1NjcmVlbiBHSUYnKTsKICAgICAgICAgICAgICAgIGdGb2xkZXIuYWRkKGdpZlBhcmFtcywgJ3Zpc2libGUnKS5vbkNoYW5nZSh2ID0+IGdpZkVsLnN0eWxlLmRpc3BsYXkgPSB2ID8gJ2Jsb2NrJyA6ICdub25lJyk7CiAgICAgICAgICAgICAgICBnRm9sZGVyLmFkZChnaWZQYXJhbXMsICdvcGFjaXR5JywgMC4wLCAxLjApLm9uQ2hhbmdlKHYgPT4gZ2lmRWwuc3R5bGUub3BhY2l0eSA9IHYpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBibGVuZE1vZGVzID0gWwogICAgICAgICAgICAgICAgICAgICdub3JtYWwnLCAnbXVsdGlwbHknLCAnc2NyZWVuJywgJ292ZXJsYXknLCAKICAgICAgICAgICAgICAgICAgICAnZGFya2VuJywgJ2xpZ2h0ZW4nLCAnY29sb3ItZG9kZ2UnLCAnY29sb3ItYnVybicsIAogICAgICAgICAgICAgICAgICAgICdoYXJkLWxpZ2h0JywgJ3NvZnQtbGlnaHQnLCAnZGlmZmVyZW5jZScsICdleGNsdXNpb24nLCAKICAgICAgICAgICAgICAgICAgICAnaHVlJywgJ3NhdHVyYXRpb24nLCAnY29sb3InLCAnbHVtaW5vc2l0eScKICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICBnRm9sZGVyLmFkZChnaWZQYXJhbXMsICdibGVuZCcsIGJsZW5kTW9kZXMpLm9uQ2hhbmdlKHYgPT4gZ2lmRWwuc3R5bGUubWl4QmxlbmRNb2RlID0gdik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDIuIFdhdGVyIE92ZXJsYXkKICAgICAgICAgICAgY29uc3Qgd28gPSB0aGlzLmdhbWUud2F0ZXJPdmVybGF5OwogICAgICAgICAgICBpZiAod28gJiYgd28ubWVzaCkgewogICAgICAgICAgICAgICAgY29uc3Qgd0ZvbGRlciA9IGZvbGRlci5hZGRGb2xkZXIoJ1dhdGVyIFNoYWRlcicpOwogICAgICAgICAgICAgICAgY29uc3Qgd1BhcmFtcyA9IHsgCiAgICAgICAgICAgICAgICAgICAgdmlzaWJsZTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiB3by5tYXRlcmlhbC51bmlmb3Jtcy51T3BhY2l0eSA/IHdvLm1hdGVyaWFsLnVuaWZvcm1zLnVPcGFjaXR5LnZhbHVlIDogMC41LAogICAgICAgICAgICAgICAgICAgIGJsZW5kOiAnQWRkaXRpdmUnCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB3Rm9sZGVyLmFkZCh3UGFyYW1zLCAndmlzaWJsZScpLm9uQ2hhbmdlKHYgPT4gd28ubWVzaC52aXNpYmxlID0gdik7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmICh3by5tYXRlcmlhbC51bmlmb3Jtcy51T3BhY2l0eSkgewogICAgICAgICAgICAgICAgICAgIHdGb2xkZXIuYWRkKHdQYXJhbXMsICdvcGFjaXR5JywgMC4wLCAyLjApLm9uQ2hhbmdlKHYgPT4gd28ubWF0ZXJpYWwudW5pZm9ybXMudU9wYWNpdHkudmFsdWUgPSB2KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCB0aHJlZUJsZW5kcyA9IHsKICAgICAgICAgICAgICAgICAgICAnTm9ybWFsJzogVEhSRUUuTm9ybWFsQmxlbmRpbmcsCiAgICAgICAgICAgICAgICAgICAgJ0FkZGl0aXZlJzogVEhSRUUuQWRkaXRpdmVCbGVuZGluZywKICAgICAgICAgICAgICAgICAgICAnU3VidHJhY3RpdmUnOiBUSFJFRS5TdWJ0cmFjdGl2ZUJsZW5kaW5nLAogICAgICAgICAgICAgICAgICAgICdNdWx0aXBseSc6IFRIUkVFLk11bHRpcGx5QmxlbmRpbmcsCiAgICAgICAgICAgICAgICAgICAgJ05vQmxlbmRpbmcnOiBUSFJFRS5Ob0JsZW5kaW5nCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB3Rm9sZGVyLmFkZCh3UGFyYW1zLCAnYmxlbmQnLCBPYmplY3Qua2V5cyh0aHJlZUJsZW5kcykpLm9uQ2hhbmdlKHYgPT4gewogICAgICAgICAgICAgICAgICAgIHdvLm1hdGVyaWFsLmJsZW5kaW5nID0gdGhyZWVCbGVuZHNbdl07CiAgICAgICAgICAgICAgICAgICAgd28ubWF0ZXJpYWwubmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDMuIExpZ2h0IFNoYWZ0cwogICAgICAgICAgICBjb25zdCBscyA9IHRoaXMuZ2FtZS5saWdodFNoYWZ0czsKICAgICAgICAgICAgaWYgKGxzICYmIGxzLmNvbnRhaW5lcikgewogICAgICAgICAgICAgICAgY29uc3QgbFBhcmFtcyA9IHsgdmlzaWJsZTogdHJ1ZSB9OwogICAgICAgICAgICAgICAgZm9sZGVyLmFkZChsUGFyYW1zLCAndmlzaWJsZScpLm5hbWUoJ0xpZ2h0IFNoYWZ0cycpLm9uQ2hhbmdlKHYgPT4gbHMuY29udGFpbmVyLnZpc2libGUgPSB2KTsKICAgICAgICAgICAgfQogICAgICAgIH0KCl9zZXR1cEdhbWVTdGF0ZSgpIHsKICAgICAgICAgICAgY29uc3QgZm9sZGVyID0gdGhpcy5ndWkuYWRkRm9sZGVyKCdHYW1lIFN0YXRlJyk7CiAgICAgICAgICAgIGNvbnN0IGdtID0gdGhpcy5nYW1lOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgcGFyYW1zID0gewogICAgICAgICAgICAgICAgZm9yY2VIb21lR29hbDogKCkgPT4geyAKICAgICAgICAgICAgICAgICAgICBpZihnbS5zdGF0ZSA9PT0gJ2FjdGl2ZScpIGdtLmdvYWxTY29yZWQoJ2hvbWUnKTsgCiAgICAgICAgICAgICAgICAgICAgZWxzZSBjb25zb2xlLndhcm4oIkdhbWUgbXVzdCBiZSBhY3RpdmUgdG8gdHJpZ2dlciBnb2FsIik7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZm9yY2VBd2F5R29hbDogKCkgPT4geyAKICAgICAgICAgICAgICAgICAgICBpZihnbS5zdGF0ZSA9PT0gJ2FjdGl2ZScpIGdtLmdvYWxTY29yZWQoJ2F3YXknKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGNvbnNvbGUud2FybigiR2FtZSBtdXN0IGJlIGFjdGl2ZSB0byB0cmlnZ2VyIGdvYWwiKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBmb3JjZUhhbGZ0aW1lOiAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYoZ20uc3RhdGUgPT09ICdhY3RpdmUnKSBnbS5lbmRIYWxmKCk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVzZXRSb3VuZDogKCkgPT4gZ20ucmVzZXRSb3VuZCgpLAogICAgICAgICAgICAgICAgZXhpdFRvTWVudTogKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UgJiYgd2luZG93LmZsdXguZ2FtZUluc3RhbmNlLm1lbnVNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5tZW51TWFuYWdlci5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5zdGF0ZSA9ICdtZW51JzsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3RvcCBwcmFjdGljZSBpZiBydW5uaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UucHJhY3RpY2VNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UucHJhY3RpY2VNYW5hZ2VyLnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGZvbGRlci5hZGQocGFyYW1zLCAnZm9yY2VIb21lR29hbCcpLm5hbWUoJ1RyaWdnZXIgSG9tZSBHb2FsJyk7CiAgICAgICAgICAgIGZvbGRlci5hZGQocGFyYW1zLCAnZm9yY2VBd2F5R29hbCcpLm5hbWUoJ1RyaWdnZXIgQXdheSBHb2FsJyk7CiAgICAgICAgICAgIGZvbGRlci5hZGQocGFyYW1zLCAnZm9yY2VIYWxmdGltZScpLm5hbWUoJ0ZvcmNlIEhhbGZ0aW1lJyk7CiAgICAgICAgICAgIGZvbGRlci5hZGQocGFyYW1zLCAncmVzZXRSb3VuZCcpLm5hbWUoJ1Jlc2V0IFJvdW5kJyk7CiAgICAgICAgICAgIGZvbGRlci5hZGQocGFyYW1zLCAnZXhpdFRvTWVudScpLm5hbWUoJ0V4aXQgdG8gTWVudScpOwogICAgICAgIH0KCiAgICAgICAgX3NldHVwVGVhbXMoKSB7CiAgICAgICAgICAgIGNvbnN0IGZvbGRlciA9IHRoaXMuZ3VpLmFkZEZvbGRlcignVGVhbXMnKTsKICAgICAgICAgICAgaWYgKCF0aGlzLmdhbWUudGVhbXMuaG9tZSB8fCAhdGhpcy5nYW1lLnRlYW1zLmF3YXkpIHJldHVybjsKCiAgICAgICAgICAgIGNvbnN0IGhvbWUgPSB0aGlzLmdhbWUudGVhbXMuaG9tZTsKICAgICAgICAgICAgY29uc3QgYXdheSA9IHRoaXMuZ2FtZS50ZWFtcy5hd2F5OwoKICAgICAgICAgICAgLy8gSG9tZQogICAgICAgICAgICBjb25zdCBoRm9sZGVyID0gZm9sZGVyLmFkZEZvbGRlcignSG9tZSBUZWFtJyk7CiAgICAgICAgICAgIGhGb2xkZXIuYWRkKGhvbWUsICdpc0h1bWFuJykubmFtZSgnSXMgSHVtYW4gQ29udHJvbGxlZCcpLmxpc3RlbigpOwogICAgICAgICAgICBoRm9sZGVyLmFkZChob21lLCAnYWlFbmFibGVkJykubmFtZSgnQUkgTG9naWMgRW5hYmxlZCcpLmxpc3RlbigpOwoKICAgICAgICAgICAgLy8gQXdheQogICAgICAgICAgICBjb25zdCBhRm9sZGVyID0gZm9sZGVyLmFkZEZvbGRlcignQXdheSBUZWFtJyk7CiAgICAgICAgICAgIGFGb2xkZXIuYWRkKGF3YXksICdpc0h1bWFuJykubmFtZSgnSXMgSHVtYW4gQ29udHJvbGxlZCcpLmxpc3RlbigpOwogICAgICAgICAgICBhRm9sZGVyLmFkZChhd2F5LCAnYWlFbmFibGVkJykubmFtZSgnQUkgTG9naWMgRW5hYmxlZCcpLmxpc3RlbigpOwoKICAgICAgICB9Cgpfc2V0dXBQbGF5ZXJJbnNwZWN0b3IoKSB7CiAgICAgICAgICAgIGNvbnN0IGZvbGRlciA9IHRoaXMuZ3VpLmFkZEZvbGRlcignUGxheWVyIEluc3BlY3RvciAoSG9tZSBBY3RpdmUpJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBIZWxwZXIgdG8gZ2V0IGN1cnJlbnQgYWN0aXZlIHBsYXllciBzYWZlbHkKICAgICAgICAgICAgY29uc3QgZ2V0QWN0aXZlID0gKCkgPT4gewogICAgICAgICAgICAgICAgcmV0dXJuICh0aGlzLmdhbWUudGVhbXMuaG9tZSAmJiB0aGlzLmdhbWUudGVhbXMuaG9tZS5hY3RpdmVQbGF5ZXIpIAogICAgICAgICAgICAgICAgICAgID8gdGhpcy5nYW1lLnRlYW1zLmhvbWUuYWN0aXZlUGxheWVyIAogICAgICAgICAgICAgICAgICAgIDogbnVsbDsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8vIFByb3h5IG9iamVjdCB0byBiaW5kIEdVSSB0byBkeW5hbWljIHRhcmdldAogICAgICAgICAgICBjb25zdCBwcm94eSA9IHsKICAgICAgICAgICAgICAgIGdldCBSb2xlKCkgeyAKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gZ2V0QWN0aXZlKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHAgPyBwLnJvbGUgOiAnLSc7IAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZ2V0IEdvZE1vZGUoKSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcCA/IHAuaXNHb2RNb2RlIDogZmFsc2U7IAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNldCBHb2RNb2RlKHYpIHsgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IGdldEFjdGl2ZSgpOwogICAgICAgICAgICAgICAgICAgIGlmKHApIHAuaXNHb2RNb2RlID0gdjsgCiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIC8vIFJ1bnRpbWUgVmFsdWVzCiAgICAgICAgICAgICAgICBnZXQgSFAoKSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcCA/IHAuc3RhdHMuSFAgOiAwOyAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZXQgSFAodikgeyAKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gZ2V0QWN0aXZlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYocCkgcC5zdGF0cy5IUCA9IHY7IAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZ2V0IEN1cnJlbnRFTigpIHsgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IGdldEFjdGl2ZSgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBwID8gcC5jdXJyZW50RU4gOiAwOyAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZXQgQ3VycmVudEVOKHYpIHsgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IGdldEFjdGl2ZSgpOwogICAgICAgICAgICAgICAgICAgIGlmKHApIHAuY3VycmVudEVOID0gdjsgCiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIC8vIEJhc2UgU3RhdHMKICAgICAgICAgICAgICAgIGdldCBNYXhIUCgpIHsgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IGdldEFjdGl2ZSgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBwID8gcC5zdGF0cy5tYXhIUCA6IDA7IAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNldCBNYXhIUCh2KSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICBpZihwKSBwLnN0YXRzLm1heEhQID0gdjsgCiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIGdldCBTUCgpIHsgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IGdldEFjdGl2ZSgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBwID8gcC5zdGF0cy5TUCA6IDA7IAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNldCBTUCh2KSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICBpZihwKSB7IAogICAgICAgICAgICAgICAgICAgICAgICBwLnN0YXRzLlNQID0gdjsgCiAgICAgICAgICAgICAgICAgICAgICAgIHAuX3VwZGF0ZURlcml2ZWRTdGF0cygpOyAKICAgICAgICAgICAgICAgICAgICB9IAogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICBnZXQgRU4oKSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcCA/IHAuc3RhdHMuRU4gOiAwOyAKICAgICAgICAgICAgICAgIH0sIAogICAgICAgICAgICAgICAgc2V0IEVOKHYpIHsgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IGdldEFjdGl2ZSgpOwogICAgICAgICAgICAgICAgICAgIGlmKHApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcC5zdGF0cy5FTiA9IHY7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICBnZXQgQVQoKSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcCA/IHAuc3RhdHMuQVQgOiAwOyAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZXQgQVQodikgeyAKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gZ2V0QWN0aXZlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYocCkgcC5zdGF0cy5BVCA9IHY7IAogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICBnZXQgUEEoKSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcCA/IHAuc3RhdHMuUEEgOiAwOyAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZXQgUEEodikgeyAKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gZ2V0QWN0aXZlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYocCkgcC5zdGF0cy5QQSA9IHY7IAogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICBnZXQgQkwoKSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcCA/IHAuc3RhdHMuQkwgOiAwOyAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZXQgQkwodikgeyAKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gZ2V0QWN0aXZlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYocCkgcC5zdGF0cy5CTCA9IHY7IAogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICBnZXQgU0goKSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcCA/IHAuc3RhdHMuU0ggOiAwOyAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZXQgU0godikgeyAKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gZ2V0QWN0aXZlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYocCkgcC5zdGF0cy5TSCA9IHY7IAogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICBnZXQgQ0EoKSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcCA/IHAuc3RhdHMuQ0EgOiAwOyAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZXQgQ0EodikgeyAKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gZ2V0QWN0aXZlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYocCkgcC5zdGF0cy5DQSA9IHY7IAogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAvLyBBY3Rpb25zCiAgICAgICAgICAgICAgICBMZXZlbFVwOiAoKSA9PiB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBnZXRBY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICBpZihwKSBwLmxldmVsVXAoKTsgCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgRnVsbEhlYWw6ICgpID0+IHsgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IGdldEFjdGl2ZSgpOyAKICAgICAgICAgICAgICAgICAgICBpZihwKSB7IAogICAgICAgICAgICAgICAgICAgICAgICBwLnN0YXRzLkhQID0gcC5zdGF0cy5tYXhIUDsgCiAgICAgICAgICAgICAgICAgICAgICAgIHAuY3VycmVudEVOID0gcC5nZXRTdGF0KCdFTicpOyAKICAgICAgICAgICAgICAgICAgICAgICAgcC5zdGF0dXMudmVub20gPSAwOyAKICAgICAgICAgICAgICAgICAgICAgICAgcC5zdGF0dXMubmFwID0gMDsgCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcihsZXQgayBpbiBwLnN0YXR1cy53aXRoZXIpIHAuc3RhdHVzLndpdGhlcltrXSA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5mbG9hdGluZ1RleHQuc3Bhd24oIkZVTEwgSEVBTCIsIHAubWVzaC5wb3NpdGlvbiwgImhlYWwiKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgRHJhaW5FTjogKCkgPT4geyAKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gZ2V0QWN0aXZlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYocCkgewogICAgICAgICAgICAgICAgICAgICAgICBwLmN1cnJlbnRFTiA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIHAuZnVtYmxlKCk7IC8vIFRyaWdnZXIgZnVtYmxlIGxvZ2ljCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgZm9sZGVyLmFkZChwcm94eSwgJ1JvbGUnKS5saXN0ZW4oKS5kaXNhYmxlKCk7CiAgICAgICAgICAgIGZvbGRlci5hZGQocHJveHksICdHb2RNb2RlJykubmFtZSgnR29kIE1vZGUgKEluZiBIUC9FTiknKS5saXN0ZW4oKTsKCiAgICAgICAgICAgIGNvbnN0IHJ0Rm9sZGVyID0gZm9sZGVyLmFkZEZvbGRlcignUnVudGltZSBTdGF0dXMnKTsKICAgICAgICAgICAgcnRGb2xkZXIuYWRkKHByb3h5LCAnSFAnLCAwLCA5OTk5KS5saXN0ZW4oKTsKICAgICAgICAgICAgcnRGb2xkZXIuYWRkKHByb3h5LCAnQ3VycmVudEVOJywgMCwgMTAwKS5uYW1lKCdDdXJyZW50IEVOJykubGlzdGVuKCk7CgogICAgICAgICAgICBjb25zdCBzdGF0Rm9sZGVyID0gZm9sZGVyLmFkZEZvbGRlcignQmFzZSBTdGF0cycpOwogICAgICAgICAgICBzdGF0Rm9sZGVyLmFkZChwcm94eSwgJ01heEhQJywgMTAwLCA5OTk5KS5saXN0ZW4oKTsKICAgICAgICAgICAgc3RhdEZvbGRlci5hZGQocHJveHksICdFTicsIDAsIDk5KS5uYW1lKCdNYXggRU4nKS5saXN0ZW4oKTsKICAgICAgICAgICAgc3RhdEZvbGRlci5hZGQocHJveHksICdTUCcsIDAsIDk5KS5saXN0ZW4oKTsKICAgICAgICAgICAgc3RhdEZvbGRlci5hZGQocHJveHksICdBVCcsIDAsIDk5KS5saXN0ZW4oKTsKICAgICAgICAgICAgc3RhdEZvbGRlci5hZGQocHJveHksICdQQScsIDAsIDk5KS5saXN0ZW4oKTsKICAgICAgICAgICAgc3RhdEZvbGRlci5hZGQocHJveHksICdCTCcsIDAsIDk5KS5saXN0ZW4oKTsKICAgICAgICAgICAgc3RhdEZvbGRlci5hZGQocHJveHksICdTSCcsIDAsIDk5KS5saXN0ZW4oKTsKICAgICAgICAgICAgc3RhdEZvbGRlci5hZGQocHJveHksICdDQScsIDAsIDk5KS5saXN0ZW4oKTsKCiAgICAgICAgICAgIGNvbnN0IGFjdGlvbkZvbGRlciA9IGZvbGRlci5hZGRGb2xkZXIoJ0FjdGlvbnMnKTsKICAgICAgICAgICAgYWN0aW9uRm9sZGVyLmFkZChwcm94eSwgJ0xldmVsVXAnKS5uYW1lKCdJbnN0YW50IExldmVsIFVwJyk7CiAgICAgICAgICAgIGFjdGlvbkZvbGRlci5hZGQocHJveHksICdGdWxsSGVhbCcpLm5hbWUoJ0Z1bGwgSGVhbCAmIEN1cmUnKTsKICAgICAgICAgICAgYWN0aW9uRm9sZGVyLmFkZChwcm94eSwgJ0RyYWluRU4nKS5uYW1lKCdEcmFpbiBFTiAoRnVtYmxlKScpOwogICAgICAgIH0KCiAgICAgICAgX3NldHVwQmFsbFNhbmRib3goKSB7CiAgICAgICAgICAgIGNvbnN0IGZvbGRlciA9IHRoaXMuZ3VpLmFkZEZvbGRlcignQmFsbCAmIFBoeXNpY3MgU2FuZGJveCcpOwogICAgICAgICAgICBjb25zdCBDID0gd2luZG93LmZsdXguQmFsbENvbmZpZzsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICghQykgewogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJCYWxsQ29uZmlnIG5vdCBmb3VuZC4gU2tpcHBpbmcgUGh5c2ljcyBTYW5kYm94LiIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAxLiBQaHlzaWNzIENvbnN0YW50cwogICAgICAgICAgICBjb25zdCBwaHlzRm9sZGVyID0gZm9sZGVyLmFkZEZvbGRlcignUGh5c2ljcyBDb25zdGFudHMnKTsKICAgICAgICAgICAgcGh5c0ZvbGRlci5hZGQoQywgJ1dBVEVSX0RSQUcnLCAwLjAsIDUuMCkubmFtZSgnV2F0ZXIgRHJhZycpOwogICAgICAgICAgICBwaHlzRm9sZGVyLmFkZChDLCAnU1BJTl9EUkFHJywgMC4wLCA1LjApLm5hbWUoJ1NwaW4gRGVjYXknKTsKICAgICAgICAgICAgcGh5c0ZvbGRlci5hZGQoQywgJ01BR05VU19DT0VGRicsIDAuMCwgNS4wKS5uYW1lKCdNYWdudXMgRWZmZWN0Jyk7CiAgICAgICAgICAgIHBoeXNGb2xkZXIuYWRkKEMsICdHUkFWSVRZX1NQUklORycsIDAuMCwgMjAuMCkubmFtZSgnVmVydCBTcHJpbmcnKTsKICAgICAgICAgICAgcGh5c0ZvbGRlci5hZGQoQywgJ0dSQVZJVFlfREFNUCcsIDAuMCwgMTAuMCkubmFtZSgnVmVydCBEYW1wJyk7CiAgICAgICAgICAgIHBoeXNGb2xkZXIuYWRkKEMsICdCT1VOREFSWV9SQURJVVMnLCAxMC4wLCAxMDAuMCkubmFtZSgnQXJlbmEgU2l6ZScpOwoKICAgICAgICAgICAgLy8gMi4gVGVsZXBvcnQgVG9vbHMKICAgICAgICAgICAgY29uc3QgdHBGb2xkZXIgPSBmb2xkZXIuYWRkRm9sZGVyKCdUZWxlcG9ydCBCYWxsJyk7CiAgICAgICAgICAgIGNvbnN0IHRwUGFyYW1zID0gewogICAgICAgICAgICAgICAgVG9DZW50ZXI6ICgpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBiID0gdGhpcy5nYW1lLmVudGl0aWVzLmJhbGw7CiAgICAgICAgICAgICAgICAgICAgaWYoYikgYi5yZXNldCgpOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIFRvQWN0aXZlUGxheWVyOiAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYiA9IHRoaXMuZ2FtZS5lbnRpdGllcy5iYWxsOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSB0aGlzLmdhbWUudGVhbXMuaG9tZS5hY3RpdmVQbGF5ZXI7CiAgICAgICAgICAgICAgICAgICAgaWYoYiAmJiBwKSBiLmdyYWIocCk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgVG9Ib21lR29hbDogKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLmdhbWUuZW50aXRpZXMuYmFsbDsKICAgICAgICAgICAgICAgICAgICBpZihiKSB7IGIuZHJvcCgpOyBiLm1lc2gucG9zaXRpb24uc2V0KDAsIDAsIDI1KTsgYi52ZWxvY2l0eS5zZXQoMCwwLDApOyB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgVG9Bd2F5R29hbDogKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLmdhbWUuZW50aXRpZXMuYmFsbDsKICAgICAgICAgICAgICAgICAgICBpZihiKSB7IGIuZHJvcCgpOyBiLm1lc2gucG9zaXRpb24uc2V0KDAsIDAsIC0yNSk7IGIudmVsb2NpdHkuc2V0KDAsMCwwKTsgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIFRvU2t5OiAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYiA9IHRoaXMuZ2FtZS5lbnRpdGllcy5iYWxsOwogICAgICAgICAgICAgICAgICAgIGlmKGIpIHsgYi5kcm9wKCk7IGIubWVzaC5wb3NpdGlvbi5zZXQoMCwgMTAsIDApOyBiLnZlbG9jaXR5LnNldCgwLDAsMCk7IH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgdHBGb2xkZXIuYWRkKHRwUGFyYW1zLCAnVG9DZW50ZXInKTsKICAgICAgICAgICAgdHBGb2xkZXIuYWRkKHRwUGFyYW1zLCAnVG9BY3RpdmVQbGF5ZXInKTsKICAgICAgICAgICAgdHBGb2xkZXIuYWRkKHRwUGFyYW1zLCAnVG9Ib21lR29hbCcpOwogICAgICAgICAgICB0cEZvbGRlci5hZGQodHBQYXJhbXMsICdUb0F3YXlHb2FsJyk7CiAgICAgICAgICAgIHRwRm9sZGVyLmFkZCh0cFBhcmFtcywgJ1RvU2t5Jyk7CgogICAgICAgICAgICAvLyAzLiBGb3JjZSBTaG9vdAogICAgICAgICAgICBjb25zdCBzaG9vdEZvbGRlciA9IGZvbGRlci5hZGRGb2xkZXIoJ0ZvcmNlIFNob290Jyk7CiAgICAgICAgICAgIGNvbnN0IHNob290UGFyYW1zID0gewogICAgICAgICAgICAgICAgUG93ZXI6IDIwLAogICAgICAgICAgICAgICAgQ3VydmU6IDAsCiAgICAgICAgICAgICAgICBTaG9vdEZvcndhcmQ6ICgpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBiID0gdGhpcy5nYW1lLmVudGl0aWVzLmJhbGw7CiAgICAgICAgICAgICAgICAgICAgaWYoYikgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBTaG9vdCB0b3dhcmRzIC1aIChIb21lIEF0dGFjayBEaXJlY3Rpb24pCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpciA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIC0xKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3BpbiA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIHNob290UGFyYW1zLkN1cnZlLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgYi5zaG9vdChkaXIsIHNob290UGFyYW1zLlBvd2VyLCAnU0gnLCBudWxsLCBzcGluKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgU2hvb3RCYWNrd2FyZDogKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLmdhbWUuZW50aXRpZXMuYmFsbDsKICAgICAgICAgICAgICAgICAgICBpZihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpciA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIDEpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzcGluID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgc2hvb3RQYXJhbXMuQ3VydmUsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBiLnNob290KGRpciwgc2hvb3RQYXJhbXMuUG93ZXIsICdTSCcsIG51bGwsIHNwaW4pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBTaG9vdFVwOiAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYiA9IHRoaXMuZ2FtZS5lbnRpdGllcy5iYWxsOwogICAgICAgICAgICAgICAgICAgIGlmKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlyID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMSwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGIuc2hvb3QoZGlyLCBzaG9vdFBhcmFtcy5Qb3dlciwgJ1BBJyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIFJhbmRvbUN1cnZlOiAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYiA9IHRoaXMuZ2FtZS5lbnRpdGllcy5iYWxsOwogICAgICAgICAgICAgICAgICAgIGlmKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlyID0gbmV3IFRIUkVFLlZlY3RvcjMoTWF0aC5yYW5kb20oKS0wLjUsIDAsIE1hdGgucmFuZG9tKCktMC41KS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3BpbiA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIChNYXRoLnJhbmRvbSgpLTAuNSkqMjAsIDApOwogICAgICAgICAgICAgICAgICAgICAgICBiLnNob290KGRpciwgc2hvb3RQYXJhbXMuUG93ZXIsICdTSCcsIG51bGwsIHNwaW4pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgc2hvb3RGb2xkZXIuYWRkKHNob290UGFyYW1zLCAnUG93ZXInLCA1LCA1MCk7CiAgICAgICAgICAgIHNob290Rm9sZGVyLmFkZChzaG9vdFBhcmFtcywgJ0N1cnZlJywgLTIwLCAyMCkubmFtZSgnU3BpbiBZJyk7CiAgICAgICAgICAgIHNob290Rm9sZGVyLmFkZChzaG9vdFBhcmFtcywgJ1Nob290Rm9yd2FyZCcpOwogICAgICAgICAgICBzaG9vdEZvbGRlci5hZGQoc2hvb3RQYXJhbXMsICdTaG9vdEJhY2t3YXJkJyk7CiAgICAgICAgICAgIHNob290Rm9sZGVyLmFkZChzaG9vdFBhcmFtcywgJ1Nob290VXAnKTsKICAgICAgICAgICAgc2hvb3RGb2xkZXIuYWRkKHNob290UGFyYW1zLCAnUmFuZG9tQ3VydmUnKTsKICAgICAgICB9CiAgICB9Cgp3aW5kb3cuZmx1eC5EZXZUb29scyA9IERldlRvb2xzOwoKICAgIERldlRvb2xzLnByb3RvdHlwZS5fc2V0dXBWaXN1YWxEZWJ1ZyA9IGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnN0IGZvbGRlciA9IHRoaXMuZ3VpLmFkZEZvbGRlcignVmlzdWFsIERlYnVnZ2luZycpOwogICAgICAgIGNvbnN0IGR2ID0gdGhpcy5nYW1lLmRlYnVnVmlzdWFsaXplcjsKICAgICAgICBpZiAoIWR2KSByZXR1cm47CgogICAgICAgIGNvbnN0IHBhcmFtcyA9IHsKICAgICAgICAgICAgZW5hYmxlZDogZHYuZW5hYmxlZCwKICAgICAgICAgICAgaGl0Ym94ZXM6IGR2LnNob3dIaXRib3hlcywKICAgICAgICAgICAgdmVjdG9yczogZHYuc2hvd1ZlY3RvcnMsCiAgICAgICAgICAgIGFpOiBkdi5zaG93QUkKICAgICAgICB9OwoKICAgICAgICBmb2xkZXIuYWRkKHBhcmFtcywgJ2VuYWJsZWQnKS5uYW1lKCdFbmFibGUgVmlzdWFsaXplcicpLm9uQ2hhbmdlKHYgPT4gZHYuZW5hYmxlZCA9IHYpOwogICAgICAgIGZvbGRlci5hZGQocGFyYW1zLCAnaGl0Ym94ZXMnKS5uYW1lKCdTaG93IEhpdGJveGVzJykub25DaGFuZ2UodiA9PiBkdi5zaG93SGl0Ym94ZXMgPSB2KTsKICAgICAgICBmb2xkZXIuYWRkKHBhcmFtcywgJ3ZlY3RvcnMnKS5uYW1lKCdTaG93IFZlY3RvcnMnKS5vbkNoYW5nZSh2ID0+IGR2LnNob3dWZWN0b3JzID0gdik7CiAgICAgICAgZm9sZGVyLmFkZChwYXJhbXMsICdhaScpLm5hbWUoJ1Nob3cgQUkgUGVyY2VwdGlvbicpLm9uQ2hhbmdlKHYgPT4gZHYuc2hvd0FJID0gdik7CiAgICB9OwoKICAgIERldlRvb2xzLnByb3RvdHlwZS5fc2V0dXBGWExhYiA9IGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnN0IGZvbGRlciA9IHRoaXMuZ3VpLmFkZEZvbGRlcignRlggTGFiICYgVUkgVGVzdCcpOwogICAgICAgIAogICAgICAgIGNvbnN0IGdldFRhcmdldFBvcyA9ICgpID0+IHsKICAgICAgICAgICAgY29uc3QgcCA9IHRoaXMuZ2FtZS50ZWFtcy5ob21lLmFjdGl2ZVBsYXllcjsKICAgICAgICAgICAgcmV0dXJuIHAgJiYgcC5tZXNoID8gcC5tZXNoLnBvc2l0aW9uIDogbmV3IFRIUkVFLlZlY3RvcjMoMCwgMiwgMCk7CiAgICAgICAgfTsKCiAgICAgICAgY29uc3QgZnhQYXJhbXMgPSB7CiAgICAgICAgICAgIFNwYXduVmVub206ICgpID0+IHRoaXMuZ2FtZS5wYXJ0aWNsZU1hbmFnZXIuc3Bhd24oJ3Zlbm9tJywgZ2V0VGFyZ2V0UG9zKCkpLAogICAgICAgICAgICBTcGF3bk5hcDogKCkgPT4gdGhpcy5nYW1lLnBhcnRpY2xlTWFuYWdlci5zcGF3bignbmFwJywgZ2V0VGFyZ2V0UG9zKCkpLAogICAgICAgICAgICBTcGF3bldpdGhlcjogKCkgPT4gdGhpcy5nYW1lLnBhcnRpY2xlTWFuYWdlci5zcGF3bignd2l0aGVyJywgZ2V0VGFyZ2V0UG9zKCkpLAogICAgICAgICAgICBTcGF3bkxlYXJuZWQ6ICgpID0+IHRoaXMuZ2FtZS5wYXJ0aWNsZU1hbmFnZXIuc3Bhd24oJ2xlYXJuZWQnLCBnZXRUYXJnZXRQb3MoKSksCiAgICAgICAgICAgIFNwYXduQ2xhc2g6ICgpID0+IHRoaXMuZ2FtZS5zcGF3bkNsYXNoKGdldFRhcmdldFBvcygpKSwKICAgICAgICB9OwoKICAgICAgICBjb25zdCBmeFN1YiA9IGZvbGRlci5hZGRGb2xkZXIoJ1BhcnRpY2xlcycpOwogICAgICAgIGZ4U3ViLmFkZChmeFBhcmFtcywgJ1NwYXduVmVub20nKTsKICAgICAgICBmeFN1Yi5hZGQoZnhQYXJhbXMsICdTcGF3bk5hcCcpOwogICAgICAgIGZ4U3ViLmFkZChmeFBhcmFtcywgJ1NwYXduV2l0aGVyJyk7CiAgICAgICAgZnhTdWIuYWRkKGZ4UGFyYW1zLCAnU3Bhd25MZWFybmVkJyk7CiAgICAgICAgZnhTdWIuYWRkKGZ4UGFyYW1zLCAnU3Bhd25DbGFzaCcpOwoKICAgICAgICBjb25zdCB0eHRQYXJhbXMgPSB7CiAgICAgICAgICAgIFRleHQ6ICJURVNUIiwKICAgICAgICAgICAgVHlwZTogImRhbWFnZSIsCiAgICAgICAgICAgIFNwYXduOiAoKSA9PiB7CiAgICAgICAgICAgICAgICBpZih0aGlzLmdhbWUuZmxvYXRpbmdUZXh0KSAKICAgICAgICAgICAgICAgICAgICB0aGlzLmdhbWUuZmxvYXRpbmdUZXh0LnNwYXduKHR4dFBhcmFtcy5UZXh0LCBnZXRUYXJnZXRQb3MoKSwgdHh0UGFyYW1zLlR5cGUpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICBjb25zdCB0eHRTdWIgPSBmb2xkZXIuYWRkRm9sZGVyKCdGbG9hdGluZyBUZXh0Jyk7CiAgICAgICAgdHh0U3ViLmFkZCh0eHRQYXJhbXMsICdUZXh0Jyk7CiAgICAgICAgdHh0U3ViLmFkZCh0eHRQYXJhbXMsICdUeXBlJywgWydkYW1hZ2UnLCAnaGVhbCcsICdzdGF0dXMnLCAndGVjaCcsICdjb21pYy1pbXBhY3QnLCAnY29taWMtYWN0aW9uJywgJ3NhdmUnLCAnYmxvY2snLCAnZGVmYXVsdCddKTsKICAgICAgICB0eHRTdWIuYWRkKHR4dFBhcmFtcywgJ1NwYXduJykubmFtZSgnU3Bhd24gVGV4dCcpOwoKICAgICAgICBjb25zdCBjYW1QYXJhbXMgPSB7CiAgICAgICAgICAgIFNoYWtlU21hbGw6ICgpID0+IHRoaXMuZ2FtZS5jYW1lcmFNYW5hZ2VyLmFkZFNoYWtlKDAuNSksCiAgICAgICAgICAgIFNoYWtlQmlnOiAoKSA9PiB0aGlzLmdhbWUuY2FtZXJhTWFuYWdlci5hZGRTaGFrZSgyLjApLAogICAgICAgICAgICBJbXBhY3RMaWdodDogKCkgPT4gdGhpcy5nYW1lLnRyaWdnZXJJbXBhY3QoMC4xLCAnZGVmYXVsdCcpLAogICAgICAgICAgICBJbXBhY3RIZWF2eTogKCkgPT4gdGhpcy5nYW1lLnRyaWdnZXJJbXBhY3QoMC4yLCAnaGVhdnknKSwKICAgICAgICAgICAgSW1wYWN0U2hhdHRlcjogKCkgPT4gdGhpcy5nYW1lLnRyaWdnZXJJbXBhY3QoMC40LCAnc2hhdHRlcicpLAogICAgICAgIH07CgogICAgICAgIGNvbnN0IGNhbVN1YiA9IGZvbGRlci5hZGRGb2xkZXIoJ0NhbWVyYSAmIEltcGFjdCcpOwogICAgICAgIGNhbVN1Yi5hZGQoY2FtUGFyYW1zLCAnU2hha2VTbWFsbCcpOwogICAgICAgIGNhbVN1Yi5hZGQoY2FtUGFyYW1zLCAnU2hha2VCaWcnKTsKICAgICAgICBjYW1TdWIuYWRkKGNhbVBhcmFtcywgJ0ltcGFjdExpZ2h0Jyk7CiAgICAgICAgY2FtU3ViLmFkZChjYW1QYXJhbXMsICdJbXBhY3RIZWF2eScpOwogICAgICAgIGNhbVN1Yi5hZGQoY2FtUGFyYW1zLCAnSW1wYWN0U2hhdHRlcicpOwogICAgfTsKCgpEZXZUb29scy5wcm90b3R5cGUuX3NldHVwVmlzdWFscyA9IGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnN0IGZvbGRlciA9IHRoaXMuZ3VpLmFkZEZvbGRlcignVmlzdWFsaXphdGlvbiBSb29tJyk7CiAgICAgICAgCiAgICAgICAgY29uc3Qgdml6UGFyYW1zID0gewogICAgICAgICAgICBhY3RpdmU6IGZhbHNlLAogICAgICAgICAgICBhc3NldDogJ1RpZHVzJywKICAgICAgICAgICAgc2NhbGU6IDEuMCwKICAgICAgICAgICAgYW5pbTogJ2lkbGUnLAogICAgICAgICAgICBzcGF3bjogKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLnZpekdyb3VwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy52aXpHcm91cCA9IG5ldyBUSFJFRS5Hcm91cCgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZ2FtZS5zY2VuZS5hZGQodGhpcy52aXpHcm91cCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBDbGVhciBwcmV2aW91cwogICAgICAgICAgICAgICAgd2hpbGUodGhpcy52aXpHcm91cC5jaGlsZHJlbi5sZW5ndGggPiAwKXsgCiAgICAgICAgICAgICAgICAgICAgdGhpcy52aXpHcm91cC5yZW1vdmUodGhpcy52aXpHcm91cC5jaGlsZHJlblswXSk7IAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCB1cmxNYXAgPSB7CiAgICAgICAgICAgICAgICAgICAgJ1RpZHVzJzogJ2h0dHBzOi8vY2RuLnRpbnlnbGIuY29tL21vZGVscy9kYTc4OGJlZjI1OGM0ZjBiOGQ5ZWYxYWNjMTljNTU2Ny5nbGInLAogICAgICAgICAgICAgICAgICAgICdXYWtrYSc6ICdodHRwczovL2Nkbi50aW55Z2xiLmNvbS9tb2RlbHMvNTkxMTRjOTg5NTE2NDdjOWI4ZGE3NGIwYmQzNjM2Y2IuZ2xiJywKICAgICAgICAgICAgICAgICAgICAnQmFsbCc6ICdodHRwczovL2Nkbi50aW55Z2xiLmNvbS9tb2RlbHMvNTIxYWU4Nzg4ZTU4NGUzNzhhNzlkOTczMmEwNzUzNTYuZ2xiJywKICAgICAgICAgICAgICAgICAgICAnR29hbCc6ICdodHRwczovL2Nkbi50aW55Z2xiLmNvbS9tb2RlbHMvYTUxNmJkOTBmYTdjNGRlZGI1ZGNiZmRmODAzZjEzZDUuZ2xiJwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgdXJsID0gdXJsTWFwW3ZpelBhcmFtcy5hc3NldF07CiAgICAgICAgICAgICAgICBpZih1cmwpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5Bc3NldExvYWRlci5sb2FkTW9kZWwodXJsLCAoZ2x0ZikgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtb2RlbCA9IGdsdGYuc2NlbmU7CiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsLnNjYWxlLnNldFNjYWxhcih2aXpQYXJhbXMuc2NhbGUpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZpekdyb3VwLmFkZChtb2RlbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZihnbHRmLmFuaW1hdGlvbnMgJiYgZ2x0Zi5hbmltYXRpb25zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudml6TWl4ZXIgPSBuZXcgVEhSRUUuQW5pbWF0aW9uTWl4ZXIobW9kZWwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVHJ5IHRvIGZpbmQgYW5pbWF0aW9uIGJ5IG5hbWUgb3IgZGVmYXVsdCB0byBmaXJzdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNsaXAgPSBUSFJFRS5BbmltYXRpb25DbGlwLmZpbmRCeU5hbWUoZ2x0Zi5hbmltYXRpb25zLCB2aXpQYXJhbXMuYW5pbSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWNsaXApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBGYWxsYmFjayBtYXBwaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbWFwID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaWRsZSc6IFsndHJlYWRpbmcnLCAnaWRsZSddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3dpbSc6IFsnc3dpbSddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndGhyb3cnOiBbJ3Rocm93J10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjYXRjaCc6IFsnY2F0Y2gnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JlYWN0JzogWydyZWFjdCcsICdoaXQnLCAnZGFtYWdlJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGtleXdvcmRzID0gbWFwW3ZpelBhcmFtcy5hbmltXSB8fCBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGlwID0gZ2x0Zi5hbmltYXRpb25zLmZpbmQoYSA9PiBrZXl3b3Jkcy5zb21lKGsgPT4gYS5uYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoaykpKSB8fCBnbHRmLmFuaW1hdGlvbnNbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjbGlwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52aXpNaXhlci5jbGlwQWN0aW9uKGNsaXApLnBsYXkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudml6TWl4ZXIgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRvZ2dsZVJvb206ICgpID0+IHsKICAgICAgICAgICAgICAgIHZpelBhcmFtcy5hY3RpdmUgPSAhdml6UGFyYW1zLmFjdGl2ZTsKICAgICAgICAgICAgICAgIGNvbnN0IGdhbWVMYXllciA9IFt0aGlzLmdhbWUudGVhbXMuaG9tZSwgdGhpcy5nYW1lLnRlYW1zLmF3YXksIHRoaXMuZ2FtZS5lbnRpdGllcy5iYWxsXTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gVG9nZ2xlIEdhbWUgVmlzaWJpbGl0eQogICAgICAgICAgICAgICAgZ2FtZUxheWVyLmZvckVhY2godCA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYodCAmJiB0LnBsYXllcnMpIHQucGxheWVycy5mb3JFYWNoKHAgPT4geyBpZihwLm1lc2gpIHAubWVzaC52aXNpYmxlID0gIXZpelBhcmFtcy5hY3RpdmU7IH0pOwogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYodCAmJiB0Lm1lc2gpIHQubWVzaC52aXNpYmxlID0gIXZpelBhcmFtcy5hY3RpdmU7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGlmKHdpbmRvdy5mbHV4LmFyZW5hTWVzaCkgd2luZG93LmZsdXguYXJlbmFNZXNoLnZpc2libGUgPSAhdml6UGFyYW1zLmFjdGl2ZTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYodml6UGFyYW1zLmFjdGl2ZSkgewogICAgICAgICAgICAgICAgICAgIC8vIE1vdmUgQ2FtZXJhIHRvIFZvaWQKICAgICAgICAgICAgICAgICAgICB0aGlzLmdhbWUuY2FtZXJhLnBvc2l0aW9uLnNldCgxMDAwLCA1LCAxMDEwKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmdhbWUuY2FtZXJhLmxvb2tBdCgxMDAwLCAyLCAxMDAwKTsKICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnZpekdyb3VwKSB0aGlzLnZpekdyb3VwLnBvc2l0aW9uLnNldCgxMDAwLCAwLCAxMDAwKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBBZGQgTGlnaHQgZm9yIFZpegogICAgICAgICAgICAgICAgICAgIGlmKCF0aGlzLnZpekxpZ2h0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudml6TGlnaHQgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCgweGZmZmZmZiwgMS4wKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52aXpMaWdodC5wb3NpdGlvbi5zZXQoMTAwNSwgMTAsIDEwMDUpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdhbWUuc2NlbmUuYWRkKHRoaXMudml6TGlnaHQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aGlzLnZpekxpZ2h0LnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFNwYXduIGluaXRpYWwKICAgICAgICAgICAgICAgICAgICB2aXpQYXJhbXMuc3Bhd24oKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gUmVzdG9yZSBDYW1lcmEKICAgICAgICAgICAgICAgICAgICBpZih0aGlzLmdhbWUuY2FtZXJhTWFuYWdlcikgdGhpcy5nYW1lLmNhbWVyYU1hbmFnZXIuc25hcFRvVGFyZ2V0KCk7CiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy52aXpMaWdodCkgdGhpcy52aXpMaWdodC52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIAogICAgICAgIGZvbGRlci5hZGQodml6UGFyYW1zLCAndG9nZ2xlUm9vbScpLm5hbWUoJ1RvZ2dsZSBSb29tJyk7CiAgICAgICAgZm9sZGVyLmFkZCh2aXpQYXJhbXMsICdhc3NldCcsIFsnVGlkdXMnLCAnV2Fra2EnLCAnQmFsbCcsICdHb2FsJ10pLm9uQ2hhbmdlKCgpID0+IHsgaWYodml6UGFyYW1zLmFjdGl2ZSkgdml6UGFyYW1zLnNwYXduKCk7IH0pOwogICAgICAgIGZvbGRlci5hZGQodml6UGFyYW1zLCAnc2NhbGUnLCAwLjEsIDUuMCkub25DaGFuZ2UodiA9PiB7CiAgICAgICAgICAgIGlmKHRoaXMudml6R3JvdXAgJiYgdGhpcy52aXpHcm91cC5jaGlsZHJlblswXSkgewogICAgICAgICAgICAgICAgdGhpcy52aXpHcm91cC5jaGlsZHJlblswXS5zY2FsZS5zZXRTY2FsYXIodik7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBmb2xkZXIuYWRkKHZpelBhcmFtcywgJ2FuaW0nLCBbJ2lkbGUnLCAnc3dpbScsICd0aHJvdycsICdjYXRjaCcsICdyZWFjdCddKS5uYW1lKCdBbmltYXRpb24nKS5vbkNoYW5nZSgoKSA9PiB7CiAgICAgICAgICAgICBpZih2aXpQYXJhbXMuYWN0aXZlKSB2aXpQYXJhbXMuc3Bhd24oKTsKICAgICAgICB9KTsKICAgICAgICBmb2xkZXIuYWRkKHZpelBhcmFtcywgJ3NwYXduJykubmFtZSgnUmVsb2FkIEFzc2V0Jyk7CiAgICAgICAgCiAgICAgICAgLy8gSG9vayBpbnRvIHVwZGF0ZSBsb29wIGZvciBtaXhlcgogICAgICAgIGNvbnN0IG9yaWdpbmFsVXBkYXRlID0gdGhpcy5nYW1lLnVwZGF0ZS5iaW5kKHRoaXMuZ2FtZSk7CiAgICAgICAgdGhpcy5nYW1lLnVwZGF0ZSA9IChkdCkgPT4gewogICAgICAgICAgICBvcmlnaW5hbFVwZGF0ZShkdCk7CiAgICAgICAgICAgIGlmICh2aXpQYXJhbXMuYWN0aXZlICYmIHRoaXMudml6TWl4ZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMudml6TWl4ZXIudXBkYXRlKGR0KTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9Owp9KSgpOw==","DebugVisualizer.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICBjbGFzcyBEZWJ1Z1Zpc3VhbGl6ZXIgewogICAgICAgIGNvbnN0cnVjdG9yKHNjZW5lKSB7CiAgICAgICAgICAgIHRoaXMuc2NlbmUgPSBzY2VuZTsKICAgICAgICAgICAgdGhpcy5lbmFibGVkID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuc2hvd0hpdGJveGVzID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuc2hvd1ZlY3RvcnMgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5zaG93QUkgPSBmYWxzZTsKCiAgICAgICAgICAgIHRoaXMudmlzdWFscyA9IG5ldyBNYXAoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIE1hdGVyaWFscwogICAgICAgICAgICB0aGlzLm1hdFRhY2tsZSA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7IGNvbG9yOiAweGZmMDAwMCwgd2lyZWZyYW1lOiB0cnVlLCB0cmFuc3BhcmVudDogdHJ1ZSwgb3BhY2l0eTogMC4yIH0pOwogICAgICAgICAgICB0aGlzLm1hdENhdGNoID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHsgY29sb3I6IDB4MDBmZjAwLCB3aXJlZnJhbWU6IHRydWUsIHRyYW5zcGFyZW50OiB0cnVlLCBvcGFjaXR5OiAwLjIgfSk7CiAgICAgICAgICAgIHRoaXMubWF0VmVsID0gbmV3IFRIUkVFLkxpbmVCYXNpY01hdGVyaWFsKHsgY29sb3I6IDB4ZmZmZjAwIH0pOyAvLyBZZWxsb3cgVmVsb2NpdHkKICAgICAgICAgICAgdGhpcy5tYXRJbnB1dCA9IG5ldyBUSFJFRS5MaW5lQmFzaWNNYXRlcmlhbCh7IGNvbG9yOiAweDAwZmZmZiB9KTsgLy8gQ3lhbiBJbnB1dAogICAgICAgICAgICB0aGlzLm1hdEFJID0gbmV3IFRIUkVFLkxpbmVCYXNpY01hdGVyaWFsKHsgY29sb3I6IDB4ZmYwMGZmIH0pOyAvLyBNYWdlbnRhIEFJIFBlcmNlcHRpb24KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEdlb21ldHJpZXMKICAgICAgICAgICAgdGhpcy5nZW9DeWxpbmRlciA9IG5ldyBUSFJFRS5DeWxpbmRlckdlb21ldHJ5KDEsIDEsIDAuMSwgMTYpOwogICAgICAgICAgICB0aGlzLmdlb0N5bGluZGVyLnRyYW5zbGF0ZSgwLCAwLjA1LCAwKTsKICAgICAgICB9CgogICAgICAgIHVwZGF0ZSgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLmVuYWJsZWQpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnZpc3VhbHMuc2l6ZSA+IDApIHRoaXMuY2xlYXIoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgZ2FtZSA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZTsKICAgICAgICAgICAgaWYgKCFnYW1lIHx8ICFnYW1lLnRlYW1zLmhvbWUpIHJldHVybjsKCiAgICAgICAgICAgIGNvbnN0IGVudGl0aWVzID0gWwogICAgICAgICAgICAgICAgLi4uZ2FtZS50ZWFtcy5ob21lLnBsYXllcnMsCiAgICAgICAgICAgICAgICAuLi5nYW1lLnRlYW1zLmF3YXkucGxheWVycywKICAgICAgICAgICAgICAgIGdhbWUuZW50aXRpZXMuYmFsbAogICAgICAgICAgICBdOwoKICAgICAgICAgICAgZW50aXRpZXMuZm9yRWFjaChlID0+IHsKICAgICAgICAgICAgICAgIGlmICghZSB8fCAhZS5tZXNoKSByZXR1cm47CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxldCB2ID0gdGhpcy52aXN1YWxzLmdldChlKTsKICAgICAgICAgICAgICAgIGlmICghdikgewogICAgICAgICAgICAgICAgICAgIHYgPSB0aGlzLmNyZWF0ZVZpc3VhbChlKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnZpc3VhbHMuc2V0KGUsIHYpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy51cGRhdGVWaXN1YWwoZSwgdik7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgY3JlYXRlVmlzdWFsKGVudGl0eSkgewogICAgICAgICAgICBjb25zdCBncm91cCA9IG5ldyBUSFJFRS5Hcm91cCgpOwogICAgICAgICAgICB0aGlzLnNjZW5lLmFkZChncm91cCk7CgogICAgICAgICAgICAvLyBIaXRib3hlcwogICAgICAgICAgICBjb25zdCB0YWNrbGUgPSBuZXcgVEhSRUUuTWVzaCh0aGlzLmdlb0N5bGluZGVyLCB0aGlzLm1hdFRhY2tsZSk7CiAgICAgICAgICAgIGNvbnN0IGNhdGNoUiA9IG5ldyBUSFJFRS5NZXNoKHRoaXMuZ2VvQ3lsaW5kZXIsIHRoaXMubWF0Q2F0Y2gpOwogICAgICAgICAgICBncm91cC5hZGQodGFja2xlKTsKICAgICAgICAgICAgZ3JvdXAuYWRkKGNhdGNoUik7CgogICAgICAgICAgICAvLyBMaW5lcwogICAgICAgICAgICBjb25zdCB2ZWxMaW5lID0gdGhpcy5jcmVhdGVMaW5lKHRoaXMubWF0VmVsKTsKICAgICAgICAgICAgY29uc3QgaW5wdXRMaW5lID0gdGhpcy5jcmVhdGVMaW5lKHRoaXMubWF0SW5wdXQpOwogICAgICAgICAgICBjb25zdCBhaUxpbmUgPSB0aGlzLmNyZWF0ZUxpbmUodGhpcy5tYXRBSSk7IC8vIExpbmUgdG8gcGVyY2VpdmVkIHRhcmdldAogICAgICAgICAgICAKICAgICAgICAgICAgZ3JvdXAuYWRkKHZlbExpbmUpOwogICAgICAgICAgICBncm91cC5hZGQoaW5wdXRMaW5lKTsKICAgICAgICAgICAgZ3JvdXAuYWRkKGFpTGluZSk7CgogICAgICAgICAgICByZXR1cm4geyBncm91cCwgdGFja2xlLCBjYXRjaFIsIHZlbExpbmUsIGlucHV0TGluZSwgYWlMaW5lIH07CiAgICAgICAgfQoKICAgICAgICBjcmVhdGVMaW5lKG1hdCkgewogICAgICAgICAgICBjb25zdCBnZW8gPSBuZXcgVEhSRUUuQnVmZmVyR2VvbWV0cnkoKS5zZXRGcm9tUG9pbnRzKFtuZXcgVEhSRUUuVmVjdG9yMygpLCBuZXcgVEhSRUUuVmVjdG9yMygpXSk7CiAgICAgICAgICAgIHJldHVybiBuZXcgVEhSRUUuTGluZShnZW8sIG1hdCk7CiAgICAgICAgfQoKICAgICAgICB1cGRhdGVMaW5lKGxpbmUsIHN0YXJ0LCBlbmQpIHsKICAgICAgICAgICAgY29uc3QgcG9zID0gbGluZS5nZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uLmFycmF5OwogICAgICAgICAgICBwb3NbMF0gPSBzdGFydC54OyBwb3NbMV0gPSBzdGFydC55OyBwb3NbMl0gPSBzdGFydC56OwogICAgICAgICAgICBwb3NbM10gPSBlbmQueDsgcG9zWzRdID0gZW5kLnk7IHBvc1s1XSA9IGVuZC56OwogICAgICAgICAgICBsaW5lLmdlb21ldHJ5LmF0dHJpYnV0ZXMucG9zaXRpb24ubmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICAgICAgICBsaW5lLnZpc2libGUgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgdXBkYXRlVmlzdWFsKGUsIHYpIHsKICAgICAgICAgICAgdi5ncm91cC52aXNpYmxlID0gdHJ1ZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEhpdGJveGVzIChMb2NhbCB0byBlbnRpdHkgcG9zaXRpb24pCiAgICAgICAgICAgIHYudGFja2xlLnBvc2l0aW9uLmNvcHkoZS5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgdi5jYXRjaFIucG9zaXRpb24uY29weShlLm1lc2gucG9zaXRpb24pOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHRoaXMuc2hvd0hpdGJveGVzICYmIGUucm9sZSkgewogICAgICAgICAgICAgICAgdi50YWNrbGUudmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgICAgICBjb25zdCByVCA9IGUudGFja2xlUmFkaXVzIHx8IDIuNTsKICAgICAgICAgICAgICAgIHYudGFja2xlLnNjYWxlLnNldChyVCwgMSwgclQpOwoKICAgICAgICAgICAgICAgIHYuY2F0Y2hSLnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgLy8gTG9naWMgZnJvbSBtYWluLmpzIGNoZWNrQmFsbEdyYWIKICAgICAgICAgICAgICAgIGNvbnN0IHJDID0gZS5pc0Rhc2hpbmcgPyA0LjAgOiAyLjU7IAogICAgICAgICAgICAgICAgdi5jYXRjaFIuc2NhbGUuc2V0KHJDLCAxLCByQyk7CiAgICAgICAgICAgICAgICB2LmNhdGNoUi5wb3NpdGlvbi55ID0gZS5tZXNoLnBvc2l0aW9uLnkgKyAwLjE7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2LnRhY2tsZS52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICB2LmNhdGNoUi52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFZlY3RvcnMgKEdsb2JhbCBsaW5lcykKICAgICAgICAgICAgY29uc3Qgb3JpZ2luID0gZS5tZXNoLnBvc2l0aW9uLmNsb25lKCk7CiAgICAgICAgICAgIG9yaWdpbi55ICs9IDEuMDsgLy8gTGlmdCB1cAoKICAgICAgICAgICAgaWYgKHRoaXMuc2hvd1ZlY3RvcnMpIHsKICAgICAgICAgICAgICAgIC8vIFZlbG9jaXR5CiAgICAgICAgICAgICAgICBpZiAoZS52ZWxvY2l0eSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVuZCA9IG9yaWdpbi5jbG9uZSgpLmFkZChlLnZlbG9jaXR5KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUxpbmUodi52ZWxMaW5lLCBvcmlnaW4sIGVuZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBJbnB1dAogICAgICAgICAgICAgICAgaWYgKGUuaW5wdXRWZWN0b3IgJiYgZS5pbnB1dFZlY3Rvci5sZW5ndGhTcSgpID4gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVuZCA9IG9yaWdpbi5jbG9uZSgpLmFkZChlLmlucHV0VmVjdG9yLmNsb25lKCkubXVsdGlwbHlTY2FsYXIoMy4wKSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVMaW5lKHYuaW5wdXRMaW5lLCBvcmlnaW4sIGVuZCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHYuaW5wdXRMaW5lLnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHYudmVsTGluZS52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICB2LmlucHV0TGluZS52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEFJCiAgICAgICAgICAgIGlmICh0aGlzLnNob3dBSSAmJiBlLnBlcmNlaXZlZFRhcmdldFBvcykgewogICAgICAgICAgICAgICAgLy8gRHJhdyBsaW5lIHRvIHBlcmNlaXZlZCB0YXJnZXQKICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlTGluZSh2LmFpTGluZSwgb3JpZ2luLCBlLnBlcmNlaXZlZFRhcmdldFBvcyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2LmFpTGluZS52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNsZWFyKCkgewogICAgICAgICAgICB0aGlzLnZpc3VhbHMuZm9yRWFjaCh2ID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuc2NlbmUucmVtb3ZlKHYuZ3JvdXApOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy52aXN1YWxzLmNsZWFyKCk7CiAgICAgICAgfQogICAgfQogICAgd2luZG93LmZsdXguRGVidWdWaXN1YWxpemVyID0gRGVidWdWaXN1YWxpemVyOwp9KSgpOw==","./DebugVisualizer.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICBjbGFzcyBEZWJ1Z1Zpc3VhbGl6ZXIgewogICAgICAgIGNvbnN0cnVjdG9yKHNjZW5lKSB7CiAgICAgICAgICAgIHRoaXMuc2NlbmUgPSBzY2VuZTsKICAgICAgICAgICAgdGhpcy5lbmFibGVkID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuc2hvd0hpdGJveGVzID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuc2hvd1ZlY3RvcnMgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5zaG93QUkgPSBmYWxzZTsKCiAgICAgICAgICAgIHRoaXMudmlzdWFscyA9IG5ldyBNYXAoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIE1hdGVyaWFscwogICAgICAgICAgICB0aGlzLm1hdFRhY2tsZSA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7IGNvbG9yOiAweGZmMDAwMCwgd2lyZWZyYW1lOiB0cnVlLCB0cmFuc3BhcmVudDogdHJ1ZSwgb3BhY2l0eTogMC4yIH0pOwogICAgICAgICAgICB0aGlzLm1hdENhdGNoID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHsgY29sb3I6IDB4MDBmZjAwLCB3aXJlZnJhbWU6IHRydWUsIHRyYW5zcGFyZW50OiB0cnVlLCBvcGFjaXR5OiAwLjIgfSk7CiAgICAgICAgICAgIHRoaXMubWF0VmVsID0gbmV3IFRIUkVFLkxpbmVCYXNpY01hdGVyaWFsKHsgY29sb3I6IDB4ZmZmZjAwIH0pOyAvLyBZZWxsb3cgVmVsb2NpdHkKICAgICAgICAgICAgdGhpcy5tYXRJbnB1dCA9IG5ldyBUSFJFRS5MaW5lQmFzaWNNYXRlcmlhbCh7IGNvbG9yOiAweDAwZmZmZiB9KTsgLy8gQ3lhbiBJbnB1dAogICAgICAgICAgICB0aGlzLm1hdEFJID0gbmV3IFRIUkVFLkxpbmVCYXNpY01hdGVyaWFsKHsgY29sb3I6IDB4ZmYwMGZmIH0pOyAvLyBNYWdlbnRhIEFJIFBlcmNlcHRpb24KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEdlb21ldHJpZXMKICAgICAgICAgICAgdGhpcy5nZW9DeWxpbmRlciA9IG5ldyBUSFJFRS5DeWxpbmRlckdlb21ldHJ5KDEsIDEsIDAuMSwgMTYpOwogICAgICAgICAgICB0aGlzLmdlb0N5bGluZGVyLnRyYW5zbGF0ZSgwLCAwLjA1LCAwKTsKICAgICAgICB9CgogICAgICAgIHVwZGF0ZSgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLmVuYWJsZWQpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnZpc3VhbHMuc2l6ZSA+IDApIHRoaXMuY2xlYXIoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgZ2FtZSA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZTsKICAgICAgICAgICAgaWYgKCFnYW1lIHx8ICFnYW1lLnRlYW1zLmhvbWUpIHJldHVybjsKCiAgICAgICAgICAgIGNvbnN0IGVudGl0aWVzID0gWwogICAgICAgICAgICAgICAgLi4uZ2FtZS50ZWFtcy5ob21lLnBsYXllcnMsCiAgICAgICAgICAgICAgICAuLi5nYW1lLnRlYW1zLmF3YXkucGxheWVycywKICAgICAgICAgICAgICAgIGdhbWUuZW50aXRpZXMuYmFsbAogICAgICAgICAgICBdOwoKICAgICAgICAgICAgZW50aXRpZXMuZm9yRWFjaChlID0+IHsKICAgICAgICAgICAgICAgIGlmICghZSB8fCAhZS5tZXNoKSByZXR1cm47CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxldCB2ID0gdGhpcy52aXN1YWxzLmdldChlKTsKICAgICAgICAgICAgICAgIGlmICghdikgewogICAgICAgICAgICAgICAgICAgIHYgPSB0aGlzLmNyZWF0ZVZpc3VhbChlKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnZpc3VhbHMuc2V0KGUsIHYpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy51cGRhdGVWaXN1YWwoZSwgdik7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgY3JlYXRlVmlzdWFsKGVudGl0eSkgewogICAgICAgICAgICBjb25zdCBncm91cCA9IG5ldyBUSFJFRS5Hcm91cCgpOwogICAgICAgICAgICB0aGlzLnNjZW5lLmFkZChncm91cCk7CgogICAgICAgICAgICAvLyBIaXRib3hlcwogICAgICAgICAgICBjb25zdCB0YWNrbGUgPSBuZXcgVEhSRUUuTWVzaCh0aGlzLmdlb0N5bGluZGVyLCB0aGlzLm1hdFRhY2tsZSk7CiAgICAgICAgICAgIGNvbnN0IGNhdGNoUiA9IG5ldyBUSFJFRS5NZXNoKHRoaXMuZ2VvQ3lsaW5kZXIsIHRoaXMubWF0Q2F0Y2gpOwogICAgICAgICAgICBncm91cC5hZGQodGFja2xlKTsKICAgICAgICAgICAgZ3JvdXAuYWRkKGNhdGNoUik7CgogICAgICAgICAgICAvLyBMaW5lcwogICAgICAgICAgICBjb25zdCB2ZWxMaW5lID0gdGhpcy5jcmVhdGVMaW5lKHRoaXMubWF0VmVsKTsKICAgICAgICAgICAgY29uc3QgaW5wdXRMaW5lID0gdGhpcy5jcmVhdGVMaW5lKHRoaXMubWF0SW5wdXQpOwogICAgICAgICAgICBjb25zdCBhaUxpbmUgPSB0aGlzLmNyZWF0ZUxpbmUodGhpcy5tYXRBSSk7IC8vIExpbmUgdG8gcGVyY2VpdmVkIHRhcmdldAogICAgICAgICAgICAKICAgICAgICAgICAgZ3JvdXAuYWRkKHZlbExpbmUpOwogICAgICAgICAgICBncm91cC5hZGQoaW5wdXRMaW5lKTsKICAgICAgICAgICAgZ3JvdXAuYWRkKGFpTGluZSk7CgogICAgICAgICAgICByZXR1cm4geyBncm91cCwgdGFja2xlLCBjYXRjaFIsIHZlbExpbmUsIGlucHV0TGluZSwgYWlMaW5lIH07CiAgICAgICAgfQoKICAgICAgICBjcmVhdGVMaW5lKG1hdCkgewogICAgICAgICAgICBjb25zdCBnZW8gPSBuZXcgVEhSRUUuQnVmZmVyR2VvbWV0cnkoKS5zZXRGcm9tUG9pbnRzKFtuZXcgVEhSRUUuVmVjdG9yMygpLCBuZXcgVEhSRUUuVmVjdG9yMygpXSk7CiAgICAgICAgICAgIHJldHVybiBuZXcgVEhSRUUuTGluZShnZW8sIG1hdCk7CiAgICAgICAgfQoKICAgICAgICB1cGRhdGVMaW5lKGxpbmUsIHN0YXJ0LCBlbmQpIHsKICAgICAgICAgICAgY29uc3QgcG9zID0gbGluZS5nZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uLmFycmF5OwogICAgICAgICAgICBwb3NbMF0gPSBzdGFydC54OyBwb3NbMV0gPSBzdGFydC55OyBwb3NbMl0gPSBzdGFydC56OwogICAgICAgICAgICBwb3NbM10gPSBlbmQueDsgcG9zWzRdID0gZW5kLnk7IHBvc1s1XSA9IGVuZC56OwogICAgICAgICAgICBsaW5lLmdlb21ldHJ5LmF0dHJpYnV0ZXMucG9zaXRpb24ubmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICAgICAgICBsaW5lLnZpc2libGUgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgdXBkYXRlVmlzdWFsKGUsIHYpIHsKICAgICAgICAgICAgdi5ncm91cC52aXNpYmxlID0gdHJ1ZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEhpdGJveGVzIChMb2NhbCB0byBlbnRpdHkgcG9zaXRpb24pCiAgICAgICAgICAgIHYudGFja2xlLnBvc2l0aW9uLmNvcHkoZS5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgdi5jYXRjaFIucG9zaXRpb24uY29weShlLm1lc2gucG9zaXRpb24pOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHRoaXMuc2hvd0hpdGJveGVzICYmIGUucm9sZSkgewogICAgICAgICAgICAgICAgdi50YWNrbGUudmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgICAgICBjb25zdCByVCA9IGUudGFja2xlUmFkaXVzIHx8IDIuNTsKICAgICAgICAgICAgICAgIHYudGFja2xlLnNjYWxlLnNldChyVCwgMSwgclQpOwoKICAgICAgICAgICAgICAgIHYuY2F0Y2hSLnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgLy8gTG9naWMgZnJvbSBtYWluLmpzIGNoZWNrQmFsbEdyYWIKICAgICAgICAgICAgICAgIGNvbnN0IHJDID0gZS5pc0Rhc2hpbmcgPyA0LjAgOiAyLjU7IAogICAgICAgICAgICAgICAgdi5jYXRjaFIuc2NhbGUuc2V0KHJDLCAxLCByQyk7CiAgICAgICAgICAgICAgICB2LmNhdGNoUi5wb3NpdGlvbi55ID0gZS5tZXNoLnBvc2l0aW9uLnkgKyAwLjE7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2LnRhY2tsZS52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICB2LmNhdGNoUi52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFZlY3RvcnMgKEdsb2JhbCBsaW5lcykKICAgICAgICAgICAgY29uc3Qgb3JpZ2luID0gZS5tZXNoLnBvc2l0aW9uLmNsb25lKCk7CiAgICAgICAgICAgIG9yaWdpbi55ICs9IDEuMDsgLy8gTGlmdCB1cAoKICAgICAgICAgICAgaWYgKHRoaXMuc2hvd1ZlY3RvcnMpIHsKICAgICAgICAgICAgICAgIC8vIFZlbG9jaXR5CiAgICAgICAgICAgICAgICBpZiAoZS52ZWxvY2l0eSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVuZCA9IG9yaWdpbi5jbG9uZSgpLmFkZChlLnZlbG9jaXR5KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUxpbmUodi52ZWxMaW5lLCBvcmlnaW4sIGVuZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBJbnB1dAogICAgICAgICAgICAgICAgaWYgKGUuaW5wdXRWZWN0b3IgJiYgZS5pbnB1dFZlY3Rvci5sZW5ndGhTcSgpID4gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVuZCA9IG9yaWdpbi5jbG9uZSgpLmFkZChlLmlucHV0VmVjdG9yLmNsb25lKCkubXVsdGlwbHlTY2FsYXIoMy4wKSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVMaW5lKHYuaW5wdXRMaW5lLCBvcmlnaW4sIGVuZCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHYuaW5wdXRMaW5lLnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHYudmVsTGluZS52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICB2LmlucHV0TGluZS52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEFJCiAgICAgICAgICAgIGlmICh0aGlzLnNob3dBSSAmJiBlLnBlcmNlaXZlZFRhcmdldFBvcykgewogICAgICAgICAgICAgICAgLy8gRHJhdyBsaW5lIHRvIHBlcmNlaXZlZCB0YXJnZXQKICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlTGluZSh2LmFpTGluZSwgb3JpZ2luLCBlLnBlcmNlaXZlZFRhcmdldFBvcyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2LmFpTGluZS52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNsZWFyKCkgewogICAgICAgICAgICB0aGlzLnZpc3VhbHMuZm9yRWFjaCh2ID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuc2NlbmUucmVtb3ZlKHYuZ3JvdXApOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy52aXN1YWxzLmNsZWFyKCk7CiAgICAgICAgfQogICAgfQogICAgd2luZG93LmZsdXguRGVidWdWaXN1YWxpemVyID0gRGVidWdWaXN1YWxpemVyOwp9KSgpOw==","/DebugVisualizer.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICBjbGFzcyBEZWJ1Z1Zpc3VhbGl6ZXIgewogICAgICAgIGNvbnN0cnVjdG9yKHNjZW5lKSB7CiAgICAgICAgICAgIHRoaXMuc2NlbmUgPSBzY2VuZTsKICAgICAgICAgICAgdGhpcy5lbmFibGVkID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuc2hvd0hpdGJveGVzID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuc2hvd1ZlY3RvcnMgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5zaG93QUkgPSBmYWxzZTsKCiAgICAgICAgICAgIHRoaXMudmlzdWFscyA9IG5ldyBNYXAoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIE1hdGVyaWFscwogICAgICAgICAgICB0aGlzLm1hdFRhY2tsZSA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7IGNvbG9yOiAweGZmMDAwMCwgd2lyZWZyYW1lOiB0cnVlLCB0cmFuc3BhcmVudDogdHJ1ZSwgb3BhY2l0eTogMC4yIH0pOwogICAgICAgICAgICB0aGlzLm1hdENhdGNoID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHsgY29sb3I6IDB4MDBmZjAwLCB3aXJlZnJhbWU6IHRydWUsIHRyYW5zcGFyZW50OiB0cnVlLCBvcGFjaXR5OiAwLjIgfSk7CiAgICAgICAgICAgIHRoaXMubWF0VmVsID0gbmV3IFRIUkVFLkxpbmVCYXNpY01hdGVyaWFsKHsgY29sb3I6IDB4ZmZmZjAwIH0pOyAvLyBZZWxsb3cgVmVsb2NpdHkKICAgICAgICAgICAgdGhpcy5tYXRJbnB1dCA9IG5ldyBUSFJFRS5MaW5lQmFzaWNNYXRlcmlhbCh7IGNvbG9yOiAweDAwZmZmZiB9KTsgLy8gQ3lhbiBJbnB1dAogICAgICAgICAgICB0aGlzLm1hdEFJID0gbmV3IFRIUkVFLkxpbmVCYXNpY01hdGVyaWFsKHsgY29sb3I6IDB4ZmYwMGZmIH0pOyAvLyBNYWdlbnRhIEFJIFBlcmNlcHRpb24KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEdlb21ldHJpZXMKICAgICAgICAgICAgdGhpcy5nZW9DeWxpbmRlciA9IG5ldyBUSFJFRS5DeWxpbmRlckdlb21ldHJ5KDEsIDEsIDAuMSwgMTYpOwogICAgICAgICAgICB0aGlzLmdlb0N5bGluZGVyLnRyYW5zbGF0ZSgwLCAwLjA1LCAwKTsKICAgICAgICB9CgogICAgICAgIHVwZGF0ZSgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLmVuYWJsZWQpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnZpc3VhbHMuc2l6ZSA+IDApIHRoaXMuY2xlYXIoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgZ2FtZSA9IHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZTsKICAgICAgICAgICAgaWYgKCFnYW1lIHx8ICFnYW1lLnRlYW1zLmhvbWUpIHJldHVybjsKCiAgICAgICAgICAgIGNvbnN0IGVudGl0aWVzID0gWwogICAgICAgICAgICAgICAgLi4uZ2FtZS50ZWFtcy5ob21lLnBsYXllcnMsCiAgICAgICAgICAgICAgICAuLi5nYW1lLnRlYW1zLmF3YXkucGxheWVycywKICAgICAgICAgICAgICAgIGdhbWUuZW50aXRpZXMuYmFsbAogICAgICAgICAgICBdOwoKICAgICAgICAgICAgZW50aXRpZXMuZm9yRWFjaChlID0+IHsKICAgICAgICAgICAgICAgIGlmICghZSB8fCAhZS5tZXNoKSByZXR1cm47CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxldCB2ID0gdGhpcy52aXN1YWxzLmdldChlKTsKICAgICAgICAgICAgICAgIGlmICghdikgewogICAgICAgICAgICAgICAgICAgIHYgPSB0aGlzLmNyZWF0ZVZpc3VhbChlKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnZpc3VhbHMuc2V0KGUsIHYpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy51cGRhdGVWaXN1YWwoZSwgdik7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgY3JlYXRlVmlzdWFsKGVudGl0eSkgewogICAgICAgICAgICBjb25zdCBncm91cCA9IG5ldyBUSFJFRS5Hcm91cCgpOwogICAgICAgICAgICB0aGlzLnNjZW5lLmFkZChncm91cCk7CgogICAgICAgICAgICAvLyBIaXRib3hlcwogICAgICAgICAgICBjb25zdCB0YWNrbGUgPSBuZXcgVEhSRUUuTWVzaCh0aGlzLmdlb0N5bGluZGVyLCB0aGlzLm1hdFRhY2tsZSk7CiAgICAgICAgICAgIGNvbnN0IGNhdGNoUiA9IG5ldyBUSFJFRS5NZXNoKHRoaXMuZ2VvQ3lsaW5kZXIsIHRoaXMubWF0Q2F0Y2gpOwogICAgICAgICAgICBncm91cC5hZGQodGFja2xlKTsKICAgICAgICAgICAgZ3JvdXAuYWRkKGNhdGNoUik7CgogICAgICAgICAgICAvLyBMaW5lcwogICAgICAgICAgICBjb25zdCB2ZWxMaW5lID0gdGhpcy5jcmVhdGVMaW5lKHRoaXMubWF0VmVsKTsKICAgICAgICAgICAgY29uc3QgaW5wdXRMaW5lID0gdGhpcy5jcmVhdGVMaW5lKHRoaXMubWF0SW5wdXQpOwogICAgICAgICAgICBjb25zdCBhaUxpbmUgPSB0aGlzLmNyZWF0ZUxpbmUodGhpcy5tYXRBSSk7IC8vIExpbmUgdG8gcGVyY2VpdmVkIHRhcmdldAogICAgICAgICAgICAKICAgICAgICAgICAgZ3JvdXAuYWRkKHZlbExpbmUpOwogICAgICAgICAgICBncm91cC5hZGQoaW5wdXRMaW5lKTsKICAgICAgICAgICAgZ3JvdXAuYWRkKGFpTGluZSk7CgogICAgICAgICAgICByZXR1cm4geyBncm91cCwgdGFja2xlLCBjYXRjaFIsIHZlbExpbmUsIGlucHV0TGluZSwgYWlMaW5lIH07CiAgICAgICAgfQoKICAgICAgICBjcmVhdGVMaW5lKG1hdCkgewogICAgICAgICAgICBjb25zdCBnZW8gPSBuZXcgVEhSRUUuQnVmZmVyR2VvbWV0cnkoKS5zZXRGcm9tUG9pbnRzKFtuZXcgVEhSRUUuVmVjdG9yMygpLCBuZXcgVEhSRUUuVmVjdG9yMygpXSk7CiAgICAgICAgICAgIHJldHVybiBuZXcgVEhSRUUuTGluZShnZW8sIG1hdCk7CiAgICAgICAgfQoKICAgICAgICB1cGRhdGVMaW5lKGxpbmUsIHN0YXJ0LCBlbmQpIHsKICAgICAgICAgICAgY29uc3QgcG9zID0gbGluZS5nZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uLmFycmF5OwogICAgICAgICAgICBwb3NbMF0gPSBzdGFydC54OyBwb3NbMV0gPSBzdGFydC55OyBwb3NbMl0gPSBzdGFydC56OwogICAgICAgICAgICBwb3NbM10gPSBlbmQueDsgcG9zWzRdID0gZW5kLnk7IHBvc1s1XSA9IGVuZC56OwogICAgICAgICAgICBsaW5lLmdlb21ldHJ5LmF0dHJpYnV0ZXMucG9zaXRpb24ubmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICAgICAgICBsaW5lLnZpc2libGUgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgdXBkYXRlVmlzdWFsKGUsIHYpIHsKICAgICAgICAgICAgdi5ncm91cC52aXNpYmxlID0gdHJ1ZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEhpdGJveGVzIChMb2NhbCB0byBlbnRpdHkgcG9zaXRpb24pCiAgICAgICAgICAgIHYudGFja2xlLnBvc2l0aW9uLmNvcHkoZS5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgdi5jYXRjaFIucG9zaXRpb24uY29weShlLm1lc2gucG9zaXRpb24pOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHRoaXMuc2hvd0hpdGJveGVzICYmIGUucm9sZSkgewogICAgICAgICAgICAgICAgdi50YWNrbGUudmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgICAgICBjb25zdCByVCA9IGUudGFja2xlUmFkaXVzIHx8IDIuNTsKICAgICAgICAgICAgICAgIHYudGFja2xlLnNjYWxlLnNldChyVCwgMSwgclQpOwoKICAgICAgICAgICAgICAgIHYuY2F0Y2hSLnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgLy8gTG9naWMgZnJvbSBtYWluLmpzIGNoZWNrQmFsbEdyYWIKICAgICAgICAgICAgICAgIGNvbnN0IHJDID0gZS5pc0Rhc2hpbmcgPyA0LjAgOiAyLjU7IAogICAgICAgICAgICAgICAgdi5jYXRjaFIuc2NhbGUuc2V0KHJDLCAxLCByQyk7CiAgICAgICAgICAgICAgICB2LmNhdGNoUi5wb3NpdGlvbi55ID0gZS5tZXNoLnBvc2l0aW9uLnkgKyAwLjE7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2LnRhY2tsZS52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICB2LmNhdGNoUi52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFZlY3RvcnMgKEdsb2JhbCBsaW5lcykKICAgICAgICAgICAgY29uc3Qgb3JpZ2luID0gZS5tZXNoLnBvc2l0aW9uLmNsb25lKCk7CiAgICAgICAgICAgIG9yaWdpbi55ICs9IDEuMDsgLy8gTGlmdCB1cAoKICAgICAgICAgICAgaWYgKHRoaXMuc2hvd1ZlY3RvcnMpIHsKICAgICAgICAgICAgICAgIC8vIFZlbG9jaXR5CiAgICAgICAgICAgICAgICBpZiAoZS52ZWxvY2l0eSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVuZCA9IG9yaWdpbi5jbG9uZSgpLmFkZChlLnZlbG9jaXR5KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUxpbmUodi52ZWxMaW5lLCBvcmlnaW4sIGVuZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBJbnB1dAogICAgICAgICAgICAgICAgaWYgKGUuaW5wdXRWZWN0b3IgJiYgZS5pbnB1dFZlY3Rvci5sZW5ndGhTcSgpID4gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVuZCA9IG9yaWdpbi5jbG9uZSgpLmFkZChlLmlucHV0VmVjdG9yLmNsb25lKCkubXVsdGlwbHlTY2FsYXIoMy4wKSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVMaW5lKHYuaW5wdXRMaW5lLCBvcmlnaW4sIGVuZCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHYuaW5wdXRMaW5lLnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHYudmVsTGluZS52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICB2LmlucHV0TGluZS52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEFJCiAgICAgICAgICAgIGlmICh0aGlzLnNob3dBSSAmJiBlLnBlcmNlaXZlZFRhcmdldFBvcykgewogICAgICAgICAgICAgICAgLy8gRHJhdyBsaW5lIHRvIHBlcmNlaXZlZCB0YXJnZXQKICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlTGluZSh2LmFpTGluZSwgb3JpZ2luLCBlLnBlcmNlaXZlZFRhcmdldFBvcyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2LmFpTGluZS52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNsZWFyKCkgewogICAgICAgICAgICB0aGlzLnZpc3VhbHMuZm9yRWFjaCh2ID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuc2NlbmUucmVtb3ZlKHYuZ3JvdXApOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy52aXN1YWxzLmNsZWFyKCk7CiAgICAgICAgfQogICAgfQogICAgd2luZG93LmZsdXguRGVidWdWaXN1YWxpemVyID0gRGVidWdWaXN1YWxpemVyOwp9KSgpOw==","MenuManager.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICBjbGFzcyBNZW51TWFuYWdlciB7CiAgICAgICAgY29uc3RydWN0b3IoZ2FtZU1hbmFnZXIpIHsKICAgICAgICAgICAgdGhpcy5nYW1lID0gZ2FtZU1hbmFnZXI7CiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW4tbWVudScpOwogICAgICAgICAgICB0aGlzLml0ZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1lbnUtaXRlbScpOwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5zZXR1cEV2ZW50cygpOwogICAgICAgIH0KCiAgICAgICAgc2V0dXBFdmVudHMoKSB7CiAgICAgICAgICAgIHRoaXMuaXRlbXMuZm9yRWFjaChpdGVtID0+IHsKICAgICAgICAgICAgICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7IC8vIFByZXZlbnQgY2xpY2stdGhyb3VnaAogICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlU2VsZWN0aW9uKGl0ZW0uZGF0YXNldC5hY3Rpb24pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsICgpID0+IHsKICAgICAgICAgICAgICAgICAgICAvLyBPcHRpb25hbDogUGxheSBob3ZlciBzb3VuZAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaGFuZGxlU2VsZWN0aW9uKGFjdGlvbikgewogICAgICAgICAgICBjb25zb2xlLmxvZygiTWVudSBTZWxlY3Rpb246IiwgYWN0aW9uKTsKICAgICAgICAgICAgaWYgKGFjdGlvbiA9PT0gJ25vcm1hbCcpIHsKICAgICAgICAgICAgICAgIHRoaXMuaGlkZSgpOwogICAgICAgICAgICAgICAgdGhpcy5nYW1lLnN0YXJ0TWF0Y2goJ25vcm1hbCcpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PT0gJ3ByYWN0aWNlJykgewogICAgICAgICAgICAgICAgdGhpcy5oaWRlKCk7CiAgICAgICAgICAgICAgICB0aGlzLmdhbWUuc3RhcnRNYXRjaCgncHJhY3RpY2UnKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24gPT09ICdvcHRpb25zJykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIk9wdGlvbnMgY2xpY2tlZCAoTm90IGltcGxlbWVudGVkKSIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBzaG93KCkgewogICAgICAgICAgICBpZiAodGhpcy5jb250YWluZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgdGhpcy5nYW1lLnNldE1lbnVNb2RlKHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBoaWRlKCkgewogICAgICAgICAgICBpZiAodGhpcy5jb250YWluZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgdGhpcy5nYW1lLnNldE1lbnVNb2RlKGZhbHNlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICB3aW5kb3cuZmx1eC5NZW51TWFuYWdlciA9IE1lbnVNYW5hZ2VyOwp9KSgpOw==","./MenuManager.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICBjbGFzcyBNZW51TWFuYWdlciB7CiAgICAgICAgY29uc3RydWN0b3IoZ2FtZU1hbmFnZXIpIHsKICAgICAgICAgICAgdGhpcy5nYW1lID0gZ2FtZU1hbmFnZXI7CiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW4tbWVudScpOwogICAgICAgICAgICB0aGlzLml0ZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1lbnUtaXRlbScpOwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5zZXR1cEV2ZW50cygpOwogICAgICAgIH0KCiAgICAgICAgc2V0dXBFdmVudHMoKSB7CiAgICAgICAgICAgIHRoaXMuaXRlbXMuZm9yRWFjaChpdGVtID0+IHsKICAgICAgICAgICAgICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7IC8vIFByZXZlbnQgY2xpY2stdGhyb3VnaAogICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlU2VsZWN0aW9uKGl0ZW0uZGF0YXNldC5hY3Rpb24pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsICgpID0+IHsKICAgICAgICAgICAgICAgICAgICAvLyBPcHRpb25hbDogUGxheSBob3ZlciBzb3VuZAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaGFuZGxlU2VsZWN0aW9uKGFjdGlvbikgewogICAgICAgICAgICBjb25zb2xlLmxvZygiTWVudSBTZWxlY3Rpb246IiwgYWN0aW9uKTsKICAgICAgICAgICAgaWYgKGFjdGlvbiA9PT0gJ25vcm1hbCcpIHsKICAgICAgICAgICAgICAgIHRoaXMuaGlkZSgpOwogICAgICAgICAgICAgICAgdGhpcy5nYW1lLnN0YXJ0TWF0Y2goJ25vcm1hbCcpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PT0gJ3ByYWN0aWNlJykgewogICAgICAgICAgICAgICAgdGhpcy5oaWRlKCk7CiAgICAgICAgICAgICAgICB0aGlzLmdhbWUuc3RhcnRNYXRjaCgncHJhY3RpY2UnKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24gPT09ICdvcHRpb25zJykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIk9wdGlvbnMgY2xpY2tlZCAoTm90IGltcGxlbWVudGVkKSIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBzaG93KCkgewogICAgICAgICAgICBpZiAodGhpcy5jb250YWluZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgdGhpcy5nYW1lLnNldE1lbnVNb2RlKHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBoaWRlKCkgewogICAgICAgICAgICBpZiAodGhpcy5jb250YWluZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgdGhpcy5nYW1lLnNldE1lbnVNb2RlKGZhbHNlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICB3aW5kb3cuZmx1eC5NZW51TWFuYWdlciA9IE1lbnVNYW5hZ2VyOwp9KSgpOw==","/MenuManager.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICBjbGFzcyBNZW51TWFuYWdlciB7CiAgICAgICAgY29uc3RydWN0b3IoZ2FtZU1hbmFnZXIpIHsKICAgICAgICAgICAgdGhpcy5nYW1lID0gZ2FtZU1hbmFnZXI7CiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW4tbWVudScpOwogICAgICAgICAgICB0aGlzLml0ZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1lbnUtaXRlbScpOwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5zZXR1cEV2ZW50cygpOwogICAgICAgIH0KCiAgICAgICAgc2V0dXBFdmVudHMoKSB7CiAgICAgICAgICAgIHRoaXMuaXRlbXMuZm9yRWFjaChpdGVtID0+IHsKICAgICAgICAgICAgICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7IC8vIFByZXZlbnQgY2xpY2stdGhyb3VnaAogICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlU2VsZWN0aW9uKGl0ZW0uZGF0YXNldC5hY3Rpb24pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsICgpID0+IHsKICAgICAgICAgICAgICAgICAgICAvLyBPcHRpb25hbDogUGxheSBob3ZlciBzb3VuZAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaGFuZGxlU2VsZWN0aW9uKGFjdGlvbikgewogICAgICAgICAgICBjb25zb2xlLmxvZygiTWVudSBTZWxlY3Rpb246IiwgYWN0aW9uKTsKICAgICAgICAgICAgaWYgKGFjdGlvbiA9PT0gJ25vcm1hbCcpIHsKICAgICAgICAgICAgICAgIHRoaXMuaGlkZSgpOwogICAgICAgICAgICAgICAgdGhpcy5nYW1lLnN0YXJ0TWF0Y2goJ25vcm1hbCcpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PT0gJ3ByYWN0aWNlJykgewogICAgICAgICAgICAgICAgdGhpcy5oaWRlKCk7CiAgICAgICAgICAgICAgICB0aGlzLmdhbWUuc3RhcnRNYXRjaCgncHJhY3RpY2UnKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24gPT09ICdvcHRpb25zJykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIk9wdGlvbnMgY2xpY2tlZCAoTm90IGltcGxlbWVudGVkKSIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBzaG93KCkgewogICAgICAgICAgICBpZiAodGhpcy5jb250YWluZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgdGhpcy5nYW1lLnNldE1lbnVNb2RlKHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBoaWRlKCkgewogICAgICAgICAgICBpZiAodGhpcy5jb250YWluZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgdGhpcy5nYW1lLnNldE1lbnVNb2RlKGZhbHNlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICB3aW5kb3cuZmx1eC5NZW51TWFuYWdlciA9IE1lbnVNYW5hZ2VyOwp9KSgpOw==","PracticeManager.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICBjbGFzcyBQcmFjdGljZU1hbmFnZXIgewogICAgICAgIGNvbnN0cnVjdG9yKGdhbWVNYW5hZ2VyKSB7CiAgICAgICAgICAgIHRoaXMuZ2FtZSA9IGdhbWVNYW5hZ2VyOwogICAgICAgICAgICB0aGlzLmlzUnVubmluZyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmN1cnJlbnREcmlsbCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuZHJpbGxTdGF0ZSA9IHt9OyAKICAgICAgICAgICAgCiAgICAgICAgICAgIHRoaXMuZHJpbGxzID0gewogICAgICAgICAgICAgICAgJ2ZyZWUnOiB7IG5hbWU6ICdGUkVFIFJPQU0nLCBzZXR1cDogdGhpcy5fc2V0dXBGcmVlLmJpbmQodGhpcyksIGxvb3A6IHRoaXMuX2xvb3BGcmVlLmJpbmQodGhpcykgfSwKICAgICAgICAgICAgICAgICdzaG9vdGluZyc6IHsgbmFtZTogJ1NIT09USU5HIERSSUxMJywgc2V0dXA6IHRoaXMuX3NldHVwU2hvb3RpbmcuYmluZCh0aGlzKSwgbG9vcDogdGhpcy5fbG9vcFNob290aW5nLmJpbmQodGhpcykgfSwKICAgICAgICAgICAgICAgICdwYXNzaW5nJzogeyBuYW1lOiAnUEFTU0lORyBEUklMTCcsIHNldHVwOiB0aGlzLl9zZXR1cFBhc3NpbmcuYmluZCh0aGlzKSwgbG9vcDogdGhpcy5fbG9vcFBhc3NpbmcuYmluZCh0aGlzKSB9LAogICAgICAgICAgICAgICAgJ2RlZmVuc2UnOiB7IG5hbWU6ICdERUZFTlNFIERSSUxMJywgc2V0dXA6IHRoaXMuX3NldHVwRGVmZW5zZS5iaW5kKHRoaXMpLCBsb29wOiB0aGlzLl9sb29wRGVmZW5zZS5iaW5kKHRoaXMpIH0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHRoaXMudWkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJhY3RpY2Utb3ZlcmxheScpOwogICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSB7CiAgICAgICAgICAgICAgICBpbmZTdGF0czogdHJ1ZSwKICAgICAgICAgICAgICAgIGFpRHVtbXk6IHRydWUsCiAgICAgICAgICAgICAgICBzaG93SGl0Ym94ZXM6IGZhbHNlCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIAogICAgICAgICAgICB0aGlzLnRhcmdldFJpbmcgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9pbml0VmlzdWFscygpOwogICAgICAgICAgICB0aGlzLl9zZXR1cEV2ZW50cygpOwogICAgICAgIH0KCiAgICAgICAgX2luaXRWaXN1YWxzKCkgewogICAgICAgICAgICAvLyBDcmVhdGUgYSBnbG93aW5nIHJpbmcgZm9yIHRhcmdldHMKICAgICAgICAgICAgY29uc3QgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuUmluZ0dlb21ldHJ5KDEuNSwgMS44LCAzMik7CiAgICAgICAgICAgIGdlb21ldHJ5LnJvdGF0ZVgoLU1hdGguUEkgLyAyKTsKICAgICAgICAgICAgY29uc3QgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyAKICAgICAgICAgICAgICAgIGNvbG9yOiAweDAwZmZmZiwgCiAgICAgICAgICAgICAgICBzaWRlOiBUSFJFRS5Eb3VibGVTaWRlLCAKICAgICAgICAgICAgICAgIHRyYW5zcGFyZW50OiB0cnVlLCAKICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAuNiwKICAgICAgICAgICAgICAgIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nLAogICAgICAgICAgICAgICAgZGVwdGhXcml0ZTogZmFsc2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMudGFyZ2V0UmluZyA9IG5ldyBUSFJFRS5NZXNoKGdlb21ldHJ5LCBtYXRlcmlhbCk7CiAgICAgICAgICAgIHRoaXMudGFyZ2V0UmluZy52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgIC8vIEFkZCB0byBzY2VuZSB2aWEgZ2FtZSBtYW5hZ2VyIHJlZmVyZW5jZQogICAgICAgICAgICBpZiAodGhpcy5nYW1lLnNjZW5lKSB0aGlzLmdhbWUuc2NlbmUuYWRkKHRoaXMudGFyZ2V0UmluZyk7CiAgICAgICAgfQoKICAgICAgICBzdGFydCgpIHsKdGhpcy5pc1J1bm5pbmcgPSB0cnVlOwogICAgICAgICAgICB0aGlzLl9zaG93UGFuZWwoKTsKICAgICAgICAgICAgdGhpcy5zZXREcmlsbCgnZnJlZScpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRW5zdXJlIEhVRCBpcyB2aXNpYmxlCiAgICAgICAgICAgIGNvbnN0IGh1ZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1aS1sYXllcicpOwogICAgICAgICAgICBpZihodWQpIGh1ZC5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnOwogICAgICAgIH0KCiAgICAgICAgc3RvcCgpIHsKCiAgICAgICAgICAgIHRoaXMuaXNSdW5uaW5nID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2hpZGVQYW5lbCgpOwogICAgICAgICAgICB0aGlzLl9oaWRlUmVzdG9yZUJ0bigpOwogICAgICAgICAgICB0aGlzLl9jbGVhckRyaWxsKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAodGhpcy50YXJnZXRSaW5nKSB0aGlzLnRhcmdldFJpbmcudmlzaWJsZSA9IGZhbHNlOwoKICAgICAgICAgICAgLy8gUmVzdG9yZSBBd2F5IFRlYW0gVmlzaWJpbGl0eSBmb3IgTm9ybWFsIE1hdGNoCiAgICAgICAgICAgIGlmICh0aGlzLmdhbWUudGVhbXMuYXdheSkgewogICAgICAgICAgICAgICAgdGhpcy5nYW1lLnRlYW1zLmF3YXkucGxheWVycy5mb3JFYWNoKHAgPT4gewogICAgICAgICAgICAgICAgICAgIGlmKHAubWVzaCkgewogICAgICAgICAgICAgICAgICAgICAgICBwLm1lc2gudmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIHAubWVzaC5wb3NpdGlvbi55ID0gMDsgLy8gRW5zdXJlIHRoZXkgYXJlbid0IHN0dWNrIHVuZGVyIGZsb29yCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIERpc2FibGUgZGVidWcgdmlzdWFscyBpZiB0aGV5IHdlcmUgb24KICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZS5kZWJ1Z1Zpc3VhbGl6ZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMuZ2FtZS5kZWJ1Z1Zpc3VhbGl6ZXIuZW5hYmxlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5nYW1lLmRlYnVnVmlzdWFsaXplci5zaG93SGl0Ym94ZXMgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgc2V0RHJpbGwoa2V5KSB7CiAgICAgICAgICAgIGlmICghdGhpcy5kcmlsbHNba2V5XSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9jbGVhckRyaWxsKCk7CiAgICAgICAgICAgIHRoaXMuY3VycmVudERyaWxsID0ga2V5OwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVXBkYXRlIFVJCiAgICAgICAgICAgIGlmICh0aGlzLnVpKSB7CiAgICAgICAgICAgICAgICB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3JBbGwoJy5kcmlsbC1idG4nKS5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgICAgICAgICAgICAgYnRuLmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScsIGJ0bi5kYXRhc2V0LmRyaWxsID09PSBrZXkpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFJ1biBTZXR1cAogICAgICAgICAgICB0aGlzLmRyaWxsc1trZXldLnNldHVwKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBBbm5vdW5jZW1lbnQKICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZS5zaG93QW5ub3VuY2VtZW50KSB7CiAgICAgICAgICAgICAgICB0aGlzLmdhbWUuc2hvd0Fubm91bmNlbWVudCh0aGlzLmRyaWxsc1trZXldLm5hbWUsICdub3JtYWwnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdXBkYXRlKGR0KSB7CiAgICAgICAgICAgIGlmICghdGhpcy5pc1J1bm5pbmcpIHJldHVybjsKCiAgICAgICAgICAgIC8vIENvbW1vbiBQcmFjdGljZSBMb2dpYyAoSW5maW5pdGUgU3RhdHMpCiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaW5mU3RhdHMpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2FwcGx5SW5maW5pdGVTdGF0cygpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBEcmlsbCBMb2dpYwogICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50RHJpbGwgJiYgdGhpcy5kcmlsbHNbdGhpcy5jdXJyZW50RHJpbGxdLmxvb3ApIHsKICAgICAgICAgICAgICAgIHRoaXMuZHJpbGxzW3RoaXMuY3VycmVudERyaWxsXS5sb29wKGR0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVmlzdWFscyBBbmltYXRpb24KICAgICAgICAgICAgaWYgKHRoaXMudGFyZ2V0UmluZyAmJiB0aGlzLnRhcmdldFJpbmcudmlzaWJsZSkgewogICAgICAgICAgICAgICAgdGhpcy50YXJnZXRSaW5nLnJvdGF0aW9uLnogKz0gZHQ7IC8vIFNwaW4KICAgICAgICAgICAgICAgIGNvbnN0IHMgPSAxLjAgKyBNYXRoLnNpbihEYXRlLm5vdygpICogMC4wMDUpICogMC4xOwogICAgICAgICAgICAgICAgdGhpcy50YXJnZXRSaW5nLnNjYWxlLnNldChzLCBzLCBzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX3NldHVwRXZlbnRzKCkgewppZiAoIXRoaXMudWkpIHJldHVybjsKCiAgICAgICAgICAgIC8vIE1pbmltaXplIC8gUmVzdG9yZQogICAgICAgICAgICBjb25zdCBtaW5CdG4gPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoJyNwLW1pbmltaXplJyk7CiAgICAgICAgICAgIGlmIChtaW5CdG4pIHsKICAgICAgICAgICAgICAgIG1pbkJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9oaWRlUGFuZWwoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zaG93UmVzdG9yZUJ0bigpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IHJlc3RvcmVCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJhY3RpY2UtcmVzdG9yZS1idG4nKTsKICAgICAgICAgICAgaWYgKHJlc3RvcmVCdG4pIHsKICAgICAgICAgICAgICAgIHJlc3RvcmVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2hvd1BhbmVsKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faGlkZVJlc3RvcmVCdG4oKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBEcmlsbCBCdXR0b25zCiAgICAgICAgICAgIHRoaXMudWkucXVlcnlTZWxlY3RvckFsbCgnLmRyaWxsLWJ0bicpLmZvckVhY2goYnRuID0+IHsKICAgICAgICAgICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNldERyaWxsKGJ0bi5kYXRhc2V0LmRyaWxsKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIFJlc2V0IEJhbGwKICAgICAgICAgICAgY29uc3QgcmVzZXRCdG4gPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoJyNwLXJlc2V0LWJhbGwnKTsKICAgICAgICAgICAgaWYgKHJlc2V0QnRuKSB7CiAgICAgICAgICAgICAgICByZXNldEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXNldEJhbGxUb1BsYXllcigpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEV4aXQKICAgICAgICAgICAgY29uc3QgZXhpdEJ0biA9IHRoaXMudWkucXVlcnlTZWxlY3RvcignI3AtZXhpdCcpOwogICAgICAgICAgICBpZiAoZXhpdEJ0bikgewogICAgICAgICAgICAgICAgZXhpdEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlICYmIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5tZW51TWFuYWdlcikgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UubWVudU1hbmFnZXIuc2hvdygpOwogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2Uuc3RhdGUgPSAnbWVudSc7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBPcHRpb25zIFRvZ2dsZXMKICAgICAgICAgICAgdGhpcy5fYmluZFRvZ2dsZSgnb3B0LWluZi1zdGF0JywgJ2luZlN0YXRzJyk7CiAgICAgICAgICAgIHRoaXMuX2JpbmRUb2dnbGUoJ29wdC1haS1kdW1teScsICdhaUR1bW15JywgKHZhbCkgPT4gewogICAgICAgICAgICAgICAgLy8gVXBkYXRlIEFJIER1bW15IHN0YXRlIGltbWVkaWF0ZWx5CiAgICAgICAgICAgICAgICBpZiAodGhpcy5nYW1lLnRlYW1zLmF3YXkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmdhbWUudGVhbXMuYXdheS5haUVuYWJsZWQgPSAhdmFsOyAvLyBJZiBkdW1teSBpcyBUUlVFLCBBSSBpcyBGQUxTRQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5fYmluZFRvZ2dsZSgnb3B0LWhpdGJveGVzJywgJ3Nob3dIaXRib3hlcycsICh2YWwpID0+IHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmdhbWUuZGVidWdWaXN1YWxpemVyKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5nYW1lLmRlYnVnVmlzdWFsaXplci5lbmFibGVkID0gdmFsOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZ2FtZS5kZWJ1Z1Zpc3VhbGl6ZXIuc2hvd0hpdGJveGVzID0gdmFsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIEtleWJvYXJkIFNob3J0Y3V0IGZvciBSZXNldCAoUikKLy8gS2V5Ym9hcmQgU2hvcnRjdXQgZm9yIFJlc2V0IChSKQogICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChlKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1J1bm5pbmcgJiYgZS5rZXkudG9Mb3dlckNhc2UoKSA9PT0gJ3InICYmICFlLnJlcGVhdCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3Jlc2V0QmFsbFRvUGxheWVyKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCl9iaW5kVG9nZ2xlKGlkLCBvcHRpb25LZXksIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIGNvbnN0IGVsID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKGAjJHtpZH1gKTsKICAgICAgICAgICAgaWYgKCFlbCkgcmV0dXJuOwoKICAgICAgICAgICAgLy8gSGVscGVyIHRvIHVwZGF0ZSB2aXN1YWxzCiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZVZpc3VhbCA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGlzQWN0aXZlID0gdGhpcy5vcHRpb25zW29wdGlvbktleV07CiAgICAgICAgICAgICAgICBlbC5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnLCBpc0FjdGl2ZSk7CiAgICAgICAgICAgICAgICBjb25zdCBib3ggPSBlbC5xdWVyeVNlbGVjdG9yKCcuY2hlY2tib3gnKTsKICAgICAgICAgICAgICAgIGlmIChib3gpIGJveC5pbm5lclRleHQgPSBpc0FjdGl2ZSA/ICfilqMnIDogJ+KWoSc7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBJbml0aWFsaXplIHZpc3VhbCBzdGF0ZSBpbW1lZGlhdGVseQogICAgICAgICAgICB1cGRhdGVWaXN1YWwoKTsKCiAgICAgICAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnNbb3B0aW9uS2V5XSA9ICF0aGlzLm9wdGlvbnNbb3B0aW9uS2V5XTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdXBkYXRlVmlzdWFsKCk7CgogICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjayh0aGlzLm9wdGlvbnNbb3B0aW9uS2V5XSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgX2FwcGx5SW5maW5pdGVTdGF0cygpIHsKICAgICAgICAgICAgY29uc3QgaG9tZSA9IHRoaXMuZ2FtZS50ZWFtcy5ob21lOwogICAgICAgICAgICBpZiAoaG9tZSkgewogICAgICAgICAgICAgICAgaG9tZS5wbGF5ZXJzLmZvckVhY2gocCA9PiB7CiAgICAgICAgICAgICAgICAgICAgcC5zdGF0cy5IUCA9IHAuc3RhdHMubWF4SFA7CiAgICAgICAgICAgICAgICAgICAgcC5jdXJyZW50RU4gPSBwLnN0YXRzLkVOOwogICAgICAgICAgICAgICAgICAgIHAuc3RhdHVzLnZlbm9tID0gMDsKICAgICAgICAgICAgICAgICAgICBwLnN0YXR1cy5uYXAgPSAwOwogICAgICAgICAgICAgICAgICAgIHAuc3R1blRpbWVyID0gMDsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBfY2xlYXJEcmlsbCgpIHsKICAgICAgICAgICAgLy8gUmVzZXQgcG9zaXRpb25zLCBjbGVhciBkdW1taWVzLCByZXNldCBzY29yZQp0aGlzLmRyaWxsU3RhdGUgPSB7IHNjb3JlOiAwLCB0aW1lcjogMCwgc3RhZ2U6IDAsIHJlc2V0dGluZzogZmFsc2UgfTsKICAgICAgICAgICAgdGhpcy5fdXBkYXRlU2NvcmVVSSgwKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh0aGlzLnRhcmdldFJpbmcpIHRoaXMudGFyZ2V0UmluZy52aXNpYmxlID0gZmFsc2U7CgogICAgICAgICAgICAvLyBSZXNldCB0ZWFtcyB0byBkZWZhdWx0IHBvc2l0aW9ucwogICAgICAgICAgICB0aGlzLmdhbWUudGVhbXMuaG9tZS5yZXNldFBvc2l0aW9ucygpOwogICAgICAgICAgICB0aGlzLmdhbWUudGVhbXMuYXdheS5yZXNldFBvc2l0aW9ucygpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQXBwbHkgQUkgRHVtbXkgc2V0dGluZwogICAgICAgICAgICBpZiAodGhpcy5nYW1lLnRlYW1zLmF3YXkpIHsKICAgICAgICAgICAgICAgIHRoaXMuZ2FtZS50ZWFtcy5hd2F5LmFpRW5hYmxlZCA9ICF0aGlzLm9wdGlvbnMuYWlEdW1teTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBIaWRlIGF3YXkgdGVhbSBieSBkZWZhdWx0IGluIGRyaWxscyB1bmxlc3Mgc3BlY2lmaWVkCiAgICAgICAgICAgIHRoaXMuZ2FtZS50ZWFtcy5hd2F5LnBsYXllcnMuZm9yRWFjaChwID0+IHsKICAgICAgICAgICAgICAgIGlmKHAubWVzaCkgcC5tZXNoLnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHAubWVzaC5wb3NpdGlvbi5zZXQoMCwgLTEwMCwgMCk7IC8vIE1vdmUgYXdheQogICAgICAgICAgICAgICAgcC52ZWxvY2l0eS5zZXQoMCwwLDApOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEVuc3VyZSBIb21lIHRlYW0gaXMgdmlzaWJsZQogICAgICAgICAgICB0aGlzLmdhbWUudGVhbXMuaG9tZS5wbGF5ZXJzLmZvckVhY2gocCA9PiB7CiAgICAgICAgICAgICAgICBpZihwLm1lc2gpIHAubWVzaC52aXNpYmxlID0gdHJ1ZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBfcmVzZXRCYWxsVG9QbGF5ZXIoKSB7CiAgICAgICAgICAgIGNvbnN0IHAgPSB0aGlzLmdhbWUudGVhbXMuaG9tZS5hY3RpdmVQbGF5ZXI7CiAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLmdhbWUuZW50aXRpZXMuYmFsbDsKICAgICAgICAgICAgaWYgKHAgJiYgYikgewogICAgICAgICAgICAgICAgYi5yZXNldCgpOwogICAgICAgICAgICAgICAgYi5ncmFiKHApOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZS5mbG9hdGluZ1RleHQpIHRoaXMuZ2FtZS5mbG9hdGluZ1RleHQuc3Bhd24oIlJFU0VUIiwgcC5tZXNoLnBvc2l0aW9uLCAidGVjaCIpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBTbmFwIGNhbWVyYQogICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZS5jYW1lcmFNYW5hZ2VyKSB0aGlzLmdhbWUuY2FtZXJhTWFuYWdlci5zbmFwVG9UYXJnZXQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX3VwZGF0ZVNjb3JlVUkodmFsKSB7CiAgICAgICAgICAgIGNvbnN0IGVsID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKCcjZHJpbGwtc2NvcmUnKTsKICAgICAgICAgICAgaWYgKGVsKSBlbC5pbm5lclRleHQgPSBgU0NPUkU6ICR7dmFsfWA7CiAgICAgICAgfQoKICAgICAgICBfc2V0SW5zdHJ1Y3Rpb24odGV4dCkgewogICAgICAgICAgICAgY29uc3QgZWwgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoJyNkcmlsbC1pbnN0cnVjdGlvbicpOwogICAgICAgICAgICAgaWYgKGVsKSBlbC5pbm5lclRleHQgPSB0ZXh0OwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tIERSSUxMUyAtLS0KCiAgICAgICAgX3NldHVwRnJlZSgpIHsKICAgICAgICAgICAgdGhpcy5fc2V0SW5zdHJ1Y3Rpb24oIkZyZWUgcHJhY3RpY2UuIEluZmluaXRlIEhQL0VOLiIpOwogICAgICAgICAgICAvLyBTaG93IGV2ZXJ5b25lCiAgICAgICAgICAgIHRoaXMuZ2FtZS50ZWFtcy5hd2F5LnBsYXllcnMuZm9yRWFjaChwID0+IHsKICAgICAgICAgICAgICAgIGlmKHAubWVzaCkgcC5tZXNoLnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgcC5tZXNoLnBvc2l0aW9uLmNvcHkocC5ob21lUG9zaXRpb24pOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5fcmVzZXRCYWxsVG9QbGF5ZXIoKTsKICAgICAgICB9CiAgICAgICAgX2xvb3BGcmVlKGR0KSB7fQoKICAgICAgICBfc2V0dXBTaG9vdGluZygpIHsKCiAgICAgICAgICAgIHRoaXMuX3NldEluc3RydWN0aW9uKCJTY29yZSBvbiB0aGUgR29hbGllISIpOwogICAgICAgICAgICB0aGlzLmRyaWxsU3RhdGUucmVzZXR0aW5nID0gZmFsc2U7IC8vIENsZWFyIHJlc2V0IGZsYWcKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFNldHVwOiBBY3RpdmUgUGxheWVyIGF0IDE4bSwgR29hbGllIGluIG5ldC4KICAgICAgICAgICAgY29uc3QgcCA9IHRoaXMuZ2FtZS50ZWFtcy5ob21lLmFjdGl2ZVBsYXllcjsKICAgICAgICAgICAgY29uc3QgZyA9IHRoaXMuZ2FtZS50ZWFtcy5hd2F5LnBsYXllcnMuZmluZCh4ID0+IHgucm9sZSA9PT0gJ0dMJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAocCAmJiBwLm1lc2gpIHsKICAgICAgICAgICAgICAgIHAubWVzaC5wb3NpdGlvbi5zZXQoMCwgMCwgLTEwKTsgLy8gMThtIG91dCAoSG9tZSBhdHRhY2tzIC1aKQogICAgICAgICAgICAgICAgcC5tZXNoLmxvb2tBdCgwLCAwLCAtMjgpOwogICAgICAgICAgICAgICAgcC52ZWxvY2l0eS5zZXQoMCwwLDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChnICYmIGcubWVzaCkgewogICAgICAgICAgICAgICAgZy5tZXNoLnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgZy5tZXNoLnBvc2l0aW9uLnNldCgwLCAwLCAtMjcpOwogICAgICAgICAgICAgICAgZy5tZXNoLmxvb2tBdCgwLCAwLCAwKTsKICAgICAgICAgICAgICAgIGcudmVsb2NpdHkuc2V0KDAsMCwwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5fcmVzZXRCYWxsVG9QbGF5ZXIoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgX2xvb3BTaG9vdGluZyhkdCkgewogICAgICAgICAgICBpZiAodGhpcy5kcmlsbFN0YXRlLnJlc2V0dGluZykgcmV0dXJuOwoKICAgICAgICAgICAgLy8gQ2hlY2sgaWYgZ29hbCBzY29yZWQgKEdhbWVNYW5hZ2VyIGhhbmRsZXMgdGhlIGFjdHVhbCBnb2FsIGV2ZW50LCBidXQgd2UgdHJhY2sgcmVzZXQpCiAgICAgICAgICAgIGlmICh0aGlzLmdhbWUuc3RhdGUgPT09ICdnb2FsJykgewogICAgICAgICAgICAgICAgdGhpcy5kcmlsbFN0YXRlLnJlc2V0dGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLmRyaWxsU3RhdGUuc2NvcmUrKzsKICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVNjb3JlVUkodGhpcy5kcmlsbFN0YXRlLnNjb3JlKTsKICAgICAgICAgICAgICAgIHRoaXMuZ2FtZS5zdGF0ZSA9ICdhY3RpdmUnOyAvLyBIaWphY2sgc3RhdGUgYmFjawogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLl9zZXR1cFNob290aW5nKCksIDEwMDApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBJZiBnb2FsaWUgY2F0Y2hlcwogICAgICAgICAgICBjb25zdCBnID0gdGhpcy5nYW1lLnRlYW1zLmF3YXkucGxheWVycy5maW5kKHggPT4geC5yb2xlID09PSAnR0wnKTsKICAgICAgICAgICAgaWYgKGcgJiYgZy5oYXNCYWxsKSB7CiAgICAgICAgICAgICAgICAgdGhpcy5kcmlsbFN0YXRlLnJlc2V0dGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZS5mbG9hdGluZ1RleHQpIHRoaXMuZ2FtZS5mbG9hdGluZ1RleHQuc3Bhd24oIlNBVkVEIiwgZy5tZXNoLnBvc2l0aW9uLCAiZGFtYWdlIik7CiAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLl9zZXR1cFNob290aW5nKCksIDEwMDApOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBfc2V0dXBQYXNzaW5nKCkgewoKICAgICAgICAgICAgIHRoaXMuX3NldEluc3RydWN0aW9uKCJQYXNzIHRvIHRoZSBtb3ZpbmcgdGFyZ2V0ISIpOwogICAgICAgICAgICAgdGhpcy5kcmlsbFN0YXRlLnJlc2V0dGluZyA9IGZhbHNlOwoKICAgICAgICAgICAgIC8vIFNldHVwOiBBY3RpdmUgUGxheWVyIGNlbnRlci4gMSBUZWFtbWF0ZSBydW5uaW5nIHBhdHRlcm5zLgogICAgICAgICAgICAgY29uc3QgcCA9IHRoaXMuZ2FtZS50ZWFtcy5ob21lLmFjdGl2ZVBsYXllcjsKICAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IHRoaXMuZ2FtZS50ZWFtcy5ob21lLnBsYXllcnMuZmluZCh4ID0+IHggIT09IHAgJiYgeC5yb2xlICE9PSAnR0wnKTsKICAgICAgICAgICAgIAogICAgICAgICAgICAgdGhpcy5kcmlsbFN0YXRlLnRhcmdldCA9IHRhcmdldDsKICAgICAgICAgICAgIAogICAgICAgICAgICAgaWYgKHApIHsKICAgICAgICAgICAgICAgICBwLm1lc2gucG9zaXRpb24uc2V0KDAsIDAsIDEwKTsKICAgICAgICAgICAgICAgICBwLnZlbG9jaXR5LnNldCgwLDAsMCk7CiAgICAgICAgICAgICB9CiAgICAgICAgICAgICBpZiAodGFyZ2V0KSB7CiAgICAgICAgICAgICAgICAgdGFyZ2V0Lm1lc2gucG9zaXRpb24uc2V0KDAsIDAsIC0xMCk7CiAgICAgICAgICAgICAgICAgdGFyZ2V0Lm1lc2gudmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgdGFyZ2V0LnZlbG9jaXR5LnNldCgwLDAsMCk7CiAgICAgICAgICAgICB9CiAgICAgICAgICAgICAKICAgICAgICAgICAgIHRoaXMuX3Jlc2V0QmFsbFRvUGxheWVyKCk7CiAgICAgICAgfQoKICAgICAgICBfbG9vcFBhc3NpbmcoZHQpIHsKICAgICAgICAgICAgaWYgKHRoaXMuZHJpbGxTdGF0ZS5yZXNldHRpbmcpIHJldHVybjsKCiAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IHRoaXMuZHJpbGxTdGF0ZS50YXJnZXQ7CiAgICAgICAgICAgIGlmICghdGFyZ2V0KSByZXR1cm47CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBNb3ZlIHRhcmdldCBpbiBjaXJjbGUKICAgICAgICAgICAgdGhpcy5kcmlsbFN0YXRlLnRpbWVyICs9IGR0OwogICAgICAgICAgICB0YXJnZXQubWVzaC5wb3NpdGlvbi54ID0gTWF0aC5zaW4odGhpcy5kcmlsbFN0YXRlLnRpbWVyKSAqIDEwOwogICAgICAgICAgICB0YXJnZXQubWVzaC5wb3NpdGlvbi56ID0gLTEwICsgTWF0aC5jb3ModGhpcy5kcmlsbFN0YXRlLnRpbWVyICogMC41KSAqIDU7CiAgICAgICAgICAgIHRhcmdldC5tZXNoLmxvb2tBdCgwLDAsMTApOwoKICAgICAgICAgICAgLy8gVXBkYXRlIFJpbmcKICAgICAgICAgICAgaWYgKHRoaXMudGFyZ2V0UmluZykgewogICAgICAgICAgICAgICAgdGhpcy50YXJnZXRSaW5nLnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy50YXJnZXRSaW5nLnBvc2l0aW9uLmNvcHkodGFyZ2V0Lm1lc2gucG9zaXRpb24pOwogICAgICAgICAgICAgICAgdGhpcy50YXJnZXRSaW5nLnBvc2l0aW9uLnkgPSAwLjE7CiAgICAgICAgICAgICAgICB0aGlzLnRhcmdldFJpbmcubWF0ZXJpYWwuY29sb3Iuc2V0SGV4KDB4MDBmZmZmKTsgLy8gQ3lhbgogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGFyZ2V0Lmhhc0JhbGwpIHsKICAgICAgICAgICAgICAgIHRoaXMuZHJpbGxTdGF0ZS5yZXNldHRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5kcmlsbFN0YXRlLnNjb3JlKys7CiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVTY29yZVVJKHRoaXMuZHJpbGxTdGF0ZS5zY29yZSk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5nYW1lLmZsb2F0aW5nVGV4dCkgdGhpcy5nYW1lLmZsb2F0aW5nVGV4dC5zcGF3bigiTklDRSBQQVNTISIsIHRhcmdldC5tZXNoLnBvc2l0aW9uLCAiaGVhbCIpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBSZXNldAogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0Lmxvc2VCYWxsKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0dXBQYXNzaW5nKCk7IC8vIFJlLXNldHVwIHRvIHJlc2V0IHBvc2l0aW9ucwogICAgICAgICAgICAgICAgfSwgODAwKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBfc2V0dXBEZWZlbnNlKCkgewoKICAgICAgICAgICAgdGhpcy5fc2V0SW5zdHJ1Y3Rpb24oIlRhY2tsZSB0aGUgYXR0YWNrZXIhIik7CiAgICAgICAgICAgIHRoaXMuZHJpbGxTdGF0ZS5yZXNldHRpbmcgPSBmYWxzZTsKCiAgICAgICAgICAgIGNvbnN0IHAgPSB0aGlzLmdhbWUudGVhbXMuaG9tZS5hY3RpdmVQbGF5ZXI7CiAgICAgICAgICAgIGNvbnN0IGF0dGFja2VyID0gdGhpcy5nYW1lLnRlYW1zLmF3YXkucGxheWVycy5maW5kKHggPT4geC5yb2xlID09PSAnTUYnKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHRoaXMuZHJpbGxTdGF0ZS5hdHRhY2tlciA9IGF0dGFja2VyOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHApIHsKICAgICAgICAgICAgICAgIHAubWVzaC5wb3NpdGlvbi5zZXQoMCwgMCwgMjApOyAvLyBOZWFyIG93biBnb2FsCiAgICAgICAgICAgICAgICBwLnZlbG9jaXR5LnNldCgwLDAsMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGF0dGFja2VyKSB7CiAgICAgICAgICAgICAgICBhdHRhY2tlci5tZXNoLnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgYXR0YWNrZXIubWVzaC5wb3NpdGlvbi5zZXQoMCwgMCwgLTEwKTsKICAgICAgICAgICAgICAgIGF0dGFja2VyLnZlbG9jaXR5LnNldCgwLDAsMCk7CiAgICAgICAgICAgICAgICAvLyBHaXZlIGJhbGwgdG8gYXR0YWNrZXIKICAgICAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLmdhbWUuZW50aXRpZXMuYmFsbDsKICAgICAgICAgICAgICAgIGIucmVzZXQoKTsKICAgICAgICAgICAgICAgIGIuZ3JhYihhdHRhY2tlcik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgX2xvb3BEZWZlbnNlKGR0KSB7CiAgICAgICAgICAgIGlmICh0aGlzLmRyaWxsU3RhdGUucmVzZXR0aW5nKSByZXR1cm47CgogICAgICAgICAgICBjb25zdCBhdHRhY2tlciA9IHRoaXMuZHJpbGxTdGF0ZS5hdHRhY2tlcjsKICAgICAgICAgICAgY29uc3QgcCA9IHRoaXMuZ2FtZS50ZWFtcy5ob21lLmFjdGl2ZVBsYXllcjsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICghYXR0YWNrZXIgfHwgIXApIHJldHVybjsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEF0dGFja2VyIHJ1bnMgdG8gZ29hbCAoK1opCiAgICAgICAgICAgIGNvbnN0IGdvYWxQb3MgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAyOCk7CiAgICAgICAgICAgIGNvbnN0IGRpciA9IGdvYWxQb3MuY2xvbmUoKS5zdWIoYXR0YWNrZXIubWVzaC5wb3NpdGlvbikubm9ybWFsaXplKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBVcGRhdGUgUmluZyBvbiBBdHRhY2tlcgogICAgICAgICAgICBpZiAodGhpcy50YXJnZXRSaW5nKSB7CiAgICAgICAgICAgICAgICB0aGlzLnRhcmdldFJpbmcudmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLnRhcmdldFJpbmcucG9zaXRpb24uY29weShhdHRhY2tlci5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgIHRoaXMudGFyZ2V0UmluZy5wb3NpdGlvbi55ID0gMC4xOwogICAgICAgICAgICAgICAgdGhpcy50YXJnZXRSaW5nLm1hdGVyaWFsLmNvbG9yLnNldEhleCgweGZmMDAwMCk7IC8vIFJlZCBmb3IgZW5lbXkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGF0dGFja2VyLmhhc0JhbGwpIHsKICAgICAgICAgICAgICAgIGF0dGFja2VyLnNldElucHV0KGRpci54LCBkaXIueik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBCYWxsIGxvc3QgKFRhY2tsZWQpCiAgICAgICAgICAgICAgICBpZiAocC5oYXNCYWxsIHx8IHRoaXMuZ2FtZS5lbnRpdGllcy5iYWxsLnN0YXRlID09PSAnZnJlZScpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmRyaWxsU3RhdGUucmVzZXR0aW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmRyaWxsU3RhdGUuc2NvcmUrKzsKICAgICAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVTY29yZVVJKHRoaXMuZHJpbGxTdGF0ZS5zY29yZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZS5mbG9hdGluZ1RleHQpIHRoaXMuZ2FtZS5mbG9hdGluZ1RleHQuc3Bhd24oIlNUT1BQRUQhIiwgcC5tZXNoLnBvc2l0aW9uLCAiYmxvY2siKTsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMuX3NldHVwRGVmZW5zZSgpLCAxMDAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRmFpbCBjb25kaXRpb246IEF0dGFja2VyIHNjb3JlcyAoR2FtZU1hbmFnZXIgaGFuZGxlcyBnb2FsIGNoZWNrKQogICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZS5zdGF0ZSA9PT0gJ2dvYWwnKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRyaWxsU3RhdGUucmVzZXR0aW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMuZ2FtZS5zdGF0ZSA9ICdhY3RpdmUnOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZS5mbG9hdGluZ1RleHQpIHRoaXMuZ2FtZS5mbG9hdGluZ1RleHQuc3Bhd24oIkZBSUxFRCIsIHAubWVzaC5wb3NpdGlvbiwgImRhbWFnZSIpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLl9zZXR1cERlZmVuc2UoKSwgMTAwMCk7CiAgICAgICAgICAgIH0KICAgICAgICB9Cl9zaG93UGFuZWwoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnVpKSB0aGlzLnVpLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgIH0KCiAgICAgICAgX2hpZGVQYW5lbCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMudWkpIHRoaXMudWkuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgfQoKICAgICAgICBfc2hvd1Jlc3RvcmVCdG4oKSB7CiAgICAgICAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmFjdGljZS1yZXN0b3JlLWJ0bicpOwogICAgICAgICAgICBpZiAoYnRuKSBidG4uc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgfQoKICAgICAgICBfaGlkZVJlc3RvcmVCdG4oKSB7CiAgICAgICAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmFjdGljZS1yZXN0b3JlLWJ0bicpOwogICAgICAgICAgICBpZiAoYnRuKSBidG4uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICB9CiAgICB9CndpbmRvdy5mbHV4LlByYWN0aWNlTWFuYWdlciA9IFByYWN0aWNlTWFuYWdlcjsKfSkoKTs=","./PracticeManager.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICBjbGFzcyBQcmFjdGljZU1hbmFnZXIgewogICAgICAgIGNvbnN0cnVjdG9yKGdhbWVNYW5hZ2VyKSB7CiAgICAgICAgICAgIHRoaXMuZ2FtZSA9IGdhbWVNYW5hZ2VyOwogICAgICAgICAgICB0aGlzLmlzUnVubmluZyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmN1cnJlbnREcmlsbCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuZHJpbGxTdGF0ZSA9IHt9OyAKICAgICAgICAgICAgCiAgICAgICAgICAgIHRoaXMuZHJpbGxzID0gewogICAgICAgICAgICAgICAgJ2ZyZWUnOiB7IG5hbWU6ICdGUkVFIFJPQU0nLCBzZXR1cDogdGhpcy5fc2V0dXBGcmVlLmJpbmQodGhpcyksIGxvb3A6IHRoaXMuX2xvb3BGcmVlLmJpbmQodGhpcykgfSwKICAgICAgICAgICAgICAgICdzaG9vdGluZyc6IHsgbmFtZTogJ1NIT09USU5HIERSSUxMJywgc2V0dXA6IHRoaXMuX3NldHVwU2hvb3RpbmcuYmluZCh0aGlzKSwgbG9vcDogdGhpcy5fbG9vcFNob290aW5nLmJpbmQodGhpcykgfSwKICAgICAgICAgICAgICAgICdwYXNzaW5nJzogeyBuYW1lOiAnUEFTU0lORyBEUklMTCcsIHNldHVwOiB0aGlzLl9zZXR1cFBhc3NpbmcuYmluZCh0aGlzKSwgbG9vcDogdGhpcy5fbG9vcFBhc3NpbmcuYmluZCh0aGlzKSB9LAogICAgICAgICAgICAgICAgJ2RlZmVuc2UnOiB7IG5hbWU6ICdERUZFTlNFIERSSUxMJywgc2V0dXA6IHRoaXMuX3NldHVwRGVmZW5zZS5iaW5kKHRoaXMpLCBsb29wOiB0aGlzLl9sb29wRGVmZW5zZS5iaW5kKHRoaXMpIH0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHRoaXMudWkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJhY3RpY2Utb3ZlcmxheScpOwogICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSB7CiAgICAgICAgICAgICAgICBpbmZTdGF0czogdHJ1ZSwKICAgICAgICAgICAgICAgIGFpRHVtbXk6IHRydWUsCiAgICAgICAgICAgICAgICBzaG93SGl0Ym94ZXM6IGZhbHNlCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIAogICAgICAgICAgICB0aGlzLnRhcmdldFJpbmcgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9pbml0VmlzdWFscygpOwogICAgICAgICAgICB0aGlzLl9zZXR1cEV2ZW50cygpOwogICAgICAgIH0KCiAgICAgICAgX2luaXRWaXN1YWxzKCkgewogICAgICAgICAgICAvLyBDcmVhdGUgYSBnbG93aW5nIHJpbmcgZm9yIHRhcmdldHMKICAgICAgICAgICAgY29uc3QgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuUmluZ0dlb21ldHJ5KDEuNSwgMS44LCAzMik7CiAgICAgICAgICAgIGdlb21ldHJ5LnJvdGF0ZVgoLU1hdGguUEkgLyAyKTsKICAgICAgICAgICAgY29uc3QgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyAKICAgICAgICAgICAgICAgIGNvbG9yOiAweDAwZmZmZiwgCiAgICAgICAgICAgICAgICBzaWRlOiBUSFJFRS5Eb3VibGVTaWRlLCAKICAgICAgICAgICAgICAgIHRyYW5zcGFyZW50OiB0cnVlLCAKICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAuNiwKICAgICAgICAgICAgICAgIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nLAogICAgICAgICAgICAgICAgZGVwdGhXcml0ZTogZmFsc2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMudGFyZ2V0UmluZyA9IG5ldyBUSFJFRS5NZXNoKGdlb21ldHJ5LCBtYXRlcmlhbCk7CiAgICAgICAgICAgIHRoaXMudGFyZ2V0UmluZy52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgIC8vIEFkZCB0byBzY2VuZSB2aWEgZ2FtZSBtYW5hZ2VyIHJlZmVyZW5jZQogICAgICAgICAgICBpZiAodGhpcy5nYW1lLnNjZW5lKSB0aGlzLmdhbWUuc2NlbmUuYWRkKHRoaXMudGFyZ2V0UmluZyk7CiAgICAgICAgfQoKICAgICAgICBzdGFydCgpIHsKdGhpcy5pc1J1bm5pbmcgPSB0cnVlOwogICAgICAgICAgICB0aGlzLl9zaG93UGFuZWwoKTsKICAgICAgICAgICAgdGhpcy5zZXREcmlsbCgnZnJlZScpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRW5zdXJlIEhVRCBpcyB2aXNpYmxlCiAgICAgICAgICAgIGNvbnN0IGh1ZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1aS1sYXllcicpOwogICAgICAgICAgICBpZihodWQpIGh1ZC5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnOwogICAgICAgIH0KCiAgICAgICAgc3RvcCgpIHsKCiAgICAgICAgICAgIHRoaXMuaXNSdW5uaW5nID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2hpZGVQYW5lbCgpOwogICAgICAgICAgICB0aGlzLl9oaWRlUmVzdG9yZUJ0bigpOwogICAgICAgICAgICB0aGlzLl9jbGVhckRyaWxsKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAodGhpcy50YXJnZXRSaW5nKSB0aGlzLnRhcmdldFJpbmcudmlzaWJsZSA9IGZhbHNlOwoKICAgICAgICAgICAgLy8gUmVzdG9yZSBBd2F5IFRlYW0gVmlzaWJpbGl0eSBmb3IgTm9ybWFsIE1hdGNoCiAgICAgICAgICAgIGlmICh0aGlzLmdhbWUudGVhbXMuYXdheSkgewogICAgICAgICAgICAgICAgdGhpcy5nYW1lLnRlYW1zLmF3YXkucGxheWVycy5mb3JFYWNoKHAgPT4gewogICAgICAgICAgICAgICAgICAgIGlmKHAubWVzaCkgewogICAgICAgICAgICAgICAgICAgICAgICBwLm1lc2gudmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIHAubWVzaC5wb3NpdGlvbi55ID0gMDsgLy8gRW5zdXJlIHRoZXkgYXJlbid0IHN0dWNrIHVuZGVyIGZsb29yCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIERpc2FibGUgZGVidWcgdmlzdWFscyBpZiB0aGV5IHdlcmUgb24KICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZS5kZWJ1Z1Zpc3VhbGl6ZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMuZ2FtZS5kZWJ1Z1Zpc3VhbGl6ZXIuZW5hYmxlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5nYW1lLmRlYnVnVmlzdWFsaXplci5zaG93SGl0Ym94ZXMgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgc2V0RHJpbGwoa2V5KSB7CiAgICAgICAgICAgIGlmICghdGhpcy5kcmlsbHNba2V5XSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9jbGVhckRyaWxsKCk7CiAgICAgICAgICAgIHRoaXMuY3VycmVudERyaWxsID0ga2V5OwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVXBkYXRlIFVJCiAgICAgICAgICAgIGlmICh0aGlzLnVpKSB7CiAgICAgICAgICAgICAgICB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3JBbGwoJy5kcmlsbC1idG4nKS5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgICAgICAgICAgICAgYnRuLmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScsIGJ0bi5kYXRhc2V0LmRyaWxsID09PSBrZXkpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFJ1biBTZXR1cAogICAgICAgICAgICB0aGlzLmRyaWxsc1trZXldLnNldHVwKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBBbm5vdW5jZW1lbnQKICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZS5zaG93QW5ub3VuY2VtZW50KSB7CiAgICAgICAgICAgICAgICB0aGlzLmdhbWUuc2hvd0Fubm91bmNlbWVudCh0aGlzLmRyaWxsc1trZXldLm5hbWUsICdub3JtYWwnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdXBkYXRlKGR0KSB7CiAgICAgICAgICAgIGlmICghdGhpcy5pc1J1bm5pbmcpIHJldHVybjsKCiAgICAgICAgICAgIC8vIENvbW1vbiBQcmFjdGljZSBMb2dpYyAoSW5maW5pdGUgU3RhdHMpCiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaW5mU3RhdHMpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2FwcGx5SW5maW5pdGVTdGF0cygpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBEcmlsbCBMb2dpYwogICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50RHJpbGwgJiYgdGhpcy5kcmlsbHNbdGhpcy5jdXJyZW50RHJpbGxdLmxvb3ApIHsKICAgICAgICAgICAgICAgIHRoaXMuZHJpbGxzW3RoaXMuY3VycmVudERyaWxsXS5sb29wKGR0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVmlzdWFscyBBbmltYXRpb24KICAgICAgICAgICAgaWYgKHRoaXMudGFyZ2V0UmluZyAmJiB0aGlzLnRhcmdldFJpbmcudmlzaWJsZSkgewogICAgICAgICAgICAgICAgdGhpcy50YXJnZXRSaW5nLnJvdGF0aW9uLnogKz0gZHQ7IC8vIFNwaW4KICAgICAgICAgICAgICAgIGNvbnN0IHMgPSAxLjAgKyBNYXRoLnNpbihEYXRlLm5vdygpICogMC4wMDUpICogMC4xOwogICAgICAgICAgICAgICAgdGhpcy50YXJnZXRSaW5nLnNjYWxlLnNldChzLCBzLCBzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX3NldHVwRXZlbnRzKCkgewppZiAoIXRoaXMudWkpIHJldHVybjsKCiAgICAgICAgICAgIC8vIE1pbmltaXplIC8gUmVzdG9yZQogICAgICAgICAgICBjb25zdCBtaW5CdG4gPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoJyNwLW1pbmltaXplJyk7CiAgICAgICAgICAgIGlmIChtaW5CdG4pIHsKICAgICAgICAgICAgICAgIG1pbkJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9oaWRlUGFuZWwoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zaG93UmVzdG9yZUJ0bigpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IHJlc3RvcmVCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJhY3RpY2UtcmVzdG9yZS1idG4nKTsKICAgICAgICAgICAgaWYgKHJlc3RvcmVCdG4pIHsKICAgICAgICAgICAgICAgIHJlc3RvcmVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2hvd1BhbmVsKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faGlkZVJlc3RvcmVCdG4oKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBEcmlsbCBCdXR0b25zCiAgICAgICAgICAgIHRoaXMudWkucXVlcnlTZWxlY3RvckFsbCgnLmRyaWxsLWJ0bicpLmZvckVhY2goYnRuID0+IHsKICAgICAgICAgICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNldERyaWxsKGJ0bi5kYXRhc2V0LmRyaWxsKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIFJlc2V0IEJhbGwKICAgICAgICAgICAgY29uc3QgcmVzZXRCdG4gPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoJyNwLXJlc2V0LWJhbGwnKTsKICAgICAgICAgICAgaWYgKHJlc2V0QnRuKSB7CiAgICAgICAgICAgICAgICByZXNldEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXNldEJhbGxUb1BsYXllcigpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEV4aXQKICAgICAgICAgICAgY29uc3QgZXhpdEJ0biA9IHRoaXMudWkucXVlcnlTZWxlY3RvcignI3AtZXhpdCcpOwogICAgICAgICAgICBpZiAoZXhpdEJ0bikgewogICAgICAgICAgICAgICAgZXhpdEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlICYmIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5tZW51TWFuYWdlcikgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UubWVudU1hbmFnZXIuc2hvdygpOwogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2Uuc3RhdGUgPSAnbWVudSc7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBPcHRpb25zIFRvZ2dsZXMKICAgICAgICAgICAgdGhpcy5fYmluZFRvZ2dsZSgnb3B0LWluZi1zdGF0JywgJ2luZlN0YXRzJyk7CiAgICAgICAgICAgIHRoaXMuX2JpbmRUb2dnbGUoJ29wdC1haS1kdW1teScsICdhaUR1bW15JywgKHZhbCkgPT4gewogICAgICAgICAgICAgICAgLy8gVXBkYXRlIEFJIER1bW15IHN0YXRlIGltbWVkaWF0ZWx5CiAgICAgICAgICAgICAgICBpZiAodGhpcy5nYW1lLnRlYW1zLmF3YXkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmdhbWUudGVhbXMuYXdheS5haUVuYWJsZWQgPSAhdmFsOyAvLyBJZiBkdW1teSBpcyBUUlVFLCBBSSBpcyBGQUxTRQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5fYmluZFRvZ2dsZSgnb3B0LWhpdGJveGVzJywgJ3Nob3dIaXRib3hlcycsICh2YWwpID0+IHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmdhbWUuZGVidWdWaXN1YWxpemVyKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5nYW1lLmRlYnVnVmlzdWFsaXplci5lbmFibGVkID0gdmFsOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZ2FtZS5kZWJ1Z1Zpc3VhbGl6ZXIuc2hvd0hpdGJveGVzID0gdmFsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIEtleWJvYXJkIFNob3J0Y3V0IGZvciBSZXNldCAoUikKLy8gS2V5Ym9hcmQgU2hvcnRjdXQgZm9yIFJlc2V0IChSKQogICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChlKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1J1bm5pbmcgJiYgZS5rZXkudG9Mb3dlckNhc2UoKSA9PT0gJ3InICYmICFlLnJlcGVhdCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3Jlc2V0QmFsbFRvUGxheWVyKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCl9iaW5kVG9nZ2xlKGlkLCBvcHRpb25LZXksIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIGNvbnN0IGVsID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKGAjJHtpZH1gKTsKICAgICAgICAgICAgaWYgKCFlbCkgcmV0dXJuOwoKICAgICAgICAgICAgLy8gSGVscGVyIHRvIHVwZGF0ZSB2aXN1YWxzCiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZVZpc3VhbCA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGlzQWN0aXZlID0gdGhpcy5vcHRpb25zW29wdGlvbktleV07CiAgICAgICAgICAgICAgICBlbC5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnLCBpc0FjdGl2ZSk7CiAgICAgICAgICAgICAgICBjb25zdCBib3ggPSBlbC5xdWVyeVNlbGVjdG9yKCcuY2hlY2tib3gnKTsKICAgICAgICAgICAgICAgIGlmIChib3gpIGJveC5pbm5lclRleHQgPSBpc0FjdGl2ZSA/ICfilqMnIDogJ+KWoSc7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBJbml0aWFsaXplIHZpc3VhbCBzdGF0ZSBpbW1lZGlhdGVseQogICAgICAgICAgICB1cGRhdGVWaXN1YWwoKTsKCiAgICAgICAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnNbb3B0aW9uS2V5XSA9ICF0aGlzLm9wdGlvbnNbb3B0aW9uS2V5XTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdXBkYXRlVmlzdWFsKCk7CgogICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjayh0aGlzLm9wdGlvbnNbb3B0aW9uS2V5XSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgX2FwcGx5SW5maW5pdGVTdGF0cygpIHsKICAgICAgICAgICAgY29uc3QgaG9tZSA9IHRoaXMuZ2FtZS50ZWFtcy5ob21lOwogICAgICAgICAgICBpZiAoaG9tZSkgewogICAgICAgICAgICAgICAgaG9tZS5wbGF5ZXJzLmZvckVhY2gocCA9PiB7CiAgICAgICAgICAgICAgICAgICAgcC5zdGF0cy5IUCA9IHAuc3RhdHMubWF4SFA7CiAgICAgICAgICAgICAgICAgICAgcC5jdXJyZW50RU4gPSBwLnN0YXRzLkVOOwogICAgICAgICAgICAgICAgICAgIHAuc3RhdHVzLnZlbm9tID0gMDsKICAgICAgICAgICAgICAgICAgICBwLnN0YXR1cy5uYXAgPSAwOwogICAgICAgICAgICAgICAgICAgIHAuc3R1blRpbWVyID0gMDsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBfY2xlYXJEcmlsbCgpIHsKICAgICAgICAgICAgLy8gUmVzZXQgcG9zaXRpb25zLCBjbGVhciBkdW1taWVzLCByZXNldCBzY29yZQp0aGlzLmRyaWxsU3RhdGUgPSB7IHNjb3JlOiAwLCB0aW1lcjogMCwgc3RhZ2U6IDAsIHJlc2V0dGluZzogZmFsc2UgfTsKICAgICAgICAgICAgdGhpcy5fdXBkYXRlU2NvcmVVSSgwKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh0aGlzLnRhcmdldFJpbmcpIHRoaXMudGFyZ2V0UmluZy52aXNpYmxlID0gZmFsc2U7CgogICAgICAgICAgICAvLyBSZXNldCB0ZWFtcyB0byBkZWZhdWx0IHBvc2l0aW9ucwogICAgICAgICAgICB0aGlzLmdhbWUudGVhbXMuaG9tZS5yZXNldFBvc2l0aW9ucygpOwogICAgICAgICAgICB0aGlzLmdhbWUudGVhbXMuYXdheS5yZXNldFBvc2l0aW9ucygpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQXBwbHkgQUkgRHVtbXkgc2V0dGluZwogICAgICAgICAgICBpZiAodGhpcy5nYW1lLnRlYW1zLmF3YXkpIHsKICAgICAgICAgICAgICAgIHRoaXMuZ2FtZS50ZWFtcy5hd2F5LmFpRW5hYmxlZCA9ICF0aGlzLm9wdGlvbnMuYWlEdW1teTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBIaWRlIGF3YXkgdGVhbSBieSBkZWZhdWx0IGluIGRyaWxscyB1bmxlc3Mgc3BlY2lmaWVkCiAgICAgICAgICAgIHRoaXMuZ2FtZS50ZWFtcy5hd2F5LnBsYXllcnMuZm9yRWFjaChwID0+IHsKICAgICAgICAgICAgICAgIGlmKHAubWVzaCkgcC5tZXNoLnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHAubWVzaC5wb3NpdGlvbi5zZXQoMCwgLTEwMCwgMCk7IC8vIE1vdmUgYXdheQogICAgICAgICAgICAgICAgcC52ZWxvY2l0eS5zZXQoMCwwLDApOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEVuc3VyZSBIb21lIHRlYW0gaXMgdmlzaWJsZQogICAgICAgICAgICB0aGlzLmdhbWUudGVhbXMuaG9tZS5wbGF5ZXJzLmZvckVhY2gocCA9PiB7CiAgICAgICAgICAgICAgICBpZihwLm1lc2gpIHAubWVzaC52aXNpYmxlID0gdHJ1ZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBfcmVzZXRCYWxsVG9QbGF5ZXIoKSB7CiAgICAgICAgICAgIGNvbnN0IHAgPSB0aGlzLmdhbWUudGVhbXMuaG9tZS5hY3RpdmVQbGF5ZXI7CiAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLmdhbWUuZW50aXRpZXMuYmFsbDsKICAgICAgICAgICAgaWYgKHAgJiYgYikgewogICAgICAgICAgICAgICAgYi5yZXNldCgpOwogICAgICAgICAgICAgICAgYi5ncmFiKHApOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZS5mbG9hdGluZ1RleHQpIHRoaXMuZ2FtZS5mbG9hdGluZ1RleHQuc3Bhd24oIlJFU0VUIiwgcC5tZXNoLnBvc2l0aW9uLCAidGVjaCIpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBTbmFwIGNhbWVyYQogICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZS5jYW1lcmFNYW5hZ2VyKSB0aGlzLmdhbWUuY2FtZXJhTWFuYWdlci5zbmFwVG9UYXJnZXQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX3VwZGF0ZVNjb3JlVUkodmFsKSB7CiAgICAgICAgICAgIGNvbnN0IGVsID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKCcjZHJpbGwtc2NvcmUnKTsKICAgICAgICAgICAgaWYgKGVsKSBlbC5pbm5lclRleHQgPSBgU0NPUkU6ICR7dmFsfWA7CiAgICAgICAgfQoKICAgICAgICBfc2V0SW5zdHJ1Y3Rpb24odGV4dCkgewogICAgICAgICAgICAgY29uc3QgZWwgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoJyNkcmlsbC1pbnN0cnVjdGlvbicpOwogICAgICAgICAgICAgaWYgKGVsKSBlbC5pbm5lclRleHQgPSB0ZXh0OwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tIERSSUxMUyAtLS0KCiAgICAgICAgX3NldHVwRnJlZSgpIHsKICAgICAgICAgICAgdGhpcy5fc2V0SW5zdHJ1Y3Rpb24oIkZyZWUgcHJhY3RpY2UuIEluZmluaXRlIEhQL0VOLiIpOwogICAgICAgICAgICAvLyBTaG93IGV2ZXJ5b25lCiAgICAgICAgICAgIHRoaXMuZ2FtZS50ZWFtcy5hd2F5LnBsYXllcnMuZm9yRWFjaChwID0+IHsKICAgICAgICAgICAgICAgIGlmKHAubWVzaCkgcC5tZXNoLnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgcC5tZXNoLnBvc2l0aW9uLmNvcHkocC5ob21lUG9zaXRpb24pOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5fcmVzZXRCYWxsVG9QbGF5ZXIoKTsKICAgICAgICB9CiAgICAgICAgX2xvb3BGcmVlKGR0KSB7fQoKICAgICAgICBfc2V0dXBTaG9vdGluZygpIHsKCiAgICAgICAgICAgIHRoaXMuX3NldEluc3RydWN0aW9uKCJTY29yZSBvbiB0aGUgR29hbGllISIpOwogICAgICAgICAgICB0aGlzLmRyaWxsU3RhdGUucmVzZXR0aW5nID0gZmFsc2U7IC8vIENsZWFyIHJlc2V0IGZsYWcKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFNldHVwOiBBY3RpdmUgUGxheWVyIGF0IDE4bSwgR29hbGllIGluIG5ldC4KICAgICAgICAgICAgY29uc3QgcCA9IHRoaXMuZ2FtZS50ZWFtcy5ob21lLmFjdGl2ZVBsYXllcjsKICAgICAgICAgICAgY29uc3QgZyA9IHRoaXMuZ2FtZS50ZWFtcy5hd2F5LnBsYXllcnMuZmluZCh4ID0+IHgucm9sZSA9PT0gJ0dMJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAocCAmJiBwLm1lc2gpIHsKICAgICAgICAgICAgICAgIHAubWVzaC5wb3NpdGlvbi5zZXQoMCwgMCwgLTEwKTsgLy8gMThtIG91dCAoSG9tZSBhdHRhY2tzIC1aKQogICAgICAgICAgICAgICAgcC5tZXNoLmxvb2tBdCgwLCAwLCAtMjgpOwogICAgICAgICAgICAgICAgcC52ZWxvY2l0eS5zZXQoMCwwLDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChnICYmIGcubWVzaCkgewogICAgICAgICAgICAgICAgZy5tZXNoLnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgZy5tZXNoLnBvc2l0aW9uLnNldCgwLCAwLCAtMjcpOwogICAgICAgICAgICAgICAgZy5tZXNoLmxvb2tBdCgwLCAwLCAwKTsKICAgICAgICAgICAgICAgIGcudmVsb2NpdHkuc2V0KDAsMCwwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5fcmVzZXRCYWxsVG9QbGF5ZXIoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgX2xvb3BTaG9vdGluZyhkdCkgewogICAgICAgICAgICBpZiAodGhpcy5kcmlsbFN0YXRlLnJlc2V0dGluZykgcmV0dXJuOwoKICAgICAgICAgICAgLy8gQ2hlY2sgaWYgZ29hbCBzY29yZWQgKEdhbWVNYW5hZ2VyIGhhbmRsZXMgdGhlIGFjdHVhbCBnb2FsIGV2ZW50LCBidXQgd2UgdHJhY2sgcmVzZXQpCiAgICAgICAgICAgIGlmICh0aGlzLmdhbWUuc3RhdGUgPT09ICdnb2FsJykgewogICAgICAgICAgICAgICAgdGhpcy5kcmlsbFN0YXRlLnJlc2V0dGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLmRyaWxsU3RhdGUuc2NvcmUrKzsKICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVNjb3JlVUkodGhpcy5kcmlsbFN0YXRlLnNjb3JlKTsKICAgICAgICAgICAgICAgIHRoaXMuZ2FtZS5zdGF0ZSA9ICdhY3RpdmUnOyAvLyBIaWphY2sgc3RhdGUgYmFjawogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLl9zZXR1cFNob290aW5nKCksIDEwMDApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBJZiBnb2FsaWUgY2F0Y2hlcwogICAgICAgICAgICBjb25zdCBnID0gdGhpcy5nYW1lLnRlYW1zLmF3YXkucGxheWVycy5maW5kKHggPT4geC5yb2xlID09PSAnR0wnKTsKICAgICAgICAgICAgaWYgKGcgJiYgZy5oYXNCYWxsKSB7CiAgICAgICAgICAgICAgICAgdGhpcy5kcmlsbFN0YXRlLnJlc2V0dGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZS5mbG9hdGluZ1RleHQpIHRoaXMuZ2FtZS5mbG9hdGluZ1RleHQuc3Bhd24oIlNBVkVEIiwgZy5tZXNoLnBvc2l0aW9uLCAiZGFtYWdlIik7CiAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLl9zZXR1cFNob290aW5nKCksIDEwMDApOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBfc2V0dXBQYXNzaW5nKCkgewoKICAgICAgICAgICAgIHRoaXMuX3NldEluc3RydWN0aW9uKCJQYXNzIHRvIHRoZSBtb3ZpbmcgdGFyZ2V0ISIpOwogICAgICAgICAgICAgdGhpcy5kcmlsbFN0YXRlLnJlc2V0dGluZyA9IGZhbHNlOwoKICAgICAgICAgICAgIC8vIFNldHVwOiBBY3RpdmUgUGxheWVyIGNlbnRlci4gMSBUZWFtbWF0ZSBydW5uaW5nIHBhdHRlcm5zLgogICAgICAgICAgICAgY29uc3QgcCA9IHRoaXMuZ2FtZS50ZWFtcy5ob21lLmFjdGl2ZVBsYXllcjsKICAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IHRoaXMuZ2FtZS50ZWFtcy5ob21lLnBsYXllcnMuZmluZCh4ID0+IHggIT09IHAgJiYgeC5yb2xlICE9PSAnR0wnKTsKICAgICAgICAgICAgIAogICAgICAgICAgICAgdGhpcy5kcmlsbFN0YXRlLnRhcmdldCA9IHRhcmdldDsKICAgICAgICAgICAgIAogICAgICAgICAgICAgaWYgKHApIHsKICAgICAgICAgICAgICAgICBwLm1lc2gucG9zaXRpb24uc2V0KDAsIDAsIDEwKTsKICAgICAgICAgICAgICAgICBwLnZlbG9jaXR5LnNldCgwLDAsMCk7CiAgICAgICAgICAgICB9CiAgICAgICAgICAgICBpZiAodGFyZ2V0KSB7CiAgICAgICAgICAgICAgICAgdGFyZ2V0Lm1lc2gucG9zaXRpb24uc2V0KDAsIDAsIC0xMCk7CiAgICAgICAgICAgICAgICAgdGFyZ2V0Lm1lc2gudmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgdGFyZ2V0LnZlbG9jaXR5LnNldCgwLDAsMCk7CiAgICAgICAgICAgICB9CiAgICAgICAgICAgICAKICAgICAgICAgICAgIHRoaXMuX3Jlc2V0QmFsbFRvUGxheWVyKCk7CiAgICAgICAgfQoKICAgICAgICBfbG9vcFBhc3NpbmcoZHQpIHsKICAgICAgICAgICAgaWYgKHRoaXMuZHJpbGxTdGF0ZS5yZXNldHRpbmcpIHJldHVybjsKCiAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IHRoaXMuZHJpbGxTdGF0ZS50YXJnZXQ7CiAgICAgICAgICAgIGlmICghdGFyZ2V0KSByZXR1cm47CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBNb3ZlIHRhcmdldCBpbiBjaXJjbGUKICAgICAgICAgICAgdGhpcy5kcmlsbFN0YXRlLnRpbWVyICs9IGR0OwogICAgICAgICAgICB0YXJnZXQubWVzaC5wb3NpdGlvbi54ID0gTWF0aC5zaW4odGhpcy5kcmlsbFN0YXRlLnRpbWVyKSAqIDEwOwogICAgICAgICAgICB0YXJnZXQubWVzaC5wb3NpdGlvbi56ID0gLTEwICsgTWF0aC5jb3ModGhpcy5kcmlsbFN0YXRlLnRpbWVyICogMC41KSAqIDU7CiAgICAgICAgICAgIHRhcmdldC5tZXNoLmxvb2tBdCgwLDAsMTApOwoKICAgICAgICAgICAgLy8gVXBkYXRlIFJpbmcKICAgICAgICAgICAgaWYgKHRoaXMudGFyZ2V0UmluZykgewogICAgICAgICAgICAgICAgdGhpcy50YXJnZXRSaW5nLnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy50YXJnZXRSaW5nLnBvc2l0aW9uLmNvcHkodGFyZ2V0Lm1lc2gucG9zaXRpb24pOwogICAgICAgICAgICAgICAgdGhpcy50YXJnZXRSaW5nLnBvc2l0aW9uLnkgPSAwLjE7CiAgICAgICAgICAgICAgICB0aGlzLnRhcmdldFJpbmcubWF0ZXJpYWwuY29sb3Iuc2V0SGV4KDB4MDBmZmZmKTsgLy8gQ3lhbgogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGFyZ2V0Lmhhc0JhbGwpIHsKICAgICAgICAgICAgICAgIHRoaXMuZHJpbGxTdGF0ZS5yZXNldHRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5kcmlsbFN0YXRlLnNjb3JlKys7CiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVTY29yZVVJKHRoaXMuZHJpbGxTdGF0ZS5zY29yZSk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5nYW1lLmZsb2F0aW5nVGV4dCkgdGhpcy5nYW1lLmZsb2F0aW5nVGV4dC5zcGF3bigiTklDRSBQQVNTISIsIHRhcmdldC5tZXNoLnBvc2l0aW9uLCAiaGVhbCIpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBSZXNldAogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0Lmxvc2VCYWxsKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0dXBQYXNzaW5nKCk7IC8vIFJlLXNldHVwIHRvIHJlc2V0IHBvc2l0aW9ucwogICAgICAgICAgICAgICAgfSwgODAwKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBfc2V0dXBEZWZlbnNlKCkgewoKICAgICAgICAgICAgdGhpcy5fc2V0SW5zdHJ1Y3Rpb24oIlRhY2tsZSB0aGUgYXR0YWNrZXIhIik7CiAgICAgICAgICAgIHRoaXMuZHJpbGxTdGF0ZS5yZXNldHRpbmcgPSBmYWxzZTsKCiAgICAgICAgICAgIGNvbnN0IHAgPSB0aGlzLmdhbWUudGVhbXMuaG9tZS5hY3RpdmVQbGF5ZXI7CiAgICAgICAgICAgIGNvbnN0IGF0dGFja2VyID0gdGhpcy5nYW1lLnRlYW1zLmF3YXkucGxheWVycy5maW5kKHggPT4geC5yb2xlID09PSAnTUYnKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHRoaXMuZHJpbGxTdGF0ZS5hdHRhY2tlciA9IGF0dGFja2VyOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHApIHsKICAgICAgICAgICAgICAgIHAubWVzaC5wb3NpdGlvbi5zZXQoMCwgMCwgMjApOyAvLyBOZWFyIG93biBnb2FsCiAgICAgICAgICAgICAgICBwLnZlbG9jaXR5LnNldCgwLDAsMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGF0dGFja2VyKSB7CiAgICAgICAgICAgICAgICBhdHRhY2tlci5tZXNoLnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgYXR0YWNrZXIubWVzaC5wb3NpdGlvbi5zZXQoMCwgMCwgLTEwKTsKICAgICAgICAgICAgICAgIGF0dGFja2VyLnZlbG9jaXR5LnNldCgwLDAsMCk7CiAgICAgICAgICAgICAgICAvLyBHaXZlIGJhbGwgdG8gYXR0YWNrZXIKICAgICAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLmdhbWUuZW50aXRpZXMuYmFsbDsKICAgICAgICAgICAgICAgIGIucmVzZXQoKTsKICAgICAgICAgICAgICAgIGIuZ3JhYihhdHRhY2tlcik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgX2xvb3BEZWZlbnNlKGR0KSB7CiAgICAgICAgICAgIGlmICh0aGlzLmRyaWxsU3RhdGUucmVzZXR0aW5nKSByZXR1cm47CgogICAgICAgICAgICBjb25zdCBhdHRhY2tlciA9IHRoaXMuZHJpbGxTdGF0ZS5hdHRhY2tlcjsKICAgICAgICAgICAgY29uc3QgcCA9IHRoaXMuZ2FtZS50ZWFtcy5ob21lLmFjdGl2ZVBsYXllcjsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICghYXR0YWNrZXIgfHwgIXApIHJldHVybjsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEF0dGFja2VyIHJ1bnMgdG8gZ29hbCAoK1opCiAgICAgICAgICAgIGNvbnN0IGdvYWxQb3MgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAyOCk7CiAgICAgICAgICAgIGNvbnN0IGRpciA9IGdvYWxQb3MuY2xvbmUoKS5zdWIoYXR0YWNrZXIubWVzaC5wb3NpdGlvbikubm9ybWFsaXplKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBVcGRhdGUgUmluZyBvbiBBdHRhY2tlcgogICAgICAgICAgICBpZiAodGhpcy50YXJnZXRSaW5nKSB7CiAgICAgICAgICAgICAgICB0aGlzLnRhcmdldFJpbmcudmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLnRhcmdldFJpbmcucG9zaXRpb24uY29weShhdHRhY2tlci5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgIHRoaXMudGFyZ2V0UmluZy5wb3NpdGlvbi55ID0gMC4xOwogICAgICAgICAgICAgICAgdGhpcy50YXJnZXRSaW5nLm1hdGVyaWFsLmNvbG9yLnNldEhleCgweGZmMDAwMCk7IC8vIFJlZCBmb3IgZW5lbXkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGF0dGFja2VyLmhhc0JhbGwpIHsKICAgICAgICAgICAgICAgIGF0dGFja2VyLnNldElucHV0KGRpci54LCBkaXIueik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBCYWxsIGxvc3QgKFRhY2tsZWQpCiAgICAgICAgICAgICAgICBpZiAocC5oYXNCYWxsIHx8IHRoaXMuZ2FtZS5lbnRpdGllcy5iYWxsLnN0YXRlID09PSAnZnJlZScpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmRyaWxsU3RhdGUucmVzZXR0aW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmRyaWxsU3RhdGUuc2NvcmUrKzsKICAgICAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVTY29yZVVJKHRoaXMuZHJpbGxTdGF0ZS5zY29yZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZS5mbG9hdGluZ1RleHQpIHRoaXMuZ2FtZS5mbG9hdGluZ1RleHQuc3Bhd24oIlNUT1BQRUQhIiwgcC5tZXNoLnBvc2l0aW9uLCAiYmxvY2siKTsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMuX3NldHVwRGVmZW5zZSgpLCAxMDAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRmFpbCBjb25kaXRpb246IEF0dGFja2VyIHNjb3JlcyAoR2FtZU1hbmFnZXIgaGFuZGxlcyBnb2FsIGNoZWNrKQogICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZS5zdGF0ZSA9PT0gJ2dvYWwnKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRyaWxsU3RhdGUucmVzZXR0aW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMuZ2FtZS5zdGF0ZSA9ICdhY3RpdmUnOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZS5mbG9hdGluZ1RleHQpIHRoaXMuZ2FtZS5mbG9hdGluZ1RleHQuc3Bhd24oIkZBSUxFRCIsIHAubWVzaC5wb3NpdGlvbiwgImRhbWFnZSIpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLl9zZXR1cERlZmVuc2UoKSwgMTAwMCk7CiAgICAgICAgICAgIH0KICAgICAgICB9Cl9zaG93UGFuZWwoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnVpKSB0aGlzLnVpLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgIH0KCiAgICAgICAgX2hpZGVQYW5lbCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMudWkpIHRoaXMudWkuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgfQoKICAgICAgICBfc2hvd1Jlc3RvcmVCdG4oKSB7CiAgICAgICAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmFjdGljZS1yZXN0b3JlLWJ0bicpOwogICAgICAgICAgICBpZiAoYnRuKSBidG4uc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgfQoKICAgICAgICBfaGlkZVJlc3RvcmVCdG4oKSB7CiAgICAgICAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmFjdGljZS1yZXN0b3JlLWJ0bicpOwogICAgICAgICAgICBpZiAoYnRuKSBidG4uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICB9CiAgICB9CndpbmRvdy5mbHV4LlByYWN0aWNlTWFuYWdlciA9IFByYWN0aWNlTWFuYWdlcjsKfSkoKTs=","/PracticeManager.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICBjbGFzcyBQcmFjdGljZU1hbmFnZXIgewogICAgICAgIGNvbnN0cnVjdG9yKGdhbWVNYW5hZ2VyKSB7CiAgICAgICAgICAgIHRoaXMuZ2FtZSA9IGdhbWVNYW5hZ2VyOwogICAgICAgICAgICB0aGlzLmlzUnVubmluZyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmN1cnJlbnREcmlsbCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuZHJpbGxTdGF0ZSA9IHt9OyAKICAgICAgICAgICAgCiAgICAgICAgICAgIHRoaXMuZHJpbGxzID0gewogICAgICAgICAgICAgICAgJ2ZyZWUnOiB7IG5hbWU6ICdGUkVFIFJPQU0nLCBzZXR1cDogdGhpcy5fc2V0dXBGcmVlLmJpbmQodGhpcyksIGxvb3A6IHRoaXMuX2xvb3BGcmVlLmJpbmQodGhpcykgfSwKICAgICAgICAgICAgICAgICdzaG9vdGluZyc6IHsgbmFtZTogJ1NIT09USU5HIERSSUxMJywgc2V0dXA6IHRoaXMuX3NldHVwU2hvb3RpbmcuYmluZCh0aGlzKSwgbG9vcDogdGhpcy5fbG9vcFNob290aW5nLmJpbmQodGhpcykgfSwKICAgICAgICAgICAgICAgICdwYXNzaW5nJzogeyBuYW1lOiAnUEFTU0lORyBEUklMTCcsIHNldHVwOiB0aGlzLl9zZXR1cFBhc3NpbmcuYmluZCh0aGlzKSwgbG9vcDogdGhpcy5fbG9vcFBhc3NpbmcuYmluZCh0aGlzKSB9LAogICAgICAgICAgICAgICAgJ2RlZmVuc2UnOiB7IG5hbWU6ICdERUZFTlNFIERSSUxMJywgc2V0dXA6IHRoaXMuX3NldHVwRGVmZW5zZS5iaW5kKHRoaXMpLCBsb29wOiB0aGlzLl9sb29wRGVmZW5zZS5iaW5kKHRoaXMpIH0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHRoaXMudWkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJhY3RpY2Utb3ZlcmxheScpOwogICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSB7CiAgICAgICAgICAgICAgICBpbmZTdGF0czogdHJ1ZSwKICAgICAgICAgICAgICAgIGFpRHVtbXk6IHRydWUsCiAgICAgICAgICAgICAgICBzaG93SGl0Ym94ZXM6IGZhbHNlCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIAogICAgICAgICAgICB0aGlzLnRhcmdldFJpbmcgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9pbml0VmlzdWFscygpOwogICAgICAgICAgICB0aGlzLl9zZXR1cEV2ZW50cygpOwogICAgICAgIH0KCiAgICAgICAgX2luaXRWaXN1YWxzKCkgewogICAgICAgICAgICAvLyBDcmVhdGUgYSBnbG93aW5nIHJpbmcgZm9yIHRhcmdldHMKICAgICAgICAgICAgY29uc3QgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuUmluZ0dlb21ldHJ5KDEuNSwgMS44LCAzMik7CiAgICAgICAgICAgIGdlb21ldHJ5LnJvdGF0ZVgoLU1hdGguUEkgLyAyKTsKICAgICAgICAgICAgY29uc3QgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyAKICAgICAgICAgICAgICAgIGNvbG9yOiAweDAwZmZmZiwgCiAgICAgICAgICAgICAgICBzaWRlOiBUSFJFRS5Eb3VibGVTaWRlLCAKICAgICAgICAgICAgICAgIHRyYW5zcGFyZW50OiB0cnVlLCAKICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAuNiwKICAgICAgICAgICAgICAgIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nLAogICAgICAgICAgICAgICAgZGVwdGhXcml0ZTogZmFsc2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMudGFyZ2V0UmluZyA9IG5ldyBUSFJFRS5NZXNoKGdlb21ldHJ5LCBtYXRlcmlhbCk7CiAgICAgICAgICAgIHRoaXMudGFyZ2V0UmluZy52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgIC8vIEFkZCB0byBzY2VuZSB2aWEgZ2FtZSBtYW5hZ2VyIHJlZmVyZW5jZQogICAgICAgICAgICBpZiAodGhpcy5nYW1lLnNjZW5lKSB0aGlzLmdhbWUuc2NlbmUuYWRkKHRoaXMudGFyZ2V0UmluZyk7CiAgICAgICAgfQoKICAgICAgICBzdGFydCgpIHsKdGhpcy5pc1J1bm5pbmcgPSB0cnVlOwogICAgICAgICAgICB0aGlzLl9zaG93UGFuZWwoKTsKICAgICAgICAgICAgdGhpcy5zZXREcmlsbCgnZnJlZScpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRW5zdXJlIEhVRCBpcyB2aXNpYmxlCiAgICAgICAgICAgIGNvbnN0IGh1ZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1aS1sYXllcicpOwogICAgICAgICAgICBpZihodWQpIGh1ZC5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnOwogICAgICAgIH0KCiAgICAgICAgc3RvcCgpIHsKCiAgICAgICAgICAgIHRoaXMuaXNSdW5uaW5nID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2hpZGVQYW5lbCgpOwogICAgICAgICAgICB0aGlzLl9oaWRlUmVzdG9yZUJ0bigpOwogICAgICAgICAgICB0aGlzLl9jbGVhckRyaWxsKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAodGhpcy50YXJnZXRSaW5nKSB0aGlzLnRhcmdldFJpbmcudmlzaWJsZSA9IGZhbHNlOwoKICAgICAgICAgICAgLy8gUmVzdG9yZSBBd2F5IFRlYW0gVmlzaWJpbGl0eSBmb3IgTm9ybWFsIE1hdGNoCiAgICAgICAgICAgIGlmICh0aGlzLmdhbWUudGVhbXMuYXdheSkgewogICAgICAgICAgICAgICAgdGhpcy5nYW1lLnRlYW1zLmF3YXkucGxheWVycy5mb3JFYWNoKHAgPT4gewogICAgICAgICAgICAgICAgICAgIGlmKHAubWVzaCkgewogICAgICAgICAgICAgICAgICAgICAgICBwLm1lc2gudmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIHAubWVzaC5wb3NpdGlvbi55ID0gMDsgLy8gRW5zdXJlIHRoZXkgYXJlbid0IHN0dWNrIHVuZGVyIGZsb29yCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIERpc2FibGUgZGVidWcgdmlzdWFscyBpZiB0aGV5IHdlcmUgb24KICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZS5kZWJ1Z1Zpc3VhbGl6ZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMuZ2FtZS5kZWJ1Z1Zpc3VhbGl6ZXIuZW5hYmxlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5nYW1lLmRlYnVnVmlzdWFsaXplci5zaG93SGl0Ym94ZXMgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgc2V0RHJpbGwoa2V5KSB7CiAgICAgICAgICAgIGlmICghdGhpcy5kcmlsbHNba2V5XSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9jbGVhckRyaWxsKCk7CiAgICAgICAgICAgIHRoaXMuY3VycmVudERyaWxsID0ga2V5OwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVXBkYXRlIFVJCiAgICAgICAgICAgIGlmICh0aGlzLnVpKSB7CiAgICAgICAgICAgICAgICB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3JBbGwoJy5kcmlsbC1idG4nKS5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgICAgICAgICAgICAgYnRuLmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScsIGJ0bi5kYXRhc2V0LmRyaWxsID09PSBrZXkpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFJ1biBTZXR1cAogICAgICAgICAgICB0aGlzLmRyaWxsc1trZXldLnNldHVwKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBBbm5vdW5jZW1lbnQKICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZS5zaG93QW5ub3VuY2VtZW50KSB7CiAgICAgICAgICAgICAgICB0aGlzLmdhbWUuc2hvd0Fubm91bmNlbWVudCh0aGlzLmRyaWxsc1trZXldLm5hbWUsICdub3JtYWwnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdXBkYXRlKGR0KSB7CiAgICAgICAgICAgIGlmICghdGhpcy5pc1J1bm5pbmcpIHJldHVybjsKCiAgICAgICAgICAgIC8vIENvbW1vbiBQcmFjdGljZSBMb2dpYyAoSW5maW5pdGUgU3RhdHMpCiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaW5mU3RhdHMpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2FwcGx5SW5maW5pdGVTdGF0cygpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBEcmlsbCBMb2dpYwogICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50RHJpbGwgJiYgdGhpcy5kcmlsbHNbdGhpcy5jdXJyZW50RHJpbGxdLmxvb3ApIHsKICAgICAgICAgICAgICAgIHRoaXMuZHJpbGxzW3RoaXMuY3VycmVudERyaWxsXS5sb29wKGR0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVmlzdWFscyBBbmltYXRpb24KICAgICAgICAgICAgaWYgKHRoaXMudGFyZ2V0UmluZyAmJiB0aGlzLnRhcmdldFJpbmcudmlzaWJsZSkgewogICAgICAgICAgICAgICAgdGhpcy50YXJnZXRSaW5nLnJvdGF0aW9uLnogKz0gZHQ7IC8vIFNwaW4KICAgICAgICAgICAgICAgIGNvbnN0IHMgPSAxLjAgKyBNYXRoLnNpbihEYXRlLm5vdygpICogMC4wMDUpICogMC4xOwogICAgICAgICAgICAgICAgdGhpcy50YXJnZXRSaW5nLnNjYWxlLnNldChzLCBzLCBzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX3NldHVwRXZlbnRzKCkgewppZiAoIXRoaXMudWkpIHJldHVybjsKCiAgICAgICAgICAgIC8vIE1pbmltaXplIC8gUmVzdG9yZQogICAgICAgICAgICBjb25zdCBtaW5CdG4gPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoJyNwLW1pbmltaXplJyk7CiAgICAgICAgICAgIGlmIChtaW5CdG4pIHsKICAgICAgICAgICAgICAgIG1pbkJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9oaWRlUGFuZWwoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zaG93UmVzdG9yZUJ0bigpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IHJlc3RvcmVCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJhY3RpY2UtcmVzdG9yZS1idG4nKTsKICAgICAgICAgICAgaWYgKHJlc3RvcmVCdG4pIHsKICAgICAgICAgICAgICAgIHJlc3RvcmVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2hvd1BhbmVsKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faGlkZVJlc3RvcmVCdG4oKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBEcmlsbCBCdXR0b25zCiAgICAgICAgICAgIHRoaXMudWkucXVlcnlTZWxlY3RvckFsbCgnLmRyaWxsLWJ0bicpLmZvckVhY2goYnRuID0+IHsKICAgICAgICAgICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNldERyaWxsKGJ0bi5kYXRhc2V0LmRyaWxsKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIFJlc2V0IEJhbGwKICAgICAgICAgICAgY29uc3QgcmVzZXRCdG4gPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoJyNwLXJlc2V0LWJhbGwnKTsKICAgICAgICAgICAgaWYgKHJlc2V0QnRuKSB7CiAgICAgICAgICAgICAgICByZXNldEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXNldEJhbGxUb1BsYXllcigpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEV4aXQKICAgICAgICAgICAgY29uc3QgZXhpdEJ0biA9IHRoaXMudWkucXVlcnlTZWxlY3RvcignI3AtZXhpdCcpOwogICAgICAgICAgICBpZiAoZXhpdEJ0bikgewogICAgICAgICAgICAgICAgZXhpdEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlICYmIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5tZW51TWFuYWdlcikgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UubWVudU1hbmFnZXIuc2hvdygpOwogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2Uuc3RhdGUgPSAnbWVudSc7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBPcHRpb25zIFRvZ2dsZXMKICAgICAgICAgICAgdGhpcy5fYmluZFRvZ2dsZSgnb3B0LWluZi1zdGF0JywgJ2luZlN0YXRzJyk7CiAgICAgICAgICAgIHRoaXMuX2JpbmRUb2dnbGUoJ29wdC1haS1kdW1teScsICdhaUR1bW15JywgKHZhbCkgPT4gewogICAgICAgICAgICAgICAgLy8gVXBkYXRlIEFJIER1bW15IHN0YXRlIGltbWVkaWF0ZWx5CiAgICAgICAgICAgICAgICBpZiAodGhpcy5nYW1lLnRlYW1zLmF3YXkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmdhbWUudGVhbXMuYXdheS5haUVuYWJsZWQgPSAhdmFsOyAvLyBJZiBkdW1teSBpcyBUUlVFLCBBSSBpcyBGQUxTRQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5fYmluZFRvZ2dsZSgnb3B0LWhpdGJveGVzJywgJ3Nob3dIaXRib3hlcycsICh2YWwpID0+IHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmdhbWUuZGVidWdWaXN1YWxpemVyKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5nYW1lLmRlYnVnVmlzdWFsaXplci5lbmFibGVkID0gdmFsOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZ2FtZS5kZWJ1Z1Zpc3VhbGl6ZXIuc2hvd0hpdGJveGVzID0gdmFsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIEtleWJvYXJkIFNob3J0Y3V0IGZvciBSZXNldCAoUikKLy8gS2V5Ym9hcmQgU2hvcnRjdXQgZm9yIFJlc2V0IChSKQogICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChlKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1J1bm5pbmcgJiYgZS5rZXkudG9Mb3dlckNhc2UoKSA9PT0gJ3InICYmICFlLnJlcGVhdCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3Jlc2V0QmFsbFRvUGxheWVyKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCl9iaW5kVG9nZ2xlKGlkLCBvcHRpb25LZXksIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIGNvbnN0IGVsID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKGAjJHtpZH1gKTsKICAgICAgICAgICAgaWYgKCFlbCkgcmV0dXJuOwoKICAgICAgICAgICAgLy8gSGVscGVyIHRvIHVwZGF0ZSB2aXN1YWxzCiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZVZpc3VhbCA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGlzQWN0aXZlID0gdGhpcy5vcHRpb25zW29wdGlvbktleV07CiAgICAgICAgICAgICAgICBlbC5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnLCBpc0FjdGl2ZSk7CiAgICAgICAgICAgICAgICBjb25zdCBib3ggPSBlbC5xdWVyeVNlbGVjdG9yKCcuY2hlY2tib3gnKTsKICAgICAgICAgICAgICAgIGlmIChib3gpIGJveC5pbm5lclRleHQgPSBpc0FjdGl2ZSA/ICfilqMnIDogJ+KWoSc7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBJbml0aWFsaXplIHZpc3VhbCBzdGF0ZSBpbW1lZGlhdGVseQogICAgICAgICAgICB1cGRhdGVWaXN1YWwoKTsKCiAgICAgICAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnNbb3B0aW9uS2V5XSA9ICF0aGlzLm9wdGlvbnNbb3B0aW9uS2V5XTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdXBkYXRlVmlzdWFsKCk7CgogICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjayh0aGlzLm9wdGlvbnNbb3B0aW9uS2V5XSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgX2FwcGx5SW5maW5pdGVTdGF0cygpIHsKICAgICAgICAgICAgY29uc3QgaG9tZSA9IHRoaXMuZ2FtZS50ZWFtcy5ob21lOwogICAgICAgICAgICBpZiAoaG9tZSkgewogICAgICAgICAgICAgICAgaG9tZS5wbGF5ZXJzLmZvckVhY2gocCA9PiB7CiAgICAgICAgICAgICAgICAgICAgcC5zdGF0cy5IUCA9IHAuc3RhdHMubWF4SFA7CiAgICAgICAgICAgICAgICAgICAgcC5jdXJyZW50RU4gPSBwLnN0YXRzLkVOOwogICAgICAgICAgICAgICAgICAgIHAuc3RhdHVzLnZlbm9tID0gMDsKICAgICAgICAgICAgICAgICAgICBwLnN0YXR1cy5uYXAgPSAwOwogICAgICAgICAgICAgICAgICAgIHAuc3R1blRpbWVyID0gMDsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBfY2xlYXJEcmlsbCgpIHsKICAgICAgICAgICAgLy8gUmVzZXQgcG9zaXRpb25zLCBjbGVhciBkdW1taWVzLCByZXNldCBzY29yZQp0aGlzLmRyaWxsU3RhdGUgPSB7IHNjb3JlOiAwLCB0aW1lcjogMCwgc3RhZ2U6IDAsIHJlc2V0dGluZzogZmFsc2UgfTsKICAgICAgICAgICAgdGhpcy5fdXBkYXRlU2NvcmVVSSgwKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh0aGlzLnRhcmdldFJpbmcpIHRoaXMudGFyZ2V0UmluZy52aXNpYmxlID0gZmFsc2U7CgogICAgICAgICAgICAvLyBSZXNldCB0ZWFtcyB0byBkZWZhdWx0IHBvc2l0aW9ucwogICAgICAgICAgICB0aGlzLmdhbWUudGVhbXMuaG9tZS5yZXNldFBvc2l0aW9ucygpOwogICAgICAgICAgICB0aGlzLmdhbWUudGVhbXMuYXdheS5yZXNldFBvc2l0aW9ucygpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQXBwbHkgQUkgRHVtbXkgc2V0dGluZwogICAgICAgICAgICBpZiAodGhpcy5nYW1lLnRlYW1zLmF3YXkpIHsKICAgICAgICAgICAgICAgIHRoaXMuZ2FtZS50ZWFtcy5hd2F5LmFpRW5hYmxlZCA9ICF0aGlzLm9wdGlvbnMuYWlEdW1teTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBIaWRlIGF3YXkgdGVhbSBieSBkZWZhdWx0IGluIGRyaWxscyB1bmxlc3Mgc3BlY2lmaWVkCiAgICAgICAgICAgIHRoaXMuZ2FtZS50ZWFtcy5hd2F5LnBsYXllcnMuZm9yRWFjaChwID0+IHsKICAgICAgICAgICAgICAgIGlmKHAubWVzaCkgcC5tZXNoLnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHAubWVzaC5wb3NpdGlvbi5zZXQoMCwgLTEwMCwgMCk7IC8vIE1vdmUgYXdheQogICAgICAgICAgICAgICAgcC52ZWxvY2l0eS5zZXQoMCwwLDApOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEVuc3VyZSBIb21lIHRlYW0gaXMgdmlzaWJsZQogICAgICAgICAgICB0aGlzLmdhbWUudGVhbXMuaG9tZS5wbGF5ZXJzLmZvckVhY2gocCA9PiB7CiAgICAgICAgICAgICAgICBpZihwLm1lc2gpIHAubWVzaC52aXNpYmxlID0gdHJ1ZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBfcmVzZXRCYWxsVG9QbGF5ZXIoKSB7CiAgICAgICAgICAgIGNvbnN0IHAgPSB0aGlzLmdhbWUudGVhbXMuaG9tZS5hY3RpdmVQbGF5ZXI7CiAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLmdhbWUuZW50aXRpZXMuYmFsbDsKICAgICAgICAgICAgaWYgKHAgJiYgYikgewogICAgICAgICAgICAgICAgYi5yZXNldCgpOwogICAgICAgICAgICAgICAgYi5ncmFiKHApOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZS5mbG9hdGluZ1RleHQpIHRoaXMuZ2FtZS5mbG9hdGluZ1RleHQuc3Bhd24oIlJFU0VUIiwgcC5tZXNoLnBvc2l0aW9uLCAidGVjaCIpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBTbmFwIGNhbWVyYQogICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZS5jYW1lcmFNYW5hZ2VyKSB0aGlzLmdhbWUuY2FtZXJhTWFuYWdlci5zbmFwVG9UYXJnZXQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX3VwZGF0ZVNjb3JlVUkodmFsKSB7CiAgICAgICAgICAgIGNvbnN0IGVsID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKCcjZHJpbGwtc2NvcmUnKTsKICAgICAgICAgICAgaWYgKGVsKSBlbC5pbm5lclRleHQgPSBgU0NPUkU6ICR7dmFsfWA7CiAgICAgICAgfQoKICAgICAgICBfc2V0SW5zdHJ1Y3Rpb24odGV4dCkgewogICAgICAgICAgICAgY29uc3QgZWwgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoJyNkcmlsbC1pbnN0cnVjdGlvbicpOwogICAgICAgICAgICAgaWYgKGVsKSBlbC5pbm5lclRleHQgPSB0ZXh0OwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tIERSSUxMUyAtLS0KCiAgICAgICAgX3NldHVwRnJlZSgpIHsKICAgICAgICAgICAgdGhpcy5fc2V0SW5zdHJ1Y3Rpb24oIkZyZWUgcHJhY3RpY2UuIEluZmluaXRlIEhQL0VOLiIpOwogICAgICAgICAgICAvLyBTaG93IGV2ZXJ5b25lCiAgICAgICAgICAgIHRoaXMuZ2FtZS50ZWFtcy5hd2F5LnBsYXllcnMuZm9yRWFjaChwID0+IHsKICAgICAgICAgICAgICAgIGlmKHAubWVzaCkgcC5tZXNoLnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgcC5tZXNoLnBvc2l0aW9uLmNvcHkocC5ob21lUG9zaXRpb24pOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5fcmVzZXRCYWxsVG9QbGF5ZXIoKTsKICAgICAgICB9CiAgICAgICAgX2xvb3BGcmVlKGR0KSB7fQoKICAgICAgICBfc2V0dXBTaG9vdGluZygpIHsKCiAgICAgICAgICAgIHRoaXMuX3NldEluc3RydWN0aW9uKCJTY29yZSBvbiB0aGUgR29hbGllISIpOwogICAgICAgICAgICB0aGlzLmRyaWxsU3RhdGUucmVzZXR0aW5nID0gZmFsc2U7IC8vIENsZWFyIHJlc2V0IGZsYWcKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFNldHVwOiBBY3RpdmUgUGxheWVyIGF0IDE4bSwgR29hbGllIGluIG5ldC4KICAgICAgICAgICAgY29uc3QgcCA9IHRoaXMuZ2FtZS50ZWFtcy5ob21lLmFjdGl2ZVBsYXllcjsKICAgICAgICAgICAgY29uc3QgZyA9IHRoaXMuZ2FtZS50ZWFtcy5hd2F5LnBsYXllcnMuZmluZCh4ID0+IHgucm9sZSA9PT0gJ0dMJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAocCAmJiBwLm1lc2gpIHsKICAgICAgICAgICAgICAgIHAubWVzaC5wb3NpdGlvbi5zZXQoMCwgMCwgLTEwKTsgLy8gMThtIG91dCAoSG9tZSBhdHRhY2tzIC1aKQogICAgICAgICAgICAgICAgcC5tZXNoLmxvb2tBdCgwLCAwLCAtMjgpOwogICAgICAgICAgICAgICAgcC52ZWxvY2l0eS5zZXQoMCwwLDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChnICYmIGcubWVzaCkgewogICAgICAgICAgICAgICAgZy5tZXNoLnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgZy5tZXNoLnBvc2l0aW9uLnNldCgwLCAwLCAtMjcpOwogICAgICAgICAgICAgICAgZy5tZXNoLmxvb2tBdCgwLCAwLCAwKTsKICAgICAgICAgICAgICAgIGcudmVsb2NpdHkuc2V0KDAsMCwwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5fcmVzZXRCYWxsVG9QbGF5ZXIoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgX2xvb3BTaG9vdGluZyhkdCkgewogICAgICAgICAgICBpZiAodGhpcy5kcmlsbFN0YXRlLnJlc2V0dGluZykgcmV0dXJuOwoKICAgICAgICAgICAgLy8gQ2hlY2sgaWYgZ29hbCBzY29yZWQgKEdhbWVNYW5hZ2VyIGhhbmRsZXMgdGhlIGFjdHVhbCBnb2FsIGV2ZW50LCBidXQgd2UgdHJhY2sgcmVzZXQpCiAgICAgICAgICAgIGlmICh0aGlzLmdhbWUuc3RhdGUgPT09ICdnb2FsJykgewogICAgICAgICAgICAgICAgdGhpcy5kcmlsbFN0YXRlLnJlc2V0dGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLmRyaWxsU3RhdGUuc2NvcmUrKzsKICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVNjb3JlVUkodGhpcy5kcmlsbFN0YXRlLnNjb3JlKTsKICAgICAgICAgICAgICAgIHRoaXMuZ2FtZS5zdGF0ZSA9ICdhY3RpdmUnOyAvLyBIaWphY2sgc3RhdGUgYmFjawogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLl9zZXR1cFNob290aW5nKCksIDEwMDApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBJZiBnb2FsaWUgY2F0Y2hlcwogICAgICAgICAgICBjb25zdCBnID0gdGhpcy5nYW1lLnRlYW1zLmF3YXkucGxheWVycy5maW5kKHggPT4geC5yb2xlID09PSAnR0wnKTsKICAgICAgICAgICAgaWYgKGcgJiYgZy5oYXNCYWxsKSB7CiAgICAgICAgICAgICAgICAgdGhpcy5kcmlsbFN0YXRlLnJlc2V0dGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZS5mbG9hdGluZ1RleHQpIHRoaXMuZ2FtZS5mbG9hdGluZ1RleHQuc3Bhd24oIlNBVkVEIiwgZy5tZXNoLnBvc2l0aW9uLCAiZGFtYWdlIik7CiAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLl9zZXR1cFNob290aW5nKCksIDEwMDApOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBfc2V0dXBQYXNzaW5nKCkgewoKICAgICAgICAgICAgIHRoaXMuX3NldEluc3RydWN0aW9uKCJQYXNzIHRvIHRoZSBtb3ZpbmcgdGFyZ2V0ISIpOwogICAgICAgICAgICAgdGhpcy5kcmlsbFN0YXRlLnJlc2V0dGluZyA9IGZhbHNlOwoKICAgICAgICAgICAgIC8vIFNldHVwOiBBY3RpdmUgUGxheWVyIGNlbnRlci4gMSBUZWFtbWF0ZSBydW5uaW5nIHBhdHRlcm5zLgogICAgICAgICAgICAgY29uc3QgcCA9IHRoaXMuZ2FtZS50ZWFtcy5ob21lLmFjdGl2ZVBsYXllcjsKICAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IHRoaXMuZ2FtZS50ZWFtcy5ob21lLnBsYXllcnMuZmluZCh4ID0+IHggIT09IHAgJiYgeC5yb2xlICE9PSAnR0wnKTsKICAgICAgICAgICAgIAogICAgICAgICAgICAgdGhpcy5kcmlsbFN0YXRlLnRhcmdldCA9IHRhcmdldDsKICAgICAgICAgICAgIAogICAgICAgICAgICAgaWYgKHApIHsKICAgICAgICAgICAgICAgICBwLm1lc2gucG9zaXRpb24uc2V0KDAsIDAsIDEwKTsKICAgICAgICAgICAgICAgICBwLnZlbG9jaXR5LnNldCgwLDAsMCk7CiAgICAgICAgICAgICB9CiAgICAgICAgICAgICBpZiAodGFyZ2V0KSB7CiAgICAgICAgICAgICAgICAgdGFyZ2V0Lm1lc2gucG9zaXRpb24uc2V0KDAsIDAsIC0xMCk7CiAgICAgICAgICAgICAgICAgdGFyZ2V0Lm1lc2gudmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgdGFyZ2V0LnZlbG9jaXR5LnNldCgwLDAsMCk7CiAgICAgICAgICAgICB9CiAgICAgICAgICAgICAKICAgICAgICAgICAgIHRoaXMuX3Jlc2V0QmFsbFRvUGxheWVyKCk7CiAgICAgICAgfQoKICAgICAgICBfbG9vcFBhc3NpbmcoZHQpIHsKICAgICAgICAgICAgaWYgKHRoaXMuZHJpbGxTdGF0ZS5yZXNldHRpbmcpIHJldHVybjsKCiAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IHRoaXMuZHJpbGxTdGF0ZS50YXJnZXQ7CiAgICAgICAgICAgIGlmICghdGFyZ2V0KSByZXR1cm47CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBNb3ZlIHRhcmdldCBpbiBjaXJjbGUKICAgICAgICAgICAgdGhpcy5kcmlsbFN0YXRlLnRpbWVyICs9IGR0OwogICAgICAgICAgICB0YXJnZXQubWVzaC5wb3NpdGlvbi54ID0gTWF0aC5zaW4odGhpcy5kcmlsbFN0YXRlLnRpbWVyKSAqIDEwOwogICAgICAgICAgICB0YXJnZXQubWVzaC5wb3NpdGlvbi56ID0gLTEwICsgTWF0aC5jb3ModGhpcy5kcmlsbFN0YXRlLnRpbWVyICogMC41KSAqIDU7CiAgICAgICAgICAgIHRhcmdldC5tZXNoLmxvb2tBdCgwLDAsMTApOwoKICAgICAgICAgICAgLy8gVXBkYXRlIFJpbmcKICAgICAgICAgICAgaWYgKHRoaXMudGFyZ2V0UmluZykgewogICAgICAgICAgICAgICAgdGhpcy50YXJnZXRSaW5nLnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy50YXJnZXRSaW5nLnBvc2l0aW9uLmNvcHkodGFyZ2V0Lm1lc2gucG9zaXRpb24pOwogICAgICAgICAgICAgICAgdGhpcy50YXJnZXRSaW5nLnBvc2l0aW9uLnkgPSAwLjE7CiAgICAgICAgICAgICAgICB0aGlzLnRhcmdldFJpbmcubWF0ZXJpYWwuY29sb3Iuc2V0SGV4KDB4MDBmZmZmKTsgLy8gQ3lhbgogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGFyZ2V0Lmhhc0JhbGwpIHsKICAgICAgICAgICAgICAgIHRoaXMuZHJpbGxTdGF0ZS5yZXNldHRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5kcmlsbFN0YXRlLnNjb3JlKys7CiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVTY29yZVVJKHRoaXMuZHJpbGxTdGF0ZS5zY29yZSk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5nYW1lLmZsb2F0aW5nVGV4dCkgdGhpcy5nYW1lLmZsb2F0aW5nVGV4dC5zcGF3bigiTklDRSBQQVNTISIsIHRhcmdldC5tZXNoLnBvc2l0aW9uLCAiaGVhbCIpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBSZXNldAogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0Lmxvc2VCYWxsKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0dXBQYXNzaW5nKCk7IC8vIFJlLXNldHVwIHRvIHJlc2V0IHBvc2l0aW9ucwogICAgICAgICAgICAgICAgfSwgODAwKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBfc2V0dXBEZWZlbnNlKCkgewoKICAgICAgICAgICAgdGhpcy5fc2V0SW5zdHJ1Y3Rpb24oIlRhY2tsZSB0aGUgYXR0YWNrZXIhIik7CiAgICAgICAgICAgIHRoaXMuZHJpbGxTdGF0ZS5yZXNldHRpbmcgPSBmYWxzZTsKCiAgICAgICAgICAgIGNvbnN0IHAgPSB0aGlzLmdhbWUudGVhbXMuaG9tZS5hY3RpdmVQbGF5ZXI7CiAgICAgICAgICAgIGNvbnN0IGF0dGFja2VyID0gdGhpcy5nYW1lLnRlYW1zLmF3YXkucGxheWVycy5maW5kKHggPT4geC5yb2xlID09PSAnTUYnKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHRoaXMuZHJpbGxTdGF0ZS5hdHRhY2tlciA9IGF0dGFja2VyOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHApIHsKICAgICAgICAgICAgICAgIHAubWVzaC5wb3NpdGlvbi5zZXQoMCwgMCwgMjApOyAvLyBOZWFyIG93biBnb2FsCiAgICAgICAgICAgICAgICBwLnZlbG9jaXR5LnNldCgwLDAsMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGF0dGFja2VyKSB7CiAgICAgICAgICAgICAgICBhdHRhY2tlci5tZXNoLnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgYXR0YWNrZXIubWVzaC5wb3NpdGlvbi5zZXQoMCwgMCwgLTEwKTsKICAgICAgICAgICAgICAgIGF0dGFja2VyLnZlbG9jaXR5LnNldCgwLDAsMCk7CiAgICAgICAgICAgICAgICAvLyBHaXZlIGJhbGwgdG8gYXR0YWNrZXIKICAgICAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLmdhbWUuZW50aXRpZXMuYmFsbDsKICAgICAgICAgICAgICAgIGIucmVzZXQoKTsKICAgICAgICAgICAgICAgIGIuZ3JhYihhdHRhY2tlcik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgX2xvb3BEZWZlbnNlKGR0KSB7CiAgICAgICAgICAgIGlmICh0aGlzLmRyaWxsU3RhdGUucmVzZXR0aW5nKSByZXR1cm47CgogICAgICAgICAgICBjb25zdCBhdHRhY2tlciA9IHRoaXMuZHJpbGxTdGF0ZS5hdHRhY2tlcjsKICAgICAgICAgICAgY29uc3QgcCA9IHRoaXMuZ2FtZS50ZWFtcy5ob21lLmFjdGl2ZVBsYXllcjsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICghYXR0YWNrZXIgfHwgIXApIHJldHVybjsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEF0dGFja2VyIHJ1bnMgdG8gZ29hbCAoK1opCiAgICAgICAgICAgIGNvbnN0IGdvYWxQb3MgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAyOCk7CiAgICAgICAgICAgIGNvbnN0IGRpciA9IGdvYWxQb3MuY2xvbmUoKS5zdWIoYXR0YWNrZXIubWVzaC5wb3NpdGlvbikubm9ybWFsaXplKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBVcGRhdGUgUmluZyBvbiBBdHRhY2tlcgogICAgICAgICAgICBpZiAodGhpcy50YXJnZXRSaW5nKSB7CiAgICAgICAgICAgICAgICB0aGlzLnRhcmdldFJpbmcudmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLnRhcmdldFJpbmcucG9zaXRpb24uY29weShhdHRhY2tlci5tZXNoLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgIHRoaXMudGFyZ2V0UmluZy5wb3NpdGlvbi55ID0gMC4xOwogICAgICAgICAgICAgICAgdGhpcy50YXJnZXRSaW5nLm1hdGVyaWFsLmNvbG9yLnNldEhleCgweGZmMDAwMCk7IC8vIFJlZCBmb3IgZW5lbXkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGF0dGFja2VyLmhhc0JhbGwpIHsKICAgICAgICAgICAgICAgIGF0dGFja2VyLnNldElucHV0KGRpci54LCBkaXIueik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBCYWxsIGxvc3QgKFRhY2tsZWQpCiAgICAgICAgICAgICAgICBpZiAocC5oYXNCYWxsIHx8IHRoaXMuZ2FtZS5lbnRpdGllcy5iYWxsLnN0YXRlID09PSAnZnJlZScpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmRyaWxsU3RhdGUucmVzZXR0aW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmRyaWxsU3RhdGUuc2NvcmUrKzsKICAgICAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVTY29yZVVJKHRoaXMuZHJpbGxTdGF0ZS5zY29yZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZS5mbG9hdGluZ1RleHQpIHRoaXMuZ2FtZS5mbG9hdGluZ1RleHQuc3Bhd24oIlNUT1BQRUQhIiwgcC5tZXNoLnBvc2l0aW9uLCAiYmxvY2siKTsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMuX3NldHVwRGVmZW5zZSgpLCAxMDAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRmFpbCBjb25kaXRpb246IEF0dGFja2VyIHNjb3JlcyAoR2FtZU1hbmFnZXIgaGFuZGxlcyBnb2FsIGNoZWNrKQogICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZS5zdGF0ZSA9PT0gJ2dvYWwnKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRyaWxsU3RhdGUucmVzZXR0aW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMuZ2FtZS5zdGF0ZSA9ICdhY3RpdmUnOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZS5mbG9hdGluZ1RleHQpIHRoaXMuZ2FtZS5mbG9hdGluZ1RleHQuc3Bhd24oIkZBSUxFRCIsIHAubWVzaC5wb3NpdGlvbiwgImRhbWFnZSIpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLl9zZXR1cERlZmVuc2UoKSwgMTAwMCk7CiAgICAgICAgICAgIH0KICAgICAgICB9Cl9zaG93UGFuZWwoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnVpKSB0aGlzLnVpLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgIH0KCiAgICAgICAgX2hpZGVQYW5lbCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMudWkpIHRoaXMudWkuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgfQoKICAgICAgICBfc2hvd1Jlc3RvcmVCdG4oKSB7CiAgICAgICAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmFjdGljZS1yZXN0b3JlLWJ0bicpOwogICAgICAgICAgICBpZiAoYnRuKSBidG4uc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgfQoKICAgICAgICBfaGlkZVJlc3RvcmVCdG4oKSB7CiAgICAgICAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmFjdGljZS1yZXN0b3JlLWJ0bicpOwogICAgICAgICAgICBpZiAoYnRuKSBidG4uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICB9CiAgICB9CndpbmRvdy5mbHV4LlByYWN0aWNlTWFuYWdlciA9IFByYWN0aWNlTWFuYWdlcjsKfSkoKTs=","WaterOverlay.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICAvLyAtLS0gSGlnaC1RdWFsaXR5IE5vaXNlIFRleHR1cmUgR2VuZXJhdG9yIC0tLQogICAgd2luZG93LmZsdXgubm9pc2VUZXh0dXJlID0gKCgpID0+IHsKICAgICAgICBjb25zdCBzaXplID0gNTEyOwogICAgICAgIGNvbnN0IGMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgICBjLndpZHRoID0gc2l6ZTsgYy5oZWlnaHQgPSBzaXplOwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICAKICAgICAgICBjdHguZmlsbFN0eWxlID0gJyMwMDAwMDAnOwogICAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCBzaXplLCBzaXplKTsKICAgICAgICAKICAgICAgICAvLyBHZW5lcmF0ZSBzZWFtbGVzcyBub2lzZSAoUGVybGluLWlzaCB2aWEgbGF5ZXJlZCByYW5kb20gY2lyY2xlcy9ncmFkaWVudHMpCiAgICAgICAgY29uc3QgZHJhd05vaXNlTGF5ZXIgPSAoc2NhbGUsIGFscGhhKSA9PiB7CiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGFscGhhOwogICAgICAgICAgICBjdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gJ2xpZ2h0ZXInOyAvLyBBZGRpdGl2ZQogICAgICAgICAgICBjb25zdCBjb3VudCA9IDMwMCAqIHNjYWxlOwogICAgICAgICAgICBmb3IobGV0IGk9MDsgaTxjb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCB4ID0gTWF0aC5yYW5kb20oKSAqIHNpemU7CiAgICAgICAgICAgICAgICBjb25zdCB5ID0gTWF0aC5yYW5kb20oKSAqIHNpemU7CiAgICAgICAgICAgICAgICBjb25zdCByID0gKE1hdGgucmFuZG9tKCkgKiAzMCArIDEwKSAvIHNjYWxlOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBnID0gY3R4LmNyZWF0ZVJhZGlhbEdyYWRpZW50KHgsIHksIDAsIHgsIHksIHIpOwogICAgICAgICAgICAgICAgZy5hZGRDb2xvclN0b3AoMCwgJyM4ODg4ODgnKTsKICAgICAgICAgICAgICAgIGcuYWRkQ29sb3JTdG9wKDEsICd0cmFuc3BhcmVudCcpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gZzsKICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsgY3R4LmFyYyh4LCB5LCByLCAwLCBNYXRoLlBJKjIpOyBjdHguZmlsbCgpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBXcmFwIGFyb3VuZCBmb3Igc2VhbWxlc3MgdGlsaW5nCiAgICAgICAgICAgICAgICBbW3gtc2l6ZSwgeV0sIFt4K3NpemUsIHldLCBbeCwgeS1zaXplXSwgW3gsIHkrc2l6ZV1dLmZvckVhY2gocG9zID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBnMiA9IGN0eC5jcmVhdGVSYWRpYWxHcmFkaWVudChwb3NbMF0sIHBvc1sxXSwgMCwgcG9zWzBdLCBwb3NbMV0sIHIpOwogICAgICAgICAgICAgICAgICAgIGcyLmFkZENvbG9yU3RvcCgwLCAnIzg4ODg4OCcpOwogICAgICAgICAgICAgICAgICAgIGcyLmFkZENvbG9yU3RvcCgxLCAndHJhbnNwYXJlbnQnKTsKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gZzI7CiAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOyBjdHguYXJjKHBvc1swXSwgcG9zWzFdLCByLCAwLCBNYXRoLlBJKjIpOyBjdHguZmlsbCgpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIAogICAgICAgIGRyYXdOb2lzZUxheWVyKDEuMCwgMC4zKTsKICAgICAgICBkcmF3Tm9pc2VMYXllcigyLjAsIDAuMik7CiAgICAgICAgZHJhd05vaXNlTGF5ZXIoNC4wLCAwLjEpOwogICAgICAgIAogICAgICAgIGNvbnN0IHRleCA9IG5ldyBUSFJFRS5DYW52YXNUZXh0dXJlKGMpOwogICAgICAgIHRleC53cmFwUyA9IFRIUkVFLlJlcGVhdFdyYXBwaW5nOwogICAgICAgIHRleC53cmFwVCA9IFRIUkVFLlJlcGVhdFdyYXBwaW5nOwogICAgICAgIHJldHVybiB0ZXg7CiAgICB9KSgpOwoKICAgIGNsYXNzIFdhdGVyT3ZlcmxheSB7CiAgICAgICAgY29uc3RydWN0b3IoY2FtZXJhKSB7CiAgICAgICAgICAgIHRoaXMuY2FtZXJhID0gY2FtZXJhOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRnVsbHNjcmVlbiBxdWFkCiAgICAgICAgICAgIGNvbnN0IGdlb21ldHJ5ID0gbmV3IFRIUkVFLlBsYW5lR2VvbWV0cnkoMiwgMik7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCB2ZXJ0ID0gYAogICAgICAgICAgICAgICAgdmFyeWluZyB2ZWMyIHZVdjsKICAgICAgICAgICAgICAgIHZvaWQgbWFpbigpIHsKICAgICAgICAgICAgICAgICAgICB2VXYgPSB1djsKICAgICAgICAgICAgICAgICAgICBnbF9Qb3NpdGlvbiA9IHZlYzQocG9zaXRpb24sIDEuMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGA7CgogICAgICAgICAgICBjb25zdCBmcmFnID0gYAogICAgICAgICAgICAgICAgdW5pZm9ybSBmbG9hdCB1VGltZTsKICAgICAgICAgICAgICAgIHVuaWZvcm0gZmxvYXQgdU9wYWNpdHk7CiAgICAgICAgICAgICAgICB1bmlmb3JtIHNhbXBsZXIyRCB0Tm9pc2U7CiAgICAgICAgICAgICAgICB2YXJ5aW5nIHZlYzIgdlV2OwoKICAgICAgICAgICAgICAgIC8vIEZGWCBQYWxldHRlIChBZGRpdGl2ZSBGcmllbmRseSkKICAgICAgICAgICAgICAgIGNvbnN0IHZlYzMgQ19ERUVQID0gdmVjMygwLjAsIDAuMDIsIDAuMSk7ICAgICAvLyBTdWJ0bGUgRGVlcCBCbHVlIEVkZ2UKICAgICAgICAgICAgICAgIGNvbnN0IHZlYzMgQ19HTE9XID0gdmVjMygwLjAsIDAuNSwgMC44KTsgICAgICAvLyBDeWFuIEdsb3cKICAgICAgICAgICAgICAgIGNvbnN0IHZlYzMgQ19SQVkgID0gdmVjMygwLjQsIDAuNywgMS4wKTsgICAgICAvLyBMaWdodCBTaGFmdHMKICAgICAgICAgICAgICAgIGNvbnN0IHZlYzMgQ19QWVJFID0gdmVjMygxLjAsIDAuOSwgMC42KTsgICAgICAvLyBQeXJlZmx5IEdvbGQKCiAgICAgICAgICAgICAgICBmbG9hdCBoYXNoKHZlYzIgcCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmcmFjdChzaW4oZG90KHAsIHZlYzIoMTIuOTg5OCwgNzguMjMzKSkpICogNDM3NTguNTQ1Myk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZmxvYXQgcHlyZWZseSh2ZWMyIHV2LCBmbG9hdCB0LCBmbG9hdCBzZWVkKSB7CiAgICAgICAgICAgICAgICAgICAgdmVjMiBwID0gdXYgKiAoOC4wICsgc2VlZCk7CiAgICAgICAgICAgICAgICAgICAgdmVjMiBpZCA9IGZsb29yKHApOwogICAgICAgICAgICAgICAgICAgIHZlYzIgc3ViID0gZnJhY3QocCkgLSAwLjU7CiAgICAgICAgICAgICAgICAgICAgZmxvYXQgbiA9IGhhc2goaWQgKyBzZWVkKTsKICAgICAgICAgICAgICAgICAgICBmbG9hdCB4ID0gc2luKHQgKiAoMS4wICsgbikgKyBuICogMTAuMCkgKiAwLjQ7CiAgICAgICAgICAgICAgICAgICAgZmxvYXQgeSA9IGNvcyh0ICogKDAuOCArIG4pICsgbiAqIDIwLjApICogMC40OwogICAgICAgICAgICAgICAgICAgIGZsb2F0IGQgPSBsZW5ndGgoc3ViIC0gdmVjMih4LCB5KSk7CiAgICAgICAgICAgICAgICAgICAgZmxvYXQgYmxpbmsgPSAwLjUgKyAwLjUgKiBzaW4odCAqIDMuMCArIG4gKiAxMDAuMCk7CiAgICAgICAgICAgICAgICAgICAgZmxvYXQgZ2xvdyA9IDAuMDIgLyAoZCArIDAuMDAxKTsKICAgICAgICAgICAgICAgICAgICBnbG93ID0gcG93KGdsb3csIDEuNSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdsb3cgKiBibGluayAqIHN0ZXAoMC43LCBuKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2b2lkIG1haW4oKSB7CiAgICAgICAgICAgICAgICAgICAgdmVjMiB1diA9IHZVdjsKICAgICAgICAgICAgICAgICAgICBmbG9hdCB0ID0gdVRpbWUgKiAwLjE1OwoKICAgICAgICAgICAgICAgICAgICAvLyAxLiBEaXN0b3J0aW9uCiAgICAgICAgICAgICAgICAgICAgZmxvYXQgd2FycCA9IHRleHR1cmUyRCh0Tm9pc2UsIHV2ICogMC41ICsgdmVjMih0ICogMC4wNSkpLnI7CiAgICAgICAgICAgICAgICAgICAgdmVjMiBkaXN0VVYgPSB1diArIHZlYzIod2FycCAqIDAuMDIsIHdhcnAgKiAwLjAzKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gMi4gQ2F1c3RpY3MKICAgICAgICAgICAgICAgICAgICBmbG9hdCBjMSA9IHRleHR1cmUyRCh0Tm9pc2UsIGRpc3RVViAqIDEuNSArIHZlYzIodCAqIDAuMSwgdCAqIDAuMDUpKS5yOwogICAgICAgICAgICAgICAgICAgIGZsb2F0IGMyID0gdGV4dHVyZTJEKHROb2lzZSwgZGlzdFVWICogMi41IC0gdmVjMih0ICogMC4wNSwgdCAqIDAuMTUpKS5yOwogICAgICAgICAgICAgICAgICAgIGZsb2F0IGNhdXN0aWMgPSBtaW4oYzEsIGMyKTsKICAgICAgICAgICAgICAgICAgICBjYXVzdGljID0gcG93KGNhdXN0aWMsIDYuMCkgKiAzMC4wOwoKICAgICAgICAgICAgICAgICAgICAvLyBDaHJvbWF0aWMgQ2F1c3RpY3MKICAgICAgICAgICAgICAgICAgICBmbG9hdCBjUiA9IHRleHR1cmUyRCh0Tm9pc2UsIGRpc3RVViAqIDEuNSArIHZlYzIodCowLjEgKyAwLjAwNSkpLnI7CiAgICAgICAgICAgICAgICAgICAgZmxvYXQgY0IgPSB0ZXh0dXJlMkQodE5vaXNlLCBkaXN0VVYgKiAxLjUgKyB2ZWMyKHQqMC4xIC0gMC4wMDUpKS5yOwogICAgICAgICAgICAgICAgICAgIGZsb2F0IGNhdXN0aWNSID0gcG93KG1pbihjUiwgYzIpLCA2LjApICogMzAuMDsKICAgICAgICAgICAgICAgICAgICBmbG9hdCBjYXVzdGljQiA9IHBvdyhtaW4oYzEsIGNCKSwgNi4wKSAqIDMwLjA7CgogICAgICAgICAgICAgICAgICAgIC8vIDMuIFJheXMKICAgICAgICAgICAgICAgICAgICB2ZWMyIHJheVVWID0gdXY7CiAgICAgICAgICAgICAgICAgICAgcmF5VVYueSAqPSAwLjE7CiAgICAgICAgICAgICAgICAgICAgcmF5VVYueCArPSB0ICogMC4wMiArIHdhcnAgKiAwLjA1OwogICAgICAgICAgICAgICAgICAgIGZsb2F0IHJheXMgPSB0ZXh0dXJlMkQodE5vaXNlLCByYXlVVikucjsKICAgICAgICAgICAgICAgICAgICByYXlzID0gcG93KHJheXMsIDUuMCk7IAogICAgICAgICAgICAgICAgICAgIGZsb2F0IHJheU1hc2sgPSBzbW9vdGhzdGVwKDEuMCwgMC4wLCB1di55IC0gMC4yKTsKICAgICAgICAgICAgICAgICAgICByYXlzICo9IHJheU1hc2s7CgogICAgICAgICAgICAgICAgICAgIC8vIDQuIFB5cmVmbGllcwogICAgICAgICAgICAgICAgICAgIGZsb2F0IGZsaWVzID0gMC4wOwogICAgICAgICAgICAgICAgICAgIGZsaWVzICs9IHB5cmVmbHkodXYsIHVUaW1lICogMC41LCAxLjApOwogICAgICAgICAgICAgICAgICAgIGZsaWVzICs9IHB5cmVmbHkodXYsIHVUaW1lICogMC42LCAyLjMpOwoKICAgICAgICAgICAgICAgICAgICAvLyBDb21wb3NpdGlvbiAoQWRkaXRpdmUpCiAgICAgICAgICAgICAgICAgICAgdmVjMyBmaW5hbENvbCA9IHZlYzMoMC4wKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gVmlnbmV0dGUgKEJsdWUgVGludCBhdCBlZGdlcykKICAgICAgICAgICAgICAgICAgICBmbG9hdCBkaXN0ID0gZGlzdGFuY2UodXYsIHZlYzIoMC41KSk7CiAgICAgICAgICAgICAgICAgICAgZmxvYXQgZWRnZSA9IHNtb290aHN0ZXAoMC41LCAxLjAsIGRpc3QpOwogICAgICAgICAgICAgICAgICAgIGZpbmFsQ29sICs9IENfREVFUCAqIGVkZ2UgKiAwLjU7CgogICAgICAgICAgICAgICAgICAgIC8vIEFkZCBGZWF0dXJlcwogICAgICAgICAgICAgICAgICAgIGZpbmFsQ29sICs9IHZlYzMoY2F1c3RpY1IsIGNhdXN0aWMsIGNhdXN0aWNCKSAqIENfR0xPVyAqIDAuNTsKICAgICAgICAgICAgICAgICAgICBmaW5hbENvbCArPSByYXlzICogQ19SQVkgKiAwLjI7CiAgICAgICAgICAgICAgICAgICAgZmluYWxDb2wgKz0gZmxpZXMgKiBDX1BZUkU7CgogICAgICAgICAgICAgICAgICAgIC8vIFNjYW5saW5lCiAgICAgICAgICAgICAgICAgICAgZmxvYXQgc2NhbiA9IHNpbih1di55ICogODAwLjAgKyB1VGltZSAqIDUuMCkgKiAwLjAyOwogICAgICAgICAgICAgICAgICAgIGZpbmFsQ29sICs9IENfR0xPVyAqIGFicyhzY2FuKTsKCiAgICAgICAgICAgICAgICAgICAgZ2xfRnJhZ0NvbG9yID0gdmVjNChmaW5hbENvbCwgdU9wYWNpdHkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBgOwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5tYXRlcmlhbCA9IG5ldyBUSFJFRS5TaGFkZXJNYXRlcmlhbCh7CiAgICAgICAgICAgICAgICB1bmlmb3JtczogewogICAgICAgICAgICAgICAgICAgIHVUaW1lOiB7IHZhbHVlOiAwIH0sCiAgICAgICAgICAgICAgICAgICAgdE5vaXNlOiB7IHZhbHVlOiB3aW5kb3cuZmx1eC5ub2lzZVRleHR1cmUgfSwKICAgICAgICAgICAgICAgICAgICB1T3BhY2l0eTogeyB2YWx1ZTogMC41IH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB2ZXJ0ZXhTaGFkZXI6IHZlcnQsCiAgICAgICAgICAgICAgICBmcmFnbWVudFNoYWRlcjogZnJhZywKICAgICAgICAgICAgICAgIHRyYW5zcGFyZW50OiB0cnVlLAogICAgICAgICAgICAgICAgZGVwdGhUZXN0OiBmYWxzZSwKICAgICAgICAgICAgICAgIGRlcHRoV3JpdGU6IGZhbHNlLAogICAgICAgICAgICAgICAgYmxlbmRpbmc6IFRIUkVFLkFkZGl0aXZlQmxlbmRpbmcgLy8gQWRkaXRpdmUgYmxlbmRpbmcgcHJldmVudHMgZGFyayBvY2NsdXNpb24KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB0aGlzLm1lc2ggPSBuZXcgVEhSRUUuTWVzaChnZW9tZXRyeSwgdGhpcy5tYXRlcmlhbCk7CiAgICAgICAgICAgIHRoaXMubWVzaC5mcnVzdHVtQ3VsbGVkID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMubWVzaC5yZW5kZXJPcmRlciA9IDk5OTk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBBZGQgdG8gY2FtZXJhIHNvIGl0IHN0YXlzIG9uIHNjcmVlbgogICAgICAgICAgICB0aGlzLmNhbWVyYS5hZGQodGhpcy5tZXNoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdXBkYXRlKGR0KSB7CiAgICAgICAgICAgIGlmICh0aGlzLm1hdGVyaWFsKSB7CiAgICAgICAgICAgICAgICB0aGlzLm1hdGVyaWFsLnVuaWZvcm1zLnVUaW1lLnZhbHVlICs9IGR0OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgCiAgICB3aW5kb3cuZmx1eC5XYXRlck92ZXJsYXkgPSBXYXRlck92ZXJsYXk7Cn0pKCk7","./WaterOverlay.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICAvLyAtLS0gSGlnaC1RdWFsaXR5IE5vaXNlIFRleHR1cmUgR2VuZXJhdG9yIC0tLQogICAgd2luZG93LmZsdXgubm9pc2VUZXh0dXJlID0gKCgpID0+IHsKICAgICAgICBjb25zdCBzaXplID0gNTEyOwogICAgICAgIGNvbnN0IGMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgICBjLndpZHRoID0gc2l6ZTsgYy5oZWlnaHQgPSBzaXplOwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICAKICAgICAgICBjdHguZmlsbFN0eWxlID0gJyMwMDAwMDAnOwogICAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCBzaXplLCBzaXplKTsKICAgICAgICAKICAgICAgICAvLyBHZW5lcmF0ZSBzZWFtbGVzcyBub2lzZSAoUGVybGluLWlzaCB2aWEgbGF5ZXJlZCByYW5kb20gY2lyY2xlcy9ncmFkaWVudHMpCiAgICAgICAgY29uc3QgZHJhd05vaXNlTGF5ZXIgPSAoc2NhbGUsIGFscGhhKSA9PiB7CiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGFscGhhOwogICAgICAgICAgICBjdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gJ2xpZ2h0ZXInOyAvLyBBZGRpdGl2ZQogICAgICAgICAgICBjb25zdCBjb3VudCA9IDMwMCAqIHNjYWxlOwogICAgICAgICAgICBmb3IobGV0IGk9MDsgaTxjb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCB4ID0gTWF0aC5yYW5kb20oKSAqIHNpemU7CiAgICAgICAgICAgICAgICBjb25zdCB5ID0gTWF0aC5yYW5kb20oKSAqIHNpemU7CiAgICAgICAgICAgICAgICBjb25zdCByID0gKE1hdGgucmFuZG9tKCkgKiAzMCArIDEwKSAvIHNjYWxlOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBnID0gY3R4LmNyZWF0ZVJhZGlhbEdyYWRpZW50KHgsIHksIDAsIHgsIHksIHIpOwogICAgICAgICAgICAgICAgZy5hZGRDb2xvclN0b3AoMCwgJyM4ODg4ODgnKTsKICAgICAgICAgICAgICAgIGcuYWRkQ29sb3JTdG9wKDEsICd0cmFuc3BhcmVudCcpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gZzsKICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsgY3R4LmFyYyh4LCB5LCByLCAwLCBNYXRoLlBJKjIpOyBjdHguZmlsbCgpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBXcmFwIGFyb3VuZCBmb3Igc2VhbWxlc3MgdGlsaW5nCiAgICAgICAgICAgICAgICBbW3gtc2l6ZSwgeV0sIFt4K3NpemUsIHldLCBbeCwgeS1zaXplXSwgW3gsIHkrc2l6ZV1dLmZvckVhY2gocG9zID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBnMiA9IGN0eC5jcmVhdGVSYWRpYWxHcmFkaWVudChwb3NbMF0sIHBvc1sxXSwgMCwgcG9zWzBdLCBwb3NbMV0sIHIpOwogICAgICAgICAgICAgICAgICAgIGcyLmFkZENvbG9yU3RvcCgwLCAnIzg4ODg4OCcpOwogICAgICAgICAgICAgICAgICAgIGcyLmFkZENvbG9yU3RvcCgxLCAndHJhbnNwYXJlbnQnKTsKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gZzI7CiAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOyBjdHguYXJjKHBvc1swXSwgcG9zWzFdLCByLCAwLCBNYXRoLlBJKjIpOyBjdHguZmlsbCgpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIAogICAgICAgIGRyYXdOb2lzZUxheWVyKDEuMCwgMC4zKTsKICAgICAgICBkcmF3Tm9pc2VMYXllcigyLjAsIDAuMik7CiAgICAgICAgZHJhd05vaXNlTGF5ZXIoNC4wLCAwLjEpOwogICAgICAgIAogICAgICAgIGNvbnN0IHRleCA9IG5ldyBUSFJFRS5DYW52YXNUZXh0dXJlKGMpOwogICAgICAgIHRleC53cmFwUyA9IFRIUkVFLlJlcGVhdFdyYXBwaW5nOwogICAgICAgIHRleC53cmFwVCA9IFRIUkVFLlJlcGVhdFdyYXBwaW5nOwogICAgICAgIHJldHVybiB0ZXg7CiAgICB9KSgpOwoKICAgIGNsYXNzIFdhdGVyT3ZlcmxheSB7CiAgICAgICAgY29uc3RydWN0b3IoY2FtZXJhKSB7CiAgICAgICAgICAgIHRoaXMuY2FtZXJhID0gY2FtZXJhOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRnVsbHNjcmVlbiBxdWFkCiAgICAgICAgICAgIGNvbnN0IGdlb21ldHJ5ID0gbmV3IFRIUkVFLlBsYW5lR2VvbWV0cnkoMiwgMik7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCB2ZXJ0ID0gYAogICAgICAgICAgICAgICAgdmFyeWluZyB2ZWMyIHZVdjsKICAgICAgICAgICAgICAgIHZvaWQgbWFpbigpIHsKICAgICAgICAgICAgICAgICAgICB2VXYgPSB1djsKICAgICAgICAgICAgICAgICAgICBnbF9Qb3NpdGlvbiA9IHZlYzQocG9zaXRpb24sIDEuMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGA7CgogICAgICAgICAgICBjb25zdCBmcmFnID0gYAogICAgICAgICAgICAgICAgdW5pZm9ybSBmbG9hdCB1VGltZTsKICAgICAgICAgICAgICAgIHVuaWZvcm0gZmxvYXQgdU9wYWNpdHk7CiAgICAgICAgICAgICAgICB1bmlmb3JtIHNhbXBsZXIyRCB0Tm9pc2U7CiAgICAgICAgICAgICAgICB2YXJ5aW5nIHZlYzIgdlV2OwoKICAgICAgICAgICAgICAgIC8vIEZGWCBQYWxldHRlIChBZGRpdGl2ZSBGcmllbmRseSkKICAgICAgICAgICAgICAgIGNvbnN0IHZlYzMgQ19ERUVQID0gdmVjMygwLjAsIDAuMDIsIDAuMSk7ICAgICAvLyBTdWJ0bGUgRGVlcCBCbHVlIEVkZ2UKICAgICAgICAgICAgICAgIGNvbnN0IHZlYzMgQ19HTE9XID0gdmVjMygwLjAsIDAuNSwgMC44KTsgICAgICAvLyBDeWFuIEdsb3cKICAgICAgICAgICAgICAgIGNvbnN0IHZlYzMgQ19SQVkgID0gdmVjMygwLjQsIDAuNywgMS4wKTsgICAgICAvLyBMaWdodCBTaGFmdHMKICAgICAgICAgICAgICAgIGNvbnN0IHZlYzMgQ19QWVJFID0gdmVjMygxLjAsIDAuOSwgMC42KTsgICAgICAvLyBQeXJlZmx5IEdvbGQKCiAgICAgICAgICAgICAgICBmbG9hdCBoYXNoKHZlYzIgcCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmcmFjdChzaW4oZG90KHAsIHZlYzIoMTIuOTg5OCwgNzguMjMzKSkpICogNDM3NTguNTQ1Myk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZmxvYXQgcHlyZWZseSh2ZWMyIHV2LCBmbG9hdCB0LCBmbG9hdCBzZWVkKSB7CiAgICAgICAgICAgICAgICAgICAgdmVjMiBwID0gdXYgKiAoOC4wICsgc2VlZCk7CiAgICAgICAgICAgICAgICAgICAgdmVjMiBpZCA9IGZsb29yKHApOwogICAgICAgICAgICAgICAgICAgIHZlYzIgc3ViID0gZnJhY3QocCkgLSAwLjU7CiAgICAgICAgICAgICAgICAgICAgZmxvYXQgbiA9IGhhc2goaWQgKyBzZWVkKTsKICAgICAgICAgICAgICAgICAgICBmbG9hdCB4ID0gc2luKHQgKiAoMS4wICsgbikgKyBuICogMTAuMCkgKiAwLjQ7CiAgICAgICAgICAgICAgICAgICAgZmxvYXQgeSA9IGNvcyh0ICogKDAuOCArIG4pICsgbiAqIDIwLjApICogMC40OwogICAgICAgICAgICAgICAgICAgIGZsb2F0IGQgPSBsZW5ndGgoc3ViIC0gdmVjMih4LCB5KSk7CiAgICAgICAgICAgICAgICAgICAgZmxvYXQgYmxpbmsgPSAwLjUgKyAwLjUgKiBzaW4odCAqIDMuMCArIG4gKiAxMDAuMCk7CiAgICAgICAgICAgICAgICAgICAgZmxvYXQgZ2xvdyA9IDAuMDIgLyAoZCArIDAuMDAxKTsKICAgICAgICAgICAgICAgICAgICBnbG93ID0gcG93KGdsb3csIDEuNSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdsb3cgKiBibGluayAqIHN0ZXAoMC43LCBuKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2b2lkIG1haW4oKSB7CiAgICAgICAgICAgICAgICAgICAgdmVjMiB1diA9IHZVdjsKICAgICAgICAgICAgICAgICAgICBmbG9hdCB0ID0gdVRpbWUgKiAwLjE1OwoKICAgICAgICAgICAgICAgICAgICAvLyAxLiBEaXN0b3J0aW9uCiAgICAgICAgICAgICAgICAgICAgZmxvYXQgd2FycCA9IHRleHR1cmUyRCh0Tm9pc2UsIHV2ICogMC41ICsgdmVjMih0ICogMC4wNSkpLnI7CiAgICAgICAgICAgICAgICAgICAgdmVjMiBkaXN0VVYgPSB1diArIHZlYzIod2FycCAqIDAuMDIsIHdhcnAgKiAwLjAzKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gMi4gQ2F1c3RpY3MKICAgICAgICAgICAgICAgICAgICBmbG9hdCBjMSA9IHRleHR1cmUyRCh0Tm9pc2UsIGRpc3RVViAqIDEuNSArIHZlYzIodCAqIDAuMSwgdCAqIDAuMDUpKS5yOwogICAgICAgICAgICAgICAgICAgIGZsb2F0IGMyID0gdGV4dHVyZTJEKHROb2lzZSwgZGlzdFVWICogMi41IC0gdmVjMih0ICogMC4wNSwgdCAqIDAuMTUpKS5yOwogICAgICAgICAgICAgICAgICAgIGZsb2F0IGNhdXN0aWMgPSBtaW4oYzEsIGMyKTsKICAgICAgICAgICAgICAgICAgICBjYXVzdGljID0gcG93KGNhdXN0aWMsIDYuMCkgKiAzMC4wOwoKICAgICAgICAgICAgICAgICAgICAvLyBDaHJvbWF0aWMgQ2F1c3RpY3MKICAgICAgICAgICAgICAgICAgICBmbG9hdCBjUiA9IHRleHR1cmUyRCh0Tm9pc2UsIGRpc3RVViAqIDEuNSArIHZlYzIodCowLjEgKyAwLjAwNSkpLnI7CiAgICAgICAgICAgICAgICAgICAgZmxvYXQgY0IgPSB0ZXh0dXJlMkQodE5vaXNlLCBkaXN0VVYgKiAxLjUgKyB2ZWMyKHQqMC4xIC0gMC4wMDUpKS5yOwogICAgICAgICAgICAgICAgICAgIGZsb2F0IGNhdXN0aWNSID0gcG93KG1pbihjUiwgYzIpLCA2LjApICogMzAuMDsKICAgICAgICAgICAgICAgICAgICBmbG9hdCBjYXVzdGljQiA9IHBvdyhtaW4oYzEsIGNCKSwgNi4wKSAqIDMwLjA7CgogICAgICAgICAgICAgICAgICAgIC8vIDMuIFJheXMKICAgICAgICAgICAgICAgICAgICB2ZWMyIHJheVVWID0gdXY7CiAgICAgICAgICAgICAgICAgICAgcmF5VVYueSAqPSAwLjE7CiAgICAgICAgICAgICAgICAgICAgcmF5VVYueCArPSB0ICogMC4wMiArIHdhcnAgKiAwLjA1OwogICAgICAgICAgICAgICAgICAgIGZsb2F0IHJheXMgPSB0ZXh0dXJlMkQodE5vaXNlLCByYXlVVikucjsKICAgICAgICAgICAgICAgICAgICByYXlzID0gcG93KHJheXMsIDUuMCk7IAogICAgICAgICAgICAgICAgICAgIGZsb2F0IHJheU1hc2sgPSBzbW9vdGhzdGVwKDEuMCwgMC4wLCB1di55IC0gMC4yKTsKICAgICAgICAgICAgICAgICAgICByYXlzICo9IHJheU1hc2s7CgogICAgICAgICAgICAgICAgICAgIC8vIDQuIFB5cmVmbGllcwogICAgICAgICAgICAgICAgICAgIGZsb2F0IGZsaWVzID0gMC4wOwogICAgICAgICAgICAgICAgICAgIGZsaWVzICs9IHB5cmVmbHkodXYsIHVUaW1lICogMC41LCAxLjApOwogICAgICAgICAgICAgICAgICAgIGZsaWVzICs9IHB5cmVmbHkodXYsIHVUaW1lICogMC42LCAyLjMpOwoKICAgICAgICAgICAgICAgICAgICAvLyBDb21wb3NpdGlvbiAoQWRkaXRpdmUpCiAgICAgICAgICAgICAgICAgICAgdmVjMyBmaW5hbENvbCA9IHZlYzMoMC4wKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gVmlnbmV0dGUgKEJsdWUgVGludCBhdCBlZGdlcykKICAgICAgICAgICAgICAgICAgICBmbG9hdCBkaXN0ID0gZGlzdGFuY2UodXYsIHZlYzIoMC41KSk7CiAgICAgICAgICAgICAgICAgICAgZmxvYXQgZWRnZSA9IHNtb290aHN0ZXAoMC41LCAxLjAsIGRpc3QpOwogICAgICAgICAgICAgICAgICAgIGZpbmFsQ29sICs9IENfREVFUCAqIGVkZ2UgKiAwLjU7CgogICAgICAgICAgICAgICAgICAgIC8vIEFkZCBGZWF0dXJlcwogICAgICAgICAgICAgICAgICAgIGZpbmFsQ29sICs9IHZlYzMoY2F1c3RpY1IsIGNhdXN0aWMsIGNhdXN0aWNCKSAqIENfR0xPVyAqIDAuNTsKICAgICAgICAgICAgICAgICAgICBmaW5hbENvbCArPSByYXlzICogQ19SQVkgKiAwLjI7CiAgICAgICAgICAgICAgICAgICAgZmluYWxDb2wgKz0gZmxpZXMgKiBDX1BZUkU7CgogICAgICAgICAgICAgICAgICAgIC8vIFNjYW5saW5lCiAgICAgICAgICAgICAgICAgICAgZmxvYXQgc2NhbiA9IHNpbih1di55ICogODAwLjAgKyB1VGltZSAqIDUuMCkgKiAwLjAyOwogICAgICAgICAgICAgICAgICAgIGZpbmFsQ29sICs9IENfR0xPVyAqIGFicyhzY2FuKTsKCiAgICAgICAgICAgICAgICAgICAgZ2xfRnJhZ0NvbG9yID0gdmVjNChmaW5hbENvbCwgdU9wYWNpdHkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBgOwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5tYXRlcmlhbCA9IG5ldyBUSFJFRS5TaGFkZXJNYXRlcmlhbCh7CiAgICAgICAgICAgICAgICB1bmlmb3JtczogewogICAgICAgICAgICAgICAgICAgIHVUaW1lOiB7IHZhbHVlOiAwIH0sCiAgICAgICAgICAgICAgICAgICAgdE5vaXNlOiB7IHZhbHVlOiB3aW5kb3cuZmx1eC5ub2lzZVRleHR1cmUgfSwKICAgICAgICAgICAgICAgICAgICB1T3BhY2l0eTogeyB2YWx1ZTogMC41IH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB2ZXJ0ZXhTaGFkZXI6IHZlcnQsCiAgICAgICAgICAgICAgICBmcmFnbWVudFNoYWRlcjogZnJhZywKICAgICAgICAgICAgICAgIHRyYW5zcGFyZW50OiB0cnVlLAogICAgICAgICAgICAgICAgZGVwdGhUZXN0OiBmYWxzZSwKICAgICAgICAgICAgICAgIGRlcHRoV3JpdGU6IGZhbHNlLAogICAgICAgICAgICAgICAgYmxlbmRpbmc6IFRIUkVFLkFkZGl0aXZlQmxlbmRpbmcgLy8gQWRkaXRpdmUgYmxlbmRpbmcgcHJldmVudHMgZGFyayBvY2NsdXNpb24KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB0aGlzLm1lc2ggPSBuZXcgVEhSRUUuTWVzaChnZW9tZXRyeSwgdGhpcy5tYXRlcmlhbCk7CiAgICAgICAgICAgIHRoaXMubWVzaC5mcnVzdHVtQ3VsbGVkID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMubWVzaC5yZW5kZXJPcmRlciA9IDk5OTk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBBZGQgdG8gY2FtZXJhIHNvIGl0IHN0YXlzIG9uIHNjcmVlbgogICAgICAgICAgICB0aGlzLmNhbWVyYS5hZGQodGhpcy5tZXNoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdXBkYXRlKGR0KSB7CiAgICAgICAgICAgIGlmICh0aGlzLm1hdGVyaWFsKSB7CiAgICAgICAgICAgICAgICB0aGlzLm1hdGVyaWFsLnVuaWZvcm1zLnVUaW1lLnZhbHVlICs9IGR0OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgCiAgICB3aW5kb3cuZmx1eC5XYXRlck92ZXJsYXkgPSBXYXRlck92ZXJsYXk7Cn0pKCk7","/WaterOverlay.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICAvLyAtLS0gSGlnaC1RdWFsaXR5IE5vaXNlIFRleHR1cmUgR2VuZXJhdG9yIC0tLQogICAgd2luZG93LmZsdXgubm9pc2VUZXh0dXJlID0gKCgpID0+IHsKICAgICAgICBjb25zdCBzaXplID0gNTEyOwogICAgICAgIGNvbnN0IGMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgICBjLndpZHRoID0gc2l6ZTsgYy5oZWlnaHQgPSBzaXplOwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICAKICAgICAgICBjdHguZmlsbFN0eWxlID0gJyMwMDAwMDAnOwogICAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCBzaXplLCBzaXplKTsKICAgICAgICAKICAgICAgICAvLyBHZW5lcmF0ZSBzZWFtbGVzcyBub2lzZSAoUGVybGluLWlzaCB2aWEgbGF5ZXJlZCByYW5kb20gY2lyY2xlcy9ncmFkaWVudHMpCiAgICAgICAgY29uc3QgZHJhd05vaXNlTGF5ZXIgPSAoc2NhbGUsIGFscGhhKSA9PiB7CiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGFscGhhOwogICAgICAgICAgICBjdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gJ2xpZ2h0ZXInOyAvLyBBZGRpdGl2ZQogICAgICAgICAgICBjb25zdCBjb3VudCA9IDMwMCAqIHNjYWxlOwogICAgICAgICAgICBmb3IobGV0IGk9MDsgaTxjb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCB4ID0gTWF0aC5yYW5kb20oKSAqIHNpemU7CiAgICAgICAgICAgICAgICBjb25zdCB5ID0gTWF0aC5yYW5kb20oKSAqIHNpemU7CiAgICAgICAgICAgICAgICBjb25zdCByID0gKE1hdGgucmFuZG9tKCkgKiAzMCArIDEwKSAvIHNjYWxlOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBnID0gY3R4LmNyZWF0ZVJhZGlhbEdyYWRpZW50KHgsIHksIDAsIHgsIHksIHIpOwogICAgICAgICAgICAgICAgZy5hZGRDb2xvclN0b3AoMCwgJyM4ODg4ODgnKTsKICAgICAgICAgICAgICAgIGcuYWRkQ29sb3JTdG9wKDEsICd0cmFuc3BhcmVudCcpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gZzsKICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsgY3R4LmFyYyh4LCB5LCByLCAwLCBNYXRoLlBJKjIpOyBjdHguZmlsbCgpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBXcmFwIGFyb3VuZCBmb3Igc2VhbWxlc3MgdGlsaW5nCiAgICAgICAgICAgICAgICBbW3gtc2l6ZSwgeV0sIFt4K3NpemUsIHldLCBbeCwgeS1zaXplXSwgW3gsIHkrc2l6ZV1dLmZvckVhY2gocG9zID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBnMiA9IGN0eC5jcmVhdGVSYWRpYWxHcmFkaWVudChwb3NbMF0sIHBvc1sxXSwgMCwgcG9zWzBdLCBwb3NbMV0sIHIpOwogICAgICAgICAgICAgICAgICAgIGcyLmFkZENvbG9yU3RvcCgwLCAnIzg4ODg4OCcpOwogICAgICAgICAgICAgICAgICAgIGcyLmFkZENvbG9yU3RvcCgxLCAndHJhbnNwYXJlbnQnKTsKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gZzI7CiAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOyBjdHguYXJjKHBvc1swXSwgcG9zWzFdLCByLCAwLCBNYXRoLlBJKjIpOyBjdHguZmlsbCgpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIAogICAgICAgIGRyYXdOb2lzZUxheWVyKDEuMCwgMC4zKTsKICAgICAgICBkcmF3Tm9pc2VMYXllcigyLjAsIDAuMik7CiAgICAgICAgZHJhd05vaXNlTGF5ZXIoNC4wLCAwLjEpOwogICAgICAgIAogICAgICAgIGNvbnN0IHRleCA9IG5ldyBUSFJFRS5DYW52YXNUZXh0dXJlKGMpOwogICAgICAgIHRleC53cmFwUyA9IFRIUkVFLlJlcGVhdFdyYXBwaW5nOwogICAgICAgIHRleC53cmFwVCA9IFRIUkVFLlJlcGVhdFdyYXBwaW5nOwogICAgICAgIHJldHVybiB0ZXg7CiAgICB9KSgpOwoKICAgIGNsYXNzIFdhdGVyT3ZlcmxheSB7CiAgICAgICAgY29uc3RydWN0b3IoY2FtZXJhKSB7CiAgICAgICAgICAgIHRoaXMuY2FtZXJhID0gY2FtZXJhOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRnVsbHNjcmVlbiBxdWFkCiAgICAgICAgICAgIGNvbnN0IGdlb21ldHJ5ID0gbmV3IFRIUkVFLlBsYW5lR2VvbWV0cnkoMiwgMik7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCB2ZXJ0ID0gYAogICAgICAgICAgICAgICAgdmFyeWluZyB2ZWMyIHZVdjsKICAgICAgICAgICAgICAgIHZvaWQgbWFpbigpIHsKICAgICAgICAgICAgICAgICAgICB2VXYgPSB1djsKICAgICAgICAgICAgICAgICAgICBnbF9Qb3NpdGlvbiA9IHZlYzQocG9zaXRpb24sIDEuMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGA7CgogICAgICAgICAgICBjb25zdCBmcmFnID0gYAogICAgICAgICAgICAgICAgdW5pZm9ybSBmbG9hdCB1VGltZTsKICAgICAgICAgICAgICAgIHVuaWZvcm0gZmxvYXQgdU9wYWNpdHk7CiAgICAgICAgICAgICAgICB1bmlmb3JtIHNhbXBsZXIyRCB0Tm9pc2U7CiAgICAgICAgICAgICAgICB2YXJ5aW5nIHZlYzIgdlV2OwoKICAgICAgICAgICAgICAgIC8vIEZGWCBQYWxldHRlIChBZGRpdGl2ZSBGcmllbmRseSkKICAgICAgICAgICAgICAgIGNvbnN0IHZlYzMgQ19ERUVQID0gdmVjMygwLjAsIDAuMDIsIDAuMSk7ICAgICAvLyBTdWJ0bGUgRGVlcCBCbHVlIEVkZ2UKICAgICAgICAgICAgICAgIGNvbnN0IHZlYzMgQ19HTE9XID0gdmVjMygwLjAsIDAuNSwgMC44KTsgICAgICAvLyBDeWFuIEdsb3cKICAgICAgICAgICAgICAgIGNvbnN0IHZlYzMgQ19SQVkgID0gdmVjMygwLjQsIDAuNywgMS4wKTsgICAgICAvLyBMaWdodCBTaGFmdHMKICAgICAgICAgICAgICAgIGNvbnN0IHZlYzMgQ19QWVJFID0gdmVjMygxLjAsIDAuOSwgMC42KTsgICAgICAvLyBQeXJlZmx5IEdvbGQKCiAgICAgICAgICAgICAgICBmbG9hdCBoYXNoKHZlYzIgcCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmcmFjdChzaW4oZG90KHAsIHZlYzIoMTIuOTg5OCwgNzguMjMzKSkpICogNDM3NTguNTQ1Myk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZmxvYXQgcHlyZWZseSh2ZWMyIHV2LCBmbG9hdCB0LCBmbG9hdCBzZWVkKSB7CiAgICAgICAgICAgICAgICAgICAgdmVjMiBwID0gdXYgKiAoOC4wICsgc2VlZCk7CiAgICAgICAgICAgICAgICAgICAgdmVjMiBpZCA9IGZsb29yKHApOwogICAgICAgICAgICAgICAgICAgIHZlYzIgc3ViID0gZnJhY3QocCkgLSAwLjU7CiAgICAgICAgICAgICAgICAgICAgZmxvYXQgbiA9IGhhc2goaWQgKyBzZWVkKTsKICAgICAgICAgICAgICAgICAgICBmbG9hdCB4ID0gc2luKHQgKiAoMS4wICsgbikgKyBuICogMTAuMCkgKiAwLjQ7CiAgICAgICAgICAgICAgICAgICAgZmxvYXQgeSA9IGNvcyh0ICogKDAuOCArIG4pICsgbiAqIDIwLjApICogMC40OwogICAgICAgICAgICAgICAgICAgIGZsb2F0IGQgPSBsZW5ndGgoc3ViIC0gdmVjMih4LCB5KSk7CiAgICAgICAgICAgICAgICAgICAgZmxvYXQgYmxpbmsgPSAwLjUgKyAwLjUgKiBzaW4odCAqIDMuMCArIG4gKiAxMDAuMCk7CiAgICAgICAgICAgICAgICAgICAgZmxvYXQgZ2xvdyA9IDAuMDIgLyAoZCArIDAuMDAxKTsKICAgICAgICAgICAgICAgICAgICBnbG93ID0gcG93KGdsb3csIDEuNSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdsb3cgKiBibGluayAqIHN0ZXAoMC43LCBuKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2b2lkIG1haW4oKSB7CiAgICAgICAgICAgICAgICAgICAgdmVjMiB1diA9IHZVdjsKICAgICAgICAgICAgICAgICAgICBmbG9hdCB0ID0gdVRpbWUgKiAwLjE1OwoKICAgICAgICAgICAgICAgICAgICAvLyAxLiBEaXN0b3J0aW9uCiAgICAgICAgICAgICAgICAgICAgZmxvYXQgd2FycCA9IHRleHR1cmUyRCh0Tm9pc2UsIHV2ICogMC41ICsgdmVjMih0ICogMC4wNSkpLnI7CiAgICAgICAgICAgICAgICAgICAgdmVjMiBkaXN0VVYgPSB1diArIHZlYzIod2FycCAqIDAuMDIsIHdhcnAgKiAwLjAzKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gMi4gQ2F1c3RpY3MKICAgICAgICAgICAgICAgICAgICBmbG9hdCBjMSA9IHRleHR1cmUyRCh0Tm9pc2UsIGRpc3RVViAqIDEuNSArIHZlYzIodCAqIDAuMSwgdCAqIDAuMDUpKS5yOwogICAgICAgICAgICAgICAgICAgIGZsb2F0IGMyID0gdGV4dHVyZTJEKHROb2lzZSwgZGlzdFVWICogMi41IC0gdmVjMih0ICogMC4wNSwgdCAqIDAuMTUpKS5yOwogICAgICAgICAgICAgICAgICAgIGZsb2F0IGNhdXN0aWMgPSBtaW4oYzEsIGMyKTsKICAgICAgICAgICAgICAgICAgICBjYXVzdGljID0gcG93KGNhdXN0aWMsIDYuMCkgKiAzMC4wOwoKICAgICAgICAgICAgICAgICAgICAvLyBDaHJvbWF0aWMgQ2F1c3RpY3MKICAgICAgICAgICAgICAgICAgICBmbG9hdCBjUiA9IHRleHR1cmUyRCh0Tm9pc2UsIGRpc3RVViAqIDEuNSArIHZlYzIodCowLjEgKyAwLjAwNSkpLnI7CiAgICAgICAgICAgICAgICAgICAgZmxvYXQgY0IgPSB0ZXh0dXJlMkQodE5vaXNlLCBkaXN0VVYgKiAxLjUgKyB2ZWMyKHQqMC4xIC0gMC4wMDUpKS5yOwogICAgICAgICAgICAgICAgICAgIGZsb2F0IGNhdXN0aWNSID0gcG93KG1pbihjUiwgYzIpLCA2LjApICogMzAuMDsKICAgICAgICAgICAgICAgICAgICBmbG9hdCBjYXVzdGljQiA9IHBvdyhtaW4oYzEsIGNCKSwgNi4wKSAqIDMwLjA7CgogICAgICAgICAgICAgICAgICAgIC8vIDMuIFJheXMKICAgICAgICAgICAgICAgICAgICB2ZWMyIHJheVVWID0gdXY7CiAgICAgICAgICAgICAgICAgICAgcmF5VVYueSAqPSAwLjE7CiAgICAgICAgICAgICAgICAgICAgcmF5VVYueCArPSB0ICogMC4wMiArIHdhcnAgKiAwLjA1OwogICAgICAgICAgICAgICAgICAgIGZsb2F0IHJheXMgPSB0ZXh0dXJlMkQodE5vaXNlLCByYXlVVikucjsKICAgICAgICAgICAgICAgICAgICByYXlzID0gcG93KHJheXMsIDUuMCk7IAogICAgICAgICAgICAgICAgICAgIGZsb2F0IHJheU1hc2sgPSBzbW9vdGhzdGVwKDEuMCwgMC4wLCB1di55IC0gMC4yKTsKICAgICAgICAgICAgICAgICAgICByYXlzICo9IHJheU1hc2s7CgogICAgICAgICAgICAgICAgICAgIC8vIDQuIFB5cmVmbGllcwogICAgICAgICAgICAgICAgICAgIGZsb2F0IGZsaWVzID0gMC4wOwogICAgICAgICAgICAgICAgICAgIGZsaWVzICs9IHB5cmVmbHkodXYsIHVUaW1lICogMC41LCAxLjApOwogICAgICAgICAgICAgICAgICAgIGZsaWVzICs9IHB5cmVmbHkodXYsIHVUaW1lICogMC42LCAyLjMpOwoKICAgICAgICAgICAgICAgICAgICAvLyBDb21wb3NpdGlvbiAoQWRkaXRpdmUpCiAgICAgICAgICAgICAgICAgICAgdmVjMyBmaW5hbENvbCA9IHZlYzMoMC4wKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gVmlnbmV0dGUgKEJsdWUgVGludCBhdCBlZGdlcykKICAgICAgICAgICAgICAgICAgICBmbG9hdCBkaXN0ID0gZGlzdGFuY2UodXYsIHZlYzIoMC41KSk7CiAgICAgICAgICAgICAgICAgICAgZmxvYXQgZWRnZSA9IHNtb290aHN0ZXAoMC41LCAxLjAsIGRpc3QpOwogICAgICAgICAgICAgICAgICAgIGZpbmFsQ29sICs9IENfREVFUCAqIGVkZ2UgKiAwLjU7CgogICAgICAgICAgICAgICAgICAgIC8vIEFkZCBGZWF0dXJlcwogICAgICAgICAgICAgICAgICAgIGZpbmFsQ29sICs9IHZlYzMoY2F1c3RpY1IsIGNhdXN0aWMsIGNhdXN0aWNCKSAqIENfR0xPVyAqIDAuNTsKICAgICAgICAgICAgICAgICAgICBmaW5hbENvbCArPSByYXlzICogQ19SQVkgKiAwLjI7CiAgICAgICAgICAgICAgICAgICAgZmluYWxDb2wgKz0gZmxpZXMgKiBDX1BZUkU7CgogICAgICAgICAgICAgICAgICAgIC8vIFNjYW5saW5lCiAgICAgICAgICAgICAgICAgICAgZmxvYXQgc2NhbiA9IHNpbih1di55ICogODAwLjAgKyB1VGltZSAqIDUuMCkgKiAwLjAyOwogICAgICAgICAgICAgICAgICAgIGZpbmFsQ29sICs9IENfR0xPVyAqIGFicyhzY2FuKTsKCiAgICAgICAgICAgICAgICAgICAgZ2xfRnJhZ0NvbG9yID0gdmVjNChmaW5hbENvbCwgdU9wYWNpdHkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBgOwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5tYXRlcmlhbCA9IG5ldyBUSFJFRS5TaGFkZXJNYXRlcmlhbCh7CiAgICAgICAgICAgICAgICB1bmlmb3JtczogewogICAgICAgICAgICAgICAgICAgIHVUaW1lOiB7IHZhbHVlOiAwIH0sCiAgICAgICAgICAgICAgICAgICAgdE5vaXNlOiB7IHZhbHVlOiB3aW5kb3cuZmx1eC5ub2lzZVRleHR1cmUgfSwKICAgICAgICAgICAgICAgICAgICB1T3BhY2l0eTogeyB2YWx1ZTogMC41IH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB2ZXJ0ZXhTaGFkZXI6IHZlcnQsCiAgICAgICAgICAgICAgICBmcmFnbWVudFNoYWRlcjogZnJhZywKICAgICAgICAgICAgICAgIHRyYW5zcGFyZW50OiB0cnVlLAogICAgICAgICAgICAgICAgZGVwdGhUZXN0OiBmYWxzZSwKICAgICAgICAgICAgICAgIGRlcHRoV3JpdGU6IGZhbHNlLAogICAgICAgICAgICAgICAgYmxlbmRpbmc6IFRIUkVFLkFkZGl0aXZlQmxlbmRpbmcgLy8gQWRkaXRpdmUgYmxlbmRpbmcgcHJldmVudHMgZGFyayBvY2NsdXNpb24KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB0aGlzLm1lc2ggPSBuZXcgVEhSRUUuTWVzaChnZW9tZXRyeSwgdGhpcy5tYXRlcmlhbCk7CiAgICAgICAgICAgIHRoaXMubWVzaC5mcnVzdHVtQ3VsbGVkID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMubWVzaC5yZW5kZXJPcmRlciA9IDk5OTk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBBZGQgdG8gY2FtZXJhIHNvIGl0IHN0YXlzIG9uIHNjcmVlbgogICAgICAgICAgICB0aGlzLmNhbWVyYS5hZGQodGhpcy5tZXNoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdXBkYXRlKGR0KSB7CiAgICAgICAgICAgIGlmICh0aGlzLm1hdGVyaWFsKSB7CiAgICAgICAgICAgICAgICB0aGlzLm1hdGVyaWFsLnVuaWZvcm1zLnVUaW1lLnZhbHVlICs9IGR0OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgCiAgICB3aW5kb3cuZmx1eC5XYXRlck92ZXJsYXkgPSBXYXRlck92ZXJsYXk7Cn0pKCk7","GlyphManager.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICAvLyAtLS0gVEVYVFVSRSBHRU5FUkFUSU9OIC0tLQogICAgY29uc3QgX2NyZWF0ZUdseXBoVGV4dHVyZSA9IChjb2xvclN0ciwgdHlwZSkgPT4gewogICAgICAgIGNvbnN0IHNpemUgPSAyNTY7CiAgICAgICAgY29uc3QgYyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICAgIGMud2lkdGggPSBzaXplOyBjLmhlaWdodCA9IHNpemU7CiAgICAgICAgY29uc3QgY3R4ID0gYy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgIAogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgc2l6ZSwgc2l6ZSk7CiAgICAgICAgCiAgICAgICAgLy8gR2xvdyBzZXR0aW5ncwogICAgICAgIGN0eC5zaGFkb3dCbHVyID0gMTU7CiAgICAgICAgY3R4LnNoYWRvd0NvbG9yID0gY29sb3JTdHI7CiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gY29sb3JTdHI7CiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGNvbG9yU3RyOwogICAgICAgIGN0eC5saW5lQ2FwID0gJ3JvdW5kJzsKCiAgICAgICAgY29uc3QgY3ggPSBzaXplIC8gMjsKICAgICAgICBjb25zdCBjeSA9IHNpemUgLyAyOwoKICAgICAgICBpZiAodHlwZSA9PT0gJ3JpbmcnKSB7CiAgICAgICAgICAgIC8vIE91dGVyIFJpbmcKICAgICAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDY7CiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgY3R4LmFyYyhjeCwgY3ksIDExMCwgMCwgTWF0aC5QSSAqIDIpOwogICAgICAgICAgICBjdHguc3Ryb2tlKCk7CgogICAgICAgICAgICAvLyBJbm5lciBSaW5nCiAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSAzOwogICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgIGN0eC5hcmMoY3gsIGN5LCA5MCwgMCwgTWF0aC5QSSAqIDIpOwogICAgICAgICAgICBjdHguc3Ryb2tlKCk7CgogICAgICAgICAgICAvLyBSdW5lcwogICAgICAgICAgICBjdHguZm9udCA9ICdib2xkIDI0cHggc2Fucy1zZXJpZic7CiAgICAgICAgICAgIGN0eC50ZXh0QWxpZ24gPSAnY2VudGVyJzsKICAgICAgICAgICAgY3R4LnRleHRCYXNlbGluZSA9ICdtaWRkbGUnOwogICAgICAgICAgICBmb3IobGV0IGk9MDsgaTw4OyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGFuZ2xlID0gKGkgLyA4KSAqIE1hdGguUEkgKiAyOwogICAgICAgICAgICAgICAgY29uc3QgciA9IDEwMDsKICAgICAgICAgICAgICAgIGNvbnN0IHggPSBjeCArIE1hdGguY29zKGFuZ2xlKSAqIHI7CiAgICAgICAgICAgICAgICBjb25zdCB5ID0gY3kgKyBNYXRoLnNpbihhbmdsZSkgKiByOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZSh4LCB5KTsKICAgICAgICAgICAgICAgIGN0eC5yb3RhdGUoYW5nbGUgKyBNYXRoLlBJLzIpOwogICAgICAgICAgICAgICAgLy8gRHJhdyBhIHNpbXBsZSBydW5lLWxpa2Ugc2hhcGUKICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgICAgIGN0eC5tb3ZlVG8oLTUsIC01KTsgY3R4LmxpbmVUbyg1LCAwKTsgY3R4LmxpbmVUbygtNSwgNSk7CiAgICAgICAgICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAncnVuZScpIHsKICAgICAgICAgICAgLy8gQ2VudHJhbCBDb21wbGV4IFJ1bmUKICAgICAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDU7CiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgY3R4LmFyYyhjeCwgY3ksIDYwLCAwLCBNYXRoLlBJICogMik7CiAgICAgICAgICAgIGN0eC5zdHJva2UoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgY3R4Lm1vdmVUbyhjeCwgY3kgLSA2MCk7CiAgICAgICAgICAgIGN0eC5saW5lVG8oY3gsIGN5ICsgNjApOwogICAgICAgICAgICBjdHgubW92ZVRvKGN4IC0gNjAsIGN5KTsKICAgICAgICAgICAgY3R4LmxpbmVUbyhjeCArIDYwLCBjeSk7CiAgICAgICAgICAgIGN0eC5zdHJva2UoKTsKCiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgY3R4LmFyYyhjeCwgY3ksIDIwLCAwLCBNYXRoLlBJICogMik7CiAgICAgICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCB0ZXggPSBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICAgICAgICByZXR1cm4gdGV4OwogICAgfTsKCiAgICBjb25zdCBfdGVjaFRleHR1cmUgPSBfY3JlYXRlR2x5cGhUZXh0dXJlKCcjMDBmZmZmJywgJ3JpbmcnKTsgLy8gQ3lhbiBSaW5nCiAgICBjb25zdCBfc3RhdHVzVGV4dHVyZSA9IF9jcmVhdGVHbHlwaFRleHR1cmUoJyNmZjAwZmYnLCAncnVuZScpOyAvLyBNYWdlbnRhIFJ1bmUKICAgIGNvbnN0IF9jaGFyZ2VUZXh0dXJlID0gX2NyZWF0ZUdseXBoVGV4dHVyZSgnI2ZmZmYwMCcsICdyaW5nJyk7IC8vIEdvbGQgUmluZwoKICAgIGNsYXNzIEdseXBoTWFuYWdlciB7CiAgICAgICAgY29uc3RydWN0b3Ioc2NlbmUpIHsKICAgICAgICAgICAgdGhpcy5zY2VuZSA9IHNjZW5lOwogICAgICAgICAgICB0aGlzLmdseXBocyA9IFtdOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gTWF0ZXJpYWxzCiAgICAgICAgICAgIHRoaXMubWF0ZXJpYWxzID0gewogICAgICAgICAgICAgICAgdGVjaDogbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHsgCiAgICAgICAgICAgICAgICAgICAgbWFwOiBfdGVjaFRleHR1cmUsIAogICAgICAgICAgICAgICAgICAgIHRyYW5zcGFyZW50OiB0cnVlLCAKICAgICAgICAgICAgICAgICAgICBzaWRlOiBUSFJFRS5Eb3VibGVTaWRlLCAKICAgICAgICAgICAgICAgICAgICBibGVuZGluZzogVEhSRUUuQWRkaXRpdmVCbGVuZGluZywKICAgICAgICAgICAgICAgICAgICBkZXB0aFdyaXRlOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBjb2xvcjogMHhmZmZmZmYKICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgc3RhdHVzOiBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyAKICAgICAgICAgICAgICAgICAgICBtYXA6IF9zdGF0dXNUZXh0dXJlLCAKICAgICAgICAgICAgICAgICAgICB0cmFuc3BhcmVudDogdHJ1ZSwgCiAgICAgICAgICAgICAgICAgICAgc2lkZTogVEhSRUUuRG91YmxlU2lkZSwgCiAgICAgICAgICAgICAgICAgICAgYmxlbmRpbmc6IFRIUkVFLkFkZGl0aXZlQmxlbmRpbmcsCiAgICAgICAgICAgICAgICAgICAgZGVwdGhXcml0ZTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgY29sb3I6IDB4ZmZmZmZmCiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIGNoYXJnZTogbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHsgCiAgICAgICAgICAgICAgICAgICAgbWFwOiBfY2hhcmdlVGV4dHVyZSwgCiAgICAgICAgICAgICAgICAgICAgdHJhbnNwYXJlbnQ6IHRydWUsIAogICAgICAgICAgICAgICAgICAgIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGUsIAogICAgICAgICAgICAgICAgICAgIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nLAogICAgICAgICAgICAgICAgICAgIGRlcHRoV3JpdGU6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGNvbG9yOiAweGZmZmZmZgogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8vIFBvb2wKICAgICAgICAgICAgdGhpcy5wb29sID0gW107CiAgICAgICAgICAgIHRoaXMucG9vbFNpemUgPSAzMDsKICAgICAgICAgICAgY29uc3QgZ2VvID0gbmV3IFRIUkVFLlBsYW5lR2VvbWV0cnkoMSwgMSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IobGV0IGk9MDsgaTx0aGlzLnBvb2xTaXplOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IG1lc2ggPSBuZXcgVEhSRUUuTWVzaChnZW8sIHRoaXMubWF0ZXJpYWxzLnRlY2gpOwogICAgICAgICAgICAgICAgbWVzaC52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICBtZXNoLnJlbmRlck9yZGVyID0gMjAwMDsgLy8gRHJhdyBvbiB0b3Agb2Ygd2F0ZXIvYXJlbmEKICAgICAgICAgICAgICAgIHRoaXMuc2NlbmUuYWRkKG1lc2gpOwogICAgICAgICAgICAgICAgdGhpcy5wb29sLnB1c2gobWVzaCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHNwYXduKHR5cGUsIHBvcywgb3B0aW9ucyA9IHt9KSB7CiAgICAgICAgICAgIGNvbnN0IG1lc2ggPSB0aGlzLnBvb2wuZmluZChtID0+ICFtLnZpc2libGUpOwogICAgICAgICAgICBpZiAoIW1lc2gpIHJldHVybjsKCiAgICAgICAgICAgIG1lc2gudmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgIG1lc2gubWF0ZXJpYWwgPSB0aGlzLm1hdGVyaWFsc1t0eXBlXSB8fCB0aGlzLm1hdGVyaWFscy50ZWNoOwogICAgICAgICAgICBtZXNoLnBvc2l0aW9uLmNvcHkocG9zKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFJlc2V0IE1hdGVyaWFsIE9wYWNpdHkKICAgICAgICAgICAgbWVzaC5tYXRlcmlhbC5vcGFjaXR5ID0gMS4wOwoKICAgICAgICAgICAgLy8gRGVmYXVsdHMKICAgICAgICAgICAgY29uc3Qgc2NhbGUgPSBvcHRpb25zLnNjYWxlIHx8IDEuMDsKICAgICAgICAgICAgbWVzaC5zY2FsZS5zZXQoc2NhbGUsIHNjYWxlLCBzY2FsZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBPcmllbnRhdGlvbgogICAgICAgICAgICBpZiAob3B0aW9ucy5mYWNlQ2FtZXJhKSB7CiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlICYmIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5jYW1lcmEpIHsKICAgICAgICAgICAgICAgICAgICBtZXNoLmxvb2tBdCh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChvcHRpb25zLm9yaWVudGF0aW9uID09PSAndmVydGljYWwnKSB7CiAgICAgICAgICAgICAgICBtZXNoLnJvdGF0aW9uLnNldCgwLCAwLCAwKTsKICAgICAgICAgICAgICAgIC8vIEZhY2UgY2FtZXJhIFktYXhpcyByb3RhdGlvbiBvbmx5CiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlICYmIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5jYW1lcmEpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjYW1Qb3MgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhLnBvc2l0aW9uOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGFuZ2xlID0gTWF0aC5hdGFuMihjYW1Qb3MueCAtIHBvcy54LCBjYW1Qb3MueiAtIHBvcy56KTsKICAgICAgICAgICAgICAgICAgICBtZXNoLnJvdGF0aW9uLnkgPSBhbmdsZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEhvcml6b250YWwgKEdyb3VuZCkKICAgICAgICAgICAgICAgIG1lc2gucm90YXRpb24uc2V0KC1NYXRoLlBJIC8gMiwgMCwgTWF0aC5yYW5kb20oKSAqIE1hdGguUEkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAob3B0aW9ucy5vZmZzZXRZKSB7CiAgICAgICAgICAgICAgICBtZXNoLnBvc2l0aW9uLnkgKz0gb3B0aW9ucy5vZmZzZXRZOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmdseXBocy5wdXNoKHsKICAgICAgICAgICAgICAgIG1lc2g6IG1lc2gsCiAgICAgICAgICAgICAgICBhZ2U6IDAsCiAgICAgICAgICAgICAgICBsaWZlOiBvcHRpb25zLmxpZmUgfHwgMS4wLAogICAgICAgICAgICAgICAgbWF4TGlmZTogb3B0aW9ucy5saWZlIHx8IDEuMCwKICAgICAgICAgICAgICAgIHJvdGF0aW9uU3BlZWQ6IG9wdGlvbnMucm90YXRpb25TcGVlZCB8fCAxLjAsCiAgICAgICAgICAgICAgICBzY2FsZVNwZWVkOiBvcHRpb25zLnNjYWxlU3BlZWQgfHwgMCwKICAgICAgICAgICAgICAgIGZhZGU6IG9wdGlvbnMuZmFkZSAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5mYWRlIDogdHJ1ZSwKICAgICAgICAgICAgICAgIGZvbGxvd1RhcmdldDogb3B0aW9ucy5wYXJlbnQgfHwgbnVsbCwKICAgICAgICAgICAgICAgIG9mZnNldFk6IG9wdGlvbnMub2Zmc2V0WSB8fCAwCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgdXBkYXRlKGR0KSB7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSB0aGlzLmdseXBocy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICAgICAgY29uc3QgZyA9IHRoaXMuZ2x5cGhzW2ldOwogICAgICAgICAgICAgICAgZy5hZ2UgKz0gZHQ7CgogICAgICAgICAgICAgICAgaWYgKGcuYWdlID49IGcubGlmZSkgewogICAgICAgICAgICAgICAgICAgIGcubWVzaC52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5nbHlwaHMuc3BsaWNlKGksIDEpOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBnLmFnZSAvIGcubWF4TGlmZTsKCiAgICAgICAgICAgICAgICAvLyBGb2xsb3cgdGFyZ2V0CiAgICAgICAgICAgICAgICBpZiAoZy5mb2xsb3dUYXJnZXQgJiYgZy5mb2xsb3dUYXJnZXQubWVzaCkgewogICAgICAgICAgICAgICAgICAgIGcubWVzaC5wb3NpdGlvbi5jb3B5KGcuZm9sbG93VGFyZ2V0Lm1lc2gucG9zaXRpb24pOwogICAgICAgICAgICAgICAgICAgIGcubWVzaC5wb3NpdGlvbi55ICs9IGcub2Zmc2V0WTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBJZiBncm91bmQgb3JpZW50ZWQsIGtlZXAgbmVhciBmbG9vcgogICAgICAgICAgICAgICAgICAgIGlmIChnLm1lc2gucm90YXRpb24ueCA9PT0gLU1hdGguUEkvMikgewogICAgICAgICAgICAgICAgICAgICAgICAgZy5tZXNoLnBvc2l0aW9uLnkgPSAwLjEgKyBnLm9mZnNldFk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIEFuaW1hdGlvbgogICAgICAgICAgICAgICAgZy5tZXNoLnJvdGF0aW9uLnogKz0gZy5yb3RhdGlvblNwZWVkICogZHQ7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChnLnNjYWxlU3BlZWQgIT09IDApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzID0gZy5tZXNoLnNjYWxlLnggKyBnLnNjYWxlU3BlZWQgKiBkdDsKICAgICAgICAgICAgICAgICAgICBnLm1lc2guc2NhbGUuc2V0KHMsIHMsIHMpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIEZhZGUKICAgICAgICAgICAgICAgIGlmIChnLmZhZGUpIHsKICAgICAgICAgICAgICAgICAgICBsZXQgb3BhY2l0eSA9IDEuMDsKICAgICAgICAgICAgICAgICAgICBpZiAodCA8IDAuMSkgb3BhY2l0eSA9IHQgLyAwLjE7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodCA+IDAuNykgb3BhY2l0eSA9IDEuMCAtICgodCAtIDAuNykgLyAwLjMpOwogICAgICAgICAgICAgICAgICAgIGcubWVzaC5tYXRlcmlhbC5vcGFjaXR5ID0gb3BhY2l0eTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICB3aW5kb3cuZmx1eC5HbHlwaE1hbmFnZXIgPSBHbHlwaE1hbmFnZXI7Cn0pKCk7","./GlyphManager.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICAvLyAtLS0gVEVYVFVSRSBHRU5FUkFUSU9OIC0tLQogICAgY29uc3QgX2NyZWF0ZUdseXBoVGV4dHVyZSA9IChjb2xvclN0ciwgdHlwZSkgPT4gewogICAgICAgIGNvbnN0IHNpemUgPSAyNTY7CiAgICAgICAgY29uc3QgYyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICAgIGMud2lkdGggPSBzaXplOyBjLmhlaWdodCA9IHNpemU7CiAgICAgICAgY29uc3QgY3R4ID0gYy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgIAogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgc2l6ZSwgc2l6ZSk7CiAgICAgICAgCiAgICAgICAgLy8gR2xvdyBzZXR0aW5ncwogICAgICAgIGN0eC5zaGFkb3dCbHVyID0gMTU7CiAgICAgICAgY3R4LnNoYWRvd0NvbG9yID0gY29sb3JTdHI7CiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gY29sb3JTdHI7CiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGNvbG9yU3RyOwogICAgICAgIGN0eC5saW5lQ2FwID0gJ3JvdW5kJzsKCiAgICAgICAgY29uc3QgY3ggPSBzaXplIC8gMjsKICAgICAgICBjb25zdCBjeSA9IHNpemUgLyAyOwoKICAgICAgICBpZiAodHlwZSA9PT0gJ3JpbmcnKSB7CiAgICAgICAgICAgIC8vIE91dGVyIFJpbmcKICAgICAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDY7CiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgY3R4LmFyYyhjeCwgY3ksIDExMCwgMCwgTWF0aC5QSSAqIDIpOwogICAgICAgICAgICBjdHguc3Ryb2tlKCk7CgogICAgICAgICAgICAvLyBJbm5lciBSaW5nCiAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSAzOwogICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgIGN0eC5hcmMoY3gsIGN5LCA5MCwgMCwgTWF0aC5QSSAqIDIpOwogICAgICAgICAgICBjdHguc3Ryb2tlKCk7CgogICAgICAgICAgICAvLyBSdW5lcwogICAgICAgICAgICBjdHguZm9udCA9ICdib2xkIDI0cHggc2Fucy1zZXJpZic7CiAgICAgICAgICAgIGN0eC50ZXh0QWxpZ24gPSAnY2VudGVyJzsKICAgICAgICAgICAgY3R4LnRleHRCYXNlbGluZSA9ICdtaWRkbGUnOwogICAgICAgICAgICBmb3IobGV0IGk9MDsgaTw4OyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGFuZ2xlID0gKGkgLyA4KSAqIE1hdGguUEkgKiAyOwogICAgICAgICAgICAgICAgY29uc3QgciA9IDEwMDsKICAgICAgICAgICAgICAgIGNvbnN0IHggPSBjeCArIE1hdGguY29zKGFuZ2xlKSAqIHI7CiAgICAgICAgICAgICAgICBjb25zdCB5ID0gY3kgKyBNYXRoLnNpbihhbmdsZSkgKiByOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZSh4LCB5KTsKICAgICAgICAgICAgICAgIGN0eC5yb3RhdGUoYW5nbGUgKyBNYXRoLlBJLzIpOwogICAgICAgICAgICAgICAgLy8gRHJhdyBhIHNpbXBsZSBydW5lLWxpa2Ugc2hhcGUKICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgICAgIGN0eC5tb3ZlVG8oLTUsIC01KTsgY3R4LmxpbmVUbyg1LCAwKTsgY3R4LmxpbmVUbygtNSwgNSk7CiAgICAgICAgICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAncnVuZScpIHsKICAgICAgICAgICAgLy8gQ2VudHJhbCBDb21wbGV4IFJ1bmUKICAgICAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDU7CiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgY3R4LmFyYyhjeCwgY3ksIDYwLCAwLCBNYXRoLlBJICogMik7CiAgICAgICAgICAgIGN0eC5zdHJva2UoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgY3R4Lm1vdmVUbyhjeCwgY3kgLSA2MCk7CiAgICAgICAgICAgIGN0eC5saW5lVG8oY3gsIGN5ICsgNjApOwogICAgICAgICAgICBjdHgubW92ZVRvKGN4IC0gNjAsIGN5KTsKICAgICAgICAgICAgY3R4LmxpbmVUbyhjeCArIDYwLCBjeSk7CiAgICAgICAgICAgIGN0eC5zdHJva2UoKTsKCiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgY3R4LmFyYyhjeCwgY3ksIDIwLCAwLCBNYXRoLlBJICogMik7CiAgICAgICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCB0ZXggPSBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICAgICAgICByZXR1cm4gdGV4OwogICAgfTsKCiAgICBjb25zdCBfdGVjaFRleHR1cmUgPSBfY3JlYXRlR2x5cGhUZXh0dXJlKCcjMDBmZmZmJywgJ3JpbmcnKTsgLy8gQ3lhbiBSaW5nCiAgICBjb25zdCBfc3RhdHVzVGV4dHVyZSA9IF9jcmVhdGVHbHlwaFRleHR1cmUoJyNmZjAwZmYnLCAncnVuZScpOyAvLyBNYWdlbnRhIFJ1bmUKICAgIGNvbnN0IF9jaGFyZ2VUZXh0dXJlID0gX2NyZWF0ZUdseXBoVGV4dHVyZSgnI2ZmZmYwMCcsICdyaW5nJyk7IC8vIEdvbGQgUmluZwoKICAgIGNsYXNzIEdseXBoTWFuYWdlciB7CiAgICAgICAgY29uc3RydWN0b3Ioc2NlbmUpIHsKICAgICAgICAgICAgdGhpcy5zY2VuZSA9IHNjZW5lOwogICAgICAgICAgICB0aGlzLmdseXBocyA9IFtdOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gTWF0ZXJpYWxzCiAgICAgICAgICAgIHRoaXMubWF0ZXJpYWxzID0gewogICAgICAgICAgICAgICAgdGVjaDogbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHsgCiAgICAgICAgICAgICAgICAgICAgbWFwOiBfdGVjaFRleHR1cmUsIAogICAgICAgICAgICAgICAgICAgIHRyYW5zcGFyZW50OiB0cnVlLCAKICAgICAgICAgICAgICAgICAgICBzaWRlOiBUSFJFRS5Eb3VibGVTaWRlLCAKICAgICAgICAgICAgICAgICAgICBibGVuZGluZzogVEhSRUUuQWRkaXRpdmVCbGVuZGluZywKICAgICAgICAgICAgICAgICAgICBkZXB0aFdyaXRlOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBjb2xvcjogMHhmZmZmZmYKICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgc3RhdHVzOiBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyAKICAgICAgICAgICAgICAgICAgICBtYXA6IF9zdGF0dXNUZXh0dXJlLCAKICAgICAgICAgICAgICAgICAgICB0cmFuc3BhcmVudDogdHJ1ZSwgCiAgICAgICAgICAgICAgICAgICAgc2lkZTogVEhSRUUuRG91YmxlU2lkZSwgCiAgICAgICAgICAgICAgICAgICAgYmxlbmRpbmc6IFRIUkVFLkFkZGl0aXZlQmxlbmRpbmcsCiAgICAgICAgICAgICAgICAgICAgZGVwdGhXcml0ZTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgY29sb3I6IDB4ZmZmZmZmCiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIGNoYXJnZTogbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHsgCiAgICAgICAgICAgICAgICAgICAgbWFwOiBfY2hhcmdlVGV4dHVyZSwgCiAgICAgICAgICAgICAgICAgICAgdHJhbnNwYXJlbnQ6IHRydWUsIAogICAgICAgICAgICAgICAgICAgIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGUsIAogICAgICAgICAgICAgICAgICAgIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nLAogICAgICAgICAgICAgICAgICAgIGRlcHRoV3JpdGU6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGNvbG9yOiAweGZmZmZmZgogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8vIFBvb2wKICAgICAgICAgICAgdGhpcy5wb29sID0gW107CiAgICAgICAgICAgIHRoaXMucG9vbFNpemUgPSAzMDsKICAgICAgICAgICAgY29uc3QgZ2VvID0gbmV3IFRIUkVFLlBsYW5lR2VvbWV0cnkoMSwgMSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IobGV0IGk9MDsgaTx0aGlzLnBvb2xTaXplOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IG1lc2ggPSBuZXcgVEhSRUUuTWVzaChnZW8sIHRoaXMubWF0ZXJpYWxzLnRlY2gpOwogICAgICAgICAgICAgICAgbWVzaC52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICBtZXNoLnJlbmRlck9yZGVyID0gMjAwMDsgLy8gRHJhdyBvbiB0b3Agb2Ygd2F0ZXIvYXJlbmEKICAgICAgICAgICAgICAgIHRoaXMuc2NlbmUuYWRkKG1lc2gpOwogICAgICAgICAgICAgICAgdGhpcy5wb29sLnB1c2gobWVzaCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHNwYXduKHR5cGUsIHBvcywgb3B0aW9ucyA9IHt9KSB7CiAgICAgICAgICAgIGNvbnN0IG1lc2ggPSB0aGlzLnBvb2wuZmluZChtID0+ICFtLnZpc2libGUpOwogICAgICAgICAgICBpZiAoIW1lc2gpIHJldHVybjsKCiAgICAgICAgICAgIG1lc2gudmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgIG1lc2gubWF0ZXJpYWwgPSB0aGlzLm1hdGVyaWFsc1t0eXBlXSB8fCB0aGlzLm1hdGVyaWFscy50ZWNoOwogICAgICAgICAgICBtZXNoLnBvc2l0aW9uLmNvcHkocG9zKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFJlc2V0IE1hdGVyaWFsIE9wYWNpdHkKICAgICAgICAgICAgbWVzaC5tYXRlcmlhbC5vcGFjaXR5ID0gMS4wOwoKICAgICAgICAgICAgLy8gRGVmYXVsdHMKICAgICAgICAgICAgY29uc3Qgc2NhbGUgPSBvcHRpb25zLnNjYWxlIHx8IDEuMDsKICAgICAgICAgICAgbWVzaC5zY2FsZS5zZXQoc2NhbGUsIHNjYWxlLCBzY2FsZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBPcmllbnRhdGlvbgogICAgICAgICAgICBpZiAob3B0aW9ucy5mYWNlQ2FtZXJhKSB7CiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlICYmIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5jYW1lcmEpIHsKICAgICAgICAgICAgICAgICAgICBtZXNoLmxvb2tBdCh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChvcHRpb25zLm9yaWVudGF0aW9uID09PSAndmVydGljYWwnKSB7CiAgICAgICAgICAgICAgICBtZXNoLnJvdGF0aW9uLnNldCgwLCAwLCAwKTsKICAgICAgICAgICAgICAgIC8vIEZhY2UgY2FtZXJhIFktYXhpcyByb3RhdGlvbiBvbmx5CiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlICYmIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5jYW1lcmEpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjYW1Qb3MgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhLnBvc2l0aW9uOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGFuZ2xlID0gTWF0aC5hdGFuMihjYW1Qb3MueCAtIHBvcy54LCBjYW1Qb3MueiAtIHBvcy56KTsKICAgICAgICAgICAgICAgICAgICBtZXNoLnJvdGF0aW9uLnkgPSBhbmdsZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEhvcml6b250YWwgKEdyb3VuZCkKICAgICAgICAgICAgICAgIG1lc2gucm90YXRpb24uc2V0KC1NYXRoLlBJIC8gMiwgMCwgTWF0aC5yYW5kb20oKSAqIE1hdGguUEkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAob3B0aW9ucy5vZmZzZXRZKSB7CiAgICAgICAgICAgICAgICBtZXNoLnBvc2l0aW9uLnkgKz0gb3B0aW9ucy5vZmZzZXRZOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmdseXBocy5wdXNoKHsKICAgICAgICAgICAgICAgIG1lc2g6IG1lc2gsCiAgICAgICAgICAgICAgICBhZ2U6IDAsCiAgICAgICAgICAgICAgICBsaWZlOiBvcHRpb25zLmxpZmUgfHwgMS4wLAogICAgICAgICAgICAgICAgbWF4TGlmZTogb3B0aW9ucy5saWZlIHx8IDEuMCwKICAgICAgICAgICAgICAgIHJvdGF0aW9uU3BlZWQ6IG9wdGlvbnMucm90YXRpb25TcGVlZCB8fCAxLjAsCiAgICAgICAgICAgICAgICBzY2FsZVNwZWVkOiBvcHRpb25zLnNjYWxlU3BlZWQgfHwgMCwKICAgICAgICAgICAgICAgIGZhZGU6IG9wdGlvbnMuZmFkZSAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5mYWRlIDogdHJ1ZSwKICAgICAgICAgICAgICAgIGZvbGxvd1RhcmdldDogb3B0aW9ucy5wYXJlbnQgfHwgbnVsbCwKICAgICAgICAgICAgICAgIG9mZnNldFk6IG9wdGlvbnMub2Zmc2V0WSB8fCAwCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgdXBkYXRlKGR0KSB7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSB0aGlzLmdseXBocy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICAgICAgY29uc3QgZyA9IHRoaXMuZ2x5cGhzW2ldOwogICAgICAgICAgICAgICAgZy5hZ2UgKz0gZHQ7CgogICAgICAgICAgICAgICAgaWYgKGcuYWdlID49IGcubGlmZSkgewogICAgICAgICAgICAgICAgICAgIGcubWVzaC52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5nbHlwaHMuc3BsaWNlKGksIDEpOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBnLmFnZSAvIGcubWF4TGlmZTsKCiAgICAgICAgICAgICAgICAvLyBGb2xsb3cgdGFyZ2V0CiAgICAgICAgICAgICAgICBpZiAoZy5mb2xsb3dUYXJnZXQgJiYgZy5mb2xsb3dUYXJnZXQubWVzaCkgewogICAgICAgICAgICAgICAgICAgIGcubWVzaC5wb3NpdGlvbi5jb3B5KGcuZm9sbG93VGFyZ2V0Lm1lc2gucG9zaXRpb24pOwogICAgICAgICAgICAgICAgICAgIGcubWVzaC5wb3NpdGlvbi55ICs9IGcub2Zmc2V0WTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBJZiBncm91bmQgb3JpZW50ZWQsIGtlZXAgbmVhciBmbG9vcgogICAgICAgICAgICAgICAgICAgIGlmIChnLm1lc2gucm90YXRpb24ueCA9PT0gLU1hdGguUEkvMikgewogICAgICAgICAgICAgICAgICAgICAgICAgZy5tZXNoLnBvc2l0aW9uLnkgPSAwLjEgKyBnLm9mZnNldFk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIEFuaW1hdGlvbgogICAgICAgICAgICAgICAgZy5tZXNoLnJvdGF0aW9uLnogKz0gZy5yb3RhdGlvblNwZWVkICogZHQ7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChnLnNjYWxlU3BlZWQgIT09IDApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzID0gZy5tZXNoLnNjYWxlLnggKyBnLnNjYWxlU3BlZWQgKiBkdDsKICAgICAgICAgICAgICAgICAgICBnLm1lc2guc2NhbGUuc2V0KHMsIHMsIHMpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIEZhZGUKICAgICAgICAgICAgICAgIGlmIChnLmZhZGUpIHsKICAgICAgICAgICAgICAgICAgICBsZXQgb3BhY2l0eSA9IDEuMDsKICAgICAgICAgICAgICAgICAgICBpZiAodCA8IDAuMSkgb3BhY2l0eSA9IHQgLyAwLjE7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodCA+IDAuNykgb3BhY2l0eSA9IDEuMCAtICgodCAtIDAuNykgLyAwLjMpOwogICAgICAgICAgICAgICAgICAgIGcubWVzaC5tYXRlcmlhbC5vcGFjaXR5ID0gb3BhY2l0eTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICB3aW5kb3cuZmx1eC5HbHlwaE1hbmFnZXIgPSBHbHlwaE1hbmFnZXI7Cn0pKCk7","/GlyphManager.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICAvLyAtLS0gVEVYVFVSRSBHRU5FUkFUSU9OIC0tLQogICAgY29uc3QgX2NyZWF0ZUdseXBoVGV4dHVyZSA9IChjb2xvclN0ciwgdHlwZSkgPT4gewogICAgICAgIGNvbnN0IHNpemUgPSAyNTY7CiAgICAgICAgY29uc3QgYyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICAgIGMud2lkdGggPSBzaXplOyBjLmhlaWdodCA9IHNpemU7CiAgICAgICAgY29uc3QgY3R4ID0gYy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgIAogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgc2l6ZSwgc2l6ZSk7CiAgICAgICAgCiAgICAgICAgLy8gR2xvdyBzZXR0aW5ncwogICAgICAgIGN0eC5zaGFkb3dCbHVyID0gMTU7CiAgICAgICAgY3R4LnNoYWRvd0NvbG9yID0gY29sb3JTdHI7CiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gY29sb3JTdHI7CiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGNvbG9yU3RyOwogICAgICAgIGN0eC5saW5lQ2FwID0gJ3JvdW5kJzsKCiAgICAgICAgY29uc3QgY3ggPSBzaXplIC8gMjsKICAgICAgICBjb25zdCBjeSA9IHNpemUgLyAyOwoKICAgICAgICBpZiAodHlwZSA9PT0gJ3JpbmcnKSB7CiAgICAgICAgICAgIC8vIE91dGVyIFJpbmcKICAgICAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDY7CiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgY3R4LmFyYyhjeCwgY3ksIDExMCwgMCwgTWF0aC5QSSAqIDIpOwogICAgICAgICAgICBjdHguc3Ryb2tlKCk7CgogICAgICAgICAgICAvLyBJbm5lciBSaW5nCiAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSAzOwogICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgIGN0eC5hcmMoY3gsIGN5LCA5MCwgMCwgTWF0aC5QSSAqIDIpOwogICAgICAgICAgICBjdHguc3Ryb2tlKCk7CgogICAgICAgICAgICAvLyBSdW5lcwogICAgICAgICAgICBjdHguZm9udCA9ICdib2xkIDI0cHggc2Fucy1zZXJpZic7CiAgICAgICAgICAgIGN0eC50ZXh0QWxpZ24gPSAnY2VudGVyJzsKICAgICAgICAgICAgY3R4LnRleHRCYXNlbGluZSA9ICdtaWRkbGUnOwogICAgICAgICAgICBmb3IobGV0IGk9MDsgaTw4OyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGFuZ2xlID0gKGkgLyA4KSAqIE1hdGguUEkgKiAyOwogICAgICAgICAgICAgICAgY29uc3QgciA9IDEwMDsKICAgICAgICAgICAgICAgIGNvbnN0IHggPSBjeCArIE1hdGguY29zKGFuZ2xlKSAqIHI7CiAgICAgICAgICAgICAgICBjb25zdCB5ID0gY3kgKyBNYXRoLnNpbihhbmdsZSkgKiByOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZSh4LCB5KTsKICAgICAgICAgICAgICAgIGN0eC5yb3RhdGUoYW5nbGUgKyBNYXRoLlBJLzIpOwogICAgICAgICAgICAgICAgLy8gRHJhdyBhIHNpbXBsZSBydW5lLWxpa2Ugc2hhcGUKICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgICAgIGN0eC5tb3ZlVG8oLTUsIC01KTsgY3R4LmxpbmVUbyg1LCAwKTsgY3R4LmxpbmVUbygtNSwgNSk7CiAgICAgICAgICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAncnVuZScpIHsKICAgICAgICAgICAgLy8gQ2VudHJhbCBDb21wbGV4IFJ1bmUKICAgICAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDU7CiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgY3R4LmFyYyhjeCwgY3ksIDYwLCAwLCBNYXRoLlBJICogMik7CiAgICAgICAgICAgIGN0eC5zdHJva2UoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgY3R4Lm1vdmVUbyhjeCwgY3kgLSA2MCk7CiAgICAgICAgICAgIGN0eC5saW5lVG8oY3gsIGN5ICsgNjApOwogICAgICAgICAgICBjdHgubW92ZVRvKGN4IC0gNjAsIGN5KTsKICAgICAgICAgICAgY3R4LmxpbmVUbyhjeCArIDYwLCBjeSk7CiAgICAgICAgICAgIGN0eC5zdHJva2UoKTsKCiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgY3R4LmFyYyhjeCwgY3ksIDIwLCAwLCBNYXRoLlBJICogMik7CiAgICAgICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCB0ZXggPSBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjKTsKICAgICAgICByZXR1cm4gdGV4OwogICAgfTsKCiAgICBjb25zdCBfdGVjaFRleHR1cmUgPSBfY3JlYXRlR2x5cGhUZXh0dXJlKCcjMDBmZmZmJywgJ3JpbmcnKTsgLy8gQ3lhbiBSaW5nCiAgICBjb25zdCBfc3RhdHVzVGV4dHVyZSA9IF9jcmVhdGVHbHlwaFRleHR1cmUoJyNmZjAwZmYnLCAncnVuZScpOyAvLyBNYWdlbnRhIFJ1bmUKICAgIGNvbnN0IF9jaGFyZ2VUZXh0dXJlID0gX2NyZWF0ZUdseXBoVGV4dHVyZSgnI2ZmZmYwMCcsICdyaW5nJyk7IC8vIEdvbGQgUmluZwoKICAgIGNsYXNzIEdseXBoTWFuYWdlciB7CiAgICAgICAgY29uc3RydWN0b3Ioc2NlbmUpIHsKICAgICAgICAgICAgdGhpcy5zY2VuZSA9IHNjZW5lOwogICAgICAgICAgICB0aGlzLmdseXBocyA9IFtdOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gTWF0ZXJpYWxzCiAgICAgICAgICAgIHRoaXMubWF0ZXJpYWxzID0gewogICAgICAgICAgICAgICAgdGVjaDogbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHsgCiAgICAgICAgICAgICAgICAgICAgbWFwOiBfdGVjaFRleHR1cmUsIAogICAgICAgICAgICAgICAgICAgIHRyYW5zcGFyZW50OiB0cnVlLCAKICAgICAgICAgICAgICAgICAgICBzaWRlOiBUSFJFRS5Eb3VibGVTaWRlLCAKICAgICAgICAgICAgICAgICAgICBibGVuZGluZzogVEhSRUUuQWRkaXRpdmVCbGVuZGluZywKICAgICAgICAgICAgICAgICAgICBkZXB0aFdyaXRlOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBjb2xvcjogMHhmZmZmZmYKICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgc3RhdHVzOiBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyAKICAgICAgICAgICAgICAgICAgICBtYXA6IF9zdGF0dXNUZXh0dXJlLCAKICAgICAgICAgICAgICAgICAgICB0cmFuc3BhcmVudDogdHJ1ZSwgCiAgICAgICAgICAgICAgICAgICAgc2lkZTogVEhSRUUuRG91YmxlU2lkZSwgCiAgICAgICAgICAgICAgICAgICAgYmxlbmRpbmc6IFRIUkVFLkFkZGl0aXZlQmxlbmRpbmcsCiAgICAgICAgICAgICAgICAgICAgZGVwdGhXcml0ZTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgY29sb3I6IDB4ZmZmZmZmCiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIGNoYXJnZTogbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHsgCiAgICAgICAgICAgICAgICAgICAgbWFwOiBfY2hhcmdlVGV4dHVyZSwgCiAgICAgICAgICAgICAgICAgICAgdHJhbnNwYXJlbnQ6IHRydWUsIAogICAgICAgICAgICAgICAgICAgIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGUsIAogICAgICAgICAgICAgICAgICAgIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nLAogICAgICAgICAgICAgICAgICAgIGRlcHRoV3JpdGU6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGNvbG9yOiAweGZmZmZmZgogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8vIFBvb2wKICAgICAgICAgICAgdGhpcy5wb29sID0gW107CiAgICAgICAgICAgIHRoaXMucG9vbFNpemUgPSAzMDsKICAgICAgICAgICAgY29uc3QgZ2VvID0gbmV3IFRIUkVFLlBsYW5lR2VvbWV0cnkoMSwgMSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IobGV0IGk9MDsgaTx0aGlzLnBvb2xTaXplOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IG1lc2ggPSBuZXcgVEhSRUUuTWVzaChnZW8sIHRoaXMubWF0ZXJpYWxzLnRlY2gpOwogICAgICAgICAgICAgICAgbWVzaC52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICBtZXNoLnJlbmRlck9yZGVyID0gMjAwMDsgLy8gRHJhdyBvbiB0b3Agb2Ygd2F0ZXIvYXJlbmEKICAgICAgICAgICAgICAgIHRoaXMuc2NlbmUuYWRkKG1lc2gpOwogICAgICAgICAgICAgICAgdGhpcy5wb29sLnB1c2gobWVzaCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHNwYXduKHR5cGUsIHBvcywgb3B0aW9ucyA9IHt9KSB7CiAgICAgICAgICAgIGNvbnN0IG1lc2ggPSB0aGlzLnBvb2wuZmluZChtID0+ICFtLnZpc2libGUpOwogICAgICAgICAgICBpZiAoIW1lc2gpIHJldHVybjsKCiAgICAgICAgICAgIG1lc2gudmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgIG1lc2gubWF0ZXJpYWwgPSB0aGlzLm1hdGVyaWFsc1t0eXBlXSB8fCB0aGlzLm1hdGVyaWFscy50ZWNoOwogICAgICAgICAgICBtZXNoLnBvc2l0aW9uLmNvcHkocG9zKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFJlc2V0IE1hdGVyaWFsIE9wYWNpdHkKICAgICAgICAgICAgbWVzaC5tYXRlcmlhbC5vcGFjaXR5ID0gMS4wOwoKICAgICAgICAgICAgLy8gRGVmYXVsdHMKICAgICAgICAgICAgY29uc3Qgc2NhbGUgPSBvcHRpb25zLnNjYWxlIHx8IDEuMDsKICAgICAgICAgICAgbWVzaC5zY2FsZS5zZXQoc2NhbGUsIHNjYWxlLCBzY2FsZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBPcmllbnRhdGlvbgogICAgICAgICAgICBpZiAob3B0aW9ucy5mYWNlQ2FtZXJhKSB7CiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlICYmIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5jYW1lcmEpIHsKICAgICAgICAgICAgICAgICAgICBtZXNoLmxvb2tBdCh3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhLnBvc2l0aW9uKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChvcHRpb25zLm9yaWVudGF0aW9uID09PSAndmVydGljYWwnKSB7CiAgICAgICAgICAgICAgICBtZXNoLnJvdGF0aW9uLnNldCgwLCAwLCAwKTsKICAgICAgICAgICAgICAgIC8vIEZhY2UgY2FtZXJhIFktYXhpcyByb3RhdGlvbiBvbmx5CiAgICAgICAgICAgICAgICBpZiAod2luZG93LmZsdXguZ2FtZUluc3RhbmNlICYmIHdpbmRvdy5mbHV4LmdhbWVJbnN0YW5jZS5jYW1lcmEpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjYW1Qb3MgPSB3aW5kb3cuZmx1eC5nYW1lSW5zdGFuY2UuY2FtZXJhLnBvc2l0aW9uOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGFuZ2xlID0gTWF0aC5hdGFuMihjYW1Qb3MueCAtIHBvcy54LCBjYW1Qb3MueiAtIHBvcy56KTsKICAgICAgICAgICAgICAgICAgICBtZXNoLnJvdGF0aW9uLnkgPSBhbmdsZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEhvcml6b250YWwgKEdyb3VuZCkKICAgICAgICAgICAgICAgIG1lc2gucm90YXRpb24uc2V0KC1NYXRoLlBJIC8gMiwgMCwgTWF0aC5yYW5kb20oKSAqIE1hdGguUEkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAob3B0aW9ucy5vZmZzZXRZKSB7CiAgICAgICAgICAgICAgICBtZXNoLnBvc2l0aW9uLnkgKz0gb3B0aW9ucy5vZmZzZXRZOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmdseXBocy5wdXNoKHsKICAgICAgICAgICAgICAgIG1lc2g6IG1lc2gsCiAgICAgICAgICAgICAgICBhZ2U6IDAsCiAgICAgICAgICAgICAgICBsaWZlOiBvcHRpb25zLmxpZmUgfHwgMS4wLAogICAgICAgICAgICAgICAgbWF4TGlmZTogb3B0aW9ucy5saWZlIHx8IDEuMCwKICAgICAgICAgICAgICAgIHJvdGF0aW9uU3BlZWQ6IG9wdGlvbnMucm90YXRpb25TcGVlZCB8fCAxLjAsCiAgICAgICAgICAgICAgICBzY2FsZVNwZWVkOiBvcHRpb25zLnNjYWxlU3BlZWQgfHwgMCwKICAgICAgICAgICAgICAgIGZhZGU6IG9wdGlvbnMuZmFkZSAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5mYWRlIDogdHJ1ZSwKICAgICAgICAgICAgICAgIGZvbGxvd1RhcmdldDogb3B0aW9ucy5wYXJlbnQgfHwgbnVsbCwKICAgICAgICAgICAgICAgIG9mZnNldFk6IG9wdGlvbnMub2Zmc2V0WSB8fCAwCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgdXBkYXRlKGR0KSB7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSB0aGlzLmdseXBocy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICAgICAgY29uc3QgZyA9IHRoaXMuZ2x5cGhzW2ldOwogICAgICAgICAgICAgICAgZy5hZ2UgKz0gZHQ7CgogICAgICAgICAgICAgICAgaWYgKGcuYWdlID49IGcubGlmZSkgewogICAgICAgICAgICAgICAgICAgIGcubWVzaC52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5nbHlwaHMuc3BsaWNlKGksIDEpOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBnLmFnZSAvIGcubWF4TGlmZTsKCiAgICAgICAgICAgICAgICAvLyBGb2xsb3cgdGFyZ2V0CiAgICAgICAgICAgICAgICBpZiAoZy5mb2xsb3dUYXJnZXQgJiYgZy5mb2xsb3dUYXJnZXQubWVzaCkgewogICAgICAgICAgICAgICAgICAgIGcubWVzaC5wb3NpdGlvbi5jb3B5KGcuZm9sbG93VGFyZ2V0Lm1lc2gucG9zaXRpb24pOwogICAgICAgICAgICAgICAgICAgIGcubWVzaC5wb3NpdGlvbi55ICs9IGcub2Zmc2V0WTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBJZiBncm91bmQgb3JpZW50ZWQsIGtlZXAgbmVhciBmbG9vcgogICAgICAgICAgICAgICAgICAgIGlmIChnLm1lc2gucm90YXRpb24ueCA9PT0gLU1hdGguUEkvMikgewogICAgICAgICAgICAgICAgICAgICAgICAgZy5tZXNoLnBvc2l0aW9uLnkgPSAwLjEgKyBnLm9mZnNldFk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIEFuaW1hdGlvbgogICAgICAgICAgICAgICAgZy5tZXNoLnJvdGF0aW9uLnogKz0gZy5yb3RhdGlvblNwZWVkICogZHQ7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChnLnNjYWxlU3BlZWQgIT09IDApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzID0gZy5tZXNoLnNjYWxlLnggKyBnLnNjYWxlU3BlZWQgKiBkdDsKICAgICAgICAgICAgICAgICAgICBnLm1lc2guc2NhbGUuc2V0KHMsIHMsIHMpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIEZhZGUKICAgICAgICAgICAgICAgIGlmIChnLmZhZGUpIHsKICAgICAgICAgICAgICAgICAgICBsZXQgb3BhY2l0eSA9IDEuMDsKICAgICAgICAgICAgICAgICAgICBpZiAodCA8IDAuMSkgb3BhY2l0eSA9IHQgLyAwLjE7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodCA+IDAuNykgb3BhY2l0eSA9IDEuMCAtICgodCAtIDAuNykgLyAwLjMpOwogICAgICAgICAgICAgICAgICAgIGcubWVzaC5tYXRlcmlhbC5vcGFjaXR5ID0gb3BhY2l0eTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICB3aW5kb3cuZmx1eC5HbHlwaE1hbmFnZXIgPSBHbHlwaE1hbmFnZXI7Cn0pKCk7","AudioManager.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICBjbGFzcyBBdWRpb01hbmFnZXIgewogICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICB0aGlzLmJnbSA9IG5ldyBBdWRpbygpOwogICAgICAgICAgICB0aGlzLmJnbS5zcmMgPSAnaHR0cHM6Ly9maWxlcy5jYXRib3gubW9lL3NwMnloeS5tcDMnOwogICAgICAgICAgICB0aGlzLmJnbS5sb29wID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5iZ20udm9sdW1lID0gMC41OwogICAgICAgICAgICB0aGlzLmlzTXV0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5oYXNJbnRlcmFjdGVkID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuc2hvdWxkQmVQbGF5aW5nID0gZmFsc2U7IC8vIEludGVudCBmbGFnCgogICAgICAgICAgICAvLyBQcmVsb2FkCiAgICAgICAgICAgIHRoaXMuYmdtLmxvYWQoKTsKCiAgICAgICAgICAgIC8vIC0tLSBIRVJDVUxFQU4gTE9PUCBFTkZPUkNFTUVOVCAtLS0KICAgICAgICAgICAgLy8gMS4gTWFudWFsIExvb3AgUmVkdW5kYW5jeQogICAgICAgICAgICB0aGlzLmJnbS5hZGRFdmVudExpc3RlbmVyKCdlbmRlZCcsICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJBdWRpb01hbmFnZXI6IEJHTSBlbmRlZCBldmVudCBjYXVnaHQuIEZvcmNpbmcgbWFudWFsIGxvb3AgcmVzZXQuIik7CiAgICAgICAgICAgICAgICB0aGlzLmJnbS5jdXJyZW50VGltZSA9IDA7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5zaG91bGRCZVBsYXlpbmcgJiYgIXRoaXMuaXNNdXRlZCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSB0aGlzLmJnbS5wbGF5KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHAgIT09IHVuZGVmaW5lZCkgcC5jYXRjaChlID0+IGNvbnNvbGUud2FybigiTWFudWFsIGxvb3AgcmVwbGF5IGZhaWxlZDoiLCBlKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gMi4gUGF1c2UgV2F0Y2hkb2cgKElmIHBhdXNlZCBidXQgc2hvdWxkIGJlIHBsYXlpbmcsIEZPUkNFIFBMQVkpCiAgICAgICAgICAgIHRoaXMuYmdtLmFkZEV2ZW50TGlzdGVuZXIoJ3BhdXNlJywgKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKHRoaXMuc2hvdWxkQmVQbGF5aW5nICYmICF0aGlzLmlzTXV0ZWQpIHsKICAgICAgICAgICAgICAgICAgICAvLyBTbWFsbCB0aW1lb3V0IHRvIGFsbG93IGludGVudGlvbmFsIG9wZXJhdGlvbnMgdG8gZmluaXNoIGlmIGFueQogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zaG91bGRCZVBsYXlpbmcgJiYgdGhpcy5iZ20ucGF1c2VkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiQXVkaW9NYW5hZ2VyOiBVbmV4cGVjdGVkIHBhdXNlIGRldGVjdGVkLiBBdHRlbXB0aW5nIHJlc3VtZS4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYmdtLnBsYXkoKS5jYXRjaChlID0+IGNvbnNvbGUud2FybigiUmVzdW1lIGZhaWxlZDoiLCBlKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCAxMDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIDMuIFBlcmlvZGljIFdhdGNoZG9nIChUaGUgIk5ldmVyIFN0b3AiIEd1YXJhbnRlZSkKICAgICAgICAgICAgc2V0SW50ZXJ2YWwoKCkgPT4gdGhpcy5fd2F0Y2hkb2coKSwgMTAwMCk7CiAgICAgICAgfQoKICAgICAgICBfd2F0Y2hkb2coKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnNob3VsZEJlUGxheWluZyAmJiAhdGhpcy5pc011dGVkKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5iZ20ucGF1c2VkIHx8IHRoaXMuYmdtLmVuZGVkKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIkF1ZGlvTWFuYWdlcjogV2F0Y2hkb2cgZm9yY2luZyBwbGF5LiIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuYmdtLnBsYXkoKS5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNpbGVudCBjYXRjaCwgbGlrZWx5IHdhaXRpbmcgZm9yIGludGVyYWN0aW9uCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHBsYXlCR00oKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmlzTXV0ZWQpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5zaG91bGRCZVBsYXlpbmcgPSB0cnVlOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgcGxheVByb21pc2UgPSB0aGlzLmJnbS5wbGF5KCk7CiAgICAgICAgICAgIGlmIChwbGF5UHJvbWlzZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBwbGF5UHJvbWlzZS5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIkF1ZGlvTWFuYWdlcjogQXV0b3BsYXkgcHJldmVudGVkLiBFbmdhZ2luZyBpbnRlcmFjdGlvbiBsb2NrLiIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3dhaXRGb3JJbnRlcmFjdGlvbigpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIF93YWl0Rm9ySW50ZXJhY3Rpb24oKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl93YWl0aW5nRm9ySW50ZXJhY3Rpb24pIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fd2FpdGluZ0ZvckludGVyYWN0aW9uID0gdHJ1ZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IG9uSW50ZXJhY3QgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmhhc0ludGVyYWN0ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBUcnkgdG8gcGxheQogICAgICAgICAgICAgICAgaWYgKHRoaXMuc2hvdWxkQmVQbGF5aW5nICYmICF0aGlzLmlzTXV0ZWQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmJnbS5wbGF5KCkudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN1Y2Nlc3MhIERldGFjaCBsaXN0ZW5lcnMKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fd2FpdGluZ0ZvckludGVyYWN0aW9uID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZUludGVyYWN0aW9uTGlzdGVuZXJzKG9uSW50ZXJhY3QpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiQXVkaW9NYW5hZ2VyOiBBdWRpbyB1bmxvY2tlZCBzdWNjZXNzZnVsbHkuIik7CiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiQXVkaW9NYW5hZ2VyOiBJbnRlcmFjdGlvbiBwbGF5IGZhaWxlZC4gS2VlcGluZyBsaXN0ZW5lcnMgYXR0YWNoZWQuIiwgZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERvIE5PVCBkZXRhY2ggbGlzdGVuZXJzLCB3YWl0IGZvciBuZXh0IGludGVyYWN0aW9uCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIE5vdCBzdXBwb3NlZCB0byBwbGF5PyBKdXN0IGRldGFjaC4KICAgICAgICAgICAgICAgICAgICB0aGlzLl93YWl0aW5nRm9ySW50ZXJhY3Rpb24gPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZW1vdmVJbnRlcmFjdGlvbkxpc3RlbmVycyhvbkludGVyYWN0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFVzZSBjYXB0dXJlIHRvIGNhdGNoIGl0IGVhcmx5LCBidXQgZG9uJ3QgdXNlICdvbmNlOiB0cnVlJyBzbyB3ZSBjYW4gcmV0cnkgaWYgZmFpbGVkCiAgICAgICAgICAgIGNvbnN0IG9wdHMgPSB7IGNhcHR1cmU6IHRydWUsIHBhc3NpdmU6IHRydWUgfTsKICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkludGVyYWN0LCBvcHRzKTsKICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIG9uSW50ZXJhY3QsIG9wdHMpOwogICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgb25JbnRlcmFjdCwgb3B0cyk7CiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIG9uSW50ZXJhY3QsIG9wdHMpOwogICAgICAgIH0KCiAgICAgICAgX3JlbW92ZUludGVyYWN0aW9uTGlzdGVuZXJzKGhhbmRsZXIpIHsKICAgICAgICAgICAgY29uc3Qgb3B0cyA9IHsgY2FwdHVyZTogdHJ1ZSwgcGFzc2l2ZTogdHJ1ZSB9OwogICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZXIsIG9wdHMpOwogICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgaGFuZGxlciwgb3B0cyk7CiAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBoYW5kbGVyLCBvcHRzKTsKICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgaGFuZGxlciwgb3B0cyk7CiAgICAgICAgfQoKICAgICAgICBzdG9wQkdNKCkgewogICAgICAgICAgICB0aGlzLnNob3VsZEJlUGxheWluZyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmJnbS5wYXVzZSgpOwogICAgICAgICAgICB0aGlzLmJnbS5jdXJyZW50VGltZSA9IDA7CiAgICAgICAgfQoKICAgICAgICBwYXVzZUJHTSgpIHsKICAgICAgICAgICAgdGhpcy5zaG91bGRCZVBsYXlpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5iZ20ucGF1c2UoKTsKICAgICAgICB9CgogICAgICAgIHJlc3VtZUJHTSgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLmlzTXV0ZWQpIHsKICAgICAgICAgICAgICAgIHRoaXMucGxheUJHTSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBzZXRWb2x1bWUodm9sdW1lKSB7CiAgICAgICAgICAgIHRoaXMuYmdtLnZvbHVtZSA9IE1hdGgubWF4KDAsIE1hdGgubWluKDEsIHZvbHVtZSkpOwogICAgICAgIH0KCiAgICAgICAgdG9nZ2xlTXV0ZSgpIHsKICAgICAgICAgICAgdGhpcy5pc011dGVkID0gIXRoaXMuaXNNdXRlZDsKICAgICAgICAgICAgaWYgKHRoaXMuaXNNdXRlZCkgewogICAgICAgICAgICAgICAgdGhpcy5zaG91bGRCZVBsYXlpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMuYmdtLnBhdXNlKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnBsYXlCR00oKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy5pc011dGVkOwogICAgICAgIH0KICAgIH0KCiAgICB3aW5kb3cuZmx1eC5BdWRpb01hbmFnZXIgPSBBdWRpb01hbmFnZXI7Cn0pKCk7","./AudioManager.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICBjbGFzcyBBdWRpb01hbmFnZXIgewogICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICB0aGlzLmJnbSA9IG5ldyBBdWRpbygpOwogICAgICAgICAgICB0aGlzLmJnbS5zcmMgPSAnaHR0cHM6Ly9maWxlcy5jYXRib3gubW9lL3NwMnloeS5tcDMnOwogICAgICAgICAgICB0aGlzLmJnbS5sb29wID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5iZ20udm9sdW1lID0gMC41OwogICAgICAgICAgICB0aGlzLmlzTXV0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5oYXNJbnRlcmFjdGVkID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuc2hvdWxkQmVQbGF5aW5nID0gZmFsc2U7IC8vIEludGVudCBmbGFnCgogICAgICAgICAgICAvLyBQcmVsb2FkCiAgICAgICAgICAgIHRoaXMuYmdtLmxvYWQoKTsKCiAgICAgICAgICAgIC8vIC0tLSBIRVJDVUxFQU4gTE9PUCBFTkZPUkNFTUVOVCAtLS0KICAgICAgICAgICAgLy8gMS4gTWFudWFsIExvb3AgUmVkdW5kYW5jeQogICAgICAgICAgICB0aGlzLmJnbS5hZGRFdmVudExpc3RlbmVyKCdlbmRlZCcsICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJBdWRpb01hbmFnZXI6IEJHTSBlbmRlZCBldmVudCBjYXVnaHQuIEZvcmNpbmcgbWFudWFsIGxvb3AgcmVzZXQuIik7CiAgICAgICAgICAgICAgICB0aGlzLmJnbS5jdXJyZW50VGltZSA9IDA7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5zaG91bGRCZVBsYXlpbmcgJiYgIXRoaXMuaXNNdXRlZCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSB0aGlzLmJnbS5wbGF5KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHAgIT09IHVuZGVmaW5lZCkgcC5jYXRjaChlID0+IGNvbnNvbGUud2FybigiTWFudWFsIGxvb3AgcmVwbGF5IGZhaWxlZDoiLCBlKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gMi4gUGF1c2UgV2F0Y2hkb2cgKElmIHBhdXNlZCBidXQgc2hvdWxkIGJlIHBsYXlpbmcsIEZPUkNFIFBMQVkpCiAgICAgICAgICAgIHRoaXMuYmdtLmFkZEV2ZW50TGlzdGVuZXIoJ3BhdXNlJywgKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKHRoaXMuc2hvdWxkQmVQbGF5aW5nICYmICF0aGlzLmlzTXV0ZWQpIHsKICAgICAgICAgICAgICAgICAgICAvLyBTbWFsbCB0aW1lb3V0IHRvIGFsbG93IGludGVudGlvbmFsIG9wZXJhdGlvbnMgdG8gZmluaXNoIGlmIGFueQogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zaG91bGRCZVBsYXlpbmcgJiYgdGhpcy5iZ20ucGF1c2VkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiQXVkaW9NYW5hZ2VyOiBVbmV4cGVjdGVkIHBhdXNlIGRldGVjdGVkLiBBdHRlbXB0aW5nIHJlc3VtZS4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYmdtLnBsYXkoKS5jYXRjaChlID0+IGNvbnNvbGUud2FybigiUmVzdW1lIGZhaWxlZDoiLCBlKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCAxMDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIDMuIFBlcmlvZGljIFdhdGNoZG9nIChUaGUgIk5ldmVyIFN0b3AiIEd1YXJhbnRlZSkKICAgICAgICAgICAgc2V0SW50ZXJ2YWwoKCkgPT4gdGhpcy5fd2F0Y2hkb2coKSwgMTAwMCk7CiAgICAgICAgfQoKICAgICAgICBfd2F0Y2hkb2coKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnNob3VsZEJlUGxheWluZyAmJiAhdGhpcy5pc011dGVkKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5iZ20ucGF1c2VkIHx8IHRoaXMuYmdtLmVuZGVkKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIkF1ZGlvTWFuYWdlcjogV2F0Y2hkb2cgZm9yY2luZyBwbGF5LiIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuYmdtLnBsYXkoKS5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNpbGVudCBjYXRjaCwgbGlrZWx5IHdhaXRpbmcgZm9yIGludGVyYWN0aW9uCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHBsYXlCR00oKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmlzTXV0ZWQpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5zaG91bGRCZVBsYXlpbmcgPSB0cnVlOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgcGxheVByb21pc2UgPSB0aGlzLmJnbS5wbGF5KCk7CiAgICAgICAgICAgIGlmIChwbGF5UHJvbWlzZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBwbGF5UHJvbWlzZS5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIkF1ZGlvTWFuYWdlcjogQXV0b3BsYXkgcHJldmVudGVkLiBFbmdhZ2luZyBpbnRlcmFjdGlvbiBsb2NrLiIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3dhaXRGb3JJbnRlcmFjdGlvbigpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIF93YWl0Rm9ySW50ZXJhY3Rpb24oKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl93YWl0aW5nRm9ySW50ZXJhY3Rpb24pIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fd2FpdGluZ0ZvckludGVyYWN0aW9uID0gdHJ1ZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IG9uSW50ZXJhY3QgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmhhc0ludGVyYWN0ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBUcnkgdG8gcGxheQogICAgICAgICAgICAgICAgaWYgKHRoaXMuc2hvdWxkQmVQbGF5aW5nICYmICF0aGlzLmlzTXV0ZWQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmJnbS5wbGF5KCkudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN1Y2Nlc3MhIERldGFjaCBsaXN0ZW5lcnMKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fd2FpdGluZ0ZvckludGVyYWN0aW9uID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZUludGVyYWN0aW9uTGlzdGVuZXJzKG9uSW50ZXJhY3QpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiQXVkaW9NYW5hZ2VyOiBBdWRpbyB1bmxvY2tlZCBzdWNjZXNzZnVsbHkuIik7CiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiQXVkaW9NYW5hZ2VyOiBJbnRlcmFjdGlvbiBwbGF5IGZhaWxlZC4gS2VlcGluZyBsaXN0ZW5lcnMgYXR0YWNoZWQuIiwgZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERvIE5PVCBkZXRhY2ggbGlzdGVuZXJzLCB3YWl0IGZvciBuZXh0IGludGVyYWN0aW9uCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIE5vdCBzdXBwb3NlZCB0byBwbGF5PyBKdXN0IGRldGFjaC4KICAgICAgICAgICAgICAgICAgICB0aGlzLl93YWl0aW5nRm9ySW50ZXJhY3Rpb24gPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZW1vdmVJbnRlcmFjdGlvbkxpc3RlbmVycyhvbkludGVyYWN0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFVzZSBjYXB0dXJlIHRvIGNhdGNoIGl0IGVhcmx5LCBidXQgZG9uJ3QgdXNlICdvbmNlOiB0cnVlJyBzbyB3ZSBjYW4gcmV0cnkgaWYgZmFpbGVkCiAgICAgICAgICAgIGNvbnN0IG9wdHMgPSB7IGNhcHR1cmU6IHRydWUsIHBhc3NpdmU6IHRydWUgfTsKICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkludGVyYWN0LCBvcHRzKTsKICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIG9uSW50ZXJhY3QsIG9wdHMpOwogICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgb25JbnRlcmFjdCwgb3B0cyk7CiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIG9uSW50ZXJhY3QsIG9wdHMpOwogICAgICAgIH0KCiAgICAgICAgX3JlbW92ZUludGVyYWN0aW9uTGlzdGVuZXJzKGhhbmRsZXIpIHsKICAgICAgICAgICAgY29uc3Qgb3B0cyA9IHsgY2FwdHVyZTogdHJ1ZSwgcGFzc2l2ZTogdHJ1ZSB9OwogICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZXIsIG9wdHMpOwogICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgaGFuZGxlciwgb3B0cyk7CiAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBoYW5kbGVyLCBvcHRzKTsKICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgaGFuZGxlciwgb3B0cyk7CiAgICAgICAgfQoKICAgICAgICBzdG9wQkdNKCkgewogICAgICAgICAgICB0aGlzLnNob3VsZEJlUGxheWluZyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmJnbS5wYXVzZSgpOwogICAgICAgICAgICB0aGlzLmJnbS5jdXJyZW50VGltZSA9IDA7CiAgICAgICAgfQoKICAgICAgICBwYXVzZUJHTSgpIHsKICAgICAgICAgICAgdGhpcy5zaG91bGRCZVBsYXlpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5iZ20ucGF1c2UoKTsKICAgICAgICB9CgogICAgICAgIHJlc3VtZUJHTSgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLmlzTXV0ZWQpIHsKICAgICAgICAgICAgICAgIHRoaXMucGxheUJHTSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBzZXRWb2x1bWUodm9sdW1lKSB7CiAgICAgICAgICAgIHRoaXMuYmdtLnZvbHVtZSA9IE1hdGgubWF4KDAsIE1hdGgubWluKDEsIHZvbHVtZSkpOwogICAgICAgIH0KCiAgICAgICAgdG9nZ2xlTXV0ZSgpIHsKICAgICAgICAgICAgdGhpcy5pc011dGVkID0gIXRoaXMuaXNNdXRlZDsKICAgICAgICAgICAgaWYgKHRoaXMuaXNNdXRlZCkgewogICAgICAgICAgICAgICAgdGhpcy5zaG91bGRCZVBsYXlpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMuYmdtLnBhdXNlKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnBsYXlCR00oKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy5pc011dGVkOwogICAgICAgIH0KICAgIH0KCiAgICB3aW5kb3cuZmx1eC5BdWRpb01hbmFnZXIgPSBBdWRpb01hbmFnZXI7Cn0pKCk7","/AudioManager.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICBjbGFzcyBBdWRpb01hbmFnZXIgewogICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICB0aGlzLmJnbSA9IG5ldyBBdWRpbygpOwogICAgICAgICAgICB0aGlzLmJnbS5zcmMgPSAnaHR0cHM6Ly9maWxlcy5jYXRib3gubW9lL3NwMnloeS5tcDMnOwogICAgICAgICAgICB0aGlzLmJnbS5sb29wID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5iZ20udm9sdW1lID0gMC41OwogICAgICAgICAgICB0aGlzLmlzTXV0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5oYXNJbnRlcmFjdGVkID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuc2hvdWxkQmVQbGF5aW5nID0gZmFsc2U7IC8vIEludGVudCBmbGFnCgogICAgICAgICAgICAvLyBQcmVsb2FkCiAgICAgICAgICAgIHRoaXMuYmdtLmxvYWQoKTsKCiAgICAgICAgICAgIC8vIC0tLSBIRVJDVUxFQU4gTE9PUCBFTkZPUkNFTUVOVCAtLS0KICAgICAgICAgICAgLy8gMS4gTWFudWFsIExvb3AgUmVkdW5kYW5jeQogICAgICAgICAgICB0aGlzLmJnbS5hZGRFdmVudExpc3RlbmVyKCdlbmRlZCcsICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJBdWRpb01hbmFnZXI6IEJHTSBlbmRlZCBldmVudCBjYXVnaHQuIEZvcmNpbmcgbWFudWFsIGxvb3AgcmVzZXQuIik7CiAgICAgICAgICAgICAgICB0aGlzLmJnbS5jdXJyZW50VGltZSA9IDA7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5zaG91bGRCZVBsYXlpbmcgJiYgIXRoaXMuaXNNdXRlZCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSB0aGlzLmJnbS5wbGF5KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHAgIT09IHVuZGVmaW5lZCkgcC5jYXRjaChlID0+IGNvbnNvbGUud2FybigiTWFudWFsIGxvb3AgcmVwbGF5IGZhaWxlZDoiLCBlKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gMi4gUGF1c2UgV2F0Y2hkb2cgKElmIHBhdXNlZCBidXQgc2hvdWxkIGJlIHBsYXlpbmcsIEZPUkNFIFBMQVkpCiAgICAgICAgICAgIHRoaXMuYmdtLmFkZEV2ZW50TGlzdGVuZXIoJ3BhdXNlJywgKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKHRoaXMuc2hvdWxkQmVQbGF5aW5nICYmICF0aGlzLmlzTXV0ZWQpIHsKICAgICAgICAgICAgICAgICAgICAvLyBTbWFsbCB0aW1lb3V0IHRvIGFsbG93IGludGVudGlvbmFsIG9wZXJhdGlvbnMgdG8gZmluaXNoIGlmIGFueQogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zaG91bGRCZVBsYXlpbmcgJiYgdGhpcy5iZ20ucGF1c2VkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiQXVkaW9NYW5hZ2VyOiBVbmV4cGVjdGVkIHBhdXNlIGRldGVjdGVkLiBBdHRlbXB0aW5nIHJlc3VtZS4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYmdtLnBsYXkoKS5jYXRjaChlID0+IGNvbnNvbGUud2FybigiUmVzdW1lIGZhaWxlZDoiLCBlKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCAxMDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIDMuIFBlcmlvZGljIFdhdGNoZG9nIChUaGUgIk5ldmVyIFN0b3AiIEd1YXJhbnRlZSkKICAgICAgICAgICAgc2V0SW50ZXJ2YWwoKCkgPT4gdGhpcy5fd2F0Y2hkb2coKSwgMTAwMCk7CiAgICAgICAgfQoKICAgICAgICBfd2F0Y2hkb2coKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnNob3VsZEJlUGxheWluZyAmJiAhdGhpcy5pc011dGVkKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5iZ20ucGF1c2VkIHx8IHRoaXMuYmdtLmVuZGVkKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIkF1ZGlvTWFuYWdlcjogV2F0Y2hkb2cgZm9yY2luZyBwbGF5LiIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuYmdtLnBsYXkoKS5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNpbGVudCBjYXRjaCwgbGlrZWx5IHdhaXRpbmcgZm9yIGludGVyYWN0aW9uCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHBsYXlCR00oKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmlzTXV0ZWQpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5zaG91bGRCZVBsYXlpbmcgPSB0cnVlOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgcGxheVByb21pc2UgPSB0aGlzLmJnbS5wbGF5KCk7CiAgICAgICAgICAgIGlmIChwbGF5UHJvbWlzZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBwbGF5UHJvbWlzZS5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIkF1ZGlvTWFuYWdlcjogQXV0b3BsYXkgcHJldmVudGVkLiBFbmdhZ2luZyBpbnRlcmFjdGlvbiBsb2NrLiIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3dhaXRGb3JJbnRlcmFjdGlvbigpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIF93YWl0Rm9ySW50ZXJhY3Rpb24oKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl93YWl0aW5nRm9ySW50ZXJhY3Rpb24pIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fd2FpdGluZ0ZvckludGVyYWN0aW9uID0gdHJ1ZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IG9uSW50ZXJhY3QgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmhhc0ludGVyYWN0ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBUcnkgdG8gcGxheQogICAgICAgICAgICAgICAgaWYgKHRoaXMuc2hvdWxkQmVQbGF5aW5nICYmICF0aGlzLmlzTXV0ZWQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmJnbS5wbGF5KCkudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN1Y2Nlc3MhIERldGFjaCBsaXN0ZW5lcnMKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fd2FpdGluZ0ZvckludGVyYWN0aW9uID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZUludGVyYWN0aW9uTGlzdGVuZXJzKG9uSW50ZXJhY3QpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiQXVkaW9NYW5hZ2VyOiBBdWRpbyB1bmxvY2tlZCBzdWNjZXNzZnVsbHkuIik7CiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiQXVkaW9NYW5hZ2VyOiBJbnRlcmFjdGlvbiBwbGF5IGZhaWxlZC4gS2VlcGluZyBsaXN0ZW5lcnMgYXR0YWNoZWQuIiwgZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERvIE5PVCBkZXRhY2ggbGlzdGVuZXJzLCB3YWl0IGZvciBuZXh0IGludGVyYWN0aW9uCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIE5vdCBzdXBwb3NlZCB0byBwbGF5PyBKdXN0IGRldGFjaC4KICAgICAgICAgICAgICAgICAgICB0aGlzLl93YWl0aW5nRm9ySW50ZXJhY3Rpb24gPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZW1vdmVJbnRlcmFjdGlvbkxpc3RlbmVycyhvbkludGVyYWN0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFVzZSBjYXB0dXJlIHRvIGNhdGNoIGl0IGVhcmx5LCBidXQgZG9uJ3QgdXNlICdvbmNlOiB0cnVlJyBzbyB3ZSBjYW4gcmV0cnkgaWYgZmFpbGVkCiAgICAgICAgICAgIGNvbnN0IG9wdHMgPSB7IGNhcHR1cmU6IHRydWUsIHBhc3NpdmU6IHRydWUgfTsKICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkludGVyYWN0LCBvcHRzKTsKICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIG9uSW50ZXJhY3QsIG9wdHMpOwogICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgb25JbnRlcmFjdCwgb3B0cyk7CiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIG9uSW50ZXJhY3QsIG9wdHMpOwogICAgICAgIH0KCiAgICAgICAgX3JlbW92ZUludGVyYWN0aW9uTGlzdGVuZXJzKGhhbmRsZXIpIHsKICAgICAgICAgICAgY29uc3Qgb3B0cyA9IHsgY2FwdHVyZTogdHJ1ZSwgcGFzc2l2ZTogdHJ1ZSB9OwogICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZXIsIG9wdHMpOwogICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgaGFuZGxlciwgb3B0cyk7CiAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBoYW5kbGVyLCBvcHRzKTsKICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgaGFuZGxlciwgb3B0cyk7CiAgICAgICAgfQoKICAgICAgICBzdG9wQkdNKCkgewogICAgICAgICAgICB0aGlzLnNob3VsZEJlUGxheWluZyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmJnbS5wYXVzZSgpOwogICAgICAgICAgICB0aGlzLmJnbS5jdXJyZW50VGltZSA9IDA7CiAgICAgICAgfQoKICAgICAgICBwYXVzZUJHTSgpIHsKICAgICAgICAgICAgdGhpcy5zaG91bGRCZVBsYXlpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5iZ20ucGF1c2UoKTsKICAgICAgICB9CgogICAgICAgIHJlc3VtZUJHTSgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLmlzTXV0ZWQpIHsKICAgICAgICAgICAgICAgIHRoaXMucGxheUJHTSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBzZXRWb2x1bWUodm9sdW1lKSB7CiAgICAgICAgICAgIHRoaXMuYmdtLnZvbHVtZSA9IE1hdGgubWF4KDAsIE1hdGgubWluKDEsIHZvbHVtZSkpOwogICAgICAgIH0KCiAgICAgICAgdG9nZ2xlTXV0ZSgpIHsKICAgICAgICAgICAgdGhpcy5pc011dGVkID0gIXRoaXMuaXNNdXRlZDsKICAgICAgICAgICAgaWYgKHRoaXMuaXNNdXRlZCkgewogICAgICAgICAgICAgICAgdGhpcy5zaG91bGRCZVBsYXlpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMuYmdtLnBhdXNlKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnBsYXlCR00oKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy5pc011dGVkOwogICAgICAgIH0KICAgIH0KCiAgICB3aW5kb3cuZmx1eC5BdWRpb01hbmFnZXIgPSBBdWRpb01hbmFnZXI7Cn0pKCk7","LightShafts.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICBjbGFzcyBMaWdodFNoYWZ0cyB7CiAgICAgICAgY29uc3RydWN0b3Ioc2NlbmUpIHsKICAgICAgICAgICAgdGhpcy5zY2VuZSA9IHNjZW5lOwogICAgICAgICAgICB0aGlzLm1lc2ggPSBudWxsOwogICAgICAgICAgICB0aGlzLnVuaWZvcm1zID0gewogICAgICAgICAgICAgICAgdVRpbWU6IHsgdmFsdWU6IDAgfSwKICAgICAgICAgICAgICAgIHROb2lzZTogeyB2YWx1ZTogbnVsbCB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICB0aGlzLl9pbml0KCk7CiAgICAgICAgfQoKX2luaXQoKSB7CiAgICAgICAgICAgIC8vIEdlb21ldHJ5OiBBIGNsdXN0ZXIgb2YgY29uZXMvY3lsaW5kZXJzCiAgICAgICAgICAgIC8vIFdlIHVzZSBhIHNpbmdsZSBnZW9tZXRyeSB3aXRoIGluc3RhbmNpbmcgb3IgbWVyZ2VkIGdlb21ldHJ5IGZvciBwZXJmb3JtYW5jZSwKICAgICAgICAgICAgLy8gYnV0IGZvciBzaW1wbGljaXR5IGFuZCBhZXN0aGV0aWMgY29udHJvbCwgbGV0J3MgdXNlIGEgZmV3IGxhcmdlIHBsYW5lcyBvciBhIGN5bGluZGVyLgogICAgICAgICAgICAvLyBBIGxhcmdlIGN5bGluZGVyIHdpdGggb3BlbiBlbmRzIHdvcmtzIHdlbGwgZm9yIGEgInBvb2wiIHNoYWZ0IGVmZmVjdC4KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEluY3JlYXNlZCBsZW5ndGggdG8gOTAgdG8gYWNjb21tb2RhdGUgdGlsdCB3aXRob3V0IGNsaXBwaW5nIHRvcC9ib3R0b20KICAgICAgICAgICAgY29uc3QgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuQ3lsaW5kZXJHZW9tZXRyeSgzMCwgMjAsIDkwLCAzMiwgMSwgdHJ1ZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTaGFkZXIKICAgICAgICAgICAgY29uc3QgdmVydCA9IGAKICAgICAgICAgICAgICAgIHZhcnlpbmcgdmVjMiB2VXY7CiAgICAgICAgICAgICAgICB2YXJ5aW5nIHZlYzMgdlBvczsKICAgICAgICAgICAgICAgIHZvaWQgbWFpbigpIHsKICAgICAgICAgICAgICAgICAgICB2VXYgPSB1djsKICAgICAgICAgICAgICAgICAgICB2UG9zID0gcG9zaXRpb247CiAgICAgICAgICAgICAgICAgICAgZ2xfUG9zaXRpb24gPSBwcm9qZWN0aW9uTWF0cml4ICogbW9kZWxWaWV3TWF0cml4ICogdmVjNChwb3NpdGlvbiwgMS4wKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgYDsKCiAgICAgICAgICAgIGNvbnN0IGZyYWcgPSBgCiAgICAgICAgICAgICAgICB1bmlmb3JtIGZsb2F0IHVUaW1lOwogICAgICAgICAgICAgICAgdW5pZm9ybSBzYW1wbGVyMkQgdE5vaXNlOwogICAgICAgICAgICAgICAgdmFyeWluZyB2ZWMyIHZVdjsKICAgICAgICAgICAgICAgIHZhcnlpbmcgdmVjMyB2UG9zOwoKICAgICAgICAgICAgICAgIHZvaWQgbWFpbigpIHsKICAgICAgICAgICAgICAgICAgICAvLyBWZXJ0aWNhbCBmYWRlIChTb2Z0IHRvcCBhbmQgYm90dG9tKQogICAgICAgICAgICAgICAgICAgIGZsb2F0IGFscGhhID0gc21vb3Roc3RlcCgwLjAsIDAuMywgdlV2LnkpICogc21vb3Roc3RlcCgxLjAsIDAuNiwgdlV2LnkpOwoKICAgICAgICAgICAgICAgICAgICAvLyBTY3JvbGxpbmcgUmF5cwogICAgICAgICAgICAgICAgICAgIC8vIExheWVyIDE6IFNsb3csIGJyb2FkIHJheXMKICAgICAgICAgICAgICAgICAgICBmbG9hdCBuMSA9IHRleHR1cmUyRCh0Tm9pc2UsIHZlYzIodlV2LnggKiAyLjAgKyB1VGltZSAqIDAuMDIsIHZVdi55ICogMC41IC0gdVRpbWUgKiAwLjA1KSkucjsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBMYXllciAyOiBGYXN0LCBpbnRlcmZlcmVuY2UgcmF5cwogICAgICAgICAgICAgICAgICAgIGZsb2F0IG4yID0gdGV4dHVyZTJEKHROb2lzZSwgdmVjMih2VXYueCAqIDMuMCAtIHVUaW1lICogMC4wMywgdlV2LnkgKiAwLjUgLSB1VGltZSAqIDAuMSkpLnI7CgogICAgICAgICAgICAgICAgICAgIGZsb2F0IHJheXMgPSBuMSAqIG4yOwogICAgICAgICAgICAgICAgICAgIC8vIEJvb3N0IGludGVuc2l0eSBzaWduaWZpY2FudGx5IChSZW1vdmVkIHBvdyB0byBwcmV2ZW50IGNydXNoaW5nKQogICAgICAgICAgICAgICAgICAgIHJheXMgPSByYXlzICogMy4wOyAKCiAgICAgICAgICAgICAgICAgICAgLy8gR2xpc3RlbmluZyBTcGFya2xlcyAoSGlnaCBmcmVxdWVuY3kgbm9pc2UpCiAgICAgICAgICAgICAgICAgICAgZmxvYXQgc3BhcmtsZSA9IHRleHR1cmUyRCh0Tm9pc2UsIHZVdiAqIHZlYzIoOC4wLCAyLjApICsgdmVjMih1VGltZSAqIDAuMSwgdVRpbWUgKiAwLjMpKS5yOwogICAgICAgICAgICAgICAgICAgIHNwYXJrbGUgPSBwb3coc3BhcmtsZSwgNS4wKSAqIDEwLjA7IC8vIFNoYXJwIHBvaW50cwoKICAgICAgICAgICAgICAgICAgICAvLyBDb2xvcjogQ3lhbi9CbHVlL1doaXRlIChCcmlnaHRlciBiYXNlKQogICAgICAgICAgICAgICAgICAgIHZlYzMgY29sb3IgPSB2ZWMzKDAuNiwgMC45LCAxLjApOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIENvbWJpbmUgKEhpZ2hlciBtdWx0aXBsaWVycykKICAgICAgICAgICAgICAgICAgICBmbG9hdCBmaW5hbEFscGhhID0gKHJheXMgKiAwLjggKyBzcGFya2xlICogMC40KSAqIGFscGhhOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIERpc3RhbmNlIGZhZGUgKG9wdGlvbmFsLCBoYW5kbGVkIGJ5IGZvZyB1c3VhbGx5IGJ1dCB3ZSB3YW50IGFkZGl0aXZlKQogICAgICAgICAgICAgICAgICAgIGdsX0ZyYWdDb2xvciA9IHZlYzQoY29sb3IsIGZpbmFsQWxwaGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBgOwoKICAgICAgICAgICAgY29uc3QgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuU2hhZGVyTWF0ZXJpYWwoewogICAgICAgICAgICAgICAgdW5pZm9ybXM6IHRoaXMudW5pZm9ybXMsCiAgICAgICAgICAgICAgICB2ZXJ0ZXhTaGFkZXI6IHZlcnQsCiAgICAgICAgICAgICAgICBmcmFnbWVudFNoYWRlcjogZnJhZywKICAgICAgICAgICAgICAgIHRyYW5zcGFyZW50OiB0cnVlLAogICAgICAgICAgICAgICAgYmxlbmRpbmc6IFRIUkVFLkFkZGl0aXZlQmxlbmRpbmcsCiAgICAgICAgICAgICAgICBkZXB0aFdyaXRlOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGUKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBDb250YWluZXIgZm9yIHRoZSBhbmdsZSAoUmVhbGlzdGljIExpZ2h0IFNvdXJjZSkKICAgICAgICAgICAgdGhpcy5jb250YWluZXIgPSBuZXcgVEhSRUUuR3JvdXAoKTsKICAgICAgICAgICAgLy8gQW5nbGU6IENvbWluZyBmcm9tIHRvcC1sZWZ0IChzaW11bGF0aW5nIHN1cmZhY2Ugc3VuIHBlbmV0cmF0aW5nIGRlZXAgd2F0ZXIpCiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnJvdGF0aW9uLnogPSBNYXRoLlBJIC8gNTsgLy8gfjM2IGRlZ3JlZXMgdGlsdAogICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5yb3RhdGlvbi54ID0gTWF0aC5QSSAvIDEwOyAvLyB+MTggZGVncmVlcyBmb3J3YXJkCiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnBvc2l0aW9uLnNldCgxMiwgOCwgMCk7IC8vIE9mZnNldCBzb3VyY2UgdG8gaGl0IGFyZW5hIGNlbnRlcgogICAgICAgICAgICB0aGlzLnNjZW5lLmFkZCh0aGlzLmNvbnRhaW5lcik7CgogICAgICAgICAgICB0aGlzLm1lc2ggPSBuZXcgVEhSRUUuTWVzaChnZW9tZXRyeSwgbWF0ZXJpYWwpOwogICAgICAgICAgICB0aGlzLm1lc2gucmVuZGVyT3JkZXIgPSAxMDA7IAogICAgICAgICAgICB0aGlzLm1lc2gucG9zaXRpb24uc2V0KDAsIDAsIDApOwogICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5hZGQodGhpcy5tZXNoKTsKCiAgICAgICAgICAgIC8vIEFkZCBhIHNlY29uZCBsYXllciBmb3IgY29yZSBpbnRlbnNpdHkKICAgICAgICAgICAgY29uc3QgY29yZUdlbyA9IG5ldyBUSFJFRS5DeWxpbmRlckdlb21ldHJ5KDEyLCA4LCA5MCwgMTYsIDEsIHRydWUpOwogICAgICAgICAgICB0aGlzLmNvcmVNZXNoID0gbmV3IFRIUkVFLk1lc2goY29yZUdlbywgbWF0ZXJpYWwpOwogICAgICAgICAgICB0aGlzLmNvcmVNZXNoLnJlbmRlck9yZGVyID0gMTAwOwogICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5hZGQodGhpcy5jb3JlTWVzaCk7CiAgICAgICAgfQoKICAgICAgICB1cGRhdGUoZHQpIHsKICAgICAgICAgICAgdGhpcy51bmlmb3Jtcy51VGltZS52YWx1ZSArPSBkdDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIExhenkgbG9hZCB0ZXh0dXJlCiAgICAgICAgICAgIGlmICghdGhpcy51bmlmb3Jtcy50Tm9pc2UudmFsdWUgJiYgd2luZG93LmZsdXgubm9pc2VUZXh0dXJlKSB7CiAgICAgICAgICAgICAgICB0aGlzLnVuaWZvcm1zLnROb2lzZS52YWx1ZSA9IHdpbmRvdy5mbHV4Lm5vaXNlVGV4dHVyZTsKICAgICAgICAgICAgICAgIC8vIEVuc3VyZSB3cmFwcGluZyBpcyBjb3JyZWN0IGZvciB0aGUgY3lsaW5kZXIgVVZzCiAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5ub2lzZVRleHR1cmUud3JhcFMgPSBUSFJFRS5SZXBlYXRXcmFwcGluZzsKICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4Lm5vaXNlVGV4dHVyZS53cmFwVCA9IFRIUkVFLlJlcGVhdFdyYXBwaW5nOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBTbG93bHkgcm90YXRlIHNoYWZ0cyBmb3IgZHluYW1pYyBmZWVsCiAgICAgICAgICAgIGlmICh0aGlzLm1lc2gpIHRoaXMubWVzaC5yb3RhdGlvbi55ICs9IGR0ICogMC4wMjsKICAgICAgICAgICAgaWYgKHRoaXMuY29yZU1lc2gpIHRoaXMuY29yZU1lc2gucm90YXRpb24ueSAtPSBkdCAqIDAuMDM7CiAgICAgICAgfQogICAgfQoKICAgIHdpbmRvdy5mbHV4LkxpZ2h0U2hhZnRzID0gTGlnaHRTaGFmdHM7Cn0pKCk7","./LightShafts.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICBjbGFzcyBMaWdodFNoYWZ0cyB7CiAgICAgICAgY29uc3RydWN0b3Ioc2NlbmUpIHsKICAgICAgICAgICAgdGhpcy5zY2VuZSA9IHNjZW5lOwogICAgICAgICAgICB0aGlzLm1lc2ggPSBudWxsOwogICAgICAgICAgICB0aGlzLnVuaWZvcm1zID0gewogICAgICAgICAgICAgICAgdVRpbWU6IHsgdmFsdWU6IDAgfSwKICAgICAgICAgICAgICAgIHROb2lzZTogeyB2YWx1ZTogbnVsbCB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICB0aGlzLl9pbml0KCk7CiAgICAgICAgfQoKX2luaXQoKSB7CiAgICAgICAgICAgIC8vIEdlb21ldHJ5OiBBIGNsdXN0ZXIgb2YgY29uZXMvY3lsaW5kZXJzCiAgICAgICAgICAgIC8vIFdlIHVzZSBhIHNpbmdsZSBnZW9tZXRyeSB3aXRoIGluc3RhbmNpbmcgb3IgbWVyZ2VkIGdlb21ldHJ5IGZvciBwZXJmb3JtYW5jZSwKICAgICAgICAgICAgLy8gYnV0IGZvciBzaW1wbGljaXR5IGFuZCBhZXN0aGV0aWMgY29udHJvbCwgbGV0J3MgdXNlIGEgZmV3IGxhcmdlIHBsYW5lcyBvciBhIGN5bGluZGVyLgogICAgICAgICAgICAvLyBBIGxhcmdlIGN5bGluZGVyIHdpdGggb3BlbiBlbmRzIHdvcmtzIHdlbGwgZm9yIGEgInBvb2wiIHNoYWZ0IGVmZmVjdC4KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEluY3JlYXNlZCBsZW5ndGggdG8gOTAgdG8gYWNjb21tb2RhdGUgdGlsdCB3aXRob3V0IGNsaXBwaW5nIHRvcC9ib3R0b20KICAgICAgICAgICAgY29uc3QgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuQ3lsaW5kZXJHZW9tZXRyeSgzMCwgMjAsIDkwLCAzMiwgMSwgdHJ1ZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTaGFkZXIKICAgICAgICAgICAgY29uc3QgdmVydCA9IGAKICAgICAgICAgICAgICAgIHZhcnlpbmcgdmVjMiB2VXY7CiAgICAgICAgICAgICAgICB2YXJ5aW5nIHZlYzMgdlBvczsKICAgICAgICAgICAgICAgIHZvaWQgbWFpbigpIHsKICAgICAgICAgICAgICAgICAgICB2VXYgPSB1djsKICAgICAgICAgICAgICAgICAgICB2UG9zID0gcG9zaXRpb247CiAgICAgICAgICAgICAgICAgICAgZ2xfUG9zaXRpb24gPSBwcm9qZWN0aW9uTWF0cml4ICogbW9kZWxWaWV3TWF0cml4ICogdmVjNChwb3NpdGlvbiwgMS4wKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgYDsKCiAgICAgICAgICAgIGNvbnN0IGZyYWcgPSBgCiAgICAgICAgICAgICAgICB1bmlmb3JtIGZsb2F0IHVUaW1lOwogICAgICAgICAgICAgICAgdW5pZm9ybSBzYW1wbGVyMkQgdE5vaXNlOwogICAgICAgICAgICAgICAgdmFyeWluZyB2ZWMyIHZVdjsKICAgICAgICAgICAgICAgIHZhcnlpbmcgdmVjMyB2UG9zOwoKICAgICAgICAgICAgICAgIHZvaWQgbWFpbigpIHsKICAgICAgICAgICAgICAgICAgICAvLyBWZXJ0aWNhbCBmYWRlIChTb2Z0IHRvcCBhbmQgYm90dG9tKQogICAgICAgICAgICAgICAgICAgIGZsb2F0IGFscGhhID0gc21vb3Roc3RlcCgwLjAsIDAuMywgdlV2LnkpICogc21vb3Roc3RlcCgxLjAsIDAuNiwgdlV2LnkpOwoKICAgICAgICAgICAgICAgICAgICAvLyBTY3JvbGxpbmcgUmF5cwogICAgICAgICAgICAgICAgICAgIC8vIExheWVyIDE6IFNsb3csIGJyb2FkIHJheXMKICAgICAgICAgICAgICAgICAgICBmbG9hdCBuMSA9IHRleHR1cmUyRCh0Tm9pc2UsIHZlYzIodlV2LnggKiAyLjAgKyB1VGltZSAqIDAuMDIsIHZVdi55ICogMC41IC0gdVRpbWUgKiAwLjA1KSkucjsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBMYXllciAyOiBGYXN0LCBpbnRlcmZlcmVuY2UgcmF5cwogICAgICAgICAgICAgICAgICAgIGZsb2F0IG4yID0gdGV4dHVyZTJEKHROb2lzZSwgdmVjMih2VXYueCAqIDMuMCAtIHVUaW1lICogMC4wMywgdlV2LnkgKiAwLjUgLSB1VGltZSAqIDAuMSkpLnI7CgogICAgICAgICAgICAgICAgICAgIGZsb2F0IHJheXMgPSBuMSAqIG4yOwogICAgICAgICAgICAgICAgICAgIC8vIEJvb3N0IGludGVuc2l0eSBzaWduaWZpY2FudGx5IChSZW1vdmVkIHBvdyB0byBwcmV2ZW50IGNydXNoaW5nKQogICAgICAgICAgICAgICAgICAgIHJheXMgPSByYXlzICogMy4wOyAKCiAgICAgICAgICAgICAgICAgICAgLy8gR2xpc3RlbmluZyBTcGFya2xlcyAoSGlnaCBmcmVxdWVuY3kgbm9pc2UpCiAgICAgICAgICAgICAgICAgICAgZmxvYXQgc3BhcmtsZSA9IHRleHR1cmUyRCh0Tm9pc2UsIHZVdiAqIHZlYzIoOC4wLCAyLjApICsgdmVjMih1VGltZSAqIDAuMSwgdVRpbWUgKiAwLjMpKS5yOwogICAgICAgICAgICAgICAgICAgIHNwYXJrbGUgPSBwb3coc3BhcmtsZSwgNS4wKSAqIDEwLjA7IC8vIFNoYXJwIHBvaW50cwoKICAgICAgICAgICAgICAgICAgICAvLyBDb2xvcjogQ3lhbi9CbHVlL1doaXRlIChCcmlnaHRlciBiYXNlKQogICAgICAgICAgICAgICAgICAgIHZlYzMgY29sb3IgPSB2ZWMzKDAuNiwgMC45LCAxLjApOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIENvbWJpbmUgKEhpZ2hlciBtdWx0aXBsaWVycykKICAgICAgICAgICAgICAgICAgICBmbG9hdCBmaW5hbEFscGhhID0gKHJheXMgKiAwLjggKyBzcGFya2xlICogMC40KSAqIGFscGhhOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIERpc3RhbmNlIGZhZGUgKG9wdGlvbmFsLCBoYW5kbGVkIGJ5IGZvZyB1c3VhbGx5IGJ1dCB3ZSB3YW50IGFkZGl0aXZlKQogICAgICAgICAgICAgICAgICAgIGdsX0ZyYWdDb2xvciA9IHZlYzQoY29sb3IsIGZpbmFsQWxwaGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBgOwoKICAgICAgICAgICAgY29uc3QgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuU2hhZGVyTWF0ZXJpYWwoewogICAgICAgICAgICAgICAgdW5pZm9ybXM6IHRoaXMudW5pZm9ybXMsCiAgICAgICAgICAgICAgICB2ZXJ0ZXhTaGFkZXI6IHZlcnQsCiAgICAgICAgICAgICAgICBmcmFnbWVudFNoYWRlcjogZnJhZywKICAgICAgICAgICAgICAgIHRyYW5zcGFyZW50OiB0cnVlLAogICAgICAgICAgICAgICAgYmxlbmRpbmc6IFRIUkVFLkFkZGl0aXZlQmxlbmRpbmcsCiAgICAgICAgICAgICAgICBkZXB0aFdyaXRlOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGUKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBDb250YWluZXIgZm9yIHRoZSBhbmdsZSAoUmVhbGlzdGljIExpZ2h0IFNvdXJjZSkKICAgICAgICAgICAgdGhpcy5jb250YWluZXIgPSBuZXcgVEhSRUUuR3JvdXAoKTsKICAgICAgICAgICAgLy8gQW5nbGU6IENvbWluZyBmcm9tIHRvcC1sZWZ0IChzaW11bGF0aW5nIHN1cmZhY2Ugc3VuIHBlbmV0cmF0aW5nIGRlZXAgd2F0ZXIpCiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnJvdGF0aW9uLnogPSBNYXRoLlBJIC8gNTsgLy8gfjM2IGRlZ3JlZXMgdGlsdAogICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5yb3RhdGlvbi54ID0gTWF0aC5QSSAvIDEwOyAvLyB+MTggZGVncmVlcyBmb3J3YXJkCiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnBvc2l0aW9uLnNldCgxMiwgOCwgMCk7IC8vIE9mZnNldCBzb3VyY2UgdG8gaGl0IGFyZW5hIGNlbnRlcgogICAgICAgICAgICB0aGlzLnNjZW5lLmFkZCh0aGlzLmNvbnRhaW5lcik7CgogICAgICAgICAgICB0aGlzLm1lc2ggPSBuZXcgVEhSRUUuTWVzaChnZW9tZXRyeSwgbWF0ZXJpYWwpOwogICAgICAgICAgICB0aGlzLm1lc2gucmVuZGVyT3JkZXIgPSAxMDA7IAogICAgICAgICAgICB0aGlzLm1lc2gucG9zaXRpb24uc2V0KDAsIDAsIDApOwogICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5hZGQodGhpcy5tZXNoKTsKCiAgICAgICAgICAgIC8vIEFkZCBhIHNlY29uZCBsYXllciBmb3IgY29yZSBpbnRlbnNpdHkKICAgICAgICAgICAgY29uc3QgY29yZUdlbyA9IG5ldyBUSFJFRS5DeWxpbmRlckdlb21ldHJ5KDEyLCA4LCA5MCwgMTYsIDEsIHRydWUpOwogICAgICAgICAgICB0aGlzLmNvcmVNZXNoID0gbmV3IFRIUkVFLk1lc2goY29yZUdlbywgbWF0ZXJpYWwpOwogICAgICAgICAgICB0aGlzLmNvcmVNZXNoLnJlbmRlck9yZGVyID0gMTAwOwogICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5hZGQodGhpcy5jb3JlTWVzaCk7CiAgICAgICAgfQoKICAgICAgICB1cGRhdGUoZHQpIHsKICAgICAgICAgICAgdGhpcy51bmlmb3Jtcy51VGltZS52YWx1ZSArPSBkdDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIExhenkgbG9hZCB0ZXh0dXJlCiAgICAgICAgICAgIGlmICghdGhpcy51bmlmb3Jtcy50Tm9pc2UudmFsdWUgJiYgd2luZG93LmZsdXgubm9pc2VUZXh0dXJlKSB7CiAgICAgICAgICAgICAgICB0aGlzLnVuaWZvcm1zLnROb2lzZS52YWx1ZSA9IHdpbmRvdy5mbHV4Lm5vaXNlVGV4dHVyZTsKICAgICAgICAgICAgICAgIC8vIEVuc3VyZSB3cmFwcGluZyBpcyBjb3JyZWN0IGZvciB0aGUgY3lsaW5kZXIgVVZzCiAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5ub2lzZVRleHR1cmUud3JhcFMgPSBUSFJFRS5SZXBlYXRXcmFwcGluZzsKICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4Lm5vaXNlVGV4dHVyZS53cmFwVCA9IFRIUkVFLlJlcGVhdFdyYXBwaW5nOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBTbG93bHkgcm90YXRlIHNoYWZ0cyBmb3IgZHluYW1pYyBmZWVsCiAgICAgICAgICAgIGlmICh0aGlzLm1lc2gpIHRoaXMubWVzaC5yb3RhdGlvbi55ICs9IGR0ICogMC4wMjsKICAgICAgICAgICAgaWYgKHRoaXMuY29yZU1lc2gpIHRoaXMuY29yZU1lc2gucm90YXRpb24ueSAtPSBkdCAqIDAuMDM7CiAgICAgICAgfQogICAgfQoKICAgIHdpbmRvdy5mbHV4LkxpZ2h0U2hhZnRzID0gTGlnaHRTaGFmdHM7Cn0pKCk7","/LightShafts.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCiAgICBjbGFzcyBMaWdodFNoYWZ0cyB7CiAgICAgICAgY29uc3RydWN0b3Ioc2NlbmUpIHsKICAgICAgICAgICAgdGhpcy5zY2VuZSA9IHNjZW5lOwogICAgICAgICAgICB0aGlzLm1lc2ggPSBudWxsOwogICAgICAgICAgICB0aGlzLnVuaWZvcm1zID0gewogICAgICAgICAgICAgICAgdVRpbWU6IHsgdmFsdWU6IDAgfSwKICAgICAgICAgICAgICAgIHROb2lzZTogeyB2YWx1ZTogbnVsbCB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICB0aGlzLl9pbml0KCk7CiAgICAgICAgfQoKX2luaXQoKSB7CiAgICAgICAgICAgIC8vIEdlb21ldHJ5OiBBIGNsdXN0ZXIgb2YgY29uZXMvY3lsaW5kZXJzCiAgICAgICAgICAgIC8vIFdlIHVzZSBhIHNpbmdsZSBnZW9tZXRyeSB3aXRoIGluc3RhbmNpbmcgb3IgbWVyZ2VkIGdlb21ldHJ5IGZvciBwZXJmb3JtYW5jZSwKICAgICAgICAgICAgLy8gYnV0IGZvciBzaW1wbGljaXR5IGFuZCBhZXN0aGV0aWMgY29udHJvbCwgbGV0J3MgdXNlIGEgZmV3IGxhcmdlIHBsYW5lcyBvciBhIGN5bGluZGVyLgogICAgICAgICAgICAvLyBBIGxhcmdlIGN5bGluZGVyIHdpdGggb3BlbiBlbmRzIHdvcmtzIHdlbGwgZm9yIGEgInBvb2wiIHNoYWZ0IGVmZmVjdC4KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEluY3JlYXNlZCBsZW5ndGggdG8gOTAgdG8gYWNjb21tb2RhdGUgdGlsdCB3aXRob3V0IGNsaXBwaW5nIHRvcC9ib3R0b20KICAgICAgICAgICAgY29uc3QgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuQ3lsaW5kZXJHZW9tZXRyeSgzMCwgMjAsIDkwLCAzMiwgMSwgdHJ1ZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTaGFkZXIKICAgICAgICAgICAgY29uc3QgdmVydCA9IGAKICAgICAgICAgICAgICAgIHZhcnlpbmcgdmVjMiB2VXY7CiAgICAgICAgICAgICAgICB2YXJ5aW5nIHZlYzMgdlBvczsKICAgICAgICAgICAgICAgIHZvaWQgbWFpbigpIHsKICAgICAgICAgICAgICAgICAgICB2VXYgPSB1djsKICAgICAgICAgICAgICAgICAgICB2UG9zID0gcG9zaXRpb247CiAgICAgICAgICAgICAgICAgICAgZ2xfUG9zaXRpb24gPSBwcm9qZWN0aW9uTWF0cml4ICogbW9kZWxWaWV3TWF0cml4ICogdmVjNChwb3NpdGlvbiwgMS4wKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgYDsKCiAgICAgICAgICAgIGNvbnN0IGZyYWcgPSBgCiAgICAgICAgICAgICAgICB1bmlmb3JtIGZsb2F0IHVUaW1lOwogICAgICAgICAgICAgICAgdW5pZm9ybSBzYW1wbGVyMkQgdE5vaXNlOwogICAgICAgICAgICAgICAgdmFyeWluZyB2ZWMyIHZVdjsKICAgICAgICAgICAgICAgIHZhcnlpbmcgdmVjMyB2UG9zOwoKICAgICAgICAgICAgICAgIHZvaWQgbWFpbigpIHsKICAgICAgICAgICAgICAgICAgICAvLyBWZXJ0aWNhbCBmYWRlIChTb2Z0IHRvcCBhbmQgYm90dG9tKQogICAgICAgICAgICAgICAgICAgIGZsb2F0IGFscGhhID0gc21vb3Roc3RlcCgwLjAsIDAuMywgdlV2LnkpICogc21vb3Roc3RlcCgxLjAsIDAuNiwgdlV2LnkpOwoKICAgICAgICAgICAgICAgICAgICAvLyBTY3JvbGxpbmcgUmF5cwogICAgICAgICAgICAgICAgICAgIC8vIExheWVyIDE6IFNsb3csIGJyb2FkIHJheXMKICAgICAgICAgICAgICAgICAgICBmbG9hdCBuMSA9IHRleHR1cmUyRCh0Tm9pc2UsIHZlYzIodlV2LnggKiAyLjAgKyB1VGltZSAqIDAuMDIsIHZVdi55ICogMC41IC0gdVRpbWUgKiAwLjA1KSkucjsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBMYXllciAyOiBGYXN0LCBpbnRlcmZlcmVuY2UgcmF5cwogICAgICAgICAgICAgICAgICAgIGZsb2F0IG4yID0gdGV4dHVyZTJEKHROb2lzZSwgdmVjMih2VXYueCAqIDMuMCAtIHVUaW1lICogMC4wMywgdlV2LnkgKiAwLjUgLSB1VGltZSAqIDAuMSkpLnI7CgogICAgICAgICAgICAgICAgICAgIGZsb2F0IHJheXMgPSBuMSAqIG4yOwogICAgICAgICAgICAgICAgICAgIC8vIEJvb3N0IGludGVuc2l0eSBzaWduaWZpY2FudGx5IChSZW1vdmVkIHBvdyB0byBwcmV2ZW50IGNydXNoaW5nKQogICAgICAgICAgICAgICAgICAgIHJheXMgPSByYXlzICogMy4wOyAKCiAgICAgICAgICAgICAgICAgICAgLy8gR2xpc3RlbmluZyBTcGFya2xlcyAoSGlnaCBmcmVxdWVuY3kgbm9pc2UpCiAgICAgICAgICAgICAgICAgICAgZmxvYXQgc3BhcmtsZSA9IHRleHR1cmUyRCh0Tm9pc2UsIHZVdiAqIHZlYzIoOC4wLCAyLjApICsgdmVjMih1VGltZSAqIDAuMSwgdVRpbWUgKiAwLjMpKS5yOwogICAgICAgICAgICAgICAgICAgIHNwYXJrbGUgPSBwb3coc3BhcmtsZSwgNS4wKSAqIDEwLjA7IC8vIFNoYXJwIHBvaW50cwoKICAgICAgICAgICAgICAgICAgICAvLyBDb2xvcjogQ3lhbi9CbHVlL1doaXRlIChCcmlnaHRlciBiYXNlKQogICAgICAgICAgICAgICAgICAgIHZlYzMgY29sb3IgPSB2ZWMzKDAuNiwgMC45LCAxLjApOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIENvbWJpbmUgKEhpZ2hlciBtdWx0aXBsaWVycykKICAgICAgICAgICAgICAgICAgICBmbG9hdCBmaW5hbEFscGhhID0gKHJheXMgKiAwLjggKyBzcGFya2xlICogMC40KSAqIGFscGhhOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIERpc3RhbmNlIGZhZGUgKG9wdGlvbmFsLCBoYW5kbGVkIGJ5IGZvZyB1c3VhbGx5IGJ1dCB3ZSB3YW50IGFkZGl0aXZlKQogICAgICAgICAgICAgICAgICAgIGdsX0ZyYWdDb2xvciA9IHZlYzQoY29sb3IsIGZpbmFsQWxwaGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBgOwoKICAgICAgICAgICAgY29uc3QgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuU2hhZGVyTWF0ZXJpYWwoewogICAgICAgICAgICAgICAgdW5pZm9ybXM6IHRoaXMudW5pZm9ybXMsCiAgICAgICAgICAgICAgICB2ZXJ0ZXhTaGFkZXI6IHZlcnQsCiAgICAgICAgICAgICAgICBmcmFnbWVudFNoYWRlcjogZnJhZywKICAgICAgICAgICAgICAgIHRyYW5zcGFyZW50OiB0cnVlLAogICAgICAgICAgICAgICAgYmxlbmRpbmc6IFRIUkVFLkFkZGl0aXZlQmxlbmRpbmcsCiAgICAgICAgICAgICAgICBkZXB0aFdyaXRlOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGUKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBDb250YWluZXIgZm9yIHRoZSBhbmdsZSAoUmVhbGlzdGljIExpZ2h0IFNvdXJjZSkKICAgICAgICAgICAgdGhpcy5jb250YWluZXIgPSBuZXcgVEhSRUUuR3JvdXAoKTsKICAgICAgICAgICAgLy8gQW5nbGU6IENvbWluZyBmcm9tIHRvcC1sZWZ0IChzaW11bGF0aW5nIHN1cmZhY2Ugc3VuIHBlbmV0cmF0aW5nIGRlZXAgd2F0ZXIpCiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnJvdGF0aW9uLnogPSBNYXRoLlBJIC8gNTsgLy8gfjM2IGRlZ3JlZXMgdGlsdAogICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5yb3RhdGlvbi54ID0gTWF0aC5QSSAvIDEwOyAvLyB+MTggZGVncmVlcyBmb3J3YXJkCiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnBvc2l0aW9uLnNldCgxMiwgOCwgMCk7IC8vIE9mZnNldCBzb3VyY2UgdG8gaGl0IGFyZW5hIGNlbnRlcgogICAgICAgICAgICB0aGlzLnNjZW5lLmFkZCh0aGlzLmNvbnRhaW5lcik7CgogICAgICAgICAgICB0aGlzLm1lc2ggPSBuZXcgVEhSRUUuTWVzaChnZW9tZXRyeSwgbWF0ZXJpYWwpOwogICAgICAgICAgICB0aGlzLm1lc2gucmVuZGVyT3JkZXIgPSAxMDA7IAogICAgICAgICAgICB0aGlzLm1lc2gucG9zaXRpb24uc2V0KDAsIDAsIDApOwogICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5hZGQodGhpcy5tZXNoKTsKCiAgICAgICAgICAgIC8vIEFkZCBhIHNlY29uZCBsYXllciBmb3IgY29yZSBpbnRlbnNpdHkKICAgICAgICAgICAgY29uc3QgY29yZUdlbyA9IG5ldyBUSFJFRS5DeWxpbmRlckdlb21ldHJ5KDEyLCA4LCA5MCwgMTYsIDEsIHRydWUpOwogICAgICAgICAgICB0aGlzLmNvcmVNZXNoID0gbmV3IFRIUkVFLk1lc2goY29yZUdlbywgbWF0ZXJpYWwpOwogICAgICAgICAgICB0aGlzLmNvcmVNZXNoLnJlbmRlck9yZGVyID0gMTAwOwogICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5hZGQodGhpcy5jb3JlTWVzaCk7CiAgICAgICAgfQoKICAgICAgICB1cGRhdGUoZHQpIHsKICAgICAgICAgICAgdGhpcy51bmlmb3Jtcy51VGltZS52YWx1ZSArPSBkdDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIExhenkgbG9hZCB0ZXh0dXJlCiAgICAgICAgICAgIGlmICghdGhpcy51bmlmb3Jtcy50Tm9pc2UudmFsdWUgJiYgd2luZG93LmZsdXgubm9pc2VUZXh0dXJlKSB7CiAgICAgICAgICAgICAgICB0aGlzLnVuaWZvcm1zLnROb2lzZS52YWx1ZSA9IHdpbmRvdy5mbHV4Lm5vaXNlVGV4dHVyZTsKICAgICAgICAgICAgICAgIC8vIEVuc3VyZSB3cmFwcGluZyBpcyBjb3JyZWN0IGZvciB0aGUgY3lsaW5kZXIgVVZzCiAgICAgICAgICAgICAgICB3aW5kb3cuZmx1eC5ub2lzZVRleHR1cmUud3JhcFMgPSBUSFJFRS5SZXBlYXRXcmFwcGluZzsKICAgICAgICAgICAgICAgIHdpbmRvdy5mbHV4Lm5vaXNlVGV4dHVyZS53cmFwVCA9IFRIUkVFLlJlcGVhdFdyYXBwaW5nOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBTbG93bHkgcm90YXRlIHNoYWZ0cyBmb3IgZHluYW1pYyBmZWVsCiAgICAgICAgICAgIGlmICh0aGlzLm1lc2gpIHRoaXMubWVzaC5yb3RhdGlvbi55ICs9IGR0ICogMC4wMjsKICAgICAgICAgICAgaWYgKHRoaXMuY29yZU1lc2gpIHRoaXMuY29yZU1lc2gucm90YXRpb24ueSAtPSBkdCAqIDAuMDM7CiAgICAgICAgfQogICAgfQoKICAgIHdpbmRvdy5mbHV4LkxpZ2h0U2hhZnRzID0gTGlnaHRTaGFmdHM7Cn0pKCk7","Stadium.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCi8vIFJldXNhYmxlIEdsb3cgZm9yIExpZ2h0cwogICAgY29uc3QgX2dsb3dUZXh0dXJlID0gKCgpID0+IHsKICAgICAgICBjb25zdCBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgYy53aWR0aCA9IDY0OyBjLmhlaWdodCA9IDY0OwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjb25zdCBnID0gY3R4LmNyZWF0ZVJhZGlhbEdyYWRpZW50KDMyLCAzMiwgMCwgMzIsIDMyLCAzMik7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMCwgJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMSknKTsKICAgICAgICBnLmFkZENvbG9yU3RvcCgwLjQsICdyZ2JhKDAsIDE3MCwgMjU1LCAwLjQpJyk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMSwgJ3JnYmEoMCwgMCwgMCwgMCknKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gZzsKICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgNjQsIDY0KTsKICAgICAgICByZXR1cm4gbmV3IFRIUkVFLkNhbnZhc1RleHR1cmUoYyk7CiAgICB9KSgpOwoKICAgIGNvbnN0IF9nbG93TWF0ZXJpYWwgPSBuZXcgVEhSRUUuU3ByaXRlTWF0ZXJpYWwoeyAKICAgICAgICBtYXA6IF9nbG93VGV4dHVyZSwgCiAgICAgICAgdHJhbnNwYXJlbnQ6IHRydWUsIAogICAgICAgIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nLAogICAgICAgIGRlcHRoV3JpdGU6IGZhbHNlCiAgICB9KTsKCiAgICBjbGFzcyBTdGFkaXVtIHsKICAgICAgICBjb25zdHJ1Y3RvcihzY2VuZSkgewogICAgICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7CiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyID0gbmV3IFRIUkVFLkdyb3VwKCk7CiAgICAgICAgICAgIHRoaXMuc2NlbmUuYWRkKHRoaXMuY29udGFpbmVyKTsKCiAgICAgICAgICAgIC8vIENvbmZpZyBmb3IgIkhlcmN1bGVhbiIgc2NhbGUKICAgICAgICAgICAgdGhpcy5jb25maWcgPSB7CiAgICAgICAgICAgICAgICByYWRpdXM6IDQyLCAgICAgICAvLyBTdGFydCBvdXRzaWRlIHRoZSBhcmVuYSAoMzIgcmFkaXVzKQogICAgICAgICAgICAgICAgdGllcnM6IDYsICAgICAgICAgLy8gTnVtYmVyIG9mIHNlYXRpbmcgcmluZ3MKICAgICAgICAgICAgICAgIHRpZXJIZWlnaHQ6IDEyLAogICAgICAgICAgICAgICAgdGllckRlcHRoOiAxNSwKY3Jvd2RDb3VudDogMjUwMCwgLy8gUmVkdWNlZCBmcm9tIDgwMDAgdG8gcmVkdWNlIGNsdXR0ZXIKICAgICAgICAgICAgICAgIHN0cnVjdHVyZUNvbG9yOiAweDA4MGMxMCwgLy8gRGVlcCBkYXJrIGJsdWUvYmxhY2sKICAgICAgICAgICAgICAgIGxpZ2h0Q29sb3I6IDB4MDBhYWZmCiAgICAgICAgICAgIH07CgogICAgICAgICAgICB0aGlzLnJpbmdzID0gW107CiAgICAgICAgICAgIHRoaXMuY3Jvd2QgPSBudWxsOwoKICAgICAgICAgICAgdGhpcy5fYnVpbGRBcmNoaXRlY3R1cmUoKTsKdGhpcy5fYnVpbGRBcmNoaXRlY3R1cmUoKTsKICAgICAgICAgICAgdGhpcy5fYnVpbGRDcm93ZCgpOwogICAgICAgICAgICB0aGlzLl9idWlsZFN0YWRpdW1MaWdodHMoKTsKICAgICAgICB9CgogICAgICAgIF9idWlsZEFyY2hpdGVjdHVyZSgpIHsKICAgICAgICAgICAgLy8gMS4gVGhlIFZvaWQgQm93bCAoQmFja2dyb3VuZCBPY2NsdWRlcikKICAgICAgICAgICAgLy8gTWFzc2l2ZSBjeWxpbmRlciB0byBibG9jayB0aGUgdm9pZAogICAgICAgICAgICBjb25zdCBib3dsR2VvID0gbmV3IFRIUkVFLkN5bGluZGVyR2VvbWV0cnkoMTgwLCA1MCwgMTIwLCAzMiwgMSwgdHJ1ZSk7CiAgICAgICAgICAgIGNvbnN0IGJvd2xNYXQgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyAKICAgICAgICAgICAgICAgIGNvbG9yOiB0aGlzLmNvbmZpZy5zdHJ1Y3R1cmVDb2xvciwgCiAgICAgICAgICAgICAgICBzaWRlOiBUSFJFRS5CYWNrU2lkZSwKICAgICAgICAgICAgICAgIGZvZzogdHJ1ZSAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbnN0IGJvd2wgPSBuZXcgVEhSRUUuTWVzaChib3dsR2VvLCBib3dsTWF0KTsKICAgICAgICAgICAgYm93bC5wb3NpdGlvbi55ID0gMjA7CiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFkZChib3dsKTsKCiAgICAgICAgICAgIC8vIDIuIFNlYXRpbmcgVGllcnMgKENvbmNlbnRyaWMgUmluZ3MpCiAgICAgICAgICAgIGNvbnN0IHRpZXJNYXQgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyBjb2xvcjogMHgxMTFhMjIsIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGUgfSk7CiAgICAgICAgICAgIGNvbnN0IHJpbU1hdCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7IGNvbG9yOiAweDAwNDQ2NiB9KTsKCiAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpPHRoaXMuY29uZmlnLnRpZXJzOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IHkgPSAoaSAqIHRoaXMuY29uZmlnLnRpZXJIZWlnaHQpIC0gMzA7CiAgICAgICAgICAgICAgICBjb25zdCBySW5uZXIgPSB0aGlzLmNvbmZpZy5yYWRpdXMgKyAoaSAqICh0aGlzLmNvbmZpZy50aWVyRGVwdGggKiAwLjgpKTsKICAgICAgICAgICAgICAgIGNvbnN0IHJPdXRlciA9IHJJbm5lciArIHRoaXMuY29uZmlnLnRpZXJEZXB0aDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRmxvb3IgUmluZwogICAgICAgICAgICAgICAgY29uc3QgcmluZ0dlbyA9IG5ldyBUSFJFRS5SaW5nR2VvbWV0cnkocklubmVyLCByT3V0ZXIsIDY0KTsKICAgICAgICAgICAgICAgIHJpbmdHZW8ucm90YXRlWCgtTWF0aC5QSSAvIDIpOwogICAgICAgICAgICAgICAgY29uc3QgbWVzaCA9IG5ldyBUSFJFRS5NZXNoKHJpbmdHZW8sIHRpZXJNYXQpOwogICAgICAgICAgICAgICAgbWVzaC5wb3NpdGlvbi55ID0geTsKICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFkZChtZXNoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gR2xvd2luZyBSaW0gKFRoZSAiVGVjaCIgZmVlbCkKICAgICAgICAgICAgICAgIGNvbnN0IHJpbUdlbyA9IG5ldyBUSFJFRS5Ub3J1c0dlb21ldHJ5KHJJbm5lciwgMC44LCA0LCA2NCk7CiAgICAgICAgICAgICAgICByaW1HZW8ucm90YXRlWChNYXRoLlBJIC8gMik7CiAgICAgICAgICAgICAgICBjb25zdCByaW0gPSBuZXcgVEhSRUUuTWVzaChyaW1HZW8sIHJpbU1hdCk7CiAgICAgICAgICAgICAgICByaW0ucG9zaXRpb24ueSA9IHk7CiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5hZGQocmltKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMy4gTWFzc2l2ZSBQaWxsYXJzIChUaGUgIkhlcmN1bGVhbiIgU3VwcG9ydCkKICAgICAgICAgICAgY29uc3QgcGlsbGFyR2VvID0gbmV3IFRIUkVFLkJveEdlb21ldHJ5KDgsIDIwMCwgOCk7CiAgICAgICAgICAgIGNvbnN0IHBpbGxhck1hdCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7IGNvbG9yOiAweDA1MDUwNSB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpPDg7IGkrKykgewogICAgICAgICAgICAgICAgY29uc3QgYW5nbGUgPSAoaSAvIDgpICogTWF0aC5QSSAqIDI7CiAgICAgICAgICAgICAgICBjb25zdCByID0gMTQwOyAvLyBGYXIgb3V0CiAgICAgICAgICAgICAgICBjb25zdCBtZXNoID0gbmV3IFRIUkVFLk1lc2gocGlsbGFyR2VvLCBwaWxsYXJNYXQpOwogICAgICAgICAgICAgICAgbWVzaC5wb3NpdGlvbi5zZXQoTWF0aC5jb3MoYW5nbGUpKnIsIDAsIE1hdGguc2luKGFuZ2xlKSpyKTsKICAgICAgICAgICAgICAgIG1lc2gubG9va0F0KDAsMCwwKTsKICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFkZChtZXNoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCl9idWlsZENyb3dkKCkgewogICAgICAgICAgICAvLyBJbnN0YW5jZWQgTWVzaCBmb3IgQ3Jvd2QgKExvdyBQb2x5LCBIaWdoIENvdW50KQogICAgICAgICAgICAvLyBVc2luZyBhIHNpbXBsZSB2ZXJ0aWNhbCBwbGFuZSB0aGF0IGZhY2VzIGNlbnRlcgogICAgICAgICAgICBjb25zdCBnZW8gPSBuZXcgVEhSRUUuUGxhbmVHZW9tZXRyeSgxLjIsIDIuNSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAtLS0gQ1JPV0QgU0hBREVSIElNUExFTUVOVEFUSU9OIC0tLQogICAgICAgICAgICAvLyBBZGQgaW5zdGFuY2Utc3BlY2lmaWMgcmFuZG9tIG9mZnNldCBmb3IgYW5pbWF0aW9uIHZhcmlhdGlvbgogICAgICAgICAgICBjb25zdCBvZmZzZXRzID0gbmV3IEZsb2F0MzJBcnJheSh0aGlzLmNvbmZpZy5jcm93ZENvdW50KTsKICAgICAgICAgICAgZm9yKGxldCBpPTA7IGk8dGhpcy5jb25maWcuY3Jvd2RDb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICBvZmZzZXRzW2ldID0gTWF0aC5yYW5kb20oKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBnZW8uc2V0QXR0cmlidXRlKCdhT2Zmc2V0JywgbmV3IFRIUkVFLkluc3RhbmNlZEJ1ZmZlckF0dHJpYnV0ZShvZmZzZXRzLCAxKSk7CgogICAgICAgICAgICAvLyBDdXN0b20gU2hhZGVyIHZpYSBvbkJlZm9yZUNvbXBpbGUKICAgICAgICAgICAgY29uc3QgbWF0ID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHsgc2lkZTogVEhSRUUuRG91YmxlU2lkZSB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIG1hdC5vbkJlZm9yZUNvbXBpbGUgPSAoc2hhZGVyKSA9PiB7CiAgICAgICAgICAgICAgICBzaGFkZXIudW5pZm9ybXMudVRpbWUgPSB7IHZhbHVlOiAwIH07CiAgICAgICAgICAgICAgICB0aGlzLmNyb3dkVW5pZm9ybXMgPSBzaGFkZXIudW5pZm9ybXM7CgogICAgICAgICAgICAgICAgc2hhZGVyLnZlcnRleFNoYWRlciA9IGAKICAgICAgICAgICAgICAgICAgICB1bmlmb3JtIGZsb2F0IHVUaW1lOwogICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZSBmbG9hdCBhT2Zmc2V0OwogICAgICAgICAgICAgICAgICAgIHZhcnlpbmcgZmxvYXQgdkp1bXA7IC8vIFBhc3MgdG8gZnJhZ21lbnQgZm9yIGNvbG9yIHZhcmlhdGlvbgogICAgICAgICAgICAgICAgYCArIHNoYWRlci52ZXJ0ZXhTaGFkZXI7CgogICAgICAgICAgICAgICAgc2hhZGVyLnZlcnRleFNoYWRlciA9IHNoYWRlci52ZXJ0ZXhTaGFkZXIucmVwbGFjZSgKICAgICAgICAgICAgICAgICAgICAnI2luY2x1ZGUgPGJlZ2luX3ZlcnRleD4nLAogICAgICAgICAgICAgICAgICAgIGAKICAgICAgICAgICAgICAgICAgICAjaW5jbHVkZSA8YmVnaW5fdmVydGV4PgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEFuaW1hdGlvbiBMb2dpYwogICAgICAgICAgICAgICAgICAgIGZsb2F0IHNwZWVkID0gOC4wOwogICAgICAgICAgICAgICAgICAgIGZsb2F0IHQgPSB1VGltZSAqIHNwZWVkICsgKGFPZmZzZXQgKiAxMDAuMCk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gSnVtcCAoU2luZSB3YXZlIGNsaXBwZWQpCiAgICAgICAgICAgICAgICAgICAgZmxvYXQganVtcCA9IG1heCgwLjAsIHNpbih0KSk7CiAgICAgICAgICAgICAgICAgICAganVtcCA9IHBvdyhqdW1wLCAyLjApOyAvLyBTaGFycGVuIHRoZSBqdW1wIGN1cnZlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gUmFuZG9taXplIGp1bXAgaGVpZ2h0IHNsaWdodGx5CiAgICAgICAgICAgICAgICAgICAgZmxvYXQgaGVpZ2h0ID0gMC41ICsgMC41ICogYU9mZnNldDsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1lZC55ICs9IGp1bXAgKiBoZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gU3dheSAoU2lkZSB0byBzaWRlKQogICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybWVkLnggKz0gY29zKHQgKiAwLjUpICogMC4xOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHZKdW1wID0ganVtcDsKICAgICAgICAgICAgICAgICAgICBgCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgIHNoYWRlci5mcmFnbWVudFNoYWRlciA9IGAKICAgICAgICAgICAgICAgICAgICB2YXJ5aW5nIGZsb2F0IHZKdW1wOwogICAgICAgICAgICAgICAgYCArIHNoYWRlci5mcmFnbWVudFNoYWRlcjsKCiAgICAgICAgICAgICAgICBzaGFkZXIuZnJhZ21lbnRTaGFkZXIgPSBzaGFkZXIuZnJhZ21lbnRTaGFkZXIucmVwbGFjZSgKICAgICAgICAgICAgICAgICAgICAndmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7JywKICAgICAgICAgICAgICAgICAgICBgCiAgICAgICAgICAgICAgICAgICAgdmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gQnJpZ2h0ZW4gd2hlbiBqdW1waW5nIChDaGVlcmluZyBlZmZlY3QpCiAgICAgICAgICAgICAgICAgICAgZGlmZnVzZUNvbG9yLnJnYiArPSB2ZWMzKDAuMikgKiB2SnVtcDsKICAgICAgICAgICAgICAgICAgICBgCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5jcm93ZCA9IG5ldyBUSFJFRS5JbnN0YW5jZWRNZXNoKGdlbywgbWF0LCB0aGlzLmNvbmZpZy5jcm93ZENvdW50KTsKICAgICAgICAgICAgdGhpcy5jcm93ZC5pbnN0YW5jZU1hdHJpeC5zZXRVc2FnZShUSFJFRS5EeW5hbWljRHJhd1VzYWdlKTsKICAgICAgICAgICAgdGhpcy5jcm93ZC5mcnVzdHVtQ3VsbGVkID0gZmFsc2U7IC8vIEFsd2F5cyB2aXNpYmxlCiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBkdW1teSA9IG5ldyBUSFJFRS5PYmplY3QzRCgpOwogICAgICAgICAgICBjb25zdCBjb2xvciA9IG5ldyBUSFJFRS5Db2xvcigpOwogICAgICAgICAgICAKLy8gMS4gQ2FsY3VsYXRlIFRvdGFsIENpcmN1bWZlcmVuY2UgZm9yIGRpc3RyaWJ1dGlvbiB0byBlbnN1cmUgYWxsIHRpZXJzIGdldCBwZW9wbGUKICAgICAgICAgICAgbGV0IHRvdGFsQ2lyYyA9IDA7CiAgICAgICAgICAgIGNvbnN0IHRpZXJSYWRpaSA9IFtdOwogICAgICAgICAgICBmb3IobGV0IHQ9MDsgdDx0aGlzLmNvbmZpZy50aWVyczsgdCsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCByTWluID0gdGhpcy5jb25maWcucmFkaXVzICsgKHQgKiAodGhpcy5jb25maWcudGllckRlcHRoICogMC44KSkgKyAyOwogICAgICAgICAgICAgICAgY29uc3QgY2lyYyA9IDIgKiBNYXRoLlBJICogck1pbjsKICAgICAgICAgICAgICAgIHRvdGFsQ2lyYyArPSBjaXJjOwogICAgICAgICAgICAgICAgdGllclJhZGlpLnB1c2goeyByTWluOiByTWluLCBjaXJjOiBjaXJjIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsZXQgaWR4ID0gMDsKICAgICAgICAgICAgZm9yKGxldCB0PTA7IHQ8dGhpcy5jb25maWcudGllcnM7IHQrKykgewogICAgICAgICAgICAgICAgY29uc3QgeUJhc2UgPSAodCAqIHRoaXMuY29uZmlnLnRpZXJIZWlnaHQpIC0gMzA7CiAgICAgICAgICAgICAgICBjb25zdCB7IHJNaW4sIGNpcmMgfSA9IHRpZXJSYWRpaVt0XTsKICAgICAgICAgICAgICAgIGNvbnN0IHJNYXggPSByTWluICsgdGhpcy5jb25maWcudGllckRlcHRoIC0gMjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRGlzdHJpYnV0ZSBwcm9wb3J0aW9uYWxseSBzbyB1cHBlciByb3dzIGRvbid0IGdldCBjdXQgb2ZmCiAgICAgICAgICAgICAgICBjb25zdCBjb3VudFBlclRpZXIgPSBNYXRoLmZsb29yKHRoaXMuY29uZmlnLmNyb3dkQ291bnQgKiAoY2lyYyAvIHRvdGFsQ2lyYykpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTxjb3VudFBlclRpZXI7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGlmIChpZHggPj0gdGhpcy5jb25maWcuY3Jvd2RDb3VudCkgYnJlYWs7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGFuZ2xlID0gTWF0aC5yYW5kb20oKSAqIE1hdGguUEkgKiAyOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHIgPSByTWluICsgTWF0aC5yYW5kb20oKSAqIChyTWF4IC0gck1pbik7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgZHVtbXkucG9zaXRpb24uc2V0KAogICAgICAgICAgICAgICAgICAgICAgICBNYXRoLmNvcyhhbmdsZSkgKiByLAogICAgICAgICAgICAgICAgICAgICAgICB5QmFzZSArIDEuMjUsIC8vIENlbnRlciBvZiBxdWFkCiAgICAgICAgICAgICAgICAgICAgICAgIE1hdGguc2luKGFuZ2xlKSAqIHIKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEZhY2UgY2VudGVyCiAgICAgICAgICAgICAgICAgICAgZHVtbXkubG9va0F0KDAsIHlCYXNlLCAwKTsKICAgICAgICAgICAgICAgICAgICBkdW1teS51cGRhdGVNYXRyaXgoKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3dkLnNldE1hdHJpeEF0KGlkeCwgZHVtbXkubWF0cml4KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBSYW5kb20gVGVhbSBDb2xvcnMgKFNpbXVsYXRpbmcgZmFucykKICAgICAgICAgICAgICAgICAgICBjb25zdCByYW5kID0gTWF0aC5yYW5kb20oKTsKICAgICAgICAgICAgICAgICAgICBpZiAocmFuZCA8IDAuNDUpIGNvbG9yLnNldEhleCgweDAwODhmZik7IC8vIEhvbWUgQmx1ZQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJhbmQgPCAwLjkpIGNvbG9yLnNldEhleCgweGZmNDQ0NCk7IC8vIEF3YXkgUmVkCiAgICAgICAgICAgICAgICAgICAgZWxzZSBjb2xvci5zZXRIZXgoMHhmZmZmZmYpOyAvLyBOZXV0cmFsL0ZsYXNoCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gVmFyeSBicmlnaHRuZXNzIGZvciBkZXB0aAogICAgICAgICAgICAgICAgICAgIGNvbG9yLm11bHRpcGx5U2NhbGFyKDAuNSArIE1hdGgucmFuZG9tKCkgKiAwLjUpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHRoaXMuY3Jvd2Quc2V0Q29sb3JBdChpZHgsIGNvbG9yKTsKICAgICAgICAgICAgICAgICAgICBpZHgrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5jb250YWluZXIuYWRkKHRoaXMuY3Jvd2QpOwogICAgICAgIH0KCiAgICAgICAgX2J1aWxkSGVyY3VsZWFuUmluZ3MoKSB7CiAgICAgICAgICAgIC8vIE1hc3NpdmUgZmxvYXRpbmcgcmluZ3MgdGhhdCByb3RhdGUgc2xvd2x5CiAgICAgICAgICAgIGNvbnN0IG1hdCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7IAogICAgICAgICAgICAgICAgY29sb3I6IDB4NDQ1NTY2LCAKICAgICAgICAgICAgICAgIHRyYW5zcGFyZW50OiB0cnVlLCAKICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAuMywKICAgICAgICAgICAgICAgIHdpcmVmcmFtZTogdHJ1ZSAvLyBUZWNoL0hvbG9ncmFwaGljIGZlZWwKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyAxLiBFcXVhdG9yaWFsIFJpbmcgKE1hc3NpdmUpCiAgICAgICAgICAgIGNvbnN0IGdlbzEgPSBuZXcgVEhSRUUuVG9ydXNHZW9tZXRyeSgxMTAsIDEsIDE2LCAxMDApOwogICAgICAgICAgICBjb25zdCByaW5nMSA9IG5ldyBUSFJFRS5NZXNoKGdlbzEsIG1hdCk7CiAgICAgICAgICAgIHJpbmcxLnJvdGF0aW9uLnggPSBNYXRoLlBJIC8gMjsKICAgICAgICAgICAgdGhpcy5jb250YWluZXIuYWRkKHJpbmcxKTsKICAgICAgICAgICAgdGhpcy5yaW5ncy5wdXNoKHsgbWVzaDogcmluZzEsIGF4aXM6ICd6Jywgc3BlZWQ6IDAuMDEgfSk7CgogICAgICAgICAgICAvLyAyLiBUaWx0ZWQgUmluZwogICAgICAgICAgICBjb25zdCBnZW8yID0gbmV3IFRIUkVFLlRvcnVzR2VvbWV0cnkoMTMwLCAyLCAxNiwgMTAwKTsKICAgICAgICAgICAgY29uc3QgcmluZzIgPSBuZXcgVEhSRUUuTWVzaChnZW8yLCBtYXQpOwogICAgICAgICAgICByaW5nMi5yb3RhdGlvbi54ID0gTWF0aC5QSSAvIDM7CiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFkZChyaW5nMik7CiAgICAgICAgICAgIHRoaXMucmluZ3MucHVzaCh7IG1lc2g6IHJpbmcyLCBheGlzOiAneScsIHNwZWVkOiAtMC4wMDggfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAzLiBWZXJ0aWNhbCBSaW5nCiAgICAgICAgICAgIGNvbnN0IGdlbzMgPSBuZXcgVEhSRUUuVG9ydXNHZW9tZXRyeSgxNTAsIDMsIDE2LCAxMDApOwogICAgICAgICAgICBjb25zdCByaW5nMyA9IG5ldyBUSFJFRS5NZXNoKGdlbzMsIG1hdCk7CiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFkZChyaW5nMyk7CiAgICAgICAgICAgIHRoaXMucmluZ3MucHVzaCh7IG1lc2g6IHJpbmczLCBheGlzOiAneScsIHNwZWVkOiAwLjAwNSB9KTsKfQoKICAgICAgICBfYnVpbGRTdGFkaXVtTGlnaHRzKCkgewogICAgICAgICAgICBjb25zdCBjb3VudCA9IDE2OyAvLyBOdW1iZXIgb2YgbGlnaHRzIGFyb3VuZCB0aGUgZXF1YXRvcgogICAgICAgICAgICBjb25zdCByYWRpdXMgPSAzNjsgLy8gSnVzdCBvdXRzaWRlIHRoZSBhcmVuYSBib3VuZGFyeSAoMzIpCiAgICAgICAgICAgIGNvbnN0IHlQb3MgPSAwOyAvLyBNaWRkbGUgb2YgdGhlIHNwaGVyZQogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgbGlnaHRHZW8gPSBuZXcgVEhSRUUuU3BoZXJlR2VvbWV0cnkoMC40LCA4LCA4KTsKICAgICAgICAgICAgY29uc3QgbGlnaHRNYXQgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyBjb2xvcjogMHhmZmZmZmYgfSk7CgogICAgICAgICAgICBmb3IobGV0IGk9MDsgaTxjb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBhbmdsZSA9IChpIC8gY291bnQpICogTWF0aC5QSSAqIDI7CiAgICAgICAgICAgICAgICBjb25zdCB4ID0gTWF0aC5jb3MoYW5nbGUpICogcmFkaXVzOwogICAgICAgICAgICAgICAgY29uc3QgeiA9IE1hdGguc2luKGFuZ2xlKSAqIHJhZGl1czsKCiAgICAgICAgICAgICAgICAvLyAxLiBQaHlzaWNhbCBGaXh0dXJlIChUaGUgYnVsYikKICAgICAgICAgICAgICAgIGNvbnN0IG1lc2ggPSBuZXcgVEhSRUUuTWVzaChsaWdodEdlbywgbGlnaHRNYXQpOwogICAgICAgICAgICAgICAgbWVzaC5wb3NpdGlvbi5zZXQoeCwgeVBvcywgeik7CiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5hZGQobWVzaCk7CgogICAgICAgICAgICAgICAgLy8gMi4gVmlzdWFsIEdsb3cgKEZsYXJlKQogICAgICAgICAgICAgICAgY29uc3Qgc3ByaXRlID0gbmV3IFRIUkVFLlNwcml0ZShfZ2xvd01hdGVyaWFsKTsKICAgICAgICAgICAgICAgIHNwcml0ZS5wb3NpdGlvbi5zZXQoeCwgeVBvcywgeik7CiAgICAgICAgICAgICAgICBzcHJpdGUuc2NhbGUuc2V0KDgsIDgsIDEpOyAvLyBMYXJnZSBnbG93CiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5hZGQoc3ByaXRlKTsKCiAgICAgICAgICAgICAgICAvLyAzLiBBY3R1YWwgUG9pbnQgTGlnaHQKICAgICAgICAgICAgICAgIGNvbnN0IGxpZ2h0ID0gbmV3IFRIUkVFLlBvaW50TGlnaHQodGhpcy5jb25maWcubGlnaHRDb2xvciwgMS4wLCA1MCwgMik7CiAgICAgICAgICAgICAgICBsaWdodC5wb3NpdGlvbi5zZXQoeCwgeVBvcywgeik7CiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5hZGQobGlnaHQpOwogICAgICAgICAgICB9CiAgICAgICAgfQp1cGRhdGUoZHQpIHsKICAgICAgICAgICAgLy8gQW5pbWF0ZSBSaW5ncwogICAgICAgICAgICB0aGlzLnJpbmdzLmZvckVhY2gociA9PiB7CiAgICAgICAgICAgICAgICBpZiAoci5heGlzID09PSAneicpIHIubWVzaC5yb3RhdGlvbi56ICs9IHIuc3BlZWQgKiBkdDsKICAgICAgICAgICAgICAgIGlmIChyLmF4aXMgPT09ICd5Jykgci5tZXNoLnJvdGF0aW9uLnkgKz0gci5zcGVlZCAqIGR0OwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIFVwZGF0ZSBDcm93ZCBTaGFkZXIKICAgICAgICAgICAgaWYgKHRoaXMuY3Jvd2RVbmlmb3JtcykgewogICAgICAgICAgICAgICAgdGhpcy5jcm93ZFVuaWZvcm1zLnVUaW1lLnZhbHVlICs9IGR0OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHdpbmRvdy5mbHV4LlN0YWRpdW0gPSBTdGFkaXVtOwp9KSgpOw==","./Stadium.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCi8vIFJldXNhYmxlIEdsb3cgZm9yIExpZ2h0cwogICAgY29uc3QgX2dsb3dUZXh0dXJlID0gKCgpID0+IHsKICAgICAgICBjb25zdCBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgYy53aWR0aCA9IDY0OyBjLmhlaWdodCA9IDY0OwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjb25zdCBnID0gY3R4LmNyZWF0ZVJhZGlhbEdyYWRpZW50KDMyLCAzMiwgMCwgMzIsIDMyLCAzMik7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMCwgJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMSknKTsKICAgICAgICBnLmFkZENvbG9yU3RvcCgwLjQsICdyZ2JhKDAsIDE3MCwgMjU1LCAwLjQpJyk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMSwgJ3JnYmEoMCwgMCwgMCwgMCknKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gZzsKICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgNjQsIDY0KTsKICAgICAgICByZXR1cm4gbmV3IFRIUkVFLkNhbnZhc1RleHR1cmUoYyk7CiAgICB9KSgpOwoKICAgIGNvbnN0IF9nbG93TWF0ZXJpYWwgPSBuZXcgVEhSRUUuU3ByaXRlTWF0ZXJpYWwoeyAKICAgICAgICBtYXA6IF9nbG93VGV4dHVyZSwgCiAgICAgICAgdHJhbnNwYXJlbnQ6IHRydWUsIAogICAgICAgIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nLAogICAgICAgIGRlcHRoV3JpdGU6IGZhbHNlCiAgICB9KTsKCiAgICBjbGFzcyBTdGFkaXVtIHsKICAgICAgICBjb25zdHJ1Y3RvcihzY2VuZSkgewogICAgICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7CiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyID0gbmV3IFRIUkVFLkdyb3VwKCk7CiAgICAgICAgICAgIHRoaXMuc2NlbmUuYWRkKHRoaXMuY29udGFpbmVyKTsKCiAgICAgICAgICAgIC8vIENvbmZpZyBmb3IgIkhlcmN1bGVhbiIgc2NhbGUKICAgICAgICAgICAgdGhpcy5jb25maWcgPSB7CiAgICAgICAgICAgICAgICByYWRpdXM6IDQyLCAgICAgICAvLyBTdGFydCBvdXRzaWRlIHRoZSBhcmVuYSAoMzIgcmFkaXVzKQogICAgICAgICAgICAgICAgdGllcnM6IDYsICAgICAgICAgLy8gTnVtYmVyIG9mIHNlYXRpbmcgcmluZ3MKICAgICAgICAgICAgICAgIHRpZXJIZWlnaHQ6IDEyLAogICAgICAgICAgICAgICAgdGllckRlcHRoOiAxNSwKY3Jvd2RDb3VudDogMjUwMCwgLy8gUmVkdWNlZCBmcm9tIDgwMDAgdG8gcmVkdWNlIGNsdXR0ZXIKICAgICAgICAgICAgICAgIHN0cnVjdHVyZUNvbG9yOiAweDA4MGMxMCwgLy8gRGVlcCBkYXJrIGJsdWUvYmxhY2sKICAgICAgICAgICAgICAgIGxpZ2h0Q29sb3I6IDB4MDBhYWZmCiAgICAgICAgICAgIH07CgogICAgICAgICAgICB0aGlzLnJpbmdzID0gW107CiAgICAgICAgICAgIHRoaXMuY3Jvd2QgPSBudWxsOwoKICAgICAgICAgICAgdGhpcy5fYnVpbGRBcmNoaXRlY3R1cmUoKTsKdGhpcy5fYnVpbGRBcmNoaXRlY3R1cmUoKTsKICAgICAgICAgICAgdGhpcy5fYnVpbGRDcm93ZCgpOwogICAgICAgICAgICB0aGlzLl9idWlsZFN0YWRpdW1MaWdodHMoKTsKICAgICAgICB9CgogICAgICAgIF9idWlsZEFyY2hpdGVjdHVyZSgpIHsKICAgICAgICAgICAgLy8gMS4gVGhlIFZvaWQgQm93bCAoQmFja2dyb3VuZCBPY2NsdWRlcikKICAgICAgICAgICAgLy8gTWFzc2l2ZSBjeWxpbmRlciB0byBibG9jayB0aGUgdm9pZAogICAgICAgICAgICBjb25zdCBib3dsR2VvID0gbmV3IFRIUkVFLkN5bGluZGVyR2VvbWV0cnkoMTgwLCA1MCwgMTIwLCAzMiwgMSwgdHJ1ZSk7CiAgICAgICAgICAgIGNvbnN0IGJvd2xNYXQgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyAKICAgICAgICAgICAgICAgIGNvbG9yOiB0aGlzLmNvbmZpZy5zdHJ1Y3R1cmVDb2xvciwgCiAgICAgICAgICAgICAgICBzaWRlOiBUSFJFRS5CYWNrU2lkZSwKICAgICAgICAgICAgICAgIGZvZzogdHJ1ZSAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbnN0IGJvd2wgPSBuZXcgVEhSRUUuTWVzaChib3dsR2VvLCBib3dsTWF0KTsKICAgICAgICAgICAgYm93bC5wb3NpdGlvbi55ID0gMjA7CiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFkZChib3dsKTsKCiAgICAgICAgICAgIC8vIDIuIFNlYXRpbmcgVGllcnMgKENvbmNlbnRyaWMgUmluZ3MpCiAgICAgICAgICAgIGNvbnN0IHRpZXJNYXQgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyBjb2xvcjogMHgxMTFhMjIsIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGUgfSk7CiAgICAgICAgICAgIGNvbnN0IHJpbU1hdCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7IGNvbG9yOiAweDAwNDQ2NiB9KTsKCiAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpPHRoaXMuY29uZmlnLnRpZXJzOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IHkgPSAoaSAqIHRoaXMuY29uZmlnLnRpZXJIZWlnaHQpIC0gMzA7CiAgICAgICAgICAgICAgICBjb25zdCBySW5uZXIgPSB0aGlzLmNvbmZpZy5yYWRpdXMgKyAoaSAqICh0aGlzLmNvbmZpZy50aWVyRGVwdGggKiAwLjgpKTsKICAgICAgICAgICAgICAgIGNvbnN0IHJPdXRlciA9IHJJbm5lciArIHRoaXMuY29uZmlnLnRpZXJEZXB0aDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRmxvb3IgUmluZwogICAgICAgICAgICAgICAgY29uc3QgcmluZ0dlbyA9IG5ldyBUSFJFRS5SaW5nR2VvbWV0cnkocklubmVyLCByT3V0ZXIsIDY0KTsKICAgICAgICAgICAgICAgIHJpbmdHZW8ucm90YXRlWCgtTWF0aC5QSSAvIDIpOwogICAgICAgICAgICAgICAgY29uc3QgbWVzaCA9IG5ldyBUSFJFRS5NZXNoKHJpbmdHZW8sIHRpZXJNYXQpOwogICAgICAgICAgICAgICAgbWVzaC5wb3NpdGlvbi55ID0geTsKICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFkZChtZXNoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gR2xvd2luZyBSaW0gKFRoZSAiVGVjaCIgZmVlbCkKICAgICAgICAgICAgICAgIGNvbnN0IHJpbUdlbyA9IG5ldyBUSFJFRS5Ub3J1c0dlb21ldHJ5KHJJbm5lciwgMC44LCA0LCA2NCk7CiAgICAgICAgICAgICAgICByaW1HZW8ucm90YXRlWChNYXRoLlBJIC8gMik7CiAgICAgICAgICAgICAgICBjb25zdCByaW0gPSBuZXcgVEhSRUUuTWVzaChyaW1HZW8sIHJpbU1hdCk7CiAgICAgICAgICAgICAgICByaW0ucG9zaXRpb24ueSA9IHk7CiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5hZGQocmltKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMy4gTWFzc2l2ZSBQaWxsYXJzIChUaGUgIkhlcmN1bGVhbiIgU3VwcG9ydCkKICAgICAgICAgICAgY29uc3QgcGlsbGFyR2VvID0gbmV3IFRIUkVFLkJveEdlb21ldHJ5KDgsIDIwMCwgOCk7CiAgICAgICAgICAgIGNvbnN0IHBpbGxhck1hdCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7IGNvbG9yOiAweDA1MDUwNSB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpPDg7IGkrKykgewogICAgICAgICAgICAgICAgY29uc3QgYW5nbGUgPSAoaSAvIDgpICogTWF0aC5QSSAqIDI7CiAgICAgICAgICAgICAgICBjb25zdCByID0gMTQwOyAvLyBGYXIgb3V0CiAgICAgICAgICAgICAgICBjb25zdCBtZXNoID0gbmV3IFRIUkVFLk1lc2gocGlsbGFyR2VvLCBwaWxsYXJNYXQpOwogICAgICAgICAgICAgICAgbWVzaC5wb3NpdGlvbi5zZXQoTWF0aC5jb3MoYW5nbGUpKnIsIDAsIE1hdGguc2luKGFuZ2xlKSpyKTsKICAgICAgICAgICAgICAgIG1lc2gubG9va0F0KDAsMCwwKTsKICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFkZChtZXNoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCl9idWlsZENyb3dkKCkgewogICAgICAgICAgICAvLyBJbnN0YW5jZWQgTWVzaCBmb3IgQ3Jvd2QgKExvdyBQb2x5LCBIaWdoIENvdW50KQogICAgICAgICAgICAvLyBVc2luZyBhIHNpbXBsZSB2ZXJ0aWNhbCBwbGFuZSB0aGF0IGZhY2VzIGNlbnRlcgogICAgICAgICAgICBjb25zdCBnZW8gPSBuZXcgVEhSRUUuUGxhbmVHZW9tZXRyeSgxLjIsIDIuNSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAtLS0gQ1JPV0QgU0hBREVSIElNUExFTUVOVEFUSU9OIC0tLQogICAgICAgICAgICAvLyBBZGQgaW5zdGFuY2Utc3BlY2lmaWMgcmFuZG9tIG9mZnNldCBmb3IgYW5pbWF0aW9uIHZhcmlhdGlvbgogICAgICAgICAgICBjb25zdCBvZmZzZXRzID0gbmV3IEZsb2F0MzJBcnJheSh0aGlzLmNvbmZpZy5jcm93ZENvdW50KTsKICAgICAgICAgICAgZm9yKGxldCBpPTA7IGk8dGhpcy5jb25maWcuY3Jvd2RDb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICBvZmZzZXRzW2ldID0gTWF0aC5yYW5kb20oKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBnZW8uc2V0QXR0cmlidXRlKCdhT2Zmc2V0JywgbmV3IFRIUkVFLkluc3RhbmNlZEJ1ZmZlckF0dHJpYnV0ZShvZmZzZXRzLCAxKSk7CgogICAgICAgICAgICAvLyBDdXN0b20gU2hhZGVyIHZpYSBvbkJlZm9yZUNvbXBpbGUKICAgICAgICAgICAgY29uc3QgbWF0ID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHsgc2lkZTogVEhSRUUuRG91YmxlU2lkZSB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIG1hdC5vbkJlZm9yZUNvbXBpbGUgPSAoc2hhZGVyKSA9PiB7CiAgICAgICAgICAgICAgICBzaGFkZXIudW5pZm9ybXMudVRpbWUgPSB7IHZhbHVlOiAwIH07CiAgICAgICAgICAgICAgICB0aGlzLmNyb3dkVW5pZm9ybXMgPSBzaGFkZXIudW5pZm9ybXM7CgogICAgICAgICAgICAgICAgc2hhZGVyLnZlcnRleFNoYWRlciA9IGAKICAgICAgICAgICAgICAgICAgICB1bmlmb3JtIGZsb2F0IHVUaW1lOwogICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZSBmbG9hdCBhT2Zmc2V0OwogICAgICAgICAgICAgICAgICAgIHZhcnlpbmcgZmxvYXQgdkp1bXA7IC8vIFBhc3MgdG8gZnJhZ21lbnQgZm9yIGNvbG9yIHZhcmlhdGlvbgogICAgICAgICAgICAgICAgYCArIHNoYWRlci52ZXJ0ZXhTaGFkZXI7CgogICAgICAgICAgICAgICAgc2hhZGVyLnZlcnRleFNoYWRlciA9IHNoYWRlci52ZXJ0ZXhTaGFkZXIucmVwbGFjZSgKICAgICAgICAgICAgICAgICAgICAnI2luY2x1ZGUgPGJlZ2luX3ZlcnRleD4nLAogICAgICAgICAgICAgICAgICAgIGAKICAgICAgICAgICAgICAgICAgICAjaW5jbHVkZSA8YmVnaW5fdmVydGV4PgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEFuaW1hdGlvbiBMb2dpYwogICAgICAgICAgICAgICAgICAgIGZsb2F0IHNwZWVkID0gOC4wOwogICAgICAgICAgICAgICAgICAgIGZsb2F0IHQgPSB1VGltZSAqIHNwZWVkICsgKGFPZmZzZXQgKiAxMDAuMCk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gSnVtcCAoU2luZSB3YXZlIGNsaXBwZWQpCiAgICAgICAgICAgICAgICAgICAgZmxvYXQganVtcCA9IG1heCgwLjAsIHNpbih0KSk7CiAgICAgICAgICAgICAgICAgICAganVtcCA9IHBvdyhqdW1wLCAyLjApOyAvLyBTaGFycGVuIHRoZSBqdW1wIGN1cnZlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gUmFuZG9taXplIGp1bXAgaGVpZ2h0IHNsaWdodGx5CiAgICAgICAgICAgICAgICAgICAgZmxvYXQgaGVpZ2h0ID0gMC41ICsgMC41ICogYU9mZnNldDsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1lZC55ICs9IGp1bXAgKiBoZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gU3dheSAoU2lkZSB0byBzaWRlKQogICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybWVkLnggKz0gY29zKHQgKiAwLjUpICogMC4xOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHZKdW1wID0ganVtcDsKICAgICAgICAgICAgICAgICAgICBgCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgIHNoYWRlci5mcmFnbWVudFNoYWRlciA9IGAKICAgICAgICAgICAgICAgICAgICB2YXJ5aW5nIGZsb2F0IHZKdW1wOwogICAgICAgICAgICAgICAgYCArIHNoYWRlci5mcmFnbWVudFNoYWRlcjsKCiAgICAgICAgICAgICAgICBzaGFkZXIuZnJhZ21lbnRTaGFkZXIgPSBzaGFkZXIuZnJhZ21lbnRTaGFkZXIucmVwbGFjZSgKICAgICAgICAgICAgICAgICAgICAndmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7JywKICAgICAgICAgICAgICAgICAgICBgCiAgICAgICAgICAgICAgICAgICAgdmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gQnJpZ2h0ZW4gd2hlbiBqdW1waW5nIChDaGVlcmluZyBlZmZlY3QpCiAgICAgICAgICAgICAgICAgICAgZGlmZnVzZUNvbG9yLnJnYiArPSB2ZWMzKDAuMikgKiB2SnVtcDsKICAgICAgICAgICAgICAgICAgICBgCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5jcm93ZCA9IG5ldyBUSFJFRS5JbnN0YW5jZWRNZXNoKGdlbywgbWF0LCB0aGlzLmNvbmZpZy5jcm93ZENvdW50KTsKICAgICAgICAgICAgdGhpcy5jcm93ZC5pbnN0YW5jZU1hdHJpeC5zZXRVc2FnZShUSFJFRS5EeW5hbWljRHJhd1VzYWdlKTsKICAgICAgICAgICAgdGhpcy5jcm93ZC5mcnVzdHVtQ3VsbGVkID0gZmFsc2U7IC8vIEFsd2F5cyB2aXNpYmxlCiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBkdW1teSA9IG5ldyBUSFJFRS5PYmplY3QzRCgpOwogICAgICAgICAgICBjb25zdCBjb2xvciA9IG5ldyBUSFJFRS5Db2xvcigpOwogICAgICAgICAgICAKLy8gMS4gQ2FsY3VsYXRlIFRvdGFsIENpcmN1bWZlcmVuY2UgZm9yIGRpc3RyaWJ1dGlvbiB0byBlbnN1cmUgYWxsIHRpZXJzIGdldCBwZW9wbGUKICAgICAgICAgICAgbGV0IHRvdGFsQ2lyYyA9IDA7CiAgICAgICAgICAgIGNvbnN0IHRpZXJSYWRpaSA9IFtdOwogICAgICAgICAgICBmb3IobGV0IHQ9MDsgdDx0aGlzLmNvbmZpZy50aWVyczsgdCsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCByTWluID0gdGhpcy5jb25maWcucmFkaXVzICsgKHQgKiAodGhpcy5jb25maWcudGllckRlcHRoICogMC44KSkgKyAyOwogICAgICAgICAgICAgICAgY29uc3QgY2lyYyA9IDIgKiBNYXRoLlBJICogck1pbjsKICAgICAgICAgICAgICAgIHRvdGFsQ2lyYyArPSBjaXJjOwogICAgICAgICAgICAgICAgdGllclJhZGlpLnB1c2goeyByTWluOiByTWluLCBjaXJjOiBjaXJjIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsZXQgaWR4ID0gMDsKICAgICAgICAgICAgZm9yKGxldCB0PTA7IHQ8dGhpcy5jb25maWcudGllcnM7IHQrKykgewogICAgICAgICAgICAgICAgY29uc3QgeUJhc2UgPSAodCAqIHRoaXMuY29uZmlnLnRpZXJIZWlnaHQpIC0gMzA7CiAgICAgICAgICAgICAgICBjb25zdCB7IHJNaW4sIGNpcmMgfSA9IHRpZXJSYWRpaVt0XTsKICAgICAgICAgICAgICAgIGNvbnN0IHJNYXggPSByTWluICsgdGhpcy5jb25maWcudGllckRlcHRoIC0gMjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRGlzdHJpYnV0ZSBwcm9wb3J0aW9uYWxseSBzbyB1cHBlciByb3dzIGRvbid0IGdldCBjdXQgb2ZmCiAgICAgICAgICAgICAgICBjb25zdCBjb3VudFBlclRpZXIgPSBNYXRoLmZsb29yKHRoaXMuY29uZmlnLmNyb3dkQ291bnQgKiAoY2lyYyAvIHRvdGFsQ2lyYykpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTxjb3VudFBlclRpZXI7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGlmIChpZHggPj0gdGhpcy5jb25maWcuY3Jvd2RDb3VudCkgYnJlYWs7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGFuZ2xlID0gTWF0aC5yYW5kb20oKSAqIE1hdGguUEkgKiAyOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHIgPSByTWluICsgTWF0aC5yYW5kb20oKSAqIChyTWF4IC0gck1pbik7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgZHVtbXkucG9zaXRpb24uc2V0KAogICAgICAgICAgICAgICAgICAgICAgICBNYXRoLmNvcyhhbmdsZSkgKiByLAogICAgICAgICAgICAgICAgICAgICAgICB5QmFzZSArIDEuMjUsIC8vIENlbnRlciBvZiBxdWFkCiAgICAgICAgICAgICAgICAgICAgICAgIE1hdGguc2luKGFuZ2xlKSAqIHIKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEZhY2UgY2VudGVyCiAgICAgICAgICAgICAgICAgICAgZHVtbXkubG9va0F0KDAsIHlCYXNlLCAwKTsKICAgICAgICAgICAgICAgICAgICBkdW1teS51cGRhdGVNYXRyaXgoKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3dkLnNldE1hdHJpeEF0KGlkeCwgZHVtbXkubWF0cml4KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBSYW5kb20gVGVhbSBDb2xvcnMgKFNpbXVsYXRpbmcgZmFucykKICAgICAgICAgICAgICAgICAgICBjb25zdCByYW5kID0gTWF0aC5yYW5kb20oKTsKICAgICAgICAgICAgICAgICAgICBpZiAocmFuZCA8IDAuNDUpIGNvbG9yLnNldEhleCgweDAwODhmZik7IC8vIEhvbWUgQmx1ZQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJhbmQgPCAwLjkpIGNvbG9yLnNldEhleCgweGZmNDQ0NCk7IC8vIEF3YXkgUmVkCiAgICAgICAgICAgICAgICAgICAgZWxzZSBjb2xvci5zZXRIZXgoMHhmZmZmZmYpOyAvLyBOZXV0cmFsL0ZsYXNoCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gVmFyeSBicmlnaHRuZXNzIGZvciBkZXB0aAogICAgICAgICAgICAgICAgICAgIGNvbG9yLm11bHRpcGx5U2NhbGFyKDAuNSArIE1hdGgucmFuZG9tKCkgKiAwLjUpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHRoaXMuY3Jvd2Quc2V0Q29sb3JBdChpZHgsIGNvbG9yKTsKICAgICAgICAgICAgICAgICAgICBpZHgrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5jb250YWluZXIuYWRkKHRoaXMuY3Jvd2QpOwogICAgICAgIH0KCiAgICAgICAgX2J1aWxkSGVyY3VsZWFuUmluZ3MoKSB7CiAgICAgICAgICAgIC8vIE1hc3NpdmUgZmxvYXRpbmcgcmluZ3MgdGhhdCByb3RhdGUgc2xvd2x5CiAgICAgICAgICAgIGNvbnN0IG1hdCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7IAogICAgICAgICAgICAgICAgY29sb3I6IDB4NDQ1NTY2LCAKICAgICAgICAgICAgICAgIHRyYW5zcGFyZW50OiB0cnVlLCAKICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAuMywKICAgICAgICAgICAgICAgIHdpcmVmcmFtZTogdHJ1ZSAvLyBUZWNoL0hvbG9ncmFwaGljIGZlZWwKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyAxLiBFcXVhdG9yaWFsIFJpbmcgKE1hc3NpdmUpCiAgICAgICAgICAgIGNvbnN0IGdlbzEgPSBuZXcgVEhSRUUuVG9ydXNHZW9tZXRyeSgxMTAsIDEsIDE2LCAxMDApOwogICAgICAgICAgICBjb25zdCByaW5nMSA9IG5ldyBUSFJFRS5NZXNoKGdlbzEsIG1hdCk7CiAgICAgICAgICAgIHJpbmcxLnJvdGF0aW9uLnggPSBNYXRoLlBJIC8gMjsKICAgICAgICAgICAgdGhpcy5jb250YWluZXIuYWRkKHJpbmcxKTsKICAgICAgICAgICAgdGhpcy5yaW5ncy5wdXNoKHsgbWVzaDogcmluZzEsIGF4aXM6ICd6Jywgc3BlZWQ6IDAuMDEgfSk7CgogICAgICAgICAgICAvLyAyLiBUaWx0ZWQgUmluZwogICAgICAgICAgICBjb25zdCBnZW8yID0gbmV3IFRIUkVFLlRvcnVzR2VvbWV0cnkoMTMwLCAyLCAxNiwgMTAwKTsKICAgICAgICAgICAgY29uc3QgcmluZzIgPSBuZXcgVEhSRUUuTWVzaChnZW8yLCBtYXQpOwogICAgICAgICAgICByaW5nMi5yb3RhdGlvbi54ID0gTWF0aC5QSSAvIDM7CiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFkZChyaW5nMik7CiAgICAgICAgICAgIHRoaXMucmluZ3MucHVzaCh7IG1lc2g6IHJpbmcyLCBheGlzOiAneScsIHNwZWVkOiAtMC4wMDggfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAzLiBWZXJ0aWNhbCBSaW5nCiAgICAgICAgICAgIGNvbnN0IGdlbzMgPSBuZXcgVEhSRUUuVG9ydXNHZW9tZXRyeSgxNTAsIDMsIDE2LCAxMDApOwogICAgICAgICAgICBjb25zdCByaW5nMyA9IG5ldyBUSFJFRS5NZXNoKGdlbzMsIG1hdCk7CiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFkZChyaW5nMyk7CiAgICAgICAgICAgIHRoaXMucmluZ3MucHVzaCh7IG1lc2g6IHJpbmczLCBheGlzOiAneScsIHNwZWVkOiAwLjAwNSB9KTsKfQoKICAgICAgICBfYnVpbGRTdGFkaXVtTGlnaHRzKCkgewogICAgICAgICAgICBjb25zdCBjb3VudCA9IDE2OyAvLyBOdW1iZXIgb2YgbGlnaHRzIGFyb3VuZCB0aGUgZXF1YXRvcgogICAgICAgICAgICBjb25zdCByYWRpdXMgPSAzNjsgLy8gSnVzdCBvdXRzaWRlIHRoZSBhcmVuYSBib3VuZGFyeSAoMzIpCiAgICAgICAgICAgIGNvbnN0IHlQb3MgPSAwOyAvLyBNaWRkbGUgb2YgdGhlIHNwaGVyZQogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgbGlnaHRHZW8gPSBuZXcgVEhSRUUuU3BoZXJlR2VvbWV0cnkoMC40LCA4LCA4KTsKICAgICAgICAgICAgY29uc3QgbGlnaHRNYXQgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyBjb2xvcjogMHhmZmZmZmYgfSk7CgogICAgICAgICAgICBmb3IobGV0IGk9MDsgaTxjb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBhbmdsZSA9IChpIC8gY291bnQpICogTWF0aC5QSSAqIDI7CiAgICAgICAgICAgICAgICBjb25zdCB4ID0gTWF0aC5jb3MoYW5nbGUpICogcmFkaXVzOwogICAgICAgICAgICAgICAgY29uc3QgeiA9IE1hdGguc2luKGFuZ2xlKSAqIHJhZGl1czsKCiAgICAgICAgICAgICAgICAvLyAxLiBQaHlzaWNhbCBGaXh0dXJlIChUaGUgYnVsYikKICAgICAgICAgICAgICAgIGNvbnN0IG1lc2ggPSBuZXcgVEhSRUUuTWVzaChsaWdodEdlbywgbGlnaHRNYXQpOwogICAgICAgICAgICAgICAgbWVzaC5wb3NpdGlvbi5zZXQoeCwgeVBvcywgeik7CiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5hZGQobWVzaCk7CgogICAgICAgICAgICAgICAgLy8gMi4gVmlzdWFsIEdsb3cgKEZsYXJlKQogICAgICAgICAgICAgICAgY29uc3Qgc3ByaXRlID0gbmV3IFRIUkVFLlNwcml0ZShfZ2xvd01hdGVyaWFsKTsKICAgICAgICAgICAgICAgIHNwcml0ZS5wb3NpdGlvbi5zZXQoeCwgeVBvcywgeik7CiAgICAgICAgICAgICAgICBzcHJpdGUuc2NhbGUuc2V0KDgsIDgsIDEpOyAvLyBMYXJnZSBnbG93CiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5hZGQoc3ByaXRlKTsKCiAgICAgICAgICAgICAgICAvLyAzLiBBY3R1YWwgUG9pbnQgTGlnaHQKICAgICAgICAgICAgICAgIGNvbnN0IGxpZ2h0ID0gbmV3IFRIUkVFLlBvaW50TGlnaHQodGhpcy5jb25maWcubGlnaHRDb2xvciwgMS4wLCA1MCwgMik7CiAgICAgICAgICAgICAgICBsaWdodC5wb3NpdGlvbi5zZXQoeCwgeVBvcywgeik7CiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5hZGQobGlnaHQpOwogICAgICAgICAgICB9CiAgICAgICAgfQp1cGRhdGUoZHQpIHsKICAgICAgICAgICAgLy8gQW5pbWF0ZSBSaW5ncwogICAgICAgICAgICB0aGlzLnJpbmdzLmZvckVhY2gociA9PiB7CiAgICAgICAgICAgICAgICBpZiAoci5heGlzID09PSAneicpIHIubWVzaC5yb3RhdGlvbi56ICs9IHIuc3BlZWQgKiBkdDsKICAgICAgICAgICAgICAgIGlmIChyLmF4aXMgPT09ICd5Jykgci5tZXNoLnJvdGF0aW9uLnkgKz0gci5zcGVlZCAqIGR0OwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIFVwZGF0ZSBDcm93ZCBTaGFkZXIKICAgICAgICAgICAgaWYgKHRoaXMuY3Jvd2RVbmlmb3JtcykgewogICAgICAgICAgICAgICAgdGhpcy5jcm93ZFVuaWZvcm1zLnVUaW1lLnZhbHVlICs9IGR0OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHdpbmRvdy5mbHV4LlN0YWRpdW0gPSBTdGFkaXVtOwp9KSgpOw==","/Stadium.js":"data:text/javascript;base64,KGZ1bmN0aW9uKCkgewogICAgd2luZG93LmZsdXggPSB3aW5kb3cuZmx1eCB8fCB7fTsKCi8vIFJldXNhYmxlIEdsb3cgZm9yIExpZ2h0cwogICAgY29uc3QgX2dsb3dUZXh0dXJlID0gKCgpID0+IHsKICAgICAgICBjb25zdCBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgYy53aWR0aCA9IDY0OyBjLmhlaWdodCA9IDY0OwogICAgICAgIGNvbnN0IGN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjb25zdCBnID0gY3R4LmNyZWF0ZVJhZGlhbEdyYWRpZW50KDMyLCAzMiwgMCwgMzIsIDMyLCAzMik7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMCwgJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMSknKTsKICAgICAgICBnLmFkZENvbG9yU3RvcCgwLjQsICdyZ2JhKDAsIDE3MCwgMjU1LCAwLjQpJyk7CiAgICAgICAgZy5hZGRDb2xvclN0b3AoMSwgJ3JnYmEoMCwgMCwgMCwgMCknKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gZzsKICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgNjQsIDY0KTsKICAgICAgICByZXR1cm4gbmV3IFRIUkVFLkNhbnZhc1RleHR1cmUoYyk7CiAgICB9KSgpOwoKICAgIGNvbnN0IF9nbG93TWF0ZXJpYWwgPSBuZXcgVEhSRUUuU3ByaXRlTWF0ZXJpYWwoeyAKICAgICAgICBtYXA6IF9nbG93VGV4dHVyZSwgCiAgICAgICAgdHJhbnNwYXJlbnQ6IHRydWUsIAogICAgICAgIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nLAogICAgICAgIGRlcHRoV3JpdGU6IGZhbHNlCiAgICB9KTsKCiAgICBjbGFzcyBTdGFkaXVtIHsKICAgICAgICBjb25zdHJ1Y3RvcihzY2VuZSkgewogICAgICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7CiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyID0gbmV3IFRIUkVFLkdyb3VwKCk7CiAgICAgICAgICAgIHRoaXMuc2NlbmUuYWRkKHRoaXMuY29udGFpbmVyKTsKCiAgICAgICAgICAgIC8vIENvbmZpZyBmb3IgIkhlcmN1bGVhbiIgc2NhbGUKICAgICAgICAgICAgdGhpcy5jb25maWcgPSB7CiAgICAgICAgICAgICAgICByYWRpdXM6IDQyLCAgICAgICAvLyBTdGFydCBvdXRzaWRlIHRoZSBhcmVuYSAoMzIgcmFkaXVzKQogICAgICAgICAgICAgICAgdGllcnM6IDYsICAgICAgICAgLy8gTnVtYmVyIG9mIHNlYXRpbmcgcmluZ3MKICAgICAgICAgICAgICAgIHRpZXJIZWlnaHQ6IDEyLAogICAgICAgICAgICAgICAgdGllckRlcHRoOiAxNSwKY3Jvd2RDb3VudDogMjUwMCwgLy8gUmVkdWNlZCBmcm9tIDgwMDAgdG8gcmVkdWNlIGNsdXR0ZXIKICAgICAgICAgICAgICAgIHN0cnVjdHVyZUNvbG9yOiAweDA4MGMxMCwgLy8gRGVlcCBkYXJrIGJsdWUvYmxhY2sKICAgICAgICAgICAgICAgIGxpZ2h0Q29sb3I6IDB4MDBhYWZmCiAgICAgICAgICAgIH07CgogICAgICAgICAgICB0aGlzLnJpbmdzID0gW107CiAgICAgICAgICAgIHRoaXMuY3Jvd2QgPSBudWxsOwoKICAgICAgICAgICAgdGhpcy5fYnVpbGRBcmNoaXRlY3R1cmUoKTsKdGhpcy5fYnVpbGRBcmNoaXRlY3R1cmUoKTsKICAgICAgICAgICAgdGhpcy5fYnVpbGRDcm93ZCgpOwogICAgICAgICAgICB0aGlzLl9idWlsZFN0YWRpdW1MaWdodHMoKTsKICAgICAgICB9CgogICAgICAgIF9idWlsZEFyY2hpdGVjdHVyZSgpIHsKICAgICAgICAgICAgLy8gMS4gVGhlIFZvaWQgQm93bCAoQmFja2dyb3VuZCBPY2NsdWRlcikKICAgICAgICAgICAgLy8gTWFzc2l2ZSBjeWxpbmRlciB0byBibG9jayB0aGUgdm9pZAogICAgICAgICAgICBjb25zdCBib3dsR2VvID0gbmV3IFRIUkVFLkN5bGluZGVyR2VvbWV0cnkoMTgwLCA1MCwgMTIwLCAzMiwgMSwgdHJ1ZSk7CiAgICAgICAgICAgIGNvbnN0IGJvd2xNYXQgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyAKICAgICAgICAgICAgICAgIGNvbG9yOiB0aGlzLmNvbmZpZy5zdHJ1Y3R1cmVDb2xvciwgCiAgICAgICAgICAgICAgICBzaWRlOiBUSFJFRS5CYWNrU2lkZSwKICAgICAgICAgICAgICAgIGZvZzogdHJ1ZSAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbnN0IGJvd2wgPSBuZXcgVEhSRUUuTWVzaChib3dsR2VvLCBib3dsTWF0KTsKICAgICAgICAgICAgYm93bC5wb3NpdGlvbi55ID0gMjA7CiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFkZChib3dsKTsKCiAgICAgICAgICAgIC8vIDIuIFNlYXRpbmcgVGllcnMgKENvbmNlbnRyaWMgUmluZ3MpCiAgICAgICAgICAgIGNvbnN0IHRpZXJNYXQgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyBjb2xvcjogMHgxMTFhMjIsIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGUgfSk7CiAgICAgICAgICAgIGNvbnN0IHJpbU1hdCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7IGNvbG9yOiAweDAwNDQ2NiB9KTsKCiAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpPHRoaXMuY29uZmlnLnRpZXJzOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IHkgPSAoaSAqIHRoaXMuY29uZmlnLnRpZXJIZWlnaHQpIC0gMzA7CiAgICAgICAgICAgICAgICBjb25zdCBySW5uZXIgPSB0aGlzLmNvbmZpZy5yYWRpdXMgKyAoaSAqICh0aGlzLmNvbmZpZy50aWVyRGVwdGggKiAwLjgpKTsKICAgICAgICAgICAgICAgIGNvbnN0IHJPdXRlciA9IHJJbm5lciArIHRoaXMuY29uZmlnLnRpZXJEZXB0aDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRmxvb3IgUmluZwogICAgICAgICAgICAgICAgY29uc3QgcmluZ0dlbyA9IG5ldyBUSFJFRS5SaW5nR2VvbWV0cnkocklubmVyLCByT3V0ZXIsIDY0KTsKICAgICAgICAgICAgICAgIHJpbmdHZW8ucm90YXRlWCgtTWF0aC5QSSAvIDIpOwogICAgICAgICAgICAgICAgY29uc3QgbWVzaCA9IG5ldyBUSFJFRS5NZXNoKHJpbmdHZW8sIHRpZXJNYXQpOwogICAgICAgICAgICAgICAgbWVzaC5wb3NpdGlvbi55ID0geTsKICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFkZChtZXNoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gR2xvd2luZyBSaW0gKFRoZSAiVGVjaCIgZmVlbCkKICAgICAgICAgICAgICAgIGNvbnN0IHJpbUdlbyA9IG5ldyBUSFJFRS5Ub3J1c0dlb21ldHJ5KHJJbm5lciwgMC44LCA0LCA2NCk7CiAgICAgICAgICAgICAgICByaW1HZW8ucm90YXRlWChNYXRoLlBJIC8gMik7CiAgICAgICAgICAgICAgICBjb25zdCByaW0gPSBuZXcgVEhSRUUuTWVzaChyaW1HZW8sIHJpbU1hdCk7CiAgICAgICAgICAgICAgICByaW0ucG9zaXRpb24ueSA9IHk7CiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5hZGQocmltKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMy4gTWFzc2l2ZSBQaWxsYXJzIChUaGUgIkhlcmN1bGVhbiIgU3VwcG9ydCkKICAgICAgICAgICAgY29uc3QgcGlsbGFyR2VvID0gbmV3IFRIUkVFLkJveEdlb21ldHJ5KDgsIDIwMCwgOCk7CiAgICAgICAgICAgIGNvbnN0IHBpbGxhck1hdCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7IGNvbG9yOiAweDA1MDUwNSB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpPDg7IGkrKykgewogICAgICAgICAgICAgICAgY29uc3QgYW5nbGUgPSAoaSAvIDgpICogTWF0aC5QSSAqIDI7CiAgICAgICAgICAgICAgICBjb25zdCByID0gMTQwOyAvLyBGYXIgb3V0CiAgICAgICAgICAgICAgICBjb25zdCBtZXNoID0gbmV3IFRIUkVFLk1lc2gocGlsbGFyR2VvLCBwaWxsYXJNYXQpOwogICAgICAgICAgICAgICAgbWVzaC5wb3NpdGlvbi5zZXQoTWF0aC5jb3MoYW5nbGUpKnIsIDAsIE1hdGguc2luKGFuZ2xlKSpyKTsKICAgICAgICAgICAgICAgIG1lc2gubG9va0F0KDAsMCwwKTsKICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFkZChtZXNoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCl9idWlsZENyb3dkKCkgewogICAgICAgICAgICAvLyBJbnN0YW5jZWQgTWVzaCBmb3IgQ3Jvd2QgKExvdyBQb2x5LCBIaWdoIENvdW50KQogICAgICAgICAgICAvLyBVc2luZyBhIHNpbXBsZSB2ZXJ0aWNhbCBwbGFuZSB0aGF0IGZhY2VzIGNlbnRlcgogICAgICAgICAgICBjb25zdCBnZW8gPSBuZXcgVEhSRUUuUGxhbmVHZW9tZXRyeSgxLjIsIDIuNSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAtLS0gQ1JPV0QgU0hBREVSIElNUExFTUVOVEFUSU9OIC0tLQogICAgICAgICAgICAvLyBBZGQgaW5zdGFuY2Utc3BlY2lmaWMgcmFuZG9tIG9mZnNldCBmb3IgYW5pbWF0aW9uIHZhcmlhdGlvbgogICAgICAgICAgICBjb25zdCBvZmZzZXRzID0gbmV3IEZsb2F0MzJBcnJheSh0aGlzLmNvbmZpZy5jcm93ZENvdW50KTsKICAgICAgICAgICAgZm9yKGxldCBpPTA7IGk8dGhpcy5jb25maWcuY3Jvd2RDb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICBvZmZzZXRzW2ldID0gTWF0aC5yYW5kb20oKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBnZW8uc2V0QXR0cmlidXRlKCdhT2Zmc2V0JywgbmV3IFRIUkVFLkluc3RhbmNlZEJ1ZmZlckF0dHJpYnV0ZShvZmZzZXRzLCAxKSk7CgogICAgICAgICAgICAvLyBDdXN0b20gU2hhZGVyIHZpYSBvbkJlZm9yZUNvbXBpbGUKICAgICAgICAgICAgY29uc3QgbWF0ID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHsgc2lkZTogVEhSRUUuRG91YmxlU2lkZSB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIG1hdC5vbkJlZm9yZUNvbXBpbGUgPSAoc2hhZGVyKSA9PiB7CiAgICAgICAgICAgICAgICBzaGFkZXIudW5pZm9ybXMudVRpbWUgPSB7IHZhbHVlOiAwIH07CiAgICAgICAgICAgICAgICB0aGlzLmNyb3dkVW5pZm9ybXMgPSBzaGFkZXIudW5pZm9ybXM7CgogICAgICAgICAgICAgICAgc2hhZGVyLnZlcnRleFNoYWRlciA9IGAKICAgICAgICAgICAgICAgICAgICB1bmlmb3JtIGZsb2F0IHVUaW1lOwogICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZSBmbG9hdCBhT2Zmc2V0OwogICAgICAgICAgICAgICAgICAgIHZhcnlpbmcgZmxvYXQgdkp1bXA7IC8vIFBhc3MgdG8gZnJhZ21lbnQgZm9yIGNvbG9yIHZhcmlhdGlvbgogICAgICAgICAgICAgICAgYCArIHNoYWRlci52ZXJ0ZXhTaGFkZXI7CgogICAgICAgICAgICAgICAgc2hhZGVyLnZlcnRleFNoYWRlciA9IHNoYWRlci52ZXJ0ZXhTaGFkZXIucmVwbGFjZSgKICAgICAgICAgICAgICAgICAgICAnI2luY2x1ZGUgPGJlZ2luX3ZlcnRleD4nLAogICAgICAgICAgICAgICAgICAgIGAKICAgICAgICAgICAgICAgICAgICAjaW5jbHVkZSA8YmVnaW5fdmVydGV4PgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEFuaW1hdGlvbiBMb2dpYwogICAgICAgICAgICAgICAgICAgIGZsb2F0IHNwZWVkID0gOC4wOwogICAgICAgICAgICAgICAgICAgIGZsb2F0IHQgPSB1VGltZSAqIHNwZWVkICsgKGFPZmZzZXQgKiAxMDAuMCk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gSnVtcCAoU2luZSB3YXZlIGNsaXBwZWQpCiAgICAgICAgICAgICAgICAgICAgZmxvYXQganVtcCA9IG1heCgwLjAsIHNpbih0KSk7CiAgICAgICAgICAgICAgICAgICAganVtcCA9IHBvdyhqdW1wLCAyLjApOyAvLyBTaGFycGVuIHRoZSBqdW1wIGN1cnZlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gUmFuZG9taXplIGp1bXAgaGVpZ2h0IHNsaWdodGx5CiAgICAgICAgICAgICAgICAgICAgZmxvYXQgaGVpZ2h0ID0gMC41ICsgMC41ICogYU9mZnNldDsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1lZC55ICs9IGp1bXAgKiBoZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gU3dheSAoU2lkZSB0byBzaWRlKQogICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybWVkLnggKz0gY29zKHQgKiAwLjUpICogMC4xOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHZKdW1wID0ganVtcDsKICAgICAgICAgICAgICAgICAgICBgCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgIHNoYWRlci5mcmFnbWVudFNoYWRlciA9IGAKICAgICAgICAgICAgICAgICAgICB2YXJ5aW5nIGZsb2F0IHZKdW1wOwogICAgICAgICAgICAgICAgYCArIHNoYWRlci5mcmFnbWVudFNoYWRlcjsKCiAgICAgICAgICAgICAgICBzaGFkZXIuZnJhZ21lbnRTaGFkZXIgPSBzaGFkZXIuZnJhZ21lbnRTaGFkZXIucmVwbGFjZSgKICAgICAgICAgICAgICAgICAgICAndmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7JywKICAgICAgICAgICAgICAgICAgICBgCiAgICAgICAgICAgICAgICAgICAgdmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gQnJpZ2h0ZW4gd2hlbiBqdW1waW5nIChDaGVlcmluZyBlZmZlY3QpCiAgICAgICAgICAgICAgICAgICAgZGlmZnVzZUNvbG9yLnJnYiArPSB2ZWMzKDAuMikgKiB2SnVtcDsKICAgICAgICAgICAgICAgICAgICBgCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5jcm93ZCA9IG5ldyBUSFJFRS5JbnN0YW5jZWRNZXNoKGdlbywgbWF0LCB0aGlzLmNvbmZpZy5jcm93ZENvdW50KTsKICAgICAgICAgICAgdGhpcy5jcm93ZC5pbnN0YW5jZU1hdHJpeC5zZXRVc2FnZShUSFJFRS5EeW5hbWljRHJhd1VzYWdlKTsKICAgICAgICAgICAgdGhpcy5jcm93ZC5mcnVzdHVtQ3VsbGVkID0gZmFsc2U7IC8vIEFsd2F5cyB2aXNpYmxlCiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBkdW1teSA9IG5ldyBUSFJFRS5PYmplY3QzRCgpOwogICAgICAgICAgICBjb25zdCBjb2xvciA9IG5ldyBUSFJFRS5Db2xvcigpOwogICAgICAgICAgICAKLy8gMS4gQ2FsY3VsYXRlIFRvdGFsIENpcmN1bWZlcmVuY2UgZm9yIGRpc3RyaWJ1dGlvbiB0byBlbnN1cmUgYWxsIHRpZXJzIGdldCBwZW9wbGUKICAgICAgICAgICAgbGV0IHRvdGFsQ2lyYyA9IDA7CiAgICAgICAgICAgIGNvbnN0IHRpZXJSYWRpaSA9IFtdOwogICAgICAgICAgICBmb3IobGV0IHQ9MDsgdDx0aGlzLmNvbmZpZy50aWVyczsgdCsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCByTWluID0gdGhpcy5jb25maWcucmFkaXVzICsgKHQgKiAodGhpcy5jb25maWcudGllckRlcHRoICogMC44KSkgKyAyOwogICAgICAgICAgICAgICAgY29uc3QgY2lyYyA9IDIgKiBNYXRoLlBJICogck1pbjsKICAgICAgICAgICAgICAgIHRvdGFsQ2lyYyArPSBjaXJjOwogICAgICAgICAgICAgICAgdGllclJhZGlpLnB1c2goeyByTWluOiByTWluLCBjaXJjOiBjaXJjIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsZXQgaWR4ID0gMDsKICAgICAgICAgICAgZm9yKGxldCB0PTA7IHQ8dGhpcy5jb25maWcudGllcnM7IHQrKykgewogICAgICAgICAgICAgICAgY29uc3QgeUJhc2UgPSAodCAqIHRoaXMuY29uZmlnLnRpZXJIZWlnaHQpIC0gMzA7CiAgICAgICAgICAgICAgICBjb25zdCB7IHJNaW4sIGNpcmMgfSA9IHRpZXJSYWRpaVt0XTsKICAgICAgICAgICAgICAgIGNvbnN0IHJNYXggPSByTWluICsgdGhpcy5jb25maWcudGllckRlcHRoIC0gMjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRGlzdHJpYnV0ZSBwcm9wb3J0aW9uYWxseSBzbyB1cHBlciByb3dzIGRvbid0IGdldCBjdXQgb2ZmCiAgICAgICAgICAgICAgICBjb25zdCBjb3VudFBlclRpZXIgPSBNYXRoLmZsb29yKHRoaXMuY29uZmlnLmNyb3dkQ291bnQgKiAoY2lyYyAvIHRvdGFsQ2lyYykpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTxjb3VudFBlclRpZXI7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGlmIChpZHggPj0gdGhpcy5jb25maWcuY3Jvd2RDb3VudCkgYnJlYWs7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGFuZ2xlID0gTWF0aC5yYW5kb20oKSAqIE1hdGguUEkgKiAyOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHIgPSByTWluICsgTWF0aC5yYW5kb20oKSAqIChyTWF4IC0gck1pbik7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgZHVtbXkucG9zaXRpb24uc2V0KAogICAgICAgICAgICAgICAgICAgICAgICBNYXRoLmNvcyhhbmdsZSkgKiByLAogICAgICAgICAgICAgICAgICAgICAgICB5QmFzZSArIDEuMjUsIC8vIENlbnRlciBvZiBxdWFkCiAgICAgICAgICAgICAgICAgICAgICAgIE1hdGguc2luKGFuZ2xlKSAqIHIKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEZhY2UgY2VudGVyCiAgICAgICAgICAgICAgICAgICAgZHVtbXkubG9va0F0KDAsIHlCYXNlLCAwKTsKICAgICAgICAgICAgICAgICAgICBkdW1teS51cGRhdGVNYXRyaXgoKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3dkLnNldE1hdHJpeEF0KGlkeCwgZHVtbXkubWF0cml4KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBSYW5kb20gVGVhbSBDb2xvcnMgKFNpbXVsYXRpbmcgZmFucykKICAgICAgICAgICAgICAgICAgICBjb25zdCByYW5kID0gTWF0aC5yYW5kb20oKTsKICAgICAgICAgICAgICAgICAgICBpZiAocmFuZCA8IDAuNDUpIGNvbG9yLnNldEhleCgweDAwODhmZik7IC8vIEhvbWUgQmx1ZQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJhbmQgPCAwLjkpIGNvbG9yLnNldEhleCgweGZmNDQ0NCk7IC8vIEF3YXkgUmVkCiAgICAgICAgICAgICAgICAgICAgZWxzZSBjb2xvci5zZXRIZXgoMHhmZmZmZmYpOyAvLyBOZXV0cmFsL0ZsYXNoCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gVmFyeSBicmlnaHRuZXNzIGZvciBkZXB0aAogICAgICAgICAgICAgICAgICAgIGNvbG9yLm11bHRpcGx5U2NhbGFyKDAuNSArIE1hdGgucmFuZG9tKCkgKiAwLjUpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHRoaXMuY3Jvd2Quc2V0Q29sb3JBdChpZHgsIGNvbG9yKTsKICAgICAgICAgICAgICAgICAgICBpZHgrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5jb250YWluZXIuYWRkKHRoaXMuY3Jvd2QpOwogICAgICAgIH0KCiAgICAgICAgX2J1aWxkSGVyY3VsZWFuUmluZ3MoKSB7CiAgICAgICAgICAgIC8vIE1hc3NpdmUgZmxvYXRpbmcgcmluZ3MgdGhhdCByb3RhdGUgc2xvd2x5CiAgICAgICAgICAgIGNvbnN0IG1hdCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7IAogICAgICAgICAgICAgICAgY29sb3I6IDB4NDQ1NTY2LCAKICAgICAgICAgICAgICAgIHRyYW5zcGFyZW50OiB0cnVlLCAKICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAuMywKICAgICAgICAgICAgICAgIHdpcmVmcmFtZTogdHJ1ZSAvLyBUZWNoL0hvbG9ncmFwaGljIGZlZWwKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyAxLiBFcXVhdG9yaWFsIFJpbmcgKE1hc3NpdmUpCiAgICAgICAgICAgIGNvbnN0IGdlbzEgPSBuZXcgVEhSRUUuVG9ydXNHZW9tZXRyeSgxMTAsIDEsIDE2LCAxMDApOwogICAgICAgICAgICBjb25zdCByaW5nMSA9IG5ldyBUSFJFRS5NZXNoKGdlbzEsIG1hdCk7CiAgICAgICAgICAgIHJpbmcxLnJvdGF0aW9uLnggPSBNYXRoLlBJIC8gMjsKICAgICAgICAgICAgdGhpcy5jb250YWluZXIuYWRkKHJpbmcxKTsKICAgICAgICAgICAgdGhpcy5yaW5ncy5wdXNoKHsgbWVzaDogcmluZzEsIGF4aXM6ICd6Jywgc3BlZWQ6IDAuMDEgfSk7CgogICAgICAgICAgICAvLyAyLiBUaWx0ZWQgUmluZwogICAgICAgICAgICBjb25zdCBnZW8yID0gbmV3IFRIUkVFLlRvcnVzR2VvbWV0cnkoMTMwLCAyLCAxNiwgMTAwKTsKICAgICAgICAgICAgY29uc3QgcmluZzIgPSBuZXcgVEhSRUUuTWVzaChnZW8yLCBtYXQpOwogICAgICAgICAgICByaW5nMi5yb3RhdGlvbi54ID0gTWF0aC5QSSAvIDM7CiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFkZChyaW5nMik7CiAgICAgICAgICAgIHRoaXMucmluZ3MucHVzaCh7IG1lc2g6IHJpbmcyLCBheGlzOiAneScsIHNwZWVkOiAtMC4wMDggfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAzLiBWZXJ0aWNhbCBSaW5nCiAgICAgICAgICAgIGNvbnN0IGdlbzMgPSBuZXcgVEhSRUUuVG9ydXNHZW9tZXRyeSgxNTAsIDMsIDE2LCAxMDApOwogICAgICAgICAgICBjb25zdCByaW5nMyA9IG5ldyBUSFJFRS5NZXNoKGdlbzMsIG1hdCk7CiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFkZChyaW5nMyk7CiAgICAgICAgICAgIHRoaXMucmluZ3MucHVzaCh7IG1lc2g6IHJpbmczLCBheGlzOiAneScsIHNwZWVkOiAwLjAwNSB9KTsKfQoKICAgICAgICBfYnVpbGRTdGFkaXVtTGlnaHRzKCkgewogICAgICAgICAgICBjb25zdCBjb3VudCA9IDE2OyAvLyBOdW1iZXIgb2YgbGlnaHRzIGFyb3VuZCB0aGUgZXF1YXRvcgogICAgICAgICAgICBjb25zdCByYWRpdXMgPSAzNjsgLy8gSnVzdCBvdXRzaWRlIHRoZSBhcmVuYSBib3VuZGFyeSAoMzIpCiAgICAgICAgICAgIGNvbnN0IHlQb3MgPSAwOyAvLyBNaWRkbGUgb2YgdGhlIHNwaGVyZQogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgbGlnaHRHZW8gPSBuZXcgVEhSRUUuU3BoZXJlR2VvbWV0cnkoMC40LCA4LCA4KTsKICAgICAgICAgICAgY29uc3QgbGlnaHRNYXQgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyBjb2xvcjogMHhmZmZmZmYgfSk7CgogICAgICAgICAgICBmb3IobGV0IGk9MDsgaTxjb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBhbmdsZSA9IChpIC8gY291bnQpICogTWF0aC5QSSAqIDI7CiAgICAgICAgICAgICAgICBjb25zdCB4ID0gTWF0aC5jb3MoYW5nbGUpICogcmFkaXVzOwogICAgICAgICAgICAgICAgY29uc3QgeiA9IE1hdGguc2luKGFuZ2xlKSAqIHJhZGl1czsKCiAgICAgICAgICAgICAgICAvLyAxLiBQaHlzaWNhbCBGaXh0dXJlIChUaGUgYnVsYikKICAgICAgICAgICAgICAgIGNvbnN0IG1lc2ggPSBuZXcgVEhSRUUuTWVzaChsaWdodEdlbywgbGlnaHRNYXQpOwogICAgICAgICAgICAgICAgbWVzaC5wb3NpdGlvbi5zZXQoeCwgeVBvcywgeik7CiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5hZGQobWVzaCk7CgogICAgICAgICAgICAgICAgLy8gMi4gVmlzdWFsIEdsb3cgKEZsYXJlKQogICAgICAgICAgICAgICAgY29uc3Qgc3ByaXRlID0gbmV3IFRIUkVFLlNwcml0ZShfZ2xvd01hdGVyaWFsKTsKICAgICAgICAgICAgICAgIHNwcml0ZS5wb3NpdGlvbi5zZXQoeCwgeVBvcywgeik7CiAgICAgICAgICAgICAgICBzcHJpdGUuc2NhbGUuc2V0KDgsIDgsIDEpOyAvLyBMYXJnZSBnbG93CiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5hZGQoc3ByaXRlKTsKCiAgICAgICAgICAgICAgICAvLyAzLiBBY3R1YWwgUG9pbnQgTGlnaHQKICAgICAgICAgICAgICAgIGNvbnN0IGxpZ2h0ID0gbmV3IFRIUkVFLlBvaW50TGlnaHQodGhpcy5jb25maWcubGlnaHRDb2xvciwgMS4wLCA1MCwgMik7CiAgICAgICAgICAgICAgICBsaWdodC5wb3NpdGlvbi5zZXQoeCwgeVBvcywgeik7CiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5hZGQobGlnaHQpOwogICAgICAgICAgICB9CiAgICAgICAgfQp1cGRhdGUoZHQpIHsKICAgICAgICAgICAgLy8gQW5pbWF0ZSBSaW5ncwogICAgICAgICAgICB0aGlzLnJpbmdzLmZvckVhY2gociA9PiB7CiAgICAgICAgICAgICAgICBpZiAoci5heGlzID09PSAneicpIHIubWVzaC5yb3RhdGlvbi56ICs9IHIuc3BlZWQgKiBkdDsKICAgICAgICAgICAgICAgIGlmIChyLmF4aXMgPT09ICd5Jykgci5tZXNoLnJvdGF0aW9uLnkgKz0gci5zcGVlZCAqIGR0OwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIFVwZGF0ZSBDcm93ZCBTaGFkZXIKICAgICAgICAgICAgaWYgKHRoaXMuY3Jvd2RVbmlmb3JtcykgewogICAgICAgICAgICAgICAgdGhpcy5jcm93ZFVuaWZvcm1zLnVUaW1lLnZhbHVlICs9IGR0OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHdpbmRvdy5mbHV4LlN0YWRpdW0gPSBTdGFkaXVtOwp9KSgpOw=="}}</script></head>
<body>
<div id="game-container">
<img id="screen-overlay-gif" src="https://i.postimg.cc/htrkgHTr/grok-video-2026-01-09-06-22-47-ezgif-com-resize.gif">
        <div id="ui-layer">
            <!-- Cinematic Letterboxing -->
            <div id="cinematic-bars">
                <div class="bar top"></div>
                <div class="bar bottom"></div>
            </div>

            <!-- Tech Copy / Event Flash System -->
            <div id="tech-flash-overlay">
                <div class="flash-line top"></div>
                <div class="tech-content-wrapper">
                    <div class="tech-text">TECHCOPY!</div>
                    <div class="tech-sub-text"></div>
                    <div class="tech-timer-track">
                        <div class="tech-timer-fill"></div>
                    </div>
                </div>
                <div class="flash-line bottom"></div>
            </div>

            <div id="loading">Loading Blitzball...</div>

            <!-- Top HUD -->
            <div id="hud-top">
                <div class="team-wing home">
                    <div class="crystal-bg"></div>
                    <div class="team-data">
                        <div class="team-name">BESAID</div>
                        <div class="team-sub">AUROCHS</div>
                    </div>
                    <div class="score-box">
                        <div id="score-player" class="score-digit">0</div>
                    </div>
                </div>

                <div class="timer-complex">
                    <div class="timer-crystal-ring"></div>
                    <div class="timer-content">
                        <div id="half-indicator">1st</div>
                        <div id="timer-display">00:00</div>
                    </div>
                </div>

                <div class="team-wing away">
                    <div class="score-box">
                        <div id="score-cpu" class="score-digit">0</div>
                    </div>
                    <div class="team-data">
                        <div class="team-name">LUCA</div>
                        <div class="team-sub">GOERS</div>
                    </div>
                    <div class="crystal-bg"></div>
                </div>
            </div>

            <!-- NEW: Goal Distance Indicator -->
            <div id="goal-distance-container">
                <div class="distance-label">GOAL</div>
                <div id="goal-distance">0m</div>
            </div>

            <!-- Mini-Map -->
            <div id="minimap-container">
                <div class="radar-rim"></div>
                <div id="minimap"></div>
                <div class="radar-label">SPHERE POOL</div>
            </div>

            <!-- Player Status Panel -->
            <div id="player-status-panel">
                <div class="char-name">TIDUS</div>
                <div class="hp-gauge-container">
                    <div class="hp-label">HP</div>
                    <div class="hp-bar-track">
                        <div class="hp-bar-fill" style="width: 100%;"></div>
                    </div>
                    <div class="hp-value">120/120</div>
                </div>
                <div class="tech-gauge-container">
                    <div class="tech-label">EXP</div>
                    <div class="tech-bar-track">
                        <div class="tech-bar-fill" style="width: 45%;"></div>
                    </div>
                </div>
            </div>

            <!-- NEW: Charge Power Meter -->
            <div id="charge-meter-container">
                <div class="charge-label">POWER</div>
                <div class="charge-meter-track">
                    <div id="charge-meter-fill"></div>
                </div>
                <div class="charge-hint">RELEASE!</div>
            </div>

            <!-- Announcement -->
            <div id="announcement">GOAL!</div>

            <!-- Controls -->
            <!-- Movement Joystick (Left) -->
            <div id="joystick-hit-zone"></div>
            <div id="joystick-visual-container">
                <div id="joystick-base"></div>
                <div id="joystick-knob"></div>
            </div>

            <!-- NEW: Aim Joystick (Right) -->
            <div id="aim-joystick-zone"></div>
            <div id="aim-joystick-visual">
                <div id="aim-joystick-base"></div>
                <div id="aim-joystick-knob"></div>
            </div>

            <div id="camera-zone"></div>

            <!-- Action Command -->
            <div id="action-container">
                <div class="command-menu-bg"></div>
                <div class="command-ring"></div>
                <div id="action-label">COMMAND</div>
                <div id="action-buttons-wrapper" style="position: relative; width: 100px; height: 100px;">
                    <div id="action-button">
                        <div class="limit-ring"></div>
                        <span class="btn-text">WAIT</span>
                        <div class="btn-glare"></div>
                    </div>
                    <div id="pass-button">
                        <div class="limit-ring"></div>
                        <span class="btn-text">PASS</span>
                        <div class="btn-glare"></div>
                    </div>
                </div>
            </div>

            <!-- NEW: Tackle Button -->
            <div id="tackle-button">
                <span class="btn-text">TACKLE</span>
                <div class="btn-glare"></div>
            </div>

            <!-- Auto/Demo Toggle -->
            <div id="auto-toggle" class="glass-btn">MANUAL</div>

            <!-- NEW: Settings Button -->
            <div id="settings-button" class="glass-btn">SETTINGS</div>

            <div id="practice-restore-btn">MENU</div>
            <div id="controls-hint">WASD or Drag to Swim | Swipe to Dash</div>

            <!-- NEW: Settings Panel -->
<div id="settings-panel" style="display: none;">
                <div class="settings-header">
                    <span>SETTINGS</span>
                    <button id="settings-close">X</button>
                </div>
                <div class="settings-content">
                    <div class="setting-row">
                        <label>Sensitivity</label>
                        <input type="range" id="sensitivity-slider" min="50" max="150" value="100">
                    </div>
                    <div class="setting-row">
                        <label>Aim Assist</label>
                        <input type="checkbox" id="aim-assist-toggle" checked="">
                    </div>
                    <div class="setting-row">
                        <label>Camera Shake</label>
                        <input type="checkbox" id="shake-toggle" checked="">
                    </div>
                    <div class="setting-row">
                        <label>Music Volume</label>
                        <input type="range" id="volume-slider" min="0" max="100" value="50">
                    </div>
                    <div class="setting-row" style="justify-content: center; margin-top: 20px; background: transparent;">
                        <button id="exit-to-menu-btn" class="glass-btn" style="width: 100%; border-color: #ff4444; color: #ff4444;">EXIT TO MENU</button>
                    </div>
                </div>
            </div>


            <!-- Practice Overlay -->
            <div id="practice-overlay">
                <div class="practice-panel">
                    <div class="panel-header">
                        <div class="panel-minimize-btn" id="p-minimize">-</div>
                        <div class="panel-title-group">
                            <span class="panel-title">BLITZ TRAINING</span>
                            <span class="panel-subtitle">SPHERE POOL SIMULATION</span>
                        </div>
                        <div class="panel-deco-line"></div>
                    </div>

                    <div class="panel-content">
                        <div class="panel-section">
                            <div class="section-label">DRILL SELECTION</div>
                            <div class="drill-list">
<div class="drill-btn active" data-drill="free">
                                    <span class="icon"></span> FREE ROAM
                                </div>
                                <div class="drill-btn" data-drill="shooting">
                                    <span class="icon"></span> SHOOTING
                                </div>
                                <div class="drill-btn" data-drill="passing">
                                    <span class="icon"></span> PASSING
                                </div>
                                <div class="drill-btn" data-drill="defense">
                                    <span class="icon"></span> DEFENSE
                                </div>
                            </div>
                        </div>

                        <div class="panel-section">
                            <div class="section-label">SYSTEM OVERRIDE</div>
                            <div class="option-list">
<div class="option-toggle active" id="opt-inf-stat">
                                    <span class="checkbox"></span> INF STATS
                                </div>
                                <div class="option-toggle active" id="opt-ai-dummy">
                                    <span class="checkbox"></span> AI DUMMY
                                </div>
                                <div class="option-toggle" id="opt-hitboxes">
                                    <span class="checkbox"></span> HITBOXES
                                </div>
                            </div>

                            <div class="section-label" style="margin-top: 15px;">COMMANDS</div>
                            <div class="action-btn" id="p-reset-ball">RESET BALL (R)</div>
                            <div class="action-btn" id="p-exit">EXIT PRACTICE</div>
                        </div>
                    </div>

                    <div class="panel-footer">
                        <div id="drill-instruction">SELECT A DRILL TO BEGIN SIMULATION</div>
                        <div id="drill-score">SCORE: 0</div>
                    </div>
                </div>
            </div>

            <!-- Main Menu -->
            <div id="main-menu" class="active">
                <div class="menu-bg-overlay"></div>
                <div class="ffx-logo-container">
                    <div class="ffx-logo-main">BLITZBALL</div>
                    <div class="ffx-logo-sub">REMASTERED</div>
                </div>
                <div class="menu-options">
                    <div class="menu-item" data-action="normal">
                        <span class="cursor">&gt;</span>
                        <span class="label">NORMAL MATCH</span>
                    </div>
                    <div class="menu-item" data-action="practice">
                        <span class="cursor">&gt;</span>
                        <span class="label">PRACTICE</span>
                    </div>
                    <div class="menu-item" data-action="options">
                        <span class="cursor">&gt;</span>
                        <span class="label">OPTIONS</span>
                    </div>
                </div>
                <div class="menu-footer">FLUX ENGINE v2.0</div>
            </div>
        </div>
    </div>

    <!-- Game Scripts -->
    <script>(function() {
    window.flux = window.flux || {};

    const _loader = new THREE.GLTFLoader();

    // Helper to convert a single material to Basic (Unlit/PSX)
// Helper to convert a single material to Basic (Unlit/PSX)
function convertMaterial(oldMat, isSkinned) {
        if (!oldMat) return null;
        
        // Preserve texture: Check map, then emissiveMap
        const texture = oldMat.map || oldMat.emissiveMap || null;

        // FORCE OPAQUE VISIBILITY
        // We override transparency to ensure models are always visible (fixing the "invisible model" issue).
        const params = {
            map: texture,
            color: 0xffffff,        // FORCE WHITE: Remove any tint from GLTF
            skinning: isSkinned,
            side: THREE.DoubleSide, // Render both sides to prevent backface culling invisibility
            transparent: false,     // Disable transparency to prevent sorting issues
            opacity: 1.0,           // Force full opacity
            alphaTest: 0.5,         // Strong alpha test for cutouts (nets/grates)
            vertexColors: oldMat.vertexColors, // Preserve vertex colors
            depthTest: true,
            depthWrite: true,       // Force depth write so it occludes properly
            fog: true
        };

        // Ensure texture encoding is correct for Three.js
        if (params.map) params.map.encoding = THREE.sRGBEncoding;

        return new THREE.MeshBasicMaterial(params);
    }

    window.flux.AssetLoader = {
        loadModel: function(url, onLoad, onProgress, onError) {
            _loader.load(url, function(gltf) {
                gltf.scene.traverse(function(node) {
                    if (node.isMesh) {
node.castShadow = false;
                        node.receiveShadow = false;
                        node.frustumCulled = false; // Prevent invisibility
                        if (node.material) {
                            if (Array.isArray(node.material)) {
                                node.material = node.material.map(m => convertMaterial(m, node.isSkinnedMesh));
                            } else {
                                node.material = convertMaterial(node.material, node.isSkinnedMesh);
                            }
                        }
                    }
                });
                if (onLoad) onLoad(gltf);
            }, onProgress, onError);
        }
    };
})();</script>
    <script>(function() {
    window.flux = window.flux || {};

// Reusable math objects
    const _pVec = new THREE.Vector3();
    const _pQuat = new THREE.Quaternion();
    const _pTargetQuat = new THREE.Quaternion();
const _pAxisY = new THREE.Vector3(0, 1, 0);
    const _pAxisZ = new THREE.Vector3(0, 0, 1);

class Player {
        constructor(scene, role = 'MF') {
            this.scene = scene;
            this.role = role;
            this.team = null; // Assigned by Team.addPlayer
            this.homePosition = new THREE.Vector3();

            this.mesh = null;
            this.mixer = null;
            this.actions = {};
            this.activeAction = null;
            this.state = 'idle';
            this.inputVector = new THREE.Vector3(0, 0, 0);

            // Physics (Drift/Inertia Model)
            this.velocity = new THREE.Vector3(0, 0, 0);
            this.acceleration = 12.0;
            this.drag = 3.0;
            this.maxSpeed = 8.0;
            // Bone reference for holding ball
            this.handBone = null;
this.canCatch = true;
            this.catchCooldown = 0; // Replaces setTimeout for safety

            // Blitzball Stats
            this.stats = {
                HP: 100,
                maxHP: 100,
                EN: 30,
                AT: 10,
                PA: 15,
                BL: 10,
                SH: 15,
                CA: 10,
                SP: 60
            };

            // Leveling System
            this.level = 1;
            this.exp = 0;
            this.nextLevelExp = 100;

            // Status Effects & Techniques
            this.status = {
                venom: 0,
                nap: 0,
                wither: { PA: 0, SH: 0, AT: 0, BL: 0, CA: 0, SP: 0 }
            };

            this.marking = null;
            this.learnedTechs = [];

            this.techs = {
                tackle: null,
                shoot: null,
                pass: null,
                passive: null
            };

            // Visuals
            this.baseColorHex = 0xffffff;
            this.originalMaterials = [];
            this.auraMesh = null;
            this.rotationOffset = 0;
this.baseScale = 1.17; // Increased ~8%

            // Real-time Stats
            this.currentEN = this.stats.EN;
this.tackleRadius = 2.0; // Reduced from 2.5 to reduce swarm lock

            this.speed = 4.0;
            this._updateDerivedStats();

            this.hasBall = false;
            this.isThrowing = false;

            // Dash State
            this.isDashing = false;
            this.dashTime = 0;
            this.dashTotalTime = 0.5;
            this.dashCooldown = 0;
this.dashCooldown = 0;
            this.clashCooldown = 0; // Cooldown for inflicting tackles
            this.dashVec = new THREE.Vector3();

            // Feedback Accumulators
            this._accumulatedDamage = 0;
            this._damageTimer = 0;

            // HP Bar
            this.hpBar = null;
            this.hpBarFill = null;

            // Gameplay Flow Timers
            this.stunTimer = 0;
            this.immunityTimer = 0;

            // Banking & Verticality
            this.bankingAmount = 0;
            this.targetY = 0;

            // Encounter System
            this.isEngaged = false;
            this.clashTimer = 0;
this.clashTimer = 0;
            this.encounterTimer = 0; // Track duration of current engagement
            // Charge Mechanic
            this.isCharging = false;
            this.chargeTime = 0;
            this.maxChargeTime = 1.5;

            // FIXED: Improved Rotation State with hysteresis
            this.currentYaw = 0;
            this.targetYaw = 0;
            this.lastValidYaw = 0; // Store last known good yaw for deadzone handling
            this.pitchAmount = 0;
            this.bankingAmount = 0;
            this.facingDeadzone = 0.3; // Minimum input/velocity magnitude to update facing

            // Particle Emission Timers
            this._particleTimers = {
                venom: 0,
                nap: 0,
                wither: 0
            };

            // DevTools Flags
            this.isGodMode = false;

            // Pass Target Indicator
// Pass Target Indicator
            this.passTargetIndicator = null;
            
            // Bubble Trail Timer
            this._bubbleTimer = 0;
this._bubbleTimer = 0;
        }
        syncRotation() {
            if (!this.mesh) return;
            const euler = new THREE.Euler().setFromQuaternion(this.mesh.quaternion, 'YXZ');
            this.currentYaw = euler.y - this.rotationOffset;
            this.targetYaw = this.currentYaw;
            this.lastValidYaw = this.currentYaw;
            this.bankingAmount = 0;
            this.pitchAmount = 0;
        }

        getStat(name) {
            let val = this.stats[name];
            if (this.status.wither[name] > 0) {
                val *= 0.5;
            }
            return val;
        }

        applyStatus(type, duration, subType = null) {
            if (type === 'venom') {
                const wasActive = this.status.venom > 1.0;
                this.status.venom = Math.max(this.status.venom, duration);

                if (!wasActive) {
                    console.log(`${this.role} poisoned!`);
                    if (window.flux.gameInstance.floatingText)
                        window.flux.gameInstance.floatingText.spawn("POISON", this.mesh.position, "status");
                }
            } else if (type === 'nap') {
                const wasActive = this.status.nap > 1.0;
                this.status.nap = Math.max(this.status.nap, duration);

                if (!wasActive) {
                    if (this.hasBall) this.fumble();
                    console.log(`${this.role} fell asleep!`);
                    if (window.flux.gameInstance.floatingText)
                        window.flux.gameInstance.floatingText.spawn("SLEEP", this.mesh.position, "status");
                }
            } else if (type === 'wither' && subType) {
                const currentVal = this.status.wither[subType] || 0;
                const wasActive = currentVal > 1.0;
                this.status.wither[subType] = Math.max(currentVal, duration);

                if (!wasActive) {
                    console.log(`${this.role} withered ${subType}!`);
                    if (window.flux.gameInstance.floatingText)
                        window.flux.gameInstance.floatingText.spawn(`WITHER ${subType}`, this.mesh.position, "status");
                }
            }
        }

        _updateDerivedStats() {
            const sp = this.getStat('SP');
            this.maxSpeed = 5.0 + (sp / 15.0);
            this.currentEN = this.getStat('EN');
        }

setMesh(sourceMesh, animations) {
            this.mesh = sourceMesh;
            this.scene.add(this.mesh);
            this._createHPBar();
            this._createAura();
            this._createPassTargetIndicator();

            // Custom Character Scaling
            if (this.characterName) {
                if (this.characterName.includes('Tidus')) this.baseScale = 1.6;
                else if (this.characterName.includes('Wakka')) this.baseScale = 1.4;
            }

            this.mesh.scale.setScalar(this.baseScale);

            this.mesh.traverse((node) => {
                if (node.isMesh && node.material) {
const convertOne = (mat) => {
                        const m = new THREE.MeshBasicMaterial({
                            map: mat.map || null,
                            color: new THREE.Color(0xffffff), // FORCE WHITE: Ignore source color
                            transparent: !!mat.transparent,
                            opacity: (mat.opacity !== undefined ? mat.opacity : 1),
                            alphaTest: (mat.alphaTest !== undefined ? mat.alphaTest : 0),
                            side: mat.side,
                            depthTest: mat.depthTest,
                            depthWrite: mat.depthWrite,
                            fog: true,
                            skinning: !!node.isSkinnedMesh
                        });
                        this.originalMaterials.push({ material: m, baseColor: m.color.clone() });
                        return m;
                    };
                    node.material = Array.isArray(node.material)
                        ? node.material.map(convertOne)
                        : convertOne(node.material);
                }

                if (node.isBone) {
                    const name = node.name.toLowerCase();
                    if ((name.includes('hand') && name.includes('r')) || name.includes('righthand')) {
                        this.handBone = node;
                    }
                }
            });

            this.mixer = new THREE.AnimationMixer(this.mesh);

            if (animations) {
                animations.forEach((clip) => {
                    const name = clip.name.toLowerCase();
                    let action = this.mixer.clipAction(clip);

                    if (name.includes('treading') || name.includes('idle')) {
                        this.actions['idle'] = action;
                    } else if (name.includes('swim')) {
                        this.actions['swim'] = action;
                    } else if (name.includes('throw')) {
                        this.actions['throw'] = action;
                    } else if (name.includes('catch')) {
                        this.actions['catch'] = action;
                    } else if (name.includes('react') || name.includes('gethit') || name.includes('hit') || name.includes('hurt') || name.includes('damage')) {
                        this.actions['react'] = action;
                    } else {
                        this.actions[clip.name] = action;
                    }
                });
            }

            if (this.actions['idle']) {
                this.play('idle');
            } else {
                const first = Object.values(this.actions)[0];
                if(first) first.play();
            }
        }

        play(actionName, duration = 0.5) {
            const newAction = this.actions[actionName];
            if (!newAction || newAction === this.activeAction) return;

            if (this.activeAction) {
                this.activeAction.fadeOut(duration);
            }

            newAction.reset();
            newAction.fadeIn(duration);
            newAction.play();
            this.activeAction = newAction;
            this.state = actionName;
        }

        setInput(x, z) {
            if (this.status.nap > 0) {
                this.inputVector.set(0, 0, 0);
                return;
            }
            this.inputVector.set(x, 0, z);
        }

        receiveBall() {
            this.canCatch = false;

            if (this.status.nap > 0) {
                this.status.nap = 0;
            }

            this.hasBall = true;
            this.immunityTimer = 2.0;

            const ball = window.flux.gameInstance.entities.ball;
            if (ball && ball.lastHolder && ball.lastHolder.team === this.team && ball.lastHolder !== this) {
                ball.lastHolder.gainExp(2);
                this.gainExp(1);
            }

            const catchAction = this.actions['catch'];

            if (catchAction) {
                catchAction.setLoop(THREE.LoopOnce);
                catchAction.clampWhenFinished = true;
            }

            this.play('catch', 0.1);

            if (window.flux.gameInstance.floatingText) {
                window.flux.gameInstance.floatingText.spawn("SNAP!", this.mesh.position, "comic-action");
            }
        }

        throwBall(ball, forcedType = null, powerMultiplier = 1.0) {
            if (!this.hasBall || this.isThrowing) return;
            if (this.status.nap > 0) return;

            this.isThrowing = true;

            // Lock aim direction at start of throw
            this.lockedAimVector = new THREE.Vector3();

            if (this.inputVector.lengthSq() > 0.1) {
                this.lockedAimVector.copy(this.inputVector).normalize();
            } else {
                this.lockedAimVector.set(0, 0, 1).applyQuaternion(this.mesh.quaternion).normalize();
            }

            const goalZ = (this.team && this.team.side === 1) ? -28 : 28;
            const distToGoal = Math.abs(this.mesh.position.z - goalZ);

            let type = forcedType;
            if (!type) {
                type = (distToGoal < 25) ? 'SH' : 'PA';
            }

            const isFinisher = (type === 'SH' && distToGoal < 12.0);

            let techName = (type === 'SH') ? this.techs.shoot : this.techs.pass;

            if (this.status.venom > 0 && techName) {
                if (window.flux.gameInstance.floatingText)
                    window.flux.gameInstance.floatingText.spawn("SILENCED", this.mesh.position, "status");
                techName = null;
            }

            let windupTime = 100;
            let animSpeed = 1.5;

            if (powerMultiplier > 1.1) {
                windupTime += 200;
            }

            if (isFinisher && !techName) {
                windupTime = 50;
                animSpeed = 3.0;
            }

if (techName) {
                windupTime = 400;
                animSpeed = 0.8;

                if (window.flux.gameInstance.cameraManager) {
                    window.flux.gameInstance.cameraManager.playCinematic(techName, this.mesh, 1.2);
                }

                this.immunityTimer = 1.5;

                if (window.flux.gameInstance.floatingText) {
                    const label = techName.replace('_', ' ').toUpperCase();
                    window.flux.gameInstance.floatingText.spawn(label, this.mesh.position, "tech");
                }

                // NEW: Spawn Tech Glyph (Vertical Casting Circle)
                if (window.flux.gameInstance.glyphManager) {
                    window.flux.gameInstance.glyphManager.spawn('tech', this.mesh.position, {
                        parent: this,
                        life: 1.2,
                        rotationSpeed: 4.0,
                        scaleSpeed: 1.5,
                        offsetY: 1.2,
                        faceCamera: true
                    });
                }
            }

            const throwAction = this.actions['throw'];
            if (throwAction) {
                throwAction.setLoop(THREE.LoopOnce);
                throwAction.clampWhenFinished = true;
                throwAction.timeScale = animSpeed;
            }
            this.play('throw', 0.1);

            if (window.flux.gameInstance.floatingText && !techName) {
                window.flux.gameInstance.floatingText.spawn("WHOOSH", this.mesh.position, "comic-action");
            }

            setTimeout(() => {
                if (this.hasBall) {
                    if (throwAction) throwAction.timeScale = 1.0;

                    let finalDir = new THREE.Vector3();
                    let referenceDir = new THREE.Vector3();

                    if (this.overrideAimVector) {
                        finalDir.copy(this.overrideAimVector).normalize();
                        referenceDir.copy(finalDir);

                        const targetAngle = Math.atan2(finalDir.x, finalDir.z);
                        const finalAngle = targetAngle + this.rotationOffset;
                        const q = new THREE.Quaternion().setFromAxisAngle(_pAxisY, finalAngle);
                        this.mesh.quaternion.copy(q);
                        this.syncRotation();
                    } else {
                        finalDir.copy(this.lockedAimVector);
                        referenceDir.copy(this.lockedAimVector);
                    }

                    const spin = new THREE.Vector3(0, 0, 0);

                    if (this.inputVector.lengthSq() > 0.1) {
                        const inputDir = this.inputVector.clone().normalize();
                        const crossY = new THREE.Vector3().crossVectors(referenceDir, inputDir).y;

                        if (Math.abs(crossY) > 0.1) {
                            spin.set(0, crossY * 12.0, 0);
                        }
                    }

                    let baseCost = (type === 'SH') ? 20 : 10;
                    let techCost = 0;
                    let techBonus = 0;
                    let techPayload = null;

                    if (techName) {
                        switch (techName) {
                            case 'venom':
                                techCost = (type === 'SH' ? 20 : 10);
                                techBonus = 3;
                                techPayload = { type: 'venom', level: 1 };
                                break;
                            case 'wither':
                                techCost = (type === 'SH' ? 20 : 10);
                                techBonus = 3;
                                techPayload = { type: 'wither', level: 1 };
                                break;
                            case 'nap':
                                techCost = (type === 'SH' ? 35 : 30);
                                techBonus = 3;
                                techPayload = { type: 'nap', level: 1 };
                                break;
                            case 'sphere':
                                if (type === 'SH') {
                                    techCost = 25;
                                    const rng = Math.floor(Math.random() * 11) + 5;
                                    techBonus = rng;
                                    techPayload = { type: 'sphere', level: 1, bonus: rng };
                                    if (window.flux.gameInstance.floatingText)
                                        window.flux.gameInstance.floatingText.spawn(`SPHERE +${rng}`, this.mesh.position, "goal");
                                }
                                break;
                            case 'jecht':
                                if (type === 'SH') {
                                    techCost = 40;
                                    techBonus = 5;
                                    techPayload = { type: 'jecht', level: 1 };
                                    this._performJechtKnockback();
                                }
                                break;
                            case 'invisible':
                                if (type === 'SH') {
                                    techCost = 25;
                                    techBonus = 2;
                                    techPayload = { type: 'invisible', level: 1 };
                                }
                                break;
                        }
                    }

                    const totalCost = baseCost + techCost;

                    let powerFactor = 1.0;
                    if (this.stats.HP < totalCost) {
                        powerFactor = 0.5;
                        this.stats.HP = 0;
                        techPayload = null;
                        techBonus = 0;
                        if (window.flux.gameInstance.floatingText)
                            window.flux.gameInstance.floatingText.spawn("TIRED", this.mesh.position, "damage");
                    } else {
                        this.stats.HP -= totalCost;
                    }

                    let statVal = this.getStat(type);
                    statVal += techBonus;
                    statVal *= powerFactor;
                    statVal *= powerMultiplier;

                    const goalZ = (this.team && this.team.side === 1) ? -28 : 28;
                    const goalDir = new THREE.Vector3(0, 0, goalZ - this.mesh.position.z).normalize();
                    const goalDot = finalDir.dot(goalDir);

                    if (type === 'SH') {
                        const goalPos = new THREE.Vector3(0, 2, goalZ);
                        const toGoal = goalPos.clone().sub(this.mesh.position).normalize();

                        const sh = this.getStat('SH');
                        let assistFactor = Math.min(0.9, Math.max(0.1, sh / 100.0));

                        if (this.overrideAimVector) {
                            assistFactor *= 0.1;
                        }

                        if (goalDot > 0.2) {
                            finalDir.lerp(toGoal, assistFactor);
                        }

                        if (isFinisher) {
                            finalDir.y += 0.05;
                            if (window.flux.gameInstance.floatingText) {
                                window.flux.gameInstance.floatingText.spawn("SLAM!", this.mesh.position, "comic-impact");
                            }
} else {
                            finalDir.y += 0.25;
                        }
                        
// Goalie Loft Bonus (Prevent interception by immediate defender)
                        if (this.role === 'GL') finalDir.y += 0.8; // High loft for clearance

                    } else {
                        const target = this._findPassTargetInCone(finalDir);

                        if (target) {
                            const toMate = target.mesh.position.clone().sub(this.mesh.position);
                            if (target.velocity.lengthSq() > 0.1) {
                                toMate.addScaledVector(target.velocity, 0.5);
                            }
                            toMate.normalize();

                            const pa = this.getStat('PA');
                            let assistFactor = Math.min(1.0, 0.3 + (pa / 80.0));

                            if (this.overrideAimVector) {
                                assistFactor *= 0.1;
                            }

                            finalDir.lerp(toMate, assistFactor);

                            const dist = this.mesh.position.distanceTo(target.mesh.position);
                            finalDir.y += Math.min(0.6, dist * 0.03);
                        } else {
finalDir.y += 0.2;
                        }
                        
                        // Goalie Loft Bonus for Passing
// Goalie Loft Bonus for Passing
                        if (this.role === 'GL') finalDir.y += 0.8; // High loft for clearance
                    }

                    finalDir.normalize();

                    if (techPayload && window.flux.gameInstance && window.flux.gameInstance.triggerTechEvent) {
                        window.flux.gameInstance.triggerTechEvent(this, techName);
                    }

ball.shoot(finalDir, statVal, type, techPayload, spin);
                    
                    // Extra grace period for Goalie to prevent point-blank interceptions
                    if (this.role === 'GL') {
                        ball.catchGracePeriod = 0.6; // 0.6s immunity (approx 10-12m travel)
                    }

this.loseBall();

                    this.catchCooldown = 1.0; // 1s cooldown
                    this.catchCooldown = 1.0; // 1s cooldown
                    this.canCatch = false;
                }
            }, windupTime);

            setTimeout(() => {
                this.isThrowing = false;
                this.overrideAimVector = null;
                if (this.inputVector.length() > 0.1) {
                    this.play('swim', 0.2);
                } else {
                    this.play('idle', 0.2);
                }
            }, windupTime + 500);
        }

        _findPassTargetInCone(aimDir) {
            if (!this.team) return null;

            let bestTarget = null;
            let maxScore = -Infinity;

            for (const mate of this.team.players) {
                if (mate === this || !mate.mesh) continue;

                const toMate = mate.mesh.position.clone().sub(this.mesh.position).normalize();
                const dot = aimDir.dot(toMate);

                if (dot > 0.7) {
                    const dist = this.mesh.position.distanceTo(mate.mesh.position);
                    const score = (dot * 10) - (dist * 0.1);

                    if (score > maxScore) {
                        maxScore = score;
                        bestTarget = mate;
                    }
                }
            }
            return bestTarget;
        }

startCharge() {
            if (!this.hasBall || this.isThrowing || this.status.nap > 0) return;
            this.isCharging = true;
            this.chargeTime = 0;

// Visuals handled in update

            // Show charge UI
            this._updateChargeUI(0);

            // NEW: Spawn Charge Glyph (Ground Ring)
            if (window.flux.gameInstance && window.flux.gameInstance.glyphManager) {
                window.flux.gameInstance.glyphManager.spawn('charge', this.mesh.position, {
                    parent: this,
                    life: this.maxChargeTime,
                    rotationSpeed: 3.0,
                    scaleSpeed: 0.2,
                    offsetY: 0.1
                });
            }
        }

        releaseCharge(dx = 0, dy = 0) {
            if (!this.isCharging) return;
            this.isCharging = false;

const ratio = Math.min(this.chargeTime / this.maxChargeTime, 1.0);
            let multiplier = 1.0 + (ratio * 0.5);

            if (ratio > 0.9) {
                multiplier = 2.0;
                if (window.flux.gameInstance.floatingText) {
                    window.flux.gameInstance.floatingText.spawn("PERFECT!", this.mesh.position, "comic-impact");
                }
                if (window.flux.gameInstance.cameraManager) {
                    window.flux.gameInstance.cameraManager.addFovImpulse(-5);
                    window.flux.gameInstance.cameraManager.addShake(0.5);
                }
            }

// Reset visuals in update
            this._hideChargeUI();

            let aimVec = null;
            const swipeLen = Math.sqrt(dx*dx + dy*dy);

            if (swipeLen > 20) {
                const camera = window.flux.gameInstance.camera;
                const fwd = new THREE.Vector3();
                const right = new THREE.Vector3();

                if (camera) {
                    camera.getWorldDirection(fwd);
                    fwd.y = 0;
                    if (fwd.lengthSq() < 0.001) fwd.set(0, 0, -1);
                    else fwd.normalize();

                    right.crossVectors(fwd, new THREE.Vector3(0, 1, 0)).normalize();

                    const worldVec = new THREE.Vector3();
                    worldVec.addScaledVector(right, dx);
                    worldVec.addScaledVector(fwd, -dy);
                    worldVec.normalize();

                    aimVec = worldVec;
                    this.overrideAimVector = aimVec;
                } else {
                    aimVec = new THREE.Vector3(0, 0, 1).applyQuaternion(this.mesh.quaternion).normalize();
                    this.overrideAimVector = null;
                }
            } else {
                aimVec = new THREE.Vector3(0, 0, 1).applyQuaternion(this.mesh.quaternion).normalize();
                this.overrideAimVector = null;
            }

            const goalZ = (this.team && this.team.side === 1) ? -28 : 28;
            const goalDir = new THREE.Vector3(0, 0, goalZ - this.mesh.position.z).normalize();
            const dotGoal = aimVec.dot(goalDir);

            let type = 'PA';

            const distToGoal = Math.abs(this.mesh.position.z - goalZ);

            if (dotGoal > 0.8 && distToGoal < 30.0) {
                type = 'SH';
            } else if (dotGoal > 0.5 && distToGoal < 15.0) {
                type = 'SH';
            }

            const targetMate = this._findPassTargetInCone(aimVec);
            if (targetMate && type === 'SH') {
                const distMate = this.mesh.position.distanceTo(targetMate.mesh.position);
                if (distMate < 12.0) type = 'PA';
            }

            const ball = window.flux.gameInstance.entities.ball;
            if (ball) {
                this.throwBall(ball, type, multiplier);
            }
        }

        // NEW: Charge UI methods
        _updateChargeUI(ratio) {
            const meter = document.getElementById('charge-meter-fill');
            if (meter) {
                meter.style.width = `${ratio * 100}%`;
                if (ratio > 0.9) {
                    meter.style.background = 'linear-gradient(90deg, #ff0, #f80)';
                } else if (ratio > 0.5) {
                    meter.style.background = 'linear-gradient(90deg, #0f0, #ff0)';
                } else {
                    meter.style.background = 'linear-gradient(90deg, #0af, #0f0)';
                }
            }
            const container = document.getElementById('charge-meter-container');
            if (container) container.style.display = 'block';
        }

        _hideChargeUI() {
            const container = document.getElementById('charge-meter-container');
            if (container) container.style.display = 'none';
        }

        setOverrideAim(x, z) {
            if (!this.overrideAimVector) this.overrideAimVector = new THREE.Vector3();
            this.overrideAimVector.set(x, 0, z).normalize();
        }

loseBall() {
            this.hasBall = false;
            this._hidePassTargetIndicators();
            // Fix: Ensure player can catch again if they lose possession unexpectedly
            // (Standard throws/fumbles will immediately set this to false with a timeout)
            this.canCatch = true;
        }

update(dt) {
            if (!this.mesh) return;

            if (this.isGodMode) {
                this.stats.HP = this.stats.maxHP;
                this.currentEN = this.getStat('EN');
                this.status.venom = 0;
                this.status.nap = 0;
            }

            if (this.mixer) {
                this.mixer.update(dt);
            }

// this.isEngaged = false; // REMOVED: Handled in _checkTacklePressure to prevent state flickering

            this._updateStatus(dt);

            // Charge Logic
// Charge Logic
            if (this.isCharging) {
                if (!this.hasBall || this.status.nap > 0 || this.stunTimer > 0) {
                    this.isCharging = false;
                    this.mesh.position.y = 0;
                    this.mesh.scale.setScalar(this.baseScale);
                    this._hideChargeUI();
                } else {
                    this.chargeTime += dt;

                    const ratio = Math.min(this.chargeTime / this.maxChargeTime, 1.0);
                    
                    // Levitation (Powering up)
                    const hover = (Math.sin(Date.now() * 0.02) * 0.1) + (ratio * 0.8);
                    
                    // Vibration (Intensity increases with charge)
                    const shake = 0.05 + (0.1 * ratio);
                    
                    // Apply Y offset (Hover + Jitter)
                    this.mesh.position.y = hover + (Math.random() - 0.5) * shake;
                    
                    // Apply Rotation Jitter (via banking/pitch variables)
                    // This avoids positional drift while giving a "struggling to contain power" look
                    this.bankingAmount += (Math.random() - 0.5) * shake;
                    this.pitchAmount += (Math.random() - 0.5) * shake;

                    // Ensure scale stays normal (Remove swelling effect)
                    this.mesh.scale.setScalar(this.baseScale);

                    this._updateChargeUI(ratio);
                }
            }
if (this.dashCooldown > 0) this.dashCooldown -= dt;
            if (this.clashCooldown > 0) this.clashCooldown -= dt;
            if (this.stunTimer > 0) this.stunTimer -= dt;
            if (this.immunityTimer > 0) this.immunityTimer -= dt;
            if (this.catchCooldown > 0) {
                this.catchCooldown -= dt;
                if (this.catchCooldown <= 0) this.canCatch = true;
            }
            // Dash Logic
            if (this.isDashing) {
                this.dashTime -= dt;

                if (this.dashType === 'horizontal') {
                    this._checkTackleCollision();
                }

                if (this.dashTime <= 0) {
                    this.isDashing = false;
                    this.mesh.position.y = 0;
                    this.dashType = null;
                } else {
if (this.dashType === 'vertical') {
                        _pVec.copy(this.dashVec).multiplyScalar(dt);
                        this.mesh.position.add(_pVec);
                        const t = 1 - (this.dashTime / this.dashTotalTime);
                        this.mesh.position.y = Math.sin(t * Math.PI) * 3.0;
                    } else {
                        this.mesh.position.add(_pVec);
                        this.mesh.position.y = 0;

// Visual Tackle Lean (Shoulder Bash Animation)
                        const t = 1 - (this.dashTime / this.dashTotalTime); // 0 to 1
                        const lean = Math.sin(t * Math.PI); // Peak at 1.0 in middle
                        
                        // Re-apply base facing + Aggressive Shoulder Check
                        const baseQ = new THREE.Quaternion().setFromAxisAngle(_pAxisY, this.currentYaw + this.rotationOffset);
                        
                        let pitch = 0;
                        let yaw = 0;
                        let roll = 0;
                        let lungeAmt = 0;

                        if (this.dashType === 'horizontal' || this.dashType === 'break') {
                             // TACKLE/BREAK: Aggressive Shoulder Check
                             pitch = 1.2 * lean; // Head down / Lean forward
                             yaw = 0.8 * lean;   // Turn shoulder into target
                             roll = -0.6 * lean; // Dip shoulder
                             lungeAmt = 0.8 * lean; // Thrust mesh forward visually
                        } else if (this.dashType === 'sprint') {
                             // SPRINT: Aerodynamic lean
                             pitch = 0.5 * lean; 
                             lungeAmt = 0.2 * lean;
                        }

                        // Apply Lunge (Visual Offset)
                        if (lungeAmt > 0) {
                             const lunge = new THREE.Vector3(0, 0, lungeAmt).applyQuaternion(baseQ);
                             this.mesh.position.add(lunge);
                        }

                        const twistQ = new THREE.Quaternion().setFromEuler(new THREE.Euler(pitch, yaw, roll)); 
                        this.mesh.quaternion.multiplyQuaternions(baseQ, twistQ);

                        this.velocity.multiplyScalar(0.96);
                    }
                }
                return;
            }

            // Stun/Nap Check
            if (this.status.nap > 0 || this.stunTimer > 0) {
                const dragFactor = Math.max(0, 1 - (2.0 * dt));
                this.velocity.multiplyScalar(dragFactor);

                _pVec.copy(this.velocity).multiplyScalar(dt);
                this.mesh.position.add(_pVec);

                if (this.state !== 'idle' && this.state !== 'catch') this.play('idle', 0.5);

                this._updateHPBar();
                this._updatePassTargetIndicators();
                return;
            }

            this._checkTacklePressure(dt);

            if (this.isThrowing) {
                this.velocity.multiplyScalar(Math.max(0, 1.0 - (2.0 * dt)));

                this._applySoftCollision(dt);
                this._applyGoalCrease(dt);

                _pVec.copy(this.velocity).multiplyScalar(dt);
                this.mesh.position.add(_pVec);

                this._updateVerticality(dt);

            } else {
                this._updatePhysics(dt);
                this._updateVerticality(dt);
                this._updateBanking(dt);
            }

this._updateHPBar();
            this._updatePassTargetIndicators();

            // Bubble Trail Logic
// Bubble Trail Logic
// Bubble Trail Logic (Dynamic)
            const speedSq = this.velocity.lengthSq();
            if (speedSq > 1.0 && window.flux.gameInstance && window.flux.gameInstance.particleManager) {
                this._bubbleTimer -= dt;
                
                if (this._bubbleTimer <= 0) {
                    const pm = window.flux.gameInstance.particleManager;
                    const backDir = this.velocity.clone().normalize().negate();
                    
                    // 1. Standard Wake (Always spawn)
                    const offset = backDir.clone().multiplyScalar(0.8);
                    offset.y = 0.5 + Math.random() * 0.5; 
                    offset.x += (Math.random()-0.5) * 0.5;
                    offset.z += (Math.random()-0.5) * 0.5;
                    pm.spawn('bubble', this.mesh.position.clone().add(offset), { scale: 0.15 + Math.random() * 0.25 });

                    // 2. Cavitation (High Speed) - Add on top
                    const isHighSpeed = speedSq > 40.0; 
                    if (isHighSpeed) {
                        for(let i=0; i<3; i++) {
                            const mOffset = backDir.clone().multiplyScalar(0.5 + Math.random()*0.5);
                            mOffset.x += (Math.random()-0.5)*0.8;
                            mOffset.y = 0.5 + (Math.random()-0.5)*0.8; 
                            mOffset.z += (Math.random()-0.5)*0.8;
                            
                            pm.spawn('bubble_micro', this.mesh.position.clone().add(mOffset), { scale: 0.06 + Math.random()*0.08 });
                        }
                        this._bubbleTimer = 0.03; 
                    } else {
                        this._bubbleTimer = 0.1; 
                    }
                }
            }
}
        _updateStatus(dt) {
            const pm = window.flux.gameInstance ? window.flux.gameInstance.particleManager : null;

            if (this.status.venom > 0) {
                this.status.venom -= dt;
                this.stats.HP -= 5 * dt;
                if (this.stats.HP < 0) this.stats.HP = 0;

                this._particleTimers.venom -= dt;
                if (this._particleTimers.venom <= 0 && pm) {
                    pm.spawn('venom', this.mesh.position);
                    this._particleTimers.venom = 0.15;
                }
            } else {
                if (!this.hasBall && this.stats.HP < this.stats.maxHP) {
                    this.stats.HP += 5 * dt;
                    if (this.stats.HP > this.stats.maxHP) this.stats.HP = this.stats.maxHP;
                }
            }

            if (this.hasBall) {
                this.stats.HP -= 2.0 * dt;
                if (this.stats.HP < 0) this.stats.HP = 0;
            }

            if (this.status.nap > 0) {
                this.status.nap -= dt;

                this._particleTimers.nap -= dt;
                if (this._particleTimers.nap <= 0 && pm) {
                    pm.spawn('nap', this.mesh.position);
                    this._particleTimers.nap = 0.8;
                }
            }

            let isWithering = false;
            for (let key in this.status.wither) {
                if (this.status.wither[key] > 0) {
                    this.status.wither[key] -= dt;
                    isWithering = true;
                }
            }

            if (isWithering) {
                this._particleTimers.wither -= dt;
                if (this._particleTimers.wither <= 0 && pm) {
                    pm.spawn('wither', this.mesh.position);
                    this._particleTimers.wither = 0.2;
                }
            }

            this._updateVisuals();
        }

_updateVisuals() {
            // REMOVED: Yellow sphere/tint logic as per request.
            // Always revert to base color.
            this.originalMaterials.forEach(entry => {
                entry.material.color.copy(entry.baseColor);
            });
        }

        _createAura() {
            // Aura removed per user request
            this.auraMesh = null;
        }

        // NEW: Pass target indicator
        _createPassTargetIndicator() {
            // Create a ring that highlights potential pass targets
            const geo = new THREE.RingGeometry(0.8, 1.0, 16);
            const mat = new THREE.MeshBasicMaterial({
                color: 0x00ff00,
                transparent: true,
                opacity: 0.6,
                side: THREE.DoubleSide
            });
            this.passTargetIndicator = new THREE.Mesh(geo, mat);
            this.passTargetIndicator.rotation.x = -Math.PI / 2;
            this.passTargetIndicator.position.y = 0.1;
            this.passTargetIndicator.visible = false;
            this.scene.add(this.passTargetIndicator);
        }

        _updatePassTargetIndicators() {
            if (!this.hasBall || !this.team) {
                this._hidePassTargetIndicators();
                return;
            }

            // Find best pass target
            const aimDir = new THREE.Vector3(0, 0, 1).applyQuaternion(this.mesh.quaternion);
            const target = this._findPassTargetInCone(aimDir);

            if (target && target.mesh && this.passTargetIndicator) {
                this.passTargetIndicator.visible = true;
                this.passTargetIndicator.position.x = target.mesh.position.x;
                this.passTargetIndicator.position.z = target.mesh.position.z;
                this.passTargetIndicator.position.y = 0.1;
                this.passTargetIndicator.rotation.z += 0.05;
            } else {
                this._hidePassTargetIndicators();
            }
        }

        _hidePassTargetIndicators() {
            if (this.passTargetIndicator) {
                this.passTargetIndicator.visible = false;
            }
        }

_applySoftCollision(dt) {
            if (!this.mesh || !window.flux.gameInstance) return;

            const game = window.flux.gameInstance;
            const teams = [game.teams.home, game.teams.away];

            const repulsionRadius = 0.5; // Reduced to 0.5 to fix invisible wall issues
            const stiffness = 15.0;

            teams.forEach(team => {
                if (!team) return;
                team.players.forEach(other => {
                    if (other === this || !other.mesh) return;

                    const dx = this.mesh.position.x - other.mesh.position.x;
                    const dy = this.mesh.position.y - other.mesh.position.y;
                    const dz = this.mesh.position.z - other.mesh.position.z;

                    const distSq = dx*dx + dy*dy + dz*dz;
                    const minDist = repulsionRadius * 2.0;

                    if (distSq < minDist * minDist && distSq > 0.0001) {
                        const dist = Math.sqrt(distSq);
                        const overlap = minDist - dist;

                        const force = overlap * stiffness;

                        const nx = dx / dist;
                        const ny = dy / dist;
                        const nz = dz / dist;

                        this.velocity.x += nx * force * dt;
                        this.velocity.y += ny * force * dt;
                        this.velocity.z += nz * force * dt;
                    }
                });
            });
        }

        _updatePhysics(dt) {
            this._applySoftCollision(dt);
            this._applyGoalCrease(dt);

            const inputLenSq = this.inputVector.lengthSq();
            const isInputActive = inputLenSq > 0.01;

            let currentMaxSpeed = this.maxSpeed;
if (this.isEngaged) currentMaxSpeed *= 0.8; // Buffed from 0.5 to allow escape
            if (this.isCharging) currentMaxSpeed *= 0.9;

            if (isInputActive) {
                _pVec.copy(this.inputVector).normalize();

                const targetVelX = _pVec.x * currentMaxSpeed;
                const targetVelZ = _pVec.z * currentMaxSpeed;

                const currentSpeed = this.velocity.length();
                const speedRatio = Math.min(1.0, currentSpeed / this.maxSpeed);

                const agility = THREE.MathUtils.lerp(10.0, 2.0, speedRatio);

                const t = 1.0 - Math.pow(0.01, dt * agility);

                this.velocity.x += (targetVelX - this.velocity.x) * t;
                this.velocity.z += (targetVelZ - this.velocity.z) * t;

                if (this.state !== 'swim') this.play('swim', 0.2);

            } else {
                const brakeFactor = 2.0;
                const t = 1.0 - Math.pow(0.1, dt * brakeFactor);

                this.velocity.x += (0 - this.velocity.x) * t;
                this.velocity.z += (0 - this.velocity.z) * t;

                if (this.velocity.lengthSq() < 0.01) {
                    this.velocity.set(0, this.velocity.y, 0);
                }

                if (this.state !== 'idle' && this.state !== 'catch' && this.state !== 'throw' && this.state !== 'react') {
                    this.play('idle', 0.3);
                }
            }

            this.velocity.y *= Math.max(0, 1.0 - (2.0 * dt));

            _pVec.copy(this.velocity).multiplyScalar(dt);
            this.mesh.position.add(_pVec);
        }

        _updateVerticality(dt) {
            let targetY = 0;

            const ball = window.flux.gameInstance.entities.ball;

            if (ball && ball.mesh && !this.hasBall) {
                const distToBall = this.mesh.position.distanceTo(ball.mesh.position);
                if (distToBall < 15.0) {
                    targetY = ball.mesh.position.y;
                }
            }

            if (this.hasBall) {
                targetY = 0.5;
            }

            const yDiff = targetY - this.mesh.position.y;

            const lift = yDiff * 10.0 * dt;
            this.velocity.y += lift;

            if (this.mesh.position.y > 8.0) {
                this.mesh.position.y = 8.0;
                this.velocity.y *= -0.5;
            } else if (this.mesh.position.y < -8.0) {
                this.mesh.position.y = -8.0;
                this.velocity.y *= -0.5;
            }
        }

        // FIXED: Improved banking with hysteresis to prevent facing flips
        _updateBanking(dt) {
            const inputLenSq = this.inputVector.lengthSq();
            const velLenSq = this.velocity.lengthSq();

            let targetYaw = this.targetYaw;
            let shouldUpdateYaw = false;

            // Only update yaw if input or velocity exceeds deadzone
            if (inputLenSq > this.facingDeadzone * this.facingDeadzone) {
                targetYaw = Math.atan2(this.inputVector.x, this.inputVector.z);
                shouldUpdateYaw = true;
            } else if (velLenSq > this.facingDeadzone * this.facingDeadzone) {
targetYaw = Math.atan2(this.velocity.x, this.velocity.z);
                shouldUpdateYaw = true;
            } else if (this.hasBall && this.team && this.team.isHuman && this.team.activePlayer === this && !window.flux.gameInstance.isDemoMode) {
                // Stationary Aiming (Human with Ball)
                // Rotate towards camera/aim direction
                const cam = window.flux.gameInstance.camera;
                if (cam) {
                    const dir = new THREE.Vector3();
                    cam.getWorldDirection(dir);
                    targetYaw = Math.atan2(dir.x, dir.z);
                    shouldUpdateYaw = true;
                }
            }

            // If we should update, do so. Otherwise keep last valid yaw
            if (shouldUpdateYaw) {
                this.lastValidYaw = targetYaw;
            } else {
                targetYaw = this.lastValidYaw;
            }

            // Smooth Yaw with wrap-around handling
            let diff = targetYaw - this.currentYaw;
            while (diff > Math.PI) diff -= Math.PI * 2;
            while (diff < -Math.PI) diff += Math.PI * 2;

            const speedRatio = Math.min(1.0, this.velocity.length() / this.maxSpeed);
            const turnSpeed = THREE.MathUtils.lerp(12.0, 6.0, speedRatio);

            // Prevent sudden snaps when diff is very large (teleport/reset scenarios)
            const maxYawChange = Math.PI * dt * turnSpeed;
            const yawChange = Math.max(-maxYawChange, Math.min(maxYawChange, diff * dt * turnSpeed));

            this.currentYaw += yawChange;
            this.targetYaw = targetYaw;

            // Banking
            const bankSensitivity = 0.8;
            const maxBank = 0.75;

            let targetBank = -diff * bankSensitivity;
            targetBank = Math.max(-maxBank, Math.min(maxBank, targetBank));

            const bankLerp = 1.0 - Math.pow(0.02, dt);
            this.bankingAmount += (targetBank - this.bankingAmount) * bankLerp;

            // Pitch
            const pitchSensitivity = 0.1;
            const maxPitch = 1.0;

            let targetPitch = -this.velocity.y * pitchSensitivity;
            targetPitch = Math.max(-maxPitch, Math.min(maxPitch, targetPitch));

            const pitchLerp = 1.0 - Math.pow(0.05, dt);
            this.pitchAmount += (targetPitch - this.pitchAmount) * pitchLerp;

            // Apply Rotation
            const finalYaw = this.currentYaw + this.rotationOffset;

            this.mesh.quaternion.setFromAxisAngle(_pAxisY, finalYaw);

            _pQuat.setFromAxisAngle(new THREE.Vector3(1, 0, 0), this.pitchAmount);
            this.mesh.quaternion.multiply(_pQuat);

            _pQuat.setFromAxisAngle(new THREE.Vector3(0, 0, 1), this.bankingAmount);
            this.mesh.quaternion.multiply(_pQuat);

            // Idle Bob
            if (velLenSq < 0.1 && !this.isEngaged) {
                const time = Date.now() * 0.0015;
                const bobPitch = Math.sin(time) * 0.03;
                const bobRoll = Math.cos(time * 0.7) * 0.02;

                _pQuat.setFromEuler(new THREE.Euler(bobPitch, 0, bobRoll));
                this.mesh.quaternion.multiply(_pQuat);
            }
        }

_checkTacklePressure(dt) {
            if (!this.hasBall) {
                this.isEngaged = false;
                this.encounterTimer = 0;
                return;
            }

            if (this.immunityTimer > 0) return;
            if (this.isDashing) return;

            const game = window.flux.gameInstance;
            if (!game || !this.team) return;

            const opponentTeamId = this.team.id === 'home' ? 'away' : 'home';
            const opponentTeam = game.teams[opponentTeamId];

            if (!opponentTeam) return;

            let engagedThisFrame = false;
            const effectiveRadius = this.isEngaged ? this.tackleRadius * 1.2 : this.tackleRadius;

            // 1. Check Engagement Status
            for (const entity of opponentTeam.players) {
                if (!entity.mesh || entity.status.nap > 0 || entity.stunTimer > 0) continue;
                const dist = this.mesh.position.distanceTo(entity.mesh.position);
                if (dist < effectiveRadius) {
                    engagedThisFrame = true;
                    break; 
                }
            }

            // 2. Update Timer & UI Feedback
            if (engagedThisFrame) {
                if (!this.isEngaged) {
                    // Just became engaged
                    this.encounterTimer = 0;
                    if (this.team.isHuman && this.team.activePlayer === this && game.floatingText) {
                        game.floatingText.spawn("ENGAGED!", this.mesh.position, "comic-action");
                        // Hint for the player
                        setTimeout(() => {
                            if (this.isEngaged && this.hasBall && game.floatingText) {
                                game.floatingText.spawn("BREAK NOW!", this.mesh.position, "tech");
                            }
                        }, 200);
                    }
                }
                this.encounterTimer += dt;
            } else {
                this.encounterTimer = 0;
            }

            this.isEngaged = engagedThisFrame;

            // 3. Apply Damage (With Grace Period)
            // Grace Period: 0.5s before damage starts ticking
            if (this.isEngaged && this.encounterTimer > 0.5) {
                for (const entity of opponentTeam.players) {
                    if (!entity.mesh || entity.status.nap > 0 || entity.stunTimer > 0) continue;
                    
                    const dist = this.mesh.position.distanceTo(entity.mesh.position);
                    if (dist < effectiveRadius) {
                        // Discrete Clash Event
                        if (entity.clashCooldown <= 0) {
                            this._resolveClash(entity, game);
                            entity.clashCooldown = 2.0; // Increased cooldown (was 1.5) to reduce spam
                        }
                    }
                }
            }

            if (this.currentEN <= 0) {
                this.fumble();
            }
        }

_resolveClash(opponent, game) {
            const oppAT = opponent.getStat('AT');
            
            // Variance: 0.8 to 1.2
            const variance = 0.8 + Math.random() * 0.4;
            let damage = Math.floor(oppAT * variance);
            if (damage < 1) damage = 1;

            // Directional Shielding
            // Carrier Forward
            _pVec.copy(_pAxisZ).applyQuaternion(this.mesh.quaternion); 
            // Vector To Opponent
            const toOpp = opponent.mesh.position.clone().sub(this.mesh.position).normalize();
            
            const dot = _pVec.dot(toOpp);
            
            // If opponent is BEHIND (dot < -0.2), damage is reduced (Shielding).
            let isShielded = false;
            if (dot < -0.2) {
                damage = Math.floor(damage * 0.5);
                isShielded = true;
            }

            // Apply Damage
            this.currentEN -= damage;
            if (this.currentEN < 0) this.currentEN = 0;

            // Tech Effects
            if (opponent.techs.tackle) {
                if (opponent.techs.tackle === 'venom') {
                    this.applyStatus('venom', 10.0);
                    damage += 3;
                } else if (opponent.techs.tackle === 'wither') {
                    const stats = ['PA', 'SH', 'AT', 'EN'];
                    const target = stats[Math.floor(Math.random() * stats.length)];
                    this.applyStatus('wither', 10.0, target);
                    damage += 3;
                } else if (opponent.techs.tackle === 'drain') {
                    this.stats.HP -= damage; 
                    opponent.stats.HP += damage;
                    if (game.floatingText) game.floatingText.spawn("DRAIN", this.mesh.position, "heal");
                }
            }

            // Visuals - JUICED UP
            const midPos = this.mesh.position.clone().lerp(opponent.mesh.position, 0.5);
            midPos.y += 1.5;

            if (game.floatingText) {
                if (isShielded) {
                    setTimeout(() => {
                        if (game.floatingText) game.floatingText.spawn("SHIELD", this.mesh.position, "block");
                    }, 100);
                }
                
                // Damage feedback
                game.floatingText.spawn(`${damage}`, this.mesh.position, "damage");
            }

            if (game.particleManager) {
                // Massive Impact Juice
                game.particleManager.spawn('shockwave', midPos, { scale: 3.0, life: 0.4 });
                game.particleManager.spawn('flash', midPos, { scale: 4.0 });
                // Debris shower
                for(let i=0; i<6; i++) {
                    game.particleManager.spawn('debris', midPos, { scale: 0.4 });
                }
            }

            if (game.cameraManager) {
                // HERCULEAN SHAKE
                game.cameraManager.addShake(2.5); // Increased from 1.2
                game.cameraManager.addFovImpulse(-5); // Zoom in impact
            }
            
            if (game.triggerImpact) {
                // Freeze frame
                game.triggerImpact(0.15, 'heavy');
            }

            opponent.gainExp(2);
        }

        _performJechtKnockback() {
            if (!this.team) return;
            const game = window.flux.gameInstance;
            const opponentTeamId = this.team.id === 'home' ? 'away' : 'home';
            const opponentTeam = game.teams[opponentTeamId];

            if (!opponentTeam) return;

            const range = 6.0;
            const force = 25.0;

            if (game.floatingText) {
                game.floatingText.spawn("JECHT SHOT!", this.mesh.position, "goal");
            }

            opponentTeam.players.forEach(p => {
                if (!p.mesh) return;
                const dist = this.mesh.position.distanceTo(p.mesh.position);
                if (dist < range) {
                    const dir = p.mesh.position.clone().sub(this.mesh.position).normalize();
                    dir.y = 0.5;
                    dir.normalize();

                    p.velocity.add(dir.multiplyScalar(force));

                    p.isDashing = false;
                    const reactAction = p.actions && p.actions['react'];
                    if (reactAction) {
                        reactAction.setLoop(THREE.LoopOnce);
                        reactAction.clampWhenFinished = true;
                        p.play('react', 0.1);
                    } else {
                        p.play('catch', 0.5);
                    }

                    if (game.floatingText) {
                        game.floatingText.spawn("SMACK!", p.mesh.position, "damage");
                    }
                    if (game.triggerImpact) game.triggerImpact(0.15, 'shatter');
                }
            });
        }

        fumble() {
            console.log("FUMBLE! EN Depleted.");
            if (window.flux.gameInstance.floatingText && this.mesh) {
                window.flux.gameInstance.floatingText.spawn("CRASH!", this.mesh.position, "comic-impact");
            }

            this.stunTimer = 1.5;

            const backDir = new THREE.Vector3(0, 0, 1).applyQuaternion(this.mesh.quaternion).normalize().negate();
            backDir.x += (Math.random() - 0.5) * 0.5;
            backDir.z += (Math.random() - 0.5) * 0.5;
            backDir.normalize();

            this.velocity.add(backDir.multiplyScalar(12.0));

            if (this.hasBall) {
                const ball = window.flux.gameInstance.entities.ball;
                if (ball) {
                    const ejectDir = new THREE.Vector3(Math.random()-0.5, 0.8, Math.random()-0.5).normalize();
                    ball.shoot(ejectDir, 6.0, 'none');
                    this.loseBall();
this.loseBall();

                    this.catchCooldown = 1.5;
                    this.canCatch = false;

                    this.currentEN = 0;
                }
            }
        }

        dash(x, z) {
            if (this.isDashing || this.dashCooldown > 0) return;
            if (this.status.nap > 0) return;

            // OFFENSE: BREAK TACKLE
            if (this.hasBall && this.isEngaged) {
                const cost = 15;

                if (this.currentEN < cost) {
                    if (window.flux.gameInstance.floatingText) {
                        window.flux.gameInstance.floatingText.spawn("FAILED!", this.mesh.position, "damage");
                    }
                    this.fumble();
                    return;
                }

                this.currentEN -= cost;
                this.isDashing = true;
                this.dashTime = 0.4;
                this.dashCooldown = 2.0;
                this.dashType = 'break';

                const burstDir = new THREE.Vector3(0, 0, 1).applyQuaternion(this.mesh.quaternion);
                this.velocity.add(burstDir.multiplyScalar(15.0));

                const game = window.flux.gameInstance;
                const opponentTeamId = this.team.id === 'home' ? 'away' : 'home';
                const opponentTeam = game.teams[opponentTeamId];

                opponentTeam.players.forEach(p => {
                    if (!p.mesh) return;
                    const dist = this.mesh.position.distanceTo(p.mesh.position);
                    if (dist < this.tackleRadius * 1.5) {
                        const pushDir = p.mesh.position.clone().sub(this.mesh.position).normalize();
                        pushDir.y = 0.5;
                        p.velocity.add(pushDir.multiplyScalar(15.0));

                        p.stunTimer = 2.0;
                        p.play('catch', 0.2);

                        if (game.floatingText) {
                            game.floatingText.spawn("STUN!", p.mesh.position, "damage");
                        }
                    }
                });

if (game.floatingText) {
                    game.floatingText.spawn("BREAK!", this.mesh.position, "tech");
                }
                
// NEW: Spawn Break Glyph (Explosive Burst)
                if (game.glyphManager) {
                    game.glyphManager.spawn('status', this.mesh.position, {
                        parent: this,
                        life: 0.5,
                        rotationSpeed: 8.0,
                        scaleSpeed: 3.0,
                        offsetY: 0.5
                    });
                }
                
// Particle Burst (Break Tackle)
                if (game.particleManager) {
                    game.particleManager.spawn('shockwave', this.mesh.position, { scale: 2.0, life: 0.3 });
                    game.particleManager.spawn('flash', this.mesh.position, { scale: 2.5 });
                    // Bubble Burst
                    for(let i=0; i<30; i++) {
                        const bPos = this.mesh.position.clone().add(new THREE.Vector3((Math.random()-0.5), 1.0+(Math.random()-0.5), (Math.random()-0.5)));
                        game.particleManager.spawn('bubble', bPos, { scale: 0.2 + Math.random() * 0.4 });
                    }
                }

                if (game.triggerImpact) game.triggerImpact(0.15, 'heavy');

                return;
            }

            // OFFENSE: SPRINT
            if (this.hasBall) {
                const cost = 5;
                if (this.currentEN < cost) {
                    if (window.flux.gameInstance.floatingText) {
                        window.flux.gameInstance.floatingText.spawn("NO EN!", this.mesh.position, "damage");
                    }
                    return;
                }

                this.currentEN -= cost;
                this.isDashing = true;
                this.dashTime = 0.4;
                this.dashCooldown = 1.5;
                this.dashType = 'sprint';

                const burstDir = this.velocity.clone().normalize();
                if (burstDir.lengthSq() < 0.1) burstDir.set(0, 0, 1).applyQuaternion(this.mesh.quaternion);

                this.velocity.add(burstDir.multiplyScalar(15.0));

                if (window.flux.gameInstance.cameraManager) {
                    window.flux.gameInstance.cameraManager.addFovImpulse(20);
                }
                if (window.flux.gameInstance.floatingText) {
                    window.flux.gameInstance.floatingText.spawn("DASH!", this.mesh.position, "tech");
                }
                return;
            }

            // DEFENSE: BLOCK / TACKLE
            const ball = window.flux.gameInstance.entities.ball;
            let isBlockContext = false;
            if (ball && ball.mesh) {
                const dist = this.mesh.position.distanceTo(ball.mesh.position);
                if (dist < 8.0 && ball.mesh.position.y > 2.5) {
                    isBlockContext = true;
                }
            }

            this.isDashing = true;
            this.dashTime = this.dashTotalTime;
            this.dashCooldown = 1.5;

            const len = Math.sqrt(x*x + z*z);
            const nx = (len > 0) ? x/len : 0;
            const nz = (len > 0) ? z/len : 0;

if (len > 0) {
                let targetAngle = Math.atan2(nx, nz);
                targetAngle += this.rotationOffset;
                this.mesh.quaternion.setFromAxisAngle(_pAxisY, targetAngle);
                this.syncRotation();
            }
            if (isBlockContext) {
                this.dashType = 'vertical';

                const dirToBall = ball.mesh.position.clone().sub(this.mesh.position);
                dirToBall.y = 0;

                if (dirToBall.lengthSq() > 0.01) {
                    dirToBall.normalize();
                    this.dashVec.copy(dirToBall).multiplyScalar(8.0);
                } else {
                    this.dashVec.set(0, 0, 0);
                }

                const catchAction = this.actions['catch'];
                if (catchAction) {
                    catchAction.setLoop(THREE.LoopOnce);
                    catchAction.clampWhenFinished = true;
                    catchAction.timeScale = 1.5;
                }
                this.play('catch', 0.1);

                if (window.flux.gameInstance.floatingText) {
                    window.flux.gameInstance.floatingText.spawn("BLOCK!", this.mesh.position, "default");
                }

            } else {
                this.dashType = 'horizontal';
                this._hasHitTackle = false;

                // Apply velocity impulse in dash direction
                const dashDir = new THREE.Vector3(nx, 0, nz);
                if (dashDir.lengthSq() < 0.1) {
                    dashDir.set(0, 0, 1).applyQuaternion(this.mesh.quaternion);
                }
                this.velocity.add(dashDir.multiplyScalar(20.0));

                const lungeAction = this.actions['throw'];
                if (lungeAction) {
                    lungeAction.setLoop(THREE.LoopOnce);
                    lungeAction.clampWhenFinished = true;
                    lungeAction.timeScale = 2.0;
                }
                this.play('throw', 0.1);

                if (window.flux.gameInstance.triggerImpact) window.flux.gameInstance.triggerImpact(0.05, 'default');
            }

if (window.flux.gameInstance.cameraManager) {
                window.flux.gameInstance.cameraManager.addFovImpulse(10);
                window.flux.gameInstance.cameraManager.addShake(0.3); // Add shake on dash start
            }
        }

        _createHPBar() {
            const container = new THREE.Group();

            const bgGeo = new THREE.PlaneGeometry(1.2, 0.15);
            const bgMat = new THREE.MeshBasicMaterial({ color: 0x000000, side: THREE.DoubleSide, depthTest: false });
            const bg = new THREE.Mesh(bgGeo, bgMat);
            container.add(bg);

            const fillGeo = new THREE.PlaneGeometry(1.16, 0.11);
            fillGeo.translate(0.58, 0, 0);
            const fillMat = new THREE.MeshBasicMaterial({ color: 0x00ff00, side: THREE.DoubleSide, depthTest: false });
            this.hpBarFill = new THREE.Mesh(fillGeo, fillMat);
            this.hpBarFill.position.set(-0.58, 0, 0.01);
            container.add(this.hpBarFill);

            this.hpBar = container;
            this.scene.add(this.hpBar);
        }

        _updateHPBar() {
            if (!this.hpBar || !this.mesh) return;

            this.hpBar.position.copy(this.mesh.position);
            this.hpBar.position.y += 2.2;

            if (window.flux.gameInstance && window.flux.gameInstance.camera) {
                this.hpBar.lookAt(window.flux.gameInstance.camera.position);
            }

            const pct = Math.max(0, this.stats.HP / this.stats.maxHP);
            this.hpBarFill.scale.setX(pct);

            if (pct > 0.5) this.hpBarFill.material.color.setHex(0x00ff00);
            else if (pct > 0.25) this.hpBarFill.material.color.setHex(0xffff00);
            else this.hpBarFill.material.color.setHex(0xff0000);

            this.hpBar.visible = (pct < 0.98);
        }

        gainExp(amount) {
            if (!window.flux.gameInstance || window.flux.gameInstance.state !== 'active') return;

            this.exp += amount;

            if (this.exp >= this.nextLevelExp) {
                this.levelUp();
            }
        }

        levelUp() {
            this.level++;
            this.exp -= this.nextLevelExp;
            this.nextLevelExp = Math.floor(this.nextLevelExp * 1.5);

            const keys = ['HP', 'EN', 'AT', 'PA', 'BL', 'SH', 'CA', 'SP'];

            const hpGain = Math.floor(Math.random() * 20) + 10;
            this.stats.maxHP += hpGain;
            this.stats.HP = this.stats.maxHP;

            keys.forEach(k => {
                if (k === 'HP') return;
                if (Math.random() > 0.4) {
                    const gain = Math.floor(Math.random() * 2) + 1;
                    this.stats[k] += gain;
                }
            });

            this._updateDerivedStats();

            console.log(`${this.role} reached Level ${this.level}!`);

            if (window.flux.gameInstance.floatingText && this.mesh) {
                window.flux.gameInstance.floatingText.spawn("LEVEL UP!", this.mesh.position, "tech");
            }
        }

        _checkTackleCollision() {
            if (!this.team || this._hasHitTackle) return;

            const game = window.flux.gameInstance;
            if (!game) return;

            const opponentTeamId = this.team.id === 'home' ? 'away' : 'home';
            const opponentTeam = game.teams[opponentTeamId];

            for (const opp of opponentTeam.players) {
                if (!opp.mesh) continue;
                const dist = this.mesh.position.distanceTo(opp.mesh.position);

if (dist < 3.0) { // Increased from 2.0 for easier hits
                    this._resolveTackleHit(opp);
                    this._hasHitTackle = true;
                    return;
                }
            }
        }

        _resolveTackleHit(opp) {
            this.isDashing = false;
            this.velocity.multiplyScalar(-0.5);
            this.play('idle', 0.2);

            const at = this.getStat('AT');
            let damage = at * 3.0;

            if (this.techs.tackle === 'venom') {
                opp.applyStatus('venom', 10.0);
                damage += 5;
            } else if (this.techs.tackle === 'wither') {
                opp.applyStatus('wither', 10.0, 'EN');
                damage += 5;
            } else if (this.techs.tackle === 'drain') {
                this.stats.HP += 20;
                opp.stats.HP -= 20;
                if (window.flux.gameInstance.floatingText)
                    window.flux.gameInstance.floatingText.spawn("DRAIN", this.mesh.position, "heal");
            }

            if (opp.hasBall) {
                opp.currentEN -= damage;

if (window.flux.gameInstance.floatingText) {
                    // Removed "EN" suffix for cleaner look
                    window.flux.gameInstance.floatingText.spawn(`${Math.floor(damage)}`, opp.mesh.position, "damage");
                    window.flux.gameInstance.floatingText.spawn("BAM!", opp.mesh.position, "comic-impact");
                }

                if (opp.currentEN <= 0) {
                    opp.fumble();
                } else {
                    opp.stunTimer = 0.5;
                    opp.play('react', 0.1);
                }

                if (this.techs.tackle && window.flux.gameInstance.triggerTechEvent) {
                    window.flux.gameInstance.triggerTechEvent(this, this.techs.tackle);
                }

            } else {
                opp.stunTimer = 1.0;
                opp.play('react', 0.1);
                if (window.flux.gameInstance.floatingText) {
                    window.flux.gameInstance.floatingText.spawn("SMACK!", opp.mesh.position, "comic-impact");
                }
            }

            const pushDir = opp.mesh.position.clone().sub(this.mesh.position).normalize();
            pushDir.y = 0.2;
            opp.velocity.add(pushDir.multiplyScalar(12.0));

            if (window.flux.gameInstance.triggerImpact) window.flux.gameInstance.triggerImpact(0.1, 'heavy');
            if (window.flux.gameInstance.cameraManager) window.flux.gameInstance.cameraManager.addShake(0.8);
            if (window.flux.gameInstance.spawnClash) {
const mid = this.mesh.position.clone().add(opp.mesh.position).multiplyScalar(0.5);
                window.flux.gameInstance.spawnClash(mid);
            }
            
// Bubble Burst (Tackle Hit)
            if (window.flux.gameInstance.particleManager) {
                const mid = this.mesh.position.clone().lerp(opp.mesh.position, 0.5);
                mid.y += 1.0;
                for(let i=0; i<30; i++) {
                    const bubblePos = mid.clone().add(new THREE.Vector3((Math.random()-0.5)*1.5, (Math.random()-0.5)*1.5, (Math.random()-0.5)*1.5));
                    window.flux.gameInstance.particleManager.spawn('bubble', bubblePos, { scale: 0.15 + Math.random() * 0.35 });
                }
}
        }
        _applyGoalCrease(dt) {
            if (this.role === 'GL') return;

            const goals = [
                new THREE.Vector3(0, 0, 28),
                new THREE.Vector3(0, 0, -28)
            ];
            const radius = 10.0;

            goals.forEach(goal => {
                const dx = this.mesh.position.x - goal.x;
                const dz = this.mesh.position.z - goal.z;
                const distSq = dx*dx + dz*dz;

                if (distSq < radius * radius) {
                    const dist = Math.sqrt(distSq);
                    const pushX = dist > 0 ? dx / dist : 1;
                    const pushZ = dist > 0 ? dz / dist : 0;

                    const force = 50.0;
                    this.velocity.x += pushX * force * dt;
                    this.velocity.z += pushZ * force * dt;

                    if (dist < radius - 0.5) {
                        const clampRatio = radius / (dist + 0.001);
                        this.mesh.position.x = goal.x + dx * clampRatio;
                        this.mesh.position.z = goal.z + dz * clampRatio;
                    }
                }
            });
        }
    }

    window.flux.Player = Player;
})();
</script>
    <script>(function() {
    window.flux = window.flux || {};

// Formation Definitions (Coordinates for Side 1: Defends +Z, Attacks -Z)
    // X: Left(-)/Right(+), Z: Forward(-)/Back(+)
    const FORMATIONS = {
        'Normal': {
            'GL': { x: 0, z: 25 },
            'LD': { x: -8, z: 15 }, 'RD': { x: 8, z: 15 },
            'MF': { x: 0, z: 5 },
            'LF': { x: -10, z: -10 }, 'RF': { x: 10, z: -10 }
        },
        'Center Attack': {
            'GL': { x: 0, z: 25 },
            'LD': { x: -8, z: 15 }, 'RD': { x: 8, z: 15 },
            'MF': { x: 0, z: 0 },
            'LF': { x: -4, z: -15 }, 'RF': { x: 4, z: -15 }
        },
        'Right Side': {
            'GL': { x: 0, z: 25 },
            'LD': { x: 0, z: 15 }, 'RD': { x: 12, z: 15 },
            'MF': { x: 10, z: 5 },
            'LF': { x: 5, z: -10 }, 'RF': { x: 15, z: -10 }
        },
        'Left Side': {
            'GL': { x: 0, z: 25 },
            'LD': { x: -12, z: 15 }, 'RD': { x: 0, z: 15 },
            'MF': { x: -10, z: 5 },
            'LF': { x: -15, z: -10 }, 'RF': { x: -5, z: -10 }
        },
        'All-Out Defense': {
            'GL': { x: 0, z: 25 },
            'LD': { x: -6, z: 20 }, 'RD': { x: 6, z: 20 },
            'MF': { x: 0, z: 10 },
            'LF': { x: -10, z: 5 }, 'RF': { x: 10, z: 5 }
        },
        'Flat Line': {
            'GL': { x: 0, z: 25 },
            'LD': { x: -8, z: 0 }, 'RD': { x: 8, z: 0 },
            'MF': { x: 0, z: 0 },
            'LF': { x: -15, z: 0 }, 'RF': { x: 15, z: 0 }
        },
        'Counter': {
            'GL': { x: 0, z: 25 },
            'LD': { x: -8, z: 20 }, 'RD': { x: 8, z: 20 },
            'MF': { x: 0, z: 15 },
            'LF': { x: -12, z: -20 }, 'RF': { x: 12, z: -20 }
        },
        'Double Sides': {
            'GL': { x: 0, z: 25 },
            'LD': { x: -18, z: 15 }, 'RD': { x: 18, z: 15 },
            'MF': { x: 0, z: 5 },
            'LF': { x: -18, z: -10 }, 'RF': { x: 18, z: -10 }
        }
    };



    // --- Enemy Indicator (Red Arrow Sprite) ---
    // Shared texture/material so we don't create 6 canvases.
const _enemyArrowTexture = (() => {
        const c = document.createElement('canvas');
        c.width = 64;
        c.height = 64;
        const ctx = c.getContext('2d');
        ctx.clearRect(0, 0, c.width, c.height);
        
        // Arrow pointing DOWN
        ctx.beginPath();
        ctx.moveTo(6, 12);   
        ctx.lineTo(58, 12);  
        ctx.lineTo(32, 52);  
        ctx.closePath();
        ctx.fillStyle = '#ff0000';
        ctx.fill();
        ctx.lineWidth = 4;
        ctx.strokeStyle = 'rgba(255,255,255,0.95)';
        ctx.stroke();
        return new THREE.CanvasTexture(c);
    })();

const _playerArrowTexture = (() => {
        const c = document.createElement('canvas');
        c.width = 64; c.height = 64;
        const ctx = c.getContext('2d');
        ctx.clearRect(0, 0, c.width, c.height);
        
        // Arrow pointing DOWN
        ctx.beginPath();
        ctx.moveTo(6, 12);   
        ctx.lineTo(58, 12);  
        ctx.lineTo(32, 52);  
        ctx.closePath();
        ctx.fillStyle = '#00ff00'; // Green
        ctx.fill();
        ctx.lineWidth = 4;
        ctx.strokeStyle = 'rgba(255,255,255,0.95)';
        ctx.stroke();
        return new THREE.CanvasTexture(c);
    })();

    const _teammateArrowTexture = (() => {
        const c = document.createElement('canvas');
        c.width = 64; c.height = 64;
        const ctx = c.getContext('2d');
        ctx.clearRect(0, 0, c.width, c.height);
        
        // Arrow pointing DOWN
        ctx.beginPath();
        ctx.moveTo(6, 12);   
        ctx.lineTo(58, 12);  
        ctx.lineTo(32, 52);  
        ctx.closePath();
        ctx.fillStyle = '#ffffff'; // White
        ctx.fill();
        ctx.lineWidth = 4;
        ctx.strokeStyle = 'rgba(0,0,0,0.5)';
        ctx.stroke();
        return new THREE.CanvasTexture(c);
    })();

    const _enemyArrowMaterial = new THREE.SpriteMaterial({ map: _enemyArrowTexture, transparent: true, depthTest: false, depthWrite: false });
    const _playerArrowMaterial = new THREE.SpriteMaterial({ map: _playerArrowTexture, transparent: true, depthTest: false, depthWrite: false });
    const _teammateArrowMaterial = new THREE.SpriteMaterial({ map: _teammateArrowTexture, transparent: true, depthTest: false, depthWrite: false });
class Team {
        /**
         * Generates and applies stats to a player based on role and level.
         * Centralizes balancing to ensure high-level play feels distinct.
         */
        static generateStats(player, role, level = 1, isHuman = false) {
            // 1. Define Role Baselines (Level 1)
            // Balanced to be weak but functional at Level 1
            const base = {
                HP: 100, SP: 55, EN: 10, AT: 5, PA: 5, BL: 5, SH: 5, CA: 5
            };

            // Role Specializations
            switch(role) {
                case 'LF': case 'RF': // Strikers
                    base.SH += 10; base.SP += 5; base.EN += 5;
                    break;
                case 'MF': // Playmakers
                    base.PA += 10; base.AT += 8; base.EN += 8; base.SP += 2;
                    break;
                case 'LD': case 'RD': // Defenders
                    base.AT += 12; base.BL += 10; base.PA += 5;
                    break;
                case 'GL': // Goalie
                    base.CA += 10; base.SP += 5; base.PA += 15; // Strong arm
                    break;
            }

            // 2. Scaling Factors (Per Level)
            // Designed so Level 50 is "God Tier" and Level 1 is "Rookie"
            const growth = {
                HP: 15,    // +1500 HP at Lvl 99
                SP: 0.5,   // +50 SP at Lvl 99 (Speed demon)
                Primary: 0.8, // +80 Stat at Lvl 99
                Secondary: 0.5 // +50 Stat at Lvl 99
            };

            // Helper to scale
            const scale = (val, rate) => Math.floor(val + ((level - 1) * rate));

            // Apply Scaling
            player.stats.HP = scale(base.HP, growth.HP);
            
            // SP: Cap at 99, but ensure high levels feel FAST
            player.stats.SP = Math.min(99, scale(base.SP, growth.SP));

            // Stat distribution based on role priorities
            if (['LF', 'RF'].includes(role)) {
                player.stats.SH = Math.min(99, scale(base.SH, growth.Primary));
                player.stats.EN = Math.min(99, scale(base.EN, growth.Primary));
                player.stats.AT = Math.min(99, scale(base.AT, growth.Secondary));
                player.stats.PA = Math.min(99, scale(base.PA, growth.Secondary));
                player.stats.BL = Math.min(99, scale(base.BL, growth.Secondary));
            } else if (role === 'MF') {
                player.stats.PA = Math.min(99, scale(base.PA, growth.Primary));
                player.stats.AT = Math.min(99, scale(base.AT, growth.Primary));
                player.stats.EN = Math.min(99, scale(base.EN, growth.Primary));
                player.stats.SH = Math.min(99, scale(base.SH, growth.Secondary));
                player.stats.BL = Math.min(99, scale(base.BL, growth.Secondary));
            } else if (['LD', 'RD'].includes(role)) {
                player.stats.AT = Math.min(99, scale(base.AT, growth.Primary));
                player.stats.BL = Math.min(99, scale(base.BL, growth.Primary));
                player.stats.PA = Math.min(99, scale(base.PA, growth.Secondary));
                player.stats.EN = Math.min(99, scale(base.EN, growth.Secondary));
                player.stats.SH = Math.min(99, scale(base.SH, 0.2)); // Defenders bad at shooting
            } else if (role === 'GL') {
                player.stats.CA = Math.min(99, scale(base.CA, growth.Primary));
                player.stats.PA = Math.min(99, scale(base.PA, growth.Secondary));
                player.stats.SH = Math.min(99, scale(base.SH, 0.3));
            }

            // 3. Human Player Bonus (The "Hero" Feel)
            // Gives the player a slight edge to make gameplay feel punchy
            if (isHuman) {
                player.stats.HP += 150; // Tankier
                player.stats.SP += 5;   // Faster
                player.stats.EN += 5;   // Harder to tackle
                
                // Key Stat Boost
                if (role === 'LF' || role === 'RF') player.stats.SH += 5;
                if (role === 'MF') player.stats.PA += 5;
                if (role === 'LD' || role === 'RD') player.stats.AT += 5;
                if (role === 'GL') player.stats.CA += 5;
            }

            // 4. Finalize
            player.stats.maxHP = player.stats.HP;
            player.level = level;
            player._updateDerivedStats();
        }

constructor(scene, id, side, color, isHuman) {
            this.scene = scene;
            this.id = id; // 'home' or 'away'
            this.side = side; // 1 (Defends +Z) or -1 (Defends -Z)
            this.color = color;
            this.isHuman = isHuman;
            this.aiEnabled = true; // Master switch for AI logic
            
            this.players = [];
            this.activePlayer = null; // The player currently controlled/focused
            
            // Formation Anchors
            this.currentFormation = 'Normal';
            
            // Player Indicator (Green Arrow)
            if (this.isHuman) {
                this.playerArrow = new THREE.Sprite(_playerArrowMaterial);
                this.playerArrow.scale.set(0.8, 0.8, 1.0);
                this.playerArrow.renderOrder = 1000; // On top
            }
        }

        assignMarks(opposingTeam) {
            // Simple auto-assign logic: Mark the player in the "matching" position
            // LF<->RD, RF<->LD, MF<->MF, LD<->RF, RD<->LF, GL<->LF
            this.players.forEach(p => {
                let targetRole = 'MF';
                switch (p.role) {
                    case 'LF': targetRole = 'RD'; break;
                    case 'RF': targetRole = 'LD'; break;
                    case 'MF': targetRole = 'MF'; break;
                    case 'LD': targetRole = 'RF'; break;
                    case 'RD': targetRole = 'LF'; break;
                    case 'GL': targetRole = 'LF'; break;
                }

                const target = opposingTeam.players.find(op => op.role === targetRole);
                if (target) {
                    p.marking = target;
                    // console.log(`${this.id} ${p.role} marked ${target.role}`);
                }
            });
        }

        addPlayer(player) {
            this.players.push(player);
            player.team = this;

            // Calculate Home Position based on Formation
            this._updatePlayerHomePosition(player);

            // Enemy indicator: red arrows over the Away team (so enemies are readable)
// Enemy indicator: red arrows over the Away team
            if (this.id === 'away' && player.mesh) {
                const arrow = new THREE.Sprite(_enemyArrowMaterial);
                arrow.scale.set(0.8, 0.8, 1.0);
                arrow.position.set(0, 3.2, 0); // above head
                arrow.renderOrder = 999;
                player.mesh.add(arrow);
                player.enemyArrow = arrow;
            }

            // Teammate indicator: White arrows for inactive humans
            if (this.isHuman && player.mesh) {
                const arrow = new THREE.Sprite(_teammateArrowMaterial);
                arrow.scale.set(0.6, 0.6, 1.0);
                arrow.position.set(0, 3.2, 0);
                arrow.renderOrder = 999;
                arrow.visible = false; // Hidden by default, managed by setActivePlayer
                player.mesh.add(arrow);
                player.teammateArrow = arrow;
            }
        }

        setFormation(name) {
            if (!FORMATIONS[name]) return;
            this.currentFormation = name;
            // console.log(`Team ${this.id} switched to ${name}`);
            
            this.players.forEach(p => {
                this._updatePlayerHomePosition(p);
            });
        }

_updatePlayerHomePosition(player) {
            const data = FORMATIONS[this.currentFormation];
            if (!data) return;

            const offset = data[player.role];
            if (offset) {
                // X Position:
                // Formations: -X is Left, +X is Right.
                // Home Team (Side 1) faces -Z. Left is -X. Use offset.x as is.
                let xPos = offset.x;
                let zPos = offset.z * this.side;

                player.homePosition.set(xPos, 0, zPos);
                
                // Away Team (Side -1) faces +Z. Left is +X. Flip X.
                if (this.side === -1) {
                    player.homePosition.x *= -1; 
                }
            }
            
            // Set initial position
            if (player.mesh) {
                player.mesh.position.copy(player.homePosition);
                // Face center (0,0,0)
                player.mesh.lookAt(0, 0, 0);
            }
        }

        update(dt) {
            // Update all players
            for (let i = 0; i < this.players.length; i++) {
                this.players[i].update(dt);
            }

            // Auto-switch active player if Human
            if (this.isHuman) {
                this.updateActivePlayerSelection();
            }
        }

        updateActivePlayerSelection() {
            const ball = window.flux.gameInstance.entities.ball;
            if (!ball) return;

            // 1. OFFENSE: If we have the ball, active player is the holder
            if (ball.holder && ball.holder.team === this) {
                if (this.activePlayer !== ball.holder) {
                    this.setActivePlayer(ball.holder);
                }
                return;
            }

            // 2. DEFENSE: Select closest to ball
            // Optimization: Only check every few frames or if distance is significant
            let closest = null;
            let minDst = Infinity;

            for (const p of this.players) {
                if (p.role === 'GL') continue; // Don't auto-switch to goalie usually
                if (!p.mesh) continue;

                const d = p.mesh.position.distanceTo(ball.mesh.position);
                if (d < minDst) {
                    minDst = d;
                    closest = p;
                }
            }

            if (closest && closest !== this.activePlayer) {
                this.setActivePlayer(closest);
            }
        }

setActivePlayer(player) {
            // Reset input on previous
            if (this.activePlayer) {
                this.activePlayer.setInput(0, 0);
            }
            this.activePlayer = player;

            // Visual Indicators
            if (this.isHuman) {
                // 1. Green Arrow for Active
                if (this.playerArrow && player.mesh) {
                    player.mesh.add(this.playerArrow);
                    this.playerArrow.position.set(0, 3.5, 0); // Float above head
                }

                // 2. White Arrows for Others
                this.players.forEach(p => {
                    if (p.teammateArrow) {
                        p.teammateArrow.visible = (p !== player);
                    }
                });
            }
        }

resetPositions() {
            for (const p of this.players) {
                if (p.mesh) {
                    p.mesh.position.copy(p.homePosition);
                    
                    // Reset Physics
                    p.velocity.set(0, 0, 0);
                    p.inputVector.set(0, 0, 0);
                    p.isDashing = false;
                    p.isThrowing = false;
p.loseBall(); // Drop ball if holding
                    p.canCatch = true; // Force reset capability
                    
                    // Reset Stats
                    p.currentEN = p.stats.EN;
                    
// Orientation: Face Center
                    p.mesh.lookAt(0, 0, 0);
                    if (p.syncRotation) p.syncRotation();
                    
                    // Reset Animation
                    p.play('idle', 0.1);
                }
            }
            // Reset active player to MF
            const mf = this.players.find(p => p.role === 'MF');
            if (mf) this.setActivePlayer(mf);
        }
    }

    window.flux.Team = Team;
})();</script>
    <script>(function() {
    window.flux = window.flux || {};

// Reusable vectors
    const _aiVec = new THREE.Vector3();
    const _targetPos = new THREE.Vector3();
    const _scanDir = new THREE.Vector3();
    const _scanToOpp = new THREE.Vector3();

class AIPlayer extends window.flux.Player {
        constructor(scene, role) {
            super(scene, role);
            this.ballRef = null;
            
            // Stats are managed by Team/Main or default Player values.
            // No constructor overrides to ensure fair scaling and demo consistency.
            this._updateDerivedStats();

            // State Machine
            this.aiState = 'IDLE';
            this.decisionTimer = 0;
            this.decisionInterval = 0.1; // IMPROVED: Faster decisions (was 0.2)

            // --- PERCEPTION SYSTEM (Reaction Time) ---
            // The AI tracks a "ghost" target that lags behind reality.
            // This allows human players to juke/fake out the AI.
            this.perceivedTargetPos = new THREE.Vector3();
            this.reactionSpeed = 8.0; // IMPROVED: Faster reaction (was 5.0)

            // IMPROVED: Better anticipation
            this.anticipationTime = 0.4; // Lead target by this many seconds
            
            // Role Config
            this.isForward = ['LF', 'RF'].includes(role);
            this.isMidfielder = role === 'MF';
            this.isDefender = ['LD', 'RD'].includes(role);

            // Assign default techniques so AI is a threat
            this._assignDefaultTechs();
        }

        _assignDefaultTechs() {
            // Randomly assign techs based on role
const tackleTechs = ['venom', 'wither', 'drain'];
            const shootTechs = ['venom', 'sphere', 'invisible'];
            const passTechs = ['venom', 'wither', 'nap'];
            const passiveTechs = ['brawler', 'elite_defense'];

            // Helper to pick random
            const pick = (arr) => arr[Math.floor(Math.random() * arr.length)];
            const chance = (prob) => Math.random() < prob;

if (this.isDefender) {
                // Defenders love status tackles and passives
                if (chance(0.8)) this.techs.tackle = pick(tackleTechs);
                if (chance(0.3)) this.techs.pass = pick(passTechs);
                if (chance(0.5)) this.techs.passive = pick(passiveTechs);
            } else if (this.isMidfielder) {
                // Midfielders are balanced
                if (chance(0.6)) this.techs.tackle = pick(tackleTechs);
                if (chance(0.6)) this.techs.pass = pick(passTechs);
                if (chance(0.3)) this.techs.shoot = pick(shootTechs);
                if (chance(0.3)) this.techs.passive = pick(passiveTechs);
            } else if (this.isForward) {
                // Forwards focus on shooting
                if (chance(0.9)) this.techs.shoot = pick(shootTechs);
                if (chance(0.4)) this.techs.tackle = pick(tackleTechs); // Frontline pressure
                if (chance(0.2)) this.techs.passive = pick(passiveTechs);
            }
        }

update(dt) {
            // Safety: Auto-link ball if missing (Self-healing)
            if (!this.ballRef && window.flux.gameInstance && window.flux.gameInstance.entities) {
                this.ballRef = window.flux.gameInstance.entities.ball;
            }

            // 0. Check if AI logic should run
            const game = window.flux.gameInstance;
            const isDemo = game && game.isDemoMode;
            
            // Check incapacitation (Stun or Nap)
            const isIncapacitated = (this.stunTimer > 0) || (this.status.nap > 0);
            
            // AI runs if:
            // 1. It's an AI team (not human)
            // 2. It's a Human team BUT Demo Mode is ON
            // 3. It's a Human team, Demo is OFF, but this player is NOT the active controlled player
            const isHumanTeam = this.team && this.team.isHuman;
            const isActivePlayer = this.team && (this.team.activePlayer === this);
            const shouldRunAI = (!isHumanTeam || isDemo || (isHumanTeam && !isActivePlayer));
            
            // Master AI Switch for the team
            const isTeamAIEnabled = this.team ? this.team.aiEnabled : true;

            if (isIncapacitated) {
                // If stunned/sleeping, do nothing.
                this.setInput(0, 0);
            } else if (shouldRunAI && isTeamAIEnabled) {
                // --- IMPROVED PERCEPTION UPDATE ---
                // Update perceived position towards real target (Ball or Ball Holder)
                if (this.ballRef && this.ballRef.mesh) {
                    let realTarget = this.ballRef.mesh.position.clone();

                    // If ball is held, track the holder with anticipation
                    if (this.ballRef.holder && this.ballRef.holder.mesh) {
                        realTarget = this.ballRef.holder.mesh.position.clone();

                        // IMPROVED: Lead the target based on their velocity
                        if (this.ballRef.holder.velocity) {
                            realTarget.addScaledVector(this.ballRef.holder.velocity, this.anticipationTime);
                        }
                    } else if (this.ballRef.velocity) {
                        // For loose ball, anticipate based on ball velocity
                        realTarget.addScaledVector(this.ballRef.velocity, this.anticipationTime * 0.5);
                    }

                    // Lerp perception towards anticipated reality
                    const alpha = Math.min(1.0, dt * this.reactionSpeed);
                    this.perceivedTargetPos.lerp(realTarget, alpha);
                }

                // 1. Decision Making
                this.decisionTimer += dt;
                if (this.decisionTimer > this.decisionInterval) {
                    this.decisionTimer = 0;
                    this._evaluateState();
                }

                // 2. Execute State (Sets inputVector)
                this._executeState(dt);
                
                // 3. Interception Logic
                this._applyInterceptionPressure(dt);
            } else {
                // Here if:
                // 1. Controlled by Human (shouldRunAI == false)
                // 2. AI Logic is Disabled (isTeamAIEnabled == false)

                // If AI is disabled, we must stop the bot UNLESS it is being driven by human input.
                // Human input drives the player if: isHumanTeam AND isActivePlayer AND !isDemo
                const isDrivenByHuman = isHumanTeam && isActivePlayer && !isDemo;

                if (!isTeamAIEnabled && !isDrivenByHuman) {
                    this.setInput(0, 0);
                }

                // We still apply passive interception if in the way.
                this._applyInterceptionPressure(dt);
            }

            // 4. Base Update
            super.update(dt);
        }

_evaluateState() {
            if (!this.ballRef) return;
            const ball = this.ballRef;

            // 1. I have the ball
            if (this.hasBall) {
                this.aiState = 'ATTACK_CARRY';
                return;
            }

            // 2. Loose Ball Logic (Anti-Flocking)
            if (!ball.holder) {
                // Default: Return to formation. Only chase if we are the best candidate.
                this.aiState = 'RETURN_HOME';

// Hysteresis: If I was already chasing, I'm effectively "closer" to prevent jittery switching
                // This prevents two players from swapping roles rapidly when equidistant.
                const bias = (this.aiState === 'CHASE') ? 0.8 : 1.0;
                const myDist = this.mesh.position.distanceTo(ball.mesh.position) * bias;
                
                let isClosest = true;

                if (this.team && this.team.players) {
                    for (const p of this.team.players) {
                        if (p === this) continue;
                        if (!p.mesh) continue;
                        
                        // Ignore Goalie (Goalie handles their own area; field players shouldn't rely on them)
                        if (p.role === 'GL') continue;

                        // Ignore incapacitated teammates
                        if (p.status && p.status.nap > 0) continue;

                        // Calculate teammate distance
                        // Note: We don't apply bias to others, effectively making "me" stickier if I'm already chasing
                        const pDist = p.mesh.position.distanceTo(ball.mesh.position);
                        
                        // If a teammate is closer, yield to them
                        if (pDist < myDist) {
                            isClosest = false;
                            break;
                        }
                    }
}

                if (isClosest) {
                    this.aiState = 'CHASE';
                }
                return;
            }

            // 3. Teammate has ball
            if (ball.holder.team === this.team) {
                this.aiState = 'SUPPORT';
                return;
            }

            // 4. Opponent has ball
            if (ball.holder.team !== this.team) {
                this.aiState = 'DEFEND';
                return;
            }
        }

        _executeState(dt) {
            if (!this.ballRef) {
                this.setInput(0, 0);
                return;
            }

            switch (this.aiState) {
                case 'ATTACK_CARRY': this._stateAttackCarry(dt); break;
                case 'SUPPORT': this._stateSupport(dt); break;
                case 'DEFEND': this._stateDefend(dt); break;
                case 'CHASE': this._stateChase(dt); break;
                case 'RETURN_HOME': 
                default: this._stateReturnHome(dt); break;
            }
        }

        // --- STATES ---

_stateAttackCarry(dt) {
            // Drive to goal
            // Home (Side 1) attacks -Z. Away (Side -1) attacks +Z.
            const attackDir = (this.team.side === 1) ? -1 : 1;
            const goalZ = 28 * attackDir;
            
            // Target: Goal (but respect crease)
            _targetPos.set(0, 0, goalZ);
            this._avoidGoalCrease(_targetPos);
            
            // Move
            this._moveTo(_targetPos);

            // Decision: Shoot or Pass?
            const distToGoal = Math.abs(this.mesh.position.z - goalZ);
            
            // 1. Shoot if close and clear
            if (distToGoal < 20.0 && !this.isThrowing) {
                this._smartThrow(this.ballRef, 'SH'); 
                return;
            }
            
            // 2. Pass Logic
            // Check pass if: Surrounded, Low EN, or Playmaker (Midfielder) sees opportunity
            const isSurrounded = this._isSurrounded();
            const lowEN = this.currentEN < 10;
            const isPlaymaker = this.isMidfielder;
            
            if ((isSurrounded || lowEN || isPlaymaker) && !this.isThrowing) {
                const bestMate = this._findBestPassTarget();
                
                if (bestMate) {
                    // Evaluate if pass is worth it
                    // If Playmaker, pass if mate is closer to goal
                    // If Panic (Surrounded/LowEN), pass to anyone open
                    
                    let shouldPass = false;
                    
                    if (isSurrounded || lowEN) {
                        shouldPass = true;
                    } else if (isPlaymaker) {
                        const myDist = Math.abs(this.mesh.position.z - goalZ);
                        const mateDist = Math.abs(bestMate.mesh.position.z - goalZ);
                        if (mateDist < myDist - 5.0) shouldPass = true; // Mate is 5m closer
                    }
                    
                    if (shouldPass) {
                        // Face target
                        this.mesh.lookAt(bestMate.mesh.position);
                        // Execute Pass
                        this._smartThrow(this.ballRef, 'PA');
                        return;
                    }
                }
            }
            
            // 3. Panic Clear (If surrounded and no pass)
            if (isSurrounded && !this.isThrowing) {
                // Just shoot/clear
                this._smartThrow(this.ballRef, 'SH');
            }
        }

        _isSurrounded() {
            // Simple check: count enemies nearby
            let count = 0;
            const game = window.flux.gameInstance;
            if (!game) return false;
            const oppTeam = (this.team.id === 'home') ? game.teams.away : game.teams.home;
            
            for(let p of oppTeam.players) {
                if (p.mesh && p.mesh.position.distanceTo(this.mesh.position) < 4.0) {
                    count++;
                }
            }
            return count >= 2;
        }

        _smartThrow(ball, forcedType = null) {
            // Wrapper around throwBall to manage HP and Techs
            // 1. Determine intended action type
            let type = forcedType;
            if (!type) {
                const dir = new THREE.Vector3(0, 0, 1).applyQuaternion(this.mesh.quaternion);
                const attackDir = (this.team && this.team.side === 1) ? -1 : 1;
                const isAimingGoal = (dir.z * attackDir > 0.5);
                type = isAimingGoal ? 'SH' : 'PA';
            }

            // 2. Get Tech
            const techName = (type === 'SH') ? this.techs.shoot : this.techs.pass;
            
            // 3. Estimate Cost
            let baseCost = (type === 'SH') ? 20 : 10;
            let techCost = 0;
            
            if (techName) {
                // Rough estimates based on Player.js
                if (techName.includes('nap')) techCost = 30;
                else if (techName.includes('sphere') || techName.includes('invisible')) techCost = 25;
                else techCost = 20; // Venom/Wither
            }

            const totalCost = baseCost + techCost;

            // 4. Decision
            // If we have a tech but not enough HP for it, BUT enough HP for normal...
            // Disable tech temporarily to avoid "Tired" penalty (0.5x stats)
            let tempTech = null;
            if (techName && this.stats.HP < totalCost && this.stats.HP >= baseCost) {
                // Unequip
                if (type === 'SH') {
                    tempTech = this.techs.shoot;
                    this.techs.shoot = null;
                } else {
                    tempTech = this.techs.pass;
                    this.techs.pass = null;
                }
            }

            // Execute
            this.throwBall(ball, type);

            // Restore
            if (tempTech) {
                if (type === 'SH') this.techs.shoot = tempTech;
                else this.techs.pass = tempTech;
            }
        }

_stateChase(dt) {
            // Interception: Chase the PERCEIVED position, not the real one.
            // This allows jukes to work because the AI is chasing where you WERE.
            _targetPos.copy(this.perceivedTargetPos);
            
            // If ball has velocity, lead it slightly based on perception
            const ball = this.ballRef;
            if (ball.velocity.lengthSq() > 1.0) {
                _targetPos.addScaledVector(ball.velocity, 0.3);
            }
            
            this._avoidGoalCrease(_targetPos);
            this._moveTo(_targetPos);
        }

_stateReturnHome(dt) {
            // Return to formation position
            _targetPos.copy(this.homePosition);
            this._avoidGoalCrease(_targetPos);
            this._moveTo(_targetPos);
        }

_stateSupport(dt) {
            // OFFENSE (Teammate has ball)
            // Goal: Find open space to receive a pass
            const ballPos = this.ballRef.mesh.position;
            const attackDir = (this.team.side === 1) ? -1 : 1;
            const goalZ = (this.team.side === 1) ? -28 : 28;

            // 1. Determine "Ideal" Support Position
            // Start with formation home
            _targetPos.copy(this.homePosition);
            
            // 2. Dynamic Adjustment
            if (this.isForward) {
                // Forwards: Make runs towards the goal/box
                // If ball is deep, cut to center. If ball is back, push line.
                _targetPos.z = ballPos.z + (attackDir * 10.0); // Stay ahead of ball
                
                // Zig-zag run pattern based on time to look "alive"
                const time = Date.now() * 0.001;
                _targetPos.x += Math.sin(time + this.mesh.id) * 5.0;
                
            } else if (this.isMidfielder) {
                // Midfielders: Find pocket between ball and goal
                _targetPos.lerpVectors(ballPos, new THREE.Vector3(0, 0, goalZ), 0.4);
                
                // Stay wide if ball is central, come central if ball is wide
                if (Math.abs(ballPos.x) < 5) _targetPos.x = (this.homePosition.x > 0 ? 10 : -10);
                else _targetPos.x = 0;
            } else {
                // Defenders: Support from behind (safety valve)
                _targetPos.z = ballPos.z - (attackDir * 8.0);
            }

            // 3. Avoid Defenders (Raycast-ish check)
            // If a defender is near my target, shift away
            const game = window.flux.gameInstance;
            if (game) {
                const oppTeam = (this.team.id === 'home') ? game.teams.away : game.teams.home;
                for (const opp of oppTeam.players) {
                    if (opp.mesh && opp.mesh.position.distanceTo(_targetPos) < 4.0) {
                        // Defender is clogging my spot. Shift away from them.
                        const fleeDir = _targetPos.clone().sub(opp.mesh.position).normalize();
                        _targetPos.add(fleeDir.multiplyScalar(5.0));
                    }
                }
            }

            // 4. Clamp to Arena
// 4. Clamp to Arena (Keep players in bounds, and out of goal nets)
// 4. Clamp to Arena & Crease
            this._avoidGoalCrease(_targetPos);

            this._moveTo(_targetPos);
        }

_stateDefend(dt) {
            // DEFENSE (Opponent has ball)
            // Use Perceived Position for distance checks and movement
            const targetPos = this.perceivedTargetPos;
            const distToBall = this.mesh.position.distanceTo(targetPos);
            
// 1. Determine Press Range
            // Base range
            let pressRange = this.isDefender ? 15.0 : 12.0;
            
            // Aggressive Tech Usage
            if (this.techs.tackle && this.stats.HP > 20) {
                pressRange += 5.0; 
            }

            // --- ANTI-SWARM LOGIC & AGGRESSION ---
            // Only the closest defender should hard-press from distance.
            // Others should stick to their zones/marks unless the ball enters their personal space.
            let amIClosest = true;
            const myDistSq = distToBall * distToBall;
            
            if (this.team && this.team.players) {
                for(const mate of this.team.players) {
                    if (mate === this || !mate.mesh) continue;
                    // Ignore Goalie and incapacitated teammates
                    if (mate.role === 'GL' || mate.status.nap > 0 || mate.stunTimer > 0) continue;
                    
                    // Use real positions for teammate comparison (AI knows where teammates are)
                    const dSq = mate.mesh.position.distanceToSquared(targetPos);
                    if (dSq < myDistSq) {
                        amIClosest = false;
                        break;
                    }
                }
            }

            // ZOMBIE FIX: If I am the closest, I MUST CHASE.
            // Set pressRange to essentially infinite if closest, so they don't just stand there.
            if (amIClosest) {
                pressRange = 60.0; // Full field aggression
            } else {
                // If not closest, revert to Zone Defense range to prevent swarming
                pressRange = 8.0; 
            }

            // If ball is close enough (based on context), PRESS IT
// If ball is close enough (based on context), PRESS IT
            if (distToBall < pressRange) {
                _targetPos.copy(targetPos);
                this._avoidGoalCrease(_targetPos);
                this._moveTo(_targetPos);
                return;
            }

            // 2. Mark Mode (Man-to-Man)
            // If I have a mark assigned, stick to them unless pressing ball
            if (this.marking && this.marking.mesh) {
                const markPos = this.marking.mesh.position;
                
                // Position: Between mark and my goal (Goal Side)
                const myGoalZ = (this.team.side === 1) ? 28 : -28;
                
                // Vector from Mark to Goal
                const toGoal = new THREE.Vector3(0, 0, myGoalZ - markPos.z);
                const distToGoal = toGoal.length();
                toGoal.normalize();
                
                // Stand 3.5 units towards goal from the mark (Increased from 2.0 to give breathing room)
                _targetPos.copy(markPos).addScaledVector(toGoal, 3.5);
                
this._avoidGoalCrease(_targetPos);
                this._moveTo(_targetPos);
                return;
            }

            // 3. Zone Defense (Formation + Slide)
            _targetPos.copy(this.homePosition);
            
            // Slide logic (Shift formation towards ball side)
            _targetPos.z += ballPos.z * 0.6;
            
            // Defender Override: Always stay between ball and goal
            if (this.isDefender) {
                const myGoalZ = (this.team.side === 1) ? 28 : -28;
                const midpoint = (ballPos.z + myGoalZ) * 0.5;
                _targetPos.z = (_targetPos.z + midpoint) * 0.5;
            }

            // Clamp
// Clamp
            _targetPos.z = Math.max(-26.0, Math.min(26.0, _targetPos.z));
            
            this._avoidGoalCrease(_targetPos);
            this._moveTo(_targetPos);
        }

_avoidGoalCrease(targetPos) {
            // 1. Goal Crease Avoidance (Radius 10 around goals at +/- 28)
            // Matches Player.js _applyGoalCrease physics to prevent stuttering
            const goals = [
                { x: 0, z: 28 },
                { x: 0, z: -28 }
            ];
            const creaseRadius = 10.5; // Slightly larger than physics (10.0) for buffer

            goals.forEach(goal => {
                const dx = targetPos.x - goal.x;
                const dz = targetPos.z - goal.z;
                const distSq = dx*dx + dz*dz;

                if (distSq < creaseRadius * creaseRadius) {
                    // Inside crease, project to edge
                    const dist = Math.sqrt(distSq);
                    if (dist > 0.001) {
                        const ratio = creaseRadius / dist;
                        targetPos.x = goal.x + dx * ratio;
                        targetPos.z = goal.z + dz * ratio;
                    } else {
                        // Exact center, push out towards center field
                        targetPos.z = goal.z + (goal.z > 0 ? -creaseRadius : creaseRadius);
                    }
                }
            });

            // 2. Arena Boundary Clamp (Radius 32)
            const arenaRadius = 31.0; // Keep slightly inside visual/physics wall
            const dSq = targetPos.x*targetPos.x + targetPos.z*targetPos.z;
            if (dSq > arenaRadius*arenaRadius) {
                const d = Math.sqrt(dSq);
                const r = arenaRadius / d;
                targetPos.x *= r;
                targetPos.z *= r;
            }
        }

        _findBestPassTarget() {
            let bestTarget = null;
            let maxScore = -Infinity;
            
            // Attack direction & Goal Z
            const attackDir = (this.team.side === 1) ? -1 : 1; // Home attacks -Z
            const goalZ = (this.team.side === 1) ? -28 : 28;

            for (const mate of this.team.players) {
                if (mate === this) continue;
                if (!mate.mesh) continue;
                if (mate.status.nap > 0) continue; // Don't pass to sleepers
                if (mate.stunTimer > 0) continue;  // Don't pass to stunned players
                
                const dist = this.mesh.position.distanceTo(mate.mesh.position);
                if (dist < 4.0) continue;  // Too close (Reduced for tiki-taka)
                if (dist > 30.0) continue; // Too far (Increased range)
                
                // 1. Raycast Check (Is the lane clear?)
                if (this._isPathBlocked(mate.mesh.position)) continue; 
                
                // 2. Calculate Strategic Score
                let score = 0;

                // A. Forward Progress (Verticality)
                const myDistToGoal = Math.abs(this.mesh.position.z - goalZ);
                const mateDistToGoal = Math.abs(mate.mesh.position.z - goalZ);
                const progress = myDistToGoal - mateDistToGoal; // Positive if moving closer
                
                score += progress * 1.5; 
                
                // B. Goal Proximity (Absolute)
                if (mateDistToGoal < 15.0) score += 10.0;
                if (mateDistToGoal < 8.0) score += 15.0;

                // C. Openness (Space around receiver)
                const openness = this._calculateOpenness(mate);
                score += openness * 3.0; // High weight on safety

                // D. Role Bias (Forwards are prime targets)
                if (mate.isForward) score += 5.0;

                // E. Distance Penalty (Long passes are risky)
                score -= dist * 0.5;

                if (score > maxScore) {
                    maxScore = score;
                    bestTarget = mate;
                }
            }
            
            return bestTarget;
        }

        _calculateOpenness(player) {
            let minDefDist = 999;
            const game = window.flux.gameInstance;
            if (!game) return 0;
            const oppTeam = (this.team.id === 'home') ? game.teams.away : game.teams.home;

            for (const opp of oppTeam.players) {
                if (!opp.mesh || opp.status.nap > 0 || opp.stunTimer > 0) continue;
                const d = player.mesh.position.distanceTo(opp.mesh.position);
                if (d < minDefDist) minDefDist = d;
            }
            
            // Clamp: Anything beyond 8m is "Wide Open"
            return Math.min(minDefDist, 8.0);
        }

        _isPathBlocked(targetPos) {
            const start = this.mesh.position;
            const end = targetPos;
            const dist = start.distanceTo(end);
            
            // Prepare Ray Direction
            _scanDir.subVectors(end, start).normalize();
            
            const game = window.flux.gameInstance;
            if (!game) return false;
            const oppTeam = (this.team.id === 'home') ? game.teams.away : game.teams.home;
            
            // Interception radius
            const safetyRadius = 2.5; 

            for (const opp of oppTeam.players) {
                if (!opp.mesh || opp.status.nap > 0 || opp.stunTimer > 0) continue;
                
                // Vector from start to opponent
                _scanToOpp.subVectors(opp.mesh.position, start);
                
                // Project onto path
                const projection = _scanToOpp.dot(_scanDir);
                
                // Check if projection is within the segment
                if (projection > 0 && projection < dist) {
                    // Calculate perpendicular distance squared
                    // distSq = |toOpp|^2 - projection^2
                    const perpDistSq = _scanToOpp.lengthSq() - (projection * projection);
                    
                    if (perpDistSq < (safetyRadius * safetyRadius)) {
                        return true; // Blocked
                    }
                }
            }
            return false;
        }

_moveTo(target) {
            _aiVec.subVectors(target, this.mesh.position);
            _aiVec.y = 0;
            
            const distSq = _aiVec.lengthSq();

            // Deadzone: If within 1.0m (1.0 sq), stop.
            // Increased from 0.1 (0.3m) to prevent micro-adjustment spinning at destination.
            // This is crucial when targets are dynamic (e.g. relative to ball holder).
            if (distSq > 1.0) {
                _aiVec.normalize();
                this.setInput(_aiVec.x, _aiVec.z);
            } else {
                this.setInput(0, 0);
                // Braking friction to stop drift immediately upon reaching target
                this.velocity.multiplyScalar(0.8);
            }
        }

_applyInterceptionPressure(dt) {
            const ball = this.ballRef;
            if (!ball || !ball.mesh) return; // Safety check

            // 1. Basic Eligibility Checks
            // Must be free and moving
            if (ball.state !== 'free' || ball.velocity.lengthSq() < 1.0) return;
            // Cannot intercept invisible ball
            if (ball.isInvisible) return;
            // Skip if sleeping or stunned
            if (this.status.nap > 0 || this.stunTimer > 0) return;

            // 2. Range Calculation (The "Field" Radius)
            let range = 2.0; // Reduced from 3.5 to prevent "force field" feeling
            
            // Passive Techs: Brawler / Elite Defense
            if (this.techs.passive === 'brawler' || this.techs.passive === 'elite_defense') {
                range += 1.5; // Reduced boost
            }

            const dist = this.mesh.position.distanceTo(ball.mesh.position);
            if (dist > range) return;

            // 3. Directional Factor (The "Cone")
            // Vector from Ball to Defender
            _scanToOpp.subVectors(this.mesh.position, ball.mesh.position).normalize();
            const ballDir = ball.velocity.clone().normalize();
            
// Dot Product: 
            // 1.0 = Ball heading straight for defender
            // 0.0 = Passing by side (Perpendicular)
            const headingDot = ballDir.dot(_scanToOpp);
            
            // Only apply drag if ball is approaching DIRECTLY (Stricter cone)
            // Increased threshold from 0.0 to 0.7 (Must be within ~45 degrees)
            if (headingDot < 0.7) return;
            // 4. Calculate Pressure Intensity
            // Distance Factor: Closer = Stronger (Linear falloff)
            const distFactor = Math.max(0, 1.0 - (dist / range));
            
            // Angle Factor: Direct hit = 1.0, Glancing = 0.4
            const angleFactor = Math.max(0.3, headingDot);

            // BL Stat
            const bl = this.getStat('BL');
            
            // Total Pressure (PA/SH drain per second)
            // Base multiplier for stats (Reduced from 6.0 to 3.0)
            const pressureMultiplier = 3.0; 
            const pressure = bl * distFactor * angleFactor * pressureMultiplier * dt;

            // 5. Apply to Ball Stats (PA/SH)
            if (ball.power > 0) {
                ball.power -= pressure;
                
                // Visual Feedback (Accumulator)
                this._accumulatedBlock = (this._accumulatedBlock || 0) + pressure;
                // Show floating text every 5 points drained
                if (this._accumulatedBlock >= 5.0) { 
                    const val = Math.floor(this._accumulatedBlock);
                    this._accumulatedBlock -= val;
                    
                    if (window.flux.gameInstance.floatingText) { 
                         // Spawn on ball, attach to ball
                         window.flux.gameInstance.floatingText.spawn(`-${val}`, ball.mesh.position, "block", ball.mesh);
                    }
                }
            }

// 6. Apply Physical Drag - REMOVED
            // The ball now passes through defenders without slowing down physically.
            // Only stats (Power) are drained.

            // 7. Visuals: The "Tether" / Interference Field
            // Spawn sparks between ball and defender to show the field effect
            if (Math.random() < (distFactor * 0.8)) { 
                const mid = this.mesh.position.clone().lerp(ball.mesh.position, 0.5 + (Math.random()-0.5)*0.2);
                // Jitter
                mid.x += (Math.random()-0.5) * 0.5;
                mid.y += (Math.random()-0.5) * 0.5;
                mid.z += (Math.random()-0.5) * 0.5;
                
                if (window.flux.gameInstance.spawnClash) {
                    window.flux.gameInstance.spawnClash(mid, 0.6); // Spark
                }
            }

            // 8. Shot Stop / Block Logic
            if (ball.power <= 0 && ball.powerType === 'SH') {
                ball.powerType = 'none'; // Neutralize shot
                
                // NO DEFLECTION: The ball continues on its path.
                // It is now a "dead ball" (no power) but keeps moving.
                
                if (window.flux.gameInstance.floatingText) { 
                    window.flux.gameInstance.floatingText.spawn("BLOCKED", this.mesh.position, "comic-impact");
                }
                // No impact freeze to keep flow smooth
            }

            // 9. Status Risk (Venom/Nap/Wither on Ball)
            if (ball.technique && !this._techApplied) {
                this._techApplied = true;
                const tech = ball.technique;
                
                if (tech.type === 'venom') {
                    this.applyStatus('venom', 15.0);
                } else if (tech.type === 'nap') {
                    this.applyStatus('nap', 8.0);
                } else if (tech.type === 'wither') {
                    this.applyStatus('wither', 15.0, 'BL');
                }
                
                setTimeout(() => { this._techApplied = false; }, 2000);
            }
        }
    }

    window.flux.AIPlayer = AIPlayer;
})();</script>
    <script>(function() {
    window.flux = window.flux || {};
    
    // Reusable vectors to avoid GC
const _gVec = new THREE.Vector3();
    const _gPos = new THREE.Vector3();
    const _ballPos = new THREE.Vector3();
    const _faceVec = new THREE.Vector3();
    const _goalCenter = new THREE.Vector3();
    const _tempVecG = new THREE.Vector3();

    class Goalie extends window.flux.Player {
constructor(scene, role) {
            super(scene, role);
            
            // Goalie Specific Stats (Buffed for Playability)
            this.stats.CA = 30; // Catch
            this.stats.SP = 40; // Speed
            this.stats.EN = 50;
            
            // BUFFED: Strong arm for clearing the zone
            this.stats.PA = 45; // Was 20 - Now strong enough to reach midfield
            this.stats.SH = 35; // Was 10 - Decent clearance kick
            
            this._updateDerivedStats();

            // Goal Dimensions (Save Box)
// Goal Dimensions (Save Box) - Matches GameManager detection
this.goalWidth = 33.0; // Increased 50% (was 22.0)
            this.goalHeight = 27.0; // Increased 50% (was 18.0)
            
            // Save Mechanics
            this.saveRadius = 6.0; 
            this.pressureMultiplier = 5.0; 
            
            // Techs
            this.techs = {
                active: null, 
                passive: null 
            };
            
            // AI State
            this.throwTimer = 0;
            this._accumulatedSave = 0;
            
            // Super Goalie State
            this.isSuperGoalie = false;
            this.superGoalieTimer = 0;
        }

update(dt) {
            // 1. Super Goalie Timer
            if (this.isSuperGoalie) {
                this.superGoalieTimer -= dt;
                if (this.superGoalieTimer <= 0) {
                    this.isSuperGoalie = false;
                }
            }
            
            // 2. Possession Logic (Ball Held)
            if (this.hasBall) {
                this._checkTacklePressure(dt);
                
                const game = window.flux.gameInstance;
                const isHumanControlled = this.team && this.team.isHuman && this.team.activePlayer === this && !game.isDemoMode;
                
                if (isHumanControlled) {
                    // Human: Full control (Rotation, Charging, etc via Player.update)
                    super.update(dt);
                } else {
                    // AI: Logic then update
                    if (!this.isThrowing) {
                        this._aiPossessionLogic(dt);
                    }
                    // Ensure AI doesn't drift
                    this.setInput(0, 0);
                    super.update(dt);
                }
                this._constrainBounds();
                return; 
            }

            // 3. Defense / Save Logic (No Ball)
            // We must handle timers and status manually because we skip super.update() to use custom movement
            if (this.dashCooldown > 0) this.dashCooldown -= dt;
            if (this.clashCooldown > 0) this.clashCooldown -= dt;
            if (this.stunTimer > 0) this.stunTimer -= dt;
            if (this.immunityTimer > 0) this.immunityTimer -= dt;

            this._updateStatus(dt);

            if (this.stunTimer > 0 || this.status.nap > 0) {
                if (this.mixer) this.mixer.update(dt);
                this._updateHPBar();
                this._constrainBounds();
                return;
            }

            // Custom Movement
            this._defenseLogic(dt);
            
            // Update Animation
            if (this.mixer) this.mixer.update(dt);
            this._updateHPBar();
            
            this._constrainBounds();
        }

_constrainBounds() {
            if (!this.mesh) return;
            const pos = this.mesh.position;
            const side = this.team ? this.team.side : 1;
            
            // X Bounds (Width of penalty area +/- 10m) -> Increased for massive goal
            const xLimit = 30.0; // Max width of arena (Radius 32)
            if (pos.x > xLimit) { pos.x = xLimit; this.velocity.x = 0; }
            if (pos.x < -xLimit) { pos.x = -xLimit; this.velocity.x = 0; }
            
// Y Bounds (Height +/- 15m) -> Increased for massive goal high saves
            const yLimit = 22.5; // Increased 50% (was 15.0)
            if (pos.y > yLimit) { pos.y = yLimit; this.velocity.y = 0; }
            if (pos.y < -yLimit) { pos.y = -yLimit; this.velocity.y = 0; }
            
            // Z Bounds (Depth)
            // Home (Side 1): Goal at +28. Trigger at 27. Limit to 26.5 to prevent walking in.
            // Away (Side -1): Goal at -28. Trigger at -27. Limit to -26.5.
            if (side === 1) {
                if (pos.z > 26.5) { pos.z = 26.5; this.velocity.z = 0; }
                if (pos.z < 12.0) { pos.z = 12.0; this.velocity.z = 0; }
            } else {
                if (pos.z < -26.5) { pos.z = -26.5; this.velocity.z = 0; }
                if (pos.z > -12.0) { pos.z = -12.0; this.velocity.z = 0; }
            }
        }

// Override throwBall to fix "weak throw" issue
// Override throwBall to fix "weak throw" issue
        throwBall(ball, forcedType = null, powerMultiplier = 1.0) {
            // Goalies almost always PASS, even when "clearing" forward.
            // The default Player logic switches to 'SH' (Shoot) if aiming forward, 
            // which uses the Goalie's lower SH stat. We force PA unless specified.
            const type = forcedType || 'PA';
            
            // BOOST: Apply a multiplier to ensure the goalie can clear the ball to midfield.
            // NERFED: Reduced from 1.6 to 1.2 to prevent cross-map throws as per user feedback.
            const boost = 1.2;

            super.throwBall(ball, type, powerMultiplier * boost);
        }

_defenseLogic(dt) {
            // 0. Game State Check
            if (window.flux.gameInstance.state !== 'active') return;

            const ball = window.flux.gameInstance.entities.ball;
            if (!ball || !ball.mesh) return;

            // Determine Threat Source
            let threatPos = _ballPos;
            let isThreat = false;
            const myGoalZ = (this.team.side === 1) ? 28 : -28;

            // Case A: Ball is Held (Pre-throw)
            if (ball.state === 'held' && ball.holder && ball.holder.team !== this.team) {
                threatPos = ball.holder.mesh.position;
                
                // Check if holder is in attacking half or near enough
                const distToGoal = Math.abs(threatPos.z - myGoalZ);
                if (distToGoal < 40.0) { // If they are within 40m, track them
                    isThreat = true;
                }
            } 
            // Case B: Ball is Free (Shot/Pass)
            else if (ball.state === 'free') {
                threatPos = ball.mesh.position;
                
                // Direction Check
                const movingTowards = (this.team.side === 1 && ball.velocity.z > 0) || 
                                      (this.team.side === -1 && ball.velocity.z < 0);
                
                // Position Check
                const inFrontOfGoal = (this.team.side === 1 && threatPos.z < 27.5) || 
                                      (this.team.side === -1 && threatPos.z > -27.5);

                isThreat = movingTowards && inFrontOfGoal;
            }

            if (isThreat) {
                // --- POSITIONING: ANGLE CUTTING ---
                _ballPos.copy(threatPos); // Update reference for lookAt
                
                // 1. Calculate Goal Center
// 1. Calculate Goal Center (Adjusted for Y offset)
                _goalCenter.set(0, -2.2, myGoalZ);
                
                // 2. Vector from Goal to Ball
                _tempVecG.subVectors(_ballPos, _goalCenter);
                const distToBall = _tempVecG.length();
                _tempVecG.normalize(); // Now holds direction
                
                // 3. Determine Extension (How far out to step)
                // Base: 1.5m off line.
                // Max: 6.0m off line (Cutting angle).
                // Scale based on ball proximity: Closer ball = More extension (to a point)
let extension = 1.5;
                if (distToBall < 30.0) {
                    const ratio = 1.0 - (Math.max(0, distToBall - 5.0) / 25.0); 
                    extension = 1.5 + (4.5 * ratio); 
                }
                
// Safety: Don't go past the ball (keep 1m buffer)
                extension = Math.min(extension, distToBall - 1.0);
                
                // 4. Calculate Target Position (Base Interception)
                _gPos.copy(_goalCenter).add(_tempVecG.multiplyScalar(extension));
                
                // 5. Vertical Override (Jump to meet ball)
                // Explicitly set Y to match ball height if it's high
                if (_ballPos.y > 0.5) {
                    _gPos.y = _ballPos.y;
                } else {
                    _gPos.y = 0.5; // Default stance
                }

                // 6. Clamp to Goal Box Dimensions (Lateral/Vertical Limits)
                // Goal Width 22 (+/- 11), Height 18 (+/- 9).
                // Allow slightly outside posts to cover angles.
                const clampX = this.goalWidth * 0.6; // +/- 13.2
const clampY = 21.0; // Allow high jumps up to 21m (was 14.0)
                
                _gPos.x = Math.max(-clampX, Math.min(clampX, _gPos.x));
                _gPos.y = Math.max(-clampY, Math.min(clampY, _gPos.y));
                
                // 6. Lead the ball slightly if it has lateral velocity (Anticipation)
if (ball.velocity.lengthSq() > 1.0) {
                    const anticipation = ball.velocity.clone().multiplyScalar(0.25); // 0.25s lead
                    anticipation.z = 0; // Only lateral lead
                    _gPos.add(anticipation);
                }

                // CLAMP Z: Prevent Goalie from going into the net or behind goal
// CLAMP Z: Prevent Goalie from going into the net or behind goal
                if (this.team.side === 1) {
                    _gPos.z = Math.min(26.5, _gPos.z);
                } else {
                    _gPos.z = Math.max(-26.5, _gPos.z);
                }

                // Move towards target
                const moveDir = _gVec.subVectors(_gPos, this.mesh.position);
                const distToTarget = moveDir.length();
                
                if (distToTarget > 0.1) {
                    moveDir.normalize();
                    // Burst speed for saves if ball is close
                    const urgency = (distToBall < 10.0) ? 1.5 : 1.0;
                    const speed = this.maxSpeed * urgency;
                    
                    this.mesh.position.add(moveDir.multiplyScalar(speed * dt));
                    
                    // Face ball
                    this.mesh.lookAt(_ballPos);
                    
                    if (this.state !== 'swim') this.play('swim', 0.2);
                } else {
                    if (this.state !== 'idle') this.play('idle', 0.2);
                    this.mesh.lookAt(_ballPos);
                }

                // --- SAVE MECHANIC ---
                // If ball is within range, apply CA pressure
                const dist = this.mesh.position.distanceTo(ball.mesh.position);
                if (dist < this.saveRadius) { 
                    this._applySavePressure(ball, dt);
                }
            } else {
                // --- IDLE / RETURN TO POST ---
                // Return to home position (usually center of goal)
                _gPos.copy(this.homePosition);
                const moveDir = _gVec.subVectors(_gPos, this.mesh.position);
                
                if (moveDir.length() > 0.5) {
                    moveDir.normalize();
                    this.mesh.position.add(moveDir.multiplyScalar(this.maxSpeed * 0.6 * dt));
                    if (this.state !== 'swim') this.play('swim', 0.2);
                } else {
                    if (this.state !== 'idle') this.play('idle', 0.2);
                }
                
                // Face center field
                this.mesh.lookAt(0, 0, 0);
            }
        }

        _applySavePressure(ball, dt) {
            // If Goalie is Asleep, they cannot save.
            if (this.status.nap > 0) return;

            // --- SUPER GOALIE TRIGGER ---
            // Trigger if: Tech equipped, Not active, Ball has power, Ball is close
            if (this.techs.active === 'super_goalie' && !this.isSuperGoalie && ball.power > 5.0) {
                // Chance to trigger (High chance for AI, or check HP)
                // Cost: 10 HP
                if (this.stats.HP >= 10) {
                    this.stats.HP -= 10;
                    this.isSuperGoalie = true;
                    this.superGoalieTimer = 1.5; // Lasts 1.5s
                    
                    console.log(`${this.role} used SUPER GOALIE!`);
                    if (window.flux.gameInstance.floatingText) {
                        window.flux.gameInstance.floatingText.spawn("SUPER GOALIE!", this.mesh.position, "save");
                    }
                    
                    // Trigger Techcopy Event
                    if (window.flux.gameInstance && window.flux.gameInstance.triggerTechEvent) {
                        window.flux.gameInstance.triggerTechEvent(this, 'super_goalie');
                    }
                }
            }

            // Calculate Effective CA
            let ca = this.getStat('CA');
            
            // Apply Super Goalie Bonus (e.g. +50% + Flat 10)
            if (this.isSuperGoalie) {
                ca = (ca * 1.5) + 10;
            }
            
            // Apply Grip Gloves (Passive)
            if (this.techs.passive === 'grip_gloves') {
                ca += 5;
            }

            // Calculate Pressure
            // Pressure = CA * dt * Multiplier
            const pressure = ca * dt * this.pressureMultiplier;
            
            if (ball.power > 0) {
                ball.power -= pressure;
                
                // Visual Feedback
                this._accumulatedSave += pressure;
                // THROTTLE: Increased threshold to 12.0
                if (this._accumulatedSave >= 12.0) { 
                    if (window.flux.gameInstance.floatingText) {
                        window.flux.gameInstance.floatingText.spawn("BLOCK!", this.mesh.position, "comic-impact");
                    }
                    this._accumulatedSave = 0;
                }
            }

            // Apply Ball Technique to Goalie (Risk of catching special shots)
            if (ball.technique && !this._techApplied) {
                this._techApplied = true;
                const tech = ball.technique;
                
                if (tech.type === 'venom') {
                    this.applyStatus('venom', 15.0);
                } else if (tech.type === 'nap') {
                    this.applyStatus('nap', 8.0);
                } else if (tech.type === 'wither') {
                    this.applyStatus('wither', 15.0, 'CA');
                }
                setTimeout(() => { this._techApplied = false; }, 2000);
            }

            // Check Result
            if (ball.power <= 0) {
                // CATCH
                this.catchBall(ball);
            } 
        }

        catchBall(ball) {
            ball.grab(this);
            this.play('catch', 0.1);
            console.log("SAVED by " + this.role);
            
            // EXP REWARD: Save
            this.gainExp(5);

            if (window.flux.gameInstance.floatingText) {
                window.flux.gameInstance.floatingText.spawn("SAVED!", this.mesh.position, "comic-impact");
            }
            if (window.flux.gameInstance.triggerImpact) window.flux.gameInstance.triggerImpact(0.15, 'heavy');
            
            // Reset throw timer
            this.throwTimer = 0;
        }

_aiPossessionLogic(dt) {
            this.throwTimer += dt;
            
            // Hold for a moment (1.5s) then throw
            if (this.throwTimer > 1.5) {
                // Find best target: Prefer MF or Defenders, but must be somewhat distant to avoid "handoff" look
                // Filter for teammates > 8 units away if possible
                const validMates = this.team.players.filter(p => 
                    p !== this && 
                    p.mesh && 
                    p.mesh.position.distanceTo(this.mesh.position) > 8.0
                );

                let target = null;

                // Priority 1: Midfielder (Playmaker)
                target = validMates.find(p => p.role === 'MF');
                
                // Priority 2: Defenders
                if (!target) target = validMates.find(p => p.role === 'LD' || p.role === 'RD');
                
                // Priority 3: Anyone open (fallback to close range if no one is far)
                if (!target) target = this.team.players.find(p => p !== this && p.role !== 'GL');

                if (target && target.mesh) {
                    // AIMING LOGIC: Loft the pass
                    // Look at target, but aim slightly up to create an arc
                    const targetPos = target.mesh.position.clone();
                    
                    // Calculate distance
                    const dist = this.mesh.position.distanceTo(targetPos);
                    
                    // Loft factor: The further away, the higher we aim
                    // 20 units away -> Aim 5 units above head
                    const loft = Math.max(1.0, dist * 0.25);
                    targetPos.y += loft;

                    this.mesh.lookAt(targetPos);
                    
                    // Throw
                    const ball = window.flux.gameInstance.entities.ball;
                    this.throwBall(ball, 'PA'); 
                    console.log(`${this.role} throws to ${target.role} (Dist: ${dist.toFixed(1)})`);
                } else {
                    // Clear it forward
                    this.mesh.lookAt(0, 5, 0); // Aim up-center
                    const ball = window.flux.gameInstance.entities.ball;
                    this.throwBall(ball, 'SH'); // Hard clear
                }
                
                this.throwTimer = 0;
            }
        }
    }

    window.flux.Goalie = Goalie;
})();</script>
    <script>(function() {
    window.flux = window.flux || {};

    // Reusable math vectors to avoid GC
const _bVec = new THREE.Vector3();
    const _axisY = new THREE.Vector3(0, 1, 0);
    const _tempVec = new THREE.Vector3();
    const _magnusVec = new THREE.Vector3();

// Physics Configuration (Exposed for DevTools)
window.flux.BallConfig = {
        WATER_DRAG: 0.1,      // Low drag for distance
        SPIN_DRAG: 0.15,      // Reduced from 0.3 so curves last longer
        MAGNUS_COEFF: 0.8,    // Increased from 0.5 for punchier curves
BOUNDARY_RADIUS: 33.0, // Slightly larger than visual arena (32) to prevent early clipping
        BOUNDARY_HEIGHT: 15.0, // Vertical Limit (+/- Y)
        GRAVITY_SPRING: 1.0,   // Reduced from 5.0 (Gentle depth correction)
        GRAVITY_DAMP: 1.5
    };

    
    const C = window.flux.BallConfig; // Local alias for brevity
    // --- TRAIL RENDERER ---
    class TrailRenderer {
        constructor(scene) {
            this.scene = scene;
            this.segments = 25;
this.points = [];
this.width = 0.38; // Scaled to match smaller ball (15% reduction)
            // Geometry
            const geometry = new THREE.BufferGeometry();
            const posData = new Float32Array(this.segments * 2 * 3);
            geometry.setAttribute('position', new THREE.BufferAttribute(posData, 3));
            
            // Indices
            const indices = [];
            for (let i=0; i<this.segments-1; i++) {
                const base = i*2;
                indices.push(base, base+1, base+2);
                indices.push(base+1, base+3, base+2);
            }
            geometry.setIndex(indices);
            
this.material = new THREE.MeshBasicMaterial({
                color: 0x00aaff,
                side: THREE.DoubleSide,
                transparent: true,
                opacity: 0.5,
                blending: THREE.AdditiveBlending,
                depthWrite: false
            });
            
            this.mesh = new THREE.Mesh(geometry, this.material);
            this.mesh.frustumCulled = false;
            this.scene.add(this.mesh);
            
            // Init points
            for(let i=0; i<this.segments; i++) this.points.push(new THREE.Vector3());
            this.active = false;
        }
        
        reset(pos) {
            for(let i=0; i<this.segments; i++) this.points[i].copy(pos);
            this.updateGeometry();
        }
        
        setColor(hex) {
            this.material.color.setHex(hex);
        }
        
        update(currentPos) {
            if (!this.active) {
                this.reset(currentPos);
                return;
            }

            // Shift points
            for (let i = this.segments - 1; i > 0; i--) {
                this.points[i].copy(this.points[i-1]);
            }
            this.points[0].copy(currentPos);
            
            this.updateGeometry();
        }
        
        updateGeometry() {
            const positions = this.mesh.geometry.attributes.position.array;
            const cam = window.flux.gameInstance ? window.flux.gameInstance.camera : null;
            if (!cam) return;
            const camPos = cam.position;
            
            const tempDir = new THREE.Vector3();
            const tempToCam = new THREE.Vector3();
            const tempRight = new THREE.Vector3();

            for (let i=0; i<this.segments; i++) {
                const p = this.points[i];
                
                // Taper width
                const w = this.width * (1 - (i / this.segments));
                
                // Calculate direction
                if (i < this.segments - 1) {
                    tempDir.subVectors(this.points[i], this.points[i+1]);
                } else {
                    tempDir.subVectors(this.points[i-1], this.points[i]);
                }
                
                if (tempDir.lengthSq() < 0.0001) tempDir.set(0, 1, 0);
                tempDir.normalize();
                
                tempToCam.subVectors(camPos, p).normalize();
                tempRight.crossVectors(tempDir, tempToCam).normalize().multiplyScalar(w);
                
                // Vert 1
                positions[i*6 + 0] = p.x - tempRight.x;
                positions[i*6 + 1] = p.y - tempRight.y;
                positions[i*6 + 2] = p.z - tempRight.z;
                
                // Vert 2
                positions[i*6 + 3] = p.x + tempRight.x;
                positions[i*6 + 4] = p.y + tempRight.y;
                positions[i*6 + 5] = p.z + tempRight.z;
            }
            this.mesh.geometry.attributes.position.needsUpdate = true;
        }
    }

class Ball {

        constructor(scene) {
            this.scene = scene;
            this.mesh = null;
            this.holder = null; 
            this.lastHolder = null; // Track who threw it last (for EXP/Assists)
            
            this.velocity = new THREE.Vector3(0, 0, 0);
            this.angularVelocity = new THREE.Vector3(0, 0, 0);
            this.state = 'free'; // 'free', 'held', 'magnetized'
            this.isInvisible = false;

            // Continuous Stats
            this.power = 0;      // Current PA or SH value
            this.powerType = 'none'; // 'PA' or 'SH'
            this.decayRate = 3.0; // Stat points lost per second (Water resistance)
            this.catchGracePeriod = 0; // Time before ball can be caught again

            // Magnet System
            this.magnetTarget = null;
            this.magnetTimer = 0;
            this.magnetDuration = 0.2; 
            this.magnetStartPos = new THREE.Vector3();
            this.magnetStartVel = new THREE.Vector3();

            // Visuals (Squash & Stretch)
            this.accumulatedRotation = new THREE.Quaternion();
            this.deformNode = null;
            this.spinNode = null;
            this.model = null;

this.initMesh();
            this.trail = new TrailRenderer(scene);
            this._bubbleTimer = 0;
}
initMesh() {
            // Hierarchy: Mesh (Pos) -> Deform (Squash/Stretch) -> Spin (Rotation) -> Model
            this.mesh = new THREE.Group();
            this.scene.add(this.mesh);

            this.deformNode = new THREE.Group();
            this.deformNode.position.y = -1.4; // Visual offset: Lowered significantly per request (was -0.9)
            this.mesh.add(this.deformNode); // Fix: Add deformNode to mesh

            this.spinNode = new THREE.Group();
            this.deformNode.add(this.spinNode);

            // Procedural Placeholder Texture (Blitzball-ish)
            const placeholderTex = (() => {
                const c = document.createElement('canvas');
                c.width = 128; c.height = 64;
                const ctx = c.getContext('2d');
                ctx.fillStyle = '#eeeeee';
                ctx.fillRect(0,0,128,64);
                
                // Blue bumps/details
                ctx.fillStyle = '#0088ff';
                for(let i=0; i<6; i++) {
                    ctx.beginPath();
                    ctx.arc(i*25, 32, 10, 0, Math.PI*2);
                    ctx.fill();
                }
                ctx.fillStyle = '#004488';
                ctx.fillRect(0, 28, 128, 8); // Stripe
                
                return new THREE.CanvasTexture(c);
            })();

            // Placeholder Visual (Immediate feedback, persists until valid model loads)
// Placeholder Visual (Immediate feedback, persists until valid model loads)
// Placeholder Visual (Immediate feedback, persists until valid model loads)
const geometry = new THREE.SphereGeometry(0.3, 16, 16); // Scaled down ~15%
            const material = new THREE.MeshBasicMaterial({
                map: placeholderTex,
                color: 0xffffff, 
                wireframe: false, // Solid
                transparent: false,
                opacity: 1.0
            });
            this.placeholder = new THREE.Mesh(geometry, material);

            // Load GLB Model
            const url = 'https://cdn.tinyglb.com/models/521ae8788e584e378a79d9732a075356.glb';
            
            window.flux.AssetLoader.loadModel(url, (gltf) => {
                console.log("DEBUG: Ball GLB loaded.", gltf);
                
                const model = gltf.scene;

                // 1. Reset root transforms
                model.position.set(0, 0, 0);
                model.rotation.set(0, 0, 0);
                model.scale.set(1, 1, 1);
                model.updateMatrixWorld(true);

                // 2. Harden Materials & Visibility
                model.traverse((node) => {
                    if (node.isMesh) {
                        node.castShadow = false;
                        node.receiveShadow = false;
                        node.frustumCulled = false; // CRITICAL: Prevent culling if bounds are off
                        
                        if (node.material) {
                            const mats = Array.isArray(node.material) ? node.material : [node.material];
                            mats.forEach(m => {
                                m.color.setHex(0xffffff); // Force white base
                                m.side = THREE.DoubleSide;
                                m.transparent = false;
                                m.opacity = 1.0;
                                m.alphaTest = 0; // CRITICAL: Disable alpha test to prevent culling
                                m.depthWrite = true;
                                m.depthTest = true;
                            });
                        }
                    }
                });

                // 3. Compute Bounding Box
                const box = new THREE.Box3().setFromObject(model);
                const size = new THREE.Vector3();
                box.getSize(size);
                const center = new THREE.Vector3();
                box.getCenter(center);

                // 4. Validation
                const maxDim = Math.max(size.x, size.y, size.z);
                if (maxDim <= 0.001 || !isFinite(maxDim)) {
                    console.warn("Ball model has invalid dimensions. Keeping placeholder.");
                    return; 
                }

                // 5. Calculate Scale
// 5. Calculate Scale
const targetDiameter = 0.72; // Reduced scale by ~15% (was 0.85)
                const scaleFactor = targetDiameter / maxDim;

                // 6. Apply Transforms
                model.scale.setScalar(scaleFactor);
                model.position.copy(center).multiplyScalar(-scaleFactor);

                // 7. Swap Placeholder
                if (this.placeholder) {
                    this.spinNode.remove(this.placeholder);
                    if (this.placeholder.geometry) this.placeholder.geometry.dispose();
                    this.placeholder = null;
                }

                this.model = model;
                this.spinNode.add(this.model);
                console.log(`Blitzball model attached. Scale: ${scaleFactor.toFixed(4)}`);

            }, undefined, (err) => {
                console.error("Failed to load Blitzball model:", err);
                // Fallback: Keep placeholder but tint it red to indicate error
                if (this.placeholder) {
                    this.placeholder.material.color.setHex(0xffaaaa);
                }
            });
        }

update(dt) {
            if (!this.mesh) return;

            // Safety: Reset if position corrupted
            if (isNaN(this.mesh.position.x) || isNaN(this.mesh.position.y) || isNaN(this.mesh.position.z)) {
                this.reset();
                return;
            }

            // Safety: Fix "Unpickable Ball" Bug
            // If state is 'held' or 'magnetized' but the actor is missing/invalid, force drop to 'free'.
            if (this.state === 'held' && (!this.holder || !this.holder.mesh)) {
                this.drop();
            }
            if (this.state === 'magnetized' && (!this.magnetTarget || !this.magnetTarget.mesh)) {
                this.drop();
            }
if (this.trail) {
                // Trail is active if ball is moving fast and free
                const speed = this.velocity.length();
                this.trail.active = (this.state === 'free' && speed > 2.0);
                
                // Fix: Offset trail to match visual model position (deformNode offset)
                _bVec.copy(this.mesh.position);
                if (this.deformNode) _bVec.y += this.deformNode.position.y;

                this.trail.update(_bVec);
            }

            if (this.state === 'held' && this.holder && this.holder.mesh) {
                this.updateHeld(dt);
            } else if (this.state === 'magnetized') {
                this.updateMagnetized(dt);
            } else {
                this.updateFree(dt);
            }
            
            if (this.catchGracePeriod > 0) {
                this.catchGracePeriod -= dt;
            }

this.updateVisuals(dt);
            
            // Safety: Ensure visibility if not explicitly invisible
// Safety: Ensure visibility if not explicitly invisible
            if (this.mesh && !this.isInvisible) {
                this.mesh.visible = true;
                // Force model visibility if present (sometimes GLTF loader hides it)
                if (this.model) this.model.visible = true;
            }
        }

magnetize(target) {
            if (this.state === 'magnetized' || this.state === 'held') return;
            
            this.state = 'magnetized';
            this.magnetTarget = target;
            this.holder = target; // Logical possession so AI reacts
            this.magnetTimer = 0;
            this.magnetStartPos.copy(this.mesh.position);
            this.magnetStartVel.copy(this.velocity);
            
            // Dynamic Duration based on distance (Smoother for long range, snappy for close)
            const dist = this.mesh.position.distanceTo(target.mesh.position);
            this.magnetDuration = Math.max(0.15, Math.min(0.4, dist / 15.0));
            
            // Kill physics
            this.velocity.set(0, 0, 0);
            this.angularVelocity.set(0, 0, 0);

            // Notify player immediately so they stop chasing and play animation
            if (target.receiveBall) {
                target.receiveBall();
            }

            this.reveal();
        }

updateMagnetized(dt) {
            if (!this.magnetTarget || !this.magnetTarget.mesh) {
                this.drop();
                return;
            }

            this.magnetTimer += dt;
            
            // Normalized Time
            let t = this.magnetTimer / this.magnetDuration;
            if (t > 1.0) t = 1.0;

            // Target "Virtual Hand" Position (Front of Chest)
            const holderPos = this.magnetTarget.mesh.position;
            const holderQuat = this.magnetTarget.mesh.quaternion;
            
            // Offset: Forward 0.6, Up 1.0 (Chest height)
            const offset = _bVec.set(0, 1.0, 0.6).applyQuaternion(holderQuat);
            const targetPos = offset.add(holderPos);

            // --- QUADRATIC BEZIER CURVE ---
            // P0 = Start, P2 = Target
            // P1 = Control Point (Projected along initial velocity to preserve momentum feel)
            
            const p0 = this.magnetStartPos;
            const p2 = targetPos;
            
            // Calculate P1 (Control Point)
            // Project forward from P0 along start velocity vector
            // Distance of projection = 40% of total distance to target
            const dist = p0.distanceTo(p2);
            const p1 = _tempVec.copy(p0);
            
            const velLen = this.magnetStartVel.lengthSq();
            if (velLen > 1.0) {
                // Use velocity tangent
                const dir = this.magnetStartVel.clone().normalize();
                p1.add(dir.multiplyScalar(dist * 0.4));
            } else {
                // No velocity (stationary ball), arc upwards slightly
                p1.lerp(p2, 0.5);
                p1.y += 1.5; 
            }

            // Bezier: B(t) = (1-t)^2 * P0 + 2(1-t)t * P1 + t^2 * P2
            const oneMinusT = 1.0 - t;
            const w0 = oneMinusT * oneMinusT;
            const w1 = 2.0 * oneMinusT * t;
            const w2 = t * t;
            
            this.mesh.position.x = (w0 * p0.x) + (w1 * p1.x) + (w2 * p2.x);
            this.mesh.position.y = (w0 * p0.y) + (w1 * p1.y) + (w2 * p2.y);
            this.mesh.position.z = (w0 * p0.z) + (w1 * p1.z) + (w2 * p2.z);

            // Finish
            if (t >= 1.0) {
                this.grab(this.magnetTarget);
            }
        }

updateHeld(dt) {
            // ATTACHED STATE (Virtual Attachment)
            if (!this.holder || !this.holder.mesh) {
                this.drop();
                return;
            }

            this.velocity.set(0, 0, 0);
            this.angularVelocity.set(0, 0, 0);

            // 1. Try to use Hand Bone if available (Realism)
            if (this.holder.handBone) {
                // Get world position of the hand bone
                this.holder.handBone.getWorldPosition(this.mesh.position);
                
                // Adjust slightly to sit IN the hand rather than ON the wrist
                // We can't easily know "forward" for the bone without more info, 
                // but usually GLTF bones are oriented. For now, exact bone pos is better than chest.
            } else {
                // 2. Fallback: Calculate "Carrying" Position (Right Hand Side)
                // Relative to player: Up 0.8 (Waist/Chest), Right 0.4, Forward 0.5
                const holderPos = this.holder.mesh.position;
                const holderQuat = this.holder.mesh.quaternion;
                
                // Reuse _bVec
                // Offset: x=0.35 (Right), y=0.9 (Lower Chest), z=0.5 (Forward)
                _bVec.set(0.35, 0.9, 0.5).applyQuaternion(holderQuat);
                this.mesh.position.copy(holderPos).add(_bVec);
            }

// Visual Flair: Spin the ball slowly
            const rotX = new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1,0,0), 2 * dt);
            const rotY = new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0), 5 * dt);
            this.accumulatedRotation.multiply(rotX).multiply(rotY);
        }

updateFree(dt) {
            // PHYSICS STATE
            const C = window.flux.BallConfig;
            
            // 1. Magnus Effect (Curve)
            // Force = Spin x Velocity
            if (this.angularVelocity.lengthSq() > 0.1 && this.velocity.lengthSq() > 0.5) {
                _magnusVec.copy(this.angularVelocity).cross(this.velocity).multiplyScalar(C.MAGNUS_COEFF * dt);
                this.velocity.add(_magnusVec);
                
                // Decay Spin
                const spinDrag = Math.max(0, 1 - (C.SPIN_DRAG * dt));
                this.angularVelocity.multiplyScalar(spinDrag);
            }

            // 2. Vertical Restoring Force (Playable Depth Constraint)
            // Keeps ball near Y=0 to prevent it getting lost above/below players
            const yPos = this.mesh.position.y;
            
            this.velocity.y -= yPos * C.GRAVITY_SPRING * dt;
            this.velocity.y *= Math.max(0, 1 - (C.GRAVITY_DAMP * dt));

            // 3. Move
            _tempVec.copy(this.velocity).multiplyScalar(dt);
            this.mesh.position.add(_tempVec);

            // 3. Drag (Physical Water resistance on Velocity)
            // Separate from Stat Decay. This stops the ball physically.
            const dragFactor = Math.max(0, 1 - (C.WATER_DRAG * dt));
            this.velocity.multiplyScalar(dragFactor);

            // 4. Stat Decay (The "Energy" of the pass/shot)
            if (this.power > 0) {
                this.power -= this.decayRate * dt;
if (this.power < 0) this.power = 0;
            }

            // Bubble Trail (High Speed)
// Bubble Trail (High Speed)
// Bubble Trail (Dynamic)
            const speedSq = this.velocity.lengthSq();
            if (speedSq > 2.0 && window.flux.gameInstance && window.flux.gameInstance.particleManager) {
                this._bubbleTimer -= dt;
                if (this._bubbleTimer <= 0) {
                    const pm = window.flux.gameInstance.particleManager;
                    const offset = this.velocity.clone().normalize().multiplyScalar(-0.8); 
                    
                    // 1. Standard Bubble (Base Trail) - Always spawn for volume
                    const stdPos = this.mesh.position.clone().add(offset).add(new THREE.Vector3((Math.random()-0.5)*0.3, (Math.random()-0.5)*0.3, (Math.random()-0.5)*0.3));
                    if (this.deformNode) stdPos.y += this.deformNode.position.y;
                    pm.spawn('bubble', stdPos, { scale: 0.15 + Math.random() * 0.2 });

                    // 2. Micro Bubbles (Cavitation / Speed) - Add on top
                    if (speedSq > 50.0) { // Speed > ~7
                        const count = Math.min(4, Math.floor(speedSq / 60));
                        for(let i=0; i<count; i++) {
                            const jitter = new THREE.Vector3((Math.random()-0.5)*0.4, (Math.random()-0.5)*0.4, (Math.random()-0.5)*0.4);
                            const spawnPos = this.mesh.position.clone().add(offset).add(jitter);
                            if (this.deformNode) spawnPos.y += this.deformNode.position.y;
                            
                            pm.spawn('bubble_micro', spawnPos, { scale: 0.05 + Math.random() * 0.1 });
                        }
                        this._bubbleTimer = 0.02; // Fast update
                    } else {
                        // Occasional micro bubble at low speed for detail
                        if (Math.random() > 0.5) {
                             const jitter = new THREE.Vector3((Math.random()-0.5)*0.2, (Math.random()-0.5)*0.2, (Math.random()-0.5)*0.2);
                             const spawnPos = this.mesh.position.clone().add(offset).add(jitter);
                             if (this.deformNode) spawnPos.y += this.deformNode.position.y;
                             pm.spawn('bubble_micro', spawnPos, { scale: 0.04 + Math.random() * 0.06 });
                        }
                        this._bubbleTimer = 0.05;
                    }
                }
            }
// Continued logic...
            // 5. Boundary Logic (Soft Walls for Curves)
// 5. Boundary Logic (Soft Walls for Curves)
            // We use a "Soft Wall" approach to prevent sharp V-bounces.
            // A repulsive force curves the ball away before impact, and impact results in a slide/soft bounce.
            const pos = this.mesh.position;
            const distXZ = Math.sqrt(pos.x * pos.x + pos.z * pos.z);
            const boundaryRadius = C.BOUNDARY_RADIUS;

            const softBuffer = 3.0; // Reduced from 5.0 to prevent early repulsion
            
            // A. Soft Repulsion (Creates curved trajectory near wall)
            if (distXZ > boundaryRadius - softBuffer) {
                const penetration = distXZ - (boundaryRadius - softBuffer);
                const ratio = penetration / softBuffer; // 0 to 1
                
                // Force vector towards center
                const pushDir = new THREE.Vector3(-pos.x, 0, -pos.z).normalize();
                // Exponential force to steer it smoothly
                // Reduced force from 60.0 to 20.0 to prevent "ghost wall" bounces
                const force = pushDir.multiplyScalar(ratio * ratio * 20.0 * dt); 
                this.velocity.add(force);
}

            // B. Hard Clamp (If it still hits)
            if (distXZ > boundaryRadius) {
                // Normal pointing INWARD
                const normal = new THREE.Vector3(-pos.x, 0, -pos.z).normalize();
                
                // Clamp Position
                const overlap = distXZ - boundaryRadius;
                pos.add(normal.clone().multiplyScalar(overlap));
                
                // Velocity Handling: Soft Bounce / Slide
                const vDotN = this.velocity.dot(normal);
                
                // Only adjust if moving OUTWARDS (against normal)
                if (vDotN < 0) {
                    // Reduce normal component significantly (Slide behavior)
                    // Elasticity 0.3 = Dull thud/slide, not a sharp ping
                    const elasticity = 0.3; 
                    
                    // V_new = V - (1 + e) * (V.N) * N
                    const impulse = normal.multiplyScalar(-vDotN * (1.0 + elasticity));
                    this.velocity.add(impulse);
                    
                    // Friction on wall contact
                    this.velocity.multiplyScalar(0.95); 
                }
            }

            // Floor/Ceiling Bounce
            if (Math.abs(pos.y) > C.BOUNDARY_HEIGHT) {
                const sign = Math.sign(pos.y);
                pos.y = C.BOUNDARY_HEIGHT * sign;
                this.velocity.y *= -0.4; // Softer vertical bounce
            }
// If spinning significantly, use that axis
            const spinSpeed = this.angularVelocity.length();
            if (spinSpeed > 0.5) {
                const axis = _tempVec.copy(this.angularVelocity).normalize();
                const q = new THREE.Quaternion().setFromAxisAngle(axis, spinSpeed * dt);
                this.accumulatedRotation.premultiply(q);
            } else {
                // Fallback: Roll based on velocity (Visual fake for non-spinning ball)
                const speed = this.velocity.length();
                if (speed > 0.1) {
                    _tempVec.copy(this.velocity).cross(_axisY).normalize();
                    if (_tempVec.lengthSq() > 0.01) {
                        const q = new THREE.Quaternion().setFromAxisAngle(_tempVec, speed * dt);
                        this.accumulatedRotation.premultiply(q);
                    }
                }
            }
}

grab(player) {
            this.reveal(); 
            
            // Announcement: Possession (if taking from free state)
            if (this.state === 'free') {
                 if (window.flux.gameInstance && window.flux.gameInstance.showAnnouncement) {
                     window.flux.gameInstance.showAnnouncement("POSSESSION", "normal");
                 }
            }

            // Check Turnover (Possession Change)
            const previousTeam = this.holder ? this.holder.team : (this.lastHolder ? this.lastHolder.team : null);
            if (previousTeam && previousTeam !== player.team) {
                 if (window.flux.gameInstance && window.flux.gameInstance.floatingText) {
                     window.flux.gameInstance.floatingText.spawn("TURNOVER", player.mesh.position, "tech");
                 }
            }
            
            // If someone else held it, they lose it
            if (this.holder && this.holder !== player) {
                this.holder.loseBall();
            }

            this.holder = player;
            this.state = 'held';
            
            // NOTE: We do NOT parent the mesh to the player anymore.
            // This prevents the ball from flying around due to swim animations.
            // Instead, we update its position manually in updateHeld().
            
            // Notify player
            if (player.receiveBall) {
                player.receiveBall();
            }
            
            console.log("Ball grabbed by " + player.role);
        }

        drop() {
            this.reveal(); // Ensure visible
            
            // No need to detach from scene graph since we aren't parenting to player anymore.
            // Just clear holder.

            if (this.holder) {
                if (this.holder.loseBall) this.holder.loseBall();
                this.holder = null;
            }
            
            this.state = 'free';
        }
// Shoot/Pass
// Shoot/Pass
        shoot(directionVector, force, type = 'SH', technique = null, spinVector = null) {
            this.lastHolder = this.holder; // Record for EXP attribution
            
            // Fumble Detection (Type 'none' is used by Player.fumble)
            if (type === 'none') {
                if (window.flux.gameInstance && window.flux.gameInstance.showAnnouncement) {
                    window.flux.gameInstance.showAnnouncement("FUMBLE!", "slam");
                }
            }

            this.drop(); // Detach first
            
            // Set Grace Period to prevent instant interceptions/catches
            // 0.2s allows ball to clear the thrower's immediate vicinity
            this.catchGracePeriod = 0.2;

            // Physical Velocity (Visual speed)
// Physical Velocity (Visual speed)
            // We map force (stat) to physical speed, but clamp it reasonable
            // Increased cap to 40.0 to allow for strong passes and clears
            const speed = Math.min(force, 40.0);
            this.velocity.copy(directionVector).normalize().multiplyScalar(speed);
            
            // Apply Spin if provided
            if (spinVector) {
                this.angularVelocity.copy(spinVector);
            } else {
                this.angularVelocity.set(0, 0, 0);
            }
            
            // Stat Power (Game Logic)
            this.power = force;
            this.powerType = type;
            this.technique = technique; 
            
            // Update Trail Color
            if (this.trail) {
                let color = 0x00aaff; // Default Blue (Pass)
                
                if (technique) {
                    if (technique.type === 'venom') color = 0xaa00ff; // Purple
                    else if (technique.type === 'wither') color = 0x888888; // Grey
                    else if (technique.type === 'nap') color = 0x000088; // Dark Blue
                    else if (technique.type === 'sphere') color = 0x00ffff; // Cyan
                    else if (technique.type === 'jecht') color = 0xff0000; // Red
                } else if (type === 'SH') {
                    color = 0xff4400; // Orange/Red
                }
                
                this.trail.setColor(color);
            }
            
            // Handle Invisible Shot
            if (technique && technique.type === 'invisible') {
                this.isInvisible = true;
                if (this.mesh) this.mesh.visible = false;
                console.log("Invisible Shot!");
            }
            
            console.log(`Ball ${type} with Power: ${this.power.toFixed(1)} Spin: ${this.angularVelocity.length().toFixed(1)}`);
            
            // Visual Feedback for Curve
            if (this.angularVelocity.length() > 15.0 && window.flux.gameInstance && window.flux.gameInstance.floatingText) {
                window.flux.gameInstance.floatingText.spawn("CURVE!", this.mesh.position, "tech");
            }
        }

        reveal() {

            this.isInvisible = false;
            if (this.mesh) this.mesh.visible = true;
        }
        
reset() {
            this.reveal();
            this.drop();
            this.mesh.position.set(0, 0, 0);
            this.velocity.set(0, 0, 0);
            this.angularVelocity.set(0, 0, 0);
            this.catchGracePeriod = 0;
            this.power = 0;
        }
isCatchable() {
            return this.catchGracePeriod <= 0;
        }

        updateVisuals(dt) {
            if (!this.deformNode || !this.spinNode) return;

            // 1. Squash & Stretch based on velocity
// 1. Squash & Stretch based on velocity
            const speed = this.velocity.length();
            
            // Only apply stretch if moving fast enough
            if (speed > 1.0 && this.state === 'free') {
                // Orient deformNode to velocity direction
                const dir = this.velocity.clone().normalize();
                // Default forward is Z (0,0,1)
                this.deformNode.quaternion.setFromUnitVectors(new THREE.Vector3(0,0,1), dir);
                
                // Calculate stretch factor
                // Max stretch at speed 40 (approx max shot power)
                const factor = Math.min(speed / 40.0, 1.0); 
                const stretch = 1.0 + (factor * 0.8); // Increased stretch max to 1.8x
                const squash = 1.0 / Math.sqrt(stretch); // Maintain volume
                
                this.deformNode.scale.set(squash, squash, stretch);
            } else {
                // Reset deformation
                this.deformNode.quaternion.identity();
                this.deformNode.scale.set(1, 1, 1);
            }

            // 2. Apply Accumulated Spin
            // Since deformNode might be rotated, we need to apply spin in the correct space.
            // spinNode rotation = deformNode_inverse * accumulatedRotation
const invDeform = this.deformNode.quaternion.clone().invert();
            this.spinNode.quaternion.copy(invDeform.multiply(this.accumulatedRotation));
        }
    }

    window.flux.Ball = Ball;
})();</script>
    <script>(function() {
    window.flux = window.flux || {};

    class MiniMap {
        constructor() {
            this.container = document.getElementById('minimap');
            this.dots = new Map(); // Map entity to DOM element
            this.width = 100; // Matches CSS width
            this.height = 100; // Matches CSS height
            this.worldRadius = 30; // Arena radius
        }

        register(entity, type) {
            if (!this.container) return;
            
            const dot = document.createElement('div');
            dot.className = `map-dot ${type}`;
            this.container.appendChild(dot);
            
            this.dots.set(entity, dot);
        }

        init(homeTeam, awayTeam, ball) {
            if (!this.container) return;
            this.container.innerHTML = ''; // Clear existing
            this.dots.clear();

            // Register Home Team
            homeTeam.players.forEach(p => this.register(p, 'home'));
            
            // Register Away Team
            awayTeam.players.forEach(p => this.register(p, 'away'));
            
            // Register Ball
            this.register(ball, 'ball');
        }

        update() {
            if (!this.container) return;

            const halfW = this.width / 2;
            const halfH = this.height / 2;
            // Scale: Map Radius (50px) / World Radius (30 units)
            const scale = halfW / this.worldRadius; 

for (const [entity, dot] of this.dots) {
                if (!entity.mesh) continue;

                // Invisible Ball Logic
                if (entity.isInvisible) {
                    dot.style.display = 'none';
                    continue;
                } else {
                    dot.style.display = 'block';
                }
                if (!entity.mesh) continue;

                const pos = entity.mesh.position;
                
                // Map Logic:
                // World Z is Up/Down. -Z is Top (Attack Direction for Home), +Z is Bottom.
                // World X is Left/Right.
                
                // Calculate raw position relative to center
                let dx = pos.x * scale;
                let dy = pos.z * scale;

                // Clamp to circle (keep dots inside the map)
                const dist = Math.sqrt(dx*dx + dy*dy);
                const maxDist = halfW - 2; // -2 for dot radius padding
                
                if (dist > maxDist) {
                    const angle = Math.atan2(dy, dx);
                    dx = Math.cos(angle) * maxDist;
                    dy = Math.sin(angle) * maxDist;
                }

                // Convert to CSS coordinates (0,0 is Top-Left)
                // Center is (50, 50)
                const cssX = halfW + dx;
                const cssY = halfH + dy;

                dot.style.transform = `translate(${cssX}px, ${cssY}px)`;
                
// Status Updates
                if (entity.status) {
                    // Nap (Sleep) turns dot dark/black
                    if (entity.status.nap > 0) {
                        if (!dot.classList.contains('nap')) dot.classList.add('nap');
                    } else {
                        if (dot.classList.contains('nap')) dot.classList.remove('nap');
                    }
                }

                // Active Player Marker (Green)
// Active Player Marker (Green)
                const game = window.flux.gameInstance;
                const isActive = (game && game.teams.home && game.teams.home.activePlayer === entity);
                
                if (isActive) {
                    if (!dot.classList.contains('active-player')) dot.classList.add('active-player');
                } else {
                    if (dot.classList.contains('active-player')) dot.classList.remove('active-player');
                }

                // Ball Carrier Marker (Glow)
                if (entity.hasBall) {
                    if (!dot.classList.contains('ball-carrier')) dot.classList.add('ball-carrier');
                } else {
                    if (dot.classList.contains('ball-carrier')) dot.classList.remove('ball-carrier');
                }
            }
        }
    }
            

    

    window.flux.MiniMap = MiniMap;
})();</script>
    <script>(function() {
    window.flux = window.flux || {};

// Spark Texture (Procedural Burst)
    const _sparkTexture = (() => {
        const c = document.createElement('canvas');
        c.width = 64; c.height = 64;
        const ctx = c.getContext('2d');
        ctx.clearRect(0,0,64,64);
        
        // Burst shape
        const cx = 32, cy = 32;
        const spikes = 8;
        const outer = 30;
        const inner = 10;
        
        ctx.beginPath();
        for(let i=0; i<spikes*2; i++){
            const r = (i%2===0)? outer : inner;
            const a = (Math.PI*i)/spikes;
            ctx.lineTo(cx + Math.cos(a)*r, cy + Math.sin(a)*r);
        }
        ctx.closePath();
        ctx.fillStyle = '#ffcc00';
        ctx.fill();
        
        // White Core
        ctx.beginPath();
        ctx.arc(cx, cy, 8, 0, Math.PI*2);
        ctx.fillStyle = '#ffffff';
        ctx.fill();
        
        return new THREE.CanvasTexture(c);
    })();

    const _sparkMaterial = new THREE.SpriteMaterial({ 
        map: _sparkTexture, 
        transparent: true, 
        blending: THREE.AdditiveBlending,
        depthWrite: false
    });

    class GameManager {

        
constructor(scene, uiLayerId, camera, renderer) {
window.flux.gameInstance = this;
            this.renderer = renderer; // Store renderer
            this.scene = scene;
            this.camera = camera;
            this.uiLayer = document.getElementById(uiLayerId);
            
            this.score = { home: 0, away: 0 };
            this.time = 0;
            this.half = 1;
            this.halfDuration = 300; // 5 minutes (seconds)
            this.isOvertime = false;
            this.isDemoMode = false;
            this.gameMode = 'normal'; // 'normal' or 'practice'
            
            // Impact Frames
            this.impactPause = 0;
            
            this.state = 'menu'; // Start in menu
this.teams = {
                home: null,
                away: null
            };
            
            this.entities = {
                ball: null
            };

this.ui = {
                scorePlayer: null,
                scoreCpu: null,
                timer: null,
                half: null,
                announcement: null,
                // Player Status Panel
                statusPanel: {
                    container: null,
                    name: null,
                    hpBar: null,
                    hpText: null,
                    expBar: null
                }
            };

            // Techcopy State
            this.techCopyState = {
                active: false,
                timer: 0,
                tech: null,
                learners: []
            };

this.miniMap = new window.flux.MiniMap();
            
            // Initialize Floating Text
// Initialize Floating Text
            this.floatingText = new window.flux.FloatingTextManager(scene, uiLayerId, camera);
            
// Initialize Particle Manager (Status Effects)
            this.particleManager = new window.flux.ParticleManager(scene);
this.glyphManager = null; // Injected by main.js
            this._initParticles(); // 3D Spark System (Legacy/Impact)

this.debugVisualizer = new window.flux.DebugVisualizer(scene);
            this.practiceManager = new window.flux.PracticeManager(this); // Initialize Practice Manager
            this._injectStyles();
            this._initUI();
        }

        _injectStyles() {
            if (document.getElementById('flux-dynamic-styles')) return;
            const style = document.createElement('style');
            style.id = 'flux-dynamic-styles';
style.textContent = `
                @keyframes textSlam {
                    0% { transform: translate(-50%, -50%) scale(4); opacity: 0; letter-spacing: 50px; }
                    10% { transform: translate(-50%, -50%) scale(1); opacity: 1; letter-spacing: 5px; }
                    15% { transform: translate(-50%, -50%) scale(1.1); }
                    20% { transform: translate(-50%, -50%) scale(1); }
                    80% { transform: translate(-50%, -50%) scale(1); opacity: 1; filter: blur(0px); }
                    100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; filter: blur(10px); }
                }
                
                .announcement-slam {
                    position: absolute;
                    top: 45%; left: 50%;
                    transform: translate(-50%, -50%);
                    width: 100%;
                    text-align: center;
                    font-family: 'Impact', sans-serif;
                    font-size: 96px;
                    font-style: italic;
                    text-transform: uppercase;
                    background: linear-gradient(to bottom, #ffffff 0%, #ffdd00 45%, #ff8800 100%);
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                    filter: drop-shadow(0 0 10px rgba(0,0,0,1)) drop-shadow(0 0 30px rgba(255, 100, 0, 0.6));
                    z-index: 2000;
                    animation: textSlam 1.8s cubic-bezier(0.1, 0.8, 0.1, 1) forwards;
                    pointer-events: none;
                    white-space: nowrap;
                }

                .modal-overlay {
                    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
                    background: radial-gradient(circle at center, rgba(10, 25, 60, 0.95) 0%, rgba(0, 0, 0, 0.98) 100%);
                    display: flex; justify-content: center; align-items: center; flex-direction: column;
                    z-index: 1900;
                    opacity: 0; pointer-events: none; transition: opacity 0.8s;
                    backdrop-filter: blur(8px);
                }
                .modal-overlay.active { opacity: 1; pointer-events: auto; }
                
                .modal-title {
                    font-family: 'Garamond', serif;
                    font-size: 52px; color: #fff;
                    text-transform: uppercase;
                    text-shadow: 0 0 20px #00aaff, 0 0 40px #0044aa;
                    margin-bottom: 30px;
                    border-bottom: 2px solid #00aaff;
                    padding-bottom: 10px;
                    width: 80%; text-align: center;
                    letter-spacing: 5px;
                }
                
                .modal-score-container {
                    display: flex; align-items: center; gap: 40px;
                    margin-bottom: 40px;
                }
                .modal-score {
                    font-family: 'Impact', sans-serif;
                    font-size: 80px; color: #ffd700;
                    letter-spacing: 5px;
                    text-shadow: 0 0 20px #b8860b;
                }
                .modal-vs {
                    font-family: 'Courier New', monospace;
                    font-size: 24px; color: #00aaff; opacity: 0.7;
                }

                .flash-overlay {
                    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
                    background: white;
                    z-index: 2100;
                    opacity: 0; pointer-events: none;
                    transition: opacity 0.1s ease-out;
                    mix-blend-mode: overlay;
                }

                @keyframes clashPop {
                    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; }
                    50% { transform: translate(-50%, -50%) scale(1.5); opacity: 0.8; }
                    100% { transform: translate(-50%, -50%) scale(2.0); opacity: 0; }
                }

                .clash-spark {
                    position: absolute;
                    width: 60px; height: 60px;
                    background: radial-gradient(circle, #ffffff 0%, #ffff00 40%, transparent 70%);
                    border-radius: 50%;
                    pointer-events: none;
                    z-index: 1500;
                    mix-blend-mode: screen;
                    animation: clashPop 0.3s ease-out forwards;
                    box-shadow: 0 0 20px #ffaa00;
                }
            `;
            document.head.appendChild(style);
        }

        registerTeams(homeTeam, awayTeam, ball) {
            this.teams.home = homeTeam;
            this.teams.away = awayTeam;
this.entities.ball = ball;
            
            // Initialize MiniMap
            if (this.miniMap) {
                this.miniMap.init(homeTeam, awayTeam, ball);
            }
        }

_initUI() {
            // Bind to existing HTML elements
            this.ui.scorePlayer = document.getElementById('score-player');
            this.ui.scoreCpu = document.getElementById('score-cpu');
            this.ui.timer = document.getElementById('timer-display');
            this.ui.half = document.getElementById('half-indicator');
            this.ui.announcement = document.getElementById('announcement');
            
            this.ui.techFlash = document.getElementById('tech-flash-overlay');
            if (this.ui.techFlash) {
                this.ui.techSub = this.ui.techFlash.querySelector('.tech-sub-text');
            }
            this.ui.techTimerFill = document.querySelector('.tech-timer-fill');

            // Bind Player Status Panel
            this.ui.statusPanel.container = document.getElementById('player-status-panel');
            this.ui.statusPanel.name = document.querySelector('#player-status-panel .char-name');
            this.ui.statusPanel.hpBar = document.querySelector('#player-status-panel .hp-bar-fill');
            this.ui.statusPanel.hpText = document.querySelector('#player-status-panel .hp-value');
            this.ui.statusPanel.expBar = document.querySelector('#player-status-panel .tech-bar-fill');
            
            // Create Modal Overlay
            this.ui.modal = document.createElement('div');
            this.ui.modal.className = 'modal-overlay';
            this.ui.modal.innerHTML = `
                <div class="modal-title">HALF TIME</div>
                <div class="modal-score-container">
                    <div class="modal-score" id="modal-score-home">0</div>
                    <div class="modal-vs">-</div>
                    <div class="modal-score" id="modal-score-away">0</div>
                </div>
                <div id="modal-msg" style="color: #00aaff; font-size: 14px; letter-spacing: 2px;">PREPARING 2ND HALF...</div>
            `;
            this.uiLayer.appendChild(this.ui.modal);

            // Create Flash Overlay
            this.ui.flash = document.createElement('div');
            this.ui.flash.className = 'flash-overlay';
            this.uiLayer.appendChild(this.ui.flash);

            // Initial State
            this._updateScoreUI();
            if (this.ui.timer) this.ui.timer.innerText = "00:00";
        }
        _updateScoreUI() {
            if (this.ui.scorePlayer) this.ui.scorePlayer.innerText = this.score.home;
            if (this.ui.scoreCpu) this.ui.scoreCpu.innerText = this.score.away;
        }

updatePractice(dt) {
            // Delegate logic to PracticeManager
            if (this.practiceManager) {
                this.practiceManager.update(dt);
            }
        }

        update(dt) {
            if (this.state === 'menu') {
                // Menu Background Logic (Camera Orbit)
                if (this.cameraManager) {
                    // Slow orbit around center
                    const time = Date.now() * 0.0001;
                    const radius = 40;
                    const x = Math.sin(time) * radius;
                    const z = Math.cos(time) * radius;
                    // Note: CameraManager update is skipped in main.js if state is menu
                }
                return;
            }

            if (this.state === 'active') {
                if (this.gameMode === 'practice') {
                    this.updatePractice(dt);
                } else {
                    this.time += dt;
                    this._updateTimer();
                    this._checkHalfTime();
                }

                this._checkGoals();
                
                if (this.miniMap) this.miniMap.update();
                if (this.floatingText) this.floatingText.update(dt);
if (this.particleManager) this.particleManager.update(dt);
                // GlyphManager updated by main.js
                
                // Update Techcopy Window
                if (this.techCopyState.active) {
                    this.techCopyState.timer -= dt;
                    
                    // Update UI Bar
                    if (this.ui.techTimerFill) {
                        const pct = Math.max(0, (this.techCopyState.timer / this.techCopyState.maxTime) * 100);
                        this.ui.techTimerFill.style.width = `${pct}%`;
                        
                        // Color shift based on urgency
                        if (pct < 30) this.ui.techTimerFill.style.background = '#ff0000';
                        else this.ui.techTimerFill.style.background = 'linear-gradient(90deg, #ffffff, #00ffff)';
                    }

                    if (this.techCopyState.timer <= 0) {
                        this.endTechCopyWindow(false);
                    }
                }
                
                this._updateParticles(dt);
                if (this.debugVisualizer) this.debugVisualizer.update();
            }
        }
            


_updateTimer() {
            if (!this.ui.timer) return;
            // Clamp to half duration for display if we go slightly over before tick
            const t = Math.min(this.time, this.halfDuration);
            const minutes = Math.floor(t / 60);
            const seconds = Math.floor(t % 60);
            this.ui.timer.innerText = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        _checkHalfTime() {
            if (this.time >= this.halfDuration) {
                this.endHalf();
            }
        }

endHalf() {
            this.state = 'halftime';
            
            if (this.half === 1) {
                this._showModal("HALF TIME", "PREPARING 2ND HALF...");
                setTimeout(() => {
                    this._hideModal();
                    this.startSecondHalf();
                }, 4000);
            } else {
                // End of 2nd Half or Overtime Period
                if (this.score.home === this.score.away) {
                    // TIED - Go to Overtime (Golden Goal)
                    this._showModal("OVERTIME", "GOLDEN GOAL RULE ACTIVE");
                    setTimeout(() => {
                        this._hideModal();
                        this.startOvertime();
                    }, 4000);
                } else {
                    // Winner decided
                    this.endGame();
                }
            }
        }

        startSecondHalf() {
            this.half = 2;
            this.time = 0;
            this.ui.half.innerText = "2nd HALF";
            this.resetRound(null); // Neutral Blitz-off for 2nd half start
        }

        startOvertime() {
            this.half++;
            this.time = 0;
            this.isOvertime = true;
            this.ui.half.innerText = "OVERTIME";
            this.resetRound(null); // Neutral Blitz-off
        }

        endGame() {
            this.state = 'gameover';
            let msg = "DRAW";
            if (this.score.home > this.score.away) msg = "VICTORY";
            if (this.score.away > this.score.home) msg = "DEFEAT";
            
this._showModal(msg, "PRESS REFRESH TO PLAY AGAIN");
            // Stop Music on Game Over
            if (this.audioManager) {
                this.audioManager.stopBGM();
            }
            // No reset, just stop.
        }

        _showModal(title, subtext) {
            if (!this.ui.modal) return;
            
            this.ui.modal.querySelector('.modal-title').innerText = title;
            this.ui.modal.querySelector('#modal-score-home').innerText = this.score.home;
            this.ui.modal.querySelector('#modal-score-away').innerText = this.score.away;
            this.ui.modal.querySelector('#modal-msg').innerText = subtext;
            
            this.ui.modal.classList.add('active');
            
            // Hide HUD elements
            document.getElementById('hud-top').style.opacity = '0';
            document.getElementById('player-status-panel').style.opacity = '0';
        }

        _hideModal() {
            if (!this.ui.modal) return;
            this.ui.modal.classList.remove('active');
            
            // Show HUD elements
            document.getElementById('hud-top').style.opacity = '1';
            document.getElementById('player-status-panel').style.opacity = '1';
        }

_checkGoals() {
            const ball = this.entities.ball;
            if (!ball || !ball.mesh) return;

            const pos = ball.mesh.position;

            // Precise Goal Detection
            // Visual Goal is at Z = +/- 28.
            // We define a "Goal Mouth" box matching Goalie.js (Width 14, Height 8).
// We define a "Goal Mouth" box matching the visual net.
            // Arena Radius is 32. Goal is roughly 22m wide, 18m high.
const halfWidth = 16.5; // Increased 50% (was 11.0)

            const halfHeight = 13.5; // Increased 50% (was 9.0)
            const goalYOffset = -2.2; // Moved down to match visual model
            const triggerZ = 28.0; // Trigger at the arena edge
            if (Math.abs(pos.z) > triggerZ) {
                
                // PREVENT OWN GOAL BY CARRIER (User Request)
                // If the ball is held by the team defending this goal, do not count it.
                if (ball.holder) {
                    // Home (Side 1) defends +Z. If pos.z > 0 (Home Goal) and holder is Home, ignore.
                    if (pos.z > 0 && ball.holder.team.side === 1) return;
                    // Away (Side -1) defends -Z. If pos.z < 0 (Away Goal) and holder is Away, ignore.
                    if (pos.z < 0 && ball.holder.team.side === -1) return;
                }

                // 2. Check Frame (Must be within width/height)
// 2. Check Frame (Must be within width/height, accounting for Y offset)
                if (Math.abs(pos.x) <= halfWidth && Math.abs(pos.y - goalYOffset) <= halfHeight) {
                    if (pos.z < 0) {
                        this.goalScored('home'); // Home attacks -Z
                    } else {
                        this.goalScored('away'); // Away attacks +Z
                    }
                }
            }
        }

goalScored(scorer) {
            if (this.state !== 'active') return;
            
            // IMPACT FRAME: GOAL
this.triggerImpact(0.4, 'shatter'); // Massive freeze for goal
            if (this.state !== 'active') return;
            
            // EXP REWARD: Goal
            // Find who scored (Last holder of ball)
            const ball = this.entities.ball;
            if (ball && ball.lastHolder && ball.lastHolder.team.id === scorer) {
                ball.lastHolder.gainExp(10);
                // Optional: Assist logic could go here (track lastHolder.lastPasser?)
            }

            this.state = 'goal';
            this.score[scorer]++;
            this._updateScoreUI();
            
// 1. VISCERAL SHAKE & PARTICLES
            if (this.cameraManager) {
                this.cameraManager.addShake(2.0); // Heavy shake
            }
            if (this.particleManager && this.entities.ball && this.entities.ball.mesh) {
                const goalPos = this.entities.ball.mesh.position.clone();
                // Massive Goal Explosion
                this.particleManager.spawn('shockwave', goalPos, { scale: 15.0, life: 0.8 });
                this.particleManager.spawn('flash', goalPos, { scale: 10.0 });
                for(let i=0; i<30; i++) {
                    this.particleManager.spawn('debris', goalPos, { scale: 0.8 });
                }
            }
            // 2. SCREEN FLASH
            if (this.ui.flash) {
                this.ui.flash.style.opacity = '0.8';
                setTimeout(() => { this.ui.flash.style.opacity = '0'; }, 100);
            }

            // 3. GOLDEN GOAL CHECK
            if (this.isOvertime) {
                this.showAnnouncement("GOLDEN GOAL!", 'slam');
                // End game after short delay
                setTimeout(() => {
                    this.endGame();
                }, 3000);
                return;
            }

            // 4. SLAM ANNOUNCEMENT (Normal)
            this.showAnnouncement("GOAL!", 'slam');
            
            // Reset sequence
            // Scored-upon team gets ball
            const loser = scorer === 'home' ? 'away' : 'home';
            
            // FASTER FLOW: Reduced delay from 3000ms to 1200ms
            setTimeout(() => {
                this.resetRound(loser);
            }, 2000); // Slightly longer to appreciate the "GOAL" slam
        }

showAnnouncement(text, type = 'normal', duration = 2000) {
            const el = this.ui.announcement;
            if (!el) return;

            // Clear previous timeout
            if (this._announceTimeout) {
                clearTimeout(this._announceTimeout);
                this._announceTimeout = null;
            }

            // Reset Animation by cloning
            const newEl = el.cloneNode(true);
            el.parentNode.replaceChild(newEl, el);
            this.ui.announcement = newEl;

            newEl.innerText = text;
            newEl.style.display = 'block';
            
            // Apply Class based on type
            newEl.className = ''; // Reset classes
            if (type === 'slam') {
                newEl.classList.add('announcement-slam');
            } else {
                // Default style
                newEl.style.animation = 'none';
                newEl.offsetHeight; /* trigger reflow */
                newEl.style.animation = 'announceSlide 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
            }

            // Auto-hide
            if (duration > 0) {
                this._announceTimeout = setTimeout(() => {
                    this.hideAnnouncement();
                }, duration);
            }
        }

        hideAnnouncement() {
            if (this.ui.announcement) {
                this.ui.announcement.style.display = 'none';
            }
        }

resetRound(possessionTeamId) {
            this.state = 'reset';
            
            // Reset Ball
            if (this.entities.ball) this.entities.ball.reset();
            
            // Reset Teams
            if (this.teams.home) this.teams.home.resetPositions();
            if (this.teams.away) this.teams.away.resetPositions();
            
            // Clear ball holder
            if (this.entities.ball) this.entities.ball.drop();

            // CRITICAL: Snap camera to prevent disorientation
            if (this.cameraManager) {
                // Force update target first (usually ball)
                if (this.entities.ball && this.entities.ball.mesh) {
                    this.cameraManager.setTarget(this.entities.ball.mesh, this.entities.ball.velocity);
                    this.cameraManager.snapToTarget();
                }
            }

            // FASTER FLOW: Reduced delay from 2000ms to 100ms
            setTimeout(() => {
                this.startKickoff(possessionTeamId);
}, 100);
        }

        startKickoff(possessionTeamId) {
            this.state = 'kickoff';
            this.showAnnouncement("BLITZ OFF!", 'slam');
            
            // If a team has possession (after goal), give to MF
            if (possessionTeamId) {
                const team = this.teams[possessionTeamId];
                if (team) {
                    const mf = team.players.find(p => p.role === 'MF');
                    if (mf && this.entities.ball) {
                        this.entities.ball.grab(mf);
                        
                        // CRITICAL: Snap camera to new holder to prevent swing/disorientation
                        if (this.cameraManager) {
                            this.cameraManager.setTarget(mf.mesh, mf.velocity);
                            this.cameraManager.snapToTarget();
                        }
                    }
                }
            } else {
                // Neutral kickoff - ensure camera is snapped to center ball
                if (this.cameraManager && this.entities.ball && this.entities.ball.mesh) {
                    this.cameraManager.setTarget(this.entities.ball.mesh, this.entities.ball.velocity);
                    this.cameraManager.snapToTarget();
                }
            }
            
            // FASTER FLOW: Reduced delay from 1000ms to 800ms
            setTimeout(() => {
                this.hideAnnouncement();
                this.state = 'active';
            }, 800);
        }
        
// Initial start
        startMatch(mode = 'normal') {
            this.gameMode = mode;
            console.log("Starting Match in mode:", mode);
            
            // Start Music
            if (this.audioManager) {
                this.audioManager.playBGM();
            }
            
            // Reset Score
this.score.home = 0;
            this.score.away = 0;
            this._updateScoreUI();
            
            // Reset Time
            this.time = 0;
            this.half = 1;
            if (this.ui.half) this.ui.half.innerText = "1st";
            
if (mode === 'practice') {
                if (this.ui.half) this.ui.half.innerText = "PRAC";
                
                // Start Practice Manager
                if (this.practiceManager) {
                    this.practiceManager.start();
                }

                // In practice, ensure AI is enabled for sparring
                if (this.teams.away) {
                    this.teams.away.aiEnabled = true;
                }
            } else {

                // Ensure Practice Manager is stopped if normal game
                if (this.practiceManager) this.practiceManager.stop();
                
                // Safety: Ensure all players are visible (in case Practice hid them)
                // And FORCE AI ENABLED (Fix for "Zombies" if coming from Practice Mode)
                if (this.teams.away) {
                    this.teams.away.players.forEach(p => { if(p.mesh) p.mesh.visible = true; });
                    this.teams.away.aiEnabled = true; 
                }
                if (this.teams.home) {
                    this.teams.home.players.forEach(p => { if(p.mesh) p.mesh.visible = true; });
                }

this.resetRound();
            }
}

setMenuMode(isActive) {
            this.state = isActive ? 'menu' : 'active';
            
            if (isActive && this.audioManager) {
                this.audioManager.stopBGM();
            }
            
            // Hide HUD in menu
            const hudTop = document.getElementById('hud-top');
            const statusPanel = document.getElementById('player-status-panel');
            const controls = document.getElementById('action-container');
            const joystick = document.getElementById('joystick-hit-zone');
            
            const display = isActive ? 'none' : 'flex'; // or block/etc
            
            if (hudTop) hudTop.style.display = display;
            if (statusPanel) statusPanel.style.display = isActive ? 'none' : 'block'; // Status panel has specific logic
            if (controls) controls.style.display = isActive ? 'none' : 'flex';
            if (joystick) joystick.style.display = isActive ? 'none' : 'block';
            
            // If entering menu, reset camera to a nice angle?
            // Handled by update loop
        }
toggleDemoMode() {
            this.isDemoMode = !this.isDemoMode;
            console.log("Demo Mode:", this.isDemoMode);
            
            // Update UI Button
            const btn = document.getElementById('auto-toggle');
            if (btn) {
                btn.innerText = this.isDemoMode ? "AUTO PILOT" : "MANUAL";
                if (this.isDemoMode) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            }
            
            // Announcement
            const text = this.isDemoMode ? "AUTO PILOT" : "MANUAL";
            this.showAnnouncement(text);
            
            // Visual Flair: Spawn text above active player
            if (this.isDemoMode && this.floatingText && this.teams.home && this.teams.home.activePlayer && this.teams.home.activePlayer.mesh) {
                this.floatingText.spawn("AI ENGAGED", this.teams.home.activePlayer.mesh.position, "goal");
            }

            // Auto-hide announcement
setTimeout(() => {
                if (this.ui.announcement && this.ui.announcement.innerText === text) {
                    this.hideAnnouncement();
                }
            }, 1500);
        }

        // --- TECHCOPY SYSTEM ---

        triggerTechEvent(sourcePlayer, techName) {
            if (!sourcePlayer || !sourcePlayer.team) return;

            // Find opposing team
            const oppTeamId = sourcePlayer.team.id === 'home' ? 'away' : 'home';
            const oppTeam = this.teams[oppTeamId];
            if (!oppTeam) return;

            // Find who is marking this source
            const learners = oppTeam.players.filter(p => p.marking === sourcePlayer);
            
            if (learners.length === 0) return;

            // Only show UI if the learning team is Human (Home)
            // (Or if we are in Demo mode and want to see it happen for Home team)
            if (oppTeam.isHuman) {
                // Filter out those who already know it
                const validLearners = learners.filter(p => !p.learnedTechs.includes(techName));
                if (validLearners.length > 0) {
                    this.startTechCopyWindow(techName, validLearners);
                }
            }
        }

startTechCopyWindow(techName, learners) {
            this.techCopyState.active = true;
            this.techCopyState.maxTime = 0.6; // 0.6s window
            this.techCopyState.timer = this.techCopyState.maxTime;
            this.techCopyState.tech = techName;
            this.techCopyState.learners = learners;
            
            // Show UI
            if (this.ui.techFlash) {
                this.ui.techFlash.style.display = 'flex';
                this.ui.techFlash.style.background = ""; // Reset background
                this.ui.techFlash.querySelector('.tech-text').innerText = "TECHCOPY!";
                
                if (this.ui.techSub) {
                    this.ui.techSub.innerText = techName.replace('_', ' ');
                }
                
                // Reset bar
                if (this.ui.techTimerFill) {
                    this.ui.techTimerFill.style.width = '100%';
                }
            }
        }

attemptTechCopy() {
            if (!this.techCopyState.active) return false;
            
            // Success!
            const tech = this.techCopyState.tech;
            const learners = this.techCopyState.learners;
            
            learners.forEach(p => {
                // Double check to prevent duplicates
                if (!p.learnedTechs.includes(tech)) {
                    p.learnedTechs.push(tech);
                    console.log(`${p.role} learned ${tech}!`);
                    
                    // 1. Floating Text
                    if (this.floatingText && p.mesh) {
                        this.floatingText.spawn(`LEARNED!`, p.mesh.position, "tech");
                    }
                    
                    // 2. Particle Effect (Spiral)
                    if (this.particleManager && p.mesh) {
                        // Spawn multiple particles for a swirl effect
                        for(let i=0; i<10; i++) {
                            setTimeout(() => {
                                this.particleManager.spawn('learned', p.mesh.position);
                            }, i * 50);
                        }
                    }
                }
            });
            
            this.endTechCopyWindow(true);
            return true;
        }

endTechCopyWindow(success) {
            this.techCopyState.active = false;
            if (this.ui.techFlash) {
                if (success) {
                    this.ui.techFlash.querySelector('.tech-text').innerText = "SUCCESS!";
                    // Flash success color (White flash)
                    this.ui.techFlash.style.background = "rgba(255, 255, 255, 0.8)";
                    
                    // Hide after short delay to show the success flash
                    setTimeout(() => { 
                        this.ui.techFlash.style.display = 'none'; 
                    }, 300);
                } else {
                    // Failed / Missed
                    this.ui.techFlash.style.display = 'none';
                }
            }
        }
_updatePlayerStatusUI() {
            if (!this.teams.home || !this.teams.home.activePlayer) return;
            
            const p = this.teams.home.activePlayer;
            const ui = this.ui.statusPanel;
            
// UI Updates (Action Button Context)
                ui.container.style.display = 'block';
                
                // Name & Level
                if (ui.name) ui.name.innerText = `${p.characterName || p.role} LV${p.level}`;
                
                // HP
                if (ui.hpBar) {
                    const hpPct = Math.max(0, Math.min(100, (p.stats.HP / p.stats.maxHP) * 100));
                    ui.hpBar.style.width = `${hpPct}%`;
                    // Color shift
                    if (hpPct < 25) ui.hpBar.style.background = 'linear-gradient(90deg, #ff0000, #ff4444)';
                    else if (hpPct < 50) ui.hpBar.style.background = 'linear-gradient(90deg, #ffff00, #ffff88)';
                    else ui.hpBar.style.background = 'linear-gradient(90deg, #00ff00, #ccffcc)';
                }
                if (ui.hpText) ui.hpText.innerText = `${Math.floor(p.stats.HP)}/${p.stats.maxHP}`;
                
                // EXP
                if (ui.expBar) {
                    const expPct = Math.max(0, Math.min(100, (p.exp / p.nextLevelExp) * 100));
                    ui.expBar.style.width = `${expPct}%`;
                }
            }
_initParticles() {
            this.sparkPool = [];
            this.activeSparks = [];
            const poolSize = 40; // Sufficient for continuous grinding
            
            for (let i = 0; i < poolSize; i++) {
                const sprite = new THREE.Sprite(_sparkMaterial.clone());
                sprite.visible = false;
                this.scene.add(sprite);
                this.sparkPool.push(sprite);
            }
        }

        spawnClash(pos, intensity = 1.0) {
            // Find free spark
            const spark = this.sparkPool.find(s => !s.visible);
            if (!spark) return; // Pool exhausted
            
            spark.position.copy(pos);
            spark.visible = true;
            
            // Randomize rotation
            spark.material.rotation = Math.random() * Math.PI;
            
            // Initialize Active State
            this.activeSparks.push({
                mesh: spark,
                age: 0,
                life: 0.15 + Math.random() * 0.15, // Fast, punchy sparks
                maxScale: 2.5 * intensity,
                velocity: new THREE.Vector3(
                    (Math.random()-0.5)*8, 
                    (Math.random()-0.5)*8, 
                    (Math.random()-0.5)*8
                )
            });
        }

        _updateParticles(dt) {
            for (let i = this.activeSparks.length - 1; i >= 0; i--) {
                const p = this.activeSparks[i];
                p.age += dt;
                
                if (p.age >= p.life) {
                    p.mesh.visible = false;
                    this.activeSparks.splice(i, 1);
                    continue;
                }
                
                const t = p.age / p.life;
                
                // Expand
                const currentScale = 0.5 + (p.maxScale - 0.5) * t;
                p.mesh.scale.setScalar(currentScale);
                
                // Fade out
                p.mesh.material.opacity = 1.0 - (t * t); // Quadratic fade
                
                // Move
                p.mesh.position.addScaledVector(p.velocity, dt);
                p.mesh.material.rotation += 10.0 * dt;
            }
        }

// Helper for impact frames

triggerImpact(duration, type = 'default') {
            this.impactPause = duration;
            
            const container = document.getElementById('game-container');
            if (!container) return;

            // Reset classes to ensure animation restarts
            container.classList.remove('impact-fx', 'impact-heavy', 'impact-shatter');
            
            // Force reflow
            void container.offsetWidth;

            let className = 'impact-fx';
            if (type === 'heavy') className = 'impact-heavy';
            if (type === 'shatter') className = 'impact-shatter';

            container.classList.add(className);

            // Auto-remove class after duration
            setTimeout(() => {
                container.classList.remove(className);
            }, duration * 1000 + 100);
        }
    }

    window.flux.GameManager = GameManager;
})();</script>
    <script>(function() {
    window.flux = window.flux || {};

    class FloatingTextManager {
        constructor(scene, containerId, camera) {
            this.scene = scene;
            this.camera = camera;
            this.container = document.getElementById(containerId);
            this.texts = [];
            
            // Reusable vector for projection
            this._tempV = new THREE.Vector3();
        }

spawn(text, worldPos, type = 'default', target = null) {
            if (!this.container || !this.camera) return;

            // Create Wrapper (Positioning)
            const wrapper = document.createElement('div');
            wrapper.className = 'floating-text-wrapper';

            // Create Inner (Animation/Styling)
            const inner = document.createElement('span');
            inner.innerText = text;
            
            // Smart Class Assignment
            let classes = ['floating-text-inner'];
            
            // Add base type
            classes.push(type);

            // Keyword Detection for Auto-Styling
            const upper = text.toString().toUpperCase();
            
if (upper.includes('POISON') || upper.includes('VENOM')) classes.push('venom');
            else if (upper.includes('SLEEP') || upper.includes('NAP') || upper.includes('ZZZ')) classes.push('sleep');
            else if (upper.includes('WITHER')) classes.push('wither');
            else if (type === 'tech' || upper.includes('SHOT') || upper.includes('JECHT') || upper.includes('TACKLE')) classes.push('tech');
            else if (type === 'comic-impact') classes.push('comic-impact');
            else if (type === 'comic-action') classes.push('comic-action');
            else if (!isNaN(parseInt(text)) && type !== 'score') classes.push('damage'); // Numeric is usually damage
            else if (type === 'save' || type === 'block') classes.push('save');

            inner.className = classes.join(' ');
            wrapper.appendChild(inner);
            this.container.appendChild(wrapper);

            // Physics Instance
            const instance = {
                el: wrapper, 
                worldPos: worldPos.clone(),
                offset: new THREE.Vector3(0, 0, 0),
                velocity: new THREE.Vector3(0, 0, 0),
                gravity: 0,
                drag: 0,
                elasticity: 0.6,
                floorY: -999, // Virtual floor relative to start
                
life: 1.0,  // Reduced from 1.5
                maxLife: 1.0,
                target: target
            };

            // Customize Physics based on Type
if (classes.includes('damage') || classes.includes('save') || classes.includes('block')) {
                // DEBRIS PHYSICS (Pop, Arc, Bounce)
                instance.target = null; // Detach from entity so it falls naturally
                instance.gravity = 40.0; // Heavy gravity for snappy feel
                instance.drag = 0.5;
                instance.floorY = -4.0; // Bounce off a virtual floor below impact
                
                // Explosive Burst
                const spread = 6.0;
                instance.velocity.set(
                    (Math.random() - 0.5) * spread,
                    15.0 + Math.random() * 5.0, // High initial pop
                    (Math.random() - 0.5) * spread
                );
                
                instance.life = 2.0;
                instance.maxLife = 2.0;

            } else if (classes.includes('comic-impact')) {
                // COMIC POP (Stay in place mostly, slight drift)
                instance.gravity = 0;
                instance.velocity.set((Math.random()-0.5)*2, 1.0, (Math.random()-0.5)*2);
instance.life = 0.5; // Reduced from 0.8
                instance.maxLife = 0.5;

            } else if (classes.includes('comic-action')) {
                // COMIC ZIP (Fast movement)
                instance.gravity = 0;
                instance.velocity.set(0, 2.0, 0);
instance.life = 0.4; // Reduced from 0.6
                instance.maxLife = 0.4;

            } else if (classes.includes('tech')) {
                // TECH FLOAT (Slow rise)
                instance.gravity = 0;
                instance.velocity.set(0, 2.0, 0); // Steady rise
                instance.life = 2.5;
                instance.maxLife = 2.5;
                instance.offset.y = 2.0; // Start higher

            } else if (classes.includes('sleep')) {
                // SLEEP DRIFT (Slow meandering)
                instance.gravity = -0.5; // Slight anti-gravity
                instance.velocity.set(0, 0.5, 0);
                instance.life = 3.0;
                instance.maxLife = 3.0;

            } else {
                // DEFAULT (Status, etc)
                instance.velocity.set(0, 3.0, 0);
                instance.gravity = 5.0; // Slight arc
            }
            
            // Randomize start pos slightly to prevent stacking
            if (!target) {
                instance.worldPos.x += (Math.random() - 0.5) * 0.5;
                instance.worldPos.z += (Math.random() - 0.5) * 0.5;
            }
instance.worldPos.y += 1.0;
            this.texts.push(instance);
            this.updatePosition(instance);
        }

// spawnVersus removed

        update(dt) {
            for (let i = this.texts.length - 1; i >= 0; i--) {
                const t = this.texts[i];
                t.life -= dt;
                
                // If attached to a target, update base position (only for non-debris)
                if (t.target && t.target.parent) { 
                    t.worldPos.copy(t.target.position);
                    t.worldPos.y += 1.0; 
                }

                // Physics Integration
                if (t.gravity !== 0 || t.velocity.lengthSq() > 0) {
                    // Gravity
                    t.velocity.y -= t.gravity * dt;
                    
                    // Drag (Air resistance)
                    if (t.drag > 0) {
                        t.velocity.multiplyScalar(Math.max(0, 1.0 - (t.drag * dt)));
                    }

                    // Move
                    t.offset.addScaledVector(t.velocity, dt);

                    // Bounce Logic
                    if (t.offset.y < t.floorY) {
                        t.offset.y = t.floorY;
                        // Bounce velocity
                        t.velocity.y *= -t.elasticity;
                        // Ground friction
                        t.velocity.x *= 0.7;
                        t.velocity.z *= 0.7;
                        
                        // Stop bouncing if energy is low
                        if (Math.abs(t.velocity.y) < 2.0) t.velocity.y = 0;
                    }
                }

                if (t.life <= 0) {
                    if (t.el.parentNode) t.el.parentNode.removeChild(t.el);
                    this.texts.splice(i, 1);
                } else {
                    this.updatePosition(t);
                    // Fade out in last 30%
                    if (t.life < t.maxLife * 0.3) {
                        t.el.style.opacity = t.life / (t.maxLife * 0.3);
                    }
                }
            }
        }

        updatePosition(t) {
            // Project world pos + offset to screen
            this._tempV.copy(t.worldPos).add(t.offset);
            
            // Standard Three.js projection
            this._tempV.project(this.camera);

            const x = (this._tempV.x * .5 + .5) * this.container.clientWidth;
            const y = (-(this._tempV.y * .5) + .5) * this.container.clientHeight;

            // Hide if behind camera
            if (this._tempV.z > 1) {
                t.el.style.display = 'none';
            } else {
                t.el.style.display = 'block';
                t.el.style.transform = `translate(${x}px, ${y}px)`;
            }
}
    }

    window.flux.FloatingTextManager = FloatingTextManager;
})();</script>
<script>(function() {
    window.flux = window.flux || {};

    // --- TEXTURE GENERATORS ---
    
    // 1. Venom Bubble (Green, shiny, sharp)
    const _venomTex = (() => {
        const c = document.createElement('canvas');
        c.width = 64; c.height = 64;
        const ctx = c.getContext('2d');
        const g = ctx.createRadialGradient(32, 32, 4, 32, 32, 30);
        g.addColorStop(0, 'rgba(150, 255, 100, 0.9)');
        g.addColorStop(0.8, 'rgba(0, 200, 0, 0.5)');
        g.addColorStop(1, 'rgba(0, 50, 0, 0)');
        ctx.fillStyle = g;
        ctx.beginPath(); ctx.arc(32, 32, 30, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
        ctx.beginPath(); ctx.arc(20, 20, 6, 0, Math.PI*2); ctx.fill();
        return new THREE.CanvasTexture(c);
    })();

    // 2. Sleep Zzz
    const _napTex = (() => {
        const c = document.createElement('canvas');
        c.width = 64; c.height = 64;
        const ctx = c.getContext('2d');
        ctx.font = 'bold italic 48px sans-serif';
        ctx.fillStyle = '#ffffff';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.shadowColor = '#0000ff';
        ctx.shadowBlur = 4;
        ctx.fillText('Z', 32, 32);
        return new THREE.CanvasTexture(c);
    })();

    // 3. Wither Smoke
    const _witherTex = (() => {
        const c = document.createElement('canvas');
        c.width = 64; c.height = 64;
        const ctx = c.getContext('2d');
        const g = ctx.createRadialGradient(32, 32, 0, 32, 32, 32);
        g.addColorStop(0, 'rgba(80, 80, 80, 0.8)');
        g.addColorStop(0.5, 'rgba(40, 40, 40, 0.4)');
        g.addColorStop(1, 'rgba(0, 0, 0, 0)');
        ctx.fillStyle = g;
        ctx.fillRect(0, 0, 64, 64);
        return new THREE.CanvasTexture(c);
    })();

    // 4. Shockwave Ring (New)
    const _shockwaveTex = (() => {
        const c = document.createElement('canvas');
        c.width = 128; c.height = 128;
        const ctx = c.getContext('2d');
        const cx = 64, cy = 64;
        const g = ctx.createRadialGradient(cx, cy, 40, cx, cy, 60);
        g.addColorStop(0, 'rgba(255, 255, 255, 0)');
        g.addColorStop(0.5, 'rgba(255, 255, 255, 1)');
        g.addColorStop(1, 'rgba(255, 255, 255, 0)');
        ctx.fillStyle = g;
        ctx.fillRect(0, 0, 128, 128);
        return new THREE.CanvasTexture(c);
    })();

    // 5. Flash Star (New)
    const _flashTex = (() => {
        const c = document.createElement('canvas');
        c.width = 64; c.height = 64;
        const ctx = c.getContext('2d');
        const cx = 32, cy = 32;
        ctx.fillStyle = '#ffffff';
        ctx.beginPath();
        for(let i=0; i<4; i++) {
            const a = (i * Math.PI / 2);
            ctx.moveTo(cx, cy);
            ctx.lineTo(cx + Math.cos(a)*30, cy + Math.sin(a)*30);
            ctx.lineTo(cx + Math.cos(a + 0.2)*10, cy + Math.sin(a + 0.2)*10);
        }
        ctx.fill();
        const g = ctx.createRadialGradient(cx, cy, 0, cx, cy, 20);
        g.addColorStop(0, 'rgba(255, 255, 255, 1)');
        g.addColorStop(1, 'rgba(255, 255, 255, 0)');
        ctx.fillStyle = g;
        ctx.beginPath(); ctx.arc(cx, cy, 20, 0, Math.PI*2); ctx.fill();
        return new THREE.CanvasTexture(c);
    })();

    // 6. Debris Shard (New)
    const _debrisTex = (() => {
        const c = document.createElement('canvas');
        c.width = 32; c.height = 32;
        const ctx = c.getContext('2d');
        ctx.fillStyle = '#ffffff';
        ctx.beginPath();
        ctx.moveTo(16, 0); ctx.lineTo(32, 16); ctx.lineTo(16, 32); ctx.lineTo(0, 16);
        ctx.fill();
        return new THREE.CanvasTexture(c);
    })();
// 7. Bubble Texture (New: Aesthetic & Subtle)
// 7. Bubble Texture (New: Aesthetic & Subtle)
    const _bubbleTex = (() => {
        const c = document.createElement('canvas');
        c.width = 64; c.height = 64;
        const ctx = c.getContext('2d');
        
        // Clear
        ctx.clearRect(0, 0, 64, 64);

        // Main Bubble Body (Soft Gradient)
        const g = ctx.createRadialGradient(28, 28, 0, 32, 32, 30);
        g.addColorStop(0, 'rgba(255, 255, 255, 0.1)');
        g.addColorStop(0.5, 'rgba(100, 220, 255, 0.2)');
        g.addColorStop(0.9, 'rgba(50, 150, 255, 0.4)');
        g.addColorStop(1, 'rgba(50, 150, 255, 0.0)'); // Soft edge
        
        ctx.fillStyle = g;
        ctx.beginPath(); ctx.arc(32, 32, 30, 0, Math.PI*2); ctx.fill();
        
        // Sharp Specular Highlight (Reflection)
        const g2 = ctx.createRadialGradient(20, 20, 0, 20, 20, 12);
        g2.addColorStop(0, 'rgba(255, 255, 255, 0.9)');
        g2.addColorStop(1, 'rgba(255, 255, 255, 0.0)');
        
        ctx.fillStyle = g2;
        ctx.beginPath(); 
        ctx.ellipse(22, 22, 10, 6, -Math.PI / 4, 0, Math.PI * 2); 
        ctx.fill();
        
        // Bottom Rim Light
        ctx.strokeStyle = 'rgba(150, 255, 255, 0.3)';
        ctx.lineWidth = 2;
        ctx.beginPath(); ctx.arc(32, 32, 28, 0.2 * Math.PI, 0.8 * Math.PI); ctx.stroke();
        
return new THREE.CanvasTexture(c);
    })();

    // 8. Micro Bubble (New: Sharp, high-vis cavitation)
    const _microBubbleTex = (() => {
        const c = document.createElement('canvas');
        c.width = 32; c.height = 32;
        const ctx = c.getContext('2d');
        ctx.clearRect(0, 0, 32, 32);
        
        // Intense bright core
        const g = ctx.createRadialGradient(16, 16, 0, 16, 16, 16);
        g.addColorStop(0, 'rgba(255, 255, 255, 1.0)');
        g.addColorStop(0.3, 'rgba(220, 255, 255, 0.8)');
        g.addColorStop(0.6, 'rgba(100, 200, 255, 0.3)');
        g.addColorStop(1.0, 'rgba(0, 0, 0, 0)');
        
        ctx.fillStyle = g;
        ctx.beginPath(); ctx.arc(16, 16, 16, 0, Math.PI*2); ctx.fill();
        return new THREE.CanvasTexture(c);
    })();

    class ParticleManager {
        constructor(scene) {
            this.scene = scene;
            this.particles = [];
            
            // Shared Materials
            this.materials = {
                venom: new THREE.SpriteMaterial({ map: _venomTex, transparent: true, depthWrite: false, blending: THREE.AdditiveBlending }),
                nap: new THREE.SpriteMaterial({ map: _napTex, transparent: true, depthWrite: false, blending: THREE.NormalBlending }),
                wither: new THREE.SpriteMaterial({ map: _witherTex, transparent: true, depthWrite: false, blending: THREE.NormalBlending }),
                learned: new THREE.SpriteMaterial({ map: _venomTex, color: 0x00ffff, transparent: true, depthWrite: false, blending: THREE.AdditiveBlending }),
                shockwave: new THREE.SpriteMaterial({ map: _shockwaveTex, transparent: true, depthWrite: false, blending: THREE.AdditiveBlending }),
                flash: new THREE.SpriteMaterial({ map: _flashTex, transparent: true, depthWrite: false, blending: THREE.AdditiveBlending }),
                debris: new THREE.SpriteMaterial({ map: _debrisTex, transparent: true, depthWrite: false, blending: THREE.NormalBlending }),
                bubble: new THREE.SpriteMaterial({ map: _bubbleTex, transparent: true, depthWrite: false, blending: THREE.AdditiveBlending }),
                bubble_micro: new THREE.SpriteMaterial({ map: _microBubbleTex, transparent: true, depthWrite: false, blending: THREE.AdditiveBlending })
            };

            // Object Pool
// Object Pool
            this.pool = [];
            this.poolSize = 300; // Increased for debris
            
            for(let i=0; i<this.poolSize; i++) {
                // Create unique material for each sprite to prevent state sharing (flickering)
                const mat = this.materials.venom.clone();
                const sprite = new THREE.Sprite(mat); 
                sprite.visible = false;
                sprite.scale.set(0,0,0); 
                this.scene.add(sprite);
                this.pool.push(sprite);
            }
        }

spawn(type, pos, options = {}) {
            const p = this.pool.find(s => !s.visible);
            if (!p) return;

            p.visible = true;
            
            // Copy properties from template instead of sharing reference
            const template = this.materials[type] || this.materials.venom;
            p.material.map = template.map;
            p.material.blending = template.blending;
            p.material.depthWrite = template.depthWrite;
            p.material.transparent = template.transparent;

            p.position.copy(pos);
            
            // Reset rotation & color
            p.material.rotation = 0;
            p.material.color.setHex(0xffffff);
            p.material.opacity = 1.0;

            const data = {


                mesh: p,
                type: type,
                age: 0,
                life: options.life || 1.0,
                maxLife: options.life || 1.0,
                velocity: new THREE.Vector3(0, 0, 0),
                startScale: options.scale || 1.0,
                gravity: 0,
                drag: 0
            };

            // Configuration per type
            if (type === 'venom') {
                data.life = 1.0 + Math.random() * 0.5;
                data.velocity.set(0, 1.0 + Math.random(), 0);
                data.startScale = 0.3 + Math.random() * 0.2;
                p.material.opacity = 0.8;
                
            } else if (type === 'nap') {
                data.life = 2.0;
                data.velocity.set((Math.random()-0.5)*0.2, 0.5, (Math.random()-0.5)*0.2);
                data.startScale = 0.4;
                p.material.opacity = 1.0;

            } else if (type === 'wither') {
                data.life = 1.5;
                data.velocity.set((Math.random()-0.5)*0.5, 0.5, (Math.random()-0.5)*0.5);
                p.material.opacity = 0.6;
                p.material.rotation = Math.random() * Math.PI;

            } else if (type === 'shockwave') {
                data.life = options.life || 0.4;
                data.maxLife = data.life;
                data.startScale = options.scale || 2.0;
                p.material.opacity = 1.0;
                // Shockwaves grow rapidly
                
            } else if (type === 'flash') {
                data.life = 0.2;
                data.maxLife = 0.2;
                data.startScale = options.scale || 3.0;
                p.material.opacity = 1.0;
                p.material.rotation = Math.random() * Math.PI;

            } else if (type === 'debris') {
                data.life = 1.5;
                data.maxLife = 1.5;
                const speed = 5.0 + Math.random() * 10.0;
                data.velocity.set(
                    (Math.random()-0.5) * speed,
                    (Math.random() * speed * 0.5) + 2.0,
                    (Math.random()-0.5) * speed
                );
                data.gravity = 20.0;
                data.drag = 1.0;
                data.startScale = (options.scale || 0.3) * (0.5 + Math.random());
                p.material.opacity = 1.0;
p.material.opacity = 1.0;
                p.material.rotation = Math.random() * Math.PI;
                data.life = 1.0 + Math.random() * 1.0; // Longer life
                data.maxLife = data.life;
                data.velocity.set(
                    (Math.random() - 0.5) * 0.5, // Gentle drift X
                    0.5 + Math.random() * 1.0,   // Rise Y
                    (Math.random() - 0.5) * 0.5  // Gentle drift Z
                );
                data.startScale = (options.scale || 0.2) * (0.8 + Math.random() * 0.4);
                p.material.opacity = 0.6; // More transparent
                p.material.color.setHex(0xaaccff); // Slight blue tint
            } else if (type === 'bubble_micro') {
                // CAVITATION BUBBLES: Fast, short-lived, bright
                data.life = 0.4 + Math.random() * 0.4;
                data.maxLife = data.life;
                data.velocity.set(
                    (Math.random() - 0.5) * 1.5, // Jittery X
                    1.5 + Math.random() * 2.0,   // Fast Rise Y
                    (Math.random() - 0.5) * 1.5  // Jittery Z
                );
                data.startScale = (options.scale || 0.08) * (0.8 + Math.random() * 0.5);
                p.material.opacity = 0.9; // High visibility
                p.material.color.setHex(0xffffff); // Pure white/cyan core
            }

            // Apply initial scale
            // Apply initial scale
            if (type !== 'shockwave') {
                p.scale.setScalar(data.startScale);
            } else {
                p.scale.setScalar(0.1); // Shockwaves start small
            }

            this.particles.push(data);
        }

        update(dt) {
            for (let i = this.particles.length - 1; i >= 0; i--) {
                const p = this.particles[i];
                p.age += dt;

                if (p.age >= p.life) {
                    p.mesh.visible = false;
                    p.mesh.scale.set(0,0,0);
                    this.particles.splice(i, 1);
                    continue;
                }

                const t = p.age / p.life;

                // Physics
                if (p.gravity > 0) p.velocity.y -= p.gravity * dt;
                if (p.drag > 0) p.velocity.multiplyScalar(Math.max(0, 1.0 - (p.drag * dt)));
                p.mesh.position.addScaledVector(p.velocity, dt);

                // Behavior
                if (p.type === 'shockwave') {
                    // Rapid expansion
                    const s = p.startScale * Math.pow(t, 0.5) * 5.0; 
                    p.mesh.scale.setScalar(s);
                    p.mesh.material.opacity = 1.0 - Math.pow(t, 2); // Fade out
                    
                } else if (p.type === 'flash') {
                    // Quick pop
                    const s = p.startScale * (1.0 - t);
                    p.mesh.scale.setScalar(s);
                    p.mesh.material.rotation += 5.0 * dt;

                } else if (p.type === 'debris') {
                    // Spin and shrink
                    p.mesh.material.rotation += 10.0 * dt;
                    p.mesh.scale.setScalar(p.startScale * (1.0 - t));
                    
                } else if (p.type === 'venom') {
                    p.mesh.position.x += Math.sin(p.age * 10 + p.mesh.id) * dt * 0.5;
                    p.mesh.material.opacity = 0.8 * (1.0 - Math.pow(t, 3));
                    
                } else if (p.type === 'nap') {
                    const s = p.startScale * (0.5 + t * 1.5);
                    p.mesh.scale.setScalar(s);
                    p.mesh.material.opacity = 1.0 - Math.pow(t, 2);
p.mesh.position.x += Math.sin(p.age * 2) * dt * 0.3;
                } else if (p.type === 'bubble') {
                    // Aesthetic Wobble
                    p.mesh.position.x += Math.sin(p.age * 5.0 + p.mesh.id) * dt * 0.2;
                    p.mesh.position.z += Math.cos(p.age * 4.0 + p.mesh.id) * dt * 0.2;
                    
                    // Scale up slightly then fade
                    const s = p.startScale * (1.0 + t * 0.2);
                    p.mesh.scale.setScalar(s);
                    p.mesh.material.opacity = 0.6 * (1.0 - Math.pow(t, 2)); // Smooth fade
                } else if (p.type === 'bubble_micro') {
                    // Chaotic Jitter
                    p.mesh.position.x += (Math.random() - 0.5) * dt * 2.0;
                    p.mesh.position.z += (Math.random() - 0.5) * dt * 2.0;
                    
                    // Shrink rapidly
                    const s = p.startScale * (1.0 - t);
                    p.mesh.scale.setScalar(s);
                    p.mesh.material.opacity = 0.9 * (1.0 - t); // Linear fade
}
            }
        }
    }
    window.flux.ParticleManager = ParticleManager;
})();</script>
    <script>(function() {
    window.flux = window.flux || {};

    // --- TEXTURE GENERATION ---
    const _createGlyphTexture = (colorStr, type) => {
        const size = 256;
        const c = document.createElement('canvas');
        c.width = size; c.height = size;
        const ctx = c.getContext('2d');
        
        ctx.clearRect(0, 0, size, size);
        
        // Glow settings
        ctx.shadowBlur = 15;
        ctx.shadowColor = colorStr;
        ctx.strokeStyle = colorStr;
        ctx.fillStyle = colorStr;
        ctx.lineCap = 'round';

        const cx = size / 2;
        const cy = size / 2;

        if (type === 'ring') {
            // Outer Ring
            ctx.lineWidth = 6;
            ctx.beginPath();
            ctx.arc(cx, cy, 110, 0, Math.PI * 2);
            ctx.stroke();

            // Inner Ring
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(cx, cy, 90, 0, Math.PI * 2);
            ctx.stroke();

            // Runes
            ctx.font = 'bold 24px sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            for(let i=0; i<8; i++) {
                const angle = (i / 8) * Math.PI * 2;
                const r = 100;
                const x = cx + Math.cos(angle) * r;
                const y = cy + Math.sin(angle) * r;
                
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(angle + Math.PI/2);
                // Draw a simple rune-like shape
                ctx.beginPath();
                ctx.moveTo(-5, -5); ctx.lineTo(5, 0); ctx.lineTo(-5, 5);
                ctx.stroke();
                ctx.restore();
            }
        } else if (type === 'rune') {
            // Central Complex Rune
            ctx.lineWidth = 5;
            ctx.beginPath();
            ctx.arc(cx, cy, 60, 0, Math.PI * 2);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(cx, cy - 60);
            ctx.lineTo(cx, cy + 60);
            ctx.moveTo(cx - 60, cy);
            ctx.lineTo(cx + 60, cy);
            ctx.stroke();

            ctx.beginPath();
            ctx.arc(cx, cy, 20, 0, Math.PI * 2);
            ctx.fill();
        }

        const tex = new THREE.CanvasTexture(c);
        return tex;
    };

    const _techTexture = _createGlyphTexture('#00ffff', 'ring'); // Cyan Ring
    const _statusTexture = _createGlyphTexture('#ff00ff', 'rune'); // Magenta Rune
    const _chargeTexture = _createGlyphTexture('#ffff00', 'ring'); // Gold Ring

    class GlyphManager {
        constructor(scene) {
            this.scene = scene;
            this.glyphs = [];
            
            // Materials
            this.materials = {
                tech: new THREE.MeshBasicMaterial({ 
                    map: _techTexture, 
                    transparent: true, 
                    side: THREE.DoubleSide, 
                    blending: THREE.AdditiveBlending,
                    depthWrite: false,
                    color: 0xffffff
                }),
                status: new THREE.MeshBasicMaterial({ 
                    map: _statusTexture, 
                    transparent: true, 
                    side: THREE.DoubleSide, 
                    blending: THREE.AdditiveBlending,
                    depthWrite: false,
                    color: 0xffffff
                }),
                charge: new THREE.MeshBasicMaterial({ 
                    map: _chargeTexture, 
                    transparent: true, 
                    side: THREE.DoubleSide, 
                    blending: THREE.AdditiveBlending,
                    depthWrite: false,
                    color: 0xffffff
                })
            };

            // Pool
            this.pool = [];
            this.poolSize = 30;
            const geo = new THREE.PlaneGeometry(1, 1);
            
            for(let i=0; i<this.poolSize; i++) {
                const mesh = new THREE.Mesh(geo, this.materials.tech);
                mesh.visible = false;
                mesh.renderOrder = 2000; // Draw on top of water/arena
                this.scene.add(mesh);
                this.pool.push(mesh);
            }
        }

        spawn(type, pos, options = {}) {
            const mesh = this.pool.find(m => !m.visible);
            if (!mesh) return;

            mesh.visible = true;
            mesh.material = this.materials[type] || this.materials.tech;
            mesh.position.copy(pos);
            
            // Reset Material Opacity
            mesh.material.opacity = 1.0;

            // Defaults
            const scale = options.scale || 1.0;
            mesh.scale.set(scale, scale, scale);
            
            // Orientation
            if (options.faceCamera) {
                if (window.flux.gameInstance && window.flux.gameInstance.camera) {
                    mesh.lookAt(window.flux.gameInstance.camera.position);
                }
            } else if (options.orientation === 'vertical') {
                mesh.rotation.set(0, 0, 0);
                // Face camera Y-axis rotation only
                if (window.flux.gameInstance && window.flux.gameInstance.camera) {
                    const camPos = window.flux.gameInstance.camera.position;
                    const angle = Math.atan2(camPos.x - pos.x, camPos.z - pos.z);
                    mesh.rotation.y = angle;
                }
            } else {
                // Horizontal (Ground)
                mesh.rotation.set(-Math.PI / 2, 0, Math.random() * Math.PI);
            }

            if (options.offsetY) {
                mesh.position.y += options.offsetY;
            }

            this.glyphs.push({
                mesh: mesh,
                age: 0,
                life: options.life || 1.0,
                maxLife: options.life || 1.0,
                rotationSpeed: options.rotationSpeed || 1.0,
                scaleSpeed: options.scaleSpeed || 0,
                fade: options.fade !== undefined ? options.fade : true,
                followTarget: options.parent || null,
                offsetY: options.offsetY || 0
            });
        }

        update(dt) {
            for (let i = this.glyphs.length - 1; i >= 0; i--) {
                const g = this.glyphs[i];
                g.age += dt;

                if (g.age >= g.life) {
                    g.mesh.visible = false;
                    this.glyphs.splice(i, 1);
                    continue;
                }

                const t = g.age / g.maxLife;

                // Follow target
                if (g.followTarget && g.followTarget.mesh) {
                    g.mesh.position.copy(g.followTarget.mesh.position);
                    g.mesh.position.y += g.offsetY;
                    
                    // If ground oriented, keep near floor
                    if (g.mesh.rotation.x === -Math.PI/2) {
                         g.mesh.position.y = 0.1 + g.offsetY;
                    }
                }

                // Animation
                g.mesh.rotation.z += g.rotationSpeed * dt;
                
                if (g.scaleSpeed !== 0) {
                    const s = g.mesh.scale.x + g.scaleSpeed * dt;
                    g.mesh.scale.set(s, s, s);
                }

                // Fade
                if (g.fade) {
                    let opacity = 1.0;
                    if (t < 0.1) opacity = t / 0.1;
                    else if (t > 0.7) opacity = 1.0 - ((t - 0.7) / 0.3);
                    g.mesh.material.opacity = opacity;
                }
            }
        }
    }

    window.flux.GlyphManager = GlyphManager;
})();</script>
    <script>(function() {
    window.flux = window.flux || {};

    // Reusable vectors to avoid Garbage Collection
    const _idealPos = new THREE.Vector3();
    const _idealLook = new THREE.Vector3();
    const _currentPos = new THREE.Vector3();
    const _currentLook = new THREE.Vector3();
    const _velocity = new THREE.Vector3();
    const _targetWorldPos = new THREE.Vector3();
    const _camOffset = new THREE.Vector3();
    const _lookAhead = new THREE.Vector3();
    const _goalPos = new THREE.Vector3();
    const _camFwd = new THREE.Vector3();
    const _camRight = new THREE.Vector3();

    class CameraManager {
        constructor(camera, scene) {
            this.camera = camera;
            this.scene = scene;

            // --- IMPROVED CONFIGURATION ---
            this.config = {
                // FIXED PERSPECTIVE SETTINGS
                baseDistance: 22.0,
                baseHeight: 14.0,

                // IMPROVED: Faster, more responsive smoothing
                followSpeed: 4.0,     // Increased from 2.5
                lookSpeed: 5.0,       // Increased from 3.5

                // Dynamic FOV
                fovBase: 50,
                fovMax: 60,

                // IMPROVED: Look-ahead settings
                lookAheadDistance: 6.0,
                lookAheadSmoothing: 3.0,

                // Smart framing
                ballTrackWeight: 0.3,
                threatAwareness: true
            };

            // State
            this.target = null;
            this.ball = null; // Direct ball reference for smart framing
            this.targetVel = new THREE.Vector3();
            this.targetInput = new THREE.Vector3();
            this.smoothedInput = new THREE.Vector3();
            this.smoothedLookAhead = new THREE.Vector3();

            // Camera State
            this.pos = camera.position.clone();
            this.lookAt = new THREE.Vector3(0, 0, 0);

            // Orbit State
            this.currentYaw = Math.PI;
            this.targetYaw = Math.PI;

            // IMPROVED: Manual orbit from touch (right side of screen)
            this.manualOrbitYaw = 0;
            this.manualOrbitPitch = 0;
            this.orbitSensitivity = 0.004;
            this.autoRecenterTimer = 0;
            this.autoRecenterDelay = 3.0;

// Shake
            this.shakeIntensity = 0;
            this.shakeRoll = 0; // NEW: Rotational shake
            this.shakeOffset = new THREE.Vector3();
            this.fovImpulse = 0;

            // Cinematic State
            this.isCinematic = false;
            this.cinematicTimer = 0;
            this.cinematicDuration = 0;
            this.cinematicType = 'default';
            this.cinematicStartPos = new THREE.Vector3();
            this.cinematicStartLook = new THREE.Vector3();
            this.cinematicEndPos = new THREE.Vector3();

            // IMPROVED: Dynamic pull-back based on action
            this.currentPullBack = 0;
            this.maxPullBack = 8;
        }

        // NEW: Set ball reference for smart framing
        setBall(ball) {
            this.ball = ball;
        }

        // IMPROVED: Get camera-relative input transformation
        getCameraRelativeInput(inputX, inputZ) {
            this.camera.getWorldDirection(_camFwd);
            _camFwd.y = 0;

            if (_camFwd.lengthSq() < 0.001) {
                _camFwd.set(0, 0, -1);
            } else {
                _camFwd.normalize();
            }

            _camRight.crossVectors(new THREE.Vector3(0, 1, 0), _camFwd).normalize();

            // Transform input to world space
            const worldX = (inputX * _camRight.x) + (inputZ * _camFwd.x);
            const worldZ = (inputX * _camRight.z) + (inputZ * _camFwd.z);

            return { x: worldX, z: worldZ };
        }

        // NEW: Manual orbit input from touch
        handleOrbitInput(dx, dy) {
            this.manualOrbitYaw += dx * this.orbitSensitivity;
            this.manualOrbitPitch += dy * this.orbitSensitivity * 0.5;

            // Clamp pitch
            this.manualOrbitPitch = Math.max(-0.3, Math.min(0.5, this.manualOrbitPitch));

            // Reset auto-recenter timer
            this.autoRecenterTimer = 0;
        }

        // NEW: Recenter camera
        recenter() {
            this.manualOrbitYaw = 0;
            this.manualOrbitPitch = 0;
        }

        playCinematic(type, target, duration = 1.5) {
            this.isCinematic = true;
            this.cinematicTimer = 0;
            this.cinematicDuration = duration;
            this.target = target;
            this.cinematicType = type;

            this.cinematicStartPos.copy(this.pos);
            this.cinematicStartLook.copy(this.lookAt);

            this.addFovImpulse(-15);
        }

        _updateCinematic(dt) {
            this.cinematicTimer += dt;
            const progress = Math.min(1.0, this.cinematicTimer / this.cinematicDuration);

            const t = 1 - Math.pow(1 - progress, 3);

            let activeTarget = this.target;
            let isBallTracking = false;
            const ball = window.flux.gameInstance ? window.flux.gameInstance.entities.ball : null;

            if (ball && ball.mesh && ball.state === 'free' && ball.velocity.lengthSq() > 2.0) {
                activeTarget = ball.mesh;
                isBallTracking = true;
            }

            if (!activeTarget) {
                this.isCinematic = false;
                return;
            }

            activeTarget.getWorldPosition(_targetWorldPos);

            const endLook = _targetWorldPos.clone();
            let fwd = new THREE.Vector3();
            let right = new THREE.Vector3();

            if (isBallTracking) {
                endLook.addScaledVector(ball.velocity, 0.3);

                fwd.copy(ball.velocity).normalize();
                fwd.y = 0;
                if (fwd.lengthSq() < 0.01) fwd.set(0,0,1);
                fwd.normalize();

                right.crossVectors(new THREE.Vector3(0,1,0), fwd).normalize();
            } else {
                endLook.y += 1.5;
                fwd.set(0, 0, 1).applyQuaternion(activeTarget.quaternion);
                right.set(1, 0, 0).applyQuaternion(activeTarget.quaternion);
            }

            const endPos = _targetWorldPos.clone();

            if (this.cinematicType === 'jecht') {
                const dist = isBallTracking ? 14.0 : 10.0;
                const offset = fwd.clone().multiplyScalar(-dist).add(right.clone().multiplyScalar(3.0));
                endPos.add(offset);
                endPos.y += 6.0;
            } else if (this.cinematicType === 'sphere') {
                const dist = isBallTracking ? 16.0 : 12.0;
                const offset = fwd.clone().multiplyScalar(-dist);
                endPos.add(offset);
                endPos.y += 10.0;
            } else if (this.cinematicType === 'invisible') {
                const dist = 12.0;
                const offset = fwd.clone().multiplyScalar(-dist * 0.5).add(right.clone().multiplyScalar(dist));
                endPos.add(offset);
                endPos.y += 5.0;
            } else {
                const dist = isBallTracking ? 14.0 : 10.0;
                const offset = fwd.clone().multiplyScalar(-dist);
                endPos.add(offset);
                endPos.y += 5.0;
            }

            this.pos.lerp(endPos, dt * 4.0);
            this.lookAt.lerp(endLook, dt * 6.0);

            this.camera.position.copy(this.pos);
            this.camera.lookAt(this.lookAt);

            if (this.cinematicTimer >= this.cinematicDuration) {
                this.isCinematic = false;
            }
        }

        setTarget(mesh, velocity, input) {
            this.target = mesh;
            if (velocity) this.targetVel.copy(velocity);
            if (input) this.targetInput.copy(input);
            else this.targetInput.set(0, 0, 0);
        }

        // Keep for compatibility
        handleInput(dx, dy) {
            this.handleOrbitInput(dx, dy);
        }

        getYaw() { return this.currentYaw; }

        addShake(amount) {

            this.shakeIntensity = Math.min(this.shakeIntensity + amount, 4.0); // Increased cap
            this.shakeRoll = Math.min(this.shakeRoll + amount * 0.2, 0.8); // Add roll
        }
        addFovImpulse(amount) {
            this.fovImpulse = Math.min(this.fovImpulse + amount, 30);
        }

        snapToTarget() {
            if (!this.target) return;
            this.target.getWorldPosition(_targetWorldPos);

            this._calculateIdealState(0);

            this.pos.copy(_idealPos);
            this.lookAt.copy(_idealLook);
            this.currentYaw = this.targetYaw;

            this.camera.position.copy(this.pos);
            this.camera.lookAt(this.lookAt);

            this.smoothedInput.set(0, 0, 0);
            this.smoothedLookAhead.set(0, 0, 0);
        }

        update(dt) {
            if (this.isCinematic) {
                this._updateCinematic(dt);
                return;
            }

            if (!this.target) return;

            const safeDt = Math.min(dt, 0.05);

            // IMPROVED: Auto-recenter logic
            this.autoRecenterTimer += safeDt;
            if (this.autoRecenterTimer > this.autoRecenterDelay) {
                const recenterSpeed = 2.0 * safeDt;
                this.manualOrbitYaw *= (1.0 - recenterSpeed);
                this.manualOrbitPitch *= (1.0 - recenterSpeed);
            }

            // IMPROVED: Smart pull-back based on ball speed
            if (this.ball && this.ball.velocity) {
                const ballSpeed = this.ball.velocity.length();
                const targetPullBack = Math.min(this.maxPullBack, ballSpeed * 0.3);
                this.currentPullBack += (targetPullBack - this.currentPullBack) * safeDt * 3.0;
            } else {
                this.currentPullBack *= (1.0 - safeDt * 2.0);
            }

            // 1. Update Target Info
            this.target.getWorldPosition(_targetWorldPos);

            // 2. Calculate Ideal State
            this._calculateIdealState(safeDt);

            // 3. IMPROVED: Faster, more responsive smoothing
            const posFactor = 1.0 - Math.exp(-this.config.followSpeed * safeDt);
            const lookFactor = 1.0 - Math.exp(-this.config.lookSpeed * safeDt);

            this.pos.lerp(_idealPos, posFactor);
            this.lookAt.lerp(_idealLook, lookFactor);

// 4. Screen Shake (Position & Rotation)
            if (this.shakeIntensity > 0) {
                const decay = 8.0 * safeDt; // Fast decay for snappy feel
                this.shakeIntensity -= decay;
                if (this.shakeIntensity < 0) this.shakeIntensity = 0;

                const shakeMag = this.shakeIntensity * 0.5;
                this.shakeOffset.set(
                    (Math.random() - 0.5) * shakeMag,
                    (Math.random() - 0.5) * shakeMag,
                    (Math.random() - 0.5) * shakeMag
                );
            } else {
                this.shakeOffset.set(0, 0, 0);
            }

            // Roll Shake
            if (this.shakeRoll > 0) {
                this.shakeRoll -= 5.0 * safeDt;
                if (this.shakeRoll < 0) this.shakeRoll = 0;
                this.camera.rotation.z = (Math.random() - 0.5) * this.shakeRoll;
            } else {
                this.camera.rotation.z = 0;
            }

            // 5. Dynamic FOV
            const speed = this.targetVel.length();
            const speedRatio = Math.min(speed / 20.0, 1.0);
            const warp = speedRatio * speedRatio;

            const targetFov = this.config.fovBase + (this.config.fovMax - this.config.fovBase) * warp + this.fovImpulse;

            this.fovImpulse *= Math.max(0, 1.0 - (5.0 * safeDt));

            this.camera.fov += (targetFov - this.camera.fov) * 3.0 * safeDt;
            this.camera.updateProjectionMatrix();

            // 6. Apply to Camera
            this.camera.position.copy(this.pos).add(this.shakeOffset);
            this.camera.lookAt(this.lookAt);
        }

        _calculateIdealState(dt) {
            const tPos = _targetWorldPos;

            // IMPROVED: Apply manual orbit
            const orbitedX = tPos.x * Math.cos(this.manualOrbitYaw) - tPos.z * Math.sin(this.manualOrbitYaw);

            // 1. Calculate Ideal Position with pull-back
            const effectiveDistance = this.config.baseDistance + this.currentPullBack;
            const effectiveHeight = this.config.baseHeight + this.currentPullBack * 0.3 + this.manualOrbitPitch * 10;

            const camX = tPos.x * 0.9;
            const camY = (tPos.y * 0.1) + effectiveHeight;
            let camZ = tPos.z + effectiveDistance;

            // IMPROVED: Apply orbit rotation to camera position
            const finalCamX = camX * Math.cos(this.manualOrbitYaw) + effectiveDistance * Math.sin(this.manualOrbitYaw);
            const finalCamZ = camZ * Math.cos(this.manualOrbitYaw) - camX * Math.sin(this.manualOrbitYaw);

            if (finalCamZ > 38.0) {
                _idealPos.set(finalCamX, camY, 38.0);
            } else {
                _idealPos.set(finalCamX, camY, finalCamZ);
            }

            // 2. Calculate Ideal LookAt with IMPROVED look-ahead
            _idealLook.copy(tPos);

            // IMPROVED: Velocity-based look-ahead
            if (this.targetVel.lengthSq() > 0.5) {
                const speed = this.targetVel.length();
                const lookAheadFactor = Math.min(1.0, speed / 10.0) * this.config.lookAheadDistance;

                const velDir = this.targetVel.clone().normalize();
                _lookAhead.copy(velDir).multiplyScalar(lookAheadFactor);

                // Smooth the look-ahead
                this.smoothedLookAhead.lerp(_lookAhead, dt * this.config.lookAheadSmoothing);
                _idealLook.add(this.smoothedLookAhead);
            } else {
                this.smoothedLookAhead.multiplyScalar(1.0 - dt * 2.0);
                _idealLook.add(this.smoothedLookAhead);
            }

            _idealLook.z -= 5.0;
            _idealLook.y *= 0.5;

            // IMPROVED: Include ball in framing when nearby
            if (this.ball && this.ball.mesh && this.config.ballTrackWeight > 0) {
                const ballPos = this.ball.mesh.position;
                const distToBall = tPos.distanceTo(ballPos);

                if (distToBall < 20 && distToBall > 2) {
                    const ballWeight = Math.max(0, 1 - distToBall / 20) * this.config.ballTrackWeight;
                    _idealLook.lerp(ballPos, ballWeight);
                }
            }

            // 3. Input Anticipation (Smoothed)
            this.smoothedInput.lerp(this.targetInput, dt * 2.0);

            if (this.smoothedInput.lengthSq() > 0.01) {
                _idealLook.x += this.smoothedInput.x * 3.0;
                _idealLook.z += this.smoothedInput.z * 3.0;
            }
        }

        // NEW: Get forward direction for UI reference
        getForwardDirection() {
            this.camera.getWorldDirection(_camFwd);
            _camFwd.y = 0;
            if (_camFwd.lengthSq() < 0.001) {
                _camFwd.set(0, 0, -1);
            } else {
                _camFwd.normalize();
            }
            return _camFwd.clone();
        }

        // NEW: Get right direction
        getRightDirection() {
            const fwd = this.getForwardDirection();
            _camRight.crossVectors(new THREE.Vector3(0, 1, 0), fwd).normalize();
            return _camRight.clone();
        }
    }

    window.flux.CameraManager = CameraManager;
})();
</script>
    <script>(function() {
    window.flux = window.flux || {};

    class DevTools {
        constructor(gameManager) {
            this.game = gameManager;
            
            // lil-gui attaches to window.lil by default in UMD build
            if (!window.lil || !window.lil.GUI) {
                console.warn("DevTools: lil-gui not found.");
                return;
            }

const container = document.getElementById('game-container');
            this.gui = new window.lil.GUI({ title: 'Flux DevTools', container: container });
            
            // Position as a collapsed tab on the right frame
// Position as a sliding tab on the right frame
// Position as a sliding tab on the right frame
// Wrapper for sliding animation
            const wrapper = document.createElement('div');
            wrapper.style.position = 'absolute';
            wrapper.style.top = '100px';
            wrapper.style.right = '-260px';
            wrapper.style.width = '260px';
            wrapper.style.transition = 'right 0.3s cubic-bezier(0.2, 0.8, 0.2, 1.0)';
            wrapper.style.zIndex = '9999';
            wrapper.style.display = 'flex';
            wrapper.style.flexDirection = 'column';
            container.appendChild(wrapper);

            const dom = this.gui.domElement;
            dom.style.width = '100%';
            dom.style.setProperty('--width', '100%');
            dom.style.maxHeight = '80vh';
            dom.style.overflowY = 'auto';
            dom.style.overflowX = 'hidden';
            
            // Move GUI into wrapper
            wrapper.appendChild(dom);
            
            // Create Toggle Handle
            const handle = document.createElement('div');
            handle.style.position = 'absolute';
            handle.style.left = '-40px'; // Protrude to the left
            handle.style.top = '0';
            handle.style.width = '40px';
            handle.style.height = '40px';
            handle.style.backgroundColor = 'rgba(0, 20, 40, 0.9)';
            handle.style.border = '1px solid #00ffff';
            handle.style.borderRight = 'none';
            handle.style.borderTopLeftRadius = '8px';
            handle.style.borderBottomLeftRadius = '8px';
            handle.style.cursor = 'pointer';
            handle.style.display = 'flex';
            handle.style.justifyContent = 'center';
            handle.style.alignItems = 'center';
            handle.style.color = '#00ffff';
            handle.style.fontSize = '20px';
            handle.innerHTML = '';
            handle.style.boxShadow = '-5px 0 10px rgba(0,0,0,0.5)';
            
            wrapper.appendChild(handle);
            
            // Toggle Logic
            let isOpen = false;
            handle.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent game inputs
                isOpen = !isOpen;
                wrapper.style.right = isOpen ? '0px' : '-260px';
                handle.innerHTML = isOpen ? '' : '';
            });
            // Default global timeScale if not set
if (window.flux.timeScale === undefined) window.flux.timeScale = 0.8;

this._setupGeneral();
            this._setupGameState();
this._setupOverlays();
            this._setupTeams();
            this._setupPlayerInspector();
            this._setupBallSandbox();
this._setupFXLab();
            this._setupVisuals();
        }

_setupGeneral() {
            const folder = this.gui.addFolder('General');
            
const params = {
                timeScale: window.flux.timeScale,
                demoMode: this.game.isDemoMode,
                toggleHUD: true,
                resolution: 0.50,
                arenaOpacity: 0.0,
                arena2Opacity: 0.05
            };

            folder.add(params, 'timeScale', 0.0, 5.0).name('Game Speed').onChange(v => {
                window.flux.timeScale = v;
            });

            folder.add(params, 'demoMode').name('Demo Mode').listen().onChange(v => {
                if (this.game.isDemoMode !== v) {
                    this.game.toggleDemoMode();
                }
            });

            folder.add(params, 'toggleHUD').name('Show HUD').onChange(v => {
                const hud = document.getElementById('ui-layer');
                if (hud) {
                    hud.style.visibility = v ? 'visible' : 'hidden';
                }
            });

            folder.add(params, 'resolution', 0.1, 2.0).name('Resolution Scale').onChange(v => {
                const w = window.innerWidth;
                const h = window.innerHeight;
                const renderer = this.game.renderer;
                if (renderer) {
                    renderer.setSize(w * v, h * v, false);
                }
            });

folder.add(params, 'arenaOpacity', 0.0, 1.0).name('Arena 1 Opacity').onChange(v => {
                if (window.flux.arenaMesh && window.flux.arenaMesh.material) {
                    window.flux.arenaMesh.material.opacity = v;
                }
            });

            const blendModes = {
                'Normal': THREE.NormalBlending,
                'Additive': THREE.AdditiveBlending,
                'Multiply': THREE.MultiplyBlending,
                'Subtractive': THREE.SubtractiveBlending,
                'NoBlending': THREE.NoBlending
            };
            params.arenaBlend = 'Multiply';

            folder.add(params, 'arenaBlend', Object.keys(blendModes)).name('Arena 1 Blend').onChange(v => {
                if (window.flux.arenaMesh && window.flux.arenaMesh.material) {
                    window.flux.arenaMesh.material.blending = blendModes[v];
                    window.flux.arenaMesh.material.needsUpdate = true;
                }
            });

            // Arena 2 Controls
            folder.add(params, 'arena2Opacity', 0.0, 1.0).name('Arena 2 Opacity').onChange(v => {
                if (window.flux.arenaMesh2 && window.flux.arenaMesh2.material) {
                    window.flux.arenaMesh2.material.opacity = v;
                }
            });

            params.arena2Blend = 'Normal';
            folder.add(params, 'arena2Blend', Object.keys(blendModes)).name('Arena 2 Blend').onChange(v => {
                if (window.flux.arenaMesh2 && window.flux.arenaMesh2.material) {
                    window.flux.arenaMesh2.material.blending = blendModes[v];
                    window.flux.arenaMesh2.material.needsUpdate = true;
                }
            });
            
            // Apply defaults
            if (window.flux.arenaMesh && window.flux.arenaMesh.material) {
                window.flux.arenaMesh.material.opacity = params.arenaOpacity;
            }
            if (window.flux.arenaMesh2 && window.flux.arenaMesh2.material) {
                window.flux.arenaMesh2.material.opacity = params.arena2Opacity;
            }
        }

_setupOverlays() {
            const folder = this.gui.addFolder('Overlays & FX');
            
            // 1. GIF Overlay
            const gifEl = document.getElementById('screen-overlay-gif');
            if (gifEl) {
                const gifParams = {
                    visible: true,
                    opacity: 0.72,
                    blend: 'soft-light'
                };
                
                const gFolder = folder.addFolder('Screen GIF');
                gFolder.add(gifParams, 'visible').onChange(v => gifEl.style.display = v ? 'block' : 'none');
                gFolder.add(gifParams, 'opacity', 0.0, 1.0).onChange(v => gifEl.style.opacity = v);
                
                const blendModes = [
                    'normal', 'multiply', 'screen', 'overlay', 
                    'darken', 'lighten', 'color-dodge', 'color-burn', 
                    'hard-light', 'soft-light', 'difference', 'exclusion', 
                    'hue', 'saturation', 'color', 'luminosity'
                ];
                gFolder.add(gifParams, 'blend', blendModes).onChange(v => gifEl.style.mixBlendMode = v);
            }

            // 2. Water Overlay
            const wo = this.game.waterOverlay;
            if (wo && wo.mesh) {
                const wFolder = folder.addFolder('Water Shader');
                const wParams = { 
                    visible: true,
                    opacity: wo.material.uniforms.uOpacity ? wo.material.uniforms.uOpacity.value : 0.5,
                    blend: 'Additive'
                };
                
                wFolder.add(wParams, 'visible').onChange(v => wo.mesh.visible = v);
                
                if (wo.material.uniforms.uOpacity) {
                    wFolder.add(wParams, 'opacity', 0.0, 2.0).onChange(v => wo.material.uniforms.uOpacity.value = v);
                }

                const threeBlends = {
                    'Normal': THREE.NormalBlending,
                    'Additive': THREE.AdditiveBlending,
                    'Subtractive': THREE.SubtractiveBlending,
                    'Multiply': THREE.MultiplyBlending,
                    'NoBlending': THREE.NoBlending
                };
                
                wFolder.add(wParams, 'blend', Object.keys(threeBlends)).onChange(v => {
                    wo.material.blending = threeBlends[v];
                    wo.material.needsUpdate = true;
                });
            }

            // 3. Light Shafts
            const ls = this.game.lightShafts;
            if (ls && ls.container) {
                const lParams = { visible: true };
                folder.add(lParams, 'visible').name('Light Shafts').onChange(v => ls.container.visible = v);
            }
        }

_setupGameState() {
            const folder = this.gui.addFolder('Game State');
            const gm = this.game;
            
            const params = {
                forceHomeGoal: () => { 
                    if(gm.state === 'active') gm.goalScored('home'); 
                    else console.warn("Game must be active to trigger goal");
                },
                forceAwayGoal: () => { 
                    if(gm.state === 'active') gm.goalScored('away');
                    else console.warn("Game must be active to trigger goal");
                },
                forceHalftime: () => {
                    if(gm.state === 'active') gm.endHalf();
                },
                resetRound: () => gm.resetRound(),
                exitToMenu: () => {
                    if (window.flux.gameInstance && window.flux.gameInstance.menuManager) {
                        window.flux.gameInstance.menuManager.show();
                        window.flux.gameInstance.state = 'menu';
                        // Stop practice if running
                        if (window.flux.gameInstance.practiceManager) {
                            window.flux.gameInstance.practiceManager.stop();
                        }
                    }
                }
            };

            folder.add(params, 'forceHomeGoal').name('Trigger Home Goal');
            folder.add(params, 'forceAwayGoal').name('Trigger Away Goal');
            folder.add(params, 'forceHalftime').name('Force Halftime');
            folder.add(params, 'resetRound').name('Reset Round');
            folder.add(params, 'exitToMenu').name('Exit to Menu');
        }

        _setupTeams() {
            const folder = this.gui.addFolder('Teams');
            if (!this.game.teams.home || !this.game.teams.away) return;

            const home = this.game.teams.home;
            const away = this.game.teams.away;

            // Home
            const hFolder = folder.addFolder('Home Team');
            hFolder.add(home, 'isHuman').name('Is Human Controlled').listen();
            hFolder.add(home, 'aiEnabled').name('AI Logic Enabled').listen();

            // Away
            const aFolder = folder.addFolder('Away Team');
            aFolder.add(away, 'isHuman').name('Is Human Controlled').listen();
            aFolder.add(away, 'aiEnabled').name('AI Logic Enabled').listen();

        }

_setupPlayerInspector() {
            const folder = this.gui.addFolder('Player Inspector (Home Active)');
            
            // Helper to get current active player safely
            const getActive = () => {
                return (this.game.teams.home && this.game.teams.home.activePlayer) 
                    ? this.game.teams.home.activePlayer 
                    : null;
            };

            // Proxy object to bind GUI to dynamic target
            const proxy = {
                get Role() { 
                    const p = getActive();
                    return p ? p.role : '-'; 
                },
                
                get GodMode() { 
                    const p = getActive();
                    return p ? p.isGodMode : false; 
                },
                set GodMode(v) { 
                    const p = getActive();
                    if(p) p.isGodMode = v; 
                },

                // Runtime Values
                get HP() { 
                    const p = getActive();
                    return p ? p.stats.HP : 0; 
                },
                set HP(v) { 
                    const p = getActive();
                    if(p) p.stats.HP = v; 
                },
                
                get CurrentEN() { 
                    const p = getActive();
                    return p ? p.currentEN : 0; 
                },
                set CurrentEN(v) { 
                    const p = getActive();
                    if(p) p.currentEN = v; 
                },

                // Base Stats
                get MaxHP() { 
                    const p = getActive();
                    return p ? p.stats.maxHP : 0; 
                },
                set MaxHP(v) { 
                    const p = getActive();
                    if(p) p.stats.maxHP = v; 
                },

                get SP() { 
                    const p = getActive();
                    return p ? p.stats.SP : 0; 
                },
                set SP(v) { 
                    const p = getActive();
                    if(p) { 
                        p.stats.SP = v; 
                        p._updateDerivedStats(); 
                    } 
                },

                get EN() { 
                    const p = getActive();
                    return p ? p.stats.EN : 0; 
                }, 
                set EN(v) { 
                    const p = getActive();
                    if(p) {
                        p.stats.EN = v;
                    }
                },

                get AT() { 
                    const p = getActive();
                    return p ? p.stats.AT : 0; 
                },
                set AT(v) { 
                    const p = getActive();
                    if(p) p.stats.AT = v; 
                },

                get PA() { 
                    const p = getActive();
                    return p ? p.stats.PA : 0; 
                },
                set PA(v) { 
                    const p = getActive();
                    if(p) p.stats.PA = v; 
                },

                get BL() { 
                    const p = getActive();
                    return p ? p.stats.BL : 0; 
                },
                set BL(v) { 
                    const p = getActive();
                    if(p) p.stats.BL = v; 
                },

                get SH() { 
                    const p = getActive();
                    return p ? p.stats.SH : 0; 
                },
                set SH(v) { 
                    const p = getActive();
                    if(p) p.stats.SH = v; 
                },

                get CA() { 
                    const p = getActive();
                    return p ? p.stats.CA : 0; 
                },
                set CA(v) { 
                    const p = getActive();
                    if(p) p.stats.CA = v; 
                },

                // Actions
                LevelUp: () => { 
                    const p = getActive();
                    if(p) p.levelUp(); 
                },
                FullHeal: () => { 
                    const p = getActive(); 
                    if(p) { 
                        p.stats.HP = p.stats.maxHP; 
                        p.currentEN = p.getStat('EN'); 
                        p.status.venom = 0; 
                        p.status.nap = 0; 
                        for(let k in p.status.wither) p.status.wither[k] = 0;
                        if(window.flux.gameInstance.floatingText) {
                            window.flux.gameInstance.floatingText.spawn("FULL HEAL", p.mesh.position, "heal");
                        }
                    } 
                },
                DrainEN: () => { 
                    const p = getActive();
                    if(p) {
                        p.currentEN = 0;
                        p.fumble(); // Trigger fumble logic
                    }
                }
            };

            folder.add(proxy, 'Role').listen().disable();
            folder.add(proxy, 'GodMode').name('God Mode (Inf HP/EN)').listen();

            const rtFolder = folder.addFolder('Runtime Status');
            rtFolder.add(proxy, 'HP', 0, 9999).listen();
            rtFolder.add(proxy, 'CurrentEN', 0, 100).name('Current EN').listen();

            const statFolder = folder.addFolder('Base Stats');
            statFolder.add(proxy, 'MaxHP', 100, 9999).listen();
            statFolder.add(proxy, 'EN', 0, 99).name('Max EN').listen();
            statFolder.add(proxy, 'SP', 0, 99).listen();
            statFolder.add(proxy, 'AT', 0, 99).listen();
            statFolder.add(proxy, 'PA', 0, 99).listen();
            statFolder.add(proxy, 'BL', 0, 99).listen();
            statFolder.add(proxy, 'SH', 0, 99).listen();
            statFolder.add(proxy, 'CA', 0, 99).listen();

            const actionFolder = folder.addFolder('Actions');
            actionFolder.add(proxy, 'LevelUp').name('Instant Level Up');
            actionFolder.add(proxy, 'FullHeal').name('Full Heal & Cure');
            actionFolder.add(proxy, 'DrainEN').name('Drain EN (Fumble)');
        }

        _setupBallSandbox() {
            const folder = this.gui.addFolder('Ball & Physics Sandbox');
            const C = window.flux.BallConfig;
            
            if (!C) {
                console.warn("BallConfig not found. Skipping Physics Sandbox.");
                return;
            }

            // 1. Physics Constants
            const physFolder = folder.addFolder('Physics Constants');
            physFolder.add(C, 'WATER_DRAG', 0.0, 5.0).name('Water Drag');
            physFolder.add(C, 'SPIN_DRAG', 0.0, 5.0).name('Spin Decay');
            physFolder.add(C, 'MAGNUS_COEFF', 0.0, 5.0).name('Magnus Effect');
            physFolder.add(C, 'GRAVITY_SPRING', 0.0, 20.0).name('Vert Spring');
            physFolder.add(C, 'GRAVITY_DAMP', 0.0, 10.0).name('Vert Damp');
            physFolder.add(C, 'BOUNDARY_RADIUS', 10.0, 100.0).name('Arena Size');

            // 2. Teleport Tools
            const tpFolder = folder.addFolder('Teleport Ball');
            const tpParams = {
                ToCenter: () => {
                    const b = this.game.entities.ball;
                    if(b) b.reset();
                },
                ToActivePlayer: () => {
                    const b = this.game.entities.ball;
                    const p = this.game.teams.home.activePlayer;
                    if(b && p) b.grab(p);
                },
                ToHomeGoal: () => {
                    const b = this.game.entities.ball;
                    if(b) { b.drop(); b.mesh.position.set(0, 0, 25); b.velocity.set(0,0,0); }
                },
                ToAwayGoal: () => {
                    const b = this.game.entities.ball;
                    if(b) { b.drop(); b.mesh.position.set(0, 0, -25); b.velocity.set(0,0,0); }
                },
                ToSky: () => {
                    const b = this.game.entities.ball;
                    if(b) { b.drop(); b.mesh.position.set(0, 10, 0); b.velocity.set(0,0,0); }
                }
            };
            tpFolder.add(tpParams, 'ToCenter');
            tpFolder.add(tpParams, 'ToActivePlayer');
            tpFolder.add(tpParams, 'ToHomeGoal');
            tpFolder.add(tpParams, 'ToAwayGoal');
            tpFolder.add(tpParams, 'ToSky');

            // 3. Force Shoot
            const shootFolder = folder.addFolder('Force Shoot');
            const shootParams = {
                Power: 20,
                Curve: 0,
                ShootForward: () => {
                    const b = this.game.entities.ball;
                    if(b) {
                        // Shoot towards -Z (Home Attack Direction)
                        const dir = new THREE.Vector3(0, 0, -1);
                        const spin = new THREE.Vector3(0, shootParams.Curve, 0);
                        b.shoot(dir, shootParams.Power, 'SH', null, spin);
                    }
                },
                ShootBackward: () => {
                    const b = this.game.entities.ball;
                    if(b) {
                        const dir = new THREE.Vector3(0, 0, 1);
                        const spin = new THREE.Vector3(0, shootParams.Curve, 0);
                        b.shoot(dir, shootParams.Power, 'SH', null, spin);
                    }
                },
                ShootUp: () => {
                    const b = this.game.entities.ball;
                    if(b) {
                        const dir = new THREE.Vector3(0, 1, 0);
                        b.shoot(dir, shootParams.Power, 'PA');
                    }
                },
                RandomCurve: () => {
                    const b = this.game.entities.ball;
                    if(b) {
                        const dir = new THREE.Vector3(Math.random()-0.5, 0, Math.random()-0.5).normalize();
                        const spin = new THREE.Vector3(0, (Math.random()-0.5)*20, 0);
                        b.shoot(dir, shootParams.Power, 'SH', null, spin);
                    }
                }
            };
            shootFolder.add(shootParams, 'Power', 5, 50);
            shootFolder.add(shootParams, 'Curve', -20, 20).name('Spin Y');
            shootFolder.add(shootParams, 'ShootForward');
            shootFolder.add(shootParams, 'ShootBackward');
            shootFolder.add(shootParams, 'ShootUp');
            shootFolder.add(shootParams, 'RandomCurve');
        }
    }

window.flux.DevTools = DevTools;

    DevTools.prototype._setupVisualDebug = function() {
        const folder = this.gui.addFolder('Visual Debugging');
        const dv = this.game.debugVisualizer;
        if (!dv) return;

        const params = {
            enabled: dv.enabled,
            hitboxes: dv.showHitboxes,
            vectors: dv.showVectors,
            ai: dv.showAI
        };

        folder.add(params, 'enabled').name('Enable Visualizer').onChange(v => dv.enabled = v);
        folder.add(params, 'hitboxes').name('Show Hitboxes').onChange(v => dv.showHitboxes = v);
        folder.add(params, 'vectors').name('Show Vectors').onChange(v => dv.showVectors = v);
        folder.add(params, 'ai').name('Show AI Perception').onChange(v => dv.showAI = v);
    };

    DevTools.prototype._setupFXLab = function() {
        const folder = this.gui.addFolder('FX Lab & UI Test');
        
        const getTargetPos = () => {
            const p = this.game.teams.home.activePlayer;
            return p && p.mesh ? p.mesh.position : new THREE.Vector3(0, 2, 0);
        };

        const fxParams = {
            SpawnVenom: () => this.game.particleManager.spawn('venom', getTargetPos()),
            SpawnNap: () => this.game.particleManager.spawn('nap', getTargetPos()),
            SpawnWither: () => this.game.particleManager.spawn('wither', getTargetPos()),
            SpawnLearned: () => this.game.particleManager.spawn('learned', getTargetPos()),
            SpawnClash: () => this.game.spawnClash(getTargetPos()),
        };

        const fxSub = folder.addFolder('Particles');
        fxSub.add(fxParams, 'SpawnVenom');
        fxSub.add(fxParams, 'SpawnNap');
        fxSub.add(fxParams, 'SpawnWither');
        fxSub.add(fxParams, 'SpawnLearned');
        fxSub.add(fxParams, 'SpawnClash');

        const txtParams = {
            Text: "TEST",
            Type: "damage",
            Spawn: () => {
                if(this.game.floatingText) 
                    this.game.floatingText.spawn(txtParams.Text, getTargetPos(), txtParams.Type);
            }
        };
        
        const txtSub = folder.addFolder('Floating Text');
        txtSub.add(txtParams, 'Text');
        txtSub.add(txtParams, 'Type', ['damage', 'heal', 'status', 'tech', 'comic-impact', 'comic-action', 'save', 'block', 'default']);
        txtSub.add(txtParams, 'Spawn').name('Spawn Text');

        const camParams = {
            ShakeSmall: () => this.game.cameraManager.addShake(0.5),
            ShakeBig: () => this.game.cameraManager.addShake(2.0),
            ImpactLight: () => this.game.triggerImpact(0.1, 'default'),
            ImpactHeavy: () => this.game.triggerImpact(0.2, 'heavy'),
            ImpactShatter: () => this.game.triggerImpact(0.4, 'shatter'),
        };

        const camSub = folder.addFolder('Camera & Impact');
        camSub.add(camParams, 'ShakeSmall');
        camSub.add(camParams, 'ShakeBig');
        camSub.add(camParams, 'ImpactLight');
        camSub.add(camParams, 'ImpactHeavy');
        camSub.add(camParams, 'ImpactShatter');
    };


DevTools.prototype._setupVisuals = function() {
        const folder = this.gui.addFolder('Visualization Room');
        
        const vizParams = {
            active: false,
            asset: 'Tidus',
            scale: 1.0,
            anim: 'idle',
            spawn: () => {
                if (!this.vizGroup) {
                    this.vizGroup = new THREE.Group();
                    this.game.scene.add(this.vizGroup);
                }
                // Clear previous
                while(this.vizGroup.children.length > 0){ 
                    this.vizGroup.remove(this.vizGroup.children[0]); 
                }
                
                const urlMap = {
                    'Tidus': 'https://cdn.tinyglb.com/models/da788bef258c4f0b8d9ef1acc19c5567.glb',
                    'Wakka': 'https://cdn.tinyglb.com/models/59114c98951647c9b8da74b0bd3636cb.glb',
                    'Ball': 'https://cdn.tinyglb.com/models/521ae8788e584e378a79d9732a075356.glb',
                    'Goal': 'https://cdn.tinyglb.com/models/a516bd90fa7c4dedb5dcbfdf803f13d5.glb'
                };
                
                const url = urlMap[vizParams.asset];
                if(url) {
                    window.flux.AssetLoader.loadModel(url, (gltf) => {
                        const model = gltf.scene;
                        model.scale.setScalar(vizParams.scale);
                        this.vizGroup.add(model);
                        
                        if(gltf.animations && gltf.animations.length > 0) {
                            this.vizMixer = new THREE.AnimationMixer(model);
                            // Try to find animation by name or default to first
                            let clip = THREE.AnimationClip.findByName(gltf.animations, vizParams.anim);
                            if (!clip) {
                                // Fallback mapping
                                const map = {
                                    'idle': ['treading', 'idle'],
                                    'swim': ['swim'],
                                    'throw': ['throw'],
                                    'catch': ['catch'],
                                    'react': ['react', 'hit', 'damage']
                                };
                                const keywords = map[vizParams.anim] || [];
                                clip = gltf.animations.find(a => keywords.some(k => a.name.toLowerCase().includes(k))) || gltf.animations[0];
                            }
                            
                            if (clip) {
                                this.vizMixer.clipAction(clip).play();
                            }
                        } else {
                            this.vizMixer = null;
                        }
                    });
                }
            },
            toggleRoom: () => {
                vizParams.active = !vizParams.active;
                const gameLayer = [this.game.teams.home, this.game.teams.away, this.game.entities.ball];
                
                // Toggle Game Visibility
                gameLayer.forEach(t => {
                    if(t && t.players) t.players.forEach(p => { if(p.mesh) p.mesh.visible = !vizParams.active; });
                    else if(t && t.mesh) t.mesh.visible = !vizParams.active;
                });
                if(window.flux.arenaMesh) window.flux.arenaMesh.visible = !vizParams.active;
                
                if(vizParams.active) {
                    // Move Camera to Void
                    this.game.camera.position.set(1000, 5, 1010);
                    this.game.camera.lookAt(1000, 2, 1000);
                    if(this.vizGroup) this.vizGroup.position.set(1000, 0, 1000);
                    
                    // Add Light for Viz
                    if(!this.vizLight) {
                        this.vizLight = new THREE.DirectionalLight(0xffffff, 1.0);
                        this.vizLight.position.set(1005, 10, 1005);
                        this.game.scene.add(this.vizLight);
                    }
                    this.vizLight.visible = true;
                    
                    // Spawn initial
                    vizParams.spawn();
                    
                } else {
                    // Restore Camera
                    if(this.game.cameraManager) this.game.cameraManager.snapToTarget();
                    if(this.vizLight) this.vizLight.visible = false;
                }
            }
        };
        
        folder.add(vizParams, 'toggleRoom').name('Toggle Room');
        folder.add(vizParams, 'asset', ['Tidus', 'Wakka', 'Ball', 'Goal']).onChange(() => { if(vizParams.active) vizParams.spawn(); });
        folder.add(vizParams, 'scale', 0.1, 5.0).onChange(v => {
            if(this.vizGroup && this.vizGroup.children[0]) {
                this.vizGroup.children[0].scale.setScalar(v);
            }
        });
        folder.add(vizParams, 'anim', ['idle', 'swim', 'throw', 'catch', 'react']).name('Animation').onChange(() => {
             if(vizParams.active) vizParams.spawn();
        });
        folder.add(vizParams, 'spawn').name('Reload Asset');
        
        // Hook into update loop for mixer
        const originalUpdate = this.game.update.bind(this.game);
        this.game.update = (dt) => {
            originalUpdate(dt);
            if (vizParams.active && this.vizMixer) {
                this.vizMixer.update(dt);
            }
        };
    };
})();</script>
    <script>(function() {
    window.flux = window.flux || {};

    class DebugVisualizer {
        constructor(scene) {
            this.scene = scene;
            this.enabled = false;
            this.showHitboxes = false;
            this.showVectors = false;
            this.showAI = false;

            this.visuals = new Map();
            
            // Materials
            this.matTackle = new THREE.MeshBasicMaterial({ color: 0xff0000, wireframe: true, transparent: true, opacity: 0.2 });
            this.matCatch = new THREE.MeshBasicMaterial({ color: 0x00ff00, wireframe: true, transparent: true, opacity: 0.2 });
            this.matVel = new THREE.LineBasicMaterial({ color: 0xffff00 }); // Yellow Velocity
            this.matInput = new THREE.LineBasicMaterial({ color: 0x00ffff }); // Cyan Input
            this.matAI = new THREE.LineBasicMaterial({ color: 0xff00ff }); // Magenta AI Perception
            
            // Geometries
            this.geoCylinder = new THREE.CylinderGeometry(1, 1, 0.1, 16);
            this.geoCylinder.translate(0, 0.05, 0);
        }

        update() {
            if (!this.enabled) {
                if (this.visuals.size > 0) this.clear();
                return;
            }

            const game = window.flux.gameInstance;
            if (!game || !game.teams.home) return;

            const entities = [
                ...game.teams.home.players,
                ...game.teams.away.players,
                game.entities.ball
            ];

            entities.forEach(e => {
                if (!e || !e.mesh) return;
                
                let v = this.visuals.get(e);
                if (!v) {
                    v = this.createVisual(e);
                    this.visuals.set(e, v);
                }
                this.updateVisual(e, v);
            });
        }

        createVisual(entity) {
            const group = new THREE.Group();
            this.scene.add(group);

            // Hitboxes
            const tackle = new THREE.Mesh(this.geoCylinder, this.matTackle);
            const catchR = new THREE.Mesh(this.geoCylinder, this.matCatch);
            group.add(tackle);
            group.add(catchR);

            // Lines
            const velLine = this.createLine(this.matVel);
            const inputLine = this.createLine(this.matInput);
            const aiLine = this.createLine(this.matAI); // Line to perceived target
            
            group.add(velLine);
            group.add(inputLine);
            group.add(aiLine);

            return { group, tackle, catchR, velLine, inputLine, aiLine };
        }

        createLine(mat) {
            const geo = new THREE.BufferGeometry().setFromPoints([new THREE.Vector3(), new THREE.Vector3()]);
            return new THREE.Line(geo, mat);
        }

        updateLine(line, start, end) {
            const pos = line.geometry.attributes.position.array;
            pos[0] = start.x; pos[1] = start.y; pos[2] = start.z;
            pos[3] = end.x; pos[4] = end.y; pos[5] = end.z;
            line.geometry.attributes.position.needsUpdate = true;
            line.visible = true;
        }

        updateVisual(e, v) {
            v.group.visible = true;
            
            // Hitboxes (Local to entity position)
            v.tackle.position.copy(e.mesh.position);
            v.catchR.position.copy(e.mesh.position);
            
            if (this.showHitboxes && e.role) {
                v.tackle.visible = true;
                const rT = e.tackleRadius || 2.5;
                v.tackle.scale.set(rT, 1, rT);

                v.catchR.visible = true;
                // Logic from main.js checkBallGrab
                const rC = e.isDashing ? 4.0 : 2.5; 
                v.catchR.scale.set(rC, 1, rC);
                v.catchR.position.y = e.mesh.position.y + 0.1;
            } else {
                v.tackle.visible = false;
                v.catchR.visible = false;
            }

            // Vectors (Global lines)
            const origin = e.mesh.position.clone();
            origin.y += 1.0; // Lift up

            if (this.showVectors) {
                // Velocity
                if (e.velocity) {
                    const end = origin.clone().add(e.velocity);
                    this.updateLine(v.velLine, origin, end);
                }
                // Input
                if (e.inputVector && e.inputVector.lengthSq() > 0) {
                    const end = origin.clone().add(e.inputVector.clone().multiplyScalar(3.0));
                    this.updateLine(v.inputLine, origin, end);
                } else {
                    v.inputLine.visible = false;
                }
            } else {
                v.velLine.visible = false;
                v.inputLine.visible = false;
            }

            // AI
            if (this.showAI && e.perceivedTargetPos) {
                // Draw line to perceived target
                this.updateLine(v.aiLine, origin, e.perceivedTargetPos);
            } else {
                v.aiLine.visible = false;
            }
        }

        clear() {
            this.visuals.forEach(v => {
                this.scene.remove(v.group);
            });
            this.visuals.clear();
        }
    }
    window.flux.DebugVisualizer = DebugVisualizer;
})();</script>
    <script>(function() {
    window.flux = window.flux || {};

    class MenuManager {
        constructor(gameManager) {
            this.game = gameManager;
            this.container = document.getElementById('main-menu');
            this.items = document.querySelectorAll('.menu-item');
            
            this.setupEvents();
        }

        setupEvents() {
            this.items.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.stopPropagation(); // Prevent click-through
                    this.handleSelection(item.dataset.action);
                });
                
                item.addEventListener('mouseenter', () => {
                    // Optional: Play hover sound
                });
            });
        }

        handleSelection(action) {
            console.log("Menu Selection:", action);
            if (action === 'normal') {
                this.hide();
                this.game.startMatch('normal');
            } else if (action === 'practice') {
                this.hide();
                this.game.startMatch('practice');
            } else if (action === 'options') {
                console.log("Options clicked (Not implemented)");
            }
        }

        show() {
            if (this.container) {
                this.container.classList.add('active');
                this.game.setMenuMode(true);
            }
        }

        hide() {
            if (this.container) {
                this.container.classList.remove('active');
                this.game.setMenuMode(false);
            }
        }
    }

    window.flux.MenuManager = MenuManager;
})();</script>
<script>(function() {
    window.flux = window.flux || {};

    class PracticeManager {
        constructor(gameManager) {
            this.game = gameManager;
            this.isRunning = false;
            this.currentDrill = null;
            this.drillState = {}; 
            
            this.drills = {
                'free': { name: 'FREE ROAM', setup: this._setupFree.bind(this), loop: this._loopFree.bind(this) },
                'shooting': { name: 'SHOOTING DRILL', setup: this._setupShooting.bind(this), loop: this._loopShooting.bind(this) },
                'passing': { name: 'PASSING DRILL', setup: this._setupPassing.bind(this), loop: this._loopPassing.bind(this) },
                'defense': { name: 'DEFENSE DRILL', setup: this._setupDefense.bind(this), loop: this._loopDefense.bind(this) }
            };

            this.ui = document.getElementById('practice-overlay');
            this.options = {
                infStats: true,
                aiDummy: true,
                showHitboxes: false
            };
            
            this.targetRing = null;
            this._initVisuals();
            this._setupEvents();
        }

        _initVisuals() {
            // Create a glowing ring for targets
            const geometry = new THREE.RingGeometry(1.5, 1.8, 32);
            geometry.rotateX(-Math.PI / 2);
            const material = new THREE.MeshBasicMaterial({ 
                color: 0x00ffff, 
                side: THREE.DoubleSide, 
                transparent: true, 
                opacity: 0.6,
                blending: THREE.AdditiveBlending,
                depthWrite: false
            });
            this.targetRing = new THREE.Mesh(geometry, material);
            this.targetRing.visible = false;
            // Add to scene via game manager reference
            if (this.game.scene) this.game.scene.add(this.targetRing);
        }

        start() {
this.isRunning = true;
            this._showPanel();
            this.setDrill('free');
            
            // Ensure HUD is visible
            const hud = document.getElementById('ui-layer');
            if(hud) hud.style.visibility = 'visible';
        }

        stop() {

            this.isRunning = false;
            this._hidePanel();
            this._hideRestoreBtn();
            this._clearDrill();
            
            if (this.targetRing) this.targetRing.visible = false;

            // Restore Away Team Visibility for Normal Match
            if (this.game.teams.away) {
                this.game.teams.away.players.forEach(p => {
                    if(p.mesh) {
                        p.mesh.visible = true;
                        p.mesh.position.y = 0; // Ensure they aren't stuck under floor
                    }
                });
            }

            // Disable debug visuals if they were on
            if (this.game.debugVisualizer) {
                this.game.debugVisualizer.enabled = false;
                this.game.debugVisualizer.showHitboxes = false;
            }
        }

        setDrill(key) {
            if (!this.drills[key]) return;
            this._clearDrill();
            this.currentDrill = key;
            
            // Update UI
            if (this.ui) {
                this.ui.querySelectorAll('.drill-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.drill === key);
                });
            }

            // Run Setup
            this.drills[key].setup();
            
            // Announcement
            if (this.game.showAnnouncement) {
                this.game.showAnnouncement(this.drills[key].name, 'normal');
            }
        }

        update(dt) {
            if (!this.isRunning) return;

            // Common Practice Logic (Infinite Stats)
            if (this.options.infStats) {
                this._applyInfiniteStats();
            }

            // Drill Logic
            if (this.currentDrill && this.drills[this.currentDrill].loop) {
                this.drills[this.currentDrill].loop(dt);
            }
            
            // Visuals Animation
            if (this.targetRing && this.targetRing.visible) {
                this.targetRing.rotation.z += dt; // Spin
                const s = 1.0 + Math.sin(Date.now() * 0.005) * 0.1;
                this.targetRing.scale.set(s, s, s);
            }
        }

        _setupEvents() {
if (!this.ui) return;

            // Minimize / Restore
            const minBtn = this.ui.querySelector('#p-minimize');
            if (minBtn) {
                minBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this._hidePanel();
                    this._showRestoreBtn();
                });
            }

            const restoreBtn = document.getElementById('practice-restore-btn');
            if (restoreBtn) {
                restoreBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this._showPanel();
                    this._hideRestoreBtn();
                });
            }

            // Drill Buttons
            this.ui.querySelectorAll('.drill-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.setDrill(btn.dataset.drill);
                });
            });

            // Reset Ball
            const resetBtn = this.ui.querySelector('#p-reset-ball');
            if (resetBtn) {
                resetBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this._resetBallToPlayer();
                });
            }

            // Exit
            const exitBtn = this.ui.querySelector('#p-exit');
            if (exitBtn) {
                exitBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (window.flux.gameInstance && window.flux.gameInstance.menuManager) {
                        window.flux.gameInstance.menuManager.show();
                        window.flux.gameInstance.state = 'menu';
                        this.stop();
                    }
                });
            }

            // Options Toggles
            this._bindToggle('opt-inf-stat', 'infStats');
            this._bindToggle('opt-ai-dummy', 'aiDummy', (val) => {
                // Update AI Dummy state immediately
                if (this.game.teams.away) {
                    this.game.teams.away.aiEnabled = !val; // If dummy is TRUE, AI is FALSE
                }
            });
            this._bindToggle('opt-hitboxes', 'showHitboxes', (val) => {
                if (this.game.debugVisualizer) {
                    this.game.debugVisualizer.enabled = val;
                    this.game.debugVisualizer.showHitboxes = val;
                }
            });

            // Keyboard Shortcut for Reset (R)
// Keyboard Shortcut for Reset (R)
            window.addEventListener('keydown', (e) => {
                if (this.isRunning && e.key.toLowerCase() === 'r' && !e.repeat) {
                    this._resetBallToPlayer();
                }
            });
        }

_bindToggle(id, optionKey, callback) {
            const el = this.ui.querySelector(`#${id}`);
            if (!el) return;

            // Helper to update visuals
            const updateVisual = () => {
                const isActive = this.options[optionKey];
                el.classList.toggle('active', isActive);
                const box = el.querySelector('.checkbox');
                if (box) box.innerText = isActive ? '' : '';
            };

            // Initialize visual state immediately
            updateVisual();

            el.addEventListener('click', (e) => {
                e.stopPropagation();
                this.options[optionKey] = !this.options[optionKey];
                
                updateVisual();

                if (callback) callback(this.options[optionKey]);
            });
        }

        _applyInfiniteStats() {
            const home = this.game.teams.home;
            if (home) {
                home.players.forEach(p => {
                    p.stats.HP = p.stats.maxHP;
                    p.currentEN = p.stats.EN;
                    p.status.venom = 0;
                    p.status.nap = 0;
                    p.stunTimer = 0;
                });
            }
        }

        _clearDrill() {
            // Reset positions, clear dummies, reset score
this.drillState = { score: 0, timer: 0, stage: 0, resetting: false };
            this._updateScoreUI(0);
            
            if (this.targetRing) this.targetRing.visible = false;

            // Reset teams to default positions
            this.game.teams.home.resetPositions();
            this.game.teams.away.resetPositions();
            
            // Apply AI Dummy setting
            if (this.game.teams.away) {
                this.game.teams.away.aiEnabled = !this.options.aiDummy;
            }
            // Hide away team by default in drills unless specified
            this.game.teams.away.players.forEach(p => {
                if(p.mesh) p.mesh.visible = false;
                p.mesh.position.set(0, -100, 0); // Move away
                p.velocity.set(0,0,0);
            });
            
            // Ensure Home team is visible
            this.game.teams.home.players.forEach(p => {
                if(p.mesh) p.mesh.visible = true;
            });
        }

        _resetBallToPlayer() {
            const p = this.game.teams.home.activePlayer;
            const b = this.game.entities.ball;
            if (p && b) {
                b.reset();
                b.grab(p);
                if (this.game.floatingText) this.game.floatingText.spawn("RESET", p.mesh.position, "tech");
                
                // Snap camera
                if (this.game.cameraManager) this.game.cameraManager.snapToTarget();
            }
        }

        _updateScoreUI(val) {
            const el = this.ui.querySelector('#drill-score');
            if (el) el.innerText = `SCORE: ${val}`;
        }

        _setInstruction(text) {
             const el = this.ui.querySelector('#drill-instruction');
             if (el) el.innerText = text;
        }

        // --- DRILLS ---

        _setupFree() {
            this._setInstruction("Free practice. Infinite HP/EN.");
            // Show everyone
            this.game.teams.away.players.forEach(p => {
                if(p.mesh) p.mesh.visible = true;
                p.mesh.position.copy(p.homePosition);
            });
            this._resetBallToPlayer();
        }
        _loopFree(dt) {}

        _setupShooting() {

            this._setInstruction("Score on the Goalie!");
            this.drillState.resetting = false; // Clear reset flag
            
            // Setup: Active Player at 18m, Goalie in net.
            const p = this.game.teams.home.activePlayer;
            const g = this.game.teams.away.players.find(x => x.role === 'GL');
            
            if (p && p.mesh) {
                p.mesh.position.set(0, 0, -10); // 18m out (Home attacks -Z)
                p.mesh.lookAt(0, 0, -28);
                p.velocity.set(0,0,0);
            }
            if (g && g.mesh) {
                g.mesh.visible = true;
                g.mesh.position.set(0, 0, -27);
                g.mesh.lookAt(0, 0, 0);
                g.velocity.set(0,0,0);
            }
            
            this._resetBallToPlayer();
        }
        
        _loopShooting(dt) {
            if (this.drillState.resetting) return;

            // Check if goal scored (GameManager handles the actual goal event, but we track reset)
            if (this.game.state === 'goal') {
                this.drillState.resetting = true;
                this.drillState.score++;
                this._updateScoreUI(this.drillState.score);
                this.game.state = 'active'; // Hijack state back
                setTimeout(() => this._setupShooting(), 1000);
                return;
            }
            
            // If goalie catches
            const g = this.game.teams.away.players.find(x => x.role === 'GL');
            if (g && g.hasBall) {
                 this.drillState.resetting = true;
                 if (this.game.floatingText) this.game.floatingText.spawn("SAVED", g.mesh.position, "damage");
                 setTimeout(() => this._setupShooting(), 1000);
            }
        }

        _setupPassing() {

             this._setInstruction("Pass to the moving target!");
             this.drillState.resetting = false;

             // Setup: Active Player center. 1 Teammate running patterns.
             const p = this.game.teams.home.activePlayer;
             const target = this.game.teams.home.players.find(x => x !== p && x.role !== 'GL');
             
             this.drillState.target = target;
             
             if (p) {
                 p.mesh.position.set(0, 0, 10);
                 p.velocity.set(0,0,0);
             }
             if (target) {
                 target.mesh.position.set(0, 0, -10);
                 target.mesh.visible = true;
                 target.velocity.set(0,0,0);
             }
             
             this._resetBallToPlayer();
        }

        _loopPassing(dt) {
            if (this.drillState.resetting) return;

            const target = this.drillState.target;
            if (!target) return;
            
            // Move target in circle
            this.drillState.timer += dt;
            target.mesh.position.x = Math.sin(this.drillState.timer) * 10;
            target.mesh.position.z = -10 + Math.cos(this.drillState.timer * 0.5) * 5;
            target.mesh.lookAt(0,0,10);

            // Update Ring
            if (this.targetRing) {
                this.targetRing.visible = true;
                this.targetRing.position.copy(target.mesh.position);
                this.targetRing.position.y = 0.1;
                this.targetRing.material.color.setHex(0x00ffff); // Cyan
            }

            if (target.hasBall) {
                this.drillState.resetting = true;
                this.drillState.score++;
                this._updateScoreUI(this.drillState.score);
                if (this.game.floatingText) this.game.floatingText.spawn("NICE PASS!", target.mesh.position, "heal");
                
                // Reset
                setTimeout(() => {
                    target.loseBall();
                    this._setupPassing(); // Re-setup to reset positions
                }, 800);
            }
        }
        
        _setupDefense() {

            this._setInstruction("Tackle the attacker!");
            this.drillState.resetting = false;

            const p = this.game.teams.home.activePlayer;
            const attacker = this.game.teams.away.players.find(x => x.role === 'MF');
            
            this.drillState.attacker = attacker;
            
            if (p) {
                p.mesh.position.set(0, 0, 20); // Near own goal
                p.velocity.set(0,0,0);
            }
            if (attacker) {
                attacker.mesh.visible = true;
                attacker.mesh.position.set(0, 0, -10);
                attacker.velocity.set(0,0,0);
                // Give ball to attacker
                const b = this.game.entities.ball;
                b.reset();
                b.grab(attacker);
            }
        }
        
        _loopDefense(dt) {
            if (this.drillState.resetting) return;

            const attacker = this.drillState.attacker;
            const p = this.game.teams.home.activePlayer;
            
            if (!attacker || !p) return;
            
            // Attacker runs to goal (+Z)
            const goalPos = new THREE.Vector3(0, 0, 28);
            const dir = goalPos.clone().sub(attacker.mesh.position).normalize();
            
            // Update Ring on Attacker
            if (this.targetRing) {
                this.targetRing.visible = true;
                this.targetRing.position.copy(attacker.mesh.position);
                this.targetRing.position.y = 0.1;
                this.targetRing.material.color.setHex(0xff0000); // Red for enemy
            }

            if (attacker.hasBall) {
                attacker.setInput(dir.x, dir.z);
            } else {
                // Ball lost (Tackled)
                if (p.hasBall || this.game.entities.ball.state === 'free') {
                    this.drillState.resetting = true;
                    this.drillState.score++;
                    this._updateScoreUI(this.drillState.score);
                    if (this.game.floatingText) this.game.floatingText.spawn("STOPPED!", p.mesh.position, "block");
                    setTimeout(() => this._setupDefense(), 1000);
                }
            }
            
            // Fail condition: Attacker scores (GameManager handles goal check)
             if (this.game.state === 'goal') {
                this.drillState.resetting = true;
                this.game.state = 'active';
                if (this.game.floatingText) this.game.floatingText.spawn("FAILED", p.mesh.position, "damage");
                setTimeout(() => this._setupDefense(), 1000);
            }
        }
_showPanel() {
            if (this.ui) this.ui.classList.add('active');
        }

        _hidePanel() {
            if (this.ui) this.ui.classList.remove('active');
        }

        _showRestoreBtn() {
            const btn = document.getElementById('practice-restore-btn');
            if (btn) btn.style.display = 'block';
        }

        _hideRestoreBtn() {
            const btn = document.getElementById('practice-restore-btn');
            if (btn) btn.style.display = 'none';
        }
    }
window.flux.PracticeManager = PracticeManager;
})();</script>
<script>(function() {
    window.flux = window.flux || {};

    // --- High-Quality Noise Texture Generator ---
    window.flux.noiseTexture = (() => {
        const size = 512;
        const c = document.createElement('canvas');
        c.width = size; c.height = size;
        const ctx = c.getContext('2d');
        
        ctx.fillStyle = '#000000';
        ctx.fillRect(0, 0, size, size);
        
        // Generate seamless noise (Perlin-ish via layered random circles/gradients)
        const drawNoiseLayer = (scale, alpha) => {
            ctx.globalAlpha = alpha;
            ctx.globalCompositeOperation = 'lighter'; // Additive
            const count = 300 * scale;
            for(let i=0; i<count; i++) {
                const x = Math.random() * size;
                const y = Math.random() * size;
                const r = (Math.random() * 30 + 10) / scale;
                
                const g = ctx.createRadialGradient(x, y, 0, x, y, r);
                g.addColorStop(0, '#888888');
                g.addColorStop(1, 'transparent');
                
                ctx.fillStyle = g;
                ctx.beginPath(); ctx.arc(x, y, r, 0, Math.PI*2); ctx.fill();
                
                // Wrap around for seamless tiling
                [[x-size, y], [x+size, y], [x, y-size], [x, y+size]].forEach(pos => {
                    const g2 = ctx.createRadialGradient(pos[0], pos[1], 0, pos[0], pos[1], r);
                    g2.addColorStop(0, '#888888');
                    g2.addColorStop(1, 'transparent');
                    ctx.fillStyle = g2;
                    ctx.beginPath(); ctx.arc(pos[0], pos[1], r, 0, Math.PI*2); ctx.fill();
                });
            }
        };
        
        drawNoiseLayer(1.0, 0.3);
        drawNoiseLayer(2.0, 0.2);
        drawNoiseLayer(4.0, 0.1);
        
        const tex = new THREE.CanvasTexture(c);
        tex.wrapS = THREE.RepeatWrapping;
        tex.wrapT = THREE.RepeatWrapping;
        return tex;
    })();

    class WaterOverlay {
        constructor(camera) {
            this.camera = camera;
            
            // Fullscreen quad
            const geometry = new THREE.PlaneGeometry(2, 2);
            
            const vert = `
                varying vec2 vUv;
                void main() {
                    vUv = uv;
                    gl_Position = vec4(position, 1.0);
                }
            `;

            const frag = `
                uniform float uTime;
                uniform float uOpacity;
                uniform sampler2D tNoise;
                varying vec2 vUv;

                // FFX Palette (Additive Friendly)
                const vec3 C_DEEP = vec3(0.0, 0.02, 0.1);     // Subtle Deep Blue Edge
                const vec3 C_GLOW = vec3(0.0, 0.5, 0.8);      // Cyan Glow
                const vec3 C_RAY  = vec3(0.4, 0.7, 1.0);      // Light Shafts
                const vec3 C_PYRE = vec3(1.0, 0.9, 0.6);      // Pyrefly Gold

                float hash(vec2 p) {
                    return fract(sin(dot(p, vec2(12.9898, 78.233))) * 43758.5453);
                }

                float pyrefly(vec2 uv, float t, float seed) {
                    vec2 p = uv * (8.0 + seed);
                    vec2 id = floor(p);
                    vec2 sub = fract(p) - 0.5;
                    float n = hash(id + seed);
                    float x = sin(t * (1.0 + n) + n * 10.0) * 0.4;
                    float y = cos(t * (0.8 + n) + n * 20.0) * 0.4;
                    float d = length(sub - vec2(x, y));
                    float blink = 0.5 + 0.5 * sin(t * 3.0 + n * 100.0);
                    float glow = 0.02 / (d + 0.001);
                    glow = pow(glow, 1.5);
                    return glow * blink * step(0.7, n);
                }

                void main() {
                    vec2 uv = vUv;
                    float t = uTime * 0.15;

                    // 1. Distortion
                    float warp = texture2D(tNoise, uv * 0.5 + vec2(t * 0.05)).r;
                    vec2 distUV = uv + vec2(warp * 0.02, warp * 0.03);

                    // 2. Caustics
                    float c1 = texture2D(tNoise, distUV * 1.5 + vec2(t * 0.1, t * 0.05)).r;
                    float c2 = texture2D(tNoise, distUV * 2.5 - vec2(t * 0.05, t * 0.15)).r;
                    float caustic = min(c1, c2);
                    caustic = pow(caustic, 6.0) * 30.0;

                    // Chromatic Caustics
                    float cR = texture2D(tNoise, distUV * 1.5 + vec2(t*0.1 + 0.005)).r;
                    float cB = texture2D(tNoise, distUV * 1.5 + vec2(t*0.1 - 0.005)).r;
                    float causticR = pow(min(cR, c2), 6.0) * 30.0;
                    float causticB = pow(min(c1, cB), 6.0) * 30.0;

                    // 3. Rays
                    vec2 rayUV = uv;
                    rayUV.y *= 0.1;
                    rayUV.x += t * 0.02 + warp * 0.05;
                    float rays = texture2D(tNoise, rayUV).r;
                    rays = pow(rays, 5.0); 
                    float rayMask = smoothstep(1.0, 0.0, uv.y - 0.2);
                    rays *= rayMask;

                    // 4. Pyreflies
                    float flies = 0.0;
                    flies += pyrefly(uv, uTime * 0.5, 1.0);
                    flies += pyrefly(uv, uTime * 0.6, 2.3);

                    // Composition (Additive)
                    vec3 finalCol = vec3(0.0);

                    // Vignette (Blue Tint at edges)
                    float dist = distance(uv, vec2(0.5));
                    float edge = smoothstep(0.5, 1.0, dist);
                    finalCol += C_DEEP * edge * 0.5;

                    // Add Features
                    finalCol += vec3(causticR, caustic, causticB) * C_GLOW * 0.5;
                    finalCol += rays * C_RAY * 0.2;
                    finalCol += flies * C_PYRE;

                    // Scanline
                    float scan = sin(uv.y * 800.0 + uTime * 5.0) * 0.02;
                    finalCol += C_GLOW * abs(scan);

                    gl_FragColor = vec4(finalCol, uOpacity);
                }
            `;
            
            this.material = new THREE.ShaderMaterial({
                uniforms: {
                    uTime: { value: 0 },
                    tNoise: { value: window.flux.noiseTexture },
                    uOpacity: { value: 0.5 }
                },
                vertexShader: vert,
                fragmentShader: frag,
                transparent: true,
                depthTest: false,
                depthWrite: false,
                blending: THREE.AdditiveBlending // Additive blending prevents dark occlusion
            });

            this.mesh = new THREE.Mesh(geometry, this.material);
            this.mesh.frustumCulled = false;
            this.mesh.renderOrder = 9999;
            
            // Add to camera so it stays on screen
            this.camera.add(this.mesh);
        }
        
        update(dt) {
            if (this.material) {
                this.material.uniforms.uTime.value += dt;
            }
        }
    }
    
    window.flux.WaterOverlay = WaterOverlay;
})();</script>
<script>(function() {
    window.flux = window.flux || {};

    class LightShafts {
        constructor(scene) {
            this.scene = scene;
            this.mesh = null;
            this.uniforms = {
                uTime: { value: 0 },
                tNoise: { value: null }
            };

            this._init();
        }

_init() {
            // Geometry: A cluster of cones/cylinders
            // We use a single geometry with instancing or merged geometry for performance,
            // but for simplicity and aesthetic control, let's use a few large planes or a cylinder.
            // A large cylinder with open ends works well for a "pool" shaft effect.
            
            // Increased length to 90 to accommodate tilt without clipping top/bottom
            const geometry = new THREE.CylinderGeometry(30, 20, 90, 32, 1, true);
            
            // Shader
            const vert = `
                varying vec2 vUv;
                varying vec3 vPos;
                void main() {
                    vUv = uv;
                    vPos = position;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                }
            `;

            const frag = `
                uniform float uTime;
                uniform sampler2D tNoise;
                varying vec2 vUv;
                varying vec3 vPos;

                void main() {
                    // Vertical fade (Soft top and bottom)
                    float alpha = smoothstep(0.0, 0.3, vUv.y) * smoothstep(1.0, 0.6, vUv.y);

                    // Scrolling Rays
                    // Layer 1: Slow, broad rays
                    float n1 = texture2D(tNoise, vec2(vUv.x * 2.0 + uTime * 0.02, vUv.y * 0.5 - uTime * 0.05)).r;
                    
                    // Layer 2: Fast, interference rays
                    float n2 = texture2D(tNoise, vec2(vUv.x * 3.0 - uTime * 0.03, vUv.y * 0.5 - uTime * 0.1)).r;

                    float rays = n1 * n2;
                    // Boost intensity significantly (Removed pow to prevent crushing)
                    rays = rays * 3.0; 

                    // Glistening Sparkles (High frequency noise)
                    float sparkle = texture2D(tNoise, vUv * vec2(8.0, 2.0) + vec2(uTime * 0.1, uTime * 0.3)).r;
                    sparkle = pow(sparkle, 5.0) * 10.0; // Sharp points

                    // Color: Cyan/Blue/White (Brighter base)
                    vec3 color = vec3(0.6, 0.9, 1.0);
                    
                    // Combine (Higher multipliers)
                    float finalAlpha = (rays * 0.8 + sparkle * 0.4) * alpha;
                    
                    // Distance fade (optional, handled by fog usually but we want additive)
                    gl_FragColor = vec4(color, finalAlpha);
                }
            `;

            const material = new THREE.ShaderMaterial({
                uniforms: this.uniforms,
                vertexShader: vert,
                fragmentShader: frag,
                transparent: true,
                blending: THREE.AdditiveBlending,
                depthWrite: false,
                side: THREE.DoubleSide
            });

            // Container for the angle (Realistic Light Source)
            this.container = new THREE.Group();
            // Angle: Coming from top-left (simulating surface sun penetrating deep water)
            this.container.rotation.z = Math.PI / 5; // ~36 degrees tilt
            this.container.rotation.x = Math.PI / 10; // ~18 degrees forward
            this.container.position.set(12, 8, 0); // Offset source to hit arena center
            this.scene.add(this.container);

            this.mesh = new THREE.Mesh(geometry, material);
            this.mesh.renderOrder = 100; 
            this.mesh.position.set(0, 0, 0);
            this.container.add(this.mesh);

            // Add a second layer for core intensity
            const coreGeo = new THREE.CylinderGeometry(12, 8, 90, 16, 1, true);
            this.coreMesh = new THREE.Mesh(coreGeo, material);
            this.coreMesh.renderOrder = 100;
            this.container.add(this.coreMesh);
        }

        update(dt) {
            this.uniforms.uTime.value += dt;
            
            // Lazy load texture
            if (!this.uniforms.tNoise.value && window.flux.noiseTexture) {
                this.uniforms.tNoise.value = window.flux.noiseTexture;
                // Ensure wrapping is correct for the cylinder UVs
                window.flux.noiseTexture.wrapS = THREE.RepeatWrapping;
                window.flux.noiseTexture.wrapT = THREE.RepeatWrapping;
            }

            // Slowly rotate shafts for dynamic feel
            if (this.mesh) this.mesh.rotation.y += dt * 0.02;
            if (this.coreMesh) this.coreMesh.rotation.y -= dt * 0.03;
        }
    }

    window.flux.LightShafts = LightShafts;
})();</script>
    <script>(function() {
    window.flux = window.flux || {};

// Reusable Glow for Lights
    const _glowTexture = (() => {
        const c = document.createElement('canvas');
        c.width = 64; c.height = 64;
        const ctx = c.getContext('2d');
        const g = ctx.createRadialGradient(32, 32, 0, 32, 32, 32);
        g.addColorStop(0, 'rgba(255, 255, 255, 1)');
        g.addColorStop(0.4, 'rgba(0, 170, 255, 0.4)');
        g.addColorStop(1, 'rgba(0, 0, 0, 0)');
        ctx.fillStyle = g;
        ctx.fillRect(0, 0, 64, 64);
        return new THREE.CanvasTexture(c);
    })();

    const _glowMaterial = new THREE.SpriteMaterial({ 
        map: _glowTexture, 
        transparent: true, 
        blending: THREE.AdditiveBlending,
        depthWrite: false
    });

    class Stadium {
        constructor(scene) {
            this.scene = scene;
            this.container = new THREE.Group();
            this.scene.add(this.container);

            // Config for "Herculean" scale
            this.config = {
                radius: 42,       // Start outside the arena (32 radius)
                tiers: 6,         // Number of seating rings
                tierHeight: 12,
                tierDepth: 15,
crowdCount: 2500, // Reduced from 8000 to reduce clutter
                structureColor: 0x080c10, // Deep dark blue/black
                lightColor: 0x00aaff
            };

            this.rings = [];
            this.crowd = null;

            this._buildArchitecture();
this._buildArchitecture();
            this._buildCrowd();
            this._buildStadiumLights();
        }

        _buildArchitecture() {
            // 1. The Void Bowl (Background Occluder)
            // Massive cylinder to block the void
            const bowlGeo = new THREE.CylinderGeometry(180, 50, 120, 32, 1, true);
            const bowlMat = new THREE.MeshBasicMaterial({ 
                color: this.config.structureColor, 
                side: THREE.BackSide,
                fog: true 
            });
            const bowl = new THREE.Mesh(bowlGeo, bowlMat);
            bowl.position.y = 20;
            this.container.add(bowl);

            // 2. Seating Tiers (Concentric Rings)
            const tierMat = new THREE.MeshBasicMaterial({ color: 0x111a22, side: THREE.DoubleSide });
            const rimMat = new THREE.MeshBasicMaterial({ color: 0x004466 });

            for(let i=0; i<this.config.tiers; i++) {
                const y = (i * this.config.tierHeight) - 30;
                const rInner = this.config.radius + (i * (this.config.tierDepth * 0.8));
                const rOuter = rInner + this.config.tierDepth;
                
                // Floor Ring
                const ringGeo = new THREE.RingGeometry(rInner, rOuter, 64);
                ringGeo.rotateX(-Math.PI / 2);
                const mesh = new THREE.Mesh(ringGeo, tierMat);
                mesh.position.y = y;
                this.container.add(mesh);
                
                // Glowing Rim (The "Tech" feel)
                const rimGeo = new THREE.TorusGeometry(rInner, 0.8, 4, 64);
                rimGeo.rotateX(Math.PI / 2);
                const rim = new THREE.Mesh(rimGeo, rimMat);
                rim.position.y = y;
                this.container.add(rim);
            }

            // 3. Massive Pillars (The "Herculean" Support)
            const pillarGeo = new THREE.BoxGeometry(8, 200, 8);
            const pillarMat = new THREE.MeshBasicMaterial({ color: 0x050505 });
            
            for(let i=0; i<8; i++) {
                const angle = (i / 8) * Math.PI * 2;
                const r = 140; // Far out
                const mesh = new THREE.Mesh(pillarGeo, pillarMat);
                mesh.position.set(Math.cos(angle)*r, 0, Math.sin(angle)*r);
                mesh.lookAt(0,0,0);
                this.container.add(mesh);
            }
        }

_buildCrowd() {
            // Instanced Mesh for Crowd (Low Poly, High Count)
            // Using a simple vertical plane that faces center
            const geo = new THREE.PlaneGeometry(1.2, 2.5);
            
            // --- CROWD SHADER IMPLEMENTATION ---
            // Add instance-specific random offset for animation variation
            const offsets = new Float32Array(this.config.crowdCount);
            for(let i=0; i<this.config.crowdCount; i++) {
                offsets[i] = Math.random();
            }
            geo.setAttribute('aOffset', new THREE.InstancedBufferAttribute(offsets, 1));

            // Custom Shader via onBeforeCompile
            const mat = new THREE.MeshBasicMaterial({ side: THREE.DoubleSide });
            
            mat.onBeforeCompile = (shader) => {
                shader.uniforms.uTime = { value: 0 };
                this.crowdUniforms = shader.uniforms;

                shader.vertexShader = `
                    uniform float uTime;
                    attribute float aOffset;
                    varying float vJump; // Pass to fragment for color variation
                ` + shader.vertexShader;

                shader.vertexShader = shader.vertexShader.replace(
                    '#include <begin_vertex>',
                    `
                    #include <begin_vertex>
                    
                    // Animation Logic
                    float speed = 8.0;
                    float t = uTime * speed + (aOffset * 100.0);
                    
                    // Jump (Sine wave clipped)
                    float jump = max(0.0, sin(t));
                    jump = pow(jump, 2.0); // Sharpen the jump curve
                    
                    // Randomize jump height slightly
                    float height = 0.5 + 0.5 * aOffset;
                    
                    transformed.y += jump * height;
                    
                    // Sway (Side to side)
                    transformed.x += cos(t * 0.5) * 0.1;
                    
                    vJump = jump;
                    `
                );

                shader.fragmentShader = `
                    varying float vJump;
                ` + shader.fragmentShader;

                shader.fragmentShader = shader.fragmentShader.replace(
                    'vec4 diffuseColor = vec4( diffuse, opacity );',
                    `
                    vec4 diffuseColor = vec4( diffuse, opacity );
                    
                    // Brighten when jumping (Cheering effect)
                    diffuseColor.rgb += vec3(0.2) * vJump;
                    `
                );
            };
            
            this.crowd = new THREE.InstancedMesh(geo, mat, this.config.crowdCount);
            this.crowd.instanceMatrix.setUsage(THREE.DynamicDrawUsage);
            this.crowd.frustumCulled = false; // Always visible
            
            const dummy = new THREE.Object3D();
            const color = new THREE.Color();
            
// 1. Calculate Total Circumference for distribution to ensure all tiers get people
            let totalCirc = 0;
            const tierRadii = [];
            for(let t=0; t<this.config.tiers; t++) {
                const rMin = this.config.radius + (t * (this.config.tierDepth * 0.8)) + 2;
                const circ = 2 * Math.PI * rMin;
                totalCirc += circ;
                tierRadii.push({ rMin: rMin, circ: circ });
            }

            let idx = 0;
            for(let t=0; t<this.config.tiers; t++) {
                const yBase = (t * this.config.tierHeight) - 30;
                const { rMin, circ } = tierRadii[t];
                const rMax = rMin + this.config.tierDepth - 2;
                
                // Distribute proportionally so upper rows don't get cut off
                const countPerTier = Math.floor(this.config.crowdCount * (circ / totalCirc));
                
                for(let i=0; i<countPerTier; i++) {
                    if (idx >= this.config.crowdCount) break;

                    const angle = Math.random() * Math.PI * 2;
                    const r = rMin + Math.random() * (rMax - rMin);
                    
                    dummy.position.set(
                        Math.cos(angle) * r,
                        yBase + 1.25, // Center of quad
                        Math.sin(angle) * r
                    );
                    
                    // Face center
                    dummy.lookAt(0, yBase, 0);
                    dummy.updateMatrix();
                    
                    this.crowd.setMatrixAt(idx, dummy.matrix);
                    
                    // Random Team Colors (Simulating fans)
                    const rand = Math.random();
                    if (rand < 0.45) color.setHex(0x0088ff); // Home Blue
                    else if (rand < 0.9) color.setHex(0xff4444); // Away Red
                    else color.setHex(0xffffff); // Neutral/Flash
                    
                    // Vary brightness for depth
                    color.multiplyScalar(0.5 + Math.random() * 0.5);
                    
                    this.crowd.setColorAt(idx, color);
                    idx++;
                }
            }
            
            this.container.add(this.crowd);
        }

        _buildHerculeanRings() {
            // Massive floating rings that rotate slowly
            const mat = new THREE.MeshBasicMaterial({ 
                color: 0x445566, 
                transparent: true, 
                opacity: 0.3,
                wireframe: true // Tech/Holographic feel
            });

            // 1. Equatorial Ring (Massive)
            const geo1 = new THREE.TorusGeometry(110, 1, 16, 100);
            const ring1 = new THREE.Mesh(geo1, mat);
            ring1.rotation.x = Math.PI / 2;
            this.container.add(ring1);
            this.rings.push({ mesh: ring1, axis: 'z', speed: 0.01 });

            // 2. Tilted Ring
            const geo2 = new THREE.TorusGeometry(130, 2, 16, 100);
            const ring2 = new THREE.Mesh(geo2, mat);
            ring2.rotation.x = Math.PI / 3;
            this.container.add(ring2);
            this.rings.push({ mesh: ring2, axis: 'y', speed: -0.008 });
            
            // 3. Vertical Ring
            const geo3 = new THREE.TorusGeometry(150, 3, 16, 100);
            const ring3 = new THREE.Mesh(geo3, mat);
            this.container.add(ring3);
            this.rings.push({ mesh: ring3, axis: 'y', speed: 0.005 });
}

        _buildStadiumLights() {
            const count = 16; // Number of lights around the equator
            const radius = 36; // Just outside the arena boundary (32)
            const yPos = 0; // Middle of the sphere
            
            const lightGeo = new THREE.SphereGeometry(0.4, 8, 8);
            const lightMat = new THREE.MeshBasicMaterial({ color: 0xffffff });

            for(let i=0; i<count; i++) {
                const angle = (i / count) * Math.PI * 2;
                const x = Math.cos(angle) * radius;
                const z = Math.sin(angle) * radius;

                // 1. Physical Fixture (The bulb)
                const mesh = new THREE.Mesh(lightGeo, lightMat);
                mesh.position.set(x, yPos, z);
                this.container.add(mesh);

                // 2. Visual Glow (Flare)
                const sprite = new THREE.Sprite(_glowMaterial);
                sprite.position.set(x, yPos, z);
                sprite.scale.set(8, 8, 1); // Large glow
                this.container.add(sprite);

                // 3. Actual Point Light
                const light = new THREE.PointLight(this.config.lightColor, 1.0, 50, 2);
                light.position.set(x, yPos, z);
                this.container.add(light);
            }
        }
update(dt) {
            // Animate Rings
            this.rings.forEach(r => {
                if (r.axis === 'z') r.mesh.rotation.z += r.speed * dt;
                if (r.axis === 'y') r.mesh.rotation.y += r.speed * dt;
            });

            // Update Crowd Shader
            if (this.crowdUniforms) {
                this.crowdUniforms.uTime.value += dt;
            }
        }
    }

    window.flux.Stadium = Stadium;
})();</script>
    <script>(function() {
    window.flux = window.flux || {};

    class AudioManager {
        constructor() {
            this.bgm = new Audio();
            this.bgm.src = 'https://files.catbox.moe/sp2yhy.mp3';
            this.bgm.loop = true;
            this.bgm.volume = 0.5;
            this.isMuted = false;
            this.hasInteracted = false;
            this.shouldBePlaying = false; // Intent flag

            // Preload
            this.bgm.load();

            // --- HERCULEAN LOOP ENFORCEMENT ---
            // 1. Manual Loop Redundancy
            this.bgm.addEventListener('ended', () => {
                console.log("AudioManager: BGM ended event caught. Forcing manual loop reset.");
                this.bgm.currentTime = 0;
                if (this.shouldBePlaying && !this.isMuted) {
                    const p = this.bgm.play();
                    if (p !== undefined) p.catch(e => console.warn("Manual loop replay failed:", e));
                }
            });

            // 2. Pause Watchdog (If paused but should be playing, FORCE PLAY)
            this.bgm.addEventListener('pause', () => {
                if (this.shouldBePlaying && !this.isMuted) {
                    // Small timeout to allow intentional operations to finish if any
                    setTimeout(() => {
                        if (this.shouldBePlaying && this.bgm.paused) {
                            console.log("AudioManager: Unexpected pause detected. Attempting resume.");
                            this.bgm.play().catch(e => console.warn("Resume failed:", e));
                        }
                    }, 100);
                }
            });

            // 3. Periodic Watchdog (The "Never Stop" Guarantee)
            setInterval(() => this._watchdog(), 1000);
        }

        _watchdog() {
            if (this.shouldBePlaying && !this.isMuted) {
                if (this.bgm.paused || this.bgm.ended) {
                    console.log("AudioManager: Watchdog forcing play.");
                    this.bgm.play().catch(() => {
                        // Silent catch, likely waiting for interaction
                    });
                }
            }
        }

        playBGM() {
            if (this.isMuted) return;
            this.shouldBePlaying = true;
            
            const playPromise = this.bgm.play();
            if (playPromise !== undefined) {
                playPromise.catch(error => {
                    console.log("AudioManager: Autoplay prevented. Engaging interaction lock.");
                    this._waitForInteraction();
                });
            }
        }

        _waitForInteraction() {
            if (this._waitingForInteraction) return;
            this._waitingForInteraction = true;
            
            const onInteract = () => {
                this.hasInteracted = true;
                
                // Try to play
                if (this.shouldBePlaying && !this.isMuted) {
                    this.bgm.play().then(() => {
                        // Success! Detach listeners
                        this._waitingForInteraction = false;
                        this._removeInteractionListeners(onInteract);
                        console.log("AudioManager: Audio unlocked successfully.");
                    }).catch(e => {
                        console.warn("AudioManager: Interaction play failed. Keeping listeners attached.", e);
                        // Do NOT detach listeners, wait for next interaction
                    });
                } else {
                    // Not supposed to play? Just detach.
                    this._waitingForInteraction = false;
                    this._removeInteractionListeners(onInteract);
                }
            };
            
            // Use capture to catch it early, but don't use 'once: true' so we can retry if failed
            const opts = { capture: true, passive: true };
            document.addEventListener('click', onInteract, opts);
            document.addEventListener('touchstart', onInteract, opts);
            document.addEventListener('keydown', onInteract, opts);
            document.addEventListener('mousedown', onInteract, opts);
        }

        _removeInteractionListeners(handler) {
            const opts = { capture: true, passive: true };
            document.removeEventListener('click', handler, opts);
            document.removeEventListener('touchstart', handler, opts);
            document.removeEventListener('keydown', handler, opts);
            document.removeEventListener('mousedown', handler, opts);
        }

        stopBGM() {
            this.shouldBePlaying = false;
            this.bgm.pause();
            this.bgm.currentTime = 0;
        }

        pauseBGM() {
            this.shouldBePlaying = false;
            this.bgm.pause();
        }

        resumeBGM() {
            if (!this.isMuted) {
                this.playBGM();
            }
        }

        setVolume(volume) {
            this.bgm.volume = Math.max(0, Math.min(1, volume));
        }

        toggleMute() {
            this.isMuted = !this.isMuted;
            if (this.isMuted) {
                this.shouldBePlaying = false;
                this.bgm.pause();
            } else {
                this.playBGM();
            }
            return this.isMuted;
        }
    }

    window.flux.AudioManager = AudioManager;
})();</script>
    <script>(function() {
    // Namespace
    window.flux = window.flux || {};

    // Config
const _config = {
        internalWidth: 360,
        internalHeight: 640,
        bgColor: 0x001e36,
        fogColor: 0x001e36,
        fogDensity: 0.0001, // Drastically reduced to ensure visibility
        arenaRadius: 32.0
    };

    // Globals
    let _scene, _camera, _renderer, _clock;
    let _homeTeam, _awayTeam;
let _ball;
    let _gameManager;
    let _menuManager;

let _cameraManager;
    let _waterOverlay;
    let _lightShafts;
    let _stadium;
    let _glyphManager;

    // IMPROVED: Settings object
    const _settings = {
        joystickSensitivity: 1.0,
        aimAssist: true,
        cameraShake: true,
        hitStop: true,
        invertCamera: false,
        autoRecenter: true
    };

    function init() {
        _container = document.getElementById('game-container');

        // 1. Scene
        _scene = new THREE.Scene();
        _scene.background = new THREE.Color(_config.bgColor);
        _scene.fog = new THREE.FogExp2(_config.fogColor, _config.fogDensity);

        // 2. Camera
        const aspect = _config.internalWidth / _config.internalHeight;
_camera = new THREE.PerspectiveCamera(60, aspect, 0.1, 500);
_camera.position.set(0, 14, 22);
        _camera.lookAt(0, 0, 0);
        _scene.add(_camera); // Ensure camera is in scene for children to render

        // 3. Renderer
_renderer = new THREE.WebGLRenderer({ antialias: false });
        // Expose renderer for DevTools
        if (_gameManager) _gameManager.renderer = _renderer; 
        else window.flux.gameInstance = { renderer: _renderer }; // Temp hook
_container.appendChild(_renderer.domElement);

        // --- Video Overlay Enforcement ---
// --- Overlay Video Logic Removed (Switched to GIF) ---
        // 5. Environment
        createParticles();
        createArena();

// 5.5 Game Manager
_gameManager = new window.flux.GameManager(_scene, 'ui-layer', _camera, _renderer);
        
        // 5.5.1 Audio Manager
        _audioManager = new window.flux.AudioManager();
        _gameManager.audioManager = _audioManager;

        // 5.6 Camera Manager
        _cameraManager = new window.flux.CameraManager(_camera, _scene);
        _gameManager.cameraManager = _cameraManager;

        // 5.7 Dev Tools
if (window.flux.DevTools) {
            new window.flux.DevTools(_gameManager);
        }
// 5.8 Water Overlay, Light Shafts, Stadium, Glyphs
        _waterOverlay = new window.flux.WaterOverlay(_camera);
        _lightShafts = new window.flux.LightShafts(_scene);
        _stadium = new window.flux.Stadium(_scene);
        _glyphManager = new window.flux.GlyphManager(_scene);
        
if (_gameManager) {
            _gameManager.glyphManager = _glyphManager;
            _gameManager.waterOverlay = _waterOverlay;
            _gameManager.lightShafts = _lightShafts;
            _gameManager.stadium = _stadium;
        }
        // 6. Teams Setup
        _homeTeam = new window.flux.Team(_scene, 'home', 1, 0x00aaff, true);
        _awayTeam = new window.flux.Team(_scene, 'away', -1, 0xff6666, false);

        // 7. Ball
        _ball = new window.flux.Ball(_scene);

        // IMPROVED: Link ball to camera for smart framing
        _cameraManager.setBall(_ball);

        // 8. Team Roster Models
        const roles = ['LF', 'RF', 'MF', 'LD', 'RD', 'GL'];
        const homeRoster = {
            LF: { name: 'Tidus', url: 'https://cdn.tinyglb.com/models/da788bef258c4f0b8d9ef1acc19c5567.glb' },
            RF: { name: 'Wakka', url: 'https://cdn.tinyglb.com/models/59114c98951647c9b8da74b0bd3636cb.glb' },
            MF: { name: 'Letty', url: 'https://cdn.tinyglb.com/models/43ace34c6fd94215967e842bf909da5e.glb' },
            LD: { name: 'Datto', url: 'https://cdn.tinyglb.com/models/e6d67ecb2e4c4715bd73a40795e1d3d5.glb' },
            RD: { name: 'Jassu', url: 'https://cdn.tinyglb.com/models/8216459567354e63958d4108d828de98.glb' },
            GL: { name: 'Botta', url: 'https://cdn.tinyglb.com/models/ad155efedc0d48fdad09da3e1cae9c97.glb' }
        };

        const applyStats = (p, role, isHome) => {
            const teamLevel = isHome ? 25 : 22;
            window.flux.Team.generateStats(p, role, teamLevel, isHome);

            if (p.characterName.includes('Tidus')) {
                p.stats.SH += 5;
                p.stats.SP += 3;
            } else if (p.characterName.includes('Wakka')) {
                p.stats.SH += 3;
                p.stats.EN += 5;
            } else if (p.characterName.includes('Brother')) {
                p.stats.SP = 99;
            }

            p._updateDerivedStats();
        };

        let homeLoaded = 0;
        const roleGltfs = {};

        const finalizeTeams = () => {
            roles.forEach(role => {
                const gltf = roleGltfs[role] || roleGltfs.LF;

                const p = (role === 'GL')
                    ? new window.flux.Goalie(_scene, role)
                    : new window.flux.AIPlayer(_scene, role);

                const entry = homeRoster[role];
                p.characterName = entry ? `CPU ${entry.name}` : 'CPU';
                applyStats(p, role, false);

                if (gltf && gltf.scene) {
                    const clone = THREE.SkeletonUtils.clone(gltf.scene);
                    p.setMesh(clone, gltf.animations || []);
                } else {
                    console.warn('Missing GLTF for away role:', role);
                }

                _awayTeam.addPlayer(p);
            });

            const allPlayers = [..._homeTeam.players, ..._awayTeam.players];
            allPlayers.forEach(p => {
                if (p.ballRef === null) p.ballRef = _ball;
            });

            _homeTeam.activePlayer = _homeTeam.players.find(p => p.role === 'MF');

            if (_homeTeam.activePlayer) {
                _homeTeam.activePlayer.techs.tackle = 'venom';
                _homeTeam.activePlayer.techs.shoot = 'sphere';
                console.log('Equipped Home MF with Venom Tackle & Sphere Shot');
            }

            const awayMF = _awayTeam.players.find(p => p.role === 'MF');
            if (awayMF) {
                awayMF.techs.tackle = 'wither';
            }
            _awayTeam.setFormation('Counter');

            const awayGL = _awayTeam.players.find(p => p.role === 'GL');
            if (awayGL) {
                awayGL.techs.active = 'super_goalie';
                awayGL.techs.passive = 'grip_gloves';
                console.log('Equipped Away GL with Super Goalie');
            }

            _homeTeam.assignMarks(_awayTeam);
            _awayTeam.assignMarks(_homeTeam);

            document.getElementById('loading').style.display = 'none';
            if (_gameManager) {
                _gameManager.registerTeams(_homeTeam, _awayTeam, _ball);

                _menuManager = new window.flux.MenuManager(_gameManager);
                _menuManager.show();
            }
        };

roles.forEach(role => {
            const entry = homeRoster[role];
            if (!entry) return;

            const onComplete = () => {
                homeLoaded++;
                if (homeLoaded >= roles.length) {
                    finalizeTeams();
                }
            };

            window.flux.AssetLoader.loadModel(entry.url, (gltf) => {
                roleGltfs[role] = gltf;

                const p = (role === 'GL')
                    ? new window.flux.Goalie(_scene, role)
                    : new window.flux.AIPlayer(_scene, role);

                p.characterName = entry.name;
                applyStats(p, role, true);

                const clone = THREE.SkeletonUtils.clone(gltf.scene);
                p.setMesh(clone, gltf.animations);
                _homeTeam.addPlayer(p);

                onComplete();
            }, undefined, (err) => {
                console.error('Failed to load model', entry.name, entry.url, err);
                
                // Fallback Mesh (Red Box)
                const fallbackGeo = new THREE.BoxGeometry(1, 2, 1);
                const fallbackMat = new THREE.MeshBasicMaterial({ color: 0xff0000, wireframe: true });
                const fallbackMesh = new THREE.Mesh(fallbackGeo, fallbackMat);
                
                // Store dummy in roleGltfs for away team cloning
                roleGltfs[role] = { scene: fallbackMesh, animations: [] };

                const p = (role === 'GL')
                    ? new window.flux.Goalie(_scene, role)
                    : new window.flux.AIPlayer(_scene, role);

                p.characterName = entry.name + " (Error)";
                applyStats(p, role, true);
                
                p.setMesh(fallbackMesh.clone(), []);
                _homeTeam.addPlayer(p);

                onComplete();
            });
        });

        // 8. Input
        setupInputs();

        // 9. Loop
        _clock = new THREE.Clock();
        requestAnimationFrame(animate);

        // Handle resize
        window.addEventListener('resize', onResize);
        onResize();
    }

    function createParticles() {
        const geometry = new THREE.BufferGeometry();
        const vertices = [];
        for (let i = 0; i < 500; i++) {
            vertices.push(
                (Math.random() - 0.5) * 20,
                (Math.random() - 0.5) * 20,
                (Math.random() - 0.5) * 20
            );
        }
        geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
        const material = new THREE.PointsMaterial({ color: 0x88ccff, size: 0.05, transparent: true, opacity: 0.6 });
        const points = new THREE.Points(geometry, material);
        _scene.add(points);
    }

function createArena() {
        const geometry = new THREE.SphereGeometry(_config.arenaRadius, 32, 32);
        
        const texLoader = new THREE.TextureLoader();
const arenaTex = texLoader.load('https://i.postimg.cc/W1LsH68Q/file-0000000023ec71f596593829e8118760-(1).png');
        arenaTex.magFilter = THREE.NearestFilter;
        arenaTex.minFilter = THREE.NearestFilter;
        arenaTex.wrapS = THREE.RepeatWrapping;
        arenaTex.wrapT = THREE.RepeatWrapping;
        arenaTex.repeat.set(6, 4);

const material = new THREE.MeshBasicMaterial({
            map: arenaTex,
            color: 0xffffff,
            wireframe: false,
            transparent: true,
            opacity: 0.0, // Default invisible (0.0) as requested
            blending: THREE.MultiplyBlending,
            side: THREE.BackSide
        });
            
        const arena = new THREE.Mesh(geometry, material);
        _scene.add(arena);
        window.flux.arenaMesh = arena;

// --- Arena 2 (Normal Blend, 5% Opacity) ---
        const material2 = new THREE.MeshBasicMaterial({
            map: arenaTex,
            color: 0xffffff,
            wireframe: false,
            transparent: true,
            opacity: 0.05,
            blending: THREE.NormalBlending,
            side: THREE.BackSide
        });
        const arena2 = new THREE.Mesh(geometry, material2);
        arena2.scale.setScalar(0.995); // Slight offset to prevent z-fighting
        _scene.add(arena2);
        window.flux.arenaMesh2 = arena2;

        // --- NEW: FFX GOAL MODELS ---
        const goalUrl = 'https://cdn.tinyglb.com/models/a516bd90fa7c4dedb5dcbfdf803f13d5.glb';
        
const onGoalLoaded = (model, isFallback) => {
            const goalA = model;
            // Moved down ~7ft (2.2m) as requested
            goalA.position.set(0, -2.2, -32); 
            
if (!isFallback) {
                goalA.scale.setScalar(36.0); // Increased 50% (was 24.0)
            }
            // Setup Goal A
            goalA.traverse(c => {
                if(c.isMesh) {
                    c.frustumCulled = false; // CRITICAL: Prevent culling
                    c.renderOrder = 0;
                    
                    // Ensure material is visible
                    if (c.material) {
                        c.material.color.setHex(0xffffff); // White to show original texture/colors (was blue)
                        c.material.transparent = false;
                        c.material.opacity = 1.0;
                        c.material.side = THREE.DoubleSide;
                        c.material.depthWrite = true;
                        c.material.depthTest = true;
                    }
                }
            });
            _scene.add(goalA);

            // Setup Goal B
            const goalB = isFallback ? goalA.clone() : THREE.SkeletonUtils.clone(goalA);

            goalB.position.set(0, -2.2, 32); // Moved closer (was 45) and down
            goalB.rotation.y = Math.PI;
            // Ensure Goal B meshes are also persistent
            goalB.traverse(c => {
                if(c.isMesh) c.frustumCulled = false;
            });

            _scene.add(goalB);
        };

        window.flux.AssetLoader.loadModel(goalUrl, (gltf) => {
            onGoalLoaded(gltf.scene, false);
        }, undefined, (err) => {
console.warn("Goal model failed to load. Using fallback.", err);
const geo = new THREE.BoxGeometry(75, 45, 10); // Fallback massive box (Scaled 1.5x)
            const fallbackMat = new THREE.MeshBasicMaterial({ color: 0xffffff, wireframe: true });
            const fallback = new THREE.Mesh(geo, fallbackMat);
            onGoalLoaded(fallback, true);
        });

        // --- NEW: MASSIVE FIELD MARKINGS ---
        createFieldMarkings();
    }

    function createFieldMarkings() {
        const size = 1024;
        const c = document.createElement('canvas');
        c.width = size; c.height = size;
        const ctx = c.getContext('2d');
        const cx = size/2; const cy = size/2;

        ctx.clearRect(0, 0, size, size);

        // Glow Settings
        ctx.shadowBlur = 20;
        ctx.shadowColor = '#00ffff';
        ctx.strokeStyle = 'rgba(100, 255, 255, 0.9)';
        ctx.lineWidth = 5;
        ctx.lineCap = 'round';

        // 1. Main Field Circle (The Sphere Equator)
        ctx.beginPath();
        ctx.arc(cx, cy, 450, 0, Math.PI*2);
        ctx.stroke();

        // 2. Inner Decorative Ring
        ctx.beginPath();
        ctx.arc(cx, cy, 420, 0, Math.PI*2);
        ctx.lineWidth = 2;
        ctx.strokeStyle = 'rgba(0, 200, 255, 0.5)';
        ctx.stroke();

        // 3. Center Blitzoff Zone (Complex Star/Rune)
        ctx.lineWidth = 4;
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.9)';
        ctx.beginPath();
        ctx.arc(cx, cy, 80, 0, Math.PI*2);
        ctx.stroke();
        
        // Inner Star Pattern
        ctx.beginPath();
        for(let i=0; i<5; i++) {
            const a = (i/5)*Math.PI*2 - Math.PI/2;
            const x = cx + Math.cos(a)*60;
            const y = cy + Math.sin(a)*60;
            if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
            // Inner point
            const a2 = ((i+0.5)/5)*Math.PI*2 - Math.PI/2;
            const x2 = cx + Math.cos(a2)*25;
            const y2 = cy + Math.sin(a2)*25;
            ctx.lineTo(x2,y2);
        }
        ctx.closePath();
        ctx.stroke();

        // 4. Midfield Line
        ctx.beginPath();
        ctx.moveTo(0, cy); ctx.lineTo(size, cy);
        ctx.stroke();

        // 5. Goal Boxes (Trapezoids)
        const drawGoalBox = (yPos, dir) => {
const drawGoalBox = (yPos, dir) => {
            ctx.beginPath();
            ctx.moveTo(cx - 150, yPos);
            ctx.lineTo(cx + 150, yPos);
            ctx.lineTo(cx + 225, yPos + (dir * 120));
            ctx.lineTo(cx - 225, yPos + (dir * 120));
            ctx.closePath();
            ctx.stroke();
        };
            ctx.stroke();
        };
        drawGoalBox(50, 1); // Top (Home side in texture space)
        drawGoalBox(size-50, -1); // Bottom

        // 6. Runes (Procedural Text Ring)
        ctx.font = 'bold 32px monospace';
        ctx.fillStyle = 'rgba(0, 255, 255, 0.7)';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        
        const runes = "BLITZBALL SPHERE POOL ZANARKAND ABYSS ETERNAL CALM ";
        const runeCount = 32;
        for(let i=0; i<runeCount; i++) {
            const angle = (i / runeCount) * Math.PI * 2;
            const r = 480;
            const x = cx + Math.cos(angle) * r;
            const y = cy + Math.sin(angle) * r;
            
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(angle + Math.PI/2);
            // Use a char from the string or random rune-like char
            const char = runes[i % runes.length];
            ctx.fillText(char, 0, 0);
            ctx.restore();
        }

        const tex = new THREE.CanvasTexture(c);
        tex.anisotropy = 16;

        // Floor Plane (Deep)
        const geo = new THREE.PlaneGeometry(64, 64);
        const mat = new THREE.MeshBasicMaterial({
            map: tex,
            transparent: true,
            opacity: 0.8,
            side: THREE.DoubleSide,
            depthWrite: false,
            blending: THREE.AdditiveBlending
        });

        const field = new THREE.Mesh(geo, mat);
        field.rotation.x = -Math.PI / 2;
        field.position.y = -8.0; // Sunk deep into the sphere
        _scene.add(field);

        // Floating Holographic Rings (Mid-height)
        const ringGeo = new THREE.TorusGeometry(20, 0.1, 16, 100);
        const ringMat = new THREE.MeshBasicMaterial({ color: 0x00ffff, transparent: true, opacity: 0.3, blending: THREE.AdditiveBlending });
        const ring1 = new THREE.Mesh(ringGeo, ringMat);
        ring1.rotation.x = Math.PI / 2;
        ring1.position.y = 0;
        _scene.add(ring1);
        
        const ring2 = new THREE.Mesh(ringGeo, ringMat);
        ring2.rotation.x = Math.PI / 2;
        ring2.scale.setScalar(1.2);
        ring2.position.y = 4.0;
        _scene.add(ring2);

        // Animate Rings
        const animate = () => {
            if(ring1) {
                ring1.rotation.z += 0.001;
                ring1.scale.setScalar(1.0 + Math.sin(Date.now()*0.0005)*0.05);
            }
            if(ring2) {
                ring2.rotation.z -= 0.0015;
                ring2.position.y = 4.0 + Math.cos(Date.now()*0.0007)*1.0;
            }
            requestAnimationFrame(animate);
        };
        animate();
    }

    // --- INPUT SYSTEM ---
    const _input = { x: 0, y: 0 };
    const _aimInput = { x: 0, y: 0, active: false }; // NEW: Aim joystick
    const _keys = { w: false, a: false, s: false, d: false, ArrowUp: false, ArrowLeft: false, ArrowDown: false, ArrowRight: false };

    const _actionBuffer = { active: false, timestamp: 0, duration: 300 };

    const _camFwd = new THREE.Vector3();
    const _camRight = new THREE.Vector3();
    const _upAxis = new THREE.Vector3(0, 1, 0);

    function setupInputs() {
        // Keyboard
        window.addEventListener('keydown', (e) => {
            _keys[e.key] = true;
            if (e.code === 'Space' && _homeTeam && _homeTeam.activePlayer && _ball) {
                _homeTeam.activePlayer.throwBall(_ball);
            }
            // NEW: Tackle on Shift
            if (e.code === 'ShiftLeft' || e.code === 'ShiftRight') {
                if (_homeTeam && _homeTeam.activePlayer) {
                    const p = _homeTeam.activePlayer;
                    if (!p.hasBall) {
                        p.dash(p.inputVector.x, p.inputVector.z);
                    }
                }
            }
            updateInputVector();
        });
        window.addEventListener('keyup', (e) => { _keys[e.key] = false; updateInputVector(); });

        // --- FLOATING JOYSTICK (Movement) ---
        const hitZone = document.getElementById('joystick-hit-zone');
        const visuals = document.getElementById('joystick-visual-container');
        const base = document.getElementById('joystick-base');
        const knob = document.getElementById('joystick-knob');

        let startX = 0, startY = 0;
        let dragging = false;
        const maxDist = 40;

        const handleStart = (clientX, clientY) => {
            dragging = true;
            startX = clientX;
            startY = clientY;

            visuals.style.display = 'block';
            visuals.style.left = `${clientX}px`;
            visuals.style.top = `${clientY}px`;

            knob.style.transform = `translate(-50%, -50%)`;

            createRipple(clientX, clientY);

            _input.x = 0;
            _input.y = 0;
            updateInputVector();
        };

        const handleMove = (clientX, clientY) => {
            if (!dragging) return;

            let dx = clientX - startX;
            let dy = clientY - startY;

            const dist = Math.sqrt(dx*dx + dy*dy);

            if (dist > maxDist) {
                dx = (dx / dist) * maxDist;
                dy = (dy / dist) * maxDist;
            }

            knob.style.transform = `translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px))`;

            _input.x = (dx / maxDist) * _settings.joystickSensitivity;
            _input.y = (dy / maxDist) * _settings.joystickSensitivity;
            updateInputVector();
        };

        const handleEnd = () => {
            if (!dragging) return;
            dragging = false;

            visuals.style.display = 'none';

            _input.x = 0;
            _input.y = 0;
            updateInputVector();
        };

        if (hitZone) {
            hitZone.addEventListener('touchstart', (e) => {
                e.preventDefault();
                handleStart(e.touches[0].clientX, e.touches[0].clientY);
            }, { passive: false });

            window.addEventListener('touchmove', (e) => {
                if(dragging) {
                    if (e.cancelable) e.preventDefault();
                    handleMove(e.touches[0].clientX, e.touches[0].clientY);
                }
            }, { passive: false });

            window.addEventListener('touchend', handleEnd);

            hitZone.addEventListener('mousedown', (e) => {
                handleStart(e.clientX, e.clientY);
            });
            window.addEventListener('mousemove', (e) => {
                if (dragging) handleMove(e.clientX, e.clientY);
            });
            window.addEventListener('mouseup', handleEnd);
        }

        // --- NEW: AIM JOYSTICK (Right side) ---
        setupAimJoystick();

        // --- NEW: TACKLE BUTTON ---
        setupTackleButton();

        // Swipe Detection
        let swipeStart = { x: 0, y: 0, t: 0 };

        const onSwipeStart = (x, y) => {
            swipeStart.x = x;
            swipeStart.y = y;
            swipeStart.t = Date.now();
        };

        const onSwipeEnd = (x, y) => {
            const dt = Date.now() - swipeStart.t;
            const dx = x - swipeStart.x;
            const dy = y - swipeStart.y;
            const dist = Math.sqrt(dx*dx + dy*dy);

            if (dt < 300 && dist > 30) {
                if (_homeTeam && _homeTeam.activePlayer && _camera) {
                    _camera.getWorldDirection(_camFwd);
                    _camFwd.y = 0;
                    if (_camFwd.lengthSq() < 0.001) _camFwd.set(0, 0, -1);
                    else _camFwd.normalize();

                    _camRight.crossVectors(_camFwd, _upAxis).normalize();

                    const worldX = (_camRight.x * dx) + (_camFwd.x * -dy);
                    const worldZ = (_camRight.z * dx) + (_camFwd.z * -dy);

                    const p = _homeTeam.activePlayer;

                    if (p.isThrowing) {
                        p.setOverrideAim(worldX, worldZ);
                        if (window.flux.gameInstance.floatingText) {
                            window.flux.gameInstance.floatingText.spawn("AIM!", p.mesh.position, "default");
                        }
                    } else {
                        p.dash(worldX, worldZ);
                    }

                    createRipple(x, y);
                }
            }
        };

        // Touch Swipe (excluding controls)
        window.addEventListener('touchstart', (e) => {
            if (e.target.closest('#joystick-hit-zone') ||
                e.target.closest('#action-button') ||
                e.target.closest('#tackle-button') ||
                e.target.closest('#aim-joystick-zone') ||
                e.target.closest('#auto-toggle') ||
                e.target.closest('#settings-button')) return;
            onSwipeStart(e.touches[0].clientX, e.touches[0].clientY);
            createRipple(e.touches[0].clientX, e.touches[0].clientY);
        }, { passive: false });

        window.addEventListener('touchend', (e) => {
            if (e.target.closest('#joystick-hit-zone') ||
                e.target.closest('#action-button') ||
                e.target.closest('#tackle-button') ||
                e.target.closest('#aim-joystick-zone') ||
                e.target.closest('#auto-toggle') ||
                e.target.closest('#settings-button')) return;
            onSwipeEnd(e.changedTouches[0].clientX, e.changedTouches[0].clientY);
        });

        // Mouse Swipe
        window.addEventListener('mousedown', (e) => {
            if (e.target.closest('#joystick-hit-zone') ||
                e.target.closest('#action-button') ||
                e.target.closest('#tackle-button') ||
                e.target.closest('#aim-joystick-zone') ||
                e.target.closest('#auto-toggle') ||
                e.target.closest('#settings-button')) return;
            onSwipeStart(e.clientX, e.clientY);
            createRipple(e.clientX, e.clientY);
        });

        window.addEventListener('mouseup', (e) => {
            if (e.target.closest('#joystick-hit-zone') ||
                e.target.closest('#action-button') ||
                e.target.closest('#tackle-button') ||
                e.target.closest('#aim-joystick-zone') ||
                e.target.closest('#auto-toggle') ||
                e.target.closest('#settings-button')) return;
            onSwipeEnd(e.clientX, e.clientY);
        });

        // Action Button (Shoot/Pass)
        const actionBtn = document.getElementById('action-button');

        const setupButton = (btn) => {
            if (!btn) return;

            let btnStartX = 0;
            let btnStartY = 0;
            let isDragging = false;

            const attemptAction = () => {
                if (!_homeTeam || !_homeTeam.activePlayer) return false;
                const p = _homeTeam.activePlayer;

                if (p.hasBall && !p.isCharging && !p.isThrowing && p.status.nap <= 0) {
                    p.startCharge();
                    btn.classList.add('active');
                    return true;
                }
                return false;
            };

            const handleStart = (e) => {
                if (e.cancelable) e.preventDefault();

                if (_gameManager && _gameManager.techCopyState.active) {
                    _gameManager.attemptTechCopy();
                    btn.classList.add('active');
                    setTimeout(() => btn.classList.remove('active'), 100);
                    return;
                }

                if (_gameManager && _gameManager.isDemoMode) return;

                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                btnStartX = clientX;
                btnStartY = clientY;
                isDragging = true;

                _actionBuffer.active = true;
                _actionBuffer.timestamp = Date.now();

                if (attemptAction()) {
                    _actionBuffer.active = false;
                }
            };

            const handleEnd = (e) => {
                if (e.cancelable) e.preventDefault();
                _actionBuffer.active = false;
                isDragging = false;

                let dx = 0, dy = 0;

                const clientX = e.changedTouches ? e.changedTouches[0].clientX : e.clientX;
                const clientY = e.changedTouches ? e.changedTouches[0].clientY : e.clientY;

                dx = clientX - btnStartX;
                dy = clientY - btnStartY;

                if (_homeTeam && _homeTeam.activePlayer) {
                    const p = _homeTeam.activePlayer;
                    if (p.isCharging) {
                        p.releaseCharge(dx, dy);
                        btn.classList.remove('active');
                    }
                }
            };

            btn.addEventListener('touchstart', handleStart, { passive: false });
            btn.addEventListener('mousedown', handleStart);
            btn.addEventListener('touchend', handleEnd);
            btn.addEventListener('mouseup', handleEnd);
            btn.addEventListener('mouseleave', handleEnd);
        };

        setupButton(actionBtn);

        // Auto Toggle
        const autoBtn = document.getElementById('auto-toggle');
        if (autoBtn) {
            const handleToggle = () => {
                if (_gameManager) {
                    _gameManager.toggleDemoMode();
                    if (_homeTeam && _homeTeam.activePlayer) {
                        _homeTeam.activePlayer.setInput(0, 0);
                    }
                }
            };

            autoBtn.addEventListener('click', handleToggle);
            autoBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                handleToggle();
            }, { passive: false });
        }

        // NEW: Settings Button
        setupSettingsButton();
    }

    // NEW: Aim Joystick Setup
    function setupAimJoystick() {
        const aimZone = document.getElementById('aim-joystick-zone');
        const aimVisuals = document.getElementById('aim-joystick-visual');
        const aimKnob = document.getElementById('aim-joystick-knob');

        if (!aimZone) return;

        let aimStartX = 0, aimStartY = 0;
        let aimDragging = false;
        const aimMaxDist = 35;

        const handleAimStart = (clientX, clientY) => {
            aimDragging = true;
            aimStartX = clientX;
            aimStartY = clientY;
            _aimInput.active = true;

            if (aimVisuals) {
                aimVisuals.style.display = 'block';
                aimVisuals.style.left = `${clientX}px`;
                aimVisuals.style.top = `${clientY}px`;
            }
            if (aimKnob) {
                aimKnob.style.transform = `translate(-50%, -50%)`;
            }
        };

        const handleAimMove = (clientX, clientY) => {
            if (!aimDragging) return;

            let dx = clientX - aimStartX;
            let dy = clientY - aimStartY;

            const dist = Math.sqrt(dx*dx + dy*dy);

            if (dist > aimMaxDist) {
                dx = (dx / dist) * aimMaxDist;
                dy = (dy / dist) * aimMaxDist;
            }

            if (aimKnob) {
                aimKnob.style.transform = `translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px))`;
            }

            // Normalize and transform to world space
            _aimInput.x = dx / aimMaxDist;
            _aimInput.y = dy / aimMaxDist;

            // Apply aim to player if charging
            if (_homeTeam && _homeTeam.activePlayer) {
                const p = _homeTeam.activePlayer;
                if (p.isCharging || p.isThrowing) {
                    // Transform screen aim to world space
                    _camera.getWorldDirection(_camFwd);
                    _camFwd.y = 0;
                    if (_camFwd.lengthSq() < 0.001) _camFwd.set(0, 0, -1);
                    else _camFwd.normalize();
                    _camRight.crossVectors(_camFwd, _upAxis).normalize();

                    const worldX = (_camRight.x * _aimInput.x) + (_camFwd.x * -_aimInput.y);
                    const worldZ = (_camRight.z * _aimInput.x) + (_camFwd.z * -_aimInput.y);

                    if (Math.abs(worldX) > 0.1 || Math.abs(worldZ) > 0.1) {
                        p.setOverrideAim(worldX, worldZ);
                    }
                }
            }
        };

        const handleAimEnd = () => {
            if (!aimDragging) return;
            aimDragging = false;
            _aimInput.active = false;
            _aimInput.x = 0;
            _aimInput.y = 0;

            if (aimVisuals) {
                aimVisuals.style.display = 'none';
            }
        };

        aimZone.addEventListener('touchstart', (e) => {
            e.preventDefault();
            handleAimStart(e.touches[0].clientX, e.touches[0].clientY);
        }, { passive: false });

        window.addEventListener('touchmove', (e) => {
            if (aimDragging) {
                if (e.cancelable) e.preventDefault();
                handleAimMove(e.touches[0].clientX, e.touches[0].clientY);
            }
        }, { passive: false });

        window.addEventListener('touchend', (e) => {
            if (aimDragging) {
                handleAimEnd();
            }
        });

        // Mouse support for desktop testing
        aimZone.addEventListener('mousedown', (e) => {
            handleAimStart(e.clientX, e.clientY);
        });
        window.addEventListener('mousemove', (e) => {
            if (aimDragging) handleAimMove(e.clientX, e.clientY);
        });
        window.addEventListener('mouseup', (e) => {
            if (aimDragging) handleAimEnd();
        });
    }

    // NEW: Tackle Button Setup
    function setupTackleButton() {
        const tackleBtn = document.getElementById('tackle-button');
        if (!tackleBtn) return;

        const handleTackle = (e) => {
            if (e.cancelable) e.preventDefault();

            if (_gameManager && _gameManager.isDemoMode) return;

            if (_homeTeam && _homeTeam.activePlayer) {
                const p = _homeTeam.activePlayer;

                // If we don't have the ball, dash/tackle
                if (!p.hasBall) {
                    // Get current movement direction or forward
                    let dashX = p.inputVector.x;
                    let dashZ = p.inputVector.z;

                    // If not moving, dash forward
                    if (Math.abs(dashX) < 0.1 && Math.abs(dashZ) < 0.1) {
                        const fwd = new THREE.Vector3(0, 0, 1).applyQuaternion(p.mesh.quaternion);
                        dashX = fwd.x;
                        dashZ = fwd.z;
                    }

                    p.dash(dashX, dashZ);

                    tackleBtn.classList.add('active');
                    setTimeout(() => tackleBtn.classList.remove('active'), 200);

                    if (window.flux.gameInstance.floatingText) {
                        window.flux.gameInstance.floatingText.spawn("TACKLE!", p.mesh.position, "tech");
                    }
                } else if (p.isEngaged) {
                    // Break tackle if engaged
                    p.dash(p.inputVector.x, p.inputVector.z);
                    tackleBtn.classList.add('active');
                    setTimeout(() => tackleBtn.classList.remove('active'), 200);
                }
            }
        };

        tackleBtn.addEventListener('touchstart', handleTackle, { passive: false });
        tackleBtn.addEventListener('mousedown', handleTackle);
    }

    // NEW: Settings Button Setup
// NEW: Settings Button Setup
    function setupSettingsButton() {
        const settingsBtn = document.getElementById('settings-button');
        const settingsPanel = document.getElementById('settings-panel');
        const settingsClose = document.getElementById('settings-close');

        if (!settingsBtn || !settingsPanel) return;

        settingsBtn.addEventListener('click', () => {
            settingsPanel.style.display = settingsPanel.style.display === 'none' ? 'block' : 'none';
        });

        if (settingsClose) {
            settingsClose.addEventListener('click', () => {
                settingsPanel.style.display = 'none';
            });
        }

        // Sensitivity slider
        const sensitivitySlider = document.getElementById('sensitivity-slider');
        if (sensitivitySlider) {
            sensitivitySlider.value = _settings.joystickSensitivity * 100;
            sensitivitySlider.addEventListener('input', (e) => {
                _settings.joystickSensitivity = e.target.value / 100;
            });
        }

        // Aim assist toggle
        const aimAssistToggle = document.getElementById('aim-assist-toggle');
        if (aimAssistToggle) {
            aimAssistToggle.checked = _settings.aimAssist;
            aimAssistToggle.addEventListener('change', (e) => {
                _settings.aimAssist = e.target.checked;
            });
        }

        // Camera shake toggle
        const shakeToggle = document.getElementById('shake-toggle');
        if (shakeToggle) {
            shakeToggle.checked = _settings.cameraShake;
            shakeToggle.addEventListener('change', (e) => {
                _settings.cameraShake = e.target.checked;
            });
        }

        // Volume slider
        const volumeSlider = document.getElementById('volume-slider');
        if (volumeSlider && _audioManager) {
            volumeSlider.addEventListener('input', (e) => {
                const vol = e.target.value / 100;
                _audioManager.setVolume(vol);
            });
        }

        // Exit to Menu
        const exitBtn = document.getElementById('exit-to-menu-btn');
        if (exitBtn) {
            exitBtn.addEventListener('click', () => {
                if (_menuManager) {
                    _menuManager.show();
                    if (_gameManager) {
                        _gameManager.state = 'menu';
                        // Stop practice if running
                        if (_gameManager.practiceManager) {
                            _gameManager.practiceManager.stop();
                        }
                        // Reset camera to menu orbit if needed
                        if (_gameManager.cameraManager) {
                            // Optional: Reset camera parameters
                        }
                    }
                    settingsPanel.style.display = 'none';
                }
            });
        }
    }

    function updateInputVector() {
        let x = _input.x || 0;
        let z = _input.y || 0;

        if (_keys['w'] || _keys['ArrowUp']) z -= 1;
        if (_keys['s'] || _keys['ArrowDown']) z += 1;
        if (_keys['a'] || _keys['ArrowLeft']) x -= 1;
        if (_keys['d'] || _keys['ArrowRight']) x += 1;

        const lenSq = x*x + z*z;
        if (lenSq > 1) {
            const len = Math.sqrt(lenSq);
            x /= len;
            z /= len;
        }

        if (isNaN(x)) x = 0;
        if (isNaN(z)) z = 0;

        if (_camera) {
            _camera.getWorldDirection(_camFwd);
            _camFwd.y = 0;

            if (_camFwd.lengthSq() < 0.001) {
                _camFwd.set(0, 0, -1);
            } else {
                _camFwd.normalize();
            }

            _camRight.crossVectors(_camFwd, _upAxis).normalize();
        } else {
            _camFwd.set(0, 0, -1);
            _camRight.set(1, 0, 0);
        }

        let worldX = (_camFwd.x * -z) + (_camRight.x * x);
        let worldZ = (_camFwd.z * -z) + (_camRight.z * x);

        if (isNaN(worldX) || isNaN(worldZ)) {
            worldX = 0;
            worldZ = 0;
        }

        if (_homeTeam && _homeTeam.activePlayer) {
            if (_gameManager && !_gameManager.isDemoMode) {
                _homeTeam.activePlayer.setInput(worldX, worldZ);
            }
        }
    }

    function createRipple(x, y) {
        const ripple = document.createElement('div');
        ripple.className = 'touch-ripple';
        ripple.style.left = `${x}px`;
        ripple.style.top = `${y}px`;
        document.getElementById('ui-layer').appendChild(ripple);

        setTimeout(() => {
            if (ripple.parentNode) ripple.parentNode.removeChild(ripple);
        }, 600);
    }

function onResize() {
        const width = window.innerWidth;
        const height = window.innerHeight;
        
        if (_camera) {
            _camera.aspect = width / height;
            _camera.updateProjectionMatrix();
        }
        
        // Strictly 0.50 as requested
        const resScale = 0.50;
        
        _config.internalWidth = Math.floor(width * resScale);
        _config.internalHeight = Math.floor(height * resScale);

        if (_renderer) {
            _renderer.setSize(_config.internalWidth, _config.internalHeight, false);
        }
    }

    function animate() {
        requestAnimationFrame(animate);

        const rawDt = _clock.getDelta();
const dt = rawDt * (window.flux.timeScale !== undefined ? window.flux.timeScale : 0.8); // Default 80% speed

        // Impact Frames
        if (_gameManager && _gameManager.impactPause > 0) {
            _gameManager.impactPause -= dt;
            if (_renderer && _scene && _camera) {
                _renderer.render(_scene, _camera);
            }
            return;
        }

        updateInputVector();

        // Action Buffer Processing
        if (_actionBuffer.active) {
            if (Date.now() - _actionBuffer.timestamp > _actionBuffer.duration) {
                _actionBuffer.active = false;
            } else {
                if (_homeTeam && _homeTeam.activePlayer) {
                    const p = _homeTeam.activePlayer;

                    if (p.hasBall && !p.isCharging && !p.isThrowing && p.status.nap <= 0) {
                        p.startCharge();
                        const btn = document.getElementById('action-button');
                        if (btn) btn.classList.add('active');
                        _actionBuffer.active = false;
                    }
                }
            }
        }

        // Menu State Handling
        if (_gameManager && _gameManager.state === 'menu' && _camera) {
            const time = Date.now() * 0.0005;
            const radius = 50;
            _camera.position.x = Math.sin(time) * radius;
            _camera.position.z = Math.cos(time) * radius;
            _camera.position.y = 20;
            _camera.lookAt(0, 0, 0);

            if (_renderer && _scene) {
                _renderer.render(_scene, _camera);
            }
            return;
        }

        if (_gameManager) _gameManager.update(dt);

        // Update Entities
        if (_homeTeam) {
            _homeTeam.update(dt);
            _homeTeam.players.forEach(p => checkBallGrab(p));
        }

        if (_awayTeam) {
            _awayTeam.update(dt);
            _awayTeam.players.forEach(p => checkBallGrab(p));
        }

        if (_ball) {
            _ball.update(dt);
        }

        // Update Camera
// Update Camera
        updateCameraLogic(dt);
// Update Visuals
        if (_waterOverlay) _waterOverlay.update(dt);
        if (_lightShafts) _lightShafts.update(dt);
        if (_stadium) _stadium.update(dt);
        if (_glyphManager) _glyphManager.update(dt);

if (_renderer && _scene && _camera) {
            _renderer.render(_scene, _camera);
        }

        // UI Updates
        updateUI();
    }

    function updateUI() {
        if (!_homeTeam || !_homeTeam.activePlayer) return;

        const btn = document.getElementById('action-button');
        const lbl = document.getElementById('action-label');
        const tackleBtn = document.getElementById('tackle-button');
        const p = _homeTeam.activePlayer;

        if (btn && lbl) {
            const btnText = btn.querySelector('.btn-text');

            if (p.hasBall) {
                if (btnText && btnText.innerText !== "ACTION") {
                    btnText.innerText = "ACTION";
                    btn.classList.add('shoot-mode');
                    lbl.innerText = "OFFENSE";
                    lbl.classList.add('shoot-label');
                }

                const isHighEnergy = (p.stats.HP / p.stats.maxHP) > 0.4;
                if (isHighEnergy) {
                    if (!btn.classList.contains('limit-ready')) btn.classList.add('limit-ready');
                } else {
                    if (btn.classList.contains('limit-ready')) btn.classList.remove('limit-ready');
                }

            } else {
                if (btnText && btnText.innerText !== "SWIM") {
                    btnText.innerText = "SWIM";
                    btn.classList.remove('shoot-mode');
                    btn.classList.remove('limit-ready');
                    lbl.innerText = "NORMAL";
                    lbl.classList.remove('shoot-label');
                }
            }
        }

        // Update tackle button visibility
        if (tackleBtn) {
            if (!p.hasBall || p.isEngaged) {
                tackleBtn.style.display = 'flex';
                // Update tackle button text based on context
                const tackleText = tackleBtn.querySelector('.btn-text');
                if (tackleText) {
                    if (p.isEngaged && p.hasBall) {
tackleText.innerText = 'BREAK';
                        tackleBtn.classList.add('urgent');
                    } else {
                        tackleText.innerText = 'TACKLE';
                        tackleBtn.classList.remove('urgent');
                    }
}
            } else {
                tackleBtn.style.display = 'none';
            }
        }

        // Update distance to goal indicator
        const distIndicator = document.getElementById('goal-distance');
        if (distIndicator && p.mesh) {
            const goalZ = (p.team && p.team.side === 1) ? -28 : 28;
            const dist = Math.abs(p.mesh.position.z - goalZ);
            distIndicator.innerText = `${Math.floor(dist)}m`;
        }
    }

    function updateCameraLogic(dt) {
        if (!_cameraManager || !_ball) return;

        let targetMesh = _ball.mesh;
        let targetVel = _ball.velocity;
        let targetInput = null;

        if (_ball.holder && _ball.holder.mesh) {
            targetMesh = _ball.holder.mesh;
            targetVel = _ball.holder.velocity;
            if (_ball.holder.inputVector) {
                targetInput = _ball.holder.inputVector;
            }
        }

        _cameraManager.setTarget(targetMesh, targetVel, targetInput);
        _cameraManager.update(dt);
    }

function checkBallGrab(entity) {
        if (!entity.canCatch) return;
        if (_ball && !_ball.isCatchable()) return;
        if (entity.stunTimer > 0 || (entity.status && entity.status.nap > 0)) return;
        if (_ball.state !== 'free') return;
        if (!_ball.mesh || !entity.mesh) return;

        const ballPos = _ball.mesh.position;
        const entPos = entity.mesh.position;

        const dx = ballPos.x - entPos.x;
        const dz = ballPos.z - entPos.z;
        const distXZ = Math.sqrt(dx*dx + dz*dz);
        const distY = Math.abs(ballPos.y - entPos.y);

        const touchRadius = 1.0; // Reduced from 1.5
        // Reduced radii to prevent "Invisible Wall" catch snapping
        let magnetRadius = 1.8; // Reduced from 2.5
        let interactionRadius = 3.5; // Reduced from 4.0
        let catchHeight = 3.0; // Reduced from 3.5

        if (entity.isDashing) {
            magnetRadius = 3.0;
            interactionRadius = 4.5;
            catchHeight = 4.5;
        }

        if (distXZ > interactionRadius || distY > catchHeight) return;

        const toBall = ballPos.clone().sub(entPos).normalize();
        const playerForward = new THREE.Vector3(0, 0, 1).applyQuaternion(entity.mesh.quaternion).normalize();

        const facingDot = playerForward.dot(toBall);

        const coneThreshold = -0.2;
        const isInCone = facingDot > coneThreshold;
        const isInTouch = distXZ < touchRadius;

        if (distXZ < interactionRadius && !isInCone) {
            const targetAngle = Math.atan2(toBall.x, toBall.z);
            const q = new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0), targetAngle);
            entity.mesh.quaternion.slerp(q, 0.1);
            if (entity.syncRotation) entity.syncRotation();
        }

        if (isInTouch || (distXZ < magnetRadius && isInCone)) {
            // BLAST THROUGH LOGIC
            const ballSpeed = _ball.velocity.length();
            let catchChance = 1.0;

            // If ball is moving fast (e.g. > 20), check CA
            if (ballSpeed > 20.0) {
                const ca = entity.getStat('CA');
                // Difficulty scales with speed. 
                const difficulty = ballSpeed * 1.2; 
                
                if (difficulty > ca) {
                    catchChance = 0.4 + (ca / difficulty) * 0.6;
                    
                    // Point Blank Penalty: Harder to react if ball is right on top of you moving fast
                    if (distXZ < 1.2) {
                        catchChance *= 0.6; // Blast through likely
                    }
                    
                    if (entity.isDashing) catchChance += 0.2;
                }
            } else if (_ball.powerType === 'SH' && _ball.power > 15.0) {
                // Shot power check
                const ca = entity.getStat('CA');
                if (_ball.power > ca * 1.2) {
                    const chance = Math.min(0.7, (_ball.power - ca) * 0.04);
                    catchChance = 1.0 - chance;
                }
            }

            let fumble = false;
            if (Math.random() > catchChance) {
                fumble = true;
            }

            if (fumble) {
                if (window.flux.gameInstance.floatingText) {
                    // Visual feedback for blast through
                    window.flux.gameInstance.floatingText.spawn("BLAST THROUGH!", entPos, "damage");
                }
                
                // Deflect slightly but keep moving fast (Blast Through)
                // Don't stop it completely like a block, just perturb it
                _ball.velocity.multiplyScalar(0.85); 
                _ball.velocity.x += (Math.random()-0.5) * 5.0;
                _ball.velocity.y += (Math.random()) * 5.0; // Pop up
                _ball.velocity.z += (Math.random()-0.5) * 5.0;
                
                _ball.power *= 0.7;

                entity.canCatch = false;
                // Stun briefly
                entity.stunTimer = 0.5;
                if(entity.play) entity.play('react', 0.1);
                
                setTimeout(() => { entity.canCatch = true; }, 1000);

            } else {
                _ball.magnetize(entity);
            }
        }
    }

    // Start
    init();
})();
</script>


</body></html>